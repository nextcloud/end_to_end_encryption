import{p as ct,g as qt,a as g0,b as cu,c as y0,d as w0,o as v0,e as Sy,B as lf,f as b0,t as Ce,_ as S0,h as oi,i as A0,j as va,k as St,l as qo,r as sh,u as xe,m as Oa,n as Rs,q as Ms,s as wr,v as Ay,w as Ne,x as pp,y as Gm,z as Zp,A as zm,C as es,D as bm,E as N0,F as rr,N as E0,G as C0,H as Ny,I as k0,J as Aa,K as ni,L as Wd,M as Ey,O as I0,P as rh,Q as Cy,R as ky,S as V0,T as B0,U as Iy,V as x0,W as Vy,X as O0,Y as P0,Z as D0,$ as T0}from"./logger-DTJ2mlZO.chunk.mjs";import{p as Xt,P as By,f as ot,B as Te,s as ru,a as Sm,O as ae,N as rt,g,S as D,I as q,C as j,R as ye,c as ee,b as te,d as le,e as be,h as Me,A as de,i as pe,j as ke,k as at,l as Rl,n as L0,m as Ul,o as Am,u as Xo,t as dp,G as Je,q as Ra,U as Nm,T as gp,r as nr,v as yp,w as Em,x as wp,y as xy,z as Rh,V as R0,D as U0,E as $0,F as j0,H as K0,J as $l,K as M0,L as _d,M as hf,X as ed,Q as H0,W as J0,Y as Gd}from"./x509.es-CM4G2ZW9.chunk.mjs";function Oy(r,e,t){const s=document.querySelector(`#initial-state-${r}-${e}`);if(s===null)return t;try{return JSON.parse(atob(s.value))}catch{throw new Error(`Could not parse initial state ${e} of ${r}`)}}function Py(){return Oy("files_sharing","isPublic",null)??document.querySelector('input#isPublic[type="hidden"][name="isPublic"][value="1"]')!==null}function F0(){return Oy("files_sharing","sharingToken",null)??document.querySelector('input#sharingToken[type="hidden"]')?.value??null}function xr(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function zd(r,e,t){q0(r,e),e.set(r,t)}function q0(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function bt(r,e){var t=Dy(r,e,"get");return W0(r,t)}function W0(r,e){return e.get?e.get.call(r):e.value}function Xd(r,e,t){var s=Dy(r,e,"set");return _0(r,s,t),t}function Dy(r,e,t){if(!e.has(r))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(r)}function _0(r,e,t){if(e.set)e.set.call(r,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}var G0=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",Nt=new WeakMap,gu=new WeakMap;class Xm{constructor(e){var{executor:t=()=>{},internals:s=sd(),promise:a=new Promise((n,i)=>t(n,i,o=>{s.onCancelList.push(o)}))}=e;zd(this,Nt,{writable:!0,value:void 0}),zd(this,gu,{writable:!0,value:void 0}),xr(this,G0,"CancelablePromise"),this.cancel=this.cancel.bind(this),Xd(this,Nt,s),Xd(this,gu,a||new Promise((n,i)=>t(n,i,o=>{s.onCancelList.push(o)})))}then(e,t){return Uh(bt(this,gu).then(ah(e,bt(this,Nt)),ah(t,bt(this,Nt))),bt(this,Nt))}catch(e){return Uh(bt(this,gu).catch(ah(e,bt(this,Nt))),bt(this,Nt))}finally(e,t){return t&&bt(this,Nt).onCancelList.push(e),Uh(bt(this,gu).finally(ah(()=>{if(e)return t&&(bt(this,Nt).onCancelList=bt(this,Nt).onCancelList.filter(s=>s!==e)),e()},bt(this,Nt))),bt(this,Nt))}cancel(){bt(this,Nt).isCanceled=!0;var e=bt(this,Nt).onCancelList;bt(this,Nt).onCancelList=[];for(var t of e)if(typeof t=="function")try{t()}catch(s){console.error(s)}}isCanceled(){return bt(this,Nt).isCanceled===!0}}class Or extends Xm{constructor(e){super({executor:e})}}xr(Or,"all",function(r){return nh(r,Promise.all(r))}),xr(Or,"allSettled",function(r){return nh(r,Promise.allSettled(r))}),xr(Or,"any",function(r){return nh(r,Promise.any(r))}),xr(Or,"race",function(r){return nh(r,Promise.race(r))}),xr(Or,"resolve",function(r){return Yd(Promise.resolve(r))}),xr(Or,"reject",function(r){return Yd(Promise.reject(r))}),xr(Or,"isCancelable",td);function Yd(r){return Uh(r,sd())}function td(r){return r instanceof Or||r instanceof Xm}function ah(r,e){if(r)return t=>{if(!e.isCanceled){var s=r(t);return td(s)&&e.onCancelList.push(s.cancel),s}return t}}function Uh(r,e){return new Xm({internals:e,promise:r})}function nh(r,e){var t=sd();return t.onCancelList.push(()=>{for(var s of r)td(s)&&s.cancel()}),new Xm({internals:t,promise:e})}function sd(){return{isCanceled:!1,onCancelList:[]}}var mf={},z0={2:r=>{function e(a,n,i){a instanceof RegExp&&(a=t(a,i)),n instanceof RegExp&&(n=t(n,i));var o=s(a,n,i);return o&&{start:o[0],end:o[1],pre:i.slice(0,o[0]),body:i.slice(o[0]+a.length,o[1]),post:i.slice(o[1]+n.length)}}function t(a,n){var i=n.match(a);return i?i[0]:null}function s(a,n,i){var o,l,u,c,f,h=i.indexOf(a),v=i.indexOf(n,h+1),d=h;if(h>=0&&v>0){for(o=[],u=i.length;d>=0&&!f;)d==h?(o.push(d),h=i.indexOf(a,d+1)):o.length==1?f=[o.pop(),v]:((l=o.pop())<u&&(u=l,c=v),v=i.indexOf(n,d+1)),d=h<v&&h>=0?h:v;o.length&&(f=[u,c])}return f}r.exports=e,e.range=s},101:function(r,e,t){var s;r=t.nmd(r),function(a){var n=(r&&r.exports,typeof qt=="object"&&qt);n.global!==n&&n.window;var i=function(f){this.message=f};(i.prototype=new Error).name="InvalidCharacterError";var o=function(f){throw new i(f)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=/[\t\n\f\r ]/g,c={encode:function(f){f=String(f),/[^\0-\xFF]/.test(f)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var h,v,d,A,b=f.length%3,I="",p=-1,w=f.length-b;++p<w;)h=f.charCodeAt(p)<<16,v=f.charCodeAt(++p)<<8,d=f.charCodeAt(++p),I+=l.charAt((A=h+v+d)>>18&63)+l.charAt(A>>12&63)+l.charAt(A>>6&63)+l.charAt(63&A);return b==2?(h=f.charCodeAt(p)<<8,v=f.charCodeAt(++p),I+=l.charAt((A=h+v)>>10)+l.charAt(A>>4&63)+l.charAt(A<<2&63)+"="):b==1&&(A=f.charCodeAt(p),I+=l.charAt(A>>2)+l.charAt(A<<4&63)+"=="),I},decode:function(f){var h=(f=String(f).replace(u,"")).length;h%4==0&&(h=(f=f.replace(/==?$/,"")).length),(h%4==1||/[^+a-zA-Z0-9/]/.test(f))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var v,d,A=0,b="",I=-1;++I<h;)d=l.indexOf(f.charAt(I)),v=A%4?64*v+d:d,A++%4&&(b+=String.fromCharCode(255&v>>(-2*A&6)));return b},version:"1.0.0"};(s=function(){return c}.call(e,t,e,r))===void 0||(r.exports=s)}()},172:(r,e)=>{e.d=function(t){if(!t)return 0;for(var s=(t=t.toString()).length,a=t.length;a--;){var n=t.charCodeAt(a);56320<=n&&n<=57343&&a--,127<n&&n<=2047?s++:2047<n&&n<=65535&&(s+=2)}return s}},526:r=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var s=[],a=0;a<t.length;a++)s.push(255&t.charCodeAt(a));return s},bytesToString:function(t){for(var s=[],a=0;a<t.length;a++)s.push(String.fromCharCode(t[a]));return s.join("")}}};r.exports=e},298:r=>{var e,t;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(s,a){return s<<a|s>>>32-a},rotr:function(s,a){return s<<32-a|s>>>a},endian:function(s){if(s.constructor==Number)return 16711935&t.rotl(s,8)|4278255360&t.rotl(s,24);for(var a=0;a<s.length;a++)s[a]=t.endian(s[a]);return s},randomBytes:function(s){for(var a=[];s>0;s--)a.push(Math.floor(256*Math.random()));return a},bytesToWords:function(s){for(var a=[],n=0,i=0;n<s.length;n++,i+=8)a[i>>>5]|=s[n]<<24-i%32;return a},wordsToBytes:function(s){for(var a=[],n=0;n<32*s.length;n+=8)a.push(s[n>>>5]>>>24-n%32&255);return a},bytesToHex:function(s){for(var a=[],n=0;n<s.length;n++)a.push((s[n]>>>4).toString(16)),a.push((15&s[n]).toString(16));return a.join("")},hexToBytes:function(s){for(var a=[],n=0;n<s.length;n+=2)a.push(parseInt(s.substr(n,2),16));return a},bytesToBase64:function(s){for(var a=[],n=0;n<s.length;n+=3)for(var i=s[n]<<16|s[n+1]<<8|s[n+2],o=0;o<4;o++)8*n+6*o<=8*s.length?a.push(e.charAt(i>>>6*(3-o)&63)):a.push("=");return a.join("")},base64ToBytes:function(s){s=s.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],n=0,i=0;n<s.length;i=++n%4)i!=0&&a.push((e.indexOf(s.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|e.indexOf(s.charAt(n))>>>6-2*i);return a}},r.exports=t},635:(r,e,t)=>{const s=t(31),a=t(338),n=t(221);r.exports={XMLParser:a,XMLValidator:s,XMLBuilder:n}},118:r=>{r.exports=function(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const s of e)if(typeof s=="string"&&t===s||s instanceof RegExp&&s.test(t))return!0}:()=>!1}},705:(r,e)=>{const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",s="["+t+"]["+t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",a=new RegExp("^"+s+"$");e.isExist=function(n){return n!==void 0},e.isEmptyObject=function(n){return Object.keys(n).length===0},e.merge=function(n,i,o){if(i){const l=Object.keys(i),u=l.length;for(let c=0;c<u;c++)n[l[c]]=o==="strict"?[i[l[c]]]:i[l[c]]}},e.getValue=function(n){return e.isExist(n)?n:""},e.isName=function(n){return a.exec(n)!=null},e.getAllMatches=function(n,i){const o=[];let l=i.exec(n);for(;l;){const u=[];u.startIndex=i.lastIndex-l[0].length;const c=l.length;for(let f=0;f<c;f++)u.push(l[f]);o.push(u),l=i.exec(n)}return o},e.nameRegexp=s},31:(r,e,t)=>{const s=t(705),a={allowBooleanAttributes:!1,unpairedTags:[]};function n(p){return p===" "||p==="	"||p===`
`||p==="\r"}function i(p,w){const E=w;for(;w<p.length;w++)if(!(p[w]!="?"&&p[w]!=" ")){const O=p.substr(E,w-E);if(w>5&&O==="xml")return d("InvalidXml","XML declaration allowed only at the start of the document.",b(p,w));if(p[w]=="?"&&p[w+1]==">"){w++;break}}return w}function o(p,w){if(p.length>w+5&&p[w+1]==="-"&&p[w+2]==="-"){for(w+=3;w<p.length;w++)if(p[w]==="-"&&p[w+1]==="-"&&p[w+2]===">"){w+=2;break}}else if(p.length>w+8&&p[w+1]==="D"&&p[w+2]==="O"&&p[w+3]==="C"&&p[w+4]==="T"&&p[w+5]==="Y"&&p[w+6]==="P"&&p[w+7]==="E"){let E=1;for(w+=8;w<p.length;w++)if(p[w]==="<")E++;else if(p[w]===">"&&(E--,E===0))break}else if(p.length>w+9&&p[w+1]==="["&&p[w+2]==="C"&&p[w+3]==="D"&&p[w+4]==="A"&&p[w+5]==="T"&&p[w+6]==="A"&&p[w+7]==="["){for(w+=8;w<p.length;w++)if(p[w]==="]"&&p[w+1]==="]"&&p[w+2]===">"){w+=2;break}}return w}e.validate=function(p,w){w=Object.assign({},a,w);const E=[];let O=!1,x=!1;p[0]==="\uFEFF"&&(p=p.substr(1));for(let B=0;B<p.length;B++)if(p[B]==="<"&&p[B+1]==="?"){if(B+=2,B=i(p,B),B.err)return B}else{if(p[B]!=="<"){if(n(p[B]))continue;return d("InvalidChar","char '"+p[B]+"' is not expected.",b(p,B))}{let k=B;if(B++,p[B]==="!"){B=o(p,B);continue}{let J=!1;p[B]==="/"&&(J=!0,B++);let F="";for(;B<p.length&&p[B]!==">"&&p[B]!==" "&&p[B]!=="	"&&p[B]!==`
`&&p[B]!=="\r";B++)F+=p[B];if(F=F.trim(),F[F.length-1]==="/"&&(F=F.substring(0,F.length-1),B--),T=F,!s.isName(T)){let re;return re=F.trim().length===0?"Invalid space after '<'.":"Tag '"+F+"' is an invalid name.",d("InvalidTag",re,b(p,B))}const P=c(p,B);if(P===!1)return d("InvalidAttr","Attributes for '"+F+"' have open quote.",b(p,B));let U=P.value;if(B=P.index,U[U.length-1]==="/"){const re=B-U.length;U=U.substring(0,U.length-1);const X=h(U,w);if(X!==!0)return d(X.err.code,X.err.msg,b(p,re+X.err.line));O=!0}else if(J){if(!P.tagClosed)return d("InvalidTag","Closing tag '"+F+"' doesn't have proper closing.",b(p,B));if(U.trim().length>0)return d("InvalidTag","Closing tag '"+F+"' can't have attributes or invalid starting.",b(p,k));if(E.length===0)return d("InvalidTag","Closing tag '"+F+"' has not been opened.",b(p,k));{const re=E.pop();if(F!==re.tagName){let X=b(p,re.tagStartPos);return d("InvalidTag","Expected closing tag '"+re.tagName+"' (opened in line "+X.line+", col "+X.col+") instead of closing tag '"+F+"'.",b(p,k))}E.length==0&&(x=!0)}}else{const re=h(U,w);if(re!==!0)return d(re.err.code,re.err.msg,b(p,B-U.length+re.err.line));if(x===!0)return d("InvalidXml","Multiple possible root nodes found.",b(p,B));w.unpairedTags.indexOf(F)!==-1||E.push({tagName:F,tagStartPos:k}),O=!0}for(B++;B<p.length;B++)if(p[B]==="<"){if(p[B+1]==="!"){B++,B=o(p,B);continue}if(p[B+1]!=="?")break;if(B=i(p,++B),B.err)return B}else if(p[B]==="&"){const re=v(p,B);if(re==-1)return d("InvalidChar","char '&' is not expected.",b(p,B));B=re}else if(x===!0&&!n(p[B]))return d("InvalidXml","Extra text at the end",b(p,B));p[B]==="<"&&B--}}}var T;return O?E.length==1?d("InvalidTag","Unclosed tag '"+E[0].tagName+"'.",b(p,E[0].tagStartPos)):!(E.length>0)||d("InvalidXml","Invalid '"+JSON.stringify(E.map(B=>B.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):d("InvalidXml","Start tag expected.",1)};const l='"',u="'";function c(p,w){let E="",O="",x=!1;for(;w<p.length;w++){if(p[w]===l||p[w]===u)O===""?O=p[w]:O!==p[w]||(O="");else if(p[w]===">"&&O===""){x=!0;break}E+=p[w]}return O===""&&{value:E,index:w,tagClosed:x}}const f=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function h(p,w){const E=s.getAllMatches(p,f),O={};for(let x=0;x<E.length;x++){if(E[x][1].length===0)return d("InvalidAttr","Attribute '"+E[x][2]+"' has no space in starting.",I(E[x]));if(E[x][3]!==void 0&&E[x][4]===void 0)return d("InvalidAttr","Attribute '"+E[x][2]+"' is without value.",I(E[x]));if(E[x][3]===void 0&&!w.allowBooleanAttributes)return d("InvalidAttr","boolean attribute '"+E[x][2]+"' is not allowed.",I(E[x]));const T=E[x][2];if(!A(T))return d("InvalidAttr","Attribute '"+T+"' is an invalid name.",I(E[x]));if(O.hasOwnProperty(T))return d("InvalidAttr","Attribute '"+T+"' is repeated.",I(E[x]));O[T]=1}return!0}function v(p,w){if(p[++w]===";")return-1;if(p[w]==="#")return function(O,x){let T=/\d/;for(O[x]==="x"&&(x++,T=/[\da-fA-F]/);x<O.length;x++){if(O[x]===";")return x;if(!O[x].match(T))break}return-1}(p,++w);let E=0;for(;w<p.length;w++,E++)if(!(p[w].match(/\w/)&&E<20)){if(p[w]===";")break;return-1}return w}function d(p,w,E){return{err:{code:p,msg:w,line:E.line||E,col:E.col}}}function A(p){return s.isName(p)}function b(p,w){const E=p.substring(0,w).split(/\r?\n/);return{line:E.length,col:E[E.length-1].length+1}}function I(p){return p.startIndex+p[1].length}},221:(r,e,t)=>{const s=t(87),a=t(118),n={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(c,f){return f},attributeValueProcessor:function(c,f){return f},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function i(c){this.options=Object.assign({},n,c),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=a(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=u),this.processTextOrObjNode=o,this.options.format?(this.indentate=l,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function o(c,f,h,v){const d=this.j2x(c,h+1,v.concat(f));return c[this.options.textNodeName]!==void 0&&Object.keys(c).length===1?this.buildTextValNode(c[this.options.textNodeName],f,d.attrStr,h):this.buildObjectNode(d.val,f,d.attrStr,h)}function l(c){return this.options.indentBy.repeat(c)}function u(c){return!(!c.startsWith(this.options.attributeNamePrefix)||c===this.options.textNodeName)&&c.substr(this.attrPrefixLen)}i.prototype.build=function(c){return this.options.preserveOrder?s(c,this.options):(Array.isArray(c)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(c={[this.options.arrayNodeName]:c}),this.j2x(c,0,[]).val)},i.prototype.j2x=function(c,f,h){let v="",d="";const A=h.join(".");for(let b in c)if(Object.prototype.hasOwnProperty.call(c,b))if(c[b]===void 0)this.isAttribute(b)&&(d+="");else if(c[b]===null)this.isAttribute(b)?d+="":b[0]==="?"?d+=this.indentate(f)+"<"+b+"?"+this.tagEndChar:d+=this.indentate(f)+"<"+b+"/"+this.tagEndChar;else if(c[b]instanceof Date)d+=this.buildTextValNode(c[b],b,"",f);else if(typeof c[b]!="object"){const I=this.isAttribute(b);if(I&&!this.ignoreAttributesFn(I,A))v+=this.buildAttrPairStr(I,""+c[b]);else if(!I)if(b===this.options.textNodeName){let p=this.options.tagValueProcessor(b,""+c[b]);d+=this.replaceEntitiesValue(p)}else d+=this.buildTextValNode(c[b],b,"",f)}else if(Array.isArray(c[b])){const I=c[b].length;let p="",w="";for(let E=0;E<I;E++){const O=c[b][E];if(O!==void 0)if(O===null)b[0]==="?"?d+=this.indentate(f)+"<"+b+"?"+this.tagEndChar:d+=this.indentate(f)+"<"+b+"/"+this.tagEndChar;else if(typeof O=="object")if(this.options.oneListGroup){const x=this.j2x(O,f+1,h.concat(b));p+=x.val,this.options.attributesGroupName&&O.hasOwnProperty(this.options.attributesGroupName)&&(w+=x.attrStr)}else p+=this.processTextOrObjNode(O,b,f,h);else if(this.options.oneListGroup){let x=this.options.tagValueProcessor(b,O);x=this.replaceEntitiesValue(x),p+=x}else p+=this.buildTextValNode(O,b,"",f)}this.options.oneListGroup&&(p=this.buildObjectNode(p,b,w,f)),d+=p}else if(this.options.attributesGroupName&&b===this.options.attributesGroupName){const I=Object.keys(c[b]),p=I.length;for(let w=0;w<p;w++)v+=this.buildAttrPairStr(I[w],""+c[b][I[w]])}else d+=this.processTextOrObjNode(c[b],b,f,h);return{attrStr:v,val:d}},i.prototype.buildAttrPairStr=function(c,f){return f=this.options.attributeValueProcessor(c,""+f),f=this.replaceEntitiesValue(f),this.options.suppressBooleanAttributes&&f==="true"?" "+c:" "+c+'="'+f+'"'},i.prototype.buildObjectNode=function(c,f,h,v){if(c==="")return f[0]==="?"?this.indentate(v)+"<"+f+h+"?"+this.tagEndChar:this.indentate(v)+"<"+f+h+this.closeTag(f)+this.tagEndChar;{let d="</"+f+this.tagEndChar,A="";return f[0]==="?"&&(A="?",d=""),!h&&h!==""||c.indexOf("<")!==-1?this.options.commentPropName!==!1&&f===this.options.commentPropName&&A.length===0?this.indentate(v)+`<!--${c}-->`+this.newLine:this.indentate(v)+"<"+f+h+A+this.tagEndChar+c+this.indentate(v)+d:this.indentate(v)+"<"+f+h+A+">"+c+d}},i.prototype.closeTag=function(c){let f="";return this.options.unpairedTags.indexOf(c)!==-1?this.options.suppressUnpairedNode||(f="/"):f=this.options.suppressEmptyNode?"/":`></${c}`,f},i.prototype.buildTextValNode=function(c,f,h,v){if(this.options.cdataPropName!==!1&&f===this.options.cdataPropName)return this.indentate(v)+`<![CDATA[${c}]]>`+this.newLine;if(this.options.commentPropName!==!1&&f===this.options.commentPropName)return this.indentate(v)+`<!--${c}-->`+this.newLine;if(f[0]==="?")return this.indentate(v)+"<"+f+h+"?"+this.tagEndChar;{let d=this.options.tagValueProcessor(f,c);return d=this.replaceEntitiesValue(d),d===""?this.indentate(v)+"<"+f+h+this.closeTag(f)+this.tagEndChar:this.indentate(v)+"<"+f+h+">"+d+"</"+f+this.tagEndChar}},i.prototype.replaceEntitiesValue=function(c){if(c&&c.length>0&&this.options.processEntities)for(let f=0;f<this.options.entities.length;f++){const h=this.options.entities[f];c=c.replace(h.regex,h.val)}return c},r.exports=i},87:r=>{function e(i,o,l,u){let c="",f=!1;for(let h=0;h<i.length;h++){const v=i[h],d=t(v);if(d===void 0)continue;let A="";if(A=l.length===0?d:`${l}.${d}`,d===o.textNodeName){let w=v[d];a(A,o)||(w=o.tagValueProcessor(d,w),w=n(w,o)),f&&(c+=u),c+=w,f=!1;continue}if(d===o.cdataPropName){f&&(c+=u),c+=`<![CDATA[${v[d][0][o.textNodeName]}]]>`,f=!1;continue}if(d===o.commentPropName){c+=u+`<!--${v[d][0][o.textNodeName]}-->`,f=!0;continue}if(d[0]==="?"){const w=s(v[":@"],o),E=d==="?xml"?"":u;let O=v[d][0][o.textNodeName];O=O.length!==0?" "+O:"",c+=E+`<${d}${O}${w}?>`,f=!0;continue}let b=u;b!==""&&(b+=o.indentBy);const I=u+`<${d}${s(v[":@"],o)}`,p=e(v[d],o,A,b);o.unpairedTags.indexOf(d)!==-1?o.suppressUnpairedNode?c+=I+">":c+=I+"/>":p&&p.length!==0||!o.suppressEmptyNode?p&&p.endsWith(">")?c+=I+`>${p}${u}</${d}>`:(c+=I+">",p&&u!==""&&(p.includes("/>")||p.includes("</"))?c+=u+o.indentBy+p+u:c+=p,c+=`</${d}>`):c+=I+"/>",f=!0}return c}function t(i){const o=Object.keys(i);for(let l=0;l<o.length;l++){const u=o[l];if(i.hasOwnProperty(u)&&u!==":@")return u}}function s(i,o){let l="";if(i&&!o.ignoreAttributes)for(let u in i){if(!i.hasOwnProperty(u))continue;let c=o.attributeValueProcessor(u,i[u]);c=n(c,o),c===!0&&o.suppressBooleanAttributes?l+=` ${u.substr(o.attributeNamePrefix.length)}`:l+=` ${u.substr(o.attributeNamePrefix.length)}="${c}"`}return l}function a(i,o){let l=(i=i.substr(0,i.length-o.textNodeName.length-1)).substr(i.lastIndexOf(".")+1);for(let u in o.stopNodes)if(o.stopNodes[u]===i||o.stopNodes[u]==="*."+l)return!0;return!1}function n(i,o){if(i&&i.length>0&&o.processEntities)for(let l=0;l<o.entities.length;l++){const u=o.entities[l];i=i.replace(u.regex,u.val)}return i}r.exports=function(i,o){let l="";return o.format&&o.indentBy.length>0&&(l=`
`),e(i,o,"",l)}},193:(r,e,t)=>{const s=t(705);function a(f,h){let v="";for(;h<f.length&&f[h]!=="'"&&f[h]!=='"';h++)v+=f[h];if(v=v.trim(),v.indexOf(" ")!==-1)throw new Error("External entites are not supported");const d=f[h++];let A="";for(;h<f.length&&f[h]!==d;h++)A+=f[h];return[v,A,h]}function n(f,h){return f[h+1]==="!"&&f[h+2]==="-"&&f[h+3]==="-"}function i(f,h){return f[h+1]==="!"&&f[h+2]==="E"&&f[h+3]==="N"&&f[h+4]==="T"&&f[h+5]==="I"&&f[h+6]==="T"&&f[h+7]==="Y"}function o(f,h){return f[h+1]==="!"&&f[h+2]==="E"&&f[h+3]==="L"&&f[h+4]==="E"&&f[h+5]==="M"&&f[h+6]==="E"&&f[h+7]==="N"&&f[h+8]==="T"}function l(f,h){return f[h+1]==="!"&&f[h+2]==="A"&&f[h+3]==="T"&&f[h+4]==="T"&&f[h+5]==="L"&&f[h+6]==="I"&&f[h+7]==="S"&&f[h+8]==="T"}function u(f,h){return f[h+1]==="!"&&f[h+2]==="N"&&f[h+3]==="O"&&f[h+4]==="T"&&f[h+5]==="A"&&f[h+6]==="T"&&f[h+7]==="I"&&f[h+8]==="O"&&f[h+9]==="N"}function c(f){if(s.isName(f))return f;throw new Error(`Invalid entity name ${f}`)}r.exports=function(f,h){const v={};if(f[h+3]!=="O"||f[h+4]!=="C"||f[h+5]!=="T"||f[h+6]!=="Y"||f[h+7]!=="P"||f[h+8]!=="E")throw new Error("Invalid Tag instead of DOCTYPE");{h+=9;let d=1,A=!1,b=!1,I="";for(;h<f.length;h++)if(f[h]!=="<"||b)if(f[h]===">"){if(b?f[h-1]==="-"&&f[h-2]==="-"&&(b=!1,d--):d--,d===0)break}else f[h]==="["?A=!0:I+=f[h];else{if(A&&i(f,h)){let p,w;h+=7,[p,w,h]=a(f,h+1),w.indexOf("&")===-1&&(v[c(p)]={regx:RegExp(`&${p};`,"g"),val:w})}else if(A&&o(f,h))h+=8;else if(A&&l(f,h))h+=8;else if(A&&u(f,h))h+=9;else{if(!n)throw new Error("Invalid DOCTYPE");b=!0}d++,I=""}if(d!==0)throw new Error("Unclosed DOCTYPE")}return{entities:v,i:h}}},63:(r,e)=>{const t={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,a){return a},attributeValueProcessor:function(s,a){return a},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,a,n){return s}};e.buildOptions=function(s){return Object.assign({},t,s)},e.defaultOptions=t},299:(r,e,t)=>{const s=t(705),a=t(365),n=t(193),i=t(494),o=t(118);function l(x){const T=Object.keys(x);for(let B=0;B<T.length;B++){const k=T[B];this.lastEntities[k]={regex:new RegExp("&"+k+";","g"),val:x[k]}}}function u(x,T,B,k,J,F,P){if(x!==void 0&&(this.options.trimValues&&!k&&(x=x.trim()),x.length>0)){P||(x=this.replaceEntitiesValue(x));const U=this.options.tagValueProcessor(T,x,B,J,F);return U==null?x:typeof U!=typeof x||U!==x?U:this.options.trimValues||x.trim()===x?O(x,this.options.parseTagValue,this.options.numberParseOptions):x}}function c(x){if(this.options.removeNSPrefix){const T=x.split(":"),B=x.charAt(0)==="/"?"/":"";if(T[0]==="xmlns")return"";T.length===2&&(x=B+T[1])}return x}const f=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function h(x,T,B){if(this.options.ignoreAttributes!==!0&&typeof x=="string"){const k=s.getAllMatches(x,f),J=k.length,F={};for(let P=0;P<J;P++){const U=this.resolveNameSpace(k[P][1]);if(this.ignoreAttributesFn(U,T))continue;let re=k[P][4],X=this.options.attributeNamePrefix+U;if(U.length)if(this.options.transformAttributeName&&(X=this.options.transformAttributeName(X)),X==="__proto__"&&(X="#__proto__"),re!==void 0){this.options.trimValues&&(re=re.trim()),re=this.replaceEntitiesValue(re);const K=this.options.attributeValueProcessor(U,re,T);F[X]=K==null?re:typeof K!=typeof re||K!==re?K:O(re,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(F[X]=!0)}if(!Object.keys(F).length)return;if(this.options.attributesGroupName){const P={};return P[this.options.attributesGroupName]=F,P}return F}}const v=function(x){x=x.replace(/\r\n?/g,`
`);const T=new a("!xml");let B=T,k="",J="";for(let F=0;F<x.length;F++)if(x[F]==="<")if(x[F+1]==="/"){const P=p(x,">",F,"Closing Tag is not closed.");let U=x.substring(F+2,P).trim();if(this.options.removeNSPrefix){const K=U.indexOf(":");K!==-1&&(U=U.substr(K+1))}this.options.transformTagName&&(U=this.options.transformTagName(U)),B&&(k=this.saveTextToParentTag(k,B,J));const re=J.substring(J.lastIndexOf(".")+1);if(U&&this.options.unpairedTags.indexOf(U)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${U}>`);let X=0;re&&this.options.unpairedTags.indexOf(re)!==-1?(X=J.lastIndexOf(".",J.lastIndexOf(".")-1),this.tagsNodeStack.pop()):X=J.lastIndexOf("."),J=J.substring(0,X),B=this.tagsNodeStack.pop(),k="",F=P}else if(x[F+1]==="?"){let P=w(x,F,!1,"?>");if(!P)throw new Error("Pi Tag is not closed.");if(k=this.saveTextToParentTag(k,B,J),!(this.options.ignoreDeclaration&&P.tagName==="?xml"||this.options.ignorePiTags)){const U=new a(P.tagName);U.add(this.options.textNodeName,""),P.tagName!==P.tagExp&&P.attrExpPresent&&(U[":@"]=this.buildAttributesMap(P.tagExp,J,P.tagName)),this.addChild(B,U,J)}F=P.closeIndex+1}else if(x.substr(F+1,3)==="!--"){const P=p(x,"-->",F+4,"Comment is not closed.");if(this.options.commentPropName){const U=x.substring(F+4,P-2);k=this.saveTextToParentTag(k,B,J),B.add(this.options.commentPropName,[{[this.options.textNodeName]:U}])}F=P}else if(x.substr(F+1,2)==="!D"){const P=n(x,F);this.docTypeEntities=P.entities,F=P.i}else if(x.substr(F+1,2)==="!["){const P=p(x,"]]>",F,"CDATA is not closed.")-2,U=x.substring(F+9,P);k=this.saveTextToParentTag(k,B,J);let re=this.parseTextData(U,B.tagname,J,!0,!1,!0,!0);re==null&&(re=""),this.options.cdataPropName?B.add(this.options.cdataPropName,[{[this.options.textNodeName]:U}]):B.add(this.options.textNodeName,re),F=P+2}else{let P=w(x,F,this.options.removeNSPrefix),U=P.tagName;const re=P.rawTagName;let X=P.tagExp,K=P.attrExpPresent,W=P.closeIndex;this.options.transformTagName&&(U=this.options.transformTagName(U)),B&&k&&B.tagname!=="!xml"&&(k=this.saveTextToParentTag(k,B,J,!1));const ne=B;if(ne&&this.options.unpairedTags.indexOf(ne.tagname)!==-1&&(B=this.tagsNodeStack.pop(),J=J.substring(0,J.lastIndexOf("."))),U!==T.tagname&&(J+=J?"."+U:U),this.isItStopNode(this.options.stopNodes,J,U)){let se="";if(X.length>0&&X.lastIndexOf("/")===X.length-1)U[U.length-1]==="/"?(U=U.substr(0,U.length-1),J=J.substr(0,J.length-1),X=U):X=X.substr(0,X.length-1),F=P.closeIndex;else if(this.options.unpairedTags.indexOf(U)!==-1)F=P.closeIndex;else{const _=this.readStopNodeData(x,re,W+1);if(!_)throw new Error(`Unexpected end of ${re}`);F=_.i,se=_.tagContent}const Z=new a(U);U!==X&&K&&(Z[":@"]=this.buildAttributesMap(X,J,U)),se&&(se=this.parseTextData(se,U,J,!0,K,!0,!0)),J=J.substr(0,J.lastIndexOf(".")),Z.add(this.options.textNodeName,se),this.addChild(B,Z,J)}else{if(X.length>0&&X.lastIndexOf("/")===X.length-1){U[U.length-1]==="/"?(U=U.substr(0,U.length-1),J=J.substr(0,J.length-1),X=U):X=X.substr(0,X.length-1),this.options.transformTagName&&(U=this.options.transformTagName(U));const se=new a(U);U!==X&&K&&(se[":@"]=this.buildAttributesMap(X,J,U)),this.addChild(B,se,J),J=J.substr(0,J.lastIndexOf("."))}else{const se=new a(U);this.tagsNodeStack.push(B),U!==X&&K&&(se[":@"]=this.buildAttributesMap(X,J,U)),this.addChild(B,se,J),B=se}k="",F=W}}else k+=x[F];return T.child};function d(x,T,B){const k=this.options.updateTag(T.tagname,B,T[":@"]);k===!1||(typeof k=="string"&&(T.tagname=k),x.addChild(T))}const A=function(x){if(this.options.processEntities){for(let T in this.docTypeEntities){const B=this.docTypeEntities[T];x=x.replace(B.regx,B.val)}for(let T in this.lastEntities){const B=this.lastEntities[T];x=x.replace(B.regex,B.val)}if(this.options.htmlEntities)for(let T in this.htmlEntities){const B=this.htmlEntities[T];x=x.replace(B.regex,B.val)}x=x.replace(this.ampEntity.regex,this.ampEntity.val)}return x};function b(x,T,B,k){return x&&(k===void 0&&(k=Object.keys(T.child).length===0),(x=this.parseTextData(x,T.tagname,B,!1,!!T[":@"]&&Object.keys(T[":@"]).length!==0,k))!==void 0&&x!==""&&T.add(this.options.textNodeName,x),x=""),x}function I(x,T,B){const k="*."+B;for(const J in x){const F=x[J];if(k===F||T===F)return!0}return!1}function p(x,T,B,k){const J=x.indexOf(T,B);if(J===-1)throw new Error(k);return J+T.length-1}function w(x,T,B){const k=function(K,W){let ne,se=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",Z="";for(let _=W;_<K.length;_++){let z=K[_];if(ne)z===ne&&(ne="");else if(z==='"'||z==="'")ne=z;else if(z===se[0]){if(!se[1])return{data:Z,index:_};if(K[_+1]===se[1])return{data:Z,index:_}}else z==="	"&&(z=" ");Z+=z}}(x,T+1,arguments.length>3&&arguments[3]!==void 0?arguments[3]:">");if(!k)return;let J=k.data;const F=k.index,P=J.search(/\s/);let U=J,re=!0;P!==-1&&(U=J.substring(0,P),J=J.substring(P+1).trimStart());const X=U;if(B){const K=U.indexOf(":");K!==-1&&(U=U.substr(K+1),re=U!==k.data.substr(K+1))}return{tagName:U,tagExp:J,closeIndex:F,attrExpPresent:re,rawTagName:X}}function E(x,T,B){const k=B;let J=1;for(;B<x.length;B++)if(x[B]==="<")if(x[B+1]==="/"){const F=p(x,">",B,`${T} is not closed`);if(x.substring(B+2,F).trim()===T&&(J--,J===0))return{tagContent:x.substring(k,B),i:F};B=F}else if(x[B+1]==="?")B=p(x,"?>",B+1,"StopNode is not closed.");else if(x.substr(B+1,3)==="!--")B=p(x,"-->",B+3,"StopNode is not closed.");else if(x.substr(B+1,2)==="![")B=p(x,"]]>",B,"StopNode is not closed.")-2;else{const F=w(x,B,">");F&&((F&&F.tagName)===T&&F.tagExp[F.tagExp.length-1]!=="/"&&J++,B=F.closeIndex)}}function O(x,T,B){if(T&&typeof x=="string"){const k=x.trim();return k==="true"||k!=="false"&&i(x,B)}return s.isExist(x)?x:""}r.exports=class{constructor(x){this.options=x,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(T,B)=>String.fromCharCode(Number.parseInt(B,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(T,B)=>String.fromCharCode(Number.parseInt(B,16))}},this.addExternalEntities=l,this.parseXml=v,this.parseTextData=u,this.resolveNameSpace=c,this.buildAttributesMap=h,this.isItStopNode=I,this.replaceEntitiesValue=A,this.readStopNodeData=E,this.saveTextToParentTag=b,this.addChild=d,this.ignoreAttributesFn=o(this.options.ignoreAttributes)}}},338:(r,e,t)=>{const{buildOptions:s}=t(63),a=t(299),{prettify:n}=t(728),i=t(31);r.exports=class{constructor(o){this.externalEntities={},this.options=s(o)}parse(o,l){if(typeof o!="string"){if(!o.toString)throw new Error("XML data is accepted in String or Bytes[] form.");o=o.toString()}if(l){l===!0&&(l={});const f=i.validate(o,l);if(f!==!0)throw Error(`${f.err.msg}:${f.err.line}:${f.err.col}`)}const u=new a(this.options);u.addExternalEntities(this.externalEntities);const c=u.parseXml(o);return this.options.preserveOrder||c===void 0?c:n(c,this.options)}addEntity(o,l){if(l.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(o.indexOf("&")!==-1||o.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(l==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[o]=l}}},728:(r,e)=>{function t(i,o,l){let u;const c={};for(let f=0;f<i.length;f++){const h=i[f],v=s(h);let d="";if(d=l===void 0?v:l+"."+v,v===o.textNodeName)u===void 0?u=h[v]:u+=""+h[v];else{if(v===void 0)continue;if(h[v]){let A=t(h[v],o,d);const b=n(A,o);h[":@"]?a(A,h[":@"],d,o):Object.keys(A).length!==1||A[o.textNodeName]===void 0||o.alwaysCreateTextNode?Object.keys(A).length===0&&(o.alwaysCreateTextNode?A[o.textNodeName]="":A=""):A=A[o.textNodeName],c[v]!==void 0&&c.hasOwnProperty(v)?(Array.isArray(c[v])||(c[v]=[c[v]]),c[v].push(A)):o.isArray(v,d,b)?c[v]=[A]:c[v]=A}}}return typeof u=="string"?u.length>0&&(c[o.textNodeName]=u):u!==void 0&&(c[o.textNodeName]=u),c}function s(i){const o=Object.keys(i);for(let l=0;l<o.length;l++){const u=o[l];if(u!==":@")return u}}function a(i,o,l,u){if(o){const c=Object.keys(o),f=c.length;for(let h=0;h<f;h++){const v=c[h];u.isArray(v,l+"."+v,!0,!0)?i[v]=[o[v]]:i[v]=o[v]}}}function n(i,o){const{textNodeName:l}=o,u=Object.keys(i).length;return u===0||!(u!==1||!i[l]&&typeof i[l]!="boolean"&&i[l]!==0)}e.prettify=function(i,o){return t(i,o)}},365:r=>{r.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},135:r=>{function e(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}r.exports=function(t){return t!=null&&(e(t)||function(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&e(s.slice(0,0))}(t)||!!t._isBuffer)}},542:(r,e,t)=>{(function(){var s=t(298),a=t(526).utf8,n=t(135),i=t(526).bin,o=function(l,u){l.constructor==String?l=u&&u.encoding==="binary"?i.stringToBytes(l):a.stringToBytes(l):n(l)?l=Array.prototype.slice.call(l,0):Array.isArray(l)||l.constructor===Uint8Array||(l=l.toString());for(var c=s.bytesToWords(l),f=8*l.length,h=1732584193,v=-271733879,d=-1732584194,A=271733878,b=0;b<c.length;b++)c[b]=16711935&(c[b]<<8|c[b]>>>24)|4278255360&(c[b]<<24|c[b]>>>8);c[f>>>5]|=128<<f%32,c[14+(f+64>>>9<<4)]=f;var I=o._ff,p=o._gg,w=o._hh,E=o._ii;for(b=0;b<c.length;b+=16){var O=h,x=v,T=d,B=A;h=I(h,v,d,A,c[b+0],7,-680876936),A=I(A,h,v,d,c[b+1],12,-389564586),d=I(d,A,h,v,c[b+2],17,606105819),v=I(v,d,A,h,c[b+3],22,-1044525330),h=I(h,v,d,A,c[b+4],7,-176418897),A=I(A,h,v,d,c[b+5],12,1200080426),d=I(d,A,h,v,c[b+6],17,-1473231341),v=I(v,d,A,h,c[b+7],22,-45705983),h=I(h,v,d,A,c[b+8],7,1770035416),A=I(A,h,v,d,c[b+9],12,-1958414417),d=I(d,A,h,v,c[b+10],17,-42063),v=I(v,d,A,h,c[b+11],22,-1990404162),h=I(h,v,d,A,c[b+12],7,1804603682),A=I(A,h,v,d,c[b+13],12,-40341101),d=I(d,A,h,v,c[b+14],17,-1502002290),h=p(h,v=I(v,d,A,h,c[b+15],22,1236535329),d,A,c[b+1],5,-165796510),A=p(A,h,v,d,c[b+6],9,-1069501632),d=p(d,A,h,v,c[b+11],14,643717713),v=p(v,d,A,h,c[b+0],20,-373897302),h=p(h,v,d,A,c[b+5],5,-701558691),A=p(A,h,v,d,c[b+10],9,38016083),d=p(d,A,h,v,c[b+15],14,-660478335),v=p(v,d,A,h,c[b+4],20,-405537848),h=p(h,v,d,A,c[b+9],5,568446438),A=p(A,h,v,d,c[b+14],9,-1019803690),d=p(d,A,h,v,c[b+3],14,-187363961),v=p(v,d,A,h,c[b+8],20,1163531501),h=p(h,v,d,A,c[b+13],5,-1444681467),A=p(A,h,v,d,c[b+2],9,-51403784),d=p(d,A,h,v,c[b+7],14,1735328473),h=w(h,v=p(v,d,A,h,c[b+12],20,-1926607734),d,A,c[b+5],4,-378558),A=w(A,h,v,d,c[b+8],11,-2022574463),d=w(d,A,h,v,c[b+11],16,1839030562),v=w(v,d,A,h,c[b+14],23,-35309556),h=w(h,v,d,A,c[b+1],4,-1530992060),A=w(A,h,v,d,c[b+4],11,1272893353),d=w(d,A,h,v,c[b+7],16,-155497632),v=w(v,d,A,h,c[b+10],23,-1094730640),h=w(h,v,d,A,c[b+13],4,681279174),A=w(A,h,v,d,c[b+0],11,-358537222),d=w(d,A,h,v,c[b+3],16,-722521979),v=w(v,d,A,h,c[b+6],23,76029189),h=w(h,v,d,A,c[b+9],4,-640364487),A=w(A,h,v,d,c[b+12],11,-421815835),d=w(d,A,h,v,c[b+15],16,530742520),h=E(h,v=w(v,d,A,h,c[b+2],23,-995338651),d,A,c[b+0],6,-198630844),A=E(A,h,v,d,c[b+7],10,1126891415),d=E(d,A,h,v,c[b+14],15,-1416354905),v=E(v,d,A,h,c[b+5],21,-57434055),h=E(h,v,d,A,c[b+12],6,1700485571),A=E(A,h,v,d,c[b+3],10,-1894986606),d=E(d,A,h,v,c[b+10],15,-1051523),v=E(v,d,A,h,c[b+1],21,-2054922799),h=E(h,v,d,A,c[b+8],6,1873313359),A=E(A,h,v,d,c[b+15],10,-30611744),d=E(d,A,h,v,c[b+6],15,-1560198380),v=E(v,d,A,h,c[b+13],21,1309151649),h=E(h,v,d,A,c[b+4],6,-145523070),A=E(A,h,v,d,c[b+11],10,-1120210379),d=E(d,A,h,v,c[b+2],15,718787259),v=E(v,d,A,h,c[b+9],21,-343485551),h=h+O>>>0,v=v+x>>>0,d=d+T>>>0,A=A+B>>>0}return s.endian([h,v,d,A])};o._ff=function(l,u,c,f,h,v,d){var A=l+(u&c|~u&f)+(h>>>0)+d;return(A<<v|A>>>32-v)+u},o._gg=function(l,u,c,f,h,v,d){var A=l+(u&f|c&~f)+(h>>>0)+d;return(A<<v|A>>>32-v)+u},o._hh=function(l,u,c,f,h,v,d){var A=l+(u^c^f)+(h>>>0)+d;return(A<<v|A>>>32-v)+u},o._ii=function(l,u,c,f,h,v,d){var A=l+(c^(u|~f))+(h>>>0)+d;return(A<<v|A>>>32-v)+u},o._blocksize=16,o._digestsize=16,r.exports=function(l,u){if(l==null)throw new Error("Illegal argument "+l);var c=s.wordsToBytes(o(l,u));return u&&u.asBytes?c:u&&u.asString?i.bytesToString(c):s.bytesToHex(c)}})()},285:(r,e,t)=>{var s=t(2);r.exports=function(I){return I?(I.substr(0,2)==="{}"&&(I="\\{\\}"+I.substr(2)),b(function(p){return p.split("\\\\").join(a).split("\\{").join(n).split("\\}").join(i).split("\\,").join(o).split("\\.").join(l)}(I),!0).map(c)):[]};var a="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",i="\0CLOSE"+Math.random()+"\0",o="\0COMMA"+Math.random()+"\0",l="\0PERIOD"+Math.random()+"\0";function u(I){return parseInt(I,10)==I?parseInt(I,10):I.charCodeAt(0)}function c(I){return I.split(a).join("\\").split(n).join("{").split(i).join("}").split(o).join(",").split(l).join(".")}function f(I){if(!I)return[""];var p=[],w=s("{","}",I);if(!w)return I.split(",");var E=w.pre,O=w.body,x=w.post,T=E.split(",");T[T.length-1]+="{"+O+"}";var B=f(x);return x.length&&(T[T.length-1]+=B.shift(),T.push.apply(T,B)),p.push.apply(p,T),p}function h(I){return"{"+I+"}"}function v(I){return/^-?0\d/.test(I)}function d(I,p){return I<=p}function A(I,p){return I>=p}function b(I,p){var w=[],E=s("{","}",I);if(!E)return[I];var O=E.pre,x=E.post.length?b(E.post,!1):[""];if(/\$$/.test(E.pre))for(var T=0;T<x.length;T++){var B=O+"{"+E.body+"}"+x[T];w.push(B)}else{var k,J,F=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(E.body),P=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(E.body),U=F||P,re=E.body.indexOf(",")>=0;if(!U&&!re)return E.post.match(/,.*\}/)?b(I=E.pre+"{"+E.body+i+E.post):[I];if(U)k=E.body.split(/\.\./);else if((k=f(E.body)).length===1&&(k=b(k[0],!1).map(h)).length===1)return x.map(function(fe){return E.pre+k[0]+fe});if(U){var X=u(k[0]),K=u(k[1]),W=Math.max(k[0].length,k[1].length),ne=k.length==3?Math.abs(u(k[2])):1,se=d;K<X&&(ne*=-1,se=A);var Z=k.some(v);J=[];for(var _=X;se(_,K);_+=ne){var z;if(P)(z=String.fromCharCode(_))==="\\"&&(z="");else if(z=String(_),Z){var oe=W-z.length;if(oe>0){var ce=new Array(oe+1).join("0");z=_<0?"-"+ce+z.slice(1):ce+z}}J.push(z)}}else{J=[];for(var ue=0;ue<k.length;ue++)J.push.apply(J,b(k[ue],!1))}for(ue=0;ue<J.length;ue++)for(T=0;T<x.length;T++)B=O+J[ue]+x[T],(!p||U||B)&&w.push(B)}return w}},829:r=>{function e(u){return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},e(u)}function t(u){var c=typeof Map=="function"?new Map:void 0;return t=function(f){if(f===null||(h=f,Function.toString.call(h).indexOf("[native code]")===-1))return f;var h;if(typeof f!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(f))return c.get(f);c.set(f,v)}function v(){return s(f,arguments,n(this).constructor)}return v.prototype=Object.create(f.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),a(v,f)},t(u)}function s(u,c,f){return s=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}()?Reflect.construct:function(h,v,d){var A=[null];A.push.apply(A,v);var b=new(Function.bind.apply(h,A));return d&&a(b,d.prototype),b},s.apply(null,arguments)}function a(u,c){return a=Object.setPrototypeOf||function(f,h){return f.__proto__=h,f},a(u,c)}function n(u){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},n(u)}var i=function(u){function c(f){var h;return function(v,d){if(!(v instanceof d))throw new TypeError("Cannot call a class as a function")}(this,c),(h=function(v,d){return!d||e(d)!=="object"&&typeof d!="function"?function(A){if(A===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A}(v):d}(this,n(c).call(this,f))).name="ObjectPrototypeMutationError",h}return function(f,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(h&&h.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),h&&a(f,h)}(c,u),c}(t(Error));function o(u,c){for(var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},h=c.split("."),v=h.length,d=function(I){var p=h[I];if(!u)return{v:void 0};if(p==="+"){if(Array.isArray(u))return{v:u.map(function(E,O){var x=h.slice(I+1);return x.length>0?o(E,x.join("."),f):f(u,O,h,I)})};var w=h.slice(0,I).join(".");throw new Error("Object at wildcard (".concat(w,") is not an array"))}u=f(u,p,h,I)},A=0;A<v;A++){var b=d(A);if(e(b)==="object")return b.v}return u}function l(u,c){return u.length===c+1}r.exports={set:function(u,c,f){if(e(u)!="object"||u===null||c===void 0)return u;if(typeof c=="number")return u[c]=f,u[c];try{return o(u,c,function(h,v,d,A){if(h===Reflect.getPrototypeOf({}))throw new i("Attempting to mutate Object.prototype");if(!h[v]){var b=Number.isInteger(Number(d[A+1])),I=d[A+1]==="+";h[v]=b||I?[]:{}}return l(d,A)&&(h[v]=f),h[v]})}catch(h){if(h instanceof i)throw h;return u}},get:function(u,c){if(e(u)!="object"||u===null||c===void 0)return u;if(typeof c=="number")return u[c];try{return o(u,c,function(f,h){return f[h]})}catch{return u}},has:function(u,c){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e(u)!="object"||u===null||c===void 0)return!1;if(typeof c=="number")return c in u;try{var h=!1;return o(u,c,function(v,d,A,b){if(!l(A,b))return v&&v[d];h=f.own?v.hasOwnProperty(d):d in v}),h}catch{return!1}},hasOwn:function(u,c,f){return this.has(u,c,f||{own:!0})},isIn:function(u,c,f){var h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(e(u)!="object"||u===null||c===void 0)return!1;try{var v=!1,d=!1;return o(u,c,function(A,b,I,p){return v=v||A===f||!!A&&A[b]===f,d=l(I,p)&&e(A)==="object"&&b in A,A&&A[b]}),h.validPath?v&&d:v}catch{return!1}},ObjectPrototypeMutationError:i}},47:(r,e,t)=>{var s=t(410),a=function(u){return typeof u=="string"};function n(u,c){for(var f=[],h=0;h<u.length;h++){var v=u[h];v&&v!=="."&&(v===".."?f.length&&f[f.length-1]!==".."?f.pop():c&&f.push(".."):f.push(v))}return f}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o={};function l(u){return i.exec(u).slice(1)}o.resolve=function(){for(var u="",c=!1,f=arguments.length-1;f>=-1&&!c;f--){var h=f>=0?arguments[f]:ct.cwd();if(!a(h))throw new TypeError("Arguments to path.resolve must be strings");h&&(u=h+"/"+u,c=h.charAt(0)==="/")}return(c?"/":"")+(u=n(u.split("/"),!c).join("/"))||"."},o.normalize=function(u){var c=o.isAbsolute(u),f=u.substr(-1)==="/";return(u=n(u.split("/"),!c).join("/"))||c||(u="."),u&&f&&(u+="/"),(c?"/":"")+u},o.isAbsolute=function(u){return u.charAt(0)==="/"},o.join=function(){for(var u="",c=0;c<arguments.length;c++){var f=arguments[c];if(!a(f))throw new TypeError("Arguments to path.join must be strings");f&&(u+=u?"/"+f:f)}return o.normalize(u)},o.relative=function(u,c){function f(p){for(var w=0;w<p.length&&p[w]==="";w++);for(var E=p.length-1;E>=0&&p[E]==="";E--);return w>E?[]:p.slice(w,E+1)}u=o.resolve(u).substr(1),c=o.resolve(c).substr(1);for(var h=f(u.split("/")),v=f(c.split("/")),d=Math.min(h.length,v.length),A=d,b=0;b<d;b++)if(h[b]!==v[b]){A=b;break}var I=[];for(b=A;b<h.length;b++)I.push("..");return(I=I.concat(v.slice(A))).join("/")},o._makeLong=function(u){return u},o.dirname=function(u){var c=l(u),f=c[0],h=c[1];return f||h?(h&&(h=h.substr(0,h.length-1)),f+h):"."},o.basename=function(u,c){var f=l(u)[2];return c&&f.substr(-1*c.length)===c&&(f=f.substr(0,f.length-c.length)),f},o.extname=function(u){return l(u)[3]},o.format=function(u){if(!s.isObject(u))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof u);var c=u.root||"";if(!a(c))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof u.root);return(u.dir?u.dir+o.sep:"")+(u.base||"")},o.parse=function(u){if(!a(u))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof u);var c=l(u);if(!c||c.length!==4)throw new TypeError("Invalid path '"+u+"'");return c[1]=c[1]||"",c[2]=c[2]||"",c[3]=c[3]||"",{root:c[0],dir:c[0]+c[1].slice(0,c[1].length-1),base:c[2],ext:c[3],name:c[2].slice(0,c[2].length-c[3].length)}},o.sep="/",o.delimiter=":",r.exports=o},647:(r,e)=>{var t=Object.prototype.hasOwnProperty;function s(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return null}}function a(n){try{return encodeURIComponent(n)}catch{return null}}e.stringify=function(n,i){i=i||"";var o,l,u=[];for(l in typeof i!="string"&&(i="?"),n)if(t.call(n,l)){if((o=n[l])||o!=null&&!isNaN(o)||(o=""),l=a(l),o=a(o),l===null||o===null)continue;u.push(l+"="+o)}return u.length?i+u.join("&"):""},e.parse=function(n){for(var i,o=/([^=?#&]+)=?([^&]*)/g,l={};i=o.exec(n);){var u=s(i[1]),c=s(i[2]);u===null||c===null||u in l||(l[u]=c)}return l}},670:r=>{r.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}},494:r=>{const e=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const s={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};r.exports=function(a){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n=Object.assign({},s,n),!a||typeof a!="string")return a;let i=a.trim();if(n.skipLike!==void 0&&n.skipLike.test(i))return a;if(n.hex&&e.test(i))return Number.parseInt(i,16);{const l=t.exec(i);if(l){const u=l[1],c=l[2];let f=((o=l[3])&&o.indexOf(".")!==-1&&((o=o.replace(/0+$/,""))==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substr(0,o.length-1))),o);const h=l[4]||l[6];if(!n.leadingZeros&&c.length>0&&u&&i[2]!=="."||!n.leadingZeros&&c.length>0&&!u&&i[1]!==".")return a;{const v=Number(i),d=""+v;return d.search(/[eE]/)!==-1||h?n.eNotation?v:a:i.indexOf(".")!==-1?d==="0"&&f===""||d===f||u&&d==="-"+f?v:a:c?f===d||u+f===d?v:a:i===d||i===u+d?v:a}}return a}var o}},737:(r,e,t)=>{var s=t(670),a=t(647),n=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,i=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,l=/:\d+$/,u=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,c=/^[a-zA-Z]:/;function f(p){return(p||"").toString().replace(n,"")}var h=[["#","hash"],["?","query"],function(p,w){return A(w.protocol)?p.replace(/\\/g,"/"):p},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],v={hash:1,query:1};function d(p){var w,E=(typeof window<"u"?window:typeof qt<"u"?qt:typeof self<"u"?self:{}).location||{},O={},x=typeof(p=p||E);if(p.protocol==="blob:")O=new I(unescape(p.pathname),{});else if(x==="string")for(w in O=new I(p,{}),v)delete O[w];else if(x==="object"){for(w in p)w in v||(O[w]=p[w]);O.slashes===void 0&&(O.slashes=o.test(p.href))}return O}function A(p){return p==="file:"||p==="ftp:"||p==="http:"||p==="https:"||p==="ws:"||p==="wss:"}function b(p,w){p=(p=f(p)).replace(i,""),w=w||{};var E,O=u.exec(p),x=O[1]?O[1].toLowerCase():"",T=!!O[2],B=!!O[3],k=0;return T?B?(E=O[2]+O[3]+O[4],k=O[2].length+O[3].length):(E=O[2]+O[4],k=O[2].length):B?(E=O[3]+O[4],k=O[3].length):E=O[4],x==="file:"?k>=2&&(E=E.slice(2)):A(x)?E=O[4]:x?T&&(E=E.slice(2)):k>=2&&A(w.protocol)&&(E=O[4]),{protocol:x,slashes:T||A(x),slashesCount:k,rest:E}}function I(p,w,E){if(p=(p=f(p)).replace(i,""),!(this instanceof I))return new I(p,w,E);var O,x,T,B,k,J,F=h.slice(),P=typeof w,U=this,re=0;for(P!=="object"&&P!=="string"&&(E=w,w=null),E&&typeof E!="function"&&(E=a.parse),O=!(x=b(p||"",w=d(w))).protocol&&!x.slashes,U.slashes=x.slashes||O&&w.slashes,U.protocol=x.protocol||w.protocol||"",p=x.rest,(x.protocol==="file:"&&(x.slashesCount!==2||c.test(p))||!x.slashes&&(x.protocol||x.slashesCount<2||!A(U.protocol)))&&(F[3]=[/(.*)/,"pathname"]);re<F.length;re++)typeof(B=F[re])!="function"?(T=B[0],J=B[1],T!=T?U[J]=p:typeof T=="string"?~(k=T==="@"?p.lastIndexOf(T):p.indexOf(T))&&(typeof B[2]=="number"?(U[J]=p.slice(0,k),p=p.slice(k+B[2])):(U[J]=p.slice(k),p=p.slice(0,k))):(k=T.exec(p))&&(U[J]=k[1],p=p.slice(0,k.index)),U[J]=U[J]||O&&B[3]&&w[J]||"",B[4]&&(U[J]=U[J].toLowerCase())):p=B(p,U);E&&(U.query=E(U.query)),O&&w.slashes&&U.pathname.charAt(0)!=="/"&&(U.pathname!==""||w.pathname!=="")&&(U.pathname=function(X,K){if(X==="")return K;for(var W=(K||"/").split("/").slice(0,-1).concat(X.split("/")),ne=W.length,se=W[ne-1],Z=!1,_=0;ne--;)W[ne]==="."?W.splice(ne,1):W[ne]===".."?(W.splice(ne,1),_++):_&&(ne===0&&(Z=!0),W.splice(ne,1),_--);return Z&&W.unshift(""),se!=="."&&se!==".."||W.push(""),W.join("/")}(U.pathname,w.pathname)),U.pathname.charAt(0)!=="/"&&A(U.protocol)&&(U.pathname="/"+U.pathname),s(U.port,U.protocol)||(U.host=U.hostname,U.port=""),U.username=U.password="",U.auth&&(~(k=U.auth.indexOf(":"))?(U.username=U.auth.slice(0,k),U.username=encodeURIComponent(decodeURIComponent(U.username)),U.password=U.auth.slice(k+1),U.password=encodeURIComponent(decodeURIComponent(U.password))):U.username=encodeURIComponent(decodeURIComponent(U.auth)),U.auth=U.password?U.username+":"+U.password:U.username),U.origin=U.protocol!=="file:"&&A(U.protocol)&&U.host?U.protocol+"//"+U.host:"null",U.href=U.toString()}I.prototype={set:function(p,w,E){var O=this;switch(p){case"query":typeof w=="string"&&w.length&&(w=(E||a.parse)(w)),O[p]=w;break;case"port":O[p]=w,s(w,O.protocol)?w&&(O.host=O.hostname+":"+w):(O.host=O.hostname,O[p]="");break;case"hostname":O[p]=w,O.port&&(w+=":"+O.port),O.host=w;break;case"host":O[p]=w,l.test(w)?(w=w.split(":"),O.port=w.pop(),O.hostname=w.join(":")):(O.hostname=w,O.port="");break;case"protocol":O.protocol=w.toLowerCase(),O.slashes=!E;break;case"pathname":case"hash":if(w){var x=p==="pathname"?"/":"#";O[p]=w.charAt(0)!==x?x+w:w}else O[p]=w;break;case"username":case"password":O[p]=encodeURIComponent(w);break;case"auth":var T=w.indexOf(":");~T?(O.username=w.slice(0,T),O.username=encodeURIComponent(decodeURIComponent(O.username)),O.password=w.slice(T+1),O.password=encodeURIComponent(decodeURIComponent(O.password))):O.username=encodeURIComponent(decodeURIComponent(w))}for(var B=0;B<h.length;B++){var k=h[B];k[4]&&(O[k[1]]=O[k[1]].toLowerCase())}return O.auth=O.password?O.username+":"+O.password:O.username,O.origin=O.protocol!=="file:"&&A(O.protocol)&&O.host?O.protocol+"//"+O.host:"null",O.href=O.toString(),O},toString:function(p){p&&typeof p=="function"||(p=a.stringify);var w,E=this,O=E.host,x=E.protocol;x&&x.charAt(x.length-1)!==":"&&(x+=":");var T=x+(E.protocol&&E.slashes||A(E.protocol)?"//":"");return E.username?(T+=E.username,E.password&&(T+=":"+E.password),T+="@"):E.password?(T+=":"+E.password,T+="@"):E.protocol!=="file:"&&A(E.protocol)&&!O&&E.pathname!=="/"&&(T+="@"),(O[O.length-1]===":"||l.test(E.hostname)&&!E.port)&&(O+=":"),T+=O+E.pathname,(w=typeof E.query=="object"?p(E.query):E.query)&&(T+=w.charAt(0)!=="?"?"?"+w:w),E.hash&&(T+=E.hash),T}},I.extractProtocol=b,I.location=d,I.trimLeft=f,I.qs=a,r.exports=I},410:()=>{},388:()=>{},805:()=>{},345:()=>{},800:()=>{}},Qd={};function Pe(r){var e=Qd[r];if(e!==void 0)return e.exports;var t=Qd[r]={id:r,loaded:!1,exports:{}};return z0[r].call(t.exports,t,t.exports,Pe),t.loaded=!0,t.exports}Pe.n=r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return Pe.d(e,{a:e}),e},Pe.d=(r,e)=>{for(var t in e)Pe.o(e,t)&&!Pe.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},Pe.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),Pe.nmd=r=>(r.paths=[],r.children||(r.children=[]),r);var gs={};Pe.d(gs,{hT:()=>Lt,O4:()=>gr,Kd:()=>a1,YK:()=>n1,UU:()=>hv,Gu:()=>Uy,ky:()=>Wy,h4:()=>Xl,ch:()=>Ym,hq:()=>ui,i5:()=>_y});var X0=Pe(737),Y0=Pe.n(X0);function ff(r){if(!vp(r))throw new Error("Parameter was not an error")}function vp(r){return!!r&&typeof r=="object"&&(e=r,Object.prototype.toString.call(e)==="[object Error]")||r instanceof Error;var e}class jt extends Error{constructor(e,t){const s=[...arguments],{options:a,shortMessage:n}=function(o){let l,u="";if(o.length===0)l={};else if(vp(o[0]))l={cause:o[0]},u=o.slice(1).join(" ")||"";else if(o[0]&&typeof o[0]=="object")l=Object.assign({},o[0]),u=o.slice(1).join(" ")||"";else{if(typeof o[0]!="string")throw new Error("Invalid arguments passed to Layerr");l={},u=u=o.join(" ")||""}return{options:l,shortMessage:u}}(s);let i=n;if(a.cause&&(i=`${i}: ${a.cause.message}`),super(i),this.message=i,a.name&&typeof a.name=="string"?this.name=a.name:this.name="Layerr",a.cause&&Object.defineProperty(this,"_cause",{value:a.cause}),Object.defineProperty(this,"_info",{value:{}}),a.info&&typeof a.info=="object"&&Object.assign(this._info,a.info),Error.captureStackTrace){const o=a.constructorOpt||this.constructor;Error.captureStackTrace(this,o)}}static cause(e){return ff(e),e._cause&&vp(e._cause)?e._cause:null}static fullStack(e){ff(e);const t=jt.cause(e);return t?`${e.stack}
caused by: ${jt.fullStack(t)}`:e.stack??""}static info(e){ff(e);const t={},s=jt.cause(e);return s&&Object.assign(t,jt.info(s)),e._info&&Object.assign(t,e._info),t}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e=`${e}: ${this.message}`),e}}var Q0=Pe(47),Cm=Pe.n(Q0);const Zd="__PATH_SEPARATOR_POSIX__",eg="__PATH_SEPARATOR_WINDOWS__";function Fe(r){try{const e=r.replace(/\//g,Zd).replace(/\\\\/g,eg);return encodeURIComponent(e).split(eg).join("\\\\").split(Zd).join("/")}catch(e){throw new jt(e,"Failed encoding path")}}function tg(r){return r.startsWith("/")?r:"/"+r}function jl(r){let e=r;return e[0]!=="/"&&(e="/"+e),/^.+\/$/.test(e)&&(e=e.substr(0,e.length-1)),e}function Z0(r){let e=new(Y0())(r).pathname;return e.length<=0&&(e="/"),jl(e)}function qe(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return function(){return function(s){var a=[];if(s.length===0)return"";if(typeof s[0]!="string")throw new TypeError("Url must be a string. Received "+s[0]);if(s[0].match(/^[^/:]+:\/*$/)&&s.length>1){var n=s.shift();s[0]=n+s[0]}s[0].match(/^file:\/\/\//)?s[0]=s[0].replace(/^([^/:]+):\/*/,"$1:///"):s[0]=s[0].replace(/^([^/:]+):\/*/,"$1://");for(var i=0;i<s.length;i++){var o=s[i];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(i>0&&(o=o.replace(/^[\/]+/,"")),o=i<s.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),a.push(o))}var l=a.join("/"),u=(l=l.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return u.shift()+(u.length>0?"?":"")+u.join("&")}(typeof arguments[0]=="object"?arguments[0]:[].slice.call(arguments))}(e.reduce((s,a,n)=>((n===0||a!=="/"||a==="/"&&s[s.length-1]!=="/")&&s.push(a),s),[]))}var e1=Pe(542),yu=Pe.n(e1);const t1="abcdef0123456789";function sg(r,e){const t=r.url.replace("//",""),s=t.indexOf("/")==-1?"/":t.slice(t.indexOf("/")),a=r.method?r.method.toUpperCase():"GET",n=!!/(^|,)\s*auth\s*($|,)/.test(e.qop)&&"auth",i=`00000000${e.nc}`.slice(-8),o=function(h,v,d,A,b,I,p){const w=p||yu()(`${v}:${d}:${A}`);return h&&h.toLowerCase()==="md5-sess"?yu()(`${w}:${b}:${I}`):w}(e.algorithm,e.username,e.realm,e.password,e.nonce,e.cnonce,e.ha1),l=yu()(`${a}:${s}`),u=n?yu()(`${o}:${e.nonce}:${i}:${e.cnonce}:${n}:${l}`):yu()(`${o}:${e.nonce}:${l}`),c={username:e.username,realm:e.realm,nonce:e.nonce,uri:s,qop:n,response:u,nc:i,cnonce:e.cnonce,algorithm:e.algorithm,opaque:e.opaque},f=[];for(const h in c)c[h]&&(h==="qop"||h==="nc"||h==="algorithm"?f.push(`${h}=${c[h]}`):f.push(`${h}="${c[h]}"`));return`Digest ${f.join(", ")}`}function Ty(r){return(r.headers&&r.headers.get("www-authenticate")||"").split(/\s/)[0].toLowerCase()==="digest"}var s1=Pe(101),Ly=Pe.n(s1);function rg(r){return Ly().decode(r)}function ag(r,e){var t;return`Basic ${t=`${r}:${e}`,Ly().encode(t)}`}const km=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:typeof window<"u"?window:globalThis,r1=km.fetch.bind(km),a1=km.Request,n1=km.Response;let Lt=function(r){return r.Auto="auto",r.Digest="digest",r.None="none",r.Password="password",r.Token="token",r}({}),gr=function(r){return r.DataTypeNoLength="data-type-no-length",r.InvalidAuthType="invalid-auth-type",r.InvalidOutputFormat="invalid-output-format",r.LinkUnsupportedAuthType="link-unsupported-auth",r.InvalidUpdateRange="invalid-update-range",r.NotSupported="not-supported",r}({});function Ry(r,e,t,s,a){switch(r.authType){case Lt.Auto:e&&t&&(r.headers.Authorization=ag(e,t));break;case Lt.Digest:r.digest=function(i,o,l){return{username:i,password:o,ha1:l,nc:0,algorithm:"md5",hasDigestAuth:!1}}(e,t,a);break;case Lt.None:break;case Lt.Password:r.headers.Authorization=ag(e,t);break;case Lt.Token:r.headers.Authorization=`${(n=s).token_type} ${n.access_token}`;break;default:throw new jt({info:{code:gr.InvalidAuthType}},`Invalid auth type: ${r.authType}`)}var n}Pe(345),Pe(800);const ng="@@HOTPATCHER",i1=()=>{};function pf(r){return{original:r,methods:[r],final:!1}}class o1{constructor(){this._configuration={registry:{},getEmptyAction:"null"},this.__type__=ng}get configuration(){return this._configuration}get getEmptyAction(){return this.configuration.getEmptyAction}set getEmptyAction(e){this.configuration.getEmptyAction=e}control(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e||e.__type__!==ng)throw new Error("Failed taking control of target HotPatcher instance: Invalid type or object");return Object.keys(e.configuration.registry).forEach(s=>{this.configuration.registry.hasOwnProperty(s)?t&&(this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])):this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])}),e._configuration=this.configuration,this}execute(e){const t=this.get(e)||i1;for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];return t(...a)}get(e){const t=this.configuration.registry[e];if(!t)switch(this.getEmptyAction){case"null":return null;case"throw":throw new Error(`Failed handling method request: No method provided for override: ${e}`);default:throw new Error(`Failed handling request which resulted in an empty method: Invalid empty-action specified: ${this.getEmptyAction}`)}return function(){for(var s=arguments.length,a=new Array(s),n=0;n<s;n++)a[n]=arguments[n];if(a.length===0)throw new Error("Failed creating sequence: No functions provided");return function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];let u=o;const c=this;for(;a.length>0;)u=[a.shift().apply(c,u)];return u[0]}}(...t.methods)}isPatched(e){return!!this.configuration.registry[e]}patch(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{chain:a=!1}=s;if(this.configuration.registry[e]&&this.configuration.registry[e].final)throw new Error(`Failed patching '${e}': Method marked as being final`);if(typeof t!="function")throw new Error(`Failed patching '${e}': Provided method is not a function`);if(a)this.configuration.registry[e]?this.configuration.registry[e].methods.push(t):this.configuration.registry[e]=pf(t);else if(this.isPatched(e)){const{original:n}=this.configuration.registry[e];this.configuration.registry[e]=Object.assign(pf(t),{original:n})}else this.configuration.registry[e]=pf(t);return this}patchInline(e,t){this.isPatched(e)||this.patch(e,t);for(var s=arguments.length,a=new Array(s>2?s-2:0),n=2;n<s;n++)a[n-2]=arguments[n];return this.execute(e,...a)}plugin(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return s.forEach(n=>{this.patch(e,n,{chain:!0})}),this}restore(e){if(!this.isPatched(e))throw new Error(`Failed restoring method: No method present for key: ${e}`);if(typeof this.configuration.registry[e].original!="function")throw new Error(`Failed restoring method: Original method not found or of invalid type for key: ${e}`);return this.configuration.registry[e].methods=[this.configuration.registry[e].original],this}setFinal(e){if(!this.configuration.registry.hasOwnProperty(e))throw new Error(`Failed marking '${e}' as final: No method found for key`);return this.configuration.registry[e].final=!0,this}}let df=null;function Uy(){return df||(df=new o1),df}function Im(r){return function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(r)?Object.assign({},r):Object.setPrototypeOf(Object.assign({},r),Object.getPrototypeOf(r))}function ig(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let s=null,a=[...e];for(;a.length>0;){const n=a.shift();s=s?$y(s,n):Im(n)}return s}function $y(r,e){const t=Im(r);return Object.keys(e).forEach(s=>{t.hasOwnProperty(s)?Array.isArray(e[s])?t[s]=Array.isArray(t[s])?[...t[s],...e[s]]:[...e[s]]:typeof e[s]=="object"&&e[s]?t[s]=typeof t[s]=="object"&&t[s]?$y(t[s],e[s]):Im(e[s]):t[s]=e[s]:t[s]=e[s]}),t}function u1(r){const e={};for(const t of r.keys())e[t]=r.get(t);return e}function bp(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(e.length===0)return{};const s={};return e.reduce((a,n)=>(Object.keys(n).forEach(i=>{const o=i.toLowerCase();s.hasOwnProperty(o)?a[s[o]]=n[i]:(s[o]=i,a[i]=n[i])}),a),{})}Pe(805);const c1=typeof ArrayBuffer=="function",{toString:l1}=Object.prototype;function jy(r){return c1&&(r instanceof ArrayBuffer||l1.call(r)==="[object ArrayBuffer]")}function Ky(r){return r!=null&&r.constructor!=null&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function rd(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function Sp(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const My=rd(function(r){const e=r._digest;return delete r._digest,e.hasDigestAuth&&(r=ig(r,{headers:{Authorization:sg(r,e)}})),Sp(Vm(r),function(t){let s=!1;return a=function(i){return s?i:t},(n=function(){if(t.status==401)return e.hasDigestAuth=function(i,o){if(!Ty(i))return!1;const l=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;for(;;){const u=i.headers&&i.headers.get("www-authenticate")||"",c=l.exec(u);if(!c)break;o[c[1]]=c[2]||c[3]}return o.nc+=1,o.cnonce=function(){let u="";for(let c=0;c<32;++c)u=`${u}${t1[Math.floor(16*Math.random())]}`;return u}(),!0}(t,e),function(){if(e.hasDigestAuth)return Sp(Vm(r=ig(r,{headers:{Authorization:sg(r,e)}})),function(i){return i.status==401?e.hasDigestAuth=!1:e.nc++,s=!0,i})}();e.nc++}())&&n.then?n.then(a):a(n);var a,n})}),h1=rd(function(r,e){return Sp(Vm(r),function(t){return t.ok?(e.authType=Lt.Password,t):t.status==401&&Ty(t)?(e.authType=Lt.Digest,Ry(e,e.username,e.password,void 0,void 0),r._digest=e.digest,My(r)):t})}),mt=rd(function(r,e){return e.authType===Lt.Auto?h1(r,e):r._digest?My(r):Vm(r)});function ft(r,e,t){const s=Im(r);return s.headers=bp(e.headers,s.headers||{},t.headers||{}),t.data!==void 0&&(s.data=t.data),t.signal&&(s.signal=t.signal),e.httpAgent&&(s.httpAgent=e.httpAgent),e.httpsAgent&&(s.httpsAgent=e.httpsAgent),e.digest&&(s._digest=e.digest),typeof e.withCredentials=="boolean"&&(s.withCredentials=e.withCredentials),s}function Vm(r){const e=Uy();return e.patchInline("request",t=>e.patchInline("fetch",r1,t.url,function(s){let a={};const n={method:s.method};if(s.headers&&(a=bp(a,s.headers)),s.data!==void 0){const[i,o]=function(l){if(typeof l=="string")return[l,{}];if(Ky(l))return[l,{}];if(jy(l))return[l,{}];if(l&&typeof l=="object")return[JSON.stringify(l),{"content-type":"application/json"}];throw new Error("Unable to convert request body: Unexpected body type: "+typeof l)}(s.data);n.body=i,a=bp(a,o)}return s.signal&&(n.signal=s.signal),s.withCredentials&&(n.credentials="include"),n.headers=a,n}(t)),r)}var m1=Pe(285);const Bm=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>65536)throw new TypeError("pattern is too long")},f1={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},wu=r=>r.replace(/[[\]\\-]/g,"\\$&"),og=r=>r.join(""),p1=(r,e)=>{const t=e;if(r.charAt(t)!=="[")throw new Error("not in a brace expression");const s=[],a=[];let n=t+1,i=!1,o=!1,l=!1,u=!1,c=t,f="";e:for(;n<r.length;){const A=r.charAt(n);if(A!=="!"&&A!=="^"||n!==t+1){if(A==="]"&&i&&!l){c=n+1;break}if(i=!0,A!=="\\"||l){if(A==="["&&!l){for(const[b,[I,p,w]]of Object.entries(f1))if(r.startsWith(b,n)){if(f)return["$.",!1,r.length-t,!0];n+=b.length,w?a.push(I):s.push(I),o=o||p;continue e}}l=!1,f?(A>f?s.push(wu(f)+"-"+wu(A)):A===f&&s.push(wu(A)),f="",n++):r.startsWith("-]",n+1)?(s.push(wu(A+"-")),n+=2):r.startsWith("-",n+1)?(f=A,n+=2):(s.push(wu(A)),n++)}else l=!0,n++}else u=!0,n++}if(c<n)return["",!1,0,!1];if(!s.length&&!a.length)return["$.",!1,r.length-t,!0];if(a.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!u)return[(h=s[0].length===2?s[0].slice(-1):s[0],h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,c-t,!1];var h;const v="["+(u?"^":"")+og(s)+"]",d="["+(u?"":"^")+og(a)+"]";return[s.length&&a.length?"("+v+"|"+d+")":s.length?v:d,o,c-t,!0]},Du=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/\[([^\/\\])\]/g,"$1"):r.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1")},d1=new Set(["!","?","+","*","@"]),ug=r=>d1.has(r),gf="(?!\\.)",g1=new Set(["[","."]),y1=new Set(["..","."]),w1=new Set("().*{}+?[]^$\\!"),ad="[^/]",cg=ad+"*?",lg=ad+"+?";class xt{type;#t;#s;#a=!1;#e=[];#r;#n;#u;#i=!1;#o;#c;#h=!1;constructor(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.type=e,e&&(this.#s=!0),this.#r=t,this.#t=this.#r?this.#r.#t:this,this.#o=this.#t===this?s:this.#t.#o,this.#u=this.#t===this?[]:this.#t.#u,e!=="!"||this.#t.#i||this.#u.push(this),this.#n=this.#r?this.#r.#e.length:0}get hasMagic(){if(this.#s!==void 0)return this.#s;for(const e of this.#e)if(typeof e!="string"&&(e.type||e.hasMagic))return this.#s=!0;return this.#s}toString(){return this.#c!==void 0?this.#c:this.type?this.#c=this.type+"("+this.#e.map(e=>String(e)).join("|")+")":this.#c=this.#e.map(e=>String(e)).join("")}#f(){if(this!==this.#t)throw new Error("should only call on root");if(this.#i)return this;let e;for(this.toString(),this.#i=!0;e=this.#u.pop();){if(e.type!=="!")continue;let t=e,s=t.#r;for(;s;){for(let a=t.#n+1;!s.type&&a<s.#e.length;a++)for(const n of e.#e){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(s.#e[a])}t=s,s=t.#r}}return this}push(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];for(const a of t)if(a!==""){if(typeof a!="string"&&!(a instanceof xt&&a.#r===this))throw new Error("invalid part: "+a);this.#e.push(a)}}toJSON(){const e=this.type===null?this.#e.slice().map(t=>typeof t=="string"?t:t.toJSON()):[this.type,...this.#e.map(t=>t.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===this.#t||this.#t.#i&&this.#r?.type==="!")&&e.push({}),e}isStart(){if(this.#t===this)return!0;if(!this.#r?.isStart())return!1;if(this.#n===0)return!0;const e=this.#r;for(let t=0;t<this.#n;t++){const s=e.#e[t];if(!(s instanceof xt&&s.type==="!"))return!1}return!0}isEnd(){if(this.#t===this||this.#r?.type==="!")return!0;if(!this.#r?.isEnd())return!1;if(!this.type)return this.#r?.isEnd();const e=this.#r?this.#r.#e.length:0;return this.#n===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new xt(this.type,e);for(const s of this.#e)t.copyIn(s);return t}static#l(e,t,s,a){let n=!1,i=!1,o=-1,l=!1;if(t.type===null){let v=s,d="";for(;v<e.length;){const A=e.charAt(v++);if(n||A==="\\")n=!n,d+=A;else if(i)v===o+1?A!=="^"&&A!=="!"||(l=!0):A!=="]"||v===o+2&&l||(i=!1),d+=A;else if(A!=="[")if(a.noext||!ug(A)||e.charAt(v)!=="(")d+=A;else{t.push(d),d="";const b=new xt(A,t);v=xt.#l(e,b,v,a),t.push(b)}else i=!0,o=v,l=!1,d+=A}return t.push(d),v}let u=s+1,c=new xt(null,t);const f=[];let h="";for(;u<e.length;){const v=e.charAt(u++);if(n||v==="\\")n=!n,h+=v;else if(i)u===o+1?v!=="^"&&v!=="!"||(l=!0):v!=="]"||u===o+2&&l||(i=!1),h+=v;else if(v!=="[")if(ug(v)&&e.charAt(u)==="("){c.push(h),h="";const d=new xt(v,c);c.push(d),u=xt.#l(e,d,u,a)}else if(v!=="|"){if(v===")")return h===""&&t.#e.length===0&&(t.#h=!0),c.push(h),h="",t.push(...f,c),u;h+=v}else c.push(h),h="",f.push(c),c=new xt(null,t);else i=!0,o=u,l=!1,h+=v}return t.type=null,t.#s=void 0,t.#e=[e.substring(s-1)],u}static fromGlob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new xt(null,void 0,t);return xt.#l(e,s,0,t),s}toMMPattern(){if(this!==this.#t)return this.#t.toMMPattern();const e=this.toString(),[t,s,a,n]=this.toRegExpSource();if(!(a||this.#s||this.#o.nocase&&!this.#o.nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;const i=(this.#o.nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp(`^${t}$`,i),{_src:t,_glob:e})}get options(){return this.#o}toRegExpSource(e){const t=e??!!this.#o.dot;if(this.#t===this&&this.#f(),!this.type){const l=this.isStart()&&this.isEnd(),u=this.#e.map(h=>{const[v,d,A,b]=typeof h=="string"?xt.#p(h,this.#s,l):h.toRegExpSource(e);return this.#s=this.#s||A,this.#a=this.#a||b,v}).join("");let c="";if(this.isStart()&&typeof this.#e[0]=="string"&&(this.#e.length!==1||!y1.has(this.#e[0]))){const h=g1,v=t&&h.has(u.charAt(0))||u.startsWith("\\.")&&h.has(u.charAt(2))||u.startsWith("\\.\\.")&&h.has(u.charAt(4)),d=!t&&!e&&h.has(u.charAt(0));c=v?"(?!(?:^|/)\\.\\.?(?:$|/))":d?gf:""}let f="";return this.isEnd()&&this.#t.#i&&this.#r?.type==="!"&&(f="(?:$|\\/)"),[c+u+f,Du(u),this.#s=!!this.#s,this.#a]}const s=this.type==="*"||this.type==="+",a=this.type==="!"?"(?:(?!(?:":"(?:";let n=this.#m(t);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){const l=this.toString();return this.#e=[l],this.type=null,this.#s=void 0,[l,Du(this.toString()),!1,!1]}let i=!s||e||t?"":this.#m(!0);i===n&&(i=""),i&&(n=`(?:${n})(?:${i})*?`);let o="";return o=this.type==="!"&&this.#h?(this.isStart()&&!t?gf:"")+lg:a+n+(this.type==="!"?"))"+(!this.isStart()||t||e?"":gf)+cg+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":`)${this.type}`),[o,Du(n),this.#s=!!this.#s,this.#a]}#m(e){return this.#e.map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[s,a,n,i]=t.toRegExpSource(e);return this.#a=this.#a||i,s}).filter(t=>!(this.isStart()&&this.isEnd()&&!t)).join("|")}static#p(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=!1,n="",i=!1;for(let o=0;o<e.length;o++){const l=e.charAt(o);if(a)a=!1,n+=(w1.has(l)?"\\":"")+l;else if(l!=="\\"){if(l==="["){const[u,c,f,h]=p1(e,o);if(f){n+=u,i=i||c,o+=f-1,t=t||h;continue}}l!=="*"?l!=="?"?n+=l.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(n+=ad,t=!0):(n+=s&&e==="*"?lg:cg,t=!0)}else o===e.length-1?n+="\\\\":a=!0}return[n,Du(e),!!t,i]}}const Bt=function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Bm(e),!(!t.nocomment&&e.charAt(0)==="#")&&new xm(e,t).match(r)},v1=/^\*+([^+@!?\*\[\(]*)$/,b1=r=>e=>!e.startsWith(".")&&e.endsWith(r),S1=r=>e=>e.endsWith(r),A1=r=>(r=r.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(r)),N1=r=>(r=r.toLowerCase(),e=>e.toLowerCase().endsWith(r)),E1=/^\*+\.\*+$/,C1=r=>!r.startsWith(".")&&r.includes("."),k1=r=>r!=="."&&r!==".."&&r.includes("."),I1=/^\.\*+$/,V1=r=>r!=="."&&r!==".."&&r.startsWith("."),B1=/^\*+$/,x1=r=>r.length!==0&&!r.startsWith("."),O1=r=>r.length!==0&&r!=="."&&r!=="..",P1=/^\?+([^+@!?\*\[\(]*)?$/,D1=r=>{let[e,t=""]=r;const s=Hy([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},T1=r=>{let[e,t=""]=r;const s=Jy([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},L1=r=>{let[e,t=""]=r;const s=Jy([e]);return t?a=>s(a)&&a.endsWith(t):s},R1=r=>{let[e,t=""]=r;const s=Hy([e]);return t?a=>s(a)&&a.endsWith(t):s},Hy=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&!s.startsWith(".")},Jy=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&s!=="."&&s!==".."},Fy=typeof ct=="object"&&ct?typeof mf=="object"&&mf&&mf.__MINIMATCH_TESTING_PLATFORM__||ct.platform:"posix";Bt.sep=Fy==="win32"?"\\":"/";const us=Symbol("globstar **");Bt.GLOBSTAR=us,Bt.filter=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return t=>Bt(t,r,e)};const ns=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.assign({},r,e)};Bt.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return Bt;const e=Bt;return Object.assign(function(t,s){return e(t,s,ns(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))},{Minimatch:class extends e.Minimatch{constructor(t){super(t,ns(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}))}static defaults(t){return e.defaults(ns(r,t)).Minimatch}},AST:class extends e.AST{constructor(t,s){super(t,s,ns(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))}static fromGlob(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.AST.fromGlob(t,ns(r,s))}},unescape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.unescape(t,ns(r,s))},escape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.escape(t,ns(r,s))},filter:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.filter(t,ns(r,s))},defaults:t=>e.defaults(ns(r,t)),makeRe:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.makeRe(t,ns(r,s))},braceExpand:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.braceExpand(t,ns(r,s))},match:function(t,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e.match(t,s,ns(r,a))},sep:e.sep,GLOBSTAR:us})};const qy=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Bm(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:m1(r)};Bt.braceExpand=qy,Bt.makeRe=function(r){return new xm(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).makeRe()},Bt.match=function(r,e){const t=new xm(e,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{});return r=r.filter(s=>t.match(s)),t.options.nonull&&!r.length&&r.push(e),r};const hg=/[?*]|[+@!]\(.*?\)|\[|\]/;class xm{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Bm(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||Fy,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#")return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=function(){return console.error(...arguments)}),this.debug(this.pattern,this.globSet);const s=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let a=this.globParts.map((n,i,o)=>{if(this.isWindows&&this.windowsNoMagicRoot){const l=!(n[0]!==""||n[1]!==""||n[2]!=="?"&&hg.test(n[2])||hg.test(n[3])),u=/^[a-z]:/i.test(n[0]);if(l)return[...n.slice(0,4),...n.slice(4).map(c=>this.parse(c))];if(u)return[n[0],...n.slice(1).map(c=>this.parse(c))]}return n.map(l=>this.parse(l))});if(this.debug(this.pattern,a),this.set=a.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){const i=this.set[n];i[0]===""&&i[1]===""&&this.globParts[n][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)e[s][a]==="**"&&(e[s][a]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let a=s;for(;t[a+1]==="**";)a++;a!==s&&t.splice(s,a-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,a)=>{const n=s[s.length-1];return a==="**"&&n==="**"?s:a===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(s.pop(),s):(s.push(a),s)},[])).length===0?[""]:t)}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let a=1;a<e.length-1;a++){const n=e[a];a===1&&n===""&&e[0]===""||n!=="."&&n!==""||(t=!0,e.splice(a,1),a--)}e[0]!=="."||e.length!==2||e[1]!=="."&&e[1]!==""||(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){const a=e[s-1];a&&a!=="."&&a!==".."&&a!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let a=-1;for(;(a=s.indexOf("**",a+1))!==-1;){let i=a;for(;s[i+1]==="**";)i++;i>a&&s.splice(a+1,i-a);let o=s[a+1];const l=s[a+2],u=s[a+3];if(o!==".."||!l||l==="."||l===".."||!u||u==="."||u==="..")continue;t=!0,s.splice(a,1);const c=s.slice(0);c[a]="**",e.push(c),a--}if(!this.preserveMultipleSlashes){for(let i=1;i<s.length-1;i++){const o=s[i];i===1&&o===""&&s[0]===""||o!=="."&&o!==""||(t=!0,s.splice(i,1),i--)}s[0]!=="."||s.length!==2||s[1]!=="."&&s[1]!==""||(t=!0,s.pop())}let n=0;for(;(n=s.indexOf("..",n+1))!==-1;){const i=s[n-1];if(i&&i!=="."&&i!==".."&&i!=="**"){t=!0;const o=n===1&&s[n+1]==="**"?["."]:[];s.splice(n-1,2,...o),s.length===0&&s.push(""),n-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){const a=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(a){e[t]=[],e[s]=a;break}}return e.filter(t=>t.length)}partsMatch(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=0,n=0,i=[],o="";for(;a<e.length&&n<t.length;)if(e[a]===t[n])i.push(o==="b"?t[n]:e[a]),a++,n++;else if(s&&e[a]==="**"&&t[n]===e[a+1])i.push(e[a]),a++;else if(s&&t[n]==="**"&&e[a]===t[n+1])i.push(t[n]),n++;else if(e[a]!=="*"||!t[n]||!this.options.dot&&t[n].startsWith(".")||t[n]==="**"){if(t[n]!=="*"||!e[a]||!this.options.dot&&e[a].startsWith(".")||e[a]==="**"||o==="a")return!1;o="b",i.push(t[n]),a++,n++}else{if(o==="b")return!1;o="a",i.push(e[a]),a++,n++}return e.length===t.length&&i}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let a=0;a<e.length&&e.charAt(a)==="!";a++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const a=this.options;if(this.isWindows){const A=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),b=!A&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),I=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),p=b?3:A?0:void 0,w=!I&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3])?3:I?0:void 0;if(typeof p=="number"&&typeof w=="number"){const[E,O]=[e[p],t[w]];E.toLowerCase()===O.toLowerCase()&&(t[w]=E,w>p?t=t.slice(w):p>w&&(e=e.slice(p)))}}const{optimizationLevel:n=1}=this.options;n>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,o=0,l=e.length,u=t.length;i<l&&o<u;i++,o++){this.debug("matchOne loop");var c=t[o],f=e[i];if(this.debug(t,c,f),c===!1)return!1;if(c===us){this.debug("GLOBSTAR",[t,c,f]);var h=i,v=o+1;if(v===u){for(this.debug("** at the end");i<l;i++)if(e[i]==="."||e[i]===".."||!a.dot&&e[i].charAt(0)===".")return!1;return!0}for(;h<l;){var d=e[h];if(this.debug(`
globstar while`,e,h,t,v,d),this.matchOne(e.slice(h),t.slice(v),s))return this.debug("globstar found match!",h,l,d),!0;if(d==="."||d===".."||!a.dot&&d.charAt(0)==="."){this.debug("dot detected!",e,h,t,v);break}this.debug("globstar swallow a segment, and continue"),h++}return!(!s||(this.debug(`
>>> no match, partial?`,e,h,t,v),h!==l))}let A;if(typeof c=="string"?(A=f===c,this.debug("string match",c,f,A)):(A=c.test(f),this.debug("pattern match",c,f,A)),!A)return!1}if(i===l&&o===u)return!0;if(i===l)return s;if(o===u)return i===l-1&&e[i]==="";throw new Error("wtf?")}braceExpand(){return qy(this.pattern,this.options)}parse(e){Bm(e);const t=this.options;if(e==="**")return us;if(e==="")return"";let s,a=null;(s=e.match(B1))?a=t.dot?O1:x1:(s=e.match(v1))?a=(t.nocase?t.dot?N1:A1:t.dot?S1:b1)(s[1]):(s=e.match(P1))?a=(t.nocase?t.dot?T1:D1:t.dot?L1:R1)(s):(s=e.match(E1))?a=t.dot?k1:C1:(s=e.match(I1))&&(a=V1);const n=xt.fromGlob(e,this.options).toMMPattern();return a&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:a}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",a=new Set(t.nocase?["i"]:[]);let n=e.map(l=>{const u=l.map(c=>{if(c instanceof RegExp)for(const f of c.flags.split(""))a.add(f);return typeof c=="string"?c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):c===us?us:c._src});return u.forEach((c,f)=>{const h=u[f+1],v=u[f-1];c===us&&v!==us&&(v===void 0?h!==void 0&&h!==us?u[f+1]="(?:\\/|"+s+"\\/)?"+h:u[f]=s:h===void 0?u[f-1]=v+"(?:\\/|"+s+")?":h!==us&&(u[f-1]=v+"(?:\\/|\\/"+s+"\\/)"+h,u[f+1]=us))}),u.filter(c=>c!==us).join("/")}).join("|");const[i,o]=e.length>1?["(?:",")"]:["",""];n="^"+i+n+o+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...a].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.partial;if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const s=this.options;this.isWindows&&(e=e.split("\\").join("/"));const a=this.slashSplit(e);this.debug(this.pattern,"split",a);const n=this.set;this.debug(this.pattern,"set",n);let i=a[a.length-1];if(!i)for(let o=a.length-2;!i&&o>=0;o--)i=a[o];for(let o=0;o<n.length;o++){const l=n[o];let u=a;if(s.matchBase&&l.length===1&&(u=[i]),this.matchOne(u,l,t))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(e){return Bt.defaults(e).Minimatch}}function nd(r){const e=new Error(`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:""}Invalid response: ${r.status} ${r.statusText}`);return e.status=r.status,e.response=r,e}function pt(r,e){const{status:t}=e;if(t===401&&r.digest)return e;if(t>=400)throw nd(e);return e}function ui(r,e){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?{data:e,headers:r.headers?u1(r.headers):{},status:r.status,statusText:r.statusText}:e}Bt.AST=xt,Bt.Minimatch=xm,Bt.escape=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/[?*()[\]]/g,"[$&]"):r.replace(/[?*()[\]\\]/g,"\\$&")},Bt.unescape=Du;const U1=(mg=function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ft({url:qe(r.remoteURL,Fe(e)),method:"COPY",headers:{Destination:qe(r.remoteURL,Fe(t)),Overwrite:s.overwrite===!1?"F":"T",Depth:s.shallow?"0":"infinity"}},r,s);return i=function(o){pt(r,o)},(n=mt(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i},function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];try{return Promise.resolve(mg.apply(this,r))}catch(t){return Promise.reject(t)}});var mg,id=Pe(635),$1=Pe(829),sr=Pe.n($1),Wo=function(r){return r.Array="array",r.Object="object",r.Original="original",r}(Wo||{});function ih(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Wo.Original;const s=sr().get(r,e);return t==="array"&&Array.isArray(s)===!1?[s]:t==="object"&&Array.isArray(s)?s[0]:s}function Xl(r){return new Promise(e=>{e(function(t){const{multistatus:s}=t;if(s==="")return{multistatus:{response:[]}};if(!s)throw new Error("Invalid response: No root multistatus found");const a={multistatus:Array.isArray(s)?s[0]:s};return sr().set(a,"multistatus.response",ih(a,"multistatus.response",Wo.Array)),sr().set(a,"multistatus.response",sr().get(a,"multistatus.response").map(n=>function(i){const o=Object.assign({},i);return o.status?sr().set(o,"status",ih(o,"status",Wo.Object)):(sr().set(o,"propstat",ih(o,"propstat",Wo.Object)),sr().set(o,"propstat.prop",ih(o,"propstat.prop",Wo.Object))),o}(n))),a}(new id.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",textNodeName:"text",ignoreAttributes:!1,removeNSPrefix:!0,numberParseOptions:{hex:!0,leadingZeros:!1},attributeValueProcessor:(t,s,a)=>s==="true"||s==="false"?s==="true":s,tagValueProcessor(t,s,a){if(!a.endsWith("propstat.prop.displayname"))return s}}).parse(r)))})}function Ym(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const{getlastmodified:s=null,getcontentlength:a="0",resourcetype:n=null,getcontenttype:i=null,getetag:o=null}=r,l=n&&typeof n=="object"&&n.collection!==void 0?"directory":"file",u={filename:e,basename:Cm().basename(e),lastmod:s,size:parseInt(a,10),type:l,etag:typeof o=="string"?o.replace(/"/g,""):null};return l==="file"&&(u.mime=i&&typeof i=="string"?i.split(";")[0]:""),t&&(r.displayname!==void 0&&(r.displayname=String(r.displayname)),u.props=r),u}function Wy(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=null;try{r.multistatus.response[0].propstat&&(s=r.multistatus.response[0])}catch{}if(!s)throw new Error("Failed getting item stat: bad response");const{propstat:{prop:a,status:n}}=s,[i,o,l]=n.split(" ",3),u=parseInt(o,10);if(u>=400){const c=new Error(`Invalid response: ${u} ${l}`);throw c.status=u,c}return Ym(a,jl(e),t)}function _y(r){switch(String(r)){case"-3":return"unlimited";case"-2":case"-1":return"unknown";default:return parseInt(String(r),10)}}function yf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const od=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=ft({url:qe(r.remoteURL,Fe(e)),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,t);return yf(mt(a,r),function(n){return pt(r,n),yf(n.text(),function(i){return yf(Xl(i),function(o){const l=Wy(o,e,s);return ui(n,l,s)})})})});function Gy(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const j1=zy(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=function(n){if(!n||n==="/")return[];let i=n;const o=[];do o.push(i),i=Cm().dirname(i);while(i&&i!=="/");return o}(jl(e));s.sort((n,i)=>n.length>i.length?1:i.length>n.length?-1:0);let a=!1;return function(n,i,o){if(typeof n[pg]=="function"){let A=function(b){try{for(;!(l=f.next()).done;)if((b=i(l.value))&&b.then){if(!dg(b))return void b.then(A,c||(c=Rt.bind(null,u=new _o,2)));b=b.v}u?Rt(u,1,b):u=b}catch(I){Rt(u||(u=new _o),2,I)}};var l,u,c,f=n[pg]();if(A(),f.return){var h=function(b){try{l.done||f.return()}catch{}return b};if(u&&u.then)return u.then(h,function(b){throw h(b)});h()}return u}if(!("length"in n))throw new TypeError("Object is not iterable");for(var v=[],d=0;d<n.length;d++)v.push(n[d]);return function(A,b,I){var p,w,E=-1;return function O(x){try{for(;++E<A.length&&(!I||!I());)if((x=b(E))&&x.then){if(!dg(x))return void x.then(O,w||(w=Rt.bind(null,p=new _o,2)));x=x.v}p?Rt(p,1,x):p=x}catch(T){Rt(p||(p=new _o),2,T)}}(),p}(v,function(A){return i(v[A])},o)}(s,function(n){return i=function(){return function(l,u){try{var c=Gy(od(r,n),function(f){if(f.type!=="directory")throw new Error(`Path includes a file: ${e}`)})}catch(f){return u(f)}return c&&c.then?c.then(void 0,u):c}(0,function(l){const u=l;return function(){if(u.status===404)return a=!0,fg(Ap(r,n,{...t,recursive:!1}));throw l}()})},(o=function(){if(a)return fg(Ap(r,n,{...t,recursive:!1}))}())&&o.then?o.then(i):i();var i,o},function(){return!1})});function zy(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function K1(){}function fg(r,e){return r&&r.then?r.then(K1):Promise.resolve()}const pg=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function Rt(r,e,t){if(!r.s){if(t instanceof _o){if(!t.s)return void(t.o=Rt.bind(null,r,e));1&e&&(e=t.s),t=t.v}if(t&&t.then)return void t.then(Rt.bind(null,r,e),Rt.bind(null,r,2));r.s=e,r.v=t;const s=r.o;s&&s(r)}}const _o=function(){function r(){}return r.prototype.then=function(e,t){const s=new r,a=this.s;if(a){const n=1&a?e:t;if(n){try{Rt(s,1,n(this.v))}catch(i){Rt(s,2,i)}return s}return this}return this.o=function(n){try{const i=n.v;1&n.s?Rt(s,1,e?e(i):i):t?Rt(s,1,t(i)):Rt(s,2,i)}catch(i){Rt(s,2,i)}},s},r}();function dg(r){return r instanceof _o&&1&r.s}const Ap=zy(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.recursive===!0)return j1(r,e,t);const s=ft({url:qe(r.remoteURL,(a=Fe(e),a.endsWith("/")?a:a+"/")),method:"MKCOL"},r,t);var a;return Gy(mt(s,r),function(n){pt(r,n)})});var M1=Pe(388),gg=Pe.n(M1);const H1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s={};if(typeof t.range=="object"&&typeof t.range.start=="number"){let o=`bytes=${t.range.start}-`;typeof t.range.end=="number"&&(o=`${o}${t.range.end}`),s.Range=o}const a=ft({url:qe(r.remoteURL,Fe(e)),method:"GET",headers:s},r,t);return i=function(o){if(pt(r,o),s.Range&&o.status!==206){const l=new Error(`Invalid response code for partial request: ${o.status}`);throw l.status=o.status,l}return t.callback&&setTimeout(()=>{t.callback(o)},0),o.body},(n=mt(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i}),J1=()=>{},F1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){t.url||(t.url=qe(r.remoteURL,Fe(e)));const s=ft(t,r,{});return n=function(i){return pt(r,i),i},(a=mt(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),q1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:qe(r.remoteURL,Fe(e)),method:"DELETE"},r,t);return n=function(i){pt(r,i)},(a=mt(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),W1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function(s,a){try{var n=(i=od(r,e,t),o=function(){return!0},l?o?o(i):i:(i&&i.then||(i=Promise.resolve(i)),o?i.then(o):i))}catch(u){return a(u)}var i,o,l;return n&&n.then?n.then(void 0,a):n}(0,function(s){if(s.status===404)return!1;throw s})});function wf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const _1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:qe(r.remoteURL,Fe(e),"/"),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:t.deep?"infinity":"1"}},r,t);return wf(mt(s,r),function(a){return pt(r,a),wf(a.text(),function(n){if(!n)throw new Error("Failed parsing directory contents: Empty response");return wf(Xl(n),function(i){const o=tg(e);let l=function(u,c,f){let h=arguments.length>3&&arguments[3]!==void 0&&arguments[3],v=arguments.length>4&&arguments[4]!==void 0&&arguments[4];const d=Cm().join(c,"/"),{multistatus:{response:A}}=u,b=A.map(I=>{const p=function(E){try{return E.replace(/^https?:\/\/[^\/]+/,"")}catch(O){throw new jt(O,"Failed normalising HREF")}}(I.href),{propstat:{prop:w}}=I;return Ym(w,d==="/"?decodeURIComponent(jl(p)):jl(Cm().relative(decodeURIComponent(d),decodeURIComponent(p))),h)});return v?b:b.filter(I=>I.basename&&(I.type==="file"||I.filename!==f.replace(/\/$/,"")))}(i,tg(r.remoteBasePath||r.remotePath),o,t.details,t.includeSelf);return t.glob&&(l=function(u,c){return u.filter(f=>Bt(f.filename,c,{matchBase:!0}))}(l,t.glob)),ui(a,l,t.details)})})})});function ud(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const G1=ud(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:qe(r.remoteURL,Fe(e)),method:"GET",headers:{Accept:"text/plain"},transformResponse:[Y1]},r,t);return Om(mt(s,r),function(a){return pt(r,a),Om(a.text(),function(n){return ui(a,n,t.details)})})});function Om(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const z1=ud(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:qe(r.remoteURL,Fe(e)),method:"GET"},r,t);return Om(mt(s,r),function(a){let n;return pt(r,a),function(i,o){var l=i();return l&&l.then?l.then(o):o()}(function(){return Om(a.arrayBuffer(),function(i){n=i})},function(){return ui(a,n,t.details)})})}),X1=ud(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{format:s="binary"}=t;if(s!=="binary"&&s!=="text")throw new jt({info:{code:gr.InvalidOutputFormat}},`Invalid output format: ${s}`);return s==="text"?G1(r,e,t):z1(r,e,t)}),Y1=r=>r;function Q1(r){return new id.XMLBuilder({attributeNamePrefix:"@_",format:!0,ignoreAttributes:!1,suppressEmptyNode:!0}).build(Xy({lockinfo:{"@_xmlns:d":"DAV:",lockscope:{exclusive:{}},locktype:{write:{}},owner:{href:r}}},"d"))}function Xy(r,e){const t={...r};for(const s in t)t.hasOwnProperty(s)&&(t[s]&&typeof t[s]=="object"&&s.indexOf(":")===-1?(t[`${e}:${s}`]=Xy(t[s],e),delete t[s]):/^@_/.test(s)===!1&&(t[`${e}:${s}`]=t[s],delete t[s]));return t}function Np(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}function Yy(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const Z1=Yy(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ft({url:qe(r.remoteURL,Fe(e)),method:"UNLOCK",headers:{"Lock-Token":t}},r,s);return Np(mt(a,r),function(n){if(pt(r,n),n.status!==204&&n.status!==200)throw nd(n)})}),ev=Yy(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{refreshToken:s,timeout:a=tv}=t,n={Accept:"text/plain,application/xml",Timeout:a};s&&(n.If=s);const i=ft({url:qe(r.remoteURL,Fe(e)),method:"LOCK",headers:n,data:Q1(r.contactHref)},r,t);return Np(mt(i,r),function(o){return pt(r,o),Np(o.text(),function(l){const u=(h=l,new id.XMLParser({removeNSPrefix:!0,parseAttributeValue:!0,parseTagValue:!0}).parse(h)),c=sr().get(u,"prop.lockdiscovery.activelock.locktoken.href"),f=sr().get(u,"prop.lockdiscovery.activelock.timeout");var h;if(!c)throw nd(o,"No lock token received: ");return{token:c,serverTimeout:f}})})}),tv="Infinite, Second-4100000000";function vf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const sv=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.path||"/",s=ft({url:qe(r.remoteURL,t),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,e);return vf(mt(s,r),function(a){return pt(r,a),vf(a.text(),function(n){return vf(Xl(n),function(i){const o=function(l){try{const[u]=l.multistatus.response,{propstat:{prop:{"quota-used-bytes":c,"quota-available-bytes":f}}}=u;return c!==void 0&&f!==void 0?{used:parseInt(String(c),10),available:_y(f)}:null}catch{}return null}(i);return ui(a,o,e.details)})})})});function bf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const rv=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=ft({url:qe(r.remoteURL,Fe(e)),method:"SEARCH",headers:{Accept:"text/plain,application/xml","Content-Type":r.headers["Content-Type"]||"application/xml; charset=utf-8"}},r,t);return bf(mt(a,r),function(n){return pt(r,n),bf(n.text(),function(i){return bf(Xl(i),function(o){const l=function(u,c,f){const h={truncated:!1,results:[]};return h.truncated=u.multistatus.response.some(v=>(v.status||v.propstat?.status).split(" ",3)?.[1]==="507"&&v.href.replace(/\/$/,"").endsWith(Fe(c).replace(/\/$/,""))),u.multistatus.response.forEach(v=>{if(v.propstat===void 0)return;const d=v.href.split("/").map(decodeURIComponent).join("/");h.results.push(Ym(v.propstat.prop,d,f))}),h}(o,e,s);return ui(n,l,s)})})})}),av=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ft({url:qe(r.remoteURL,Fe(e)),method:"MOVE",headers:{Destination:qe(r.remoteURL,Fe(t)),Overwrite:s.overwrite===!1?"F":"T"}},r,s);return i=function(o){pt(r,o)},(n=mt(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i});var nv=Pe(172);const iv=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const{contentLength:a=!0,overwrite:n=!0}=s,i={"Content-Type":"application/octet-stream"};a===!1||(i["Content-Length"]=typeof a=="number"?`${a}`:`${function(c){if(jy(c))return c.byteLength;if(Ky(c))return c.length;if(typeof c=="string")return(0,nv.d)(c);throw new jt({info:{code:gr.DataTypeNoLength}},"Cannot calculate data length: Invalid type")}(t)}`),n||(i["If-None-Match"]="*");const o=ft({url:qe(r.remoteURL,Fe(e)),method:"PUT",headers:i,data:t},r,s);return u=function(c){try{pt(r,c)}catch(f){const h=f;if(h.status!==412||n)throw h;return!1}return!0},(l=mt(o,r))&&l.then||(l=Promise.resolve(l)),u?l.then(u):l;var l,u}),Qy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:qe(r.remoteURL,Fe(e)),method:"OPTIONS"},r,t);return n=function(i){try{pt(r,i)}catch(o){throw o}return{compliance:(i.headers.get("DAV")??"").split(",").map(o=>o.trim()),server:i.headers.get("Server")??""}},(a=mt(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n});function xl(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const ov=cd(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new jt({info:{code:gr.InvalidUpdateRange}},`Invalid update range ${t} for partial update`);const i={"Content-Type":"application/octet-stream","Content-Length":""+(s-t+1),"Content-Range":`bytes ${t}-${s}/*`},o=ft({url:qe(r.remoteURL,Fe(e)),method:"PUT",headers:i,data:a},r,n);return xl(mt(o,r),function(l){pt(r,l)})});function yg(r,e){var t=r();return t&&t.then?t.then(e):e(t)}const uv=cd(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new jt({info:{code:gr.InvalidUpdateRange}},`Invalid update range ${t} for partial update`);const i={"Content-Type":"application/x-sabredav-partialupdate","Content-Length":""+(s-t+1),"X-Update-Range":`bytes=${t}-${s}`},o=ft({url:qe(r.remoteURL,Fe(e)),method:"PATCH",headers:i,data:a},r,n);return xl(mt(o,r),function(l){pt(r,l)})});function cd(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const cv=cd(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};return xl(Qy(r,e,n),function(i){let o=!1;return yg(function(){if(i.compliance.includes("sabredav-partialupdate"))return xl(uv(r,e,t,s,a,n),function(l){return o=!0,l})},function(l){let u=!1;return o?l:yg(function(){if(i.server.includes("Apache")&&i.compliance.includes("<http://apache.org/dav/propset/fs/1>"))return xl(ov(r,e,t,s,a,n),function(c){return u=!0,c})},function(c){if(u)return c;throw new jt({info:{code:gr.NotSupported}},"Not supported")})})})}),lv="https://github.com/perry-mitchell/webdav-client/blob/master/LOCK_CONTACT.md";function hv(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{authType:t=null,remoteBasePath:s,contactHref:a=lv,ha1:n,headers:i={},httpAgent:o,httpsAgent:l,password:u,token:c,username:f,withCredentials:h}=e;let v=t;v||(v=f||u?Lt.Password:Lt.None);const d={authType:v,remoteBasePath:s,contactHref:a,ha1:n,headers:Object.assign({},i),httpAgent:o,httpsAgent:l,password:u,remotePath:Z0(r),remoteURL:r,token:c,username:f,withCredentials:h};return Ry(d,f,u,c,n),{copyFile:(A,b,I)=>U1(d,A,b,I),createDirectory:(A,b)=>Ap(d,A,b),createReadStream:(A,b)=>function(I,p){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const E=new(gg()).PassThrough;return H1(I,p,w).then(O=>{O.pipe(E)}).catch(O=>{E.emit("error",O)}),E}(d,A,b),createWriteStream:(A,b,I)=>function(p,w){let E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:J1;const x=new(gg()).PassThrough,T={};E.overwrite===!1&&(T["If-None-Match"]="*");const B=ft({url:qe(p.remoteURL,Fe(w)),method:"PUT",headers:T,data:x,maxRedirects:0},p,E);return mt(B,p).then(k=>pt(p,k)).then(k=>{setTimeout(()=>{O(k)},0)}).catch(k=>{x.emit("error",k)}),x}(d,A,b,I),customRequest:(A,b)=>F1(d,A,b),deleteFile:(A,b)=>q1(d,A,b),exists:(A,b)=>W1(d,A,b),getDirectoryContents:(A,b)=>_1(d,A,b),getFileContents:(A,b)=>X1(d,A,b),getFileDownloadLink:A=>function(b,I){let p=qe(b.remoteURL,Fe(I));const w=/^https:/i.test(p)?"https":"http";switch(b.authType){case Lt.None:break;case Lt.Password:{const E=rg(b.headers.Authorization.replace(/^Basic /i,"").trim());p=p.replace(/^https?:\/\//,`${w}://${E}@`);break}default:throw new jt({info:{code:gr.LinkUnsupportedAuthType}},`Unsupported auth type for file link: ${b.authType}`)}return p}(d,A),getFileUploadLink:A=>function(b,I){let p=`${qe(b.remoteURL,Fe(I))}?Content-Type=application/octet-stream`;const w=/^https:/i.test(p)?"https":"http";switch(b.authType){case Lt.None:break;case Lt.Password:{const E=rg(b.headers.Authorization.replace(/^Basic /i,"").trim());p=p.replace(/^https?:\/\//,`${w}://${E}@`);break}default:throw new jt({info:{code:gr.LinkUnsupportedAuthType}},`Unsupported auth type for file link: ${b.authType}`)}return p}(d,A),getHeaders:()=>Object.assign({},d.headers),getQuota:A=>sv(d,A),lock:(A,b)=>ev(d,A,b),moveFile:(A,b,I)=>av(d,A,b,I),putFileContents:(A,b,I)=>iv(d,A,b,I),partialUpdateFileContents:(A,b,I,p,w)=>cv(d,A,b,I,p,w),getDAVCompliance:A=>Qy(d,A),search:(A,b)=>rv(d,A,b),setHeaders:A=>{d.headers=Object.assign({},A)},stat:(A,b)=>od(d,A,b),unlock:(A,b,I)=>Z1(d,A,b,I)}}gs.hT,gs.O4,gs.Kd,gs.YK;var mv=gs.UU,fv=gs.Gu,pv=gs.ky,dv=gs.h4;gs.ch,gs.hq,gs.i5;function gv(r){return r&&r.split("/").map(encodeURIComponent).join("/")}function wg(...r){if(arguments.length<1)return"";const e=r.filter(l=>l.length>0);if(e.length<1)return"";const t=e[e.length-1],s=e[0].charAt(0)==="/",a=t.charAt(t.length-1)==="/",n=e.reduce((l,u)=>l.concat(u.split("/")),[]);let i=!s;const o=n.reduce((l,u)=>u===""?l:i?(i=!1,l+u):l+"/"+u,"");return a?o+"/":o}const mr=g0().setApp("@nextcloud/files").detectUser().build();var ld=(r=>(r.Folder="folder",r.File="file",r))(ld||{}),ii=(r=>(r[r.NONE=0]="NONE",r[r.CREATE=4]="CREATE",r[r.READ=1]="READ",r[r.UPDATE=2]="UPDATE",r[r.DELETE=8]="DELETE",r[r.SHARE=16]="SHARE",r[r.ALL=31]="ALL",r))(ii||{});const Zy=function(r,e){return r.match(e)!==null},Ar=(r,e)=>{if(r.id&&typeof r.id!="number")throw new Error("Invalid id type of value");if(!r.source)throw new Error("Missing mandatory source");try{new URL(r.source)}catch{throw new Error("Invalid source format, source must be a valid URL")}if(!r.source.startsWith("http"))throw new Error("Invalid source format, only http(s) is supported");if(r.displayname&&typeof r.displayname!="string")throw new Error("Invalid displayname type");if(r.mtime&&!(r.mtime instanceof Date))throw new Error("Invalid mtime type");if(r.crtime&&!(r.crtime instanceof Date))throw new Error("Invalid crtime type");if(!r.mime||typeof r.mime!="string"||!r.mime.match(/^[-\w.]+\/[-+\w.]+$/gi))throw new Error("Missing or invalid mandatory mime");if("size"in r&&typeof r.size!="number"&&r.size!==void 0)throw new Error("Invalid size type");if("permissions"in r&&r.permissions!==void 0&&!(typeof r.permissions=="number"&&r.permissions>=ii.NONE&&r.permissions<=ii.ALL))throw new Error("Invalid permissions");if(r.owner&&r.owner!==null&&typeof r.owner!="string")throw new Error("Invalid owner type");if(r.attributes&&typeof r.attributes!="object")throw new Error("Invalid attributes type");if(r.root&&typeof r.root!="string")throw new Error("Invalid root type");if(r.root&&!r.root.startsWith("/"))throw new Error("Root must start with a leading slash");if(r.root&&!r.source.includes(r.root))throw new Error("Root must be part of the source");if(r.root&&Zy(r.source,e)){const t=r.source.match(e)[0];if(!r.source.includes(Xt.join(t,r.root)))throw new Error("The root must be relative to the service. e.g /files/emma")}if(r.status&&!Object.values(ew).includes(r.status))throw new Error("Status must be a valid NodeStatus")};var ew=(r=>(r.NEW="new",r.FAILED="failed",r.LOADING="loading",r.LOCKED="locked",r))(ew||{});class hd{_data;_attributes;_knownDavService=/(remote|public)\.php\/(web)?dav/i;readonlyAttributes=Object.entries(Object.getOwnPropertyDescriptors(hd.prototype)).filter(e=>typeof e[1].get=="function"&&e[0]!=="__proto__").map(e=>e[0]);handler={set:(e,t,s)=>this.readonlyAttributes.includes(t)?!1:Reflect.set(e,t,s),deleteProperty:(e,t)=>this.readonlyAttributes.includes(t)?!1:Reflect.deleteProperty(e,t),get:(e,t,s)=>this.readonlyAttributes.includes(t)?(mr.warn(`Accessing "Node.attributes.${t}" is deprecated, access it directly on the Node instance.`),Reflect.get(this,t)):Reflect.get(e,t,s)};constructor(e,t){e.mime||(e.mime="application/octet-stream"),Ar(e,t||this._knownDavService),this._data={displayname:e.attributes?.displayname,...e,attributes:{}},this._attributes=new Proxy(this._data.attributes,this.handler),this.update(e.attributes??{}),t&&(this._knownDavService=t)}get source(){return this._data.source.replace(/\/$/i,"")}get encodedSource(){const{origin:e}=new URL(this.source);return e+gv(this.source.slice(e.length))}get basename(){return Xt.basename(this.source)}get displayname(){return this._data.displayname||this.basename}set displayname(e){Ar({...this._data,displayname:e},this._knownDavService),this._data.displayname=e}get extension(){return Xt.extname(this.source)}get dirname(){if(this.root){let t=this.source;this.isDavResource&&(t=t.split(this._knownDavService).pop());const s=t.indexOf(this.root),a=this.root.replace(/\/$/,"");return Xt.dirname(t.slice(s+a.length)||"/")}const e=new URL(this.source);return Xt.dirname(e.pathname)}get mime(){return this._data.mime||"application/octet-stream"}set mime(e){e??="application/octet-stream",Ar({...this._data,mime:e},this._knownDavService),this._data.mime=e}get mtime(){return this._data.mtime}set mtime(e){Ar({...this._data,mtime:e},this._knownDavService),this._data.mtime=e}get crtime(){return this._data.crtime}get size(){return this._data.size}set size(e){Ar({...this._data,size:e},this._knownDavService),this.updateMtime(),this._data.size=e}get attributes(){return this._attributes}get permissions(){return this.owner===null&&!this.isDavResource?ii.READ:this._data.permissions!==void 0?this._data.permissions:ii.NONE}set permissions(e){Ar({...this._data,permissions:e},this._knownDavService),this.updateMtime(),this._data.permissions=e}get owner(){return this.isDavResource?this._data.owner:null}get isDavResource(){return Zy(this.source,this._knownDavService)}get isDavRessource(){return this.isDavResource}get root(){return this._data.root?this._data.root.replace(/^(.+)\/$/,"$1"):this.isDavResource&&Xt.dirname(this.source).split(this._knownDavService).pop()||null}get path(){if(this.root){let e=this.source;this.isDavResource&&(e=e.split(this._knownDavService).pop());const t=e.indexOf(this.root),s=this.root.replace(/\/$/,"");return e.slice(t+s.length)||"/"}return(this.dirname+"/"+this.basename).replace(/\/\//g,"/")}get fileid(){return this._data?.id}get status(){return this._data?.status}set status(e){Ar({...this._data,status:e},this._knownDavService),this._data.status=e}get data(){return structuredClone(this._data)}move(e){Ar({...this._data,source:e},this._knownDavService);const t=this.basename;this._data.source=e,this.displayname===t&&this.basename!==t&&(this.displayname=this.basename)}rename(e){if(e.includes("/"))throw new Error("Invalid basename");this.move(Xt.dirname(this.source)+"/"+e)}updateMtime(){this._data.mtime&&(this._data.mtime=new Date)}update(e){for(const[t,s]of Object.entries(e))try{s===void 0?delete this.attributes[t]:this.attributes[t]=s}catch(a){if(a instanceof TypeError)continue;throw a}}}class Qm extends hd{constructor(e){super({...e,mime:"httpd/unix-directory"})}get type(){return ld.Folder}get extension(){return null}get mime(){return"httpd/unix-directory"}clone(){return new Qm(this.data)}}const tw=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],sw={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},Sf=function(r,e={nc:"http://nextcloud.org/ns"}){typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...tw],window._nc_dav_namespaces={...sw});const t={...window._nc_dav_namespaces,...e};if(window._nc_dav_properties.find(a=>a===r))return mr.warn(`${r} already registered`,{prop:r}),!1;if(r.startsWith("<")||r.split(":").length!==2)return mr.error(`${r} is not valid. See example: 'oc:fileid'`,{prop:r}),!1;const s=r.split(":")[0];return t[s]?(window._nc_dav_properties.push(r),window._nc_dav_namespaces=t,!0):(mr.error(`${r} namespace unknown`,{prop:r,namespaces:t}),!1)},yv=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...tw]),window._nc_dav_properties.map(r=>`<${r} />`).join(" ")},wv=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces={...sw}),Object.keys(window._nc_dav_namespaces).map(r=>`xmlns:${r}="${window._nc_dav_namespaces?.[r]}"`).join(" ")},vv=function(){return`<?xml version="1.0"?>
		<d:propfind ${wv()}>
			<d:prop>
				${yv()}
			</d:prop>
		</d:propfind>`};function bv(){return Py()?`/files/${F0()}`:`/files/${cu()?.uid}`}const Sv=bv();function Av(){const r=y0("dav");return Py()?r.replace("remote.php","public.php"):r}const rw=Av(),Nv=function(r=rw,e={}){const t=mv(r,{headers:e});function s(a){t.setHeaders({...e,"X-Requested-With":"XMLHttpRequest",requesttoken:a??""})}return v0(s),s(w0()),fv().patch("fetch",(a,n)=>{const i=n.headers;return i?.method&&(n.method=i.method,delete i.method),fetch(a,n)}),t};var Af={},Nf={exports:{}},vg={},bg;function Ev(){return bg||(bg=1,function(r){Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},t={};t.byteLength=c,t.toByteArray=h,t.fromByteArray=A;for(var s=[],a=[],n=typeof Uint8Array<"u"?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=i.length;o<l;++o)s[o]=i[o],a[i.charCodeAt(o)]=o;a[45]=62,a[95]=63;function u(p){var w=p.length;if(w%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var E=p.indexOf("=");E===-1&&(E=w);var O=E===w?0:4-E%4;return[E,O]}function c(p){var w=u(p),E=w[0],O=w[1];return(E+O)*3/4-O}function f(p,w,E){return(w+E)*3/4-E}function h(p){var w,E=u(p),O=E[0],x=E[1],T=new n(f(p,O,x)),B=0,k=x>0?O-4:O,J;for(J=0;J<k;J+=4)w=a[p.charCodeAt(J)]<<18|a[p.charCodeAt(J+1)]<<12|a[p.charCodeAt(J+2)]<<6|a[p.charCodeAt(J+3)],T[B++]=w>>16&255,T[B++]=w>>8&255,T[B++]=w&255;return x===2&&(w=a[p.charCodeAt(J)]<<2|a[p.charCodeAt(J+1)]>>4,T[B++]=w&255),x===1&&(w=a[p.charCodeAt(J)]<<10|a[p.charCodeAt(J+1)]<<4|a[p.charCodeAt(J+2)]>>2,T[B++]=w>>8&255,T[B++]=w&255),T}function v(p){return s[p>>18&63]+s[p>>12&63]+s[p>>6&63]+s[p&63]}function d(p,w,E){for(var O,x=[],T=w;T<E;T+=3)O=(p[T]<<16&16711680)+(p[T+1]<<8&65280)+(p[T+2]&255),x.push(v(O));return x.join("")}function A(p){for(var w,E=p.length,O=E%3,x=[],T=16383,B=0,k=E-O;B<k;B+=T)x.push(d(p,B,B+T>k?k:B+T));return O===1?(w=p[E-1],x.push(s[w>>2]+s[w<<4&63]+"==")):O===2&&(w=(p[E-2]<<8)+p[E-1],x.push(s[w>>10]+s[w>>4&63]+s[w<<2&63]+"=")),x.join("")}var b={};b.read=function(p,w,E,O,x){var T,B,k=x*8-O-1,J=(1<<k)-1,F=J>>1,P=-7,U=E?x-1:0,re=E?-1:1,X=p[w+U];for(U+=re,T=X&(1<<-P)-1,X>>=-P,P+=k;P>0;T=T*256+p[w+U],U+=re,P-=8);for(B=T&(1<<-P)-1,T>>=-P,P+=O;P>0;B=B*256+p[w+U],U+=re,P-=8);if(T===0)T=1-F;else{if(T===J)return B?NaN:(X?-1:1)*(1/0);B=B+Math.pow(2,O),T=T-F}return(X?-1:1)*B*Math.pow(2,T-O)},b.write=function(p,w,E,O,x,T){var B,k,J,F=T*8-x-1,P=(1<<F)-1,U=P>>1,re=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=O?0:T-1,K=O?1:-1,W=w<0||w===0&&1/w<0?1:0;for(w=Math.abs(w),isNaN(w)||w===1/0?(k=isNaN(w)?1:0,B=P):(B=Math.floor(Math.log(w)/Math.LN2),w*(J=Math.pow(2,-B))<1&&(B--,J*=2),B+U>=1?w+=re/J:w+=re*Math.pow(2,1-U),w*J>=2&&(B++,J/=2),B+U>=P?(k=0,B=P):B+U>=1?(k=(w*J-1)*Math.pow(2,x),B=B+U):(k=w*Math.pow(2,U-1)*Math.pow(2,x),B=0));x>=8;p[E+X]=k&255,X+=K,k/=256,x-=8);for(B=B<<x|k,F+=x;F>0;p[E+X]=B&255,X+=K,B/=256,F-=8);p[E+X-K]|=W*128},function(p){const w=t,E=b,O=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;p.Buffer=P,p.SlowBuffer=oe,p.INSPECT_MAX_BYTES=50;const x=2147483647;p.kMaxLength=x;const{Uint8Array:T,ArrayBuffer:B,SharedArrayBuffer:k}=globalThis;P.TYPED_ARRAY_SUPPORT=J(),!P.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function J(){try{const m=new T(1),y={foo:function(){return 42}};return Object.setPrototypeOf(y,T.prototype),Object.setPrototypeOf(m,y),m.foo()===42}catch{return!1}}Object.defineProperty(P.prototype,"parent",{enumerable:!0,get:function(){if(P.isBuffer(this))return this.buffer}}),Object.defineProperty(P.prototype,"offset",{enumerable:!0,get:function(){if(P.isBuffer(this))return this.byteOffset}});function F(m){if(m>x)throw new RangeError('The value "'+m+'" is invalid for option "size"');const y=new T(m);return Object.setPrototypeOf(y,P.prototype),y}function P(m,y,N){if(typeof m=="number"){if(typeof y=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return K(m)}return U(m,y,N)}P.poolSize=8192;function U(m,y,N){if(typeof m=="string")return W(m,y);if(B.isView(m))return se(m);if(m==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof m);if(xs(m,B)||m&&xs(m.buffer,B)||typeof k<"u"&&(xs(m,k)||m&&xs(m.buffer,k)))return Z(m,y,N);if(typeof m=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const L=m.valueOf&&m.valueOf();if(L!=null&&L!==m)return P.from(L,y,N);const M=_(m);if(M)return M;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof m[Symbol.toPrimitive]=="function")return P.from(m[Symbol.toPrimitive]("string"),y,N);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof m)}P.from=function(m,y,N){return U(m,y,N)},Object.setPrototypeOf(P.prototype,T.prototype),Object.setPrototypeOf(P,T);function re(m){if(typeof m!="number")throw new TypeError('"size" argument must be of type number');if(m<0)throw new RangeError('The value "'+m+'" is invalid for option "size"')}function X(m,y,N){return re(m),m<=0?F(m):y!==void 0?typeof N=="string"?F(m).fill(y,N):F(m).fill(y):F(m)}P.alloc=function(m,y,N){return X(m,y,N)};function K(m){return re(m),F(m<0?0:z(m)|0)}P.allocUnsafe=function(m){return K(m)},P.allocUnsafeSlow=function(m){return K(m)};function W(m,y){if((typeof y!="string"||y==="")&&(y="utf8"),!P.isEncoding(y))throw new TypeError("Unknown encoding: "+y);const N=ce(m,y)|0;let L=F(N);const M=L.write(m,y);return M!==N&&(L=L.slice(0,M)),L}function ne(m){const y=m.length<0?0:z(m.length)|0,N=F(y);for(let L=0;L<y;L+=1)N[L]=m[L]&255;return N}function se(m){if(xs(m,T)){const y=new T(m);return Z(y.buffer,y.byteOffset,y.byteLength)}return ne(m)}function Z(m,y,N){if(y<0||m.byteLength<y)throw new RangeError('"offset" is outside of buffer bounds');if(m.byteLength<y+(N||0))throw new RangeError('"length" is outside of buffer bounds');let L;return y===void 0&&N===void 0?L=new T(m):N===void 0?L=new T(m,y):L=new T(m,y,N),Object.setPrototypeOf(L,P.prototype),L}function _(m){if(P.isBuffer(m)){const y=z(m.length)|0,N=F(y);return N.length===0||m.copy(N,0,0,y),N}if(m.length!==void 0)return typeof m.length!="number"||cf(m.length)?F(0):ne(m);if(m.type==="Buffer"&&Array.isArray(m.data))return ne(m.data)}function z(m){if(m>=x)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+x.toString(16)+" bytes");return m|0}function oe(m){return+m!=m&&(m=0),P.alloc(+m)}P.isBuffer=function(m){return m!=null&&m._isBuffer===!0&&m!==P.prototype},P.compare=function(m,y){if(xs(m,T)&&(m=P.from(m,m.offset,m.byteLength)),xs(y,T)&&(y=P.from(y,y.offset,y.byteLength)),!P.isBuffer(m)||!P.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(m===y)return 0;let N=m.length,L=y.length;for(let M=0,Y=Math.min(N,L);M<Y;++M)if(m[M]!==y[M]){N=m[M],L=y[M];break}return N<L?-1:L<N?1:0},P.isEncoding=function(m){switch(String(m).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},P.concat=function(m,y){if(!Array.isArray(m))throw new TypeError('"list" argument must be an Array of Buffers');if(m.length===0)return P.alloc(0);let N;if(y===void 0)for(y=0,N=0;N<m.length;++N)y+=m[N].length;const L=P.allocUnsafe(y);let M=0;for(N=0;N<m.length;++N){let Y=m[N];if(xs(Y,T))M+Y.length>L.length?(P.isBuffer(Y)||(Y=P.from(Y)),Y.copy(L,M)):T.prototype.set.call(L,Y,M);else if(P.isBuffer(Y))Y.copy(L,M);else throw new TypeError('"list" argument must be an Array of Buffers');M+=Y.length}return L};function ce(m,y){if(P.isBuffer(m))return m.length;if(B.isView(m)||xs(m,B))return m.byteLength;if(typeof m!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof m);const N=m.length,L=arguments.length>2&&arguments[2]===!0;if(!L&&N===0)return 0;let M=!1;for(;;)switch(y){case"ascii":case"latin1":case"binary":return N;case"utf8":case"utf-8":return uf(m).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N*2;case"hex":return N>>>1;case"base64":return qd(m).length;default:if(M)return L?-1:uf(m).length;y=(""+y).toLowerCase(),M=!0}}P.byteLength=ce;function ue(m,y,N){let L=!1;if((y===void 0||y<0)&&(y=0),y>this.length||((N===void 0||N>this.length)&&(N=this.length),N<=0)||(N>>>=0,y>>>=0,N<=y))return"";for(m||(m="utf8");;)switch(m){case"hex":return eh(this,y,N);case"utf8":case"utf-8":return wt(this,y,N);case"ascii":return ws(this,y,N);case"latin1":case"binary":return nf(this,y,N);case"base64":return Ze(this,y,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return pu(this,y,N);default:if(L)throw new TypeError("Unknown encoding: "+m);m=(m+"").toLowerCase(),L=!0}}P.prototype._isBuffer=!0;function fe(m,y,N){const L=m[y];m[y]=m[N],m[N]=L}P.prototype.swap16=function(){const m=this.length;if(m%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<m;y+=2)fe(this,y,y+1);return this},P.prototype.swap32=function(){const m=this.length;if(m%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<m;y+=4)fe(this,y,y+3),fe(this,y+1,y+2);return this},P.prototype.swap64=function(){const m=this.length;if(m%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<m;y+=8)fe(this,y,y+7),fe(this,y+1,y+6),fe(this,y+2,y+5),fe(this,y+3,y+4);return this},P.prototype.toString=function(){const m=this.length;return m===0?"":arguments.length===0?wt(this,0,m):ue.apply(this,arguments)},P.prototype.toLocaleString=P.prototype.toString,P.prototype.equals=function(m){if(!P.isBuffer(m))throw new TypeError("Argument must be a Buffer");return this===m?!0:P.compare(this,m)===0},P.prototype.inspect=function(){let m="";const y=p.INSPECT_MAX_BYTES;return m=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(m+=" ... "),"<Buffer "+m+">"},O&&(P.prototype[O]=P.prototype.inspect),P.prototype.compare=function(m,y,N,L,M){if(xs(m,T)&&(m=P.from(m,m.offset,m.byteLength)),!P.isBuffer(m))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof m);if(y===void 0&&(y=0),N===void 0&&(N=m?m.length:0),L===void 0&&(L=0),M===void 0&&(M=this.length),y<0||N>m.length||L<0||M>this.length)throw new RangeError("out of range index");if(L>=M&&y>=N)return 0;if(L>=M)return-1;if(y>=N)return 1;if(y>>>=0,N>>>=0,L>>>=0,M>>>=0,this===m)return 0;let Y=M-L,ie=N-y;const Le=Math.min(Y,ie),vt=this.slice(L,M),$e=m.slice(y,N);for(let De=0;De<Le;++De)if(vt[De]!==$e[De]){Y=vt[De],ie=$e[De];break}return Y<ie?-1:ie<Y?1:0};function V(m,y,N,L,M){if(m.length===0)return-1;if(typeof N=="string"?(L=N,N=0):N>2147483647?N=2147483647:N<-2147483648&&(N=-2147483648),N=+N,cf(N)&&(N=M?0:m.length-1),N<0&&(N=m.length+N),N>=m.length){if(M)return-1;N=m.length-1}else if(N<0)if(M)N=0;else return-1;if(typeof y=="string"&&(y=P.from(y,L)),P.isBuffer(y))return y.length===0?-1:S(m,y,N,L,M);if(typeof y=="number")return y=y&255,typeof T.prototype.indexOf=="function"?M?T.prototype.indexOf.call(m,y,N):T.prototype.lastIndexOf.call(m,y,N):S(m,[y],N,L,M);throw new TypeError("val must be string, number or Buffer")}function S(m,y,N,L,M){let Y=1,ie=m.length,Le=y.length;if(L!==void 0&&(L=String(L).toLowerCase(),L==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(m.length<2||y.length<2)return-1;Y=2,ie/=2,Le/=2,N/=2}function vt(De,et){return Y===1?De[et]:De.readUInt16BE(et*Y)}let $e;if(M){let De=-1;for($e=N;$e<ie;$e++)if(vt(m,$e)===vt(y,De===-1?0:$e-De)){if(De===-1&&(De=$e),$e-De+1===Le)return De*Y}else De!==-1&&($e-=$e-De),De=-1}else for(N+Le>ie&&(N=ie-Le),$e=N;$e>=0;$e--){let De=!0;for(let et=0;et<Le;et++)if(vt(m,$e+et)!==vt(y,et)){De=!1;break}if(De)return $e}return-1}P.prototype.includes=function(m,y,N){return this.indexOf(m,y,N)!==-1},P.prototype.indexOf=function(m,y,N){return V(this,m,y,N,!0)},P.prototype.lastIndexOf=function(m,y,N){return V(this,m,y,N,!1)};function $(m,y,N,L){N=Number(N)||0;const M=m.length-N;L?(L=Number(L),L>M&&(L=M)):L=M;const Y=y.length;L>Y/2&&(L=Y/2);let ie;for(ie=0;ie<L;++ie){const Le=parseInt(y.substr(ie*2,2),16);if(cf(Le))return ie;m[N+ie]=Le}return ie}function R(m,y,N,L){return th(uf(y,m.length-N),m,N,L)}function me(m,y,N,L){return th(m0(y),m,N,L)}function ge(m,y,N,L){return th(qd(y),m,N,L)}function he(m,y,N,L){return th(f0(y,m.length-N),m,N,L)}P.prototype.write=function(m,y,N,L){if(y===void 0)L="utf8",N=this.length,y=0;else if(N===void 0&&typeof y=="string")L=y,N=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(N)?(N=N>>>0,L===void 0&&(L="utf8")):(L=N,N=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const M=this.length-y;if((N===void 0||N>M)&&(N=M),m.length>0&&(N<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");L||(L="utf8");let Y=!1;for(;;)switch(L){case"hex":return $(this,m,y,N);case"utf8":case"utf-8":return R(this,m,y,N);case"ascii":case"latin1":case"binary":return me(this,m,y,N);case"base64":return ge(this,m,y,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return he(this,m,y,N);default:if(Y)throw new TypeError("Unknown encoding: "+L);L=(""+L).toLowerCase(),Y=!0}},P.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ze(m,y,N){return y===0&&N===m.length?w.fromByteArray(m):w.fromByteArray(m.slice(y,N))}function wt(m,y,N){N=Math.min(m.length,N);const L=[];let M=y;for(;M<N;){const Y=m[M];let ie=null,Le=Y>239?4:Y>223?3:Y>191?2:1;if(M+Le<=N){let vt,$e,De,et;switch(Le){case 1:Y<128&&(ie=Y);break;case 2:vt=m[M+1],(vt&192)===128&&(et=(Y&31)<<6|vt&63,et>127&&(ie=et));break;case 3:vt=m[M+1],$e=m[M+2],(vt&192)===128&&($e&192)===128&&(et=(Y&15)<<12|(vt&63)<<6|$e&63,et>2047&&(et<55296||et>57343)&&(ie=et));break;case 4:vt=m[M+1],$e=m[M+2],De=m[M+3],(vt&192)===128&&($e&192)===128&&(De&192)===128&&(et=(Y&15)<<18|(vt&63)<<12|($e&63)<<6|De&63,et>65535&&et<1114112&&(ie=et))}}ie===null?(ie=65533,Le=1):ie>65535&&(ie-=65536,L.push(ie>>>10&1023|55296),ie=56320|ie&1023),L.push(ie),M+=Le}return ut(L)}const Hs=4096;function ut(m){const y=m.length;if(y<=Hs)return String.fromCharCode.apply(String,m);let N="",L=0;for(;L<y;)N+=String.fromCharCode.apply(String,m.slice(L,L+=Hs));return N}function ws(m,y,N){let L="";N=Math.min(m.length,N);for(let M=y;M<N;++M)L+=String.fromCharCode(m[M]&127);return L}function nf(m,y,N){let L="";N=Math.min(m.length,N);for(let M=y;M<N;++M)L+=String.fromCharCode(m[M]);return L}function eh(m,y,N){const L=m.length;(!y||y<0)&&(y=0),(!N||N<0||N>L)&&(N=L);let M="";for(let Y=y;Y<N;++Y)M+=p0[m[Y]];return M}function pu(m,y,N){const L=m.slice(y,N);let M="";for(let Y=0;Y<L.length-1;Y+=2)M+=String.fromCharCode(L[Y]+L[Y+1]*256);return M}P.prototype.slice=function(m,y){const N=this.length;m=~~m,y=y===void 0?N:~~y,m<0?(m+=N,m<0&&(m=0)):m>N&&(m=N),y<0?(y+=N,y<0&&(y=0)):y>N&&(y=N),y<m&&(y=m);const L=this.subarray(m,y);return Object.setPrototypeOf(L,P.prototype),L};function ze(m,y,N){if(m%1!==0||m<0)throw new RangeError("offset is not uint");if(m+y>N)throw new RangeError("Trying to access beyond buffer length")}P.prototype.readUintLE=P.prototype.readUIntLE=function(m,y,N){m=m>>>0,y=y>>>0,N||ze(m,y,this.length);let L=this[m],M=1,Y=0;for(;++Y<y&&(M*=256);)L+=this[m+Y]*M;return L},P.prototype.readUintBE=P.prototype.readUIntBE=function(m,y,N){m=m>>>0,y=y>>>0,N||ze(m,y,this.length);let L=this[m+--y],M=1;for(;y>0&&(M*=256);)L+=this[m+--y]*M;return L},P.prototype.readUint8=P.prototype.readUInt8=function(m,y){return m=m>>>0,y||ze(m,1,this.length),this[m]},P.prototype.readUint16LE=P.prototype.readUInt16LE=function(m,y){return m=m>>>0,y||ze(m,2,this.length),this[m]|this[m+1]<<8},P.prototype.readUint16BE=P.prototype.readUInt16BE=function(m,y){return m=m>>>0,y||ze(m,2,this.length),this[m]<<8|this[m+1]},P.prototype.readUint32LE=P.prototype.readUInt32LE=function(m,y){return m=m>>>0,y||ze(m,4,this.length),(this[m]|this[m+1]<<8|this[m+2]<<16)+this[m+3]*16777216},P.prototype.readUint32BE=P.prototype.readUInt32BE=function(m,y){return m=m>>>0,y||ze(m,4,this.length),this[m]*16777216+(this[m+1]<<16|this[m+2]<<8|this[m+3])},P.prototype.readBigUInt64LE=Sr(function(m){m=m>>>0,fi(m,"offset");const y=this[m],N=this[m+7];(y===void 0||N===void 0)&&du(m,this.length-8);const L=y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24,M=this[++m]+this[++m]*2**8+this[++m]*2**16+N*2**24;return BigInt(L)+(BigInt(M)<<BigInt(32))}),P.prototype.readBigUInt64BE=Sr(function(m){m=m>>>0,fi(m,"offset");const y=this[m],N=this[m+7];(y===void 0||N===void 0)&&du(m,this.length-8);const L=y*2**24+this[++m]*2**16+this[++m]*2**8+this[++m],M=this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+N;return(BigInt(L)<<BigInt(32))+BigInt(M)}),P.prototype.readIntLE=function(m,y,N){m=m>>>0,y=y>>>0,N||ze(m,y,this.length);let L=this[m],M=1,Y=0;for(;++Y<y&&(M*=256);)L+=this[m+Y]*M;return M*=128,L>=M&&(L-=Math.pow(2,8*y)),L},P.prototype.readIntBE=function(m,y,N){m=m>>>0,y=y>>>0,N||ze(m,y,this.length);let L=y,M=1,Y=this[m+--L];for(;L>0&&(M*=256);)Y+=this[m+--L]*M;return M*=128,Y>=M&&(Y-=Math.pow(2,8*y)),Y},P.prototype.readInt8=function(m,y){return m=m>>>0,y||ze(m,1,this.length),this[m]&128?(255-this[m]+1)*-1:this[m]},P.prototype.readInt16LE=function(m,y){m=m>>>0,y||ze(m,2,this.length);const N=this[m]|this[m+1]<<8;return N&32768?N|4294901760:N},P.prototype.readInt16BE=function(m,y){m=m>>>0,y||ze(m,2,this.length);const N=this[m+1]|this[m]<<8;return N&32768?N|4294901760:N},P.prototype.readInt32LE=function(m,y){return m=m>>>0,y||ze(m,4,this.length),this[m]|this[m+1]<<8|this[m+2]<<16|this[m+3]<<24},P.prototype.readInt32BE=function(m,y){return m=m>>>0,y||ze(m,4,this.length),this[m]<<24|this[m+1]<<16|this[m+2]<<8|this[m+3]},P.prototype.readBigInt64LE=Sr(function(m){m=m>>>0,fi(m,"offset");const y=this[m],N=this[m+7];(y===void 0||N===void 0)&&du(m,this.length-8);const L=this[m+4]+this[m+5]*2**8+this[m+6]*2**16+(N<<24);return(BigInt(L)<<BigInt(32))+BigInt(y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24)}),P.prototype.readBigInt64BE=Sr(function(m){m=m>>>0,fi(m,"offset");const y=this[m],N=this[m+7];(y===void 0||N===void 0)&&du(m,this.length-8);const L=(y<<24)+this[++m]*2**16+this[++m]*2**8+this[++m];return(BigInt(L)<<BigInt(32))+BigInt(this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+N)}),P.prototype.readFloatLE=function(m,y){return m=m>>>0,y||ze(m,4,this.length),E.read(this,m,!0,23,4)},P.prototype.readFloatBE=function(m,y){return m=m>>>0,y||ze(m,4,this.length),E.read(this,m,!1,23,4)},P.prototype.readDoubleLE=function(m,y){return m=m>>>0,y||ze(m,8,this.length),E.read(this,m,!0,52,8)},P.prototype.readDoubleBE=function(m,y){return m=m>>>0,y||ze(m,8,this.length),E.read(this,m,!1,52,8)};function Jt(m,y,N,L,M,Y){if(!P.isBuffer(m))throw new TypeError('"buffer" argument must be a Buffer instance');if(y>M||y<Y)throw new RangeError('"value" argument is out of bounds');if(N+L>m.length)throw new RangeError("Index out of range")}P.prototype.writeUintLE=P.prototype.writeUIntLE=function(m,y,N,L){if(m=+m,y=y>>>0,N=N>>>0,!L){const ie=Math.pow(2,8*N)-1;Jt(this,m,y,N,ie,0)}let M=1,Y=0;for(this[y]=m&255;++Y<N&&(M*=256);)this[y+Y]=m/M&255;return y+N},P.prototype.writeUintBE=P.prototype.writeUIntBE=function(m,y,N,L){if(m=+m,y=y>>>0,N=N>>>0,!L){const ie=Math.pow(2,8*N)-1;Jt(this,m,y,N,ie,0)}let M=N-1,Y=1;for(this[y+M]=m&255;--M>=0&&(Y*=256);)this[y+M]=m/Y&255;return y+N},P.prototype.writeUint8=P.prototype.writeUInt8=function(m,y,N){return m=+m,y=y>>>0,N||Jt(this,m,y,1,255,0),this[y]=m&255,y+1},P.prototype.writeUint16LE=P.prototype.writeUInt16LE=function(m,y,N){return m=+m,y=y>>>0,N||Jt(this,m,y,2,65535,0),this[y]=m&255,this[y+1]=m>>>8,y+2},P.prototype.writeUint16BE=P.prototype.writeUInt16BE=function(m,y,N){return m=+m,y=y>>>0,N||Jt(this,m,y,2,65535,0),this[y]=m>>>8,this[y+1]=m&255,y+2},P.prototype.writeUint32LE=P.prototype.writeUInt32LE=function(m,y,N){return m=+m,y=y>>>0,N||Jt(this,m,y,4,4294967295,0),this[y+3]=m>>>24,this[y+2]=m>>>16,this[y+1]=m>>>8,this[y]=m&255,y+4},P.prototype.writeUint32BE=P.prototype.writeUInt32BE=function(m,y,N){return m=+m,y=y>>>0,N||Jt(this,m,y,4,4294967295,0),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4};function $d(m,y,N,L,M){Fd(y,L,M,m,N,7);let Y=Number(y&BigInt(4294967295));m[N++]=Y,Y=Y>>8,m[N++]=Y,Y=Y>>8,m[N++]=Y,Y=Y>>8,m[N++]=Y;let ie=Number(y>>BigInt(32)&BigInt(4294967295));return m[N++]=ie,ie=ie>>8,m[N++]=ie,ie=ie>>8,m[N++]=ie,ie=ie>>8,m[N++]=ie,N}function jd(m,y,N,L,M){Fd(y,L,M,m,N,7);let Y=Number(y&BigInt(4294967295));m[N+7]=Y,Y=Y>>8,m[N+6]=Y,Y=Y>>8,m[N+5]=Y,Y=Y>>8,m[N+4]=Y;let ie=Number(y>>BigInt(32)&BigInt(4294967295));return m[N+3]=ie,ie=ie>>8,m[N+2]=ie,ie=ie>>8,m[N+1]=ie,ie=ie>>8,m[N]=ie,N+8}P.prototype.writeBigUInt64LE=Sr(function(m,y=0){return $d(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),P.prototype.writeBigUInt64BE=Sr(function(m,y=0){return jd(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),P.prototype.writeIntLE=function(m,y,N,L){if(m=+m,y=y>>>0,!L){const Le=Math.pow(2,8*N-1);Jt(this,m,y,N,Le-1,-Le)}let M=0,Y=1,ie=0;for(this[y]=m&255;++M<N&&(Y*=256);)m<0&&ie===0&&this[y+M-1]!==0&&(ie=1),this[y+M]=(m/Y>>0)-ie&255;return y+N},P.prototype.writeIntBE=function(m,y,N,L){if(m=+m,y=y>>>0,!L){const Le=Math.pow(2,8*N-1);Jt(this,m,y,N,Le-1,-Le)}let M=N-1,Y=1,ie=0;for(this[y+M]=m&255;--M>=0&&(Y*=256);)m<0&&ie===0&&this[y+M+1]!==0&&(ie=1),this[y+M]=(m/Y>>0)-ie&255;return y+N},P.prototype.writeInt8=function(m,y,N){return m=+m,y=y>>>0,N||Jt(this,m,y,1,127,-128),m<0&&(m=255+m+1),this[y]=m&255,y+1},P.prototype.writeInt16LE=function(m,y,N){return m=+m,y=y>>>0,N||Jt(this,m,y,2,32767,-32768),this[y]=m&255,this[y+1]=m>>>8,y+2},P.prototype.writeInt16BE=function(m,y,N){return m=+m,y=y>>>0,N||Jt(this,m,y,2,32767,-32768),this[y]=m>>>8,this[y+1]=m&255,y+2},P.prototype.writeInt32LE=function(m,y,N){return m=+m,y=y>>>0,N||Jt(this,m,y,4,2147483647,-2147483648),this[y]=m&255,this[y+1]=m>>>8,this[y+2]=m>>>16,this[y+3]=m>>>24,y+4},P.prototype.writeInt32BE=function(m,y,N){return m=+m,y=y>>>0,N||Jt(this,m,y,4,2147483647,-2147483648),m<0&&(m=4294967295+m+1),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4},P.prototype.writeBigInt64LE=Sr(function(m,y=0){return $d(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),P.prototype.writeBigInt64BE=Sr(function(m,y=0){return jd(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Kd(m,y,N,L,M,Y){if(N+L>m.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("Index out of range")}function Md(m,y,N,L,M){return y=+y,N=N>>>0,M||Kd(m,y,N,4),E.write(m,y,N,L,23,4),N+4}P.prototype.writeFloatLE=function(m,y,N){return Md(this,m,y,!0,N)},P.prototype.writeFloatBE=function(m,y,N){return Md(this,m,y,!1,N)};function Hd(m,y,N,L,M){return y=+y,N=N>>>0,M||Kd(m,y,N,8),E.write(m,y,N,L,52,8),N+8}P.prototype.writeDoubleLE=function(m,y,N){return Hd(this,m,y,!0,N)},P.prototype.writeDoubleBE=function(m,y,N){return Hd(this,m,y,!1,N)},P.prototype.copy=function(m,y,N,L){if(!P.isBuffer(m))throw new TypeError("argument should be a Buffer");if(N||(N=0),!L&&L!==0&&(L=this.length),y>=m.length&&(y=m.length),y||(y=0),L>0&&L<N&&(L=N),L===N||m.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("Index out of range");if(L<0)throw new RangeError("sourceEnd out of bounds");L>this.length&&(L=this.length),m.length-y<L-N&&(L=m.length-y+N);const M=L-N;return this===m&&typeof T.prototype.copyWithin=="function"?this.copyWithin(y,N,L):T.prototype.set.call(m,this.subarray(N,L),y),M},P.prototype.fill=function(m,y,N,L){if(typeof m=="string"){if(typeof y=="string"?(L=y,y=0,N=this.length):typeof N=="string"&&(L=N,N=this.length),L!==void 0&&typeof L!="string")throw new TypeError("encoding must be a string");if(typeof L=="string"&&!P.isEncoding(L))throw new TypeError("Unknown encoding: "+L);if(m.length===1){const Y=m.charCodeAt(0);(L==="utf8"&&Y<128||L==="latin1")&&(m=Y)}}else typeof m=="number"?m=m&255:typeof m=="boolean"&&(m=Number(m));if(y<0||this.length<y||this.length<N)throw new RangeError("Out of range index");if(N<=y)return this;y=y>>>0,N=N===void 0?this.length:N>>>0,m||(m=0);let M;if(typeof m=="number")for(M=y;M<N;++M)this[M]=m;else{const Y=P.isBuffer(m)?m:P.from(m,L),ie=Y.length;if(ie===0)throw new TypeError('The value "'+m+'" is invalid for argument "value"');for(M=0;M<N-y;++M)this[M+y]=Y[M%ie]}return this};const mi={};function of(m,y,N){mi[m]=class extends N{constructor(){super(),Object.defineProperty(this,"message",{value:y.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${m}]`,this.stack,delete this.name}get code(){return m}set code(L){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:L,writable:!0})}toString(){return`${this.name} [${m}]: ${this.message}`}}}of("ERR_BUFFER_OUT_OF_BOUNDS",function(m){return m?`${m} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),of("ERR_INVALID_ARG_TYPE",function(m,y){return`The "${m}" argument must be of type number. Received type ${typeof y}`},TypeError),of("ERR_OUT_OF_RANGE",function(m,y,N){let L=`The value of "${m}" is out of range.`,M=N;return Number.isInteger(N)&&Math.abs(N)>2**32?M=Jd(String(N)):typeof N=="bigint"&&(M=String(N),(N>BigInt(2)**BigInt(32)||N<-(BigInt(2)**BigInt(32)))&&(M=Jd(M)),M+="n"),L+=` It must be ${y}. Received ${M}`,L},RangeError);function Jd(m){let y="",N=m.length;const L=m[0]==="-"?1:0;for(;N>=L+4;N-=3)y=`_${m.slice(N-3,N)}${y}`;return`${m.slice(0,N)}${y}`}function c0(m,y,N){fi(y,"offset"),(m[y]===void 0||m[y+N]===void 0)&&du(y,m.length-(N+1))}function Fd(m,y,N,L,M,Y){if(m>N||m<y){const ie=typeof y=="bigint"?"n":"";let Le;throw y===0||y===BigInt(0)?Le=`>= 0${ie} and < 2${ie} ** ${(Y+1)*8}${ie}`:Le=`>= -(2${ie} ** ${(Y+1)*8-1}${ie}) and < 2 ** ${(Y+1)*8-1}${ie}`,new mi.ERR_OUT_OF_RANGE("value",Le,m)}c0(L,M,Y)}function fi(m,y){if(typeof m!="number")throw new mi.ERR_INVALID_ARG_TYPE(y,"number",m)}function du(m,y,N){throw Math.floor(m)!==m?(fi(m,N),new mi.ERR_OUT_OF_RANGE("offset","an integer",m)):y<0?new mi.ERR_BUFFER_OUT_OF_BOUNDS:new mi.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${y}`,m)}const l0=/[^+/0-9A-Za-z-_]/g;function h0(m){if(m=m.split("=")[0],m=m.trim().replace(l0,""),m.length<2)return"";for(;m.length%4!==0;)m=m+"=";return m}function uf(m,y){y=y||1/0;let N;const L=m.length;let M=null;const Y=[];for(let ie=0;ie<L;++ie){if(N=m.charCodeAt(ie),N>55295&&N<57344){if(!M){if(N>56319){(y-=3)>-1&&Y.push(239,191,189);continue}else if(ie+1===L){(y-=3)>-1&&Y.push(239,191,189);continue}M=N;continue}if(N<56320){(y-=3)>-1&&Y.push(239,191,189),M=N;continue}N=(M-55296<<10|N-56320)+65536}else M&&(y-=3)>-1&&Y.push(239,191,189);if(M=null,N<128){if((y-=1)<0)break;Y.push(N)}else if(N<2048){if((y-=2)<0)break;Y.push(N>>6|192,N&63|128)}else if(N<65536){if((y-=3)<0)break;Y.push(N>>12|224,N>>6&63|128,N&63|128)}else if(N<1114112){if((y-=4)<0)break;Y.push(N>>18|240,N>>12&63|128,N>>6&63|128,N&63|128)}else throw new Error("Invalid code point")}return Y}function m0(m){const y=[];for(let N=0;N<m.length;++N)y.push(m.charCodeAt(N)&255);return y}function f0(m,y){let N,L,M;const Y=[];for(let ie=0;ie<m.length&&!((y-=2)<0);++ie)N=m.charCodeAt(ie),L=N>>8,M=N%256,Y.push(M),Y.push(L);return Y}function qd(m){return w.toByteArray(h0(m))}function th(m,y,N,L){let M;for(M=0;M<L&&!(M+N>=y.length||M>=m.length);++M)y[M+N]=m[M];return M}function xs(m,y){return m instanceof y||m!=null&&m.constructor!=null&&m.constructor.name!=null&&m.constructor.name===y.name}function cf(m){return m!==m}const p0=function(){const m="0123456789abcdef",y=new Array(256);for(let N=0;N<16;++N){const L=N*16;for(let M=0;M<16;++M)y[L+M]=m[N]+m[M]}return y}();function Sr(m){return typeof BigInt>"u"?d0:m}function d0(){throw new Error("BigInt not supported")}}(e);const I=e.Buffer;r.Blob=e.Blob,r.BlobOptions=e.BlobOptions,r.Buffer=e.Buffer,r.File=e.File,r.FileOptions=e.FileOptions,r.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,r.SlowBuffer=e.SlowBuffer,r.TranscodeEncoding=e.TranscodeEncoding,r.atob=e.atob,r.btoa=e.btoa,r.constants=e.constants,r.default=I,r.isAscii=e.isAscii,r.isUtf8=e.isUtf8,r.kMaxLength=e.kMaxLength,r.kStringMaxLength=e.kStringMaxLength,r.resolveObjectURL=e.resolveObjectURL,r.transcode=e.transcode}(vg)),vg}var Sg;function Cv(){return Sg||(Sg=1,function(r,e){var t=Ev(),s=t.Buffer;function a(i,o){for(var l in i)o[l]=i[l]}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?r.exports=t:(a(t,e),e.Buffer=n);function n(i,o,l){return s(i,o,l)}n.prototype=Object.create(s.prototype),a(s,n),n.from=function(i,o,l){if(typeof i=="number")throw new TypeError("Argument must not be a number");return s(i,o,l)},n.alloc=function(i,o,l){if(typeof i!="number")throw new TypeError("Argument must be a number");var u=s(i);return o!==void 0?typeof l=="string"?u.fill(o,l):u.fill(o):u.fill(0),u},n.allocUnsafe=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return s(i)},n.allocUnsafeSlow=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(i)}}(Nf,Nf.exports)),Nf.exports}var Ag;function kv(){if(Ag)return Af;Ag=1;var r=Cv().Buffer,e=r.isEncoding||function(I){switch(I=""+I,I&&I.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(I){if(!I)return"utf8";for(var p;;)switch(I){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return I;default:if(p)return;I=(""+I).toLowerCase(),p=!0}}function s(I){var p=t(I);if(typeof p!="string"&&(r.isEncoding===e||!e(I)))throw new Error("Unknown encoding: "+I);return p||I}Af.StringDecoder=a;function a(I){this.encoding=s(I);var p;switch(this.encoding){case"utf16le":this.text=f,this.end=h,p=4;break;case"utf8":this.fillLast=l,p=4;break;case"base64":this.text=v,this.end=d,p=3;break;default:this.write=A,this.end=b;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(p)}a.prototype.write=function(I){if(I.length===0)return"";var p,w;if(this.lastNeed){if(p=this.fillLast(I),p===void 0)return"";w=this.lastNeed,this.lastNeed=0}else w=0;return w<I.length?p?p+this.text(I,w):this.text(I,w):p||""},a.prototype.end=c,a.prototype.text=u,a.prototype.fillLast=function(I){if(this.lastNeed<=I.length)return I.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);I.copy(this.lastChar,this.lastTotal-this.lastNeed,0,I.length),this.lastNeed-=I.length};function n(I){return I<=127?0:I>>5===6?2:I>>4===14?3:I>>3===30?4:I>>6===2?-1:-2}function i(I,p,w){var E=p.length-1;if(E<w)return 0;var O=n(p[E]);return O>=0?(O>0&&(I.lastNeed=O-1),O):--E<w||O===-2?0:(O=n(p[E]),O>=0?(O>0&&(I.lastNeed=O-2),O):--E<w||O===-2?0:(O=n(p[E]),O>=0?(O>0&&(O===2?O=0:I.lastNeed=O-3),O):0))}function o(I,p,w){if((p[0]&192)!==128)return I.lastNeed=0,"�";if(I.lastNeed>1&&p.length>1){if((p[1]&192)!==128)return I.lastNeed=1,"�";if(I.lastNeed>2&&p.length>2&&(p[2]&192)!==128)return I.lastNeed=2,"�"}}function l(I){var p=this.lastTotal-this.lastNeed,w=o(this,I);if(w!==void 0)return w;if(this.lastNeed<=I.length)return I.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);I.copy(this.lastChar,p,0,I.length),this.lastNeed-=I.length}function u(I,p){var w=i(this,I,p);if(!this.lastNeed)return I.toString("utf8",p);this.lastTotal=w;var E=I.length-(w-this.lastNeed);return I.copy(this.lastChar,0,E),I.toString("utf8",p,E)}function c(I){var p=I&&I.length?this.write(I):"";return this.lastNeed?p+"�":p}function f(I,p){if((I.length-p)%2===0){var w=I.toString("utf16le",p);if(w){var E=w.charCodeAt(w.length-1);if(E>=55296&&E<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=I[I.length-2],this.lastChar[1]=I[I.length-1],w.slice(0,-1)}return w}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=I[I.length-1],I.toString("utf16le",p,I.length-1)}function h(I){var p=I&&I.length?this.write(I):"";if(this.lastNeed){var w=this.lastTotal-this.lastNeed;return p+this.lastChar.toString("utf16le",0,w)}return p}function v(I,p){var w=(I.length-p)%3;return w===0?I.toString("base64",p):(this.lastNeed=3-w,this.lastTotal=3,w===1?this.lastChar[0]=I[I.length-1]:(this.lastChar[0]=I[I.length-2],this.lastChar[1]=I[I.length-1]),I.toString("base64",p,I.length-w))}function d(I){var p=I&&I.length?this.write(I):"";return this.lastNeed?p+this.lastChar.toString("base64",0,3-this.lastNeed):p}function A(I){return I.toString(this.encoding)}function b(I){return I&&I.length?this.write(I):""}return Af}var Iv=kv();const Vv=Sy(Iv);var Ef={},md=(r=>(r.DEFAULT="default",r.HIDDEN="hidden",r))(md||{});class Bv{_action;constructor(e){this.validateAction(e),this._action=e}get id(){return this._action.id}get displayName(){return this._action.displayName}get title(){return this._action.title}get iconSvgInline(){return this._action.iconSvgInline}get enabled(){return this._action.enabled}get exec(){return this._action.exec}get execBatch(){return this._action.execBatch}get hotkey(){return this._action.hotkey}get order(){return this._action.order}get parent(){return this._action.parent}get default(){return this._action.default}get destructive(){return this._action.destructive}get inline(){return this._action.inline}get renderInline(){return this._action.renderInline}validateAction(e){if(!e.id||typeof e.id!="string")throw new Error("Invalid id");if(!e.displayName||typeof e.displayName!="function")throw new Error("Invalid displayName function");if("title"in e&&typeof e.title!="function")throw new Error("Invalid title function");if(!e.iconSvgInline||typeof e.iconSvgInline!="function")throw new Error("Invalid iconSvgInline function");if(!e.exec||typeof e.exec!="function")throw new Error("Invalid exec function");if("enabled"in e&&typeof e.enabled!="function")throw new Error("Invalid enabled function");if("execBatch"in e&&typeof e.execBatch!="function")throw new Error("Invalid execBatch function");if("order"in e&&typeof e.order!="number")throw new Error("Invalid order");if(e.destructive!==void 0&&typeof e.destructive!="boolean")throw new Error("Invalid destructive flag");if("parent"in e&&typeof e.parent!="string")throw new Error("Invalid parent");if(e.default&&!Object.values(md).includes(e.default))throw new Error("Invalid default");if("inline"in e&&typeof e.inline!="function")throw new Error("Invalid inline function");if("renderInline"in e&&typeof e.renderInline!="function")throw new Error("Invalid renderInline function");if("hotkey"in e&&e.hotkey!==void 0){if(typeof e.hotkey!="object")throw new Error("Invalid hotkey configuration");if(typeof e.hotkey.key!="string"||!e.hotkey.key)throw new Error("Missing or invalid hotkey key");if(typeof e.hotkey.description!="string"||!e.hotkey.description)throw new Error("Missing or invalid hotkey description")}}}const xv=function(r){if(typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],mr.debug("FileActions initialized")),window._nc_fileactions.find(e=>e.id===r.id)){mr.error(`FileAction ${r.id} already registered`,{action:r});return}window._nc_fileactions.push(r)},Ov=function(){return typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],mr.debug("FileActions initialized")),window._nc_fileactions};var Ng,Eg;function aw(){return Eg||(Eg=1,Ng=typeof ct=="object"&&Ef&&Ef.NODE_DEBUG&&/\bsemver\b/i.test(Ef.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{}),Ng}var Cf,Cg;function nw(){if(Cg)return Cf;Cg=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,s=16,a=e-6;return Cf={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Cf}var kf={exports:{}},kg;function Pv(){return kg||(kg=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:a}=nw(),n=aw();e=r.exports={};const i=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.t={};let c=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",a],[f,s]],v=A=>{for(const[b,I]of h)A=A.split(`${b}*`).join(`${b}{0,${I}}`).split(`${b}+`).join(`${b}{1,${I}}`);return A},d=(A,b,I)=>{const p=v(b),w=c++;n(A,w,b),u[A]=w,l[w]=b,i[w]=new RegExp(b,I?"g":void 0),o[w]=new RegExp(p,I?"g":void 0)};d("NUMERICIDENTIFIER","0|[1-9]\\d*"),d("NUMERICIDENTIFIERLOOSE","\\d+"),d("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),d("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),d("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),d("PRERELEASEIDENTIFIER",`(?:${l[u.NUMERICIDENTIFIER]}|${l[u.NONNUMERICIDENTIFIER]})`),d("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NUMERICIDENTIFIERLOOSE]}|${l[u.NONNUMERICIDENTIFIER]})`),d("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),d("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),d("BUILDIDENTIFIER",`${f}+`),d("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),d("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),d("FULL",`^${l[u.FULLPLAIN]}$`),d("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),d("LOOSE",`^${l[u.LOOSEPLAIN]}$`),d("GTLT","((?:<|>)?=?)"),d("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),d("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),d("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),d("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),d("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),d("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),d("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),d("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),d("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?(?:${l[u.BUILD]})?(?:$|[^\\d])`),d("COERCERTL",l[u.COERCE],!0),d("COERCERTLFULL",l[u.COERCEFULL],!0),d("LONETILDE","(?:~>?)"),d("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",d("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),d("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),d("LONECARET","(?:\\^)"),d("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",d("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),d("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),d("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),d("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),d("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",d("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),d("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),d("STAR","(<|>)?=?\\s*\\*"),d("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),d("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(kf,kf.exports)),kf.exports}var If,Ig;function Dv(){if(Ig)return If;Ig=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return If=t=>t?typeof t!="object"?r:t:e,If}var Vf,Vg;function Tv(){if(Vg)return Vf;Vg=1;const r=/^[0-9]+$/,e=(t,s)=>{const a=r.test(t),n=r.test(s);return a&&n&&(t=+t,s=+s),t===s?0:a&&!n?-1:n&&!a?1:t<s?-1:1};return Vf={compareIdentifiers:e,rcompareIdentifiers:(t,s)=>e(s,t)},Vf}var Bf,Bg;function iw(){if(Bg)return Bf;Bg=1;const r=aw(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=nw(),{safeRe:s,t:a}=Pv(),n=Dv(),{compareIdentifiers:i}=Tv();class o{constructor(u,c){if(c=n(c),u instanceof o){if(u.loose===!!c.loose&&u.includePrerelease===!!c.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof u}".`);if(u.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",u,c),this.options=c,this.loose=!!c.loose,this.includePrerelease=!!c.includePrerelease;const f=u.trim().match(c.loose?s[a.LOOSE]:s[a.FULL]);if(!f)throw new TypeError(`Invalid Version: ${u}`);if(this.raw=u,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const v=+h;if(v>=0&&v<t)return v}return h}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(u){if(r("SemVer.compare",this.version,this.options,u),!(u instanceof o)){if(typeof u=="string"&&u===this.version)return 0;u=new o(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof o||(u=new o(u,this.options)),i(this.major,u.major)||i(this.minor,u.minor)||i(this.patch,u.patch)}comparePre(u){if(u instanceof o||(u=new o(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let c=0;do{const f=this.prerelease[c],h=u.prerelease[c];if(r("prerelease compare",c,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f!==h)return i(f,h)}while(++c)}compareBuild(u){u instanceof o||(u=new o(u,this.options));let c=0;do{const f=this.build[c],h=u.build[c];if(r("build compare",c,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f!==h)return i(f,h)}while(++c)}inc(u,c,f){switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",c,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",c,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",c,f),this.inc("pre",c,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",c,f),this.inc("pre",c,f);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(f)?1:0;if(!c&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[h];else{let v=this.prerelease.length;for(;--v>=0;)typeof this.prerelease[v]=="number"&&(this.prerelease[v]++,v=-2);if(v===-1){if(c===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(c){let v=[c,h];f===!1&&(v=[c]),i(this.prerelease[0],c)===0?isNaN(this.prerelease[1])&&(this.prerelease=v):this.prerelease=v}break}default:throw new Error(`invalid increment argument: ${u}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return Bf=o,Bf}var xf,xg;function Lv(){if(xg)return xf;xg=1;const r=iw();return xf=(e,t,s=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(a){if(!s)return null;throw a}},xf}var Of,Og;function Rv(){if(Og)return Of;Og=1;const r=Lv();return Of=(e,t)=>{const s=r(e,t);return s?s.version:null},Of}Rv();var Pf,Pg;function Uv(){if(Pg)return Pf;Pg=1;const r=iw();return Pf=(e,t)=>new r(e,t).major,Pf}Uv();var Dg={},Tg;function $v(){return Tg||(Tg=1,function(r){(function(e){e.parser=function(V,S){return new s(V,S)},e.SAXParser=s,e.SAXStream=c,e.createStream=u,e.MAX_BUFFER_LENGTH=64*1024;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function s(V,S){if(!(this instanceof s))return new s(V,S);var $=this;n($),$.q=$.c="",$.bufferCheckPosition=e.MAX_BUFFER_LENGTH,$.opt=S||{},$.opt.lowercase=$.opt.lowercase||$.opt.lowercasetags,$.looseCase=$.opt.lowercase?"toLowerCase":"toUpperCase",$.tags=[],$.closed=$.closedRoot=$.sawRoot=!1,$.tag=$.error=null,$.strict=!!V,$.noscript=!!(V||$.opt.noscript),$.state=k.BEGIN,$.strictEntities=$.opt.strictEntities,$.ENTITIES=$.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),$.attribList=[],$.opt.xmlns&&($.ns=Object.create(A)),$.opt.unquotedAttributeValues===void 0&&($.opt.unquotedAttributeValues=!V),$.trackPosition=$.opt.position!==!1,$.trackPosition&&($.position=$.line=$.column=0),F($,"onready")}Object.create||(Object.create=function(V){function S(){}S.prototype=V;var $=new S;return $}),Object.keys||(Object.keys=function(V){var S=[];for(var $ in V)V.hasOwnProperty($)&&S.push($);return S});function a(V){for(var S=Math.max(e.MAX_BUFFER_LENGTH,10),$=0,R=0,me=t.length;R<me;R++){var ge=V[t[R]].length;if(ge>S)switch(t[R]){case"textNode":U(V);break;case"cdata":P(V,"oncdata",V.cdata),V.cdata="";break;case"script":P(V,"onscript",V.script),V.script="";break;default:X(V,"Max buffer length exceeded: "+t[R])}$=Math.max($,ge)}var he=e.MAX_BUFFER_LENGTH-$;V.bufferCheckPosition=he+V.position}function n(V){for(var S=0,$=t.length;S<$;S++)V[t[S]]=""}function i(V){U(V),V.cdata!==""&&(P(V,"oncdata",V.cdata),V.cdata=""),V.script!==""&&(P(V,"onscript",V.script),V.script="")}s.prototype={end:function(){K(this)},write:fe,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){i(this)}};var o;try{o=require("stream").Stream}catch{o=function(){}}o||(o=function(){});var l=e.EVENTS.filter(function(V){return V!=="error"&&V!=="end"});function u(V,S){return new c(V,S)}function c(V,S){if(!(this instanceof c))return new c(V,S);o.apply(this),this._parser=new s(V,S),this.writable=!0,this.readable=!0;var $=this;this._parser.onend=function(){$.emit("end")},this._parser.onerror=function(R){$.emit("error",R),$._parser.error=null},this._decoder=null,l.forEach(function(R){Object.defineProperty($,"on"+R,{get:function(){return $._parser["on"+R]},set:function(me){if(!me)return $.removeAllListeners(R),$._parser["on"+R]=me,me;$.on(R,me)},enumerable:!0,configurable:!1})})}c.prototype=Object.create(o.prototype,{constructor:{value:c}}),c.prototype.write=function(V){if(typeof lf=="function"&&typeof lf.isBuffer=="function"&&lf.isBuffer(V)){if(!this._decoder){var S=Vv.StringDecoder;this._decoder=new S("utf8")}V=this._decoder.write(V)}return this._parser.write(V.toString()),this.emit("data",V),!0},c.prototype.end=function(V){return V&&V.length&&this.write(V),this._parser.end(),!0},c.prototype.on=function(V,S){var $=this;return!$._parser["on"+V]&&l.indexOf(V)!==-1&&($._parser["on"+V]=function(){var R=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);R.splice(0,0,V),$.emit.apply($,R)}),o.prototype.on.call($,V,S)};var f="[CDATA[",h="DOCTYPE",v="http://www.w3.org/XML/1998/namespace",d="http://www.w3.org/2000/xmlns/",A={xml:v,xmlns:d},b=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,I=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,p=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,w=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function E(V){return V===" "||V===`
`||V==="\r"||V==="	"}function O(V){return V==='"'||V==="'"}function x(V){return V===">"||E(V)}function T(V,S){return V.test(S)}function B(V,S){return!T(V,S)}var k=0;e.STATE={BEGIN:k++,BEGIN_WHITESPACE:k++,TEXT:k++,TEXT_ENTITY:k++,OPEN_WAKA:k++,SGML_DECL:k++,SGML_DECL_QUOTED:k++,DOCTYPE:k++,DOCTYPE_QUOTED:k++,DOCTYPE_DTD:k++,DOCTYPE_DTD_QUOTED:k++,COMMENT_STARTING:k++,COMMENT:k++,COMMENT_ENDING:k++,COMMENT_ENDED:k++,CDATA:k++,CDATA_ENDING:k++,CDATA_ENDING_2:k++,PROC_INST:k++,PROC_INST_BODY:k++,PROC_INST_ENDING:k++,OPEN_TAG:k++,OPEN_TAG_SLASH:k++,ATTRIB:k++,ATTRIB_NAME:k++,ATTRIB_NAME_SAW_WHITE:k++,ATTRIB_VALUE:k++,ATTRIB_VALUE_QUOTED:k++,ATTRIB_VALUE_CLOSED:k++,ATTRIB_VALUE_UNQUOTED:k++,ATTRIB_VALUE_ENTITY_Q:k++,ATTRIB_VALUE_ENTITY_U:k++,CLOSE_TAG:k++,CLOSE_TAG_SAW_WHITE:k++,SCRIPT:k++,SCRIPT_ENDING:k++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(V){var S=e.ENTITIES[V],$=typeof S=="number"?String.fromCharCode(S):S;e.ENTITIES[V]=$});for(var J in e.STATE)e.STATE[e.STATE[J]]=J;k=e.STATE;function F(V,S,$){V[S]&&V[S]($)}function P(V,S,$){V.textNode&&U(V),F(V,S,$)}function U(V){V.textNode=re(V.opt,V.textNode),V.textNode&&F(V,"ontext",V.textNode),V.textNode=""}function re(V,S){return V.trim&&(S=S.trim()),V.normalize&&(S=S.replace(/\s+/g," ")),S}function X(V,S){return U(V),V.trackPosition&&(S+=`
Line: `+V.line+`
Column: `+V.column+`
Char: `+V.c),S=new Error(S),V.error=S,F(V,"onerror",S),V}function K(V){return V.sawRoot&&!V.closedRoot&&W(V,"Unclosed root tag"),V.state!==k.BEGIN&&V.state!==k.BEGIN_WHITESPACE&&V.state!==k.TEXT&&X(V,"Unexpected end"),U(V),V.c="",V.closed=!0,F(V,"onend"),s.call(V,V.strict,V.opt),V}function W(V,S){if(typeof V!="object"||!(V instanceof s))throw new Error("bad call to strictFail");V.strict&&X(V,S)}function ne(V){V.strict||(V.tagName=V.tagName[V.looseCase]());var S=V.tags[V.tags.length-1]||V,$=V.tag={name:V.tagName,attributes:{}};V.opt.xmlns&&($.ns=S.ns),V.attribList.length=0,P(V,"onopentagstart",$)}function se(V,S){var $=V.indexOf(":"),R=$<0?["",V]:V.split(":"),me=R[0],ge=R[1];return S&&V==="xmlns"&&(me="xmlns",ge=""),{prefix:me,local:ge}}function Z(V){if(V.strict||(V.attribName=V.attribName[V.looseCase]()),V.attribList.indexOf(V.attribName)!==-1||V.tag.attributes.hasOwnProperty(V.attribName)){V.attribName=V.attribValue="";return}if(V.opt.xmlns){var S=se(V.attribName,!0),$=S.prefix,R=S.local;if($==="xmlns")if(R==="xml"&&V.attribValue!==v)W(V,"xml: prefix must be bound to "+v+`
Actual: `+V.attribValue);else if(R==="xmlns"&&V.attribValue!==d)W(V,"xmlns: prefix must be bound to "+d+`
Actual: `+V.attribValue);else{var me=V.tag,ge=V.tags[V.tags.length-1]||V;me.ns===ge.ns&&(me.ns=Object.create(ge.ns)),me.ns[R]=V.attribValue}V.attribList.push([V.attribName,V.attribValue])}else V.tag.attributes[V.attribName]=V.attribValue,P(V,"onattribute",{name:V.attribName,value:V.attribValue});V.attribName=V.attribValue=""}function _(V,S){if(V.opt.xmlns){var $=V.tag,R=se(V.tagName);$.prefix=R.prefix,$.local=R.local,$.uri=$.ns[R.prefix]||"",$.prefix&&!$.uri&&(W(V,"Unbound namespace prefix: "+JSON.stringify(V.tagName)),$.uri=R.prefix);var me=V.tags[V.tags.length-1]||V;$.ns&&me.ns!==$.ns&&Object.keys($.ns).forEach(function(ze){P(V,"onopennamespace",{prefix:ze,uri:$.ns[ze]})});for(var ge=0,he=V.attribList.length;ge<he;ge++){var Ze=V.attribList[ge],wt=Ze[0],Hs=Ze[1],ut=se(wt,!0),ws=ut.prefix,nf=ut.local,eh=ws===""?"":$.ns[ws]||"",pu={name:wt,value:Hs,prefix:ws,local:nf,uri:eh};ws&&ws!=="xmlns"&&!eh&&(W(V,"Unbound namespace prefix: "+JSON.stringify(ws)),pu.uri=ws),V.tag.attributes[wt]=pu,P(V,"onattribute",pu)}V.attribList.length=0}V.tag.isSelfClosing=!!S,V.sawRoot=!0,V.tags.push(V.tag),P(V,"onopentag",V.tag),S||(!V.noscript&&V.tagName.toLowerCase()==="script"?V.state=k.SCRIPT:V.state=k.TEXT,V.tag=null,V.tagName=""),V.attribName=V.attribValue="",V.attribList.length=0}function z(V){if(!V.tagName){W(V,"Weird empty close tag."),V.textNode+="</>",V.state=k.TEXT;return}if(V.script){if(V.tagName!=="script"){V.script+="</"+V.tagName+">",V.tagName="",V.state=k.SCRIPT;return}P(V,"onscript",V.script),V.script=""}var S=V.tags.length,$=V.tagName;V.strict||($=$[V.looseCase]());for(var R=$;S--;){var me=V.tags[S];if(me.name!==R)W(V,"Unexpected close tag");else break}if(S<0){W(V,"Unmatched closing tag: "+V.tagName),V.textNode+="</"+V.tagName+">",V.state=k.TEXT;return}V.tagName=$;for(var ge=V.tags.length;ge-- >S;){var he=V.tag=V.tags.pop();V.tagName=V.tag.name,P(V,"onclosetag",V.tagName);var Ze={};for(var wt in he.ns)Ze[wt]=he.ns[wt];var Hs=V.tags[V.tags.length-1]||V;V.opt.xmlns&&he.ns!==Hs.ns&&Object.keys(he.ns).forEach(function(ut){var ws=he.ns[ut];P(V,"onclosenamespace",{prefix:ut,uri:ws})})}S===0&&(V.closedRoot=!0),V.tagName=V.attribValue=V.attribName="",V.attribList.length=0,V.state=k.TEXT}function oe(V){var S=V.entity,$=S.toLowerCase(),R,me="";return V.ENTITIES[S]?V.ENTITIES[S]:V.ENTITIES[$]?V.ENTITIES[$]:(S=$,S.charAt(0)==="#"&&(S.charAt(1)==="x"?(S=S.slice(2),R=parseInt(S,16),me=R.toString(16)):(S=S.slice(1),R=parseInt(S,10),me=R.toString(10))),S=S.replace(/^0+/,""),isNaN(R)||me.toLowerCase()!==S?(W(V,"Invalid character entity"),"&"+V.entity+";"):String.fromCodePoint(R))}function ce(V,S){S==="<"?(V.state=k.OPEN_WAKA,V.startTagPosition=V.position):E(S)||(W(V,"Non-whitespace before first tag."),V.textNode=S,V.state=k.TEXT)}function ue(V,S){var $="";return S<V.length&&($=V.charAt(S)),$}function fe(V){var S=this;if(this.error)throw this.error;if(S.closed)return X(S,"Cannot write after close. Assign an onready handler.");if(V===null)return K(S);typeof V=="object"&&(V=V.toString());for(var $=0,R="";R=ue(V,$++),S.c=R,!!R;)switch(S.trackPosition&&(S.position++,R===`
`?(S.line++,S.column=0):S.column++),S.state){case k.BEGIN:if(S.state=k.BEGIN_WHITESPACE,R==="\uFEFF")continue;ce(S,R);continue;case k.BEGIN_WHITESPACE:ce(S,R);continue;case k.TEXT:if(S.sawRoot&&!S.closedRoot){for(var me=$-1;R&&R!=="<"&&R!=="&";)R=ue(V,$++),R&&S.trackPosition&&(S.position++,R===`
`?(S.line++,S.column=0):S.column++);S.textNode+=V.substring(me,$-1)}R==="<"&&!(S.sawRoot&&S.closedRoot&&!S.strict)?(S.state=k.OPEN_WAKA,S.startTagPosition=S.position):(!E(R)&&(!S.sawRoot||S.closedRoot)&&W(S,"Text data outside of root node."),R==="&"?S.state=k.TEXT_ENTITY:S.textNode+=R);continue;case k.SCRIPT:R==="<"?S.state=k.SCRIPT_ENDING:S.script+=R;continue;case k.SCRIPT_ENDING:R==="/"?S.state=k.CLOSE_TAG:(S.script+="<"+R,S.state=k.SCRIPT);continue;case k.OPEN_WAKA:if(R==="!")S.state=k.SGML_DECL,S.sgmlDecl="";else if(!E(R))if(T(b,R))S.state=k.OPEN_TAG,S.tagName=R;else if(R==="/")S.state=k.CLOSE_TAG,S.tagName="";else if(R==="?")S.state=k.PROC_INST,S.procInstName=S.procInstBody="";else{if(W(S,"Unencoded <"),S.startTagPosition+1<S.position){var ge=S.position-S.startTagPosition;R=new Array(ge).join(" ")+R}S.textNode+="<"+R,S.state=k.TEXT}continue;case k.SGML_DECL:if(S.sgmlDecl+R==="--"){S.state=k.COMMENT,S.comment="",S.sgmlDecl="";continue}S.doctype&&S.doctype!==!0&&S.sgmlDecl?(S.state=k.DOCTYPE_DTD,S.doctype+="<!"+S.sgmlDecl+R,S.sgmlDecl=""):(S.sgmlDecl+R).toUpperCase()===f?(P(S,"onopencdata"),S.state=k.CDATA,S.sgmlDecl="",S.cdata=""):(S.sgmlDecl+R).toUpperCase()===h?(S.state=k.DOCTYPE,(S.doctype||S.sawRoot)&&W(S,"Inappropriately located doctype declaration"),S.doctype="",S.sgmlDecl=""):R===">"?(P(S,"onsgmldeclaration",S.sgmlDecl),S.sgmlDecl="",S.state=k.TEXT):(O(R)&&(S.state=k.SGML_DECL_QUOTED),S.sgmlDecl+=R);continue;case k.SGML_DECL_QUOTED:R===S.q&&(S.state=k.SGML_DECL,S.q=""),S.sgmlDecl+=R;continue;case k.DOCTYPE:R===">"?(S.state=k.TEXT,P(S,"ondoctype",S.doctype),S.doctype=!0):(S.doctype+=R,R==="["?S.state=k.DOCTYPE_DTD:O(R)&&(S.state=k.DOCTYPE_QUOTED,S.q=R));continue;case k.DOCTYPE_QUOTED:S.doctype+=R,R===S.q&&(S.q="",S.state=k.DOCTYPE);continue;case k.DOCTYPE_DTD:R==="]"?(S.doctype+=R,S.state=k.DOCTYPE):R==="<"?(S.state=k.OPEN_WAKA,S.startTagPosition=S.position):O(R)?(S.doctype+=R,S.state=k.DOCTYPE_DTD_QUOTED,S.q=R):S.doctype+=R;continue;case k.DOCTYPE_DTD_QUOTED:S.doctype+=R,R===S.q&&(S.state=k.DOCTYPE_DTD,S.q="");continue;case k.COMMENT:R==="-"?S.state=k.COMMENT_ENDING:S.comment+=R;continue;case k.COMMENT_ENDING:R==="-"?(S.state=k.COMMENT_ENDED,S.comment=re(S.opt,S.comment),S.comment&&P(S,"oncomment",S.comment),S.comment=""):(S.comment+="-"+R,S.state=k.COMMENT);continue;case k.COMMENT_ENDED:R!==">"?(W(S,"Malformed comment"),S.comment+="--"+R,S.state=k.COMMENT):S.doctype&&S.doctype!==!0?S.state=k.DOCTYPE_DTD:S.state=k.TEXT;continue;case k.CDATA:R==="]"?S.state=k.CDATA_ENDING:S.cdata+=R;continue;case k.CDATA_ENDING:R==="]"?S.state=k.CDATA_ENDING_2:(S.cdata+="]"+R,S.state=k.CDATA);continue;case k.CDATA_ENDING_2:R===">"?(S.cdata&&P(S,"oncdata",S.cdata),P(S,"onclosecdata"),S.cdata="",S.state=k.TEXT):R==="]"?S.cdata+="]":(S.cdata+="]]"+R,S.state=k.CDATA);continue;case k.PROC_INST:R==="?"?S.state=k.PROC_INST_ENDING:E(R)?S.state=k.PROC_INST_BODY:S.procInstName+=R;continue;case k.PROC_INST_BODY:if(!S.procInstBody&&E(R))continue;R==="?"?S.state=k.PROC_INST_ENDING:S.procInstBody+=R;continue;case k.PROC_INST_ENDING:R===">"?(P(S,"onprocessinginstruction",{name:S.procInstName,body:S.procInstBody}),S.procInstName=S.procInstBody="",S.state=k.TEXT):(S.procInstBody+="?"+R,S.state=k.PROC_INST_BODY);continue;case k.OPEN_TAG:T(I,R)?S.tagName+=R:(ne(S),R===">"?_(S):R==="/"?S.state=k.OPEN_TAG_SLASH:(E(R)||W(S,"Invalid character in tag name"),S.state=k.ATTRIB));continue;case k.OPEN_TAG_SLASH:R===">"?(_(S,!0),z(S)):(W(S,"Forward-slash in opening tag not followed by >"),S.state=k.ATTRIB);continue;case k.ATTRIB:if(E(R))continue;R===">"?_(S):R==="/"?S.state=k.OPEN_TAG_SLASH:T(b,R)?(S.attribName=R,S.attribValue="",S.state=k.ATTRIB_NAME):W(S,"Invalid attribute name");continue;case k.ATTRIB_NAME:R==="="?S.state=k.ATTRIB_VALUE:R===">"?(W(S,"Attribute without value"),S.attribValue=S.attribName,Z(S),_(S)):E(R)?S.state=k.ATTRIB_NAME_SAW_WHITE:T(I,R)?S.attribName+=R:W(S,"Invalid attribute name");continue;case k.ATTRIB_NAME_SAW_WHITE:if(R==="=")S.state=k.ATTRIB_VALUE;else{if(E(R))continue;W(S,"Attribute without value"),S.tag.attributes[S.attribName]="",S.attribValue="",P(S,"onattribute",{name:S.attribName,value:""}),S.attribName="",R===">"?_(S):T(b,R)?(S.attribName=R,S.state=k.ATTRIB_NAME):(W(S,"Invalid attribute name"),S.state=k.ATTRIB)}continue;case k.ATTRIB_VALUE:if(E(R))continue;O(R)?(S.q=R,S.state=k.ATTRIB_VALUE_QUOTED):(S.opt.unquotedAttributeValues||X(S,"Unquoted attribute value"),S.state=k.ATTRIB_VALUE_UNQUOTED,S.attribValue=R);continue;case k.ATTRIB_VALUE_QUOTED:if(R!==S.q){R==="&"?S.state=k.ATTRIB_VALUE_ENTITY_Q:S.attribValue+=R;continue}Z(S),S.q="",S.state=k.ATTRIB_VALUE_CLOSED;continue;case k.ATTRIB_VALUE_CLOSED:E(R)?S.state=k.ATTRIB:R===">"?_(S):R==="/"?S.state=k.OPEN_TAG_SLASH:T(b,R)?(W(S,"No whitespace between attributes"),S.attribName=R,S.attribValue="",S.state=k.ATTRIB_NAME):W(S,"Invalid attribute name");continue;case k.ATTRIB_VALUE_UNQUOTED:if(!x(R)){R==="&"?S.state=k.ATTRIB_VALUE_ENTITY_U:S.attribValue+=R;continue}Z(S),R===">"?_(S):S.state=k.ATTRIB;continue;case k.CLOSE_TAG:if(S.tagName)R===">"?z(S):T(I,R)?S.tagName+=R:S.script?(S.script+="</"+S.tagName,S.tagName="",S.state=k.SCRIPT):(E(R)||W(S,"Invalid tagname in closing tag"),S.state=k.CLOSE_TAG_SAW_WHITE);else{if(E(R))continue;B(b,R)?S.script?(S.script+="</"+R,S.state=k.SCRIPT):W(S,"Invalid tagname in closing tag."):S.tagName=R}continue;case k.CLOSE_TAG_SAW_WHITE:if(E(R))continue;R===">"?z(S):W(S,"Invalid characters in closing tag");continue;case k.TEXT_ENTITY:case k.ATTRIB_VALUE_ENTITY_Q:case k.ATTRIB_VALUE_ENTITY_U:var he,Ze;switch(S.state){case k.TEXT_ENTITY:he=k.TEXT,Ze="textNode";break;case k.ATTRIB_VALUE_ENTITY_Q:he=k.ATTRIB_VALUE_QUOTED,Ze="attribValue";break;case k.ATTRIB_VALUE_ENTITY_U:he=k.ATTRIB_VALUE_UNQUOTED,Ze="attribValue";break}if(R===";"){var wt=oe(S);S.opt.unparsedEntities&&!Object.values(e.XML_ENTITIES).includes(wt)?(S.entity="",S.state=he,S.write(wt)):(S[Ze]+=wt,S.entity="",S.state=he)}else T(S.entity.length?w:p,R)?S.entity+=R:(W(S,"Invalid character in entity name"),S[Ze]+="&"+S.entity+R,S.entity="",S.state=he);continue;default:throw new Error(S,"Unknown state: "+S.state)}return S.position>=S.bufferCheckPosition&&a(S),S}String.fromCodePoint||function(){var V=String.fromCharCode,S=Math.floor,$=function(){var R=16384,me=[],ge,he,Ze=-1,wt=arguments.length;if(!wt)return"";for(var Hs="";++Ze<wt;){var ut=Number(arguments[Ze]);if(!isFinite(ut)||ut<0||ut>1114111||S(ut)!==ut)throw RangeError("Invalid code point: "+ut);ut<=65535?me.push(ut):(ut-=65536,ge=(ut>>10)+55296,he=ut%1024+56320,me.push(ge,he)),(Ze+1===wt||me.length>R)&&(Hs+=V.apply(null,me),me.length=0)}return Hs};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:$,configurable:!0,writable:!0}):String.fromCodePoint=$}()})(r)}(Dg)),Dg}$v();var ow=(r=>(r[r.UploadFromDevice=0]="UploadFromDevice",r[r.CreateNew=1]="CreateNew",r[r.Other=2]="Other",r))(ow||{});class jv{_entries=[];registerEntry(e){this.validateEntry(e),e.category=e.category??1,this._entries.push(e)}unregisterEntry(e){const t=typeof e=="string"?this.getEntryIndex(e):this.getEntryIndex(e.id);if(t===-1){mr.warn("Entry not found, nothing removed",{entry:e,entries:this.getEntries()});return}this._entries.splice(t,1)}getEntries(e){return e?this._entries.filter(t=>typeof t.enabled=="function"?t.enabled(e):!0):this._entries}getEntryIndex(e){return this._entries.findIndex(t=>t.id===e)}validateEntry(e){if(!e.id||!e.displayName||!(e.iconSvgInline||e.iconClass)||!e.handler)throw new Error("Invalid entry");if(typeof e.id!="string"||typeof e.displayName!="string")throw new Error("Invalid id or displayName property");if(e.iconClass&&typeof e.iconClass!="string"||e.iconSvgInline&&typeof e.iconSvgInline!="string")throw new Error("Invalid icon provided");if(e.enabled!==void 0&&typeof e.enabled!="function")throw new Error("Invalid enabled property");if(typeof e.handler!="function")throw new Error("Invalid handler property");if("order"in e&&typeof e.order!="number")throw new Error("Invalid order property");if(this.getEntryIndex(e.id)!==-1)throw new Error("Duplicate entry")}}function Kv(){return typeof window._nc_newfilemenu>"u"&&(window._nc_newfilemenu=new jv,mr.debug("NewFileMenu initialized")),window._nc_newfilemenu}function Mv(r){return Kv().registerEntry(r)}var Ep=(r=>(r.ReservedName="reserved name",r.Character="character",r.Extension="extension",r))(Ep||{});class oh extends Error{constructor(e){super(`Invalid ${e.reason} '${e.segment}' in filename '${e.filename}'`,{cause:e})}get filename(){return this.cause.filename}get reason(){return this.cause.reason}get segment(){return this.cause.segment}}function Hv(r){const e=b0().files,t=e.forbidden_filename_characters??window._oc_config?.forbidden_filenames_characters??["/","\\"];for(const i of t)if(r.includes(i))throw new oh({segment:i,reason:"character",filename:r});if(r=r.toLocaleLowerCase(),(e.forbidden_filenames??[".htaccess"]).includes(r))throw new oh({filename:r,segment:r,reason:"reserved name"});const s=r.indexOf(".",1),a=r.substring(0,s===-1?void 0:s);if((e.forbidden_filename_basenames??[]).includes(a))throw new oh({filename:r,segment:a,reason:"reserved name"});const n=e.forbidden_filename_extensions??[".part",".filepart"];for(const i of n)if(r.length>i.length&&r.endsWith(i))throw new oh({segment:i,reason:"extension",filename:r})}const Jv='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-arrow-down" viewBox="0 0 24 24"><path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" /></svg>';function Fv(r){if((r.permissions&ii.READ)===0)return!1;if(r.attributes["share-attributes"]){const e=JSON.parse(r.attributes["share-attributes"]||"[]").find(({scope:t,key:s})=>t==="permissions"&&s==="download");if(e!==void 0)return e.value===!0}return!0}async function qv(r){const[e]=r,t=await(await fetch(e.encodedSource)).arrayBuffer(),s=new Blob([t],{type:e.mime}),a=document.createElement("a");a.href=window.URL.createObjectURL(s),a.download=e.displayname,a.click()}const Wv=new Bv({id:"download_unencrypted",default:md.DEFAULT,displayName:()=>Ce("files","Download unencrypted"),iconSvgInline:()=>Jv,enabled(r){return r.length!==1||r.some(e=>e.attributes["e2ee-is-encrypted"]!==1)||r.some(e=>!e.isDavResource)||r.some(e=>e.type!==ld.File)?!1:r.every(Fv)},async exec(r){return qv([r]),null},order:30}),_v='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-folder-lock-outline" viewBox="0 0 24 24"><path d="M13 20H4C2.9 20 2 19.11 2 18V6C2 4.89 2.89 4 4 4H10L12 6H20C21.1 6 22 6.89 22 8V11.04C21.42 10.6 20.75 10.26 20 10.11V8H4V18H13V20M23 17.3V20.8C23 21.4 22.4 22 21.7 22H16.2C15.6 22 15 21.4 15 20.7V17.2C15 16.6 15.6 16 16.2 16V14.5C16.2 13.1 17.6 12 19 12S21.8 13.1 21.8 14.5V16C22.4 16 23 16.6 23 17.3M20.5 14.5C20.5 13.7 19.8 13.2 19 13.2S17.5 13.7 17.5 14.5V16H20.5V14.5Z" /></svg>',Gv="modulepreload",zv=function(r,e){return new URL(r,e).href},Lg={},Xv=function(r,e,t){let s=Promise.resolve();if(e&&e.length>0){let n=function(u){return Promise.all(u.map(c=>Promise.resolve(c).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const i=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");s=n(e.map(u=>{if(u=zv(u,t),u in Lg)return;Lg[u]=!0;const c=u.endsWith(".css"),f=c?'[rel="stylesheet"]':"";if(t)for(let v=i.length-1;v>=0;v--){const d=i[v];if(d.href===u&&(!c||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${f}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":Gv,c||(h.as="script"),h.crossOrigin="",h.href=u,l&&h.setAttribute("nonce",l),document.head.appendChild(h),c)return new Promise((v,d)=>{h.addEventListener("load",v),h.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(n){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n}return s.then(n=>{for(const i of n||[])i.status==="rejected"&&a(i.reason);return r().catch(a)})},Yv=["aria-labelledby"],Qv={key:0,class:"empty-content__icon","aria-hidden":"true"},Zv=["id"],eb={key:2,class:"empty-content__description"},tb={key:3,class:"empty-content__action"},sb=oi({__name:"NcEmptyContent",props:{description:{default:""},name:{default:""}},setup(r){const e=A0();return(t,s)=>(St(),va("div",{"aria-labelledby":xe(e),class:"empty-content",role:"note"},[t.$slots.icon?(St(),va("div",Qv,[sh(t.$slots,"icon",{},void 0,!0)])):qo("",!0),t.name!==""||t.$slots.name?(St(),va("div",{key:1,id:xe(e),class:"empty-content__name"},[sh(t.$slots,"name",{},()=>[Oa(Rs(t.name),1)],!0)],8,Zv)):qo("",!0),t.description!==""||t.$slots.description?(St(),va("p",eb,[sh(t.$slots,"description",{},()=>[Oa(Rs(t.description),1)],!0)])):qo("",!0),t.$slots.action?(St(),va("div",tb,[sh(t.$slots,"action",{},void 0,!0)])):qo("",!0)],8,Yv))}}),rb=S0(sb,[["__scopeId","data-v-b101d636"]]);function Cp(r){return String.fromCharCode(...new Uint8Array(r))}function Kl(r){return Uint8Array.from(r,e=>e.charCodeAt(0))}function Na(r){return r.toBase64()}function rs(r){return Uint8Array.fromBase64(r)}function ab(r){return r.toHex()}function fd(r){return new Uint8Array(By.decodeFirst(r))}function nb(r,e){const t={public:"PUBLIC KEY",private:"PRIVATE KEY",certificate:"CERTIFICATE",csr:"CERTIFICATE REQUEST"};return By.encode(r,t[e])}const pi="apps/end_to_end_encryption/api/v2",vr={Encrypted:pi+"/encrypted/{folderId}",Lock:pi+"/lock/{folderId}",Metadata:pi+"/meta-data/{fileId}",PrivateKey:pi+"/private-key",PublicKey:pi+"/public-key",ServerKey:pi+"/server-key"};async function uw(){try{const r=(await Ms.get(wr(vr.PrivateKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["private-key"],[e,t,s]=r.split("|");return{encryptedPrivateKey:rs(e),iv:rs(t),salt:rs(s)}}catch(r){if(Ay(r)&&r.response?.status===404)return Ne.debug("No private key found for the current user."),null;throw Ne.error("Error geting private key",{error:r}),r}}async function ib(r){const e=Na(r.encryptedPrivateKey)+"|"+Na(r.iv)+"|"+Na(r.salt);await Ms.post(wr(vr.PrivateKey),{privateKey:e},{headers:{"X-E2EE-SUPPORTED":"true"}})}async function ob(r){if(r??=cu().uid,!r)throw new Error("Cannot fetch a public key without specifying a user");try{return(await Ms.get(wr(vr.PublicKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["public-keys"][r]}catch(e){if(Ay(e)&&e.response?.status===404)return Ne.debug("No public key found for the current user."),null;throw Ne.error("Error getting public key",{error:e}),e}}async function ub(r){try{return(await Ms.post(wr(vr.PublicKey),{csr:r},{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["public-key"]}catch(e){throw Ne.error("Error creating public key",{error:e}),e}}async function cw(){return await(await Ms.get(wr(vr.ServerKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["public-key"]}async function cb(r){const e=wr(vr.Encrypted,{folderId:r});await Ms.put(e,{},{headers:{"X-E2EE-SUPPORTED":"true"}})}async function lb(r,e,t,s){const a=wr(vr.Lock,{folderId:r});return(await Ms.post(a,{"e2e-token":t,shareToken:s},{headers:{"X-NC-E2EE-COUNTER":e.toString(),"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["e2e-token"]}async function hb(r,e,t,s){const a=wr(vr.Lock,{folderId:r});await Ms.delete(a,{data:{abort:void 0,shareToken:t},headers:{"E2E-TOKEN":e,"X-E2EE-SUPPORTED":"true"}})}async function mb(r,e,t,s){const a=wr(vr.Metadata,{fileId:r});await Ms.post(a,{metaData:e},{headers:{"E2E-TOKEN":t,"X-NC-E2EE-SIGNATURE":s,"X-E2EE-SUPPORTED":"true"}})}class Ke{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let s=0;s<t;s++)this.view[s]=e.charCodeAt(s)}toString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)s+=String.fromCharCode(this.view[a]);return s}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const s=new Map;s.set("0",0),s.set("1",1),s.set("2",2),s.set("3",3),s.set("4",4),s.set("5",5),s.set("6",6),s.set("7",7),s.set("8",8),s.set("9",9),s.set("A",10),s.set("a",10),s.set("B",11),s.set("b",11),s.set("C",12),s.set("c",12),s.set("D",13),s.set("d",13),s.set("E",14),s.set("e",14),s.set("F",15),s.set("f",15);let a=0,n=0;for(let i=0;i<t;i++)i%2?(n|=s.get(e.charAt(i)),this.view[a]=n,a++):n=s.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){const n=this.view[a].toString(16).toUpperCase();s=s+(n.length==1?"0":"")+n}return s}copy(e=0,t=this.length-e){if(!e&&!this.length)return new Ke;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new Ke({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new Ke;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new Ke({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),s=new Uint8Array(t);e>this._view.length?s.set(this._view):s.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,s=e.length,a=e._view.subarray();this.realloc(t+s),this._view.set(a,t)}insert(e,t=0,s=this.length-t){return t>this.length-1?!1:(s>this.length-t&&(s=this.length-t),s>e.length&&(s=e.length),s==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,s),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a),l=e.length;if(l>i)return-1;const u=[];for(let c=0;c<l;c++)u.push(e.view[c]);for(let c=0;c<=i-l;c++){let f=!0;const h=o?n-l-c:n+c;for(let v=0;v<l;v++)if(this.view[v+h]!=u[v]){f=!1;break}if(f)return o?n-l-c:n+l+c}return-1}findFirstIn(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a),l={id:-1,position:o?0:n+i,length:0};for(let u=0;u<e.length;u++){const c=this.findPattern(e[u],n,i,o);if(c!=-1){let f=!1;const h=e[u].length;o?c-h>=l.position-l.length&&(f=!0):c-h<=l.position-l.length&&(f=!0),f&&(l.position=c,l.id=u,l.length=h)}}return l}findAllIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={id:-1,position:a};do{const l=o.position;if(o=this.findFirstIn(e,o.position,n),o.id==-1)break;n-=o.position-l,i.push({id:o.id,position:o.position})}while(!0);return i}findAllPatternIn(e,t,s){const{start:a,length:n}=this.prepareFindParameters(t,s),i=[],o=e.length;if(o>n)return-1;const l=Array.from(e.view);for(let u=0;u<=n-o;u++){let c=!0;const f=a+u;for(let h=0;h<o;h++)if(this.view[h+f]!=l[h]){c=!1;break}c&&(i.push(a+o+u),u+=o-1)}return i}findFirstNotIn(e,t,s,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);const l={left:{id:-1,position:n},right:{id:-1,position:0},value:new Ke};let u=i;for(;u>0;){if(l.right=this.findFirstIn(e,o?n-i+u:n+i-u,u,o),l.right.id==-1){i=u,o?n-=i:n=l.left.position,l.value=new Ke({buffer:this._buffer.slice(n,n+i)});break}if(l.right.position!=(o?l.left.position-e[l.right.id].length:l.left.position+e[l.right.id].length)){o?(n=l.right.position+e[l.right.id].length,i=l.left.position-l.right.position-e[l.right.id].length):(n=l.left.position,i=l.right.position-l.left.position-e[l.right.id].length),l.value=new Ke({buffer:this._buffer.slice(n,n+i)});break}l.left=l.right,u-=e[l.right.id].length}if(o){const c=l.right;l.right=l.left,l.left=c}return l}findAllNotIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={left:{id:-1,position:a},right:{id:-1,position:a},value:new Ke};do{const l=o.right.position;o=this.findFirstNotIn(e,o.right.position,n),n-=o.right.position-l,i.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(o.right.id!=-1);return i}findFirstSequence(e,t,s,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);const l=this.skipNotPatterns(e,n,i,o);if(l==-1)return{position:-1,value:new Ke};const u=this.skipPatterns(e,l,i-(o?n-l:l-n),o);o?(n=u,i=l-u):(n=l,i=u-l);const c=new Ke({buffer:this._buffer.slice(n,n+i)});return{position:u,value:c}}findAllSequences(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={position:a,value:new Ke};do{const l=o.position;o=this.findFirstSequence(e,o.position,n),o.position!=-1&&(n-=o.position-l,i.push({position:o.position,value:o.value}))}while(o.position!=-1);return i}findPairedPatterns(e,t,s,a){const n=[];if(e.isEqual(t))return n;const{start:i,length:o}=this.prepareFindParameters(s,a);let l=0;const u=this.findAllPatternIn(e,i,o);if(!Array.isArray(u)||u.length==0)return n;const c=this.findAllPatternIn(t,i,o);if(!Array.isArray(c)||c.length==0)return n;for(;l<u.length&&c.length!=0;){if(u[0]==c[0]){n.push({left:u[0],right:c[0]}),u.splice(0,1),c.splice(0,1);continue}if(u[l]>c[0])break;for(;u[l]<c[0]&&(l++,!(l>=u.length)););n.push({left:u[l-1],right:c[0]}),u.splice(l-1,1),c.splice(0,1),l=0}return n.sort((f,h)=>f.left-h.left),n}findPairedArrays(e,t,s,a){const{start:n,length:i}=this.prepareFindParameters(s,a),o=[];let l=0;const u=this.findAllIn(e,n,i);if(u.length==0)return o;const c=this.findAllIn(t,n,i);if(c.length==0)return o;for(;l<u.length&&c.length!=0;){if(u[0].position==c[0].position){o.push({left:u[0],right:c[0]}),u.splice(0,1),c.splice(0,1);continue}if(u[l].position>c[0].position)break;for(;u[l].position<c[0].position&&(l++,!(l>=u.length)););o.push({left:u[l-1],right:c[0]}),u.splice(l-1,1),c.splice(0,1),l=0}return o.sort((f,h)=>f.left.position-h.left.position),o}replacePattern(e,t,s,a,n=null){let i=[],o;const l={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:u,length:c}=this.prepareFindParameters(s,a);if(n==null){if(i=this.findAllIn([e],u,c),i.length==0)return l}else i=n;l.searchPatternPositions.push(...Array.from(i,d=>d.position));const f=e.length-t.length,h=new ArrayBuffer(this.view.length-i.length*f),v=new Uint8Array(h);for(v.set(new Uint8Array(this.buffer,0,u)),o=0;o<i.length;o++){const d=o==0?u:i[o-1].position;v.set(new Uint8Array(this.buffer,d,i[o].position-e.length-d),d-o*f),v.set(t.view,i[o].position-e.length-o*f),l.replacePatternPositions.push(i[o].position-e.length-o*f)}return o--,v.set(new Uint8Array(this.buffer,i[o].position,this.length-i[o].position),i[o].position-e.length+t.length-o*f),this.buffer=h,this.view=new Uint8Array(this.buffer),l.status=1,l}skipPatterns(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);let l=n;for(let u=0;u<e.length;u++){const c=e[u].length,f=o?l-c:l;let h=!0;for(let v=0;v<c;v++)if(this.view[v+f]!=e[u].view[v]){h=!1;break}if(h){if(u=-1,o){if(l-=c,l<=0)return l}else if(l+=c,l>=n+i)return l}}return l}skipNotPatterns(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);let l=-1;for(let u=0;u<i;u++){for(let c=0;c<e.length;c++){const f=e[c].length,h=o?n-u-f:n+u;let v=!0;for(let d=0;d<f;d++)if(this.view[d+h]!=e[c].view[d]){v=!1;break}if(v){l=o?n-u:n+u;break}}if(l!=-1)break}return l}prepareFindParameters(e=null,t=null,s=!1){return e===null&&(e=s?this.length:0),e>this.length&&(e=this.length),s?(t===null&&(t=e),t>e&&(t=e)):(t===null&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:s}}}const fb=16777216;class Pa{constructor(e={}){this._stream=new Ke,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new Ke({view:e.view}):"buffer"in e?this.stream=new Ke({buffer:e.buffer}):"string"in e?this.stream=new Ke({string:e.string}):"hexstring"in e?this.stream=new Ke({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new Ke,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findPattern(e,this.start,this.length,this.backward);if(s==-1)return s;if(this.backward){if(s<this.start-e.length-t)return-1}else if(s>this.start+e.length+t)return-1;return this.start=s,s}findFirstIn(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(s.id==-1)return s;if(this.backward){if(s.position<this.start-e[s.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(s.position>this.start+e[s.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=s.position,s}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(t==null||t>this._length)&&(t=this._length);const s=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(s.left.id==-1&&s.right.id==-1)return s;if(this.backward){if(s.right.id!=-1&&s.right.position<this._start-e[s.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Ke}}else if(s.left.id!=-1&&s.left.position>this._start+e[s.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Ke};return this.backward?s.left.id==-1?this.start=0:this.start=s.left.position:s.right.id==-1?this.start=this._start+this._length:this.start=s.right.position,s}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,s=null){(t==null||t>this._length)&&(t=this._length),(s==null||s>t)&&(s=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(a.value.length==0)return a;if(this.backward){if(a.position<this._start-a.value.length-s)return{position:-1,value:new Ke}}else if(a.position>this._start+a.value.length+s)return{position:-1,value:new Ke};return this.start=a.position,a}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right<this.start-t.length-s)return[]}else if(n[0].left>this.start+e.length+s)return[]}return n}findPairedArrays(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-s)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+s)return[]}return n}replacePattern(e,t){const s=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,s,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return t==-1?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),s=new Uint8Array(t.buffer);this.stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[2],this._stream.view[this._start+1]=s[1],this._stream.view[this._start+2]=s[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);this._length<e&&(e=this._length);let s;if(this.backward){const a=this._stream.view.subarray(this._length-e,this._length);s=new Uint8Array(e);for(let n=0;n<e;n++)s[e-1-n]=a[n]}else s=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),s}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),s=32768;return t&s?-(s-(t^s)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:t[0]*fb+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),s=2147483648;return t&s?-(s-(t^s)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+Pa.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}Pa.APPEND_BLOCK=1e3;function pb(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function lw(r,...e){if(!pb(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function Rg(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function db(r,e){lw(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const Df=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Os=(r,e)=>r<<32-e|r>>>e,Tf=(r,e)=>r<<e|r>>>32-e>>>0;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function gb(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function hw(r){return typeof r=="string"&&(r=gb(r)),lw(r),r}class yb{clone(){return this._cloneInto()}}function Zm(r){const e=s=>r().update(hw(s)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function wb(r,e,t,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,s);const a=BigInt(32),n=BigInt(4294967295),i=Number(t>>a&n),o=Number(t&n),l=s?4:0,u=s?0:4;r.setUint32(e+l,i,s),r.setUint32(e+u,o,s)}const mw=(r,e,t)=>r&e^~r&t,fw=(r,e,t)=>r&e^r&t^e&t;class pd extends yb{constructor(e,t,s,a){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Df(this.buffer)}update(e){Rg(this);const{view:t,buffer:s,blockLen:a}=this;e=hw(e);const n=e.length;for(let i=0;i<n;){const o=Math.min(a-this.pos,n-i);if(o===a){const l=Df(e);for(;a<=n-i;i+=a)this.process(l,i);continue}s.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Rg(this),db(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:a,isLE:n}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>a-i&&(this.process(s,0),i=0);for(let f=i;f<a;f++)t[f]=0;wb(s,a-8,BigInt(this.length*8),n),this.process(s,0);const o=Df(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=l/4,c=this.get();if(u>c.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)o.setUint32(4*f,c[f],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:a,finished:n,destroyed:i,pos:o}=this;return e.length=a,e.pos=o,e.finished=n,e.destroyed=i,a%t&&e.buffer.set(s),e}}const vu=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),Nr=new Uint32Array(80);let vb=class extends pd{constructor(){super(64,20,8,!1),this.A=vu[0]|0,this.B=vu[1]|0,this.C=vu[2]|0,this.D=vu[3]|0,this.E=vu[4]|0}get(){const{A:r,B:e,C:t,D:s,E:a}=this;return[r,e,t,s,a]}set(r,e,t,s,a){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0}process(r,e){for(let o=0;o<16;o++,e+=4)Nr[o]=r.getUint32(e,!1);for(let o=16;o<80;o++)Nr[o]=Tf(Nr[o-3]^Nr[o-8]^Nr[o-14]^Nr[o-16],1);let{A:t,B:s,C:a,D:n,E:i}=this;for(let o=0;o<80;o++){let l,u;o<20?(l=mw(s,a,n),u=1518500249):o<40?(l=s^a^n,u=1859775393):o<60?(l=fw(s,a,n),u=2400959708):(l=s^a^n,u=3395469782);const c=Tf(t,5)+l+i+u+Nr[o]|0;i=n,n=a,a=Tf(s,30),s=t,t=c}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,i=i+this.E|0,this.set(t,s,a,n,i)}roundClean(){Nr.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}};const bb=Zm(()=>new vb),Sb=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Er=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Cr=new Uint32Array(64);let Ab=class extends pd{constructor(){super(64,32,8,!1),this.A=Er[0]|0,this.B=Er[1]|0,this.C=Er[2]|0,this.D=Er[3]|0,this.E=Er[4]|0,this.F=Er[5]|0,this.G=Er[6]|0,this.H=Er[7]|0}get(){const{A:r,B:e,C:t,D:s,E:a,F:n,G:i,H:o}=this;return[r,e,t,s,a,n,i,o]}set(r,e,t,s,a,n,i,o){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0,this.F=n|0,this.G=i|0,this.H=o|0}process(r,e){for(let c=0;c<16;c++,e+=4)Cr[c]=r.getUint32(e,!1);for(let c=16;c<64;c++){const f=Cr[c-15],h=Cr[c-2],v=Os(f,7)^Os(f,18)^f>>>3,d=Os(h,17)^Os(h,19)^h>>>10;Cr[c]=d+Cr[c-7]+v+Cr[c-16]|0}let{A:t,B:s,C:a,D:n,E:i,F:o,G:l,H:u}=this;for(let c=0;c<64;c++){const f=Os(i,6)^Os(i,11)^Os(i,25),h=u+f+mw(i,o,l)+Sb[c]+Cr[c]|0,v=(Os(t,2)^Os(t,13)^Os(t,22))+fw(t,s,a)|0;u=l,l=o,o=i,i=n+h|0,n=a,a=s,s=t,t=h+v|0}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,i=i+this.E|0,o=o+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(t,s,a,n,i,o,l,u)}roundClean(){Cr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Nb=Zm(()=>new Ab),uh=BigInt(2**32-1),kp=BigInt(32);function pw(r,e=!1){return e?{h:Number(r&uh),l:Number(r>>kp&uh)}:{h:Number(r>>kp&uh)|0,l:Number(r&uh)|0}}function Eb(r,e=!1){let t=new Uint32Array(r.length),s=new Uint32Array(r.length);for(let a=0;a<r.length;a++){const{h:n,l:i}=pw(r[a],e);[t[a],s[a]]=[n,i]}return[t,s]}const Cb=(r,e)=>BigInt(r>>>0)<<kp|BigInt(e>>>0),kb=(r,e,t)=>r>>>t,Ib=(r,e,t)=>r<<32-t|e>>>t,Vb=(r,e,t)=>r>>>t|e<<32-t,Bb=(r,e,t)=>r<<32-t|e>>>t,xb=(r,e,t)=>r<<64-t|e>>>t-32,Ob=(r,e,t)=>r>>>t-32|e<<64-t,Pb=(r,e)=>e,Db=(r,e)=>r,Tb=(r,e,t)=>r<<t|e>>>32-t,Lb=(r,e,t)=>e<<t|r>>>32-t,Rb=(r,e,t)=>e<<t-32|r>>>64-t,Ub=(r,e,t)=>r<<t-32|e>>>64-t;function $b(r,e,t,s){const a=(e>>>0)+(s>>>0);return{h:r+t+(a/2**32|0)|0,l:a|0}}const jb=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Kb=(r,e,t,s)=>e+t+s+(r/2**32|0)|0,Mb=(r,e,t,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0),Hb=(r,e,t,s,a)=>e+t+s+a+(r/2**32|0)|0,Jb=(r,e,t,s,a)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0)+(a>>>0),Fb=(r,e,t,s,a,n)=>e+t+s+a+n+(r/2**32|0)|0,ve={fromBig:pw,split:Eb,toBig:Cb,shrSH:kb,shrSL:Ib,rotrSH:Vb,rotrSL:Bb,rotrBH:xb,rotrBL:Ob,rotr32H:Pb,rotr32L:Db,rotlSH:Tb,rotlSL:Lb,rotlBH:Rb,rotlBL:Ub,add:$b,add3L:jb,add3H:Kb,add4L:Mb,add4H:Hb,add5H:Fb,add5L:Jb},[qb,Wb]=ve.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),kr=new Uint32Array(80),Ir=new Uint32Array(80);let dw=class extends pd{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:r,Al:e,Bh:t,Bl:s,Ch:a,Cl:n,Dh:i,Dl:o,Eh:l,El:u,Fh:c,Fl:f,Gh:h,Gl:v,Hh:d,Hl:A}=this;return[r,e,t,s,a,n,i,o,l,u,c,f,h,v,d,A]}set(r,e,t,s,a,n,i,o,l,u,c,f,h,v,d,A){this.Ah=r|0,this.Al=e|0,this.Bh=t|0,this.Bl=s|0,this.Ch=a|0,this.Cl=n|0,this.Dh=i|0,this.Dl=o|0,this.Eh=l|0,this.El=u|0,this.Fh=c|0,this.Fl=f|0,this.Gh=h|0,this.Gl=v|0,this.Hh=d|0,this.Hl=A|0}process(r,e){for(let p=0;p<16;p++,e+=4)kr[p]=r.getUint32(e),Ir[p]=r.getUint32(e+=4);for(let p=16;p<80;p++){const w=kr[p-15]|0,E=Ir[p-15]|0,O=ve.rotrSH(w,E,1)^ve.rotrSH(w,E,8)^ve.shrSH(w,E,7),x=ve.rotrSL(w,E,1)^ve.rotrSL(w,E,8)^ve.shrSL(w,E,7),T=kr[p-2]|0,B=Ir[p-2]|0,k=ve.rotrSH(T,B,19)^ve.rotrBH(T,B,61)^ve.shrSH(T,B,6),J=ve.rotrSL(T,B,19)^ve.rotrBL(T,B,61)^ve.shrSL(T,B,6),F=ve.add4L(x,J,Ir[p-7],Ir[p-16]),P=ve.add4H(F,O,k,kr[p-7],kr[p-16]);kr[p]=P|0,Ir[p]=F|0}let{Ah:t,Al:s,Bh:a,Bl:n,Ch:i,Cl:o,Dh:l,Dl:u,Eh:c,El:f,Fh:h,Fl:v,Gh:d,Gl:A,Hh:b,Hl:I}=this;for(let p=0;p<80;p++){const w=ve.rotrSH(c,f,14)^ve.rotrSH(c,f,18)^ve.rotrBH(c,f,41),E=ve.rotrSL(c,f,14)^ve.rotrSL(c,f,18)^ve.rotrBL(c,f,41),O=c&h^~c&d,x=f&v^~f&A,T=ve.add5L(I,E,x,Wb[p],Ir[p]),B=ve.add5H(T,b,w,O,qb[p],kr[p]),k=T|0,J=ve.rotrSH(t,s,28)^ve.rotrBH(t,s,34)^ve.rotrBH(t,s,39),F=ve.rotrSL(t,s,28)^ve.rotrBL(t,s,34)^ve.rotrBL(t,s,39),P=t&a^t&i^a&i,U=s&n^s&o^n&o;b=d|0,I=A|0,d=h|0,A=v|0,h=c|0,v=f|0,{h:c,l:f}=ve.add(l|0,u|0,B|0,k|0),l=i|0,u=o|0,i=a|0,o=n|0,a=t|0,n=s|0;const re=ve.add3L(k,F,U);t=ve.add3H(re,B,J,P),s=re|0}({h:t,l:s}=ve.add(this.Ah|0,this.Al|0,t|0,s|0)),{h:a,l:n}=ve.add(this.Bh|0,this.Bl|0,a|0,n|0),{h:i,l:o}=ve.add(this.Ch|0,this.Cl|0,i|0,o|0),{h:l,l:u}=ve.add(this.Dh|0,this.Dl|0,l|0,u|0),{h:c,l:f}=ve.add(this.Eh|0,this.El|0,c|0,f|0),{h,l:v}=ve.add(this.Fh|0,this.Fl|0,h|0,v|0),{h:d,l:A}=ve.add(this.Gh|0,this.Gl|0,d|0,A|0),{h:b,l:I}=ve.add(this.Hh|0,this.Hl|0,b|0,I|0),this.set(t,s,a,n,i,o,l,u,c,f,h,v,d,A,b,I)}roundClean(){kr.fill(0),Ir.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},_b=class extends dw{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}};const Gb=Zm(()=>new dw),zb=Zm(()=>new _b),We=new ArrayBuffer(0),C="";class Ve extends TypeError{constructor(){super(...arguments),this.name=Ve.NAME}static isType(e,t){if(typeof t=="string"){if(t==="Array"&&Array.isArray(e)||t==="ArrayBuffer"&&e instanceof ArrayBuffer||t==="ArrayBufferView"&&ArrayBuffer.isView(e)||typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...s){for(const n of s)if(this.isType(e,n))return;const a=s.map(n=>n instanceof Function&&"name"in n?n.name:`${n}`);throw new Ve(`Parameter '${t}' is not of type ${a.length>1?`(${a.join(" or ")})`:a[0]}`)}}Ve.NAME="ArgumentError";class Se extends TypeError{static assert(...e){let t=null,s,a;typeof e[0]=="string"?(t=e[0],s=e[1],a=e.slice(2)):(s=e[0],a=e.slice(1)),Ve.assert(s,"parameters","object");for(const n of a)if(s[n]==null)throw new Se(n,t)}static assertEmpty(e,t,s){if(e==null)throw new Se(t,s)}constructor(e,t=null,s){super(),this.name=Se.NAME,this.field=e,t&&(this.target=t),s?this.message=s:this.message=`Absent mandatory parameter '${e}' ${t?` in '${t}'`:C}`}}Se.NAME="ParameterError";class G extends Error{static assertSchema(e,t){if(!e.verified)throw new Error(`Object's schema was not verified against input data for ${t}`)}static assert(e,t){if(e.offset===-1)throw new G(`Error during parsing of ASN.1 data. Data is not correct for '${t}'.`)}constructor(e){super(e),this.name="AsnError"}}class Q{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=ot(e);G.assert(t,this.name);try{return new this({schema:t.result})}catch{throw new G(`Cannot create '${this.CLASS_NAME}' from ASN.1 object`)}}static defaultValues(e){throw new Error(`Invalid member name for ${this.CLASS_NAME} class: ${e}`)}static schema(e={}){throw new Error(`Method '${this.CLASS_NAME}.schema' should be overridden`)}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch{t=this.toSchema(!0)}return ke.ToString(t.toBER(),e)}}Q.CLASS_NAME="PkiObject";function ga(r){let e=!1,t=C;const s=r.trim();for(let a=0;a<s.length;a++)s.charCodeAt(a)===32?e===!1&&(e=!0):(e&&(t+=" ",e=!1),t+=s[a]);return t.toLowerCase()}const bu="type",Lf="value";class Ea extends Q{constructor(e={}){super(),this.type=g(e,bu,Ea.defaultValues(bu)),this.value=g(e,Lf,Ea.defaultValues(Lf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bu:return C;case Lf:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.type||C}),new de({name:t.value||C})]})}fromSchema(e){ee(e,[bu,"typeValue"]);const t=te(e,e,Ea.schema({names:{type:bu,value:"typeValue"}}));G.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new D({value:[new le({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return Object.keys(this.value).length!==0?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[Em.blockName(),wp.blockName(),yp.blockName(),Rh.blockName(),nr.blockName(),gp.blockName(),R0.blockName(),xy.blockName(),U0.blockName(),$0.blockName(),j0.blockName(),K0.blockName()];if(e instanceof ArrayBuffer)return Te.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===Ea.blockName()){if(this.type!==e.type)return!1;const s=[!1,!1],a=this.value.constructor.blockName();for(const n of t)a===n&&(s[0]=!0),e.value.constructor.blockName()===n&&(s[1]=!0);if(s[0]!==s[1])return!1;if(s[0]&&s[1]){const n=ga(this.value.valueBlock.value),i=ga(e.value.valueBlock.value);if(n.localeCompare(i)!==0)return!1}else if(!Te.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}Ea.CLASS_NAME="AttributeTypeAndValue";const $a="typesAndValues",ch="valueBeforeDecode",Ug="RDN";class Be extends Q{constructor(e={}){super(),this.typesAndValues=g(e,$a,Be.defaultValues($a)),this.valueBeforeDecode=g(e,ch,Be.defaultValues(ch)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $a:return[];case ch:return We;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $a:return t.length===0;case ch:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.repeatedSequence||C,value:new at({value:[new ye({name:t.repeatedSet||C,value:Ea.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){ee(e,[Ug,$a]);const t=te(e,e,Be.schema({names:{blockName:Ug,repeatedSet:$a}}));G.assertSchema(t,this.className),$a in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,s=>new Ea({schema:s}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(this.valueBeforeDecode.byteLength===0)return new D({value:[new at({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=ot(this.valueBeforeDecode);if(G.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof D))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof Be){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,s]of this.typesAndValues.entries())if(s.isEqual(e.typesAndValues[t])===!1)return!1;return!0}return e instanceof ArrayBuffer?Ul(this.valueBeforeDecode,e):!1}}Be.CLASS_NAME="RelativeDistinguishedNames";const Tu="type",Lu="value";function Xb(r={},e=!1){const t=g(r,"names",{});return new D({optional:e,value:[new j({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:t.country_name||C,value:[new Me({value:[new Rh,new nr]})]}),new j({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:t.administration_domain_name||C,value:[new Me({value:[new Rh,new nr]})]}),new pe({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:t.network_address||C,isHexOnly:!0}),new pe({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:t.terminal_identifier||C,isHexOnly:!0}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:t.private_domain_name||C,value:[new Me({value:[new Rh,new nr]})]}),new pe({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:t.organization_name||C,isHexOnly:!0}),new pe({optional:!0,name:t.numeric_user_identifier||C,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new j({optional:!0,name:t.personal_name||C,idBlock:{tagClass:3,tagNumber:5},value:[new pe({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new pe({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new pe({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new pe({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new j({optional:!0,name:t.organizational_unit_names||C,idBlock:{tagClass:3,tagNumber:6},value:[new ye({value:new nr})]})]})}function Yb(r=!1){return new D({optional:r,value:[new nr,new nr]})}function Qb(r=!1){return new at({optional:r,value:[new pe({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new de]})]})}class Ee extends Q{constructor(e={}){super(),this.type=g(e,Tu,Ee.defaultValues(Tu)),this.value=g(e,Lu,Ee.defaultValues(Lu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tu:return 9;case Lu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Tu:return t===Ee.defaultValues(e);case Lu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new Me({value:[new j({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||C,value:[new le,new j({idBlock:{tagClass:3,tagNumber:0},value:[new de]})]}),new pe({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:1}}),new pe({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:2}}),new j({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||C,value:[Xb(t.builtInStandardAttributes||{},!1),Yb(!0),Qb(!0)]}),new j({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||C,value:[Be.schema(t.directoryName||{})]}),new j({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||C,value:[new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Me({value:[new gp,new nr,new yp,new Em,new wp]})]}),new j({idBlock:{tagClass:3,tagNumber:1},value:[new Me({value:[new gp,new nr,new yp,new Em,new wp]})]})]}),new pe({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:6}}),new pe({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:7}}),new pe({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){ee(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=te(e,e,Ee.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(G.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=t.result.blockName;break;case 1:case 2:case 6:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=22;const a=s.toBER(!1),n=ot(a);G.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value}break;case 3:this.value=t.result.blockName;break;case 4:this.value=new Be({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new ae({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=6;const a=s.toBER(!1),n=ot(a);G.assert(n,"GeneralName registeredID"),this.value=n.result.valueBlock.toString()}break}}toSchema(){switch(this.type){case 0:case 3:case 5:return new j({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new xy({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new j({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new le({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return Ee.schema()}}toJSON(){const e={type:this.type,value:C};if(typeof this.value=="string")e.value=this.value;else try{e.value=this.value.toJSON()}catch{}return e}}Ee.CLASS_NAME="GeneralName";const Ru="accessMethod",Uu="accessLocation",Zb=[Ru,Uu];class zn extends Q{constructor(e={}){super(),this.accessMethod=g(e,Ru,zn.defaultValues(Ru)),this.accessLocation=g(e,Uu,zn.defaultValues(Uu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ru:return C;case Uu:return new Ee;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.accessMethod||C}),Ee.schema(t.accessLocation||{})]})}fromSchema(e){ee(e,Zb);const t=te(e,e,zn.schema({names:{accessMethod:Ru,accessLocation:{names:{blockName:Uu}}}}));G.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new Ee({schema:t.result.accessLocation})}toSchema(){return new D({value:[new le({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}zn.CLASS_NAME="AccessDescription";const Pr="seconds",Dr="millis",Tr="micros";class Yt extends Q{constructor(e={}){super(),Pr in e&&(this.seconds=g(e,Pr,Yt.defaultValues(Pr))),Dr in e&&(this.millis=g(e,Dr,Yt.defaultValues(Dr))),Tr in e&&(this.micros=g(e,Tr,Yt.defaultValues(Tr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pr:case Dr:case Tr:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pr:case Dr:case Tr:return t===Yt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,optional:!0,value:[new q({optional:!0,name:t.seconds||C}),new pe({name:t.millis||C,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new pe({name:t.micros||C,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){ee(e,[Pr,Dr,Tr]);const t=te(e,e,Yt.schema({names:{seconds:Pr,millis:Dr,micros:Tr}}));if(G.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const s=new q({valueHex:t.result.millis.valueBlock.valueHex});this.millis=s.valueBlock.valueDec}if("micros"in t.result){const s=new q({valueHex:t.result.micros.valueBlock.valueHex});this.micros=s.valueBlock.valueDec}}toSchema(){const e=[];if(this.seconds!==void 0&&e.push(new q({value:this.seconds})),this.millis!==void 0){const t=new q({value:this.millis});e.push(new pe({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(this.micros!==void 0){const t=new q({value:this.micros});e.push(new pe({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new D({value:e})}toJSON(){const e={};return this.seconds!==void 0&&(e.seconds=this.seconds),this.millis!==void 0&&(e.millis=this.millis),this.micros!==void 0&&(e.micros=this.micros),e}}Yt.CLASS_NAME="Accuracy";const lh="algorithmId",Su="algorithmParams",gw="algorithm",Ip="params",eS=[gw,Ip];class H extends Q{constructor(e={}){super(),this.algorithmId=g(e,lh,H.defaultValues(lh)),Su in e&&(this.algorithmParams=g(e,Su,H.defaultValues(Su))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lh:return C;case Su:return new de;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case lh:return t===C;case Su:return t instanceof de;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,optional:t.optional||!1,value:[new le({name:t.algorithmIdentifier||C}),new de({name:t.algorithmParams||C,optional:!0})]})}fromSchema(e){ee(e,eS);const t=te(e,e,H.schema({names:{algorithmIdentifier:gw,algorithmParams:Ip}}));G.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),Ip in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new le({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof de)&&e.push(this.algorithmParams),new D({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof de)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return!(e instanceof H)||this.algorithmId!==e.algorithmId?!1:this.algorithmParams?e.algorithmParams?JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!1:!e.algorithmParams}}H.CLASS_NAME="AlgorithmIdentifier";const Ai="altNames",tS=[Ai];class au extends Q{constructor(e={}){super(),this.altNames=g(e,Ai,au.defaultValues(Ai)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ai:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.altNames||C,value:Ee.schema()})]})}fromSchema(e){ee(e,tS);const t=te(e,e,au.schema({names:{altNames:Ai}}));G.assertSchema(t,this.className),Ai in t.result&&(this.altNames=Array.from(t.result.altNames,s=>new Ee({schema:s})))}toSchema(){return new D({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}au.CLASS_NAME="AltName";const Ni="type",Ei="values",sS=[Ni,Ei];class Oe extends Q{constructor(e={}){super(),this.type=g(e,Ni,Oe.defaultValues(Ni)),this.values=g(e,Ei,Oe.defaultValues(Ei)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ni:return C;case Ei:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ni:return t===C;case Ei:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.type||C}),new at({name:t.setName||C,value:[new ye({name:t.values||C,value:new de})]})]})}fromSchema(e){ee(e,sS);const t=te(e,e,Oe.schema({names:{type:Ni,values:Ei}}));G.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new D({value:[new le({value:this.type}),new at({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}Oe.CLASS_NAME="Attribute";const $u="notBeforeTime",ju="notAfterTime",rS=[$u,ju];class Is extends Q{constructor(e={}){super(),this.notBeforeTime=g(e,$u,Is.defaultValues($u)),this.notAfterTime=g(e,ju,Is.defaultValues(ju)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $u:case ju:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new Je({name:t.notBeforeTime||C}),new Je({name:t.notAfterTime||C})]})}fromSchema(e){ee(e,rS);const t=te(e,e,Is.schema({names:{notBeforeTime:$u,notAfterTime:ju}}));G.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new D({value:[new Je({valueDate:this.notBeforeTime}),new Je({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}Is.CLASS_NAME="AttCertValidityPeriod";const Au="names",$g="generalNames";class nt extends Q{constructor(e={}){super(),this.names=g(e,Au,nt.defaultValues(Au)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"names":return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=g(e,Au,{});return new D({optional:t,name:s.blockName||C,value:[new ye({name:s.generalNames||C,value:Ee.schema()})]})}fromSchema(e){ee(e,[Au,$g]);const t=te(e,e,nt.schema({names:{blockName:Au,generalNames:$g}}));G.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,s=>new Ee({schema:s}))}toSchema(){return new D({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}nt.CLASS_NAME="GeneralNames";const aS="2.5.29.9",nS="2.5.29.14",iS="2.5.29.15",oS="2.5.29.16",yw="2.5.29.17",ww="2.5.29.18",dd="2.5.29.19",uS="2.5.29.20",cS="2.5.29.27",lS="2.5.29.21",hS="2.5.29.24",vw="2.5.29.28",bw="2.5.29.29",Sw="2.5.29.30",Aw="2.5.29.31",gd="2.5.29.46",Nw="2.5.29.32",is="2.5.29.32.0",mS="1.3.6.1.4.1.311.21.10",Ew="2.5.29.33",yd="2.5.29.35",Cw="2.5.29.36",fS="2.5.29.37",pS="2.5.29.54",wd="1.3.6.1.5.5.7.1.1",dS="1.3.6.1.5.5.7.1.11",gS="1.3.6.1.4.1.11129.2.4.2",yS="1.3.6.1.4.1.311.21.7",wS="1.3.6.1.4.1.311.21.1",vS="1.3.6.1.5.5.7.1.3",vd="1.2.840.113549.1.7.1",kw="1.2.840.113549.1.7.2",Iw="1.2.840.113549.1.7.3",Vw="1.2.840.113549.1.7.6",bS="1.2.840.113549.1.9.16.1.4",jg="1.2.840.113549.1.9.22.1",SS="1.2.840.113549.1.9.22.2",Kg="1.2.840.113549.1.9.22.3",Mg="1.2.840.113549.1.9.23.1",AS="1.3.6.1.5.5.7",NS=`${AS}.48`,$h=`${NS}.1.1`,Ja="keyIdentifier",Fa="authorityCertIssuer",qa="authorityCertSerialNumber",ES=[Ja,Fa,qa];class Ca extends Q{constructor(e={}){super(),Ja in e&&(this.keyIdentifier=g(e,Ja,Ca.defaultValues(Ja))),Fa in e&&(this.authorityCertIssuer=g(e,Fa,Ca.defaultValues(Fa))),qa in e&&(this.authorityCertSerialNumber=g(e,qa,Ca.defaultValues(qa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ja:return new ae;case Fa:return[];case qa:return new q;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new pe({name:t.keyIdentifier||C,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ye({name:t.authorityCertIssuer||C,value:Ee.schema()})]}),new pe({name:t.authorityCertSerialNumber||C,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){ee(e,ES);const t=te(e,e,Ca.schema({names:{keyIdentifier:Ja,authorityCertIssuer:Fa,authorityCertSerialNumber:qa}}));G.assertSchema(t,this.className),Ja in t.result&&(this.keyIdentifier=new ae({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),Fa in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,s=>new Ee({schema:s}))),qa in t.result&&(this.authorityCertSerialNumber=new q({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new pe({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new j({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new pe({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new D({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}Ca.CLASS_NAME="AuthorityKeyIdentifier";const ja="pathLenConstraint",Ka="cA";class Xn extends Q{constructor(e={}){super(),this.cA=g(e,Ka,!1),ja in e&&(this.pathLenConstraint=g(e,ja,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ka:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new Ra({optional:!0,name:t.cA||C}),new q({optional:!0,name:t.pathLenConstraint||C})]})}fromSchema(e){ee(e,[Ka,ja]);const t=te(e,e,Xn.schema({names:{cA:Ka,pathLenConstraint:ja}}));G.assertSchema(t,this.className),Ka in t.result&&(this.cA=t.result.cA.valueBlock.value),ja in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==Xn.defaultValues(Ka)&&e.push(new Ra({value:this.cA})),ja in this&&(this.pathLenConstraint instanceof q?e.push(this.pathLenConstraint):e.push(new q({value:this.pathLenConstraint}))),new D({value:e})}toJSON(){const e={};return this.cA!==Xn.defaultValues(Ka)&&(e.cA=this.cA),ja in this&&(this.pathLenConstraint instanceof q?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}Xn.CLASS_NAME="BasicConstraints";const Rf="certificateIndex",Uf="keyIndex";class Ml extends Q{constructor(e={}){super(),this.certificateIndex=g(e,Rf,Ml.defaultValues(Rf)),this.keyIndex=g(e,Uf,Ml.defaultValues(Uf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rf:case Uf:return 0;default:return super.defaultValues(e)}}static schema(){return new q}fromSchema(e){if(e.constructor.blockName()!==q.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const s=new Uint8Array(t);switch(!0){case t.byteLength<4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(s,4-t.byteLength),t=f.slice(0)}break;case t.byteLength>4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(s.slice(0,4)),t=f.slice(0)}break}const a=t.slice(0,2),n=new Uint8Array(a);let i=n[0];n[0]=n[1],n[1]=i;const o=new Uint16Array(a);this.keyIndex=o[0];const l=t.slice(2),u=new Uint8Array(l);i=u[0],u[0]=u[1],u[1]=i;const c=new Uint16Array(l);this.certificateIndex=c[0]}toSchema(){const e=new ArrayBuffer(2),t=new Uint16Array(e);t[0]=this.certificateIndex;const s=new Uint8Array(e);let a=s[0];s[0]=s[1],s[1]=a;const n=new ArrayBuffer(2),i=new Uint16Array(n);i[0]=this.keyIndex;const o=new Uint8Array(n);return a=o[0],o[0]=o[1],o[1]=a,new q({valueHex:Xo(n,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}Ml.CLASS_NAME="CAVersion";const Ku="policyQualifierId",Mu="qualifier",CS=[Ku,Mu];class Yn extends Q{constructor(e={}){super(),this.policyQualifierId=g(e,Ku,Yn.defaultValues(Ku)),this.qualifier=g(e,Mu,Yn.defaultValues(Mu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ku:return C;case Mu:return new de;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.policyQualifierId||C}),new de({name:t.qualifier||C})]})}fromSchema(e){ee(e,CS);const t=te(e,e,Yn.schema({names:{policyQualifierId:Ku,qualifier:Mu}}));G.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new D({value:[new le({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}Yn.CLASS_NAME="PolicyQualifierInfo";const Hu="policyIdentifier",Wa="policyQualifiers",kS=[Hu,Wa];class Qn extends Q{constructor(e={}){super(),this.policyIdentifier=g(e,Hu,Qn.defaultValues(Hu)),Wa in e&&(this.policyQualifiers=g(e,Wa,Qn.defaultValues(Wa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hu:return C;case Wa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.policyIdentifier||C}),new D({optional:!0,value:[new ye({name:t.policyQualifiers||C,value:Yn.schema()})]})]})}fromSchema(e){ee(e,kS);const t=te(e,e,Qn.schema({names:{policyIdentifier:Hu,policyQualifiers:Wa}}));G.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),Wa in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,s=>new Yn({schema:s})))}toSchema(){const e=[];return e.push(new le({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new D({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new D({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}Qn.CLASS_NAME="PolicyInformation";const Ju="certificatePolicies",IS=[Ju];class nu extends Q{constructor(e={}){super(),this.certificatePolicies=g(e,Ju,nu.defaultValues(Ju)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ju:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.certificatePolicies||C,value:Qn.schema()})]})}fromSchema(e){ee(e,IS);const t=te(e,e,nu.schema({names:{certificatePolicies:Ju}}));G.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,s=>new Qn({schema:s}))}toSchema(){return new D({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}nu.CLASS_NAME="CertificatePolicies";const Fu="templateID",Fs="templateMajorVersion",qs="templateMinorVersion",VS=[Fu,Fs,qs];class Go extends Q{constructor(e={}){super(),this.templateID=g(e,Fu,Go.defaultValues(Fu)),Fs in e&&(this.templateMajorVersion=g(e,Fs,Go.defaultValues(Fs))),qs in e&&(this.templateMinorVersion=g(e,qs,Go.defaultValues(qs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fu:return C;case Fs:case qs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.templateID||C}),new q({name:t.templateMajorVersion||C,optional:!0}),new q({name:t.templateMinorVersion||C,optional:!0})]})}fromSchema(e){ee(e,VS);const t=te(e,e,Go.schema({names:{templateID:Fu,templateMajorVersion:Fs,templateMinorVersion:qs}}));G.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),Fs in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),qs in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new le({value:this.templateID})),Fs in this&&e.push(new q({value:this.templateMajorVersion})),qs in this&&e.push(new q({value:this.templateMinorVersion})),new D({value:e})}toJSON(){const e={templateID:this.templateID};return Fs in this&&(e.templateMajorVersion=this.templateMajorVersion),qs in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}const _a="distributionPoint",Bw="distributionPointNames",Ga="reasons",za="cRLIssuer",xw="cRLIssuerNames",BS=[_a,Bw,Ga,za,xw];class ka extends Q{constructor(e={}){super(),_a in e&&(this.distributionPoint=g(e,_a,ka.defaultValues(_a))),Ga in e&&(this.reasons=g(e,Ga,ka.defaultValues(Ga))),za in e&&(this.cRLIssuer=g(e,za,ka.defaultValues(za))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _a:return[];case Ga:return new be;case za:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Me({value:[new j({name:t.distributionPoint||C,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ye({name:t.distributionPointNames||C,value:Ee.schema()})]}),new j({name:t.distributionPoint||C,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Be.schema().valueBlock.value})]})]}),new pe({name:t.reasons||C,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new j({name:t.cRLIssuer||C,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new ye({name:t.cRLIssuerNames||C,value:Ee.schema()})]})]})}fromSchema(e){ee(e,BS);const t=te(e,e,ka.schema({names:{distributionPoint:_a,distributionPointNames:Bw,reasons:Ga,cRLIssuer:za,cRLIssuerNames:xw}}));G.assertSchema(t,this.className),_a in t.result&&(t.result.distributionPoint.idBlock.tagNumber===0&&(this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new Ee({schema:s}))),t.result.distributionPoint.idBlock.tagNumber===1&&(this.distributionPoint=new Be({schema:new D({value:t.result.distributionPoint.valueBlock.value})}))),Ga in t.result&&(this.reasons=new be({valueHex:t.result.reasons.valueBlock.valueHex})),za in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,s=>new Ee({schema:s})))}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new j({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):t=new j({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new pe({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new j({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new D({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}ka.CLASS_NAME="DistributionPoint";const qu="distributionPoints",xS=[qu];class iu extends Q{constructor(e={}){super(),this.distributionPoints=g(e,qu,iu.defaultValues(qu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.distributionPoints||C,value:ka.schema()})]})}fromSchema(e){ee(e,xS);const t=te(e,e,iu.schema({names:{distributionPoints:qu}}));G.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,s=>new ka({schema:s}))}toSchema(){return new D({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}iu.CLASS_NAME="CRLDistributionPoints";const Wu="keyPurposes",OS=[Wu];class Hl extends Q{constructor(e={}){super(),this.keyPurposes=g(e,Wu,Hl.defaultValues(Wu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.keyPurposes||C,value:new le})]})}fromSchema(e){ee(e,OS);const t=te(e,e,Hl.schema({names:{keyPurposes:Wu}}));G.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,s=>s.valueBlock.toString())}toSchema(){return new D({value:Array.from(this.keyPurposes,e=>new le({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}Hl.CLASS_NAME="ExtKeyUsage";const Nu="accessDescriptions";class ou extends Q{constructor(e={}){super(),this.accessDescriptions=g(e,Nu,ou.defaultValues(Nu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.accessDescriptions||C,value:zn.schema()})]})}fromSchema(e){ee(e,[Nu]);const t=te(e,e,ou.schema({names:{accessDescriptions:Nu}}));G.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,s=>new zn({schema:s}))}toSchema(){return new D({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}ou.CLASS_NAME="InfoAccess";const Xa="distributionPoint",Ow="distributionPointNames",Lr="onlyContainsUserCerts",Rr="onlyContainsCACerts",Ur="onlySomeReasons",$r="indirectCRL",jr="onlyContainsAttributeCerts",PS=[Xa,Ow,Lr,Rr,Ur,$r,jr];class dt extends Q{constructor(e={}){super(),Xa in e&&(this.distributionPoint=g(e,Xa,dt.defaultValues(Xa))),this.onlyContainsUserCerts=g(e,Lr,dt.defaultValues(Lr)),this.onlyContainsCACerts=g(e,Rr,dt.defaultValues(Rr)),Ur in e&&(this.onlySomeReasons=g(e,Ur,dt.defaultValues(Ur))),this.indirectCRL=g(e,$r,dt.defaultValues($r)),this.onlyContainsAttributeCerts=g(e,jr,dt.defaultValues(jr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xa:return[];case Lr:return!1;case Rr:return!1;case Ur:return 0;case $r:return!1;case jr:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Me({value:[new j({name:t.distributionPoint||C,idBlock:{tagClass:3,tagNumber:0},value:[new ye({name:t.distributionPointNames||C,value:Ee.schema()})]}),new j({name:t.distributionPoint||C,idBlock:{tagClass:3,tagNumber:1},value:Be.schema().valueBlock.value})]})]}),new pe({name:t.onlyContainsUserCerts||C,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new pe({name:t.onlyContainsCACerts||C,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new pe({name:t.onlySomeReasons||C,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new pe({name:t.indirectCRL||C,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new pe({name:t.onlyContainsAttributeCerts||C,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){ee(e,PS);const t=te(e,e,dt.schema({names:{distributionPoint:Xa,distributionPointNames:Ow,onlyContainsUserCerts:Lr,onlyContainsCACerts:Rr,onlySomeReasons:Ur,indirectCRL:$r,onlyContainsAttributeCerts:jr}}));if(G.assertSchema(t,this.className),Xa in t.result)switch(!0){case t.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new Ee({schema:s}));break;case t.result.distributionPoint.idBlock.tagNumber===1:this.distributionPoint=new Be({schema:new D({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(Lr in t.result){const s=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=s[0]!==0}if(Rr in t.result){const s=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=s[0]!==0}if(Ur in t.result){const s=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=s[0]}if($r in t.result){const s=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=s[0]!==0}if(jr in t.result){const s=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=s[0]!==0}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new j({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==dt.defaultValues(Lr)&&e.push(new pe({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==dt.defaultValues(Rr)&&e.push(new pe({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),this.onlySomeReasons!==void 0){const t=new ArrayBuffer(1),s=new Uint8Array(t);s[0]=this.onlySomeReasons,e.push(new pe({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==dt.defaultValues($r)&&e.push(new pe({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==dt.defaultValues(jr)&&e.push(new pe({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new D({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==dt.defaultValues(Lr)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==dt.defaultValues(Rr)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),Ur in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==dt.defaultValues($r)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==dt.defaultValues(jr)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}dt.CLASS_NAME="IssuingDistributionPoint";const _u="base",Ci="minimum",Kr="maximum",DS=[_u,Ci,Kr];class Us extends Q{constructor(e={}){super(),this.base=g(e,_u,Us.defaultValues(_u)),this.minimum=g(e,Ci,Us.defaultValues(Ci)),Kr in e&&(this.maximum=g(e,Kr,Us.defaultValues(Kr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _u:return new Ee;case Ci:return 0;case Kr:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[Ee.schema(t.base||{}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new q({name:t.minimum||C})]}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new q({name:t.maximum||C})]})]})}fromSchema(e){ee(e,DS);const t=te(e,e,Us.schema({names:{base:{names:{blockName:_u}},minimum:Ci,maximum:Kr}}));G.assertSchema(t,this.className),this.base=new Ee({schema:t.result.base}),Ci in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),Kr in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),this.minimum!==0){let t=0;this.minimum instanceof q?t=this.minimum:t=new q({value:this.minimum}),e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(Kr in this){let t=0;this.maximum instanceof q?t=this.maximum:t=new q({value:this.maximum}),e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new D({value:e})}toJSON(){const e={base:this.base.toJSON()};return this.minimum!==0&&(typeof this.minimum=="number"?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),this.maximum!==void 0&&(typeof this.maximum=="number"?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}Us.CLASS_NAME="GeneralSubtree";const Ya="permittedSubtrees",Qa="excludedSubtrees",TS=[Ya,Qa];class Yo extends Q{constructor(e={}){super(),Ya in e&&(this.permittedSubtrees=g(e,Ya,Yo.defaultValues(Ya))),Qa in e&&(this.excludedSubtrees=g(e,Qa,Yo.defaultValues(Qa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ya:case Qa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ye({name:t.permittedSubtrees||C,value:Us.schema()})]}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ye({name:t.excludedSubtrees||C,value:Us.schema()})]})]})}fromSchema(e){ee(e,TS);const t=te(e,e,Yo.schema({names:{permittedSubtrees:Ya,excludedSubtrees:Qa}}));G.assertSchema(t,this.className),Ya in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,s=>new Us({schema:s}))),Qa in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,s=>new Us({schema:s})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new j({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new D({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}Yo.CLASS_NAME="NameConstraints";const Ws="requireExplicitPolicy",_s="inhibitPolicyMapping",LS=[Ws,_s];class Qo extends Q{constructor(e={}){super(),Ws in e&&(this.requireExplicitPolicy=g(e,Ws,Qo.defaultValues(Ws))),_s in e&&(this.inhibitPolicyMapping=g(e,_s,Qo.defaultValues(_s))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ws:return 0;case _s:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new pe({name:t.requireExplicitPolicy||C,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new pe({name:t.inhibitPolicyMapping||C,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){ee(e,LS);const t=te(e,e,Qo.schema({names:{requireExplicitPolicy:Ws,inhibitPolicyMapping:_s}}));if(G.assertSchema(t,this.className),Ws in t.result){const s=t.result.requireExplicitPolicy;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=ot(a);G.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(_s in t.result){const s=t.result.inhibitPolicyMapping;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=ot(a);G.assert(n,"Integer"),this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if(Ws in this){const t=new q({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(_s in this){const t=new q({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new D({value:e})}toJSON(){const e={};return Ws in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),_s in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}Qo.CLASS_NAME="PolicyConstraints";const Gu="issuerDomainPolicy",zu="subjectDomainPolicy",RS=[Gu,zu];class Zn extends Q{constructor(e={}){super(),this.issuerDomainPolicy=g(e,Gu,Zn.defaultValues(Gu)),this.subjectDomainPolicy=g(e,zu,Zn.defaultValues(zu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gu:return C;case zu:return C;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.issuerDomainPolicy||C}),new le({name:t.subjectDomainPolicy||C})]})}fromSchema(e){ee(e,RS);const t=te(e,e,Zn.schema({names:{issuerDomainPolicy:Gu,subjectDomainPolicy:zu}}));G.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new D({value:[new le({value:this.issuerDomainPolicy}),new le({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}Zn.CLASS_NAME="PolicyMapping";const Xu="mappings",US=[Xu];class Jl extends Q{constructor(e={}){super(),this.mappings=g(e,Xu,Jl.defaultValues(Xu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.mappings||C,value:Zn.schema()})]})}fromSchema(e){ee(e,US);const t=te(e,e,Jl.schema({names:{mappings:Xu}}));G.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,s=>new Zn({schema:s}))}toSchema(){return new D({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}Jl.CLASS_NAME="PolicyMappings";const Mr="notBefore",Hr="notAfter",$S=[Mr,Hr];class Zo extends Q{constructor(e={}){super(),Mr in e&&(this.notBefore=g(e,Mr,Zo.defaultValues(Mr))),Hr in e&&(this.notAfter=g(e,Hr,Zo.defaultValues(Hr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mr:return new Date;case Hr:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new pe({name:t.notBefore||C,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new pe({name:t.notAfter||C,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){ee(e,$S);const t=te(e,e,Zo.schema({names:{notBefore:Mr,notAfter:Hr}}));if(G.assertSchema(t,this.className),Mr in t.result){const s=new Je;s.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=s.toDate()}if(Hr in t.result){const s=new Je({valueHex:t.result.notAfter.valueBlock.valueHex});s.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=s.toDate()}}toSchema(){const e=[];return Mr in this&&e.push(new pe({idBlock:{tagClass:3,tagNumber:0},valueHex:new Je({valueDate:this.notBefore}).valueBlock.valueHexView})),Hr in this&&e.push(new pe({idBlock:{tagClass:3,tagNumber:1},valueHex:new Je({valueDate:this.notAfter}).valueBlock.valueHexView})),new D({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}Zo.CLASS_NAME="PrivateKeyUsagePeriod";const ki="id",Gs="type",Ii="values",jS=[ki,Gs],KS=[Ii];class ei extends Q{constructor(e={}){super(),this.id=g(e,ki,ei.defaultValues(ki)),Gs in e&&(this.type=g(e,Gs,ei.defaultValues(Gs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ki:return C;case Gs:return new rt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ki:return t===C;case Gs:return t instanceof rt;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.id||C}),new de({name:t.type||C,optional:!0})]})}fromSchema(e){ee(e,jS);const t=te(e,e,ei.schema({names:{id:ki,type:Gs}}));G.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),Gs in t.result&&(this.type=t.result.type)}toSchema(){const e=[new le({value:this.id})];return Gs in this&&e.push(this.type),new D({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}ei.CLASS_NAME="QCStatement";class Fl extends Q{constructor(e={}){super(),this.values=g(e,Ii,Fl.defaultValues(Ii)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ii:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ii:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.values||C,value:ei.schema(t.value||{})})]})}fromSchema(e){ee(e,KS);const t=te(e,e,Fl.schema({names:{values:Ii}}));G.assertSchema(t,this.className),this.values=Array.from(t.result.values,s=>new ei({schema:s}))}toSchema(){return new D({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}Fl.CLASS_NAME="QCStatements";var Ma;class Da{static register(e,t,s){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:s}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}Ma=Da,Da.namedCurves={},Ma.register("P-256","1.2.840.10045.3.1.7",32),Ma.register("P-384","1.3.132.0.34",48),Ma.register("P-521","1.3.132.0.35",66),Ma.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),Ma.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),Ma.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const hh="x",mh="y",fh="namedCurve";class Ut extends Q{constructor(e={}){super(),this.x=g(e,hh,Ut.defaultValues(hh)),this.y=g(e,mh,Ut.defaultValues(mh)),this.namedCurve=g(e,fh,Ut.defaultValues(fh)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hh:case mh:return We;case fh:return C;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hh:case mh:return t instanceof ArrayBuffer&&Ul(t,Ut.defaultValues(e));case fh:return typeof t=="string"&&t===Ut.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new Am}fromSchema(e){const t=Te.toUint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");const s=Da.find(this.namedCurve);if(!s)throw new Error(`Incorrect curve OID: ${this.namedCurve}`);const a=s.size;if(t.byteLength!==a*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=s.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,a*2+1).buffer}toSchema(){return new Am({data:Xo(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=Da.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:dp(Sm(this.x),!0,!0,!1),y:dp(Sm(this.y),!0,!0,!1)}}fromJSON(e){Se.assert("json",e,"crv","x","y");let t=0;const s=Da.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=ru(Rl(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const i=new Uint8Array(this.x),o=new Uint8Array(a);i.set(o,1)}else this.x=a.slice(0,t);const n=ru(Rl(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const i=new Uint8Array(this.y),o=new Uint8Array(n);i.set(o,1)}else this.y=n.slice(0,t)}}Ut.CLASS_NAME="ECPublicKey";const Yu="modulus",Qu="publicExponent",MS=[Yu,Qu];class ti extends Q{constructor(e={}){super(),this.modulus=g(e,Yu,ti.defaultValues(Yu)),this.publicExponent=g(e,Qu,ti.defaultValues(Qu)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yu:return new q;case Qu:return new q;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.modulus||C}),new q({name:t.publicExponent||C})]})}fromSchema(e){ee(e,MS);const t=te(e,e,ti.schema({names:{modulus:Yu,publicExponent:Qu}}));G.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new D({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:ke.ToBase64Url(this.modulus.valueBlock.valueHexView),e:ke.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){Se.assert("json",e,"n","e");const t=ru(Rl(e.n,!0));this.modulus=new q({valueHex:t.slice(0,Math.pow(2,L0(t.byteLength)))}),this.publicExponent=new q({valueHex:ru(Rl(e.e,!0)).slice(0,3)})}}ti.CLASS_NAME="RSAPublicKey";const Zu="algorithm",ec="subjectPublicKey",HS=[Zu,ec];class Ht extends Q{get parsedKey(){if(this._parsedKey===void 0){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===le.blockName())try{this._parsedKey=new Ut({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch{}break;case"1.2.840.113549.1.1.1":{const e=ot(this.subjectPublicKey.valueBlock.valueHexView);if(e.offset!==-1)try{this._parsedKey=new ti({schema:e.result})}catch{}}break}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=g(e,Zu,Ht.defaultValues(Zu)),this.subjectPublicKey=g(e,ec,Ht.defaultValues(ec));const t=g(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zu:return new H;case ec:return new be;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[H.schema(t.algorithm||{}),new be({name:t.subjectPublicKey||C})]})}fromSchema(e){ee(e,HS);const t=te(e,e,Ht.schema({names:{algorithm:{names:{blockName:Zu}},subjectPublicKey:ec}}));G.assertSchema(t,this.className),this.algorithm=new H({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new D({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Ut({json:e}),this.algorithm=new H({algorithmId:"1.2.840.10045.2.1",algorithmParams:new le({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new ti({json:e}),this.algorithm=new H({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new rt});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new be({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=we(!0)){try{if(!e)throw new Error("Need to provide publicKey input parameter");const s=await t.exportKey("spki",e),a=ot(s);try{this.fromSchema(a.result)}catch{throw new Error("Error during initializing object from schema")}}catch(s){const a=s instanceof Error?s.message:`${s}`;throw new Error(`Error during exporting public key: ${a}`)}}}Ht.CLASS_NAME="PublicKeyInfo";const Vi="version",Bi="privateKey",vs="namedCurve",Jr="publicKey",JS=[Vi,Bi,vs,Jr];class cs extends Q{constructor(e={}){super(),this.version=g(e,Vi,cs.defaultValues(Vi)),this.privateKey=g(e,Bi,cs.defaultValues(Bi)),vs in e&&(this.namedCurve=g(e,vs,cs.defaultValues(vs))),Jr in e&&(this.publicKey=g(e,Jr,cs.defaultValues(Jr))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vi:return 1;case Bi:return new ae;case vs:return C;case Jr:return new Ut;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vi:return t===cs.defaultValues(e);case Bi:return t.isEqual(cs.defaultValues(e));case vs:return t===C;case Jr:return Ut.compareWithDefault(vs,t.namedCurve)&&Ut.compareWithDefault("x",t.x)&&Ut.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),new ae({name:t.privateKey||C}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.namedCurve||C})]}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new be({name:t.publicKey||C})]})]})}fromSchema(e){ee(e,JS);const t=te(e,e,cs.schema({names:{version:Vi,privateKey:Bi,namedCurve:vs,publicKey:Jr}}));if(G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,vs in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),Jr in t.result){const s={schema:t.result.publicKey.valueBlock.valueHex};vs in this&&(s.namedCurve=this.namedCurve),this.publicKey=new Ut(s)}}toSchema(){const e=[new q({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[new le({value:this.namedCurve})]})),this.publicKey&&e.push(new j({idBlock:{tagClass:3,tagNumber:1},value:[new be({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new D({value:e})}toJSON(){if(!this.namedCurve||cs.compareWithDefault(vs,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=Da.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:ke.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const s=this.publicKey.toJSON();t.x=s.x,t.y=s.y}return t}fromJSON(e){Se.assert("json",e,"crv","d");let t=0;const s=Da.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=ke.FromBase64Url(e.d);if(a.byteLength<t){const n=new ArrayBuffer(t),i=new Uint8Array(n),o=new Uint8Array(a);i.set(o,1),this.privateKey=new ae({valueHex:n})}else this.privateKey=new ae({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new Ut({json:e}))}}cs.CLASS_NAME="ECPrivateKey";const tc="prime",sc="exponent",rc="coefficient",FS=[tc,sc,rc];class ir extends Q{constructor(e={}){super(),this.prime=g(e,tc,ir.defaultValues(tc)),this.exponent=g(e,sc,ir.defaultValues(sc)),this.coefficient=g(e,rc,ir.defaultValues(rc)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tc:return new q;case sc:return new q;case rc:return new q;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.prime||C}),new q({name:t.exponent||C}),new q({name:t.coefficient||C})]})}fromSchema(e){ee(e,FS);const t=te(e,e,ir.schema({names:{prime:tc,exponent:sc,coefficient:rc}}));G.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new D({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:ke.ToBase64Url(this.prime.valueBlock.valueHexView),d:ke.ToBase64Url(this.exponent.valueBlock.valueHexView),t:ke.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){Se.assert("json",e,"r","d","r"),this.prime=new q({valueHex:ke.FromBase64Url(e.r)}),this.exponent=new q({valueHex:ke.FromBase64Url(e.d)}),this.coefficient=new q({valueHex:ke.FromBase64Url(e.t)})}}ir.CLASS_NAME="OtherPrimeInfo";const ac="version",nc="modulus",ic="publicExponent",oc="privateExponent",uc="prime1",cc="prime2",lc="exponent1",hc="exponent2",mc="coefficient",Za="otherPrimeInfos",qS=[ac,nc,ic,oc,uc,cc,lc,hc,mc,Za];class Ot extends Q{constructor(e={}){super(),this.version=g(e,ac,Ot.defaultValues(ac)),this.modulus=g(e,nc,Ot.defaultValues(nc)),this.publicExponent=g(e,ic,Ot.defaultValues(ic)),this.privateExponent=g(e,oc,Ot.defaultValues(oc)),this.prime1=g(e,uc,Ot.defaultValues(uc)),this.prime2=g(e,cc,Ot.defaultValues(cc)),this.exponent1=g(e,lc,Ot.defaultValues(lc)),this.exponent2=g(e,hc,Ot.defaultValues(hc)),this.coefficient=g(e,mc,Ot.defaultValues(mc)),Za in e&&(this.otherPrimeInfos=g(e,Za,Ot.defaultValues(Za))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ac:return 0;case nc:return new q;case ic:return new q;case oc:return new q;case uc:return new q;case cc:return new q;case lc:return new q;case hc:return new q;case mc:return new q;case Za:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),new q({name:t.modulus||C}),new q({name:t.publicExponent||C}),new q({name:t.privateExponent||C}),new q({name:t.prime1||C}),new q({name:t.prime2||C}),new q({name:t.exponent1||C}),new q({name:t.exponent2||C}),new q({name:t.coefficient||C}),new D({optional:!0,value:[new ye({name:t.otherPrimeInfosName||C,value:ir.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){ee(e,qS);const t=te(e,e,Ot.schema({names:{version:ac,modulus:nc,publicExponent:ic,privateExponent:oc,prime1:uc,prime2:cc,exponent1:lc,exponent2:hc,coefficient:mc,otherPrimeInfo:{names:{blockName:Za}}}}));G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),Za in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,s=>new ir({schema:s})))}toSchema(){const e=[];return e.push(new q({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new D({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new D({value:e})}toJSON(){const e={n:ke.ToBase64Url(this.modulus.valueBlock.valueHexView),e:ke.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:ke.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:ke.ToBase64Url(this.prime1.valueBlock.valueHexView),q:ke.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:ke.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:ke.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:ke.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){Se.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new q({valueHex:ke.FromBase64Url(e.n)}),this.publicExponent=new q({valueHex:ke.FromBase64Url(e.e)}),this.privateExponent=new q({valueHex:ke.FromBase64Url(e.d)}),this.prime1=new q({valueHex:ke.FromBase64Url(e.p)}),this.prime2=new q({valueHex:ke.FromBase64Url(e.q)}),this.exponent1=new q({valueHex:ke.FromBase64Url(e.dp)}),this.exponent2=new q({valueHex:ke.FromBase64Url(e.dq)}),this.coefficient=new q({valueHex:ke.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new ir({json:t})))}}Ot.CLASS_NAME="RSAPrivateKey";const fc="version",pc="privateKeyAlgorithm",dc="privateKey",en="attributes",ph="parsedKey",WS=[fc,pc,dc,en];class hs extends Q{constructor(e={}){super(),this.version=g(e,fc,hs.defaultValues(fc)),this.privateKeyAlgorithm=g(e,pc,hs.defaultValues(pc)),this.privateKey=g(e,dc,hs.defaultValues(dc)),en in e&&(this.attributes=g(e,en,hs.defaultValues(en))),ph in e&&(this.parsedKey=g(e,ph,hs.defaultValues(ph))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fc:return 0;case pc:return new H;case dc:return new ae;case en:return[];case ph:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),H.schema(t.privateKeyAlgorithm||{}),new ae({name:t.privateKey||C}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ye({name:t.attributes||C,value:Oe.schema()})]})]})}fromSchema(e){ee(e,WS);const t=te(e,e,hs.schema({names:{version:fc,privateKeyAlgorithm:{names:{blockName:pc}},privateKey:dc,attributes:en}}));switch(G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new H({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,en in t.result&&(this.attributes=Array.from(t.result.attributes,s=>new Oe({schema:s}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const s=ot(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new Ot({schema:s.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof le){const s=ot(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new cs({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:s.result}))}break}}toSchema(){const e=[new q({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new D({value:e})}toJSON(){if(!this.parsedKey){const s={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(s.attributes=Array.from(this.attributes,a=>a.toJSON())),s}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new cs({json:e}),this.privateKeyAlgorithm=new H({algorithmId:"1.2.840.10045.2.1",algorithmParams:new le({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Ot({json:e}),this.privateKeyAlgorithm=new H({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new rt});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new ae({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}hs.CLASS_NAME="PrivateKeyInfo";const xi="contentType",Oi="contentEncryptionAlgorithm",tn="encryptedContent",_S=[xi,Oi,tn],Hg=1024;class Xe extends Q{constructor(e={}){if(super(),this.contentType=g(e,xi,Xe.defaultValues(xi)),this.contentEncryptionAlgorithm=g(e,Oi,Xe.defaultValues(Oi)),tn in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4&&this.encryptedContent.idBlock.isConstructed===!1&&!e.disableSplit)){const t=new ae({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,s,s+Hg>a.byteLength?a.byteLength-s:Hg),o=new ArrayBuffer(i.length),l=new Uint8Array(o);for(let u=0;u<l.length;u++)l[u]=i[u];t.valueBlock.value.push(new ae({valueHex:o})),n-=i.length,s+=i.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xi:return C;case Oi:return new H;case tn:return new ae;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case xi:return t===C;case Oi:return t.algorithmId===C&&!("algorithmParams"in t);case tn:return t.isEqual(Xe.defaultValues(tn));default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.contentType||C}),H.schema(t.contentEncryptionAlgorithm||{}),new Me({value:[new j({name:t.encryptedContent||C,idBlock:{tagClass:3,tagNumber:0},value:[new ye({value:new ae})]}),new pe({name:t.encryptedContent||C,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){ee(e,_S);const t=te(e,e,Xe.schema({names:{contentType:xi,contentEncryptionAlgorithm:{names:{blockName:Oi}},encryptedContent:tn}}));G.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new H({schema:t.result.contentEncryptionAlgorithm}),tn in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new le({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const s=this.encryptedContent;s.idBlock.tagClass=3,s.idBlock.tagNumber=0,s.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(s)}return new D({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return ae.prototype.getValue.call(this.encryptedContent)}}Xe.CLASS_NAME="EncryptedContentInfo";const Fr="hashAlgorithm",qr="maskGenAlgorithm",Wr="saltLength",_r="trailerField",GS=[Fr,qr,Wr,_r];class gt extends Q{constructor(e={}){super(),this.hashAlgorithm=g(e,Fr,gt.defaultValues(Fr)),this.maskGenAlgorithm=g(e,qr,gt.defaultValues(qr)),this.saltLength=g(e,Wr,gt.defaultValues(Wr)),this.trailerField=g(e,_r,gt.defaultValues(_r)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fr:return new H({algorithmId:"1.3.14.3.2.26",algorithmParams:new rt});case qr:return new H({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new H({algorithmId:"1.3.14.3.2.26",algorithmParams:new rt}).toSchema()});case Wr:return 20;case _r:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new j({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[H.schema(t.hashAlgorithm||{})]}),new j({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[H.schema(t.maskGenAlgorithm||{})]}),new j({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new q({name:t.saltLength||C})]}),new j({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new q({name:t.trailerField||C})]})]})}fromSchema(e){ee(e,GS);const t=te(e,e,gt.schema({names:{hashAlgorithm:{names:{blockName:Fr}},maskGenAlgorithm:{names:{blockName:qr}},saltLength:Wr,trailerField:_r}}));G.assertSchema(t,this.className),Fr in t.result&&(this.hashAlgorithm=new H({schema:t.result.hashAlgorithm})),qr in t.result&&(this.maskGenAlgorithm=new H({schema:t.result.maskGenAlgorithm})),Wr in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),_r in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(gt.defaultValues(Fr))||e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(gt.defaultValues(qr))||e.push(new j({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==gt.defaultValues(Wr)&&e.push(new j({idBlock:{tagClass:3,tagNumber:2},value:[new q({value:this.saltLength})]})),this.trailerField!==gt.defaultValues(_r)&&e.push(new j({idBlock:{tagClass:3,tagNumber:3},value:[new q({value:this.trailerField})]})),new D({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(gt.defaultValues(Fr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(gt.defaultValues(qr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==gt.defaultValues(Wr)&&(e.saltLength=this.saltLength),this.trailerField!==gt.defaultValues(_r)&&(e.trailerField=this.trailerField),e}}gt.CLASS_NAME="RSASSAPSSParams";const Pi="salt",gc="iterationCount",bs="keyLength",zs="prf",zS=[Pi,gc,bs,zs];class Vt extends Q{constructor(e={}){super(),this.salt=g(e,Pi,Vt.defaultValues(Pi)),this.iterationCount=g(e,gc,Vt.defaultValues(gc)),bs in e&&(this.keyLength=g(e,bs,Vt.defaultValues(bs))),zs in e&&(this.prf=g(e,zs,Vt.defaultValues(zs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pi:return{};case gc:return-1;case bs:return 0;case zs:return new H({algorithmId:"1.3.14.3.2.26",algorithmParams:new rt});default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new Me({value:[new ae({name:t.saltPrimitive||C}),H.schema(t.saltConstructed||{})]}),new q({name:t.iterationCount||C}),new q({name:t.keyLength||C,optional:!0}),H.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){ee(e,zS);const t=te(e,e,Vt.schema({names:{saltPrimitive:Pi,saltConstructed:{names:{blockName:Pi}},iterationCount:gc,keyLength:bs,prf:{names:{blockName:zs,optional:!0}}}}));G.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,bs in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),zs in t.result&&(this.prf=new H({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new q({value:this.iterationCount})),bs in this&&Vt.defaultValues(bs)!==this.keyLength&&e.push(new q({value:this.keyLength})),this.prf&&Vt.defaultValues(zs).isEqual(this.prf)===!1&&e.push(this.prf.toSchema()),new D({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return bs in this&&Vt.defaultValues(bs)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&Vt.defaultValues(zs).isEqual(this.prf)===!1&&(e.prf=this.prf.toJSON()),e}}Vt.CLASS_NAME="PBKDF2Params";const yc="keyDerivationFunc",wc="encryptionScheme",XS=[yc,wc];class si extends Q{constructor(e={}){super(),this.keyDerivationFunc=g(e,yc,si.defaultValues(yc)),this.encryptionScheme=g(e,wc,si.defaultValues(wc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yc:return new H;case wc:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[H.schema(t.keyDerivationFunc||{}),H.schema(t.encryptionScheme||{})]})}fromSchema(e){ee(e,XS);const t=te(e,e,si.schema({names:{keyDerivationFunc:{names:{blockName:yc}},encryptionScheme:{names:{blockName:wc}}}}));G.assertSchema(t,this.className),this.keyDerivationFunc=new H({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new H({schema:t.result.encryptionScheme})}toSchema(){return new D({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}si.CLASS_NAME="PBES2Params";class YS{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=g(e,"name",C)}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){if(e===null)throw new Error('Argument "array" must not be null');return this.crypto.getRandomValues(e)}}async function Jg(r,e,t,s,a){let n,i,o;switch(r.toUpperCase()){case"SHA-1":n=20,i=64,o=bb;break;case"SHA-256":n=32,i=64,o=Nb;break;case"SHA-384":n=48,i=128,o=zb;break;case"SHA-512":n=64,i=128,o=Gb;break;default:throw new Error("Unsupported hashing algorithm")}const l=new Uint8Array(t);let u=new TextDecoder().decode(t);new TextEncoder().encode(u).some((w,E)=>w!==l[E])&&(u=String.fromCharCode(...l));const c=new Uint8Array(u.length*2+2),f=new DataView(c.buffer);for(let w=0;w<u.length;w++)f.setUint16(w*2,u.charCodeAt(w),!1);f.setUint16(u.length*2,0,!1);const h=new Uint8Array(i).fill(3),v=new Uint8Array(s),d=new Uint8Array(i*Math.ceil(v.length/i)).map((w,E)=>v[E%v.length]),A=new Uint8Array(i*Math.ceil(c.length/i)).map((w,E)=>c[E%c.length]);let b=new Uint8Array(d.length+A.length);b.set(d),b.set(A,d.length);const I=Math.ceil((e>>3)/n),p=[];for(let w=0;w<I;w++){let E=new Uint8Array(h.length+b.length);E.set(h),E.set(b,h.length);for(let B=0;B<a;B++)E=o(E);const O=new Uint8Array(i).map((B,k)=>E[k%E.length]),x=Math.ceil(v.length/i)+Math.ceil(c.length/i),T=[];for(let B=0;B<x;B++){const k=Array.from(b.slice(B*i,(B+1)*i));let J=511;for(let F=O.length-1;F>=0;F--)J>>=8,J+=O[F]+(k[F]||0),k[F]=J&255;T.push(...k)}b=new Uint8Array(T),p.push(...E)}return new Uint8Array(p.slice(0,e>>3)).buffer}function Pw(r){const e=typeof r=="string"?{name:r}:r;return"hash"in e?{...e,hash:Pw(e.hash)}:e}class ql extends YS{async importKey(e,t,s,a,n){var i,o,l,u,c,f;let h={};const v=Pw(s);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,s,a,n);case"spki":{const d=ot(Te.toArrayBuffer(t));G.assert(d,"keyData");const A=new Ht;try{A.fromSchema(d.result)}catch{throw new Ve("Incorrect keyData")}switch(v.name.toUpperCase()){case"RSA-PSS":{if(!v.hash)throw new Se("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":h.alg="PS1";break;case"SHA-256":h.alg="PS256";break;case"SHA-384":h.alg="PS384";break;case"SHA-512":h.alg="PS512";break;default:throw new Error(`Incorrect hash algorithm: ${v.hash.name.toUpperCase()}`)}}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],h.kty="RSA",h.ext=a,h.key_ops=n,A.algorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error(`Incorrect public key algorithm: ${A.algorithm.algorithmId}`);if(!h.alg){if(!v.hash)throw new Se("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":h.alg="RS1";break;case"SHA-256":h.alg="RS256";break;case"SHA-384":h.alg="RS384";break;case"SHA-512":h.alg="RS512";break;default:throw new Error(`Incorrect hash algorithm: ${v.hash.name.toUpperCase()}`)}}const b=A.toJSON();Object.assign(h,b)}break;case"ECDSA":n=["verify"];case"ECDH":{if(h={kty:"EC",ext:a,key_ops:n},A.algorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error(`Incorrect public key algorithm: ${A.algorithm.algorithmId}`);const b=A.toJSON();Object.assign(h,b)}break;case"RSA-OAEP":{if(h.kty="RSA",h.ext=a,h.key_ops=n,this.name.toLowerCase()==="safari")h.alg="RSA-OAEP";else{if(!v.hash)throw new Se("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":h.alg="RSA-OAEP";break;case"SHA-256":h.alg="RSA-OAEP-256";break;case"SHA-384":h.alg="RSA-OAEP-384";break;case"SHA-512":h.alg="RSA-OAEP-512";break;default:throw new Error(`Incorrect hash algorithm: ${v.hash.name.toUpperCase()}`)}}const b=A.toJSON();Object.assign(h,b)}break;case"RSAES-PKCS1-V1_5":{h.kty="RSA",h.ext=a,h.key_ops=n,h.alg="PS1";const b=A.toJSON();Object.assign(h,b)}break;default:throw new Error(`Incorrect algorithm name: ${v.name.toUpperCase()}`)}}break;case"pkcs8":{const d=new hs,A=ot(Te.toArrayBuffer(t));G.assert(A,"keyData");try{d.fromSchema(A.result)}catch{throw new Error("Incorrect keyData")}if(!d.parsedKey)throw new Error("Incorrect keyData");switch(v.name.toUpperCase()){case"RSA-PSS":switch((i=v.hash)===null||i===void 0?void 0:i.name.toUpperCase()){case"SHA-1":h.alg="PS1";break;case"SHA-256":h.alg="PS256";break;case"SHA-384":h.alg="PS384";break;case"SHA-512":h.alg="PS512";break;default:throw new Error(`Incorrect hash algorithm: ${(o=v.hash)===null||o===void 0?void 0:o.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],h.kty="RSA",h.ext=a,h.key_ops=n,d.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error(`Incorrect private key algorithm: ${d.privateKeyAlgorithm.algorithmId}`);if(!("alg"in h))switch((l=v.hash)===null||l===void 0?void 0:l.name.toUpperCase()){case"SHA-1":h.alg="RS1";break;case"SHA-256":h.alg="RS256";break;case"SHA-384":h.alg="RS384";break;case"SHA-512":h.alg="RS512";break;default:throw new Error(`Incorrect hash algorithm: ${(u=v.hash)===null||u===void 0?void 0:u.name.toUpperCase()}`)}const b=d.toJSON();Object.assign(h,b)}break;case"ECDSA":n=["sign"];case"ECDH":{if(h={kty:"EC",ext:a,key_ops:n},d.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error(`Incorrect algorithm: ${d.privateKeyAlgorithm.algorithmId}`);const b=d.toJSON();Object.assign(h,b)}break;case"RSA-OAEP":{if(h.kty="RSA",h.ext=a,h.key_ops=n,this.name.toLowerCase()==="safari")h.alg="RSA-OAEP";else switch((c=v.hash)===null||c===void 0?void 0:c.name.toUpperCase()){case"SHA-1":h.alg="RSA-OAEP";break;case"SHA-256":h.alg="RSA-OAEP-256";break;case"SHA-384":h.alg="RSA-OAEP-384";break;case"SHA-512":h.alg="RSA-OAEP-512";break;default:throw new Error(`Incorrect hash algorithm: ${(f=v.hash)===null||f===void 0?void 0:f.name.toUpperCase()}`)}const b=d.toJSON();Object.assign(h,b)}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],h.kty="RSA",h.ext=a,h.key_ops=n,h.alg="PS1";const b=d.toJSON();Object.assign(h,b)}break;default:throw new Error(`Incorrect algorithm name: ${v.name.toUpperCase()}`)}}break;case"jwk":h=t;break;default:throw new Error(`Incorrect format: ${e}`)}if(this.name.toLowerCase()==="safari")try{return this.subtle.importKey("jwk",ru(JSON.stringify(h)),s,a,n)}catch{return this.subtle.importKey("jwk",h,s,a,n)}return this.subtle.importKey("jwk",h,s,a,n)}async exportKey(e,t){let s=await this.subtle.exportKey("jwk",t);switch(this.name.toLowerCase()==="safari"&&s instanceof ArrayBuffer&&(s=JSON.parse(Sm(s))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{const a=new Ht;try{a.fromJSON(s)}catch{throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new hs;try{a.fromJSON(s)}catch{throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return s;default:throw new Error(`Incorrect format: ${e}`)}}async convert(e,t,s,a,n,i){if(e.toLowerCase()===t.toLowerCase())return s;const o=await this.importKey(e,s,a,n,i);return this.exportKey(t,o)}getAlgorithmByOID(e,t=!1,s){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error(`Unsupported algorithm identifier ${s?`for ${s} `:C}: ${e}`);return{}}getOIDByAlgorithm(e,t=!1,s){let a=C;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11";break}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35";break}if(!a&&t)throw new Error(`Unsupported algorithm ${s?`for ${s} `:C}: ${e.name}`);return a}getAlgorithmParameters(e,t){let s={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":s={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":s={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":s={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":s={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":s={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":s={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":s={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":s={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return s}getHashAlgorithm(e){let t=C;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const s=new gt({schema:e.algorithmParams});if(s.hashAlgorithm){const a=this.getAlgorithmByOID(s.hashAlgorithm.algorithmId);if("name"in a)t=a.name;else return C}else t="SHA-1"}catch{}break}return t}async encryptEncryptedContentInfo(e){Se.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),s=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),n=new ArrayBuffer(16),i=new Uint8Array(n);this.getRandomValues(i);const o=new ArrayBuffer(64),l=new Uint8Array(o);this.getRandomValues(l);const u=new Uint8Array(e.contentToEncrypt),c=new Vt({salt:new ae({valueHex:o}),iterationCount:e.iterationCount,prf:new H({algorithmId:a,algorithmParams:new rt})}),f=new Uint8Array(e.password),h=await this.importKey("raw",f,"PBKDF2",!1,["deriveKey"]),v=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:l,iterations:e.iterationCount},h,e.contentEncryptionAlgorithm,!1,["encrypt"]),d=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:i},v,u),A=new si({keyDerivationFunc:new H({algorithmId:s,algorithmParams:c.toSchema()}),encryptionScheme:new H({algorithmId:t,algorithmParams:new ae({valueHex:n})})});return new Xe({contentType:e.contentType,contentEncryptionAlgorithm:new H({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:A.toSchema()}),encryptedContent:new ae({valueHex:d})})}async decryptEncryptedContentInfo(e){if(Se.assert(e,"password","encryptedContentInfo"),e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")throw new Error(`Unknown "contentEncryptionAlgorithm": ${e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);let t;try{t=new si({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "pbes2Parameters"')}let s;try{s=new Vt({schema:t.keyDerivationFunc.algorithmParams})}catch{throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),n=t.encryptionScheme.algorithmParams.valueBlock.valueHex,i=new Uint8Array(n),o=s.salt.valueBlock.valueHex,l=new Uint8Array(o),u=s.iterationCount;let c="SHA-1";s.prf&&(c=this.getAlgorithmByOID(s.prf.algorithmId,!0).hash.name);const f=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),h=await this.deriveKey({name:"PBKDF2",hash:{name:c},salt:l,iterations:u},f,a,!1,["decrypt"]),v=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:i},h,v)}async stampDataWithPassword(e){if(!(e instanceof Object))throw new Error('Parameters must have type "Object"');Se.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp");let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Jg(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["sign"]);return this.sign(s,n,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){Se.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Jg(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["verify"]);return this.verify(s,n,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");const s=new H,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const n=a.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?n.hash.name=e.algorithm.hash.name:n.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":s.algorithmId=this.getOIDByAlgorithm(n,!0);break;case"RSA-PSS":{switch(n.hash.name.toUpperCase()){case"SHA-256":n.saltLength=32;break;case"SHA-384":n.saltLength=48;break;case"SHA-512":n.saltLength=64;break}const i={};if(n.hash.name.toUpperCase()!=="SHA-1"){const l=this.getOIDByAlgorithm({name:n.hash.name},!0,"hashAlgorithm");i.hashAlgorithm=new H({algorithmId:l,algorithmParams:new rt}),i.maskGenAlgorithm=new H({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:i.hashAlgorithm.toSchema()})}n.saltLength!==20&&(i.saltLength=n.saltLength);const o=new gt(i);s.algorithmId="1.2.840.113549.1.1.10",s.algorithmParams=o.toSchema()}break;default:throw new Error(`Unsupported signature algorithm: ${e.algorithm.name}`)}return{signatureAlgorithm:s,parameters:a}}async signWithPrivateKey(e,t,s){const a=await this.sign(s.algorithm,t,e);return s.algorithm.name==="ECDSA"?ZS(a):a}fillPublicKeyParameters(e,t){const s={},a=this.getHashAlgorithm(t);if(a===C)throw new Error(`Unsupported signature algorithm: ${t.algorithmId}`);let n;t.algorithmId==="1.2.840.113549.1.1.10"?n=t.algorithmId:n=e.algorithm.algorithmId;const i=this.getAlgorithmByOID(n,!0);if(s.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in s.algorithm.algorithm&&(s.algorithm.algorithm.hash.name=a),i.name==="ECDSA"){const o=e.algorithm;if(!o.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const l=o.algorithmParams;if("idBlock"in o.algorithmParams&&!(l.idBlock.tagClass===1&&l.idBlock.tagNumber===6))throw new Error("Incorrect type for ECDSA public key parameters");const u=this.getAlgorithmByOID(l.valueBlock.toString(),!0);s.algorithm.algorithm.namedCurve=u.name}return s}async getPublicKey(e,t,s){s||(s=this.fillPublicKeyParameters(e,t));const a=e.toSchema().toBER(!1);return this.importKey("spki",a,s.algorithm.algorithm,!0,s.algorithm.usages)}async verifyWithPublicKey(e,t,s,a,n){let i;if(n){const u={};let c;a.algorithmId==="1.2.840.113549.1.1.10"?c=a.algorithmId:c=s.algorithm.algorithmId;const f=this.getAlgorithmByOID(c,!0);if(u.algorithm=this.getAlgorithmParameters(f.name,"importKey"),"hash"in u.algorithm.algorithm&&(u.algorithm.algorithm.hash.name=n),f.name==="ECDSA"){let h=!1;if("algorithmParams"in s.algorithm&&"idBlock"in s.algorithm.algorithmParams&&s.algorithm.algorithmParams.idBlock.tagClass===1&&s.algorithm.algorithmParams.idBlock.tagNumber===6&&(h=!0),h===!1)throw new Error("Incorrect type for ECDSA public key parameters");const v=this.getAlgorithmByOID(s.algorithm.algorithmParams.valueBlock.toString(),!0);u.algorithm.algorithm.namedCurve=v.name}i=await this.getPublicKey(s,null,u)}else{if(n=this.getHashAlgorithm(a),!n)throw new Error(`Unsupported signature algorithm: ${a.algorithmId}`);i=await this.getPublicKey(s,a)}const o=this.getAlgorithmParameters(i.algorithm.name,"verify");"hash"in o.algorithm&&(o.algorithm.hash.name=n);let l=t.valueBlock.valueHexView;if(i.algorithm.name==="ECDSA"){const u=Da.find(i.algorithm.namedCurve);if(!u)throw new Error("Unsupported named curve in use");const c=ot(l);G.assert(c,"Signature value"),l=eA(c.result,u.size)}if(i.algorithm.name==="RSA-PSS"){const u=new gt({schema:a.algorithmParams});"saltLength"in u?o.algorithm.saltLength=u.saltLength:o.algorithm.saltLength=20;let c="SHA-1";"hashAlgorithm"in u&&(c=this.getAlgorithmByOID(u.hashAlgorithm.algorithmId,!0).name),o.algorithm.hash.name=c}return this.verify(o.algorithm,i,l,e)}}let Dw={name:"none",crypto:null};function Fg(r){return!!(r&&typeof r=="object"&&"crypto"in r)}function qg(r,...e){let t=null;if(e.length<2)e.length?t=e[0]:t=typeof self<"u"&&self.crypto?new ql({name:"browser",crypto:self.crypto}):null;else{const s=e[0],a=e[1];Fg(a)?t=a:Fg(s)?t=s:"subtle"in s&&"getRandomValues"in s&&(t=new ql({crypto:s}))}if(typeof ct<"u"&&"pid"in ct&&typeof qt<"u"&&typeof window>"u"){if(typeof qt[ct.pid]>"u")qt[ct.pid]={};else if(typeof qt[ct.pid]!="object")throw new Error(`Name global.${ct.pid} already exists and it is not an object`);if(typeof qt[ct.pid].pkijs>"u")qt[ct.pid].pkijs={};else if(typeof qt[ct.pid].pkijs!="object")throw new Error(`Name global.${ct.pid}.pkijs already exists and it is not an object`);qt[ct.pid].pkijs.engine={name:r,crypto:t}}else Dw={name:r,crypto:t}}function QS(){if(typeof ct<"u"&&"pid"in ct&&typeof qt<"u"&&typeof window>"u"){let r;try{r=qt[ct.pid].pkijs.engine}catch{throw new Error("Please call 'setEngine' before call to 'getEngine'")}return r}return Dw}function we(r=!1){const e=QS();if(!e.crypto&&r)throw new Error("Unable to create WebCrypto object");return e.crypto}function ZS(r){if(r.byteLength%2!==0)return We;const e=r.byteLength/2,t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(r,0,e));const s=new q({valueHex:t}),a=new ArrayBuffer(e);new Uint8Array(a).set(new Uint8Array(r,e,e));const n=new q({valueHex:a});return new D({value:[s.convertToDER(),n.convertToDER()]}).toBER(!1)}function eA(r,e){if(!(r instanceof D&&r.valueBlock.value.length===2&&r.valueBlock.value[0]instanceof q&&r.valueBlock.value[1]instanceof q))return We;const t=r.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,s=r.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,a=new Uint8Array(e*2);return a.set(t,e-t.byteLength),a.set(s,2*e-s.byteLength),a.buffer}async function tA(r,e,t,s,a){switch(r.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new Ve(`Unknown hash function: ${r}`)}if(Ve.assert(e,"zBuffer","ArrayBuffer"),e.byteLength===0)throw new Ve("'zBuffer' has zero length, error");if(Ve.assert(s,"SharedInfo","ArrayBuffer"),t>255)throw new Ve("Please set 'Counter' argument to value less or equal to 255");const n=new ArrayBuffer(4),i=new Uint8Array(n);i[0]=0,i[1]=0,i[2]=0,i[3]=t;let o=We;o=Xo(o,e),o=Xo(o,n),o=Xo(o,s);const l=await a.digest({name:r},o);return{counter:t,result:l}}async function Wg(r,e,t,s,a=we(!0)){let n=0,i=1;switch(r.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:throw new Ve(`Unknown hash function: ${r}`)}if(Ve.assert(e,"Zbuffer","ArrayBuffer"),e.byteLength===0)throw new Ve("'Zbuffer' has zero length, error");Ve.assert(s,"SharedInfo","ArrayBuffer");const o=t/n;Math.floor(o)>0&&(i=Math.floor(o),o-i>0&&i++);const l=[];for(let h=1;h<=i;h++)l.push(await tA(r,e,h,s,a));let u=We,c=1,f=!0;for(;f;){f=!1;for(const h of l)if(h.counter===c){u=Xo(u,h.result),f=!0;break}c++}if(t>>=3,u.byteLength>t){const h=new ArrayBuffer(t),v=new Uint8Array(h),d=new Uint8Array(u);for(let A=0;A<t;A++)v[A]=d[A];return h}return u}const $f="version",jf="logID",Kf="extensions",Mf="timestamp",Hf="hashAlgorithm",Jf="signatureAlgorithm",Ff="signature",_g="none",Gg="md5",zg="sha1",Xg="sha224",Yg="sha256",Qg="sha384",Zg="sha512",ey="anonymous",ty="rsa",sy="dsa",ry="ecdsa";class Ts extends Q{constructor(e={}){super(),this.version=g(e,$f,Ts.defaultValues($f)),this.logID=g(e,jf,Ts.defaultValues(jf)),this.timestamp=g(e,Mf,Ts.defaultValues(Mf)),this.extensions=g(e,Kf,Ts.defaultValues(Kf)),this.hashAlgorithm=g(e,Hf,Ts.defaultValues(Hf)),this.signatureAlgorithm=g(e,Jf,Ts.defaultValues(Jf)),this.signature=g(e,Ff,Ts.defaultValues(Ff)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $f:return 0;case jf:case Kf:return We;case Mf:return new Date(0);case Hf:case Jf:return C;case Ff:return We;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof Am))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new Pa({stream:new Ke({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(M0(new Uint8Array(e.getBlock(8)),8));const s=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(s)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=_g;break;case 1:this.hashAlgorithm=Gg;break;case 2:this.hashAlgorithm=zg;break;case 3:this.hashAlgorithm=Xg;break;case 4:this.hashAlgorithm=Yg;break;case 5:this.hashAlgorithm=Qg;break;case 6:this.hashAlgorithm=Zg;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=ey;break;case 1:this.signatureAlgorithm=ty;break;case 2:this.signatureAlgorithm=sy;break;case 3:this.signatureAlgorithm=ry;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16();if(this.signature=new Uint8Array(e.getBlock(a)).buffer.slice(0),t!==47+s+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new Am({data:e.stream.buffer})}toStream(){const e=new Pa;e.appendUint16(47+this.extensions.byteLength+this.signature.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),s=new Uint8Array(t),a=_d(this.timestamp.valueOf(),8);s.set(new Uint8Array(a),8-a.byteLength),e.appendView(s),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions));let n;switch(this.hashAlgorithm.toLowerCase()){case _g:n=0;break;case Gg:n=1;break;case zg:n=2;break;case Xg:n=3;break;case Yg:n=4;break;case Qg:n=5;break;case Zg:n=6;break;default:throw new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}e.appendChar(n);let i;switch(this.signatureAlgorithm.toLowerCase()){case ey:i=0;break;case ty:i=1;break;case sy:i=2;break;case ry:i=3;break;default:throw new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}return e.appendChar(i),e.appendUint16(this.signature.byteLength),e.appendView(new Uint8Array(this.signature)),e}toJSON(){return{version:this.version,logID:hf(this.logID),timestamp:this.timestamp,extensions:hf(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:hf(this.signature)}}async verify(e,t,s=0,a=we(!0)){const n=dp(Sm(this.logID));let i=null;const o=new Pa;for(const v of e)if(v.log_id===n){i=v.key;break}if(!i)throw new Error(`Public key not found for CT with logId: ${n}`);const l=ru(Rl(i)),u=Ht.fromBER(l);o.appendChar(0),o.appendChar(0);const c=new ArrayBuffer(8),f=new Uint8Array(c),h=_d(this.timestamp.valueOf(),8);return f.set(new Uint8Array(h),8-h.byteLength),o.appendView(f),o.appendUint16(s),s===0&&o.appendUint24(t.byteLength),o.appendView(new Uint8Array(t)),o.appendUint16(this.extensions.byteLength),this.extensions.byteLength!==0&&o.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(o.buffer.slice(0,o.length),new ae({valueHex:this.signature}),u,{algorithmId:C},"SHA-256")}}Ts.CLASS_NAME="SignedCertificateTimestamp";const dh="timestamps";class ef extends Q{constructor(e={}){super(),this.timestamps=g(e,dh,ef.defaultValues(dh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case dh:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case dh:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){var t;const s=g(e,"names",{});return(t=s.optional)!==null&&t!==void 0||(s.optional=!1),new ae({name:s.blockName||"SignedCertificateTimestampList",optional:s.optional})}fromSchema(e){if(!(e instanceof ae))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new Pa({stream:new Ke({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new Ts({stream:t}))}toSchema(){const e=new Pa;let t=0;const s=[];for(const a of this.timestamps){const n=a.toStream();s.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const a of s)e.appendView(a.stream.view);return new ae({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}ef.CLASS_NAME="SignedCertificateTimestampList";const vc="attributes",sA=[vc];class Wl extends Q{constructor(e={}){super(),this.attributes=g(e,vc,Wl.defaultValues(vc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vc:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.attributes||C,value:Oe.schema()})]})}fromSchema(e){ee(e,sA);const t=te(e,e,Wl.schema({names:{attributes:vc}}));G.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,s=>new Oe({schema:s}))}toSchema(){return new D({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}Wl.CLASS_NAME="SubjectDirectoryAttributes";class je{static getItems(){return this.types||(this.types={},je.register(yw,"SubjectAltName",au),je.register(ww,"IssuerAltName",au),je.register(yd,"AuthorityKeyIdentifier",Ca),je.register(dd,"BasicConstraints",Xn),je.register(wS,"MicrosoftCaVersion",Ml),je.register(Nw,"CertificatePolicies",nu),je.register(mS,"CertificatePoliciesMicrosoft",nu),je.register(yS,"MicrosoftCertTemplateV2",Go),je.register(Aw,"CRLDistributionPoints",iu),je.register(gd,"FreshestCRL",iu),je.register(fS,"ExtKeyUsage",Hl),je.register(bw,"CertificateIssuer",nt),je.register(wd,"AuthorityInfoAccess",ou),je.register(dS,"SubjectInfoAccess",ou),je.register(vw,"IssuingDistributionPoint",dt),je.register(Sw,"NameConstraints",Yo),je.register(Cw,"PolicyConstraints",Qo),je.register(Ew,"PolicyMappings",Jl),je.register(oS,"PrivateKeyUsagePeriod",Zo),je.register(vS,"QCStatements",Fl),je.register(gS,"SignedCertificateTimestampList",ef),je.register(aS,"SubjectDirectoryAttributes",Wl)),this.types}static fromBER(e,t){const s=ot(t);if(s.offset===-1)return null;const a=this.find(e);if(a)try{return new a.type({schema:s.result})}catch{const n=new a.type;return n.parsingError=`Incorrectly formatted value of extension ${a.name} (${e})`,n}return s.result}static find(e){return this.getItems()[e]||null}static register(e,t,s){this.getItems()[e]={name:t,type:s}}}const bc="extnID",Gr="critical",Sc="extnValue",gh="parsedValue",rA=[bc,Gr,Sc];class st extends Q{get parsedValue(){if(this._parsedValue===void 0){const e=je.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=g(e,bc,st.defaultValues(bc)),this.critical=g(e,Gr,st.defaultValues(Gr)),Sc in e?this.extnValue=new ae({valueHex:e.extnValue}):this.extnValue=st.defaultValues(Sc),gh in e&&(this.parsedValue=g(e,gh,st.defaultValues(gh))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bc:return C;case Gr:return!1;case Sc:return new ae;case gh:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.extnID||C}),new Ra({name:t.critical||C,optional:!0}),new ae({name:t.extnValue||C})]})}fromSchema(e){ee(e,rA);const t=te(e,e,st.schema({names:{extnID:bc,critical:Gr,extnValue:Sc}}));G.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),Gr in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new le({value:this.extnID})),this.critical!==st.defaultValues(Gr)&&e.push(new Ra({value:this.critical})),e.push(this.extnValue),new D({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==st.defaultValues(Gr)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}st.CLASS_NAME="Extension";const Ac="extensions",aA=[Ac];class _e extends Q{constructor(e={}){super(),this.extensions=g(e,Ac,_e.defaultValues(Ac)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ac:return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=g(e,"names",{});return new D({optional:t,name:s.blockName||C,value:[new ye({name:s.extensions||C,value:st.schema(s.extension||{})})]})}fromSchema(e){ee(e,aA);const t=te(e,e,_e.schema({names:{extensions:Ac}}));G.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,s=>new st({schema:s}))}toSchema(){return new D({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}_e.CLASS_NAME="Extensions";const Nc="issuer",Ec="serialNumber",sn="issuerUID",nA=[Nc,Ec,sn];class Kt extends Q{constructor(e={}){super(),this.issuer=g(e,Nc,Kt.defaultValues(Nc)),this.serialNumber=g(e,Ec,Kt.defaultValues(Ec)),sn in e&&(this.issuerUID=g(e,sn,Kt.defaultValues(sn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nc:return new nt;case Ec:return new q;case sn:return new be;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[nt.schema(t.issuer||{}),new q({name:t.serialNumber||C}),new be({optional:!0,name:t.issuerUID||C})]})}fromSchema(e){ee(e,nA);const t=te(e,e,Kt.schema({names:{issuer:{names:{blockName:Nc}},serialNumber:Ec,issuerUID:sn}}));G.assertSchema(t,this.className),this.issuer=new nt({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,sn in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new D({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}Kt.CLASS_NAME="IssuerSerial";const Cc="version",rn="baseCertificateID",an="subjectName",kc="issuer",Ic="signature",Vc="serialNumber",Bc="attrCertValidityPeriod",xc="attributes",nn="issuerUniqueID",on="extensions",iA=[Cc,rn,an,kc,Ic,Vc,Bc,xc,nn,on];class kt extends Q{constructor(e={}){super(),this.version=g(e,Cc,kt.defaultValues(Cc)),rn in e&&(this.baseCertificateID=g(e,rn,kt.defaultValues(rn))),an in e&&(this.subjectName=g(e,an,kt.defaultValues(an))),this.issuer=g(e,kc,kt.defaultValues(kc)),this.signature=g(e,Ic,kt.defaultValues(Ic)),this.serialNumber=g(e,Vc,kt.defaultValues(Vc)),this.attrCertValidityPeriod=g(e,Bc,kt.defaultValues(Bc)),this.attributes=g(e,xc,kt.defaultValues(xc)),nn in e&&(this.issuerUniqueID=g(e,nn,kt.defaultValues(nn))),on in e&&(this.extensions=g(e,on,kt.defaultValues(on))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cc:return 0;case rn:return new Kt;case an:return new nt;case kc:return new nt;case Ic:return new H;case Vc:return new q;case Bc:return new Is;case xc:return[];case nn:return new be;case on:return new _e;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),new Me({value:[new j({name:t.baseCertificateID||C,idBlock:{tagClass:3,tagNumber:0},value:Kt.schema().valueBlock.value}),new j({name:t.subjectName||C,idBlock:{tagClass:3,tagNumber:1},value:nt.schema().valueBlock.value})]}),nt.schema({names:{blockName:t.issuer||C}}),H.schema(t.signature||{}),new q({name:t.serialNumber||C}),Is.schema(t.attrCertValidityPeriod||{}),new D({name:t.attributes||C,value:[new ye({value:Oe.schema()})]}),new be({optional:!0,name:t.issuerUniqueID||C}),_e.schema(t.extensions||{},!0)]})}fromSchema(e){ee(e,iA);const t=te(e,e,kt.schema({names:{version:Cc,baseCertificateID:rn,subjectName:an,issuer:kc,signature:{names:{blockName:Ic}},serialNumber:Vc,attrCertValidityPeriod:{names:{blockName:Bc}},attributes:xc,issuerUniqueID:nn,extensions:{names:{blockName:on}}}}));G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,rn in t.result&&(this.baseCertificateID=new Kt({schema:new D({value:t.result.baseCertificateID.valueBlock.value})})),an in t.result&&(this.subjectName=new nt({schema:new D({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new H({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new Is({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new Oe({schema:s})),nn in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),on in t.result&&(this.extensions=new _e({schema:t.result.extensions}))}toSchema(){const e=new D({value:[new q({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new j({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new j({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new D({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}kt.CLASS_NAME="AttributeCertificateInfoV1";const Oc="acinfo",Pc="signatureAlgorithm",Dc="signatureValue",oA=[Oc,Dc,Pc];class or extends Q{constructor(e={}){super(),this.acinfo=g(e,Oc,or.defaultValues(Oc)),this.signatureAlgorithm=g(e,Pc,or.defaultValues(Pc)),this.signatureValue=g(e,Dc,or.defaultValues(Dc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oc:return new kt;case Pc:return new H;case Dc:return new be;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[kt.schema(t.acinfo||{}),H.schema(t.signatureAlgorithm||{}),new be({name:t.signatureValue||C})]})}fromSchema(e){ee(e,oA);const t=te(e,e,or.schema({names:{acinfo:{names:{blockName:Oc}},signatureAlgorithm:{names:{blockName:Pc}},signatureValue:Dc}}));G.assertSchema(t,this.className),this.acinfo=new kt({schema:t.result.acinfo}),this.signatureAlgorithm=new H({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new D({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}or.CLASS_NAME="AttributeCertificateV1";const Tc="digestedObjectType",un="otherObjectTypeID",Lc="digestAlgorithm",Rc="objectDigest",uA=[Tc,un,Lc,Rc];class Zt extends Q{constructor(e={}){super(),this.digestedObjectType=g(e,Tc,Zt.defaultValues(Tc)),un in e&&(this.otherObjectTypeID=g(e,un,Zt.defaultValues(un))),this.digestAlgorithm=g(e,Lc,Zt.defaultValues(Lc)),this.objectDigest=g(e,Rc,Zt.defaultValues(Rc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tc:return new $l;case un:return new le;case Lc:return new H;case Rc:return new be;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new $l({name:t.digestedObjectType||C}),new le({optional:!0,name:t.otherObjectTypeID||C}),H.schema(t.digestAlgorithm||{}),new be({name:t.objectDigest||C})]})}fromSchema(e){ee(e,uA);const t=te(e,e,Zt.schema({names:{digestedObjectType:Tc,otherObjectTypeID:un,digestAlgorithm:{names:{blockName:Lc}},objectDigest:Rc}}));G.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,un in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new H({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new D({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}Zt.CLASS_NAME="ObjectDigestInfo";const cn="issuerName",ln="baseCertificateID",hn="objectDigestInfo",cA=[cn,ln,hn];class Ia extends Q{constructor(e={}){super(),cn in e&&(this.issuerName=g(e,cn,Ia.defaultValues(cn))),ln in e&&(this.baseCertificateID=g(e,ln,Ia.defaultValues(ln))),hn in e&&(this.objectDigestInfo=g(e,hn,Ia.defaultValues(hn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cn:return new nt;case ln:return new Kt;case hn:return new Zt;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[nt.schema({names:{blockName:t.issuerName}},!0),new j({optional:!0,name:t.baseCertificateID||C,idBlock:{tagClass:3,tagNumber:0},value:Kt.schema().valueBlock.value}),new j({optional:!0,name:t.objectDigestInfo||C,idBlock:{tagClass:3,tagNumber:1},value:Zt.schema().valueBlock.value})]})}fromSchema(e){ee(e,cA);const t=te(e,e,Ia.schema({names:{issuerName:cn,baseCertificateID:ln,objectDigestInfo:hn}}));G.assertSchema(t,this.className),cn in t.result&&(this.issuerName=new nt({schema:t.result.issuerName})),ln in t.result&&(this.baseCertificateID=new Kt({schema:new D({value:t.result.baseCertificateID.valueBlock.value})})),hn in t.result&&(this.objectDigestInfo=new Zt({schema:new D({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new D;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new j({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new j({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}Ia.CLASS_NAME="V2Form";const mn="baseCertificateID",fn="entityName",pn="objectDigestInfo",lA=[mn,fn,pn];class ur extends Q{constructor(e={}){super(),mn in e&&(this.baseCertificateID=g(e,mn,ur.defaultValues(mn))),fn in e&&(this.entityName=g(e,fn,ur.defaultValues(fn))),pn in e&&(this.objectDigestInfo=g(e,pn,ur.defaultValues(pn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mn:return new Kt;case fn:return new nt;case pn:return new Zt;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new j({optional:!0,name:t.baseCertificateID||C,idBlock:{tagClass:3,tagNumber:0},value:Kt.schema().valueBlock.value}),new j({optional:!0,name:t.entityName||C,idBlock:{tagClass:3,tagNumber:1},value:nt.schema().valueBlock.value}),new j({optional:!0,name:t.objectDigestInfo||C,idBlock:{tagClass:3,tagNumber:2},value:Zt.schema().valueBlock.value})]})}fromSchema(e){ee(e,lA);const t=te(e,e,ur.schema({names:{baseCertificateID:mn,entityName:fn,objectDigestInfo:pn}}));G.assertSchema(t,this.className),mn in t.result&&(this.baseCertificateID=new Kt({schema:new D({value:t.result.baseCertificateID.valueBlock.value})})),fn in t.result&&(this.entityName=new nt({schema:new D({value:t.result.entityName.valueBlock.value})})),pn in t.result&&(this.objectDigestInfo=new Zt({schema:new D({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new D;return this.baseCertificateID&&e.valueBlock.value.push(new j({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new j({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new j({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}ur.CLASS_NAME="Holder";const Uc="version",$c="holder",jc="issuer",Kc="signature",Mc="serialNumber",Hc="attrCertValidityPeriod",Jc="attributes",dn="issuerUniqueID",gn="extensions",hA=[Uc,$c,jc,Kc,Mc,Hc,Jc,dn,gn];class Pt extends Q{constructor(e={}){super(),this.version=g(e,Uc,Pt.defaultValues(Uc)),this.holder=g(e,$c,Pt.defaultValues($c)),this.issuer=g(e,jc,Pt.defaultValues(jc)),this.signature=g(e,Kc,Pt.defaultValues(Kc)),this.serialNumber=g(e,Mc,Pt.defaultValues(Mc)),this.attrCertValidityPeriod=g(e,Hc,Pt.defaultValues(Hc)),this.attributes=g(e,Jc,Pt.defaultValues(Jc)),dn in e&&(this.issuerUniqueID=g(e,dn,Pt.defaultValues(dn))),gn in e&&(this.extensions=g(e,gn,Pt.defaultValues(gn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uc:return 1;case $c:return new ur;case jc:return{};case Kc:return new H;case Mc:return new q;case Hc:return new Is;case Jc:return[];case dn:return new be;case gn:return new _e;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),ur.schema(t.holder||{}),new Me({value:[nt.schema({names:{blockName:t.issuer||C}}),new j({name:t.issuer||C,idBlock:{tagClass:3,tagNumber:0},value:Ia.schema().valueBlock.value})]}),H.schema(t.signature||{}),new q({name:t.serialNumber||C}),Is.schema(t.attrCertValidityPeriod||{}),new D({name:t.attributes||C,value:[new ye({value:Oe.schema()})]}),new be({optional:!0,name:t.issuerUniqueID||C}),_e.schema(t.extensions||{},!0)]})}fromSchema(e){ee(e,hA);const t=te(e,e,Pt.schema({names:{version:Uc,holder:{names:{blockName:$c}},issuer:jc,signature:{names:{blockName:Kc}},serialNumber:Mc,attrCertValidityPeriod:{names:{blockName:Hc}},attributes:Jc,issuerUniqueID:dn,extensions:{names:{blockName:gn}}}}));switch(G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new ur({schema:t.result.holder}),t.result.issuer.idBlock.tagClass){case 3:this.issuer=new Ia({schema:new D({value:t.result.issuer.valueBlock.value})});break;case 1:default:throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2")}this.signature=new H({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new Is({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new Oe({schema:s})),dn in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),gn in t.result&&(this.extensions=new _e({schema:t.result.extensions}))}toSchema(){const e=new D({value:[new q({value:this.version}),this.holder.toSchema(),new j({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new D({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}Pt.CLASS_NAME="AttributeCertificateInfoV2";const Fc="acinfo",qc="signatureAlgorithm",Wc="signatureValue",mA=[Fc,qc,Wc];class ts extends Q{constructor(e={}){super(),this.acinfo=g(e,Fc,ts.defaultValues(Fc)),this.signatureAlgorithm=g(e,qc,ts.defaultValues(qc)),this.signatureValue=g(e,Wc,ts.defaultValues(Wc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fc:return new Pt;case qc:return new H;case Wc:return new be;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[Pt.schema(t.acinfo||{}),H.schema(t.signatureAlgorithm||{}),new be({name:t.signatureValue||C})]})}fromSchema(e){ee(e,mA);const t=te(e,e,ts.schema({names:{acinfo:{names:{blockName:Fc}},signatureAlgorithm:{names:{blockName:qc}},signatureValue:Wc}}));G.assertSchema(t,this.className),this.acinfo=new Pt({schema:t.result.acinfo}),this.signatureAlgorithm=new H({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new D({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}ts.CLASS_NAME="AttributeCertificateV2";const yn="contentType",Di="content",fA=[yn,Di];class Ie extends Q{constructor(e={}){super(),this.contentType=g(e,yn,Ie.defaultValues(yn)),this.content=g(e,Di,Ie.defaultValues(Di)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yn:return C;case Di:return new de;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case yn:return typeof t=="string"&&t===this.defaultValues(yn);case Di:return t instanceof de;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return"optional"in t||(t.optional=!1),new D({name:t.blockName||"ContentInfo",optional:t.optional,value:[new le({name:t.contentType||yn}),new j({idBlock:{tagClass:3,tagNumber:0},value:[new de({name:t.content||Di})]})]})}fromSchema(e){ee(e,fA);const t=te(e,e,Ie.schema());G.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new D({value:[new le({value:this.contentType}),new j({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof de||(e.content=this.content.toJSON()),e}}Ie.CLASS_NAME="ContentInfo",Ie.DATA=vd,Ie.SIGNED_DATA=kw,Ie.ENVELOPED_DATA=Iw,Ie.ENCRYPTED_DATA=Vw;const qf="type",Wf="value",Vp="utcTimeName",Bp="generalTimeName",pA=[Vp,Bp];var ay;(function(r){r[r.UTCTime=0]="UTCTime",r[r.GeneralizedTime=1]="GeneralizedTime",r[r.empty=2]="empty"})(ay||(ay={}));class Qe extends Q{constructor(e={}){super(),this.type=g(e,qf,Qe.defaultValues(qf)),this.value=g(e,Wf,Qe.defaultValues(Wf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qf:return 0;case Wf:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=g(e,"names",{});return new Me({optional:t,value:[new Nm({name:s.utcTimeName||C}),new Je({name:s.generalTimeName||C})]})}fromSchema(e){ee(e,pA);const t=te(e,e,Qe.schema({names:{utcTimeName:Vp,generalTimeName:Bp}}));G.assertSchema(t,this.className),Vp in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),Bp in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return this.type===0?new Nm({valueDate:this.value}):this.type===1?new Je({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}Qe.CLASS_NAME="Time";const _f="tbs",zr="version",jh="serialNumber",Kh="signature",Mh="issuer",Hh="notBefore",Jh="notAfter",Fh="subject",qh="subjectPublicKeyInfo",_c="issuerUniqueID",Gc="subjectUniqueID",zc="extensions",Xc="signatureAlgorithm",Yc="signatureValue",as="tbsCertificate",Pm=`${as}.${zr}`,bd=`${as}.${jh}`,Sd=`${as}.${Kh}`,Ad=`${as}.${Mh}`,Dm=`${as}.${Hh}`,Tm=`${as}.${Jh}`,Nd=`${as}.${Fh}`,Ed=`${as}.${qh}`,Lm=`${as}.${_c}`,Rm=`${as}.${Gc}`,Ol=`${as}.${zc}`,dA=[as,Pm,bd,Sd,Ad,Dm,Tm,Nd,Ed,Lm,Rm,Ol,Xc,Yc];function gA(r={}){const e=g(r,"names",{});return new D({name:e.blockName||as,value:[new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new q({name:e.tbsCertificateVersion||Pm})]}),new q({name:e.tbsCertificateSerialNumber||bd}),H.schema(e.signature||{names:{blockName:Sd}}),Be.schema(e.issuer||{names:{blockName:Ad}}),new D({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[Qe.schema(e.notBefore||{names:{utcTimeName:Dm,generalTimeName:Dm}}),Qe.schema(e.notAfter||{names:{utcTimeName:Tm,generalTimeName:Tm}})]}),Be.schema(e.subject||{names:{blockName:Nd}}),Ht.schema(e.subjectPublicKeyInfo||{names:{blockName:Ed}}),new pe({name:e.tbsCertificateIssuerUniqueID||Lm,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new pe({name:e.tbsCertificateSubjectUniqueID||Rm,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[_e.schema(e.extensions||{names:{blockName:Ol}})]})]})}class Ae extends Q{get tbs(){return Te.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(g(e,_f,Ae.defaultValues(_f))),this.version=g(e,zr,Ae.defaultValues(zr)),this.serialNumber=g(e,jh,Ae.defaultValues(jh)),this.signature=g(e,Kh,Ae.defaultValues(Kh)),this.issuer=g(e,Mh,Ae.defaultValues(Mh)),this.notBefore=g(e,Hh,Ae.defaultValues(Hh)),this.notAfter=g(e,Jh,Ae.defaultValues(Jh)),this.subject=g(e,Fh,Ae.defaultValues(Fh)),this.subjectPublicKeyInfo=g(e,qh,Ae.defaultValues(qh)),_c in e&&(this.issuerUniqueID=g(e,_c,Ae.defaultValues(_c))),Gc in e&&(this.subjectUniqueID=g(e,Gc,Ae.defaultValues(Gc))),zc in e&&(this.extensions=g(e,zc,Ae.defaultValues(zc))),this.signatureAlgorithm=g(e,Xc,Ae.defaultValues(Xc)),this.signatureValue=g(e,Yc,Ae.defaultValues(Yc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _f:return We;case zr:return 0;case jh:return new q;case Kh:return new H;case Mh:return new Be;case Hh:return new Qe;case Jh:return new Qe;case Fh:return new Be;case qh:return new Ht;case _c:return We;case Gc:return We;case zc:return[];case Xc:return new H;case Yc:return new be;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[gA(t.tbsCertificate),H.schema(t.signatureAlgorithm||{names:{blockName:Xc}}),new be({name:t.signatureValue||Yc})]})}fromSchema(e){ee(e,dA);const t=te(e,e,Ae.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:Ol}}}}}}));G.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,Pm in t.result&&(this.version=t.result[Pm].valueBlock.valueDec),this.serialNumber=t.result[bd],this.signature=new H({schema:t.result[Sd]}),this.issuer=new Be({schema:t.result[Ad]}),this.notBefore=new Qe({schema:t.result[Dm]}),this.notAfter=new Qe({schema:t.result[Tm]}),this.subject=new Be({schema:t.result[Nd]}),this.subjectPublicKeyInfo=new Ht({schema:t.result[Ed]}),Lm in t.result&&(this.issuerUniqueID=t.result[Lm].valueBlock.valueHex),Rm in t.result&&(this.subjectUniqueID=t.result[Rm].valueBlock.valueHex),Ol in t.result&&(this.extensions=Array.from(t.result[Ol],s=>new st({schema:s}))),this.signatureAlgorithm=new H({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return zr in this&&this.version!==Ae.defaultValues(zr)&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new q({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new D({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new pe({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new pe({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new D({value:Array.from(this.extensions,t=>t.toSchema())})]})),new D({value:e})}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return Ae.schema().value[0];const s=ot(this.tbsView);G.assert(s,"TBS Certificate"),t=s.result}else t=this.encodeTBS();return new D({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ke.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return zr in this&&this.version!==Ae.defaultValues(zr)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=ke.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=ke.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async getPublicKey(e,t=we(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=we(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",s=we(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new be({valueHex:i})}async verify(e,t=we(!0)){let s;if(e?s=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(s=this.subjectPublicKeyInfo),!(s instanceof Ht))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}Ae.CLASS_NAME="Certificate";function Tw(r,e=null){if(e&&r.issuer.isEqual(e.issuer)&&r.serialNumber.isEqual(e.serialNumber))return null;let t=!1;if(r.extensions){for(const s of r.extensions)if(s.extnID===dd&&s.parsedValue instanceof Xn&&s.parsedValue.cA){t=!0;break}}return t?r:null}const Ti="certId",Li="certValue",di="parsedValue",yA=[Ti,Li];class Wn extends Q{constructor(e={}){super(),this.certId=g(e,Ti,Wn.defaultValues(Ti)),this.certValue=g(e,Li,Wn.defaultValues(Li)),di in e&&(this.parsedValue=g(e,di,Wn.defaultValues(di))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ti:return C;case Li:return new de;case di:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ti:return t===C;case Li:return t instanceof de;case di:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.id||"id"}),new j({idBlock:{tagClass:3,tagNumber:0},value:[new de({name:t.value||"value"})]})]})}fromSchema(e){ee(e,yA);const t=te(e,e,Wn.schema({names:{id:Ti,value:Li}}));G.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const s=this.certValue.valueBlock.valueHexView;switch(this.certId){case jg:try{this.parsedValue=Ae.fromBER(s)}catch{ts.fromBER(s)}break;case Kg:this.parsedValue=ts.fromBER(s);break;case SS:default:throw new Error(`Incorrect CERT_ID value in CertBag: ${this.certId}`)}}toSchema(){return di in this&&("acinfo"in this.parsedValue?this.certId=Kg:this.certId=jg,this.certValue=new ae({valueHex:this.parsedValue.toSchema().toBER(!1)})),new D({value:[new le({value:this.certId}),new j({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}Wn.CLASS_NAME="CertBag";const Qc="userCertificate",Ri="revocationDate",wn="crlEntryExtensions",wA=[Qc,Ri,wn];class _n extends Q{constructor(e={}){super(),this.userCertificate=g(e,Qc,_n.defaultValues(Qc)),this.revocationDate=g(e,Ri,_n.defaultValues(Ri)),wn in e&&(this.crlEntryExtensions=g(e,wn,_n.defaultValues(wn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qc:return new q;case Ri:return new Qe;case wn:return new _e;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.userCertificate||Qc}),Qe.schema({names:{utcTimeName:t.revocationDate||Ri,generalTimeName:t.revocationDate||Ri}}),_e.schema({names:{blockName:t.crlEntryExtensions||wn}},!0)]})}fromSchema(e){ee(e,wA);const t=te(e,e,_n.schema());G.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new Qe({schema:t.result.revocationDate}),wn in t.result&&(this.crlEntryExtensions=new _e({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new D({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}_n.CLASS_NAME="RevokedCertificate";const Gf="tbs",Eu="version",zf="signature",Xf="issuer",Yf="thisUpdate",yh="nextUpdate",wh="revokedCertificates",vh="crlExtensions",Zc="signatureAlgorithm",el="signatureValue",br="tbsCertList",Um=`${br}.version`,Cd=`${br}.signature`,kd=`${br}.issuer`,$m=`${br}.thisUpdate`,_l=`${br}.nextUpdate`,jm=`${br}.revokedCertificates`,Km=`${br}.extensions`,vA=[br,Um,Cd,kd,$m,_l,jm,Km,Zc,el];function bA(r={}){const e=g(r,"names",{});return new D({name:e.blockName||br,value:[new q({optional:!0,name:e.tbsCertListVersion||Um,value:2}),H.schema(e.signature||{names:{blockName:Cd}}),Be.schema(e.issuer||{names:{blockName:kd}}),Qe.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:$m,generalTimeName:$m}}),Qe.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:_l,generalTimeName:_l}},!0),new D({optional:!0,value:[new ye({name:e.tbsCertListRevokedCertificates||jm,value:new D({value:[new q,Qe.schema(),_e.schema({},!0)]})})]}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[_e.schema(e.crlExtensions||{names:{blockName:Km}})]})]})}const SA=[yd,ww,uS,cS,vw,gd,wd,lS,hS,bw];class tt extends Q{get tbs(){return Te.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(g(e,Gf,tt.defaultValues(Gf))),this.version=g(e,Eu,tt.defaultValues(Eu)),this.signature=g(e,zf,tt.defaultValues(zf)),this.issuer=g(e,Xf,tt.defaultValues(Xf)),this.thisUpdate=g(e,Yf,tt.defaultValues(Yf)),yh in e&&(this.nextUpdate=g(e,yh,tt.defaultValues(yh))),wh in e&&(this.revokedCertificates=g(e,wh,tt.defaultValues(wh))),vh in e&&(this.crlExtensions=g(e,vh,tt.defaultValues(vh))),this.signatureAlgorithm=g(e,Zc,tt.defaultValues(Zc)),this.signatureValue=g(e,el,tt.defaultValues(el)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gf:return We;case Eu:return 0;case zf:return new H;case Xf:return new Be;case Yf:return new Qe;case yh:return new Qe;case wh:return[];case vh:return new _e;case Zc:return new H;case el:return new be;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||"CertificateList",value:[bA(e),H.schema(t.signatureAlgorithm||{names:{blockName:Zc}}),new be({name:t.signatureValue||el})]})}fromSchema(e){ee(e,vA);const t=te(e,e,tt.schema());G.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,Um in t.result&&(this.version=t.result[Um].valueBlock.valueDec),this.signature=new H({schema:t.result[Cd]}),this.issuer=new Be({schema:t.result[kd]}),this.thisUpdate=new Qe({schema:t.result[$m]}),_l in t.result&&(this.nextUpdate=new Qe({schema:t.result[_l]})),jm in t.result&&(this.revokedCertificates=Array.from(t.result[jm],s=>new _n({schema:s}))),Km in t.result&&(this.crlExtensions=new _e({schema:t.result[Km]})),this.signatureAlgorithm=new H({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==tt.defaultValues(Eu)&&e.push(new q({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new D({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new D({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return tt.schema();const s=ot(this.tbsView);G.assert(s,"TBS Certificate Revocation List"),t=s.result}return new D({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ke.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==tt.defaultValues(Eu)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",s=we(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),{parameters:n}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new be({valueHex:i})}async verify(e={},t=we(!0)){let s;if(e.issuerCertificate&&(s=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(s=e.publicKeyInfo),!s)throw new Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(const a of this.crlExtensions.extensions)if(a.critical&&!SA.includes(a.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}tt.CLASS_NAME="CertificateRevocationList";const Ui="crlId",$i="crlValue",Cu="parsedValue",AA=[Ui,$i];class Gn extends Q{constructor(e={}){super(),this.crlId=g(e,Ui,Gn.defaultValues(Ui)),this.crlValue=g(e,$i,Gn.defaultValues($i)),Cu in e&&(this.parsedValue=g(e,Cu,Gn.defaultValues(Cu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ui:return C;case $i:return new de;case Cu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ui:return t===C;case $i:return t instanceof de;case Cu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.id||"id"}),new j({idBlock:{tagClass:3,tagNumber:0},value:[new de({name:t.value||"value"})]})]})}fromSchema(e){ee(e,AA);const t=te(e,e,Gn.schema({names:{id:Ui,value:$i}}));switch(G.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId){case Mg:this.parsedValue=tt.fromBER(this.certValue.valueBlock.valueHex);break;default:throw new Error(`Incorrect CRL_ID value in CRLBag: ${this.crlId}`)}}toSchema(){return this.parsedValue&&(this.crlId=Mg,this.crlValue=new ae({valueHex:this.parsedValue.toSchema().toBER(!1)})),new D({value:[new le({value:this.crlId}),new j({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}Gn.CLASS_NAME="CRLBag";const ji="version",Ki="encryptedContentInfo",Xr="unprotectedAttrs",NA=[ji,Ki,Xr];class $s extends Q{constructor(e={}){super(),this.version=g(e,ji,$s.defaultValues(ji)),this.encryptedContentInfo=g(e,Ki,$s.defaultValues(Ki)),Xr in e&&(this.unprotectedAttrs=g(e,Xr,$s.defaultValues(Xr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ji:return 0;case Ki:return new Xe;case Xr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ji:return t===0;case Ki:return Xe.compareWithDefault("contentType",t.contentType)&&Xe.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Xe.compareWithDefault("encryptedContent",t.encryptedContent);case Xr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),Xe.schema(t.encryptedContentInfo||{}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ye({name:t.unprotectedAttrs||C,value:Oe.schema()})]})]})}fromSchema(e){ee(e,NA);const t=te(e,e,$s.schema({names:{version:ji,encryptedContentInfo:{names:{blockName:Ki}},unprotectedAttrs:Xr}}));G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new Xe({schema:t.result.encryptedContentInfo}),Xr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new Oe({schema:s})))}toSchema(){const e=[];return e.push(new q({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new D({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}async encrypt(e,t=we(!0)){Ve.assert(e,"parameters","object");const s={...e,contentType:"1.2.840.113549.1.7.1"};this.encryptedContentInfo=await t.encryptEncryptedContentInfo(s)}async decrypt(e,t=we(!0)){Ve.assert(e,"parameters","object");const s={...e,encryptedContentInfo:this.encryptedContentInfo};return t.decryptEncryptedContentInfo(s)}}$s.CLASS_NAME="EncryptedData";const vn="encryptionAlgorithm",Yr="encryptedData",ku="parsedValue",EA=[vn,Yr];class ba extends Q{constructor(e={}){super(),this.encryptionAlgorithm=g(e,vn,ba.defaultValues(vn)),this.encryptedData=g(e,Yr,ba.defaultValues(Yr)),ku in e&&(this.parsedValue=g(e,ku,ba.defaultValues(ku))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vn:return new H;case Yr:return new ae;case ku:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vn:return H.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Yr:return t.isEqual(ba.defaultValues(e));case ku:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[H.schema(t.encryptionAlgorithm||{names:{blockName:vn}}),new Me({value:[new ae({name:t.encryptedData||Yr}),new ae({idBlock:{isConstructed:!0},name:t.encryptedData||Yr})]})]})}fromSchema(e){ee(e,EA);const t=te(e,e,ba.schema({names:{encryptionAlgorithm:{names:{blockName:vn}},encryptedData:Yr}}));G.assertSchema(t,this.className),this.encryptionAlgorithm=new H({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new D({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=we(!0)){const s=await new $s({encryptedContentInfo:new Xe({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}).decrypt(e,t);this.parsedValue=hs.fromBER(s)}async makeInternalValues(e,t=we(!0)){if(!this.parsedValue)throw new Error('Please initialize "parsedValue" first');const s=new $s,a={...e,contentToEncrypt:this.parsedValue.toSchema().toBER(!1)};if(await s.encrypt(a,t),!s.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=s.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=s.encryptedContentInfo.encryptedContent}}ba.CLASS_NAME="PKCS8ShroudedKeyBag";const Mi="secretTypeId",Hi="secretValue",CA=[Mi,Hi];class eu extends Q{constructor(e={}){super(),this.secretTypeId=g(e,Mi,eu.defaultValues(Mi)),this.secretValue=g(e,Hi,eu.defaultValues(Hi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mi:return C;case Hi:return new de;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mi:return t===C;case Hi:return t instanceof de;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.id||"id"}),new j({idBlock:{tagClass:3,tagNumber:0},value:[new de({name:t.value||"value"})]})]})}fromSchema(e){ee(e,CA);const t=te(e,e,eu.schema({names:{id:Mi,value:Hi}}));G.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new D({value:[new le({value:this.secretTypeId}),new j({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}eu.CLASS_NAME="SecretBag";class ya{static getItems(){return this.items||(this.items={},ya.register("1.2.840.113549.1.12.10.1.1",hs),ya.register("1.2.840.113549.1.12.10.1.2",ba),ya.register("1.2.840.113549.1.12.10.1.3",Wn),ya.register("1.2.840.113549.1.12.10.1.4",Gn),ya.register("1.2.840.113549.1.12.10.1.5",eu),ya.register("1.2.840.113549.1.12.10.1.6",cr)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}const bn="bagId",Sn="bagValue",Xs="bagAttributes",kA=[bn,Sn,Xs];class Va extends Q{constructor(e={}){super(),this.bagId=g(e,bn,Va.defaultValues(bn)),this.bagValue=g(e,Sn,Va.defaultValues(Sn)),Xs in e&&(this.bagAttributes=g(e,Xs,Va.defaultValues(Xs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bn:return C;case Sn:return new de;case Xs:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bn:return t===C;case Sn:return t instanceof de;case Xs:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.bagId||bn}),new j({idBlock:{tagClass:3,tagNumber:0},value:[new de({name:t.bagValue||Sn})]}),new at({optional:!0,value:[new ye({name:t.bagAttributes||Xs,value:Oe.schema()})]})]})}fromSchema(e){ee(e,kA);const t=te(e,e,Va.schema({names:{bagId:bn,bagValue:Sn,bagAttributes:Xs}}));G.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const s=ya.find(this.bagId);if(!s)throw new Error(`Invalid BAG_ID for SafeBag: ${this.bagId}`);this.bagValue=new s({schema:t.result.bagValue}),Xs in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new Oe({schema:a})))}toSchema(){const e=[new le({value:this.bagId}),new j({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new at({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new D({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}Va.CLASS_NAME="SafeBag";const gi="safeBags";class cr extends Q{constructor(e={}){super(),this.safeBags=g(e,gi,cr.defaultValues(gi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case gi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.safeBags||C,value:Va.schema()})]})}fromSchema(e){ee(e,[gi]);const t=te(e,e,cr.schema({names:{safeBags:gi}}));G.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,s=>new Va({schema:s}))}toSchema(){return new D({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}cr.CLASS_NAME="SafeContents";const tl="otherCertFormat",sl="otherCert",IA=[tl,sl];class Ta extends Q{constructor(e={}){super(),this.otherCertFormat=g(e,tl,Ta.defaultValues(tl)),this.otherCert=g(e,sl,Ta.defaultValues(sl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tl:return C;case sl:return new de;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.otherCertFormat||tl}),new de({name:t.otherCert||sl})]})}fromSchema(e){ee(e,IA);const t=te(e,e,Ta.schema());G.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new D({value:[new le({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof de||(e.otherCert=this.otherCert.toJSON()),e}}const rl="certificates",VA=[rl];class js extends Q{constructor(e={}){super(),this.certificates=g(e,rl,js.defaultValues(rl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new at({name:t.blockName||C,value:[new ye({name:t.certificates||rl,value:new Me({value:[Ae.schema(),new j({idBlock:{tagClass:3,tagNumber:0},value:[new de]}),new j({idBlock:{tagClass:3,tagNumber:1},value:[new D]}),new j({idBlock:{tagClass:3,tagNumber:2},value:ts.schema().valueBlock.value}),new j({idBlock:{tagClass:3,tagNumber:3},value:Ta.schema().valueBlock.value})]})})]})}fromSchema(e){ee(e,VA);const t=te(e,e,js.schema());G.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],s=>{const a=s.idBlock.tagNumber;if(s.idBlock.tagClass===1)return new Ae({schema:s});const n=new D({value:s.valueBlock.value});switch(a){case 1:return n.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec===1?new ts({schema:n}):new or({schema:n});case 2:return new ts({schema:n});case 3:return new Ta({schema:n})}return s})}toSchema(){return new at({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof Ae:return e.toSchema();case e instanceof or:return new j({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof ts:return new j({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof Ta:return new j({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}js.CLASS_NAME="CertificateSet";const al="otherRevInfoFormat",nl="otherRevInfo",BA=[al,nl];class fr extends Q{constructor(e={}){super(),this.otherRevInfoFormat=g(e,al,fr.defaultValues(al)),this.otherRevInfo=g(e,nl,fr.defaultValues(nl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case al:return C;case nl:return new de;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.otherRevInfoFormat||al}),new de({name:t.otherRevInfo||nl})]})}fromSchema(e){ee(e,BA);const t=te(e,e,fr.schema());G.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new D({value:[new le({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof de||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}fr.CLASS_NAME="OtherRevocationInfoFormat";const il="crls",Qf="otherRevocationInfos",xA=[il];class pr extends Q{constructor(e={}){super(),this.crls=g(e,il,pr.defaultValues(il)),this.otherRevocationInfos=g(e,Qf,pr.defaultValues(Qf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case il:return[];case Qf:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new at({name:t.blockName||C,value:[new ye({name:t.crls||C,value:new Me({value:[tt.schema(),new j({idBlock:{tagClass:3,tagNumber:1},value:[new le,new de]})]})})]})}fromSchema(e){ee(e,xA);const t=te(e,e,pr.schema({names:{crls:il}}));if(G.assertSchema(t,this.className),t.result.crls)for(const s of t.result.crls)s.idBlock.tagClass===1?this.crls.push(new tt({schema:s})):this.otherRevocationInfos.push(new fr({schema:s}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const s=t.toSchema();return s.idBlock.tagClass=3,s.idBlock.tagNumber=1,s})),new at({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}pr.CLASS_NAME="RevocationInfoChoices";const ol="certs",An="crls",OA=[ol,An];class ri extends Q{constructor(e={}){super(),this.crls=g(e,An,ri.defaultValues(An)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ol:return new js;case An:return new pr;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ol:return t.certificates.length===0;case An:return t.crls.length===0&&t.otherRevocationInfos.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new j({name:t.certs||C,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:js.schema().valueBlock.value}),new j({name:t.crls||C,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:pr.schema().valueBlock.value})]})}fromSchema(e){ee(e,OA);const t=te(e,e,ri.schema({names:{certs:ol,crls:An}}));G.assertSchema(t,this.className),ol in t.result&&(this.certs=new js({schema:new at({value:t.result.certs.valueBlock.value})})),An in t.result&&(this.crls=new pr({schema:new at({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new j({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new D({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}ri.CLASS_NAME="OriginatorInfo";const ul="issuer",cl="serialNumber",PA=[ul,cl];class Ge extends Q{constructor(e={}){super(),this.issuer=g(e,ul,Ge.defaultValues(ul)),this.serialNumber=g(e,cl,Ge.defaultValues(cl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ul:return new Be;case cl:return new q;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[Be.schema(t.issuer||{}),new q({name:t.serialNumber||C})]})}fromSchema(e){ee(e,PA);const t=te(e,e,Ge.schema({names:{issuer:{names:{blockName:ul}},serialNumber:cl}}));G.assertSchema(t,this.className),this.issuer=new Be({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new D({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}Ge.CLASS_NAME="IssuerAndSerialNumber";const bh="variant",Iu="value",DA=["blockName"];class tu extends Q{constructor(e={}){super(),this.variant=g(e,bh,tu.defaultValues(bh)),Iu in e&&(this.value=g(e,Iu,tu.defaultValues(Iu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bh:return-1;case Iu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bh:return t===-1;case Iu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new Me({value:[Ge.schema({names:{blockName:t.blockName||C}}),new pe({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){ee(e,DA);const t=te(e,e,tu.schema({names:{blockName:"blockName"}}));G.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ge({schema:t.result.blockName})):(this.variant=2,this.value=new ae({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof Ge))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof ae))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new pe({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new de}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&this.value&&(e.value=this.value.toJSON()),e}}tu.CLASS_NAME="RecipientIdentifier";const Nn="version",Ji="rid",Fi="keyEncryptionAlgorithm",qi="encryptedKey",Sh="recipientCertificate",TA=[Nn,Ji,Fi,qi];class Gt extends Q{constructor(e={}){super(),this.version=g(e,Nn,Gt.defaultValues(Nn)),this.rid=g(e,Ji,Gt.defaultValues(Ji)),this.keyEncryptionAlgorithm=g(e,Fi,Gt.defaultValues(Fi)),this.encryptedKey=g(e,qi,Gt.defaultValues(qi)),this.recipientCertificate=g(e,Sh,Gt.defaultValues(Sh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nn:return-1;case Ji:return{};case Fi:return new H;case qi:return new ae;case Sh:return new Ae;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Nn:return t===Gt.defaultValues(Nn);case Ji:return Object.keys(t).length===0;case Fi:case qi:return t.isEqual(Gt.defaultValues(e));case Sh:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),tu.schema(t.rid||{}),H.schema(t.keyEncryptionAlgorithm||{}),new ae({name:t.encryptedKey||C})]})}fromSchema(e){ee(e,TA);const t=te(e,e,Gt.schema({names:{version:Nn,rid:{names:{blockName:Ji}},keyEncryptionAlgorithm:{names:{blockName:Fi}},encryptedKey:qi}}));G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,t.result.rid.idBlock.tagClass===3?this.rid=new ae({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new Ge({schema:t.result.rid}),this.keyEncryptionAlgorithm=new H({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof Ge?(this.version=0,e.push(new q({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new q({value:this.version})),e.push(new pe({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new D({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Gt.CLASS_NAME="KeyTransRecipientInfo";const Wi="algorithm",_i="publicKey",LA=[Wi,_i];class lr extends Q{constructor(e={}){super(),this.algorithm=g(e,Wi,lr.defaultValues(Wi)),this.publicKey=g(e,_i,lr.defaultValues(_i)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wi:return new H;case _i:return new be;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wi:case _i:return t.isEqual(lr.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[H.schema(t.algorithm||{}),new be({name:t.publicKey||C})]})}fromSchema(e){ee(e,LA);const t=te(e,e,lr.schema({names:{algorithm:{names:{blockName:Wi}},publicKey:_i}}));G.assertSchema(t,this.className),this.algorithm=new H({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new D({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}lr.CLASS_NAME="OriginatorPublicKey";const Ah="variant",Vu="value",RA=["blockName"];class dr extends Q{constructor(e={}){super(),this.variant=g(e,Ah,dr.defaultValues(Ah)),Vu in e&&(this.value=g(e,Vu,dr.defaultValues(Vu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ah:return-1;case Vu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ah:return t===-1;case Vu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new Me({value:[Ge.schema({names:{blockName:t.blockName||C}}),new pe({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||C}),new j({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||C,value:lr.schema().valueBlock.value})]})}fromSchema(e){ee(e,RA);const t=te(e,e,dr.schema({names:{blockName:"blockName"}}));G.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ge({schema:t.result.blockName})):t.result.blockName.idBlock.tagNumber===0?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new lr({schema:new D({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new de}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2||this.variant===3)&&(e.value=this.value.toJSON()),e}}dr.CLASS_NAME="OriginatorIdentifierOrKey";const Gi="keyAttrId",Ps="keyAttr",UA=[Gi,Ps];class Vs extends Q{constructor(e={}){super(),this.keyAttrId=g(e,Gi,Vs.defaultValues(Gi)),Ps in e&&(this.keyAttr=g(e,Ps,Vs.defaultValues(Ps))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gi:return C;case Ps:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Gi:return typeof t=="string"&&t===C;case Ps:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({optional:t.optional||!0,name:t.blockName||C,value:[new le({name:t.keyAttrId||C}),new de({optional:!0,name:t.keyAttr||C})]})}fromSchema(e){ee(e,UA);const t=te(e,e,Vs.schema({names:{keyAttrId:Gi,keyAttr:Ps}}));G.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),Ps in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new le({value:this.keyAttrId})),Ps in this&&e.push(this.keyAttr),new D({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return Ps in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}Vs.CLASS_NAME="OtherKeyAttribute";const En="subjectKeyIdentifier",Qr="date",Zr="other",$A=[En,Qr,Zr];class Ls extends Q{constructor(e={}){super(),this.subjectKeyIdentifier=g(e,En,Ls.defaultValues(En)),Qr in e&&(this.date=g(e,Qr,Ls.defaultValues(Qr))),Zr in e&&(this.other=g(e,Zr,Ls.defaultValues(Zr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case En:return new ae;case Qr:return new Je;case Zr:return new Vs;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case En:return t.isEqual(Ls.defaultValues(En));case Qr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Zr:return t.keyAttrId===C&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ae({name:t.subjectKeyIdentifier||C}),new Je({optional:!0,name:t.date||C}),Vs.schema(t.other||{})]})}fromSchema(e){ee(e,$A);const t=te(e,e,Ls.schema({names:{subjectKeyIdentifier:En,date:Qr,other:{names:{blockName:Zr}}}}));G.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,Qr in t.result&&(this.date=t.result.date),Zr in t.result&&(this.other=new Vs({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new D({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}Ls.CLASS_NAME="RecipientKeyIdentifier";const Nh="variant",Eh="value",jA=["blockName"];class Ks extends Q{constructor(e={}){super(),this.variant=g(e,Nh,Ks.defaultValues(Nh)),this.value=g(e,Eh,Ks.defaultValues(Eh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nh:return-1;case Eh:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Nh:return t===-1;case Eh:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new Me({value:[Ge.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||C}}),new j({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:0},value:Ls.schema(t.rKeyId||{names:{blockName:t.blockName||C}}).valueBlock.value})]})}fromSchema(e){ee(e,jA);const t=te(e,e,Ks.schema({names:{blockName:"blockName"}}));G.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ge({schema:t.result.blockName})):(this.variant=2,this.value=new Ls({schema:new D({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new j({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new de}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&(e.value=this.value.toJSON()),e}}Ks.CLASS_NAME="KeyAgreeRecipientIdentifier";const zi="rid",Cn="encryptedKey",KA=[zi,Cn];class hr extends Q{constructor(e={}){super(),this.rid=g(e,zi,hr.defaultValues(zi)),this.encryptedKey=g(e,Cn,hr.defaultValues(Cn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zi:return new Ks;case Cn:return new ae;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zi:return t.variant===-1&&!("value"in t);case Cn:return t.isEqual(hr.defaultValues(Cn));default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[Ks.schema(t.rid||{}),new ae({name:t.encryptedKey||C})]})}fromSchema(e){ee(e,KA);const t=te(e,e,hr.schema({names:{rid:{names:{blockName:zi}},encryptedKey:Cn}}));G.assertSchema(t,this.className),this.rid=new Ks({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new D({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}hr.CLASS_NAME="RecipientEncryptedKey";const Ch="encryptedKeys",Lw="RecipientEncryptedKeys",MA=[Lw];class La extends Q{constructor(e={}){super(),this.encryptedKeys=g(e,Ch,La.defaultValues(Ch)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ch:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ch:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.RecipientEncryptedKeys||C,value:hr.schema()})]})}fromSchema(e){ee(e,MA);const t=te(e,e,La.schema({names:{RecipientEncryptedKeys:Lw}}));G.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,s=>new hr({schema:s}))}toSchema(){return new D({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}La.CLASS_NAME="RecipientEncryptedKeys";const Xi="version",Yi="originator",Ys="ukm",Qi="keyEncryptionAlgorithm",Zi="recipientEncryptedKeys",kh="recipientCertificate",Ih="recipientPublicKey",HA=[Xi,Yi,Ys,Qi,Zi];class Ft extends Q{constructor(e={}){super(),this.version=g(e,Xi,Ft.defaultValues(Xi)),this.originator=g(e,Yi,Ft.defaultValues(Yi)),Ys in e&&(this.ukm=g(e,Ys,Ft.defaultValues(Ys))),this.keyEncryptionAlgorithm=g(e,Qi,Ft.defaultValues(Qi)),this.recipientEncryptedKeys=g(e,Zi,Ft.defaultValues(Zi)),this.recipientCertificate=g(e,kh,Ft.defaultValues(kh)),this.recipientPublicKey=g(e,Ih,Ft.defaultValues(Ih)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xi:return 0;case Yi:return new dr;case Ys:return new ae;case Qi:return new H;case Zi:return new La;case kh:return new Ae;case Ih:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Xi:return t===0;case Yi:return t.variant===-1&&!("value"in t);case Ys:return t.isEqual(Ft.defaultValues(Ys));case Qi:return t.algorithmId===C&&!("algorithmParams"in t);case Zi:return t.encryptedKeys.length===0;case kh:return!1;case Ih:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),new j({idBlock:{tagClass:3,tagNumber:0},value:[dr.schema(t.originator||{})]}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ae({name:t.ukm||C})]}),H.schema(t.keyEncryptionAlgorithm||{}),La.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){ee(e,HA);const t=te(e,e,Ft.schema({names:{version:Xi,originator:{names:{blockName:Yi}},ukm:Ys,keyEncryptionAlgorithm:{names:{blockName:Qi}},recipientEncryptedKeys:{names:{blockName:Zi}}}}));G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new dr({schema:t.result.originator}),Ys in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new H({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new La({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new q({value:this.version})),e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new D({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}Ft.CLASS_NAME="KeyAgreeRecipientInfo";const kn="keyIdentifier",ea="date",ta="other",JA=[kn,ea,ta];class Cs extends Q{constructor(e={}){super(),this.keyIdentifier=g(e,kn,Cs.defaultValues(kn)),ea in e&&(this.date=g(e,ea,Cs.defaultValues(ea))),ta in e&&(this.other=g(e,ta,Cs.defaultValues(ta))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kn:return new ae;case ea:return new Je;case ta:return new Vs;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case kn:return t.isEqual(Cs.defaultValues(kn));case ea:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case ta:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ae({name:t.keyIdentifier||C}),new Je({optional:!0,name:t.date||C}),Vs.schema(t.other||{})]})}fromSchema(e){ee(e,JA);const t=te(e,e,Cs.schema({names:{keyIdentifier:kn,date:ea,other:{names:{blockName:ta}}}}));G.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,ea in t.result&&(this.date=t.result.date),ta in t.result&&(this.other=new Vs({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new D({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}Cs.CLASS_NAME="KEKIdentifier";const eo="version",to="kekid",so="keyEncryptionAlgorithm",In="encryptedKey",Vh="preDefinedKEK",FA=[eo,to,so,In];class zt extends Q{constructor(e={}){super(),this.version=g(e,eo,zt.defaultValues(eo)),this.kekid=g(e,to,zt.defaultValues(to)),this.keyEncryptionAlgorithm=g(e,so,zt.defaultValues(so)),this.encryptedKey=g(e,In,zt.defaultValues(In)),this.preDefinedKEK=g(e,Vh,zt.defaultValues(Vh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eo:return 0;case to:return new Cs;case so:return new H;case In:return new ae;case Vh:return We;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===zt.defaultValues(eo);case to:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case so:return t.algorithmId===C&&!("algorithmParams"in t);case In:return t.isEqual(zt.defaultValues(In));case Vh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),Cs.schema(t.kekid||{}),H.schema(t.keyEncryptionAlgorithm||{}),new ae({name:t.encryptedKey||C})]})}fromSchema(e){ee(e,FA);const t=te(e,e,zt.schema({names:{version:eo,kekid:{names:{blockName:to}},keyEncryptionAlgorithm:{names:{blockName:so}},encryptedKey:In}}));G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new Cs({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new H({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new D({value:[new q({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}zt.CLASS_NAME="KEKRecipientInfo";const ro="version",sa="keyDerivationAlgorithm",ao="keyEncryptionAlgorithm",Vn="encryptedKey",Bh="password",qA=[ro,sa,ao,Vn];class ls extends Q{constructor(e={}){super(),this.version=g(e,ro,ls.defaultValues(ro)),sa in e&&(this.keyDerivationAlgorithm=g(e,sa,ls.defaultValues(sa))),this.keyEncryptionAlgorithm=g(e,ao,ls.defaultValues(ao)),this.encryptedKey=g(e,Vn,ls.defaultValues(Vn)),this.password=g(e,Bh,ls.defaultValues(Bh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ro:return-1;case sa:return new H;case ao:return new H;case Vn:return new ae;case Bh:return We;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ro:return t===-1;case sa:case ao:return t.algorithmId===C&&!("algorithmParams"in t);case Vn:return t.isEqual(ls.defaultValues(Vn));case Bh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),new j({name:t.keyDerivationAlgorithm||C,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:H.schema().valueBlock.value}),H.schema(t.keyEncryptionAlgorithm||{}),new ae({name:t.encryptedKey||C})]})}fromSchema(e){ee(e,qA);const t=te(e,e,ls.schema({names:{version:ro,keyDerivationAlgorithm:sa,keyEncryptionAlgorithm:{names:{blockName:ao}},encryptedKey:Vn}}));G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,sa in t.result&&(this.keyDerivationAlgorithm=new H({schema:new D({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new H({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new q({value:this.version})),this.keyDerivationAlgorithm&&e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new D({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}ls.CLASS_NAME="PasswordRecipientInfo";const no="oriType",Bn="oriValue",WA=[no,Bn];class Ba extends Q{constructor(e={}){super(),this.oriType=g(e,no,Ba.defaultValues(no)),this.oriValue=g(e,Bn,Ba.defaultValues(Bn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case no:return C;case Bn:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case no:return t===C;case Bn:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.oriType||C}),new de({name:t.oriValue||C})]})}fromSchema(e){ee(e,WA);const t=te(e,e,Ba.schema({names:{oriType:no,oriValue:Bn}}));G.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new D({value:[new le({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return Ba.compareWithDefault(Bn,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}Ba.CLASS_NAME="OtherRecipientInfo";const xh="variant",Bu="value",_A=["blockName"];class ms extends Q{constructor(e={}){super(),this.variant=g(e,xh,ms.defaultValues(xh)),Bu in e&&(this.value=g(e,Bu,ms.defaultValues(Bu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xh:return-1;case Bu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case xh:return t===ms.defaultValues(e);case Bu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new Me({value:[Gt.schema({names:{blockName:t.blockName||C}}),new j({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:1},value:Ft.schema().valueBlock.value}),new j({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:2},value:zt.schema().valueBlock.value}),new j({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:3},value:ls.schema().valueBlock.value}),new j({name:t.blockName||C,idBlock:{tagClass:3,tagNumber:4},value:Ba.schema().valueBlock.value})]})}fromSchema(e){ee(e,_A);const t=te(e,e,ms.schema({names:{blockName:"blockName"}}));if(G.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1)this.variant=1,this.value=new Gt({schema:t.result.blockName});else{const s=new D({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new Ft({schema:s});break;case 2:this.variant=3,this.value=new zt({schema:s});break;case 3:this.variant=4,this.value=new ls({schema:s});break;case 4:this.variant=5,this.value=new Ba({schema:s});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){Se.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new de}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}ms.CLASS_NAME="RecipientInfo";const ra="hashAlgorithm",aa="maskGenAlgorithm",na="pSourceAlgorithm",GA=[ra,aa,na];class Dt extends Q{constructor(e={}){super(),this.hashAlgorithm=g(e,ra,Dt.defaultValues(ra)),this.maskGenAlgorithm=g(e,aa,Dt.defaultValues(aa)),this.pSourceAlgorithm=g(e,na,Dt.defaultValues(na)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ra:return new H({algorithmId:"1.3.14.3.2.26",algorithmParams:new rt});case aa:return new H({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new H({algorithmId:"1.3.14.3.2.26",algorithmParams:new rt}).toSchema()});case na:return new H({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new ae({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new j({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[H.schema(t.hashAlgorithm||{})]}),new j({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[H.schema(t.maskGenAlgorithm||{})]}),new j({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[H.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){ee(e,GA);const t=te(e,e,Dt.schema({names:{hashAlgorithm:{names:{blockName:ra}},maskGenAlgorithm:{names:{blockName:aa}},pSourceAlgorithm:{names:{blockName:na}}}}));G.assertSchema(t,this.className),ra in t.result&&(this.hashAlgorithm=new H({schema:t.result.hashAlgorithm})),aa in t.result&&(this.maskGenAlgorithm=new H({schema:t.result.maskGenAlgorithm})),na in t.result&&(this.pSourceAlgorithm=new H({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Dt.defaultValues(ra))||e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Dt.defaultValues(aa))||e.push(new j({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(Dt.defaultValues(na))||e.push(new j({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new D({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Dt.defaultValues(ra))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Dt.defaultValues(aa))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(Dt.defaultValues(na))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}Dt.CLASS_NAME="RSAESOAEPParams";const io="keyInfo",ia="entityUInfo",oo="suppPubInfo",zA=[io,ia,oo];class ar extends Q{constructor(e={}){super(),this.keyInfo=g(e,io,ar.defaultValues(io)),ia in e&&(this.entityUInfo=g(e,ia,ar.defaultValues(ia))),this.suppPubInfo=g(e,oo,ar.defaultValues(oo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case io:return new H;case ia:return new ae;case oo:return new ae;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case io:case ia:case oo:return t.isEqual(ar.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[H.schema(t.keyInfo||{}),new j({name:t.entityUInfo||C,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new ae]}),new j({name:t.suppPubInfo||C,idBlock:{tagClass:3,tagNumber:2},value:[new ae]})]})}fromSchema(e){ee(e,zA);const t=te(e,e,ar.schema({names:{keyInfo:{names:{blockName:io}},entityUInfo:ia,suppPubInfo:oo}}));G.assertSchema(t,this.className),this.keyInfo=new H({schema:t.result.keyInfo}),ia in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new j({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new D({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}ar.CLASS_NAME="ECCCMSSharedInfo";const uo="version",oa="originatorInfo",co="recipientInfos",lo="encryptedContentInfo",ua="unprotectedAttrs",XA=[uo,oa,co,lo,ua],ny={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},YA={"P-256":256,"P-384":384,"P-521":528};class Ns extends Q{constructor(e={}){super(),this.version=g(e,uo,Ns.defaultValues(uo)),oa in e&&(this.originatorInfo=g(e,oa,Ns.defaultValues(oa))),this.recipientInfos=g(e,co,Ns.defaultValues(co)),this.encryptedContentInfo=g(e,lo,Ns.defaultValues(lo)),ua in e&&(this.unprotectedAttrs=g(e,ua,Ns.defaultValues(ua))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uo:return 0;case oa:return new ri;case co:return[];case lo:return new Xe;case ua:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uo:return t===Ns.defaultValues(e);case oa:return t.certs.certificates.length===0&&t.crls.crls.length===0;case co:case ua:return t.length===0;case lo:return Xe.compareWithDefault("contentType",t.contentType)&&Xe.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Xe.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||C}),new j({name:t.originatorInfo||C,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:ri.schema().valueBlock.value}),new at({value:[new ye({name:t.recipientInfos||C,value:ms.schema()})]}),Xe.schema(t.encryptedContentInfo||{}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ye({name:t.unprotectedAttrs||C,value:Oe.schema()})]})]})}fromSchema(e){ee(e,XA);const t=te(e,e,Ns.schema({names:{version:uo,originatorInfo:oa,recipientInfos:co,encryptedContentInfo:{names:{blockName:lo}},unprotectedAttrs:ua}}));G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,oa in t.result&&(this.originatorInfo=new ri({schema:new D({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,s=>new ms({schema:s})),this.encryptedContentInfo=new Xe({schema:t.result.encryptedContentInfo}),ua in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new Oe({schema:s})))}toSchema(){const e=[];return e.push(new q({value:this.version})),this.originatorInfo&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new at({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new D({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,s,a=we(!0)){const n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},ny,t||{});if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549")!==-1)s=1;else if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045")!==-1)s=2;else throw new Error(`Unknown type of certificate's public key: ${e.subjectPublicKeyInfo.algorithm.algorithmId}`);switch(s){case 1:{let i,o;if(n.useOAEP===!0){i=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const u=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),c=new H({algorithmId:u,algorithmParams:new rt});o=new Dt({hashAlgorithm:c,maskGenAlgorithm:new H({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:c.toSchema()})}).toSchema()}else{if(i=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),i===C)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");o=new rt}const l=new Gt({version:0,rid:new Ge({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new H({algorithmId:i,algorithmParams:o}),recipientCertificate:e});this.recipientInfos.push(new ms({variant:1,value:l}))}break;case 2:{const i=new Ks({variant:1,value:new Ge({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(i,n,{recipientCertificate:e},a)}break;default:throw new Error(`Unknown "variant" value: ${s}`)}return!0}addRecipientByPreDefinedData(e,t={},s,a=we(!0)){if(Ve.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const n=new ArrayBuffer(16),i=new Uint8Array(n);a.getRandomValues(i),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),t.iterationCount===void 0&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new rt),s){case 1:{const n=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),i=new zt({version:4,kekid:new Cs({keyIdentifier:new ae({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new H({algorithmId:n,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new ms({variant:3,value:i}))}break;case 2:{const n=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),i=new ArrayBuffer(64),o=new Uint8Array(i);a.getRandomValues(o);const l=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),u=new Vt({salt:new ae({valueHex:i}),iterationCount:t.iterationCount,prf:new H({algorithmId:l,algorithmParams:new rt})}),c=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),f=new ls({version:0,keyDerivationAlgorithm:new H({algorithmId:n,algorithmParams:u.toSchema()}),keyEncryptionAlgorithm:new H({algorithmId:c,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new ms({variant:4,value:f}))}break;default:throw new Error(`Unknown value for "variant": ${s}`)}}addRecipientByKeyIdentifier(e,t,s,a=we(!0)){const n=Object.assign({},ny,s||{}),i=new Ks({variant:2,value:new Ls({subjectKeyIdentifier:new ae({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,n,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,s,a=we(!0)){const n=new hr({rid:e}),i=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),o=new H({algorithmId:i}),l=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),u=new ArrayBuffer(64),c=new Uint8Array(u);a.getRandomValues(c);const f={version:3,ukm:new ae({valueHex:u}),keyEncryptionAlgorithm:new H({algorithmId:l,algorithmParams:o.toSchema()}),recipientEncryptedKeys:new La({encryptedKeys:[n]})},h=new Ft(Object.assign(f,s));this.recipientInfos.push(new ms({variant:2,value:h}))}async encrypt(e,t,s=we(!0)){const a=new ArrayBuffer(16),n=new Uint8Array(a);s.getRandomValues(n);const i=new Uint8Array(t),o=s.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),l=await s.generateKey(e,!0,["encrypt"]),u=await s.encrypt({name:e.name,iv:n},l,i),c=await s.exportKey("raw",l);this.version=2,this.encryptedContentInfo=new Xe({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new H({algorithmId:o,algorithmParams:new ae({valueHex:a})}),encryptedContent:new ae({valueHex:u})});const f=async b=>{const I=this.recipientInfos[b].value;let p,w;if(I.recipientPublicKey)p=I.recipientPublicKey.algorithm.namedCurve,w=I.recipientPublicKey;else if(I.recipientCertificate){const se=I.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(se.constructor.blockName()!==le.blockName())throw new Error(`Incorrect "recipientCertificate" for index ${b}`);switch(se.valueBlock.toString()){case"1.2.840.10045.3.1.7":p="P-256";break;case"1.3.132.0.34":p="P-384";break;case"1.3.132.0.35":p="P-521";break;default:throw new Error(`Incorrect curve OID for index ${b}`)}w=await I.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:p},usages:[]}},s)}else throw new Error("Unsupported RecipientInfo");const E=YA[p],O=await s.generateKey({name:"ECDH",namedCurve:p},!0,["deriveBits"]),x=await s.exportKey("spki",O.publicKey),T=await s.deriveBits({name:"ECDH",public:w},O.privateKey,E),B=new H({schema:I.keyEncryptionAlgorithm.algorithmParams}),k=s.getAlgorithmByOID(B.algorithmId,!0,"aesKWAlgorithm");let J=k.length;const F=new ArrayBuffer(4),P=new Uint8Array(F);for(let se=3;se>=0;se--)P[se]=J,J>>=8;const U=new ar({keyInfo:new H({algorithmId:B.algorithmId}),entityUInfo:I.ukm,suppPubInfo:new ae({valueHex:F})}).toSchema().toBER(!1),re=s.getAlgorithmByOID(I.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),X=await Wg(re.kdf,T,k.length,U,s),K=await s.importKey("raw",X,{name:"AES-KW"},!0,["wrapKey"]),W=await s.wrapKey("raw",l,K,{name:"AES-KW"}),ne=new dr;return ne.variant=3,ne.value=lr.fromBER(x),I.originator=ne,I.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new ae({valueHex:W}),{ecdhPrivateKey:O.privateKey}},h=async b=>{const I=this.recipientInfos[b].value,p=s.getAlgorithmByOID(I.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(p.name==="RSA-OAEP"){const w=I.keyEncryptionAlgorithm.algorithmParams,E=new Dt({schema:w});if(p.hash=s.getAlgorithmByOID(E.hashAlgorithm.algorithmId),!("name"in p.hash))throw new Error(`Incorrect OID for hash algorithm: ${E.hashAlgorithm.algorithmId}`)}try{const w=await I.recipientCertificate.getPublicKey({algorithm:{algorithm:p,usages:["encrypt","wrapKey"]}},s),E=await s.encrypt(w.algorithm,w,c);I.encryptedKey=new ae({valueHex:E})}catch{}},v=async b=>{const I=this.recipientInfos[b].value,p=s.getAlgorithmByOID(I.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),w=await s.importKey("raw",new Uint8Array(I.preDefinedKEK),p,!0,["wrapKey"]),E=await s.wrapKey("raw",l,w,p);I.encryptedKey=new ae({valueHex:E})},d=async b=>{const I=this.recipientInfos[b].value;let p;if(!I.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!I.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{p=new Vt({schema:I.keyDerivationAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const w=new Uint8Array(I.password),E=await s.importKey("raw",w,"PBKDF2",!1,["deriveKey"]),O=s.getAlgorithmByOID(I.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let x="SHA-1";p.prf&&(x=s.getAlgorithmByOID(p.prf.algorithmId,!0,"prfAlgorithm").hash.name);const T=new Uint8Array(p.salt.valueBlock.valueHex),B=p.iterationCount,k=await s.deriveKey({name:"PBKDF2",hash:{name:x},salt:T,iterations:B},E,O,!0,["wrapKey"]),J=await s.wrapKey("raw",l,k,O);I.encryptedKey=new ae({valueHex:J})},A=[];for(let b=0;b<this.recipientInfos.length;b++)switch(this.recipientInfos[b].variant){case 1:A.push(await h(b));break;case 2:A.push(await f(b));break;case 3:A.push(await v(b));break;case 4:A.push(await d(b));break;default:throw new Error(`Unknown recipient type in array with index ${b}`)}return A}async decrypt(e,t,s=we(!0)){const a=t||{};if(e+1>this.recipientInfos.length)throw new Error(`Maximum value for "index" is: ${this.recipientInfos.length-1}`);const n=async A=>{const b=this.recipientInfos[A].value;let I,p,w;const E=b.originator;if(a.recipientCertificate){const X=a.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(X.constructor.blockName()!==le.blockName())throw new Error(`Incorrect "recipientCertificate" for index ${A}`);I=X.valueBlock.toString()}else if(E.value.algorithm.algorithmParams){const X=E.value.algorithm.algorithmParams;if(X.constructor.blockName()!==le.blockName())throw new Error(`Incorrect originator for index ${A}`);I=X.valueBlock.toString()}else throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(I){case"1.2.840.10045.3.1.7":p="P-256",w=256;break;case"1.3.132.0.34":p="P-384",w=384;break;case"1.3.132.0.35":p="P-521",w=528;break;default:throw new Error(`Incorrect curve OID for index ${A}`)}let O,x=s;Te.isBufferSource(a.recipientPrivateKey)?O=await s.importKey("pkcs8",a.recipientPrivateKey,{name:"ECDH",namedCurve:p},!0,["deriveBits"]):(O=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(x=a.crypto.subtle)),"algorithmParams"in E.value.algorithm||(E.value.algorithm.algorithmParams=new le({value:I}));const T=E.value.toSchema().toBER(!1),B=await s.importKey("spki",T,{name:"ECDH",namedCurve:p},!0,[]),k=await x.deriveBits({name:"ECDH",public:B},O,w);async function J(X){X=X||!1;const K=new H({schema:b.keyEncryptionAlgorithm.algorithmParams}),W=s.getAlgorithmByOID(K.algorithmId,!0,"kwAlgorithm");let ne=W.length;const se=new ArrayBuffer(4),Z=new Uint8Array(se);for(let ce=3;ce>=0;ce--)Z[ce]=ne,ne>>=8;const _={algorithmId:K.algorithmId};X&&(_.algorithmParams=new rt);const z=new ar({keyInfo:new H(_),entityUInfo:b.ukm,suppPubInfo:new ae({valueHex:se})}).toSchema().toBER(!1),oe=s.getAlgorithmByOID(b.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!oe.name)throw new Error(`Incorrect OID for key encryption algorithm: ${b.keyEncryptionAlgorithm.algorithmId}`);return Wg(oe.kdf,k,W.length,z,s)}const F=await J(),P=async X=>s.importKey("raw",X,{name:"AES-KW"},!0,["unwrapKey"]),U=await P(F),re=async X=>{const K=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,W=s.getAlgorithmByOID(K,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",b.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,X,{name:"AES-KW"},W,!0,["decrypt"])};try{return await re(U)}catch{const X=await J(!0),K=await P(X);return re(K)}},i=async A=>{const b=this.recipientInfos[A].value;if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const I=s.getAlgorithmByOID(b.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(I.name==="RSA-OAEP"){const T=b.keyEncryptionAlgorithm.algorithmParams,B=new Dt({schema:T});if(I.hash=s.getAlgorithmByOID(B.hashAlgorithm.algorithmId),!("name"in I.hash))throw new Error(`Incorrect OID for hash algorithm: ${B.hashAlgorithm.algorithmId}`)}let p,w=s;Te.isBufferSource(a.recipientPrivateKey)?p=await s.importKey("pkcs8",a.recipientPrivateKey,I,!0,["decrypt"]):(p=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(w=a.crypto.subtle));const E=await w.decrypt(p.algorithm,p,b.encryptedKey.valueBlock.valueHexView),O=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,x=s.getAlgorithmByOID(O,!0,"contentEncryptionAlgorithm");if(!("name"in x))throw new Error(`Incorrect "contentEncryptionAlgorithm": ${O}`);return s.importKey("raw",E,x,!0,["decrypt"])},o=async A=>{const b=this.recipientInfos[A].value;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const I=s.getAlgorithmByOID(b.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),p=await s.importKey("raw",a.preDefinedData,I,!0,["unwrapKey"]),w=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,E=s.getAlgorithmByOID(w,!0,"contentEncryptionAlgorithm");if(!E.name)throw new Error(`Incorrect "contentEncryptionAlgorithm": ${w}`);return s.unwrapKey("raw",b.encryptedKey.valueBlock.valueHexView,p,I,E,!0,["decrypt"])},l=async A=>{const b=this.recipientInfos[A].value;let I;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!b.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!b.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{I=new Vt({schema:b.keyDerivationAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const p=await s.importKey("raw",a.preDefinedData,"PBKDF2",!1,["deriveKey"]),w=s.getAlgorithmByOID(b.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),E=I.prf?s.getAlgorithmByOID(I.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",O=new Uint8Array(I.salt.valueBlock.valueHex),x=I.iterationCount,T=await s.deriveKey({name:"PBKDF2",hash:{name:E},salt:O,iterations:x},p,w,!0,["unwrapKey"]),B=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,k=s.getAlgorithmByOID(B,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",b.encryptedKey.valueBlock.valueHexView,T,w,k,!0,["decrypt"])};let u;switch(this.recipientInfos[e].variant){case 1:u=await i(e);break;case 2:u=await n(e);break;case 3:u=await o(e);break;case 4:u=await l(e);break;default:throw new Error(`Unknown recipient type in array with index ${e}`)}const c=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,f=s.getAlgorithmByOID(c,!0,"contentEncryptionAlgorithm"),h=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,v=new Uint8Array(h);if(!this.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const d=this.encryptedContentInfo.getEncryptedContent();return s.decrypt({name:f.name,iv:v},u,d)}}Ns.CLASS_NAME="EnvelopedData";const yi="safeContents",xu="parsedValue",iy="contentInfos";class ai extends Q{constructor(e={}){super(),this.safeContents=g(e,yi,ai.defaultValues(yi)),xu in e&&(this.parsedValue=g(e,xu,ai.defaultValues(xu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yi:return[];case xu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case yi:return t.length===0;case xu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new ye({name:t.contentInfos||C,value:Ie.schema()})]})}fromSchema(e){ee(e,[iy]);const t=te(e,e,ai.schema({names:{contentInfos:iy}}));G.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,s=>new Ie({schema:s}))}toSchema(){return new D({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=we(!0)){if(Se.assert(e,yi),Ve.assert(e.safeContents,yi,"Array"),e.safeContents.length!==this.safeContents.length)throw new Ve('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');this.parsedValue={safeContents:[]};for(const[s,a]of this.safeContents.entries()){const n=e.safeContents[s],i=`parameters.safeContents[${s}]`;switch(a.contentType){case vd:{Ve.assert(a.content,"this.safeContents[j].content",ae);const o=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:cr.fromBER(o)})}break;case Iw:{const o=new Ns({schema:a.content});Se.assert(i,n,"recipientCertificate","recipientKey");const l=n,u=l.recipientCertificate,c=l.recipientKey,f=await o.decrypt(0,{recipientCertificate:u,recipientPrivateKey:c},t);this.parsedValue.safeContents.push({privacyMode:2,value:cr.fromBER(f)})}break;case Vw:{const o=new $s({schema:a.content});Se.assert(i,n,"password");const l=n.password,u=await o.decrypt({password:l},t);this.parsedValue.safeContents.push({privacyMode:1,value:cr.fromBER(u)})}break;default:throw new Error(`Unknown "contentType" for AuthenticatedSafe: " ${a.contentType}`)}}}async makeInternalValues(e,t=we(!0)){if(!this.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(Ve.assert(this.parsedValue,"this.parsedValue","object"),Ve.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),Ve.assert(e,"parameters","object"),Se.assert(e,"safeContents"),Ve.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new Ve('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');this.safeContents=[];for(const[s,a]of this.parsedValue.safeContents.entries())switch(Se.assert("content",a,"privacyMode","value"),Ve.assert(a.value,"content.value",cr),a.privacyMode){case 0:{const n=a.value.toSchema().toBER(!1);this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.1",content:new ae({valueHex:n})}))}break;case 1:{const n=new $s,i=e.safeContents[s];i.contentToEncrypt=a.value.toSchema().toBER(!1),await n.encrypt(i,t),this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.6",content:n.toSchema()}))}break;case 2:{const n=new Ns,i=a.value.toSchema().toBER(!1),o=e.safeContents[s];switch(Se.assert(`parameters.safeContents[${s}]`,o,"encryptingCertificate","encryptionAlgorithm"),!0){case o.encryptionAlgorithm.name.toLowerCase()==="aes-cbc":case o.encryptionAlgorithm.name.toLowerCase()==="aes-gcm":break;default:throw new Error(`Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": ${o.encryptionAlgorithm}`)}switch(!0){case o.encryptionAlgorithm.length===128:case o.encryptionAlgorithm.length===192:case o.encryptionAlgorithm.length===256:break;default:throw new Error(`Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": ${o.encryptionAlgorithm.length}`)}const l=o.encryptionAlgorithm;n.addRecipientByCertificate(o.encryptingCertificate,{},void 0,t),await n.encrypt(l,i,t),this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.3",content:n.toSchema()}))}break;default:throw new Error(`Incorrect value for "content.privacyMode": ${a.privacyMode}`)}return this}}ai.CLASS_NAME="AuthenticatedSafe";const xn="hashAlgorithm",ho="issuerNameHash",mo="issuerKeyHash",On="serialNumber",QA=[xn,ho,mo,On];class Ye extends Q{static async create(e,t,s=we(!0)){const a=new Ye;return await a.createForCertificate(e,t,s),a}constructor(e={}){super(),this.hashAlgorithm=g(e,xn,Ye.defaultValues(xn)),this.issuerNameHash=g(e,ho,Ye.defaultValues(ho)),this.issuerKeyHash=g(e,mo,Ye.defaultValues(mo)),this.serialNumber=g(e,On,Ye.defaultValues(On)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xn:return new H;case ho:case mo:return new ae;case On:return new q;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case xn:return t.algorithmId===C&&!("algorithmParams"in t);case ho:case mo:case On:return t.isEqual(Ye.defaultValues(On));default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[H.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||C}}),new ae({name:t.issuerNameHash||C}),new ae({name:t.issuerKeyHash||C}),new q({name:t.serialNumber||C})]})}fromSchema(e){ee(e,QA);const t=te(e,e,Ye.schema({names:{hashAlgorithm:xn,issuerNameHash:ho,issuerKeyHash:mo,serialNumber:On}}));G.assertSchema(t,this.className),this.hashAlgorithm=new H({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new D({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!Te.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!Te.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,s=we(!0)){Se.assert(t,xn,"issuerCertificate");const a=s.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new H({algorithmId:a,algorithmParams:new rt});const n=t.issuerCertificate;this.serialNumber=e.serialNumber;const i=await s.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1));this.issuerNameHash=new ae({valueHex:i});const o=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,l=await s.digest({name:t.hashAlgorithm},o);this.issuerKeyHash=new ae({valueHex:l})}}Ye.CLASS_NAME="CertID";const fo="certID",po="certStatus",go="thisUpdate",ca="nextUpdate",Pn="singleExtensions",ZA=[fo,po,go,ca,Pn];class Es extends Q{constructor(e={}){super(),this.certID=g(e,fo,Es.defaultValues(fo)),this.certStatus=g(e,po,Es.defaultValues(po)),this.thisUpdate=g(e,go,Es.defaultValues(go)),ca in e&&(this.nextUpdate=g(e,ca,Es.defaultValues(ca))),Pn in e&&(this.singleExtensions=g(e,Pn,Es.defaultValues(Pn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fo:return new Ye;case po:return{};case go:case ca:return new Date(0,0,0);case Pn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fo:return Ye.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Ye.compareWithDefault("issuerNameHash",t.issuerNameHash)&&Ye.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&Ye.compareWithDefault("serialNumber",t.serialNumber);case po:return Object.keys(t).length===0;case go:case ca:return t===Es.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[Ye.schema(t.certID||{}),new Me({value:[new pe({name:t.certStatus||C,idBlock:{tagClass:3,tagNumber:0}}),new j({name:t.certStatus||C,idBlock:{tagClass:3,tagNumber:1},value:[new Je,new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $l]})]}),new pe({name:t.certStatus||C,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new Je({name:t.thisUpdate||C}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Je({name:t.nextUpdate||C})]}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[_e.schema(t.singleExtensions||{})]})]})}fromSchema(e){ee(e,ZA);const t=te(e,e,Es.schema({names:{certID:{names:{blockName:fo}},certStatus:po,thisUpdate:go,nextUpdate:ca,singleExtensions:{names:{blockName:Pn}}}}));G.assertSchema(t,this.className),this.certID=new Ye({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),ca in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),Pn in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,s=>new st({schema:s})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new Je({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[new Je({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new j({idBlock:{tagClass:3,tagNumber:1},value:[new D({value:Array.from(this.singleExtensions,t=>t.toSchema())})]})),new D({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}Es.CLASS_NAME="SingleResponse";const Oh="tbs",Dn="version",ll="responderID",hl="producedAt",ml="responses",yo="responseExtensions",ci="ResponseData",Wh=`${ci}.${Dn}`,wo=`${ci}.${ll}`,xp=`${ci}.${hl}`,Op=`${ci}.${ml}`,_h=`${ci}.${yo}`,eN=[ci,Wh,wo,xp,Op,_h];class ht extends Q{get tbs(){return Te.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(g(e,Oh,ht.defaultValues(Oh))),Dn in e&&(this.version=g(e,Dn,ht.defaultValues(Dn))),this.responderID=g(e,ll,ht.defaultValues(ll)),this.producedAt=g(e,hl,ht.defaultValues(hl)),this.responses=g(e,ml,ht.defaultValues(ml)),yo in e&&(this.responseExtensions=g(e,yo,ht.defaultValues(yo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Dn:return 0;case Oh:return We;case ll:return{};case hl:return new Date(0,0,0);case ml:case yo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Oh:return t.byteLength===0;case ll:return Object.keys(t).length===0;case hl:return t===ht.defaultValues(e);case ml:case yo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||ci,value:[new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new q({name:t.version||Wh})]}),new Me({value:[new j({name:t.responderID||wo,idBlock:{tagClass:3,tagNumber:1},value:[Be.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new j({name:t.responderID||wo,idBlock:{tagClass:3,tagNumber:2},value:[new ae({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new Je({name:t.producedAt||xp}),new D({value:[new ye({name:Op,value:Es.schema(t.response||{})})]}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[_e.schema(t.extensions||{names:{blockName:_h}})]})]})}fromSchema(e){ee(e,eN);const t=te(e,e,ht.schema());G.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,Wh in t.result&&(this.version=t.result[Wh].valueBlock.valueDec),t.result[wo].idBlock.tagNumber===1?this.responderID=new Be({schema:t.result[wo].valueBlock.value[0]}):this.responderID=t.result[wo].valueBlock.value[0],this.producedAt=t.result[xp].toDate(),this.responses=Array.from(t.result[Op],s=>new Es({schema:s})),_h in t.result&&(this.responseExtensions=Array.from(t.result[_h].valueBlock.value,s=>new st({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return ht.schema();const s=ot(this.tbsView);G.assert(s,"TBS Response Data"),t=s.result}else{const s=[];Dn in this&&s.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[new q({value:this.version})]})),this.responderID instanceof Be?s.push(new j({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):s.push(new j({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),s.push(new Je({valueDate:this.producedAt})),s.push(new D({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&s.push(new j({idBlock:{tagClass:3,tagNumber:1},value:[new D({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new D({value:s})}return t}toJSON(){const e={};return Dn in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}ht.CLASS_NAME="ResponseData";const Zf="trustedCerts",ep="certs",tp="crls",sp="ocsps",rp="checkDate",ap="findOrigin",np="findIssuer";var Jn;(function(r){r[r.unknown=-1]="unknown",r[r.success=0]="success",r[r.noRevocation=11]="noRevocation",r[r.noPath=60]="noPath",r[r.noValidPath=97]="noValidPath"})(Jn||(Jn={}));class Sa extends Error{constructor(e,t){super(t),this.name=Sa.NAME,this.code=e,this.message=t}}Sa.NAME="ChainValidationError";function tN(r,e){for(let t=0;t<e.length;t++)if(Te.isEqual(r.tbsView,e[t].tbsView))return!0;return!1}class tf{constructor(e={}){this.trustedCerts=g(e,Zf,this.defaultValues(Zf)),this.certs=g(e,ep,this.defaultValues(ep)),this.crls=g(e,tp,this.defaultValues(tp)),this.ocsps=g(e,sp,this.defaultValues(sp)),this.checkDate=g(e,rp,this.defaultValues(rp)),this.findOrigin=g(e,ap,this.defaultValues(ap)),this.findIssuer=g(e,np,this.defaultValues(np))}static defaultFindOrigin(e,t){e.tbsView.byteLength===0&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));for(const s of t.certs)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),Te.isEqual(e.tbsView,s.tbsView))return"Intermediate Certificates";for(const s of t.trustedCerts)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),Te.isEqual(e.tbsView,s.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,s=we(!0)){const a=[];let n=null,i=null,o=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,s))return[e]}catch{}if(e.extensions){for(const u of e.extensions)if(u.extnID===yd&&u.parsedValue instanceof Ca){u.parsedValue.keyIdentifier?n=u.parsedValue.keyIdentifier:(u.parsedValue.authorityCertIssuer&&(i=u.parsedValue.authorityCertIssuer),u.parsedValue.authorityCertSerialNumber&&(o=u.parsedValue.authorityCertSerialNumber));break}}function l(u){if(n!==null&&u.extensions){let f=!1;for(const h of u.extensions)if(h.extnID===nS&&h.parsedValue){f=!0,Te.isEqual(h.parsedValue.valueBlock.valueHex,n.valueBlock.valueHexView)&&a.push(u);break}if(f)return}let c=!1;o!==null&&(c=u.serialNumber.isEqual(o)),i!==null?u.subject.isEqual(i)&&c&&a.push(u):e.issuer.isEqual(u.subject)&&a.push(u)}for(const u of t.trustedCerts)l(u);for(const u of t.certs)l(u);for(let u=a.length-1;u>=0;u--)try{await e.verify(a[u],s)===!1&&a.splice(u,1)}catch{a.splice(u,1)}return a}defaultValues(e){switch(e){case Zf:return[];case ep:return[];case tp:return[];case sp:return[];case rp:return new Date;case ap:return tf.defaultFindOrigin;case np:return this.defaultFindIssuer;default:throw new Error(`Invalid member name for CertificateChainValidationEngine class: ${e}`)}}async sort(e=!1,t=we(!0)){const s=[],a=async(d,A)=>{const b=[];function I(w){let E=!0;for(let O=0;O<w.length;O++){for(let x=0;x<w.length;x++)if(x!==O&&w[O]===w[x]){E=!1;break}if(!E)break}return E}if(tN(d,this.trustedCerts))return[[d]];const p=await this.findIssuer(d,this,A);if(p.length===0)throw new Error("No valid certificate paths found");for(let w=0;w<p.length;w++){if(Te.isEqual(p[w].tbsView,d.tbsView)){b.push([p[w]]);continue}const E=await a(p[w],A);for(let O=0;O<E.length;O++){const x=E[O].slice();x.splice(0,0,p[w]),I(x)?b.push(x):b.push(E[O])}}return b},n=async d=>{const A=[],b=[],I=[];if(A.push(...s.filter(p=>d.issuer.isEqual(p.subject))),A.length===0)return{status:1,statusMessage:"No certificate's issuers"};if(b.push(...this.crls.filter(p=>p.issuer.isEqual(d.issuer))),b.length===0)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let p=0;p<b.length;p++){const w=b[p];if(!(w.nextUpdate&&w.nextUpdate.value<this.checkDate))for(let E=0;E<A.length;E++)try{if(await b[p].verify({issuerCertificate:A[E]},t)){I.push({crl:b[p],certificate:A[E]});break}}catch{}}return I.length?{status:0,statusMessage:C,result:I}:{status:3,statusMessage:"No valid CRLs found"}},i=async(d,A)=>{const b=t.getAlgorithmByOID(d.signatureAlgorithm.algorithmId);if(!b.name||!b.hash)return 1;for(let I=0;I<this.ocsps.length;I++){const p=await this.ocsps[I].getCertificateStatus(d,A,t);if(p.isForCertificate)return p.status===0?0:1}return 2};async function o(d,A=!1){let b=!1,I=!1,p=!1,w=!1;if(d.extensions){for(let E=0;E<d.extensions.length;E++){const O=d.extensions[E];if(O.critical&&!O.parsedValue)return{result:!1,resultCode:6,resultMessage:`Unable to parse critical certificate extension: ${O.extnID}`};if(O.extnID===iS){p=!0;const x=new Uint8Array(O.parsedValue.valueBlock.valueHex);(x[0]&4)===4&&(I=!0),(x[0]&2)===2&&(w=!0)}O.extnID===dd&&"cA"in O.parsedValue&&O.parsedValue.cA===!0&&(b=!0)}if(I===!0&&b===!1)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(p===!0&&b===!0&&I===!1)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(b===!0&&p===!0&&A&&w===!1)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return b===!1?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:C}}const l=async(d,A)=>{for(let b=0;b<d.length;b++)if(d[b].notBefore.value>A||d[b].notAfter.value<A)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(d.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let b=d.length-2;b>=0;b--)if(d[b].issuer.isEqual(d[b].subject)===!1&&d[b].issuer.isEqual(d[b+1].subject)===!1)return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(this.crls.length!==0||this.ocsps.length!==0)for(let b=0;b<d.length-1;b++){let I=2,p={status:0,statusMessage:C};if(this.ocsps.length!==0)switch(I=await i(d[b],d[b+1]),I){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(this.crls.length!==0){if(p=await n(d[b]),p.status===0&&p.result)for(let w=0;w<p.result.length;w++){if(p.result[w].crl.isCertificateRevoked(d[b]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if((await o(p.result[w].certificate,!0)).result===!1)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(e===!1)throw new Sa(Jn.noRevocation,`No revocation values found for one of certificates: ${p.statusMessage}`)}else if(I===2)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(I===2&&p.status===2&&e){const w=d[b+1];let E=!1;if(w.extensions)for(const O of w.extensions)switch(O.extnID){case Aw:case gd:case wd:E=!0;break}if(E)throw new Sa(Jn.noRevocation,`No revocation values found for one of certificates: ${p.statusMessage}`)}}for(const[b,I]of d.entries())if(b&&!(await o(I)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}};s.push(...this.trustedCerts),s.push(...this.certs);for(let d=0;d<s.length;d++)for(let A=0;A<s.length;A++)if(d!==A&&Te.isEqual(s[d].tbsView,s[A].tbsView)){s.splice(A,1),d=0;break}const u=s[s.length-1];let c;const f=[u];if(c=await a(u,t),c.length===0)throw new Sa(Jn.noPath,"Unable to find certificate path");for(let d=c.length-1;d>=0;d--){let A=!1;for(let b=0;b<c[d].length;b++){const I=c[d][b];for(let p=0;p<this.trustedCerts.length;p++)if(Te.isEqual(I.tbsView,this.trustedCerts[p].tbsView)){A=!0;break}if(A)break}A||c.splice(d,1)}if(c.length===0)throw new Sa(Jn.noValidPath,"No valid certificate paths found");let h=c[0].length,v=0;for(let d=0;d<c.length;d++)c[d].length<h&&(h=c[d].length,v=d);for(let d=0;d<c[v].length;d++)f.push(c[v][d]);if(c=await l(f,this.checkDate),c.result===!1)throw c;return f}async verify(e={},t=we(!0)){function s(l,u){const c=ga(l),f=ga(u),h=c.split("."),v=f.split("."),d=h.length,A=v.length;if(d===0||A===0||d<A)return!1;for(let b=0;b<d;b++)if(h[b].length===0)return!1;for(let b=0;b<A;b++)if(v[b].length===0){if(b===0){if(A===1)return!1;continue}return!1}for(let b=0;b<A;b++)if(v[A-1-b].length!==0&&h[d-1-b].localeCompare(v[A-1-b])!==0)return!1;return!0}function a(l,u){const c=ga(l),f=ga(u),h=c.split("@"),v=f.split("@");if(h.length===0||v.length===0||h.length<v.length)return!1;if(v.length===1){if(s(h[1],v[0])){const d=h[1].split("."),A=v[0].split(".");return A[0].length===0?!0:d.length===A.length}return!1}return c.localeCompare(f)===0}function n(l,u){let c=ga(l);const f=ga(u),h=c.split("/");if(f.split("/").length>1)return!1;if(h.length>1){for(let v=0;v<h.length;v++)if(h[v].length>0&&h[v].charAt(h[v].length-1)!==":"){c=h[v].split(":")[0];break}}if(s(c,f)){const v=c.split("."),d=f.split(".");return d[0].length===0?!0:v.length===d.length}return!1}function i(l,u){const c=l.valueBlock.valueHexView,f=u.valueBlock.valueHexView;if(c.length===4&&f.length===8){for(let h=0;h<4;h++)if((c[h]^f[h])&f[h+4])return!1;return!0}if(c.length===16&&f.length===32){for(let h=0;h<16;h++)if((c[h]^f[h])&f[h+16])return!1;return!0}return!1}function o(l,u){if(l.typesAndValues.length===0||u.typesAndValues.length===0)return!0;if(l.typesAndValues.length<u.typesAndValues.length)return!1;let c=!0,f=0;for(let h=0;h<u.typesAndValues.length;h++){let v=!1;for(let d=f;d<l.typesAndValues.length;d++)if(v=l.typesAndValues[d].isEqual(u.typesAndValues[h]),l.typesAndValues[d].type===u.typesAndValues[h].type&&(c=c&&v),v===!0)if(f===0||f===d){f=d+1;break}else return!1;if(v===!1)return!1}return f===0?!1:c}try{if(this.certs.length===0)throw new Error("Empty certificate array");const l=e.passedWhenNotRevValues||!1,u=e.initialPolicySet||[is],c=e.initialExplicitPolicy||!1,f=e.initialPolicyMappingInhibit||!1,h=e.initialInhibitPolicy||!1,v=e.initialPermittedSubtreesSet||[],d=e.initialExcludedSubtreesSet||[],A=e.initialRequiredNameForms||[];let b=c,I=f,p=h;const w=[!1,!1,!1];let E=0,O=0,x=0,T=v,B=d;const k=A;let J=1;this.certs=await this.sort(l,t);const F=[];F.push(is);const P=[],U=new Array(this.certs.length-1);for(let Z=0;Z<this.certs.length-1;Z++)U[Z]=!0;P.push(U);const re=new Array(this.certs.length-1),X=new Array(this.certs.length-1);let K=b?this.certs.length-1:-1;for(let Z=this.certs.length-2;Z>=0;Z--,J++){const _=this.certs[Z];if(_.extensions){for(let z=0;z<_.extensions.length;z++){const oe=_.extensions[z];if(oe.extnID===Nw){X[Z]=oe.parsedValue;for(let ce=0;ce<F.length;ce++)if(F[ce]===is){delete P[ce][Z];break}for(let ce=0;ce<oe.parsedValue.certificatePolicies.length;ce++){let ue=-1;const fe=oe.parsedValue.certificatePolicies[ce].policyIdentifier;for(let V=0;V<F.length;V++)if(fe===F[V]){ue=V;break}if(ue===-1){F.push(fe);const V=new Array(this.certs.length-1);V[Z]=!0,P.push(V)}else P[ue][Z]=!0}}if(oe.extnID===Ew){if(I)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};re[Z]=oe.parsedValue}oe.extnID===Cw&&b===!1&&(oe.parsedValue.requireExplicitPolicy===0?(b=!0,K=Z):w[0]===!1?(w[0]=!0,E=oe.parsedValue.requireExplicitPolicy):E=E>oe.parsedValue.requireExplicitPolicy?oe.parsedValue.requireExplicitPolicy:E,oe.parsedValue.inhibitPolicyMapping===0?I=!0:w[1]===!1?(w[1]=!0,O=oe.parsedValue.inhibitPolicyMapping+1):O=O>oe.parsedValue.inhibitPolicyMapping+1?oe.parsedValue.inhibitPolicyMapping+1:O),oe.extnID===pS&&p===!1&&(oe.parsedValue.valueBlock.valueDec===0?p=!0:w[2]===!1?(w[2]=!0,x=oe.parsedValue.valueBlock.valueDec):x=x>oe.parsedValue.valueBlock.valueDec?oe.parsedValue.valueBlock.valueDec:x)}if(p===!0){let z=-1;for(let oe=0;oe<F.length;oe++)if(F[oe]===is){z=oe;break}z!==-1&&delete P[0][Z]}b===!1&&w[0]===!0&&(E--,E===0&&(b=!0,K=Z,w[0]=!1)),I===!1&&w[1]===!0&&(O--,O===0&&(I=!0,w[1]=!1)),p===!1&&w[2]===!0&&(x--,x===0&&(p=!0,w[2]=!1))}}for(let Z=0;Z<this.certs.length-1;Z++)if(Z<this.certs.length-2&&typeof re[Z+1]<"u")for(let _=0;_<re[Z+1].mappings.length;_++){if(re[Z+1].mappings[_].issuerDomainPolicy===is||re[Z+1].mappings[_].subjectDomainPolicy===is)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let z=-1,oe=-1;for(let ce=0;ce<F.length;ce++)F[ce]===re[Z+1].mappings[_].issuerDomainPolicy&&(z=ce),F[ce]===re[Z+1].mappings[_].subjectDomainPolicy&&(oe=ce);typeof P[z][Z]<"u"&&delete P[z][Z];for(let ce=0;ce<X[Z].certificatePolicies.length;ce++)if(re[Z+1].mappings[_].subjectDomainPolicy===X[Z].certificatePolicies[ce].policyIdentifier&&z!==-1&&oe!==-1)for(let ue=0;ue<=Z;ue++)typeof P[oe][ue]<"u"&&(P[z][ue]=!0,delete P[oe][ue])}for(let Z=0;Z<F.length;Z++)if(F[Z]===is)for(let _=0;_<K;_++)delete P[Z][_];const W=[];for(let Z=0;Z<P.length;Z++){let _=!0;for(let z=0;z<this.certs.length-1;z++){let oe=!1;if(z<K&&F[Z]===is&&F.length>1){_=!1;break}if(typeof P[Z][z]>"u"){if(z>=K){for(let ce=0;ce<F.length;ce++)if(F[ce]===is){P[ce][z]===!0&&(oe=!0);break}}if(!oe){_=!1;break}}}_===!0&&W.push(F[Z])}let ne=[];if(u.length===1&&u[0]===is&&b===!1)ne=u;else if(W.length===1&&W[0]===is)ne=u;else for(let Z=0;Z<W.length;Z++)for(let _=0;_<u.length;_++)if(u[_]===W[Z]||u[_]===is){ne.push(W[Z]);break}const se={result:ne.length>0,resultCode:0,resultMessage:ne.length>0?C:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:W,userConstrPolicies:ne,explicitPolicyIndicator:b,policyMappings:re,certificatePath:this.certs};if(ne.length===0||se.result===!1)return se;J=1;for(let Z=this.certs.length-2;Z>=0;Z--,J++){const _=this.certs[Z];let z=[],oe=[],ce=[];if(_.extensions)for(let S=0;S<_.extensions.length;S++){const $=_.extensions[S];$.extnID===Sw&&("permittedSubtrees"in $.parsedValue&&(oe=oe.concat($.parsedValue.permittedSubtrees)),"excludedSubtrees"in $.parsedValue&&(ce=ce.concat($.parsedValue.excludedSubtrees))),$.extnID===yw&&(z=z.concat($.parsedValue.altNames))}let ue=k.length<=0;for(let S=0;S<k.length;S++)switch(k[S].base.type){case 4:{if(k[S].base.value.typesAndValues.length!==_.subject.typesAndValues.length)continue;ue=!0;for(let $=0;$<_.subject.typesAndValues.length;$++)if(_.subject.typesAndValues[$].type!==k[S].base.value.typesAndValues[$].type){ue=!1;break}if(ue===!0)break}break;default:}if(ue===!1)throw se.result=!1,se.resultCode=21,se.resultMessage="No necessary name form found",se;const fe=[[],[],[],[],[]];for(let S=0;S<T.length;S++)switch(T[S].base.type){case 1:fe[0].push(T[S]);break;case 2:fe[1].push(T[S]);break;case 4:fe[2].push(T[S]);break;case 6:fe[3].push(T[S]);break;case 7:fe[4].push(T[S]);break;default:}for(let S=0;S<5;S++){let $=!1,R=!1;const me=fe[S];for(let ge=0;ge<me.length;ge++){switch(S){case 0:if(z.length>0)for(let he=0;he<z.length;he++)z[he].type===1&&(R=!0,$=$||a(z[he].value,me[ge].base.value));else for(let he=0;he<_.subject.typesAndValues.length;he++)(_.subject.typesAndValues[he].type==="1.2.840.113549.1.9.1"||_.subject.typesAndValues[he].type==="0.9.2342.19200300.100.1.3")&&(R=!0,$=$||a(_.subject.typesAndValues[he].value.valueBlock.value,me[ge].base.value));break;case 1:if(z.length>0)for(let he=0;he<z.length;he++)z[he].type===2&&(R=!0,$=$||s(z[he].value,me[ge].base.value));break;case 2:R=!0,$=o(_.subject,me[ge].base.value);break;case 3:if(z.length>0)for(let he=0;he<z.length;he++)z[he].type===6&&(R=!0,$=$||n(z[he].value,me[ge].base.value));break;case 4:if(z.length>0)for(let he=0;he<z.length;he++)z[he].type===7&&(R=!0,$=$||i(z[he].value,me[ge].base.value));break;default:}if($)break}if($===!1&&me.length>0&&R)throw se.result=!1,se.resultCode=41,se.resultMessage='Failed to meet "permitted sub-trees" name constraint',se}let V=!1;for(let S=0;S<B.length;S++){switch(B[S].base.type){case 1:if(z.length>=0)for(let $=0;$<z.length;$++)z[$].type===1&&(V=V||a(z[$].value,B[S].base.value));else for(let $=0;$<_.subject.typesAndValues.length;$++)(_.subject.typesAndValues[$].type==="1.2.840.113549.1.9.1"||_.subject.typesAndValues[$].type==="0.9.2342.19200300.100.1.3")&&(V=V||a(_.subject.typesAndValues[$].value.valueBlock.value,B[S].base.value));break;case 2:if(z.length>0)for(let $=0;$<z.length;$++)z[$].type===2&&(V=V||s(z[$].value,B[S].base.value));break;case 4:V=V||o(_.subject,B[S].base.value);break;case 6:if(z.length>0)for(let $=0;$<z.length;$++)z[$].type===6&&(V=V||n(z[$].value,B[S].base.value));break;case 7:if(z.length>0)for(let $=0;$<z.length;$++)z[$].type===7&&(V=V||i(z[$].value,B[S].base.value));break;default:}if(V)break}if(V===!0)throw se.result=!1,se.resultCode=42,se.resultMessage='Failed to meet "excluded sub-trees" name constraint',se;T=T.concat(oe),B=B.concat(ce)}return se}catch(l){return l instanceof Error?l instanceof Sa?{result:!1,resultCode:l.code,resultMessage:l.message,error:l}:{result:!1,resultCode:Jn.unknown,resultMessage:l.message,error:l}:l&&typeof l=="object"&&"resultMessage"in l?l:{result:!1,resultCode:-1,resultMessage:`${l}`}}}}const Gh="tbsResponseData",fl="signatureAlgorithm",pl="signature",vo="certs",Yl="BasicOCSPResponse",Pp=`${Yl}.${Gh}`,Dp=`${Yl}.${fl}`,Tp=`${Yl}.${pl}`,zh=`${Yl}.${vo}`,sN=[Pp,Dp,Tp,zh];class fs extends Q{constructor(e={}){super(),this.tbsResponseData=g(e,Gh,fs.defaultValues(Gh)),this.signatureAlgorithm=g(e,fl,fs.defaultValues(fl)),this.signature=g(e,pl,fs.defaultValues(pl)),vo in e&&(this.certs=g(e,vo,fs.defaultValues(vo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gh:return new ht;case fl:return new H;case pl:return new be;case vo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let s=ht.compareWithDefault("tbs",t.tbs)&&ht.compareWithDefault("responderID",t.responderID)&&ht.compareWithDefault("producedAt",t.producedAt)&&ht.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(s=s&&ht.compareWithDefault("responseExtensions",t.responseExtensions)),s}case fl:return t.algorithmId===C&&!("algorithmParams"in t);case pl:return t.isEqual(fs.defaultValues(e));case vo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||Yl,value:[ht.schema(t.tbsResponseData||{names:{blockName:Pp}}),H.schema(t.signatureAlgorithm||{names:{blockName:Dp}}),new be({name:t.signature||Tp}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new D({value:[new ye({name:zh,value:Ae.schema(t.certs||{})})]})]})]})}fromSchema(e){ee(e,sN);const t=te(e,e,fs.schema());G.assertSchema(t,this.className),this.tbsResponseData=new ht({schema:t.result[Pp]}),this.signatureAlgorithm=new H({schema:t.result[Dp]}),this.signature=t.result[Tp],zh in t.result&&(this.certs=Array.from(t.result[zh],s=>new Ae({schema:s})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[new D({value:Array.from(this.certs,t=>t.toSchema())})]})),new D({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}async getCertificateStatus(e,t,s=we(!0)){const a={isForCertificate:!1,status:2},n={},i=[];for(const o of this.tbsResponseData.responses){const l=s.getAlgorithmByOID(o.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!n[l.name]){n[l.name]=1;const u=new Ye;i.push(u),await u.createForCertificate(e,{hashAlgorithm:l.name,issuerCertificate:t},s)}}for(const o of this.tbsResponseData.responses)for(const l of i)if(o.certID.isEqual(l)){a.isForCertificate=!0;try{switch(o.certStatus.idBlock.isConstructed){case!0:o.certStatus.idBlock.tagNumber===1&&(a.status=1);break;case!1:switch(o.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2;break;default:}break;default:}}catch{}return a}return a}async sign(e,t="SHA-1",s=we(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters.algorithm;if(!("name"in n))throw new Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());const i=await s.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:n});this.signature=new be({valueHex:i})}async verify(e={},t=we(!0)){let s=null,a=-1;const n=e.trustedCerts||[];if(!this.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof Be:for(const[o,l]of this.certs.entries())if(l.subject.isEqual(this.tbsResponseData.responderID)){a=o;break}break;case this.tbsResponseData.responderID instanceof ae:for(const[o,l]of this.certs.entries()){const u=await t.digest({name:"sha-1"},l.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(Ul(u,this.tbsResponseData.responderID.valueBlock.valueHex)){a=o;break}}break;default:throw new Error("Wrong value for responderID")}if(a===-1)throw new Error("Correct certificate was not found in OCSP response");s=this.certs[a];const i=[s];for(const o of this.certs){const l=await Tw(o,s);l&&i.push(l)}if(!(await new tf({certs:i,trustedCerts:n}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}fs.CLASS_NAME="BasicOCSPResponse";const ip="tbs",op="version",up="subject",cp="subjectPublicKeyInfo",wi="attributes",dl="signatureAlgorithm",gl="signatureValue",lu="CertificationRequestInfo",Id=`${lu}.version`,Vd=`${lu}.subject`,Bd=`${lu}.subjectPublicKeyInfo`,Mm=`${lu}.attributes`,rN=[lu,Id,Vd,Bd,Mm,dl,gl];function aN(r={}){const e=g(r,"names",{});return new D({name:e.CertificationRequestInfo||lu,value:[new q({name:e.CertificationRequestInfoVersion||Id}),Be.schema(e.subject||{names:{blockName:Vd}}),Ht.schema({names:{blockName:Bd}}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ye({optional:!0,name:e.CertificationRequestInfoAttributes||Mm,value:Oe.schema(e.attributes||{})})]})]})}class As extends Q{get tbs(){return Te.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(g(e,ip,As.defaultValues(ip))),this.version=g(e,op,As.defaultValues(op)),this.subject=g(e,up,As.defaultValues(up)),this.subjectPublicKeyInfo=g(e,cp,As.defaultValues(cp)),wi in e&&(this.attributes=g(e,wi,As.defaultValues(wi))),this.signatureAlgorithm=g(e,dl,As.defaultValues(dl)),this.signatureValue=g(e,gl,As.defaultValues(gl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ip:return We;case op:return 0;case up:return new Be;case cp:return new Ht;case wi:return[];case dl:return new H;case gl:return new be;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({value:[aN(t.certificationRequestInfo||{}),new D({name:t.signatureAlgorithm||dl,value:[new le,new de({optional:!0})]}),new be({name:t.signatureValue||gl})]})}fromSchema(e){ee(e,rN);const t=te(e,e,As.schema());G.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[Id].valueBlock.valueDec,this.subject=new Be({schema:t.result[Vd]}),this.subjectPublicKeyInfo=new Ht({schema:t.result[Bd]}),Mm in t.result&&(this.attributes=Array.from(t.result[Mm],s=>new Oe({schema:s}))),this.signatureAlgorithm=new H({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new q({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return wi in this&&e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new D({value:e})}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return As.schema();const s=ot(this.tbsView);G.assert(s,"PKCS#10 Certificate Request"),t=s.result}else t=this.encodeTBS();return new D({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ke.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return wi in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}async sign(e,t="SHA-1",s=we(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new be({valueHex:i})}async verify(e=we(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=we(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}As.CLASS_NAME="CertificationRequest";const Tn="digestAlgorithm",Ln="digest",nN=[Tn,Ln];class ds extends Q{constructor(e={}){super(),this.digestAlgorithm=g(e,Tn,ds.defaultValues(Tn)),this.digest=g(e,Ln,ds.defaultValues(Ln)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tn:return new H;case Ln:return new ae;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Tn:return H.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Ln:return t.isEqual(ds.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[H.schema(t.digestAlgorithm||{names:{blockName:Tn}}),new ae({name:t.digest||Ln})]})}fromSchema(e){ee(e,nN);const t=te(e,e,ds.schema({names:{digestAlgorithm:{names:{blockName:Tn}},digest:Ln}}));G.assertSchema(t,this.className),this.digestAlgorithm=new H({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new D({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}ds.CLASS_NAME="DigestInfo";const bo="eContentType",Ss="eContent",iN=[bo,Ss];class $t extends Q{constructor(e={}){if(super(),this.eContentType=g(e,bo,$t.defaultValues(bo)),Ss in e&&(this.eContent=g(e,Ss,$t.defaultValues(Ss)),this.eContent.idBlock.tagClass===1&&this.eContent.idBlock.tagNumber===4&&this.eContent.idBlock.isConstructed===!1)){const t=new ae({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,s,s+65536>a.byteLength?a.byteLength-s:65536),o=new ArrayBuffer(i.length),l=new Uint8Array(o);for(let u=0;u<l.length;u++)l[u]=i[u];t.valueBlock.value.push(new ae({valueHex:o})),n-=i.length,s+=i.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bo:return C;case Ss:return new ae;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bo:return t===C;case Ss:return t.idBlock.tagClass===1&&t.idBlock.tagNumber===4?t.isEqual($t.defaultValues(Ss)):!1;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.eContentType||C}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new de({name:t.eContent||C})]})]})}fromSchema(e){ee(e,iN);const t=te(e,e,$t.schema({names:{eContentType:bo,eContent:Ss}}));G.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),Ss in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new le({value:this.eContentType})),this.eContent&&$t.compareWithDefault(Ss,this.eContent)===!1&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new D({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&$t.compareWithDefault(Ss,this.eContent)===!1&&(e.eContent=this.eContent.toJSON()),e}}$t.CLASS_NAME="EncapsulatedContentInfo";const Rn="mac",Un="macSalt",Qs="iterations",oN=[Rn,Un,Qs];class Tt extends Q{constructor(e={}){super(),this.mac=g(e,Rn,Tt.defaultValues(Rn)),this.macSalt=g(e,Un,Tt.defaultValues(Un)),Qs in e&&(this.iterations=g(e,Qs,Tt.defaultValues(Qs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rn:return new ds;case Un:return new ae;case Qs:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Rn:return ds.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&ds.compareWithDefault("digest",t.digest);case Un:return t.isEqual(Tt.defaultValues(e));case Qs:return t===Tt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,optional:t.optional||!0,value:[ds.schema(t.mac||{names:{blockName:Rn}}),new ae({name:t.macSalt||Un}),new q({optional:!0,name:t.iterations||Qs})]})}fromSchema(e){ee(e,oN);const t=te(e,e,Tt.schema({names:{mac:{names:{blockName:Rn}},macSalt:Un,iterations:Qs}}));G.assertSchema(t,this.className),this.mac=new ds({schema:t.result.mac}),this.macSalt=t.result.macSalt,Qs in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return this.iterations!==void 0&&e.push(new q({value:this.iterations})),new D({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return this.iterations!==void 0&&(e.iterations=this.iterations),e}}Tt.CLASS_NAME="MacData";const Fn="hashAlgorithm",qn="hashedMessage",uN=[Fn,qn];class At extends Q{static async create(e,t,s=we(!0)){const a=s.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),n=await s.digest(e,t);return new At({hashAlgorithm:new H({algorithmId:a,algorithmParams:new rt}),hashedMessage:new ae({valueHex:n})})}constructor(e={}){super(),this.hashAlgorithm=g(e,Fn,At.defaultValues(Fn)),this.hashedMessage=g(e,qn,At.defaultValues(qn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fn:return new H;case qn:return new ae;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Fn:return t.algorithmId===C&&!("algorithmParams"in t);case qn:return t.isEqual(At.defaultValues(e))===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[H.schema(t.hashAlgorithm||{}),new ae({name:t.hashedMessage||C})]})}fromSchema(e){ee(e,uN);const t=te(e,e,At.schema({names:{hashAlgorithm:{names:{blockName:Fn}},hashedMessage:qn}}));G.assertSchema(t,this.className),this.hashAlgorithm=new H({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new D({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}At.CLASS_NAME="MessageImprint";const So="reqCert",la="singleRequestExtensions",cN=[So,la];let Hm=class yl extends Q{constructor(e={}){super(),this.reqCert=g(e,So,yl.defaultValues(So)),la in e&&(this.singleRequestExtensions=g(e,la,yl.defaultValues(la))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case So:return new Ye;case la:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case So:return t.isEqual(yl.defaultValues(e));case la:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[Ye.schema(t.reqCert||{}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[_e.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||C}})]})]})}fromSchema(e){ee(e,cN);const t=te(e,e,yl.schema({names:{reqCert:{names:{blockName:So}},extensions:{names:{blockName:la}}}}));G.assertSchema(t,this.className),this.reqCert=new Ye({schema:t.result.reqCert}),la in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,s=>new st({schema:s})))}toSchema(){const e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new D({value:Array.from(this.singleRequestExtensions,t=>t.toSchema())})]})),new D({value:e})}toJSON(){const e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,t=>t.toJSON())),e}};Hm.CLASS_NAME="Request";const Ph="tbs",Ao="version",No="requestorName",Dh="requestList",Eo="requestExtensions",hu="TBSRequest",Xh=`${hu}.${Ao}`,Yh=`${hu}.${No}`,Lp=`${hu}.requests`,Qh=`${hu}.${Eo}`,lN=[hu,Xh,Yh,Lp,Qh];class yt extends Q{get tbs(){return Te.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(g(e,Ph,yt.defaultValues(Ph))),Ao in e&&(this.version=g(e,Ao,yt.defaultValues(Ao))),No in e&&(this.requestorName=g(e,No,yt.defaultValues(No))),this.requestList=g(e,Dh,yt.defaultValues(Dh)),Eo in e&&(this.requestExtensions=g(e,Eo,yt.defaultValues(Eo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ph:return We;case Ao:return 0;case No:return new Ee;case Dh:case Eo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ph:return t.byteLength===0;case Ao:return t===yt.defaultValues(e);case No:return t.type===Ee.defaultValues("type")&&Object.keys(t.value).length===0;case Dh:case Eo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||hu,value:[new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new q({name:t.TBSRequestVersion||Xh})]}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Ee.schema(t.requestorName||{names:{blockName:Yh}})]}),new D({name:t.requestList||"TBSRequest.requestList",value:[new ye({name:t.requests||Lp,value:Hm.schema(t.requestNames||{})})]}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[_e.schema(t.extensions||{names:{blockName:t.requestExtensions||Qh}})]})]})}fromSchema(e){ee(e,lN);const t=te(e,e,yt.schema());G.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,Xh in t.result&&(this.version=t.result[Xh].valueBlock.valueDec),Yh in t.result&&(this.requestorName=new Ee({schema:t.result[Yh]})),this.requestList=Array.from(t.result[Lp],s=>new Hm({schema:s})),Qh in t.result&&(this.requestExtensions=Array.from(t.result[Qh].valueBlock.value,s=>new st({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return yt.schema();const s=ot(this.tbsView);if(G.assert(s,"TBS Request"),!(s.result instanceof D))throw new Error("ASN.1 result should be SEQUENCE");t=s.result}else{const s=[];this.version!==void 0&&s.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[new q({value:this.version})]})),this.requestorName&&s.push(new j({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),s.push(new D({value:Array.from(this.requestList,a=>a.toSchema())})),this.requestExtensions&&s.push(new j({idBlock:{tagClass:3,tagNumber:2},value:[new D({value:Array.from(this.requestExtensions,a=>a.toSchema())})]})),t=new D({value:s})}return t}toJSON(){const e={};return this.version!=null&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,t=>t.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,t=>t.toJSON())),e}}yt.CLASS_NAME="TBSRequest";const vi="signatureAlgorithm",bi="signature",Vr="certs";class Qt extends Q{constructor(e={}){super(),this.signatureAlgorithm=g(e,vi,Qt.defaultValues(vi)),this.signature=g(e,bi,Qt.defaultValues(bi)),Vr in e&&(this.certs=g(e,Vr,Qt.defaultValues(Vr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vi:return new H;case bi:return new be;case Vr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vi:return t.algorithmId===C&&!("algorithmParams"in t);case bi:return t.isEqual(Qt.defaultValues(e));case Vr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[H.schema(t.signatureAlgorithm||{}),new be({name:t.signature||C}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new D({value:[new ye({name:t.certs||C,value:Ae.schema({})})]})]})]})}fromSchema(e){ee(e,[vi,bi,Vr]);const t=te(e,e,Qt.schema({names:{signatureAlgorithm:{names:{blockName:vi}},signature:bi,certs:Vr}}));G.assertSchema(t,this.className),this.signatureAlgorithm=new H({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,Vr in t.result&&(this.certs=Array.from(t.result.certs,s=>new Ae({schema:s})))}toSchema(){const e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new D({value:Array.from(this.certs,t=>t.toSchema())})]})),new D({value:e})}toJSON(){const e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}}Qt.CLASS_NAME="Signature";const Co="tbsRequest",ha="optionalSignature",hN=[Co,ha];class Pl extends Q{constructor(e={}){super(),this.tbsRequest=g(e,Co,Pl.defaultValues(Co)),ha in e&&(this.optionalSignature=g(e,ha,Pl.defaultValues(ha))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Co:return new yt;case ha:return new Qt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Co:return yt.compareWithDefault("tbs",t.tbs)&&yt.compareWithDefault("version",t.version)&&yt.compareWithDefault("requestorName",t.requestorName)&&yt.compareWithDefault("requestList",t.requestList)&&yt.compareWithDefault("requestExtensions",t.requestExtensions);case ha:return Qt.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&Qt.compareWithDefault("signature",t.signature)&&Qt.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||"OCSPRequest",value:[yt.schema(t.tbsRequest||{names:{blockName:Co}}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Qt.schema(t.optionalSignature||{names:{blockName:ha}})]})]})}fromSchema(e){ee(e,hN);const t=te(e,e,Pl.schema());G.assertSchema(t,this.className),this.tbsRequest=new yt({schema:t.result.tbsRequest}),ha in t.result&&(this.optionalSignature=new Qt({schema:t.result.optionalSignature}))}toSchema(e=!1){const t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new D({value:t})}toJSON(){const e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,s=we(!0)){const a=new Ye;await a.createForCertificate(e,t,s),this.tbsRequest.requestList.push(new Hm({reqCert:a}))}async sign(e,t="SHA-1",s=we(!0)){if(Se.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw new Error('Need to create "optionalSignature" field before signing');const a=await s.getSignatureParameters(e,t),n=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;const i=this.tbsRequest.toSchema(!0).toBER(!1),o=await s.signWithPrivateKey(i,e,n);this.optionalSignature.signature=new be({valueHex:o})}verify(){}}Pl.CLASS_NAME="OCSPRequest";const ko="responseType",Io="response",mN=[ko,Io];class ks extends Q{constructor(e={}){super(),this.responseType=g(e,ko,ks.defaultValues(ko)),this.response=g(e,Io,ks.defaultValues(Io)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ko:return C;case Io:return new ae;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ko:return t===C;case Io:return t.isEqual(ks.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new le({name:t.responseType||C}),new ae({name:t.response||C})]})}fromSchema(e){ee(e,mN);const t=te(e,e,ks.schema({names:{responseType:ko,response:Io}}));G.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new D({value:[new le({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}ks.CLASS_NAME="ResponseBytes";const Si="responseStatus",Js="responseBytes";class zo extends Q{constructor(e={}){super(),this.responseStatus=g(e,Si,zo.defaultValues(Si)),Js in e&&(this.responseBytes=g(e,Js,zo.defaultValues(Js))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Si:return new $l;case Js:return new ks;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Si:return t.isEqual(zo.defaultValues(e));case Js:return ks.compareWithDefault("responseType",t.responseType)&&ks.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||"OCSPResponse",value:[new $l({name:t.responseStatus||Si}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ks.schema(t.responseBytes||{names:{blockName:Js}})]})]})}fromSchema(e){ee(e,[Si,Js]);const t=te(e,e,zo.schema());G.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,Js in t.result&&(this.responseBytes=new ks({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new D({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,s=we(!0)){let a;const n={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==$h)return n;try{const i=ot(this.responseBytes.response.valueBlock.valueHexView);G.assert(i,"Basic OCSP response"),a=new fs({schema:i.result})}catch{return n}return a.getCertificateStatus(e,t,s)}async sign(e,t,s=we(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===$h)return fs.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,s);throw new Error(`Unknown ResponseBytes type: ${((a=this.responseBytes)===null||a===void 0?void 0:a.responseType)||"Unknown"}`)}async verify(e=null,t=we(!0)){var s;if(!(Js in this))throw new Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===$h){const a=fs.fromBER(this.responseBytes.response.valueBlock.valueHexView);return e!==null&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw new Error(`Unknown ResponseBytes type: ${((s=this.responseBytes)===null||s===void 0?void 0:s.responseType)||"Unknown"}`)}}zo.CLASS_NAME="OCSPResponse";const Ha="type",Zs="attributes",Th="encodedValue",fN=[Zs];class Re extends Q{constructor(e={}){super(),this.type=g(e,Ha,Re.defaultValues(Ha)),this.attributes=g(e,Zs,Re.defaultValues(Zs)),this.encodedValue=g(e,Th,Re.defaultValues(Th)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ha:return-1;case Zs:return[];case Th:return We;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ha:return t===Re.defaultValues(Ha);case Zs:return t.length===0;case Th:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new j({name:t.blockName||C,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new ye({name:t.attributes||C,value:Oe.schema()})]})}fromSchema(e){ee(e,fN);const t=te(e,e,Re.schema({names:{tagNumber:this.type,attributes:Zs}}));G.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=Te.toArrayBuffer(t.result.valueBeforeDecodeView);const s=new Uint8Array(this.encodedValue);if(s[0]=49,!(Zs in t.result)){if(this.type===0)throw new Error("Wrong structure of SignedUnsignedAttributes");return}this.attributes=Array.from(t.result.attributes,a=>new Oe({schema:a}))}toSchema(){if(Re.compareWithDefault(Ha,this.type)||Re.compareWithDefault(Zs,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new j({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(Re.compareWithDefault(Ha,this.type)||Re.compareWithDefault(Zs,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}Re.CLASS_NAME="SignedAndUnsignedAttributes";const Vo="version",$n="sid",Bo="digestAlgorithm",ma="signedAttrs",xo="signatureAlgorithm",wl="signature",fa="unsignedAttrs",Ua="SignerInfo",Rp=`${Ua}.${Vo}`,vl=`${Ua}.${$n}`,Up=`${Ua}.${Bo}`,Zh=`${Ua}.${ma}`,$p=`${Ua}.${xo}`,jp=`${Ua}.${wl}`,em=`${Ua}.${fa}`,pN=[Rp,vl,Up,Zh,$p,jp,em];class He extends Q{constructor(e={}){super(),this.version=g(e,Vo,He.defaultValues(Vo)),this.sid=g(e,$n,He.defaultValues($n)),this.digestAlgorithm=g(e,Bo,He.defaultValues(Bo)),ma in e&&(this.signedAttrs=g(e,ma,He.defaultValues(ma))),this.signatureAlgorithm=g(e,xo,He.defaultValues(xo)),this.signature=g(e,wl,He.defaultValues(wl)),fa in e&&(this.unsignedAttrs=g(e,fa,He.defaultValues(fa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vo:return 0;case $n:return new de;case Bo:return new H;case ma:return new Re({type:0});case xo:return new H;case wl:return new ae;case fa:return new Re({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vo:return He.defaultValues(Vo)===t;case $n:return t instanceof de;case Bo:return t instanceof H?t.isEqual(He.defaultValues(Bo)):!1;case ma:return Re.compareWithDefault("type",t.type)&&Re.compareWithDefault("attributes",t.attributes)&&Re.compareWithDefault("encodedValue",t.encodedValue);case xo:return t instanceof H?t.isEqual(He.defaultValues(xo)):!1;case wl:case fa:return Re.compareWithDefault("type",t.type)&&Re.compareWithDefault("attributes",t.attributes)&&Re.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:Ua,value:[new q({name:t.version||Rp}),new Me({value:[Ge.schema(t.sidSchema||{names:{blockName:vl}}),new Me({value:[new j({optional:!0,name:t.sid||vl,idBlock:{tagClass:3,tagNumber:0},value:[new ae]}),new pe({optional:!0,name:t.sid||vl,idBlock:{tagClass:3,tagNumber:0}})]})]}),H.schema(t.digestAlgorithm||{names:{blockName:Up}}),Re.schema(t.signedAttrs||{names:{blockName:Zh,tagNumber:0}}),H.schema(t.signatureAlgorithm||{names:{blockName:$p}}),new ae({name:t.signature||jp}),Re.schema(t.unsignedAttrs||{names:{blockName:em,tagNumber:1}})]})}fromSchema(e){ee(e,pN);const t=te(e,e,He.schema());G.assertSchema(t,this.className),this.version=t.result[Rp].valueBlock.valueDec;const s=t.result[vl];s.idBlock.tagClass===1?this.sid=new Ge({schema:s}):this.sid=s,this.digestAlgorithm=new H({schema:t.result[Up]}),Zh in t.result&&(this.signedAttrs=new Re({type:0,schema:t.result[Zh]})),this.signatureAlgorithm=new H({schema:t.result[$p]}),this.signature=t.result[jp],em in t.result&&(this.unsignedAttrs=new Re({type:1,schema:t.result[em]}))}toSchema(){if(He.compareWithDefault($n,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new q({value:this.version})),this.sid instanceof Ge?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&He.compareWithDefault(ma,this.signedAttrs)===!1&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&He.compareWithDefault(fa,this.unsignedAttrs)===!1&&e.push(this.unsignedAttrs.toSchema()),new D({value:e})}toJSON(){if(He.compareWithDefault($n,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof de||(e.sid=this.sid.toJSON()),this.signedAttrs&&He.compareWithDefault(ma,this.signedAttrs)===!1&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&He.compareWithDefault(fa,this.unsignedAttrs)===!1&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}He.CLASS_NAME="SignerInfo";const bl="version",Sl="policy",Al="messageImprint",Nl="serialNumber",El="genTime",jn="ordering",Kn="nonce",Oo="accuracy",Po="tsa",Do="extensions",Bs="TSTInfo",Kp=`${Bs}.${bl}`,Mp=`${Bs}.${Sl}`,Hp=`${Bs}.${Al}`,Jp=`${Bs}.${Nl}`,Fp=`${Bs}.${El}`,tm=`${Bs}.${Oo}`,sm=`${Bs}.${jn}`,rm=`${Bs}.${Kn}`,am=`${Bs}.${Po}`,nm=`${Bs}.${Do}`,dN=[Kp,Mp,Hp,Jp,Fp,tm,sm,rm,am,nm];class Ct extends Q{constructor(e={}){super(),this.version=g(e,bl,Ct.defaultValues(bl)),this.policy=g(e,Sl,Ct.defaultValues(Sl)),this.messageImprint=g(e,Al,Ct.defaultValues(Al)),this.serialNumber=g(e,Nl,Ct.defaultValues(Nl)),this.genTime=g(e,El,Ct.defaultValues(El)),Oo in e&&(this.accuracy=g(e,Oo,Ct.defaultValues(Oo))),jn in e&&(this.ordering=g(e,jn,Ct.defaultValues(jn))),Kn in e&&(this.nonce=g(e,Kn,Ct.defaultValues(Kn))),Po in e&&(this.tsa=g(e,Po,Ct.defaultValues(Po))),Do in e&&(this.extensions=g(e,Do,Ct.defaultValues(Do))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bl:return 0;case Sl:return C;case Al:return new At;case Nl:return new q;case El:return new Date(0,0,0);case Oo:return new Yt;case jn:return!1;case Kn:return new q;case Po:return new Ee;case Do:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bl:case Sl:case El:case jn:return t===Ct.defaultValues(jn);case Al:return At.compareWithDefault(Fn,t.hashAlgorithm)&&At.compareWithDefault(qn,t.hashedMessage);case Nl:case Kn:return t.isEqual(Ct.defaultValues(Kn));case Oo:return Yt.compareWithDefault(Pr,t.seconds)&&Yt.compareWithDefault(Dr,t.millis)&&Yt.compareWithDefault(Tr,t.micros);case Po:return Ee.compareWithDefault(Tu,t.type)&&Ee.compareWithDefault(Lu,t.value);case Do:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||Bs,value:[new q({name:t.version||Kp}),new le({name:t.policy||Mp}),At.schema(t.messageImprint||{names:{blockName:Hp}}),new q({name:t.serialNumber||Jp}),new Je({name:t.genTime||Fp}),Yt.schema(t.accuracy||{names:{blockName:tm}}),new Ra({name:t.ordering||sm,optional:!0}),new q({name:t.nonce||rm,optional:!0}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Ee.schema(t.tsa||{names:{blockName:am}})]}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ye({name:t.extensions||nm,value:st.schema(t.extension||{})})]})]})}fromSchema(e){ee(e,dN);const t=te(e,e,Ct.schema());G.assertSchema(t,this.className),this.version=t.result[Kp].valueBlock.valueDec,this.policy=t.result[Mp].valueBlock.toString(),this.messageImprint=new At({schema:t.result[Hp]}),this.serialNumber=t.result[Jp],this.genTime=t.result[Fp].toDate(),tm in t.result&&(this.accuracy=new Yt({schema:t.result[tm]})),sm in t.result&&(this.ordering=t.result[sm].valueBlock.value),rm in t.result&&(this.nonce=t.result[rm]),am in t.result&&(this.tsa=new Ee({schema:t.result[am]})),nm in t.result&&(this.extensions=Array.from(t.result[nm],s=>new st({schema:s})))}toSchema(){const e=[];return e.push(new q({value:this.version})),e.push(new le({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new Je({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),this.ordering!==void 0&&e.push(new Ra({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new D({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),this.ordering!==void 0&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async verify(e,t=we(!0)){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const s=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),n=await t.digest(a.name,new Uint8Array(s));return Te.isEqual(n,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}Ct.CLASS_NAME="TSTInfo";const To="version",Cl="digestAlgorithms",kl="encapContentInfo",Lo="certificates",Ro="crls",Il="signerInfos",Ou="ocsps",li="SignedData",qp=`${li}.${To}`,im=`${li}.${Cl}`,Wp=`${li}.${kl}`,om=`${li}.${Lo}`,um=`${li}.${Ro}`,cm=`${li}.${Il}`,gN=[qp,im,Wp,om,um,cm];class Et extends Error{constructor({message:e,code:t=0,date:s=new Date,signatureVerified:a=null,signerCertificate:n=null,signerCertificateVerified:i=null,timestampSerial:o=null,certificatePath:l=[]}){super(e),this.name="SignedDataVerifyError",this.date=s,this.code=t,this.timestampSerial=o,this.signatureVerified=a,this.signerCertificate=n,this.signerCertificateVerified=i,this.certificatePath=l}}class lt extends Q{constructor(e={}){super(),this.version=g(e,To,lt.defaultValues(To)),this.digestAlgorithms=g(e,Cl,lt.defaultValues(Cl)),this.encapContentInfo=g(e,kl,lt.defaultValues(kl)),Lo in e&&(this.certificates=g(e,Lo,lt.defaultValues(Lo))),Ro in e&&(this.crls=g(e,Ro,lt.defaultValues(Ro))),Ou in e&&(this.ocsps=g(e,Ou,lt.defaultValues(Ou))),this.signerInfos=g(e,Il,lt.defaultValues(Il)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case To:return 0;case Cl:return[];case kl:return new $t;case Lo:return[];case Ro:return[];case Ou:return[];case Il:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case To:return t===lt.defaultValues(To);case kl:return $t.compareWithDefault("eContentType",t.eContentType)&&$t.compareWithDefault("eContent",t.eContent);case Cl:case Lo:case Ro:case Ou:case Il:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return t.optional===void 0&&(t.optional=!1),new D({name:t.blockName||li,optional:t.optional,value:[new q({name:t.version||qp}),new at({value:[new ye({name:t.digestAlgorithms||im,value:H.schema()})]}),$t.schema(t.encapContentInfo||{names:{blockName:Wp}}),new j({name:t.certificates||om,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:js.schema().valueBlock.value}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:pr.schema(t.crls||{names:{crls:um}}).valueBlock.value}),new at({value:[new ye({name:t.signerInfos||cm,value:He.schema()})]})]})}fromSchema(e){ee(e,gN);const t=te(e,e,lt.schema());if(G.assertSchema(t,this.className),this.version=t.result[qp].valueBlock.valueDec,im in t.result&&(this.digestAlgorithms=Array.from(t.result[im],s=>new H({schema:s}))),this.encapContentInfo=new $t({schema:t.result[Wp]}),om in t.result){const s=new js({schema:new at({value:t.result[om].valueBlock.value})});this.certificates=s.certificates.slice(0)}um in t.result&&(this.crls=Array.from(t.result[um],s=>s.idBlock.tagClass===1?new tt({schema:s}):(s.idBlock.tagClass=1,s.idBlock.tagNumber=16,new fr({schema:s})))),cm in t.result&&(this.signerInfos=Array.from(t.result[cm],s=>new He({schema:s})))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof Ta)||this.crls&&this.crls.length&&this.crls.some(s=>s instanceof fr)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof ts)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof or)||this.signerInfos.some(s=>s.version===3)||this.encapContentInfo.eContentType!==lt.ID_DATA?this.version=3:this.version=1,t.push(new q({value:this.version})),t.push(new at({value:Array.from(this.digestAlgorithms,s=>s.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const s=new js({certificates:this.certificates}).toSchema();t.push(new j({idBlock:{tagClass:3,tagNumber:0},value:s.valueBlock.value}))}return this.crls&&t.push(new j({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,s=>{if(s instanceof fr){const a=s.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return s.toSchema(e)})})),t.push(new at({value:Array.from(this.signerInfos,s=>s.toSchema())})),new D({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}async verify({signer:e=-1,data:t=We,trustedCerts:s=[],checkDate:a=new Date,checkChain:n=!1,passedWhenNotRevValues:i=!1,extendedMode:o=!1,findOrigin:l=null,findIssuer:u=null}={},c=we(!0)){let f=null,h=null;try{let v=We,d=C,A=[];const b=this.signerInfos[e];if(!b)throw new Et({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new Et({date:a,code:2,message:"No certificates attached to this signed data"});if(b.sid instanceof Ge){for(const E of this.certificates)if(E instanceof Ae&&E.issuer.isEqual(b.sid.issuer)&&E.serialNumber.isEqual(b.sid.serialNumber)){f=E;break}}else{const E=b.sid,O=E.idBlock.isConstructed?E.valueBlock.value[0].valueBlock.valueHex:E.valueBlock.valueHex;for(const x of this.certificates){if(!(x instanceof Ae))continue;const T=await c.digest({name:"sha-1"},x.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(Ul(T,O)){f=x;break}}}if(!f)throw new Et({date:a,code:3,message:"Unable to find signer certificate"});if(this.encapContentInfo.eContentType===bS){if(!this.encapContentInfo.eContent)throw new Et({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:f,timestampSerial:h,signerCertificateVerified:!0});let E;try{E=Ct.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch{throw new Et({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:f,timestampSerial:h,signerCertificateVerified:!0})}if(a=E.genTime,h=E.serialNumber.valueBlock.valueHexView.slice().buffer,t.byteLength===0)throw new Et({date:a,code:4,message:"Missed detached data input array"});if(!await E.verify({data:t},c))throw new Et({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:f,timestampSerial:h,signerCertificateVerified:!0})}if(n){const E=this.certificates.filter(B=>B instanceof Ae&&!!Tw(B,f)),O={checkDate:a,certs:E,trustedCerts:s};u&&(O.findIssuer=u),l&&(O.findOrigin=l);const x=new tf(O);if(x.certs.push(f),this.crls)for(const B of this.crls)"thisUpdate"in B?x.crls.push(B):B.otherRevInfoFormat===$h&&x.ocsps.push(new fs({schema:B.otherRevInfo}));this.ocsps&&x.ocsps.push(...this.ocsps);const T=await x.verify({passedWhenNotRevValues:i},c).catch(B=>{throw new Et({date:a,code:5,message:`Validation of signer's certificate failed with error: ${B instanceof Object?B.resultMessage:B}`,signerCertificate:f,signerCertificateVerified:!1})});if(T.certificatePath&&(A=T.certificatePath),!T.result)throw new Et({date:a,code:5,message:`Validation of signer's certificate failed: ${T.resultMessage}`,signerCertificate:f,signerCertificateVerified:!1})}const I=c.getAlgorithmByOID(b.digestAlgorithm.algorithmId);if(!("name"in I))throw new Et({date:a,code:7,message:`Unsupported signature algorithm: ${b.digestAlgorithm.algorithmId}`,signerCertificate:f,signerCertificateVerified:!0});d=I.name;const p=this.encapContentInfo.eContent;if(p)p.idBlock.tagClass===1&&p.idBlock.tagNumber===4?t=p.getValue():t=p.valueBlock.valueBeforeDecodeView.slice().buffer;else if(t.byteLength===0)throw new Et({date:a,code:8,message:"Missed detached data input array",signerCertificate:f,signerCertificateVerified:!0});if(b.signedAttrs){let E=!1,O=!1;for(const x of b.signedAttrs.attributes)if(x.type==="1.2.840.113549.1.9.3"&&(E=!0),x.type==="1.2.840.113549.1.9.4"&&(O=!0,v=x.values[0].valueBlock.valueHex),E&&O)break;if(E===!1)throw new Et({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:f,signerCertificateVerified:!0});if(O===!1)throw new Et({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:f,signerCertificateVerified:!0})}if(b.signedAttrs){const E=await c.digest(d,new Uint8Array(t));if(!Ul(E,v))throw new Et({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:f,timestampSerial:h,signerCertificateVerified:!0});t=b.signedAttrs.encodedValue}const w=b.signatureAlgorithm.algorithmId==="1.2.840.113549.1.1.1"?await c.verifyWithPublicKey(t,b.signature,f.subjectPublicKeyInfo,b.signatureAlgorithm,d):await c.verifyWithPublicKey(t,b.signature,f.subjectPublicKeyInfo,b.signatureAlgorithm);return o?{date:a,code:14,message:C,signatureVerified:w,signerCertificate:f,timestampSerial:h,signerCertificateVerified:!0,certificatePath:A}:w}catch(v){throw v instanceof Et?v:new Et({date:a,code:15,message:`Error during verification: ${v instanceof Error?v.message:v}`,signatureVerified:null,signerCertificate:f,timestampSerial:h,signerCertificateVerified:!0})}}async sign(e,t,s="SHA-1",a=We,n=we(!0)){var i;if(!e)throw new Error("Need to provide a private key for signing");const o=this.signerInfos[t];if(!o)throw new RangeError("SignerInfo index is out of range");!(!((i=o.signedAttrs)===null||i===void 0)&&i.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(s=e.algorithm.hash.name);const l=n.getOIDByAlgorithm({name:s},!0,"hashAlgorithm");this.digestAlgorithms.filter(h=>h.algorithmId===l).length===0&&this.digestAlgorithms.push(new H({algorithmId:l,algorithmParams:new rt})),o.digestAlgorithm=new H({algorithmId:l,algorithmParams:new rt});const u=await n.getSignatureParameters(e,s),c=u.parameters;if(o.signatureAlgorithm=u.signatureAlgorithm,o.signedAttrs)if(o.signedAttrs.encodedValue.byteLength!==0)a=o.signedAttrs.encodedValue;else{a=o.signedAttrs.toSchema().toBER();const h=Te.toUint8Array(a);h[0]=49}else{const h=this.encapContentInfo.eContent;if(h)h.idBlock.tagClass===1&&h.idBlock.tagNumber===4?a=h.getValue():a=h.valueBlock.valueBeforeDecodeView.slice().buffer;else if(a.byteLength===0)throw new Error("Missed detached data input array")}const f=await n.signWithPrivateKey(a,e,c);o.signature=new ae({valueHex:f})}}lt.CLASS_NAME="SignedData",lt.ID_DATA=vd;const Mn="version",Hn="authSafe",er="macData",Pu="parsedValue",yN=[Mn,Hn,er];class wa extends Q{constructor(e={}){super(),this.version=g(e,Mn,wa.defaultValues(Mn)),this.authSafe=g(e,Hn,wa.defaultValues(Hn)),er in e&&(this.macData=g(e,er,wa.defaultValues(er))),Pu in e&&(this.parsedValue=g(e,Pu,wa.defaultValues(Pu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mn:return 3;case Hn:return new Ie;case er:return new Tt;case Pu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mn:return t===wa.defaultValues(e);case Hn:return Ie.compareWithDefault("contentType",t.contentType)&&Ie.compareWithDefault("content",t.content);case er:return Tt.compareWithDefault("mac",t.mac)&&Tt.compareWithDefault("macSalt",t.macSalt)&&Tt.compareWithDefault("iterations",t.iterations);case Pu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.version||Mn}),Ie.schema(t.authSafe||{names:{blockName:Hn}}),Tt.schema(t.macData||{names:{blockName:er,optional:!0}})]})}fromSchema(e){ee(e,yN);const t=te(e,e,wa.schema({names:{version:Mn,authSafe:{names:{blockName:Hn}},macData:{names:{blockName:er}}}}));G.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new Ie({schema:t.result.authSafe}),er in t.result&&(this.macData=new Tt({schema:t.result.macData}))}toSchema(){const e=[new q({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new D({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=we(!0)){if(Ve.assert(e,"parameters","object"),!this.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(Se.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),Se.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new Se("iterations");Se.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),Se.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),Se.assertEmpty(e.password,"password");const s=new ArrayBuffer(64),a=new Uint8Array(s);t.getRandomValues(a);const n=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new Ie({contentType:Ie.DATA,content:new ae({valueHex:n})});const i=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:s,iterationCount:e.iterations,contentToStamp:n});this.macData=new Tt({mac:new ds({digestAlgorithm:new H({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new ae({valueHex:i})}),macSalt:new ae({valueHex:s}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new Se("signingCertificate");Se.assertEmpty(e.privateKey,"privateKey"),Se.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const s=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new lt({version:1,encapContentInfo:new $t({eContentType:"1.2.840.113549.1.7.1",eContent:new ae({valueHex:s})}),certificates:[e.signingCertificate]}),n=await t.digest({name:e.hashAlgorithm},new Uint8Array(s)),i=[];i.push(new Oe({type:"1.2.840.113549.1.9.3",values:[new le({value:"1.2.840.113549.1.7.1"})]})),i.push(new Oe({type:"1.2.840.113549.1.9.5",values:[new Nm({valueDate:new Date})]})),i.push(new Oe({type:"1.2.840.113549.1.9.4",values:[new ae({valueHex:n})]})),a.signerInfos.push(new He({version:1,sid:new Ge({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new Re({type:0,attributes:i})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new Ie({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw new Error(`Parameter "integrityMode" has unknown value: ${this.parsedValue.integrityMode}`)}}async parseInternalValues(e,t=we(!0)){switch(Ve.assert(e,"parameters","object"),e.checkIntegrity===void 0&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case Ie.DATA:{Se.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,Ve.assert(this.authSafe.content,"authSafe.content",ae);const s=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=ai.fromBER(s),e.checkIntegrity){if(!this.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:Te.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:s,signatureToVerify:Te.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case Ie.SIGNED_DATA:{this.parsedValue.integrityMode=1;const s=new lt({schema:this.authSafe.content}),a=s.encapContentInfo.eContent;Se.assert(a,"eContent","cmsSigned.encapContentInfo"),Ve.assert(a,"eContent",ae);const n=a.getValue();if(this.parsedValue.authenticatedSafe=ai.fromBER(n),!await s.verify({signer:0,checkChain:!1},t))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error(`Incorrect value for "this.authSafe.contentType": ${this.authSafe.contentType}`)}}}wa.CLASS_NAME="PFX";const Uo="status",pa="statusStrings",da="failInfo",wN=[Uo,pa,da];var oy;(function(r){r[r.granted=0]="granted",r[r.grantedWithMods=1]="grantedWithMods",r[r.rejection=2]="rejection",r[r.waiting=3]="waiting",r[r.revocationWarning=4]="revocationWarning",r[r.revocationNotification=5]="revocationNotification"})(oy||(oy={}));class ps extends Q{constructor(e={}){super(),this.status=g(e,Uo,ps.defaultValues(Uo)),pa in e&&(this.statusStrings=g(e,pa,ps.defaultValues(pa))),da in e&&(this.failInfo=g(e,da,ps.defaultValues(da))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uo:return 2;case pa:return[];case da:return new be;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Uo:return t===ps.defaultValues(e);case pa:return t.length===0;case da:return t.isEqual(ps.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||C,value:[new q({name:t.status||C}),new D({optional:!0,value:[new ye({name:t.statusStrings||C,value:new Em})]}),new be({name:t.failInfo||C,optional:!0})]})}fromSchema(e){ee(e,wN);const t=te(e,e,ps.schema({names:{status:Uo,statusStrings:pa,failInfo:da}}));G.assertSchema(t,this.className);const s=t.result.status;if(s.valueBlock.isHexOnly===!0||s.valueBlock.valueDec<0||s.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=s.valueBlock.valueDec,pa in t.result&&(this.statusStrings=t.result.statusStrings),da in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){const e=[];return e.push(new q({value:this.status})),this.statusStrings&&e.push(new D({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new D({value:e})}toJSON(){const e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,t=>t.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}ps.CLASS_NAME="PKIStatusInfo";const Vl="version",Bl="messageImprint",$o="reqPolicy",jo="nonce",tr="certReq",Ko="extensions",hi="TimeStampReq",_p=`${hi}.${Vl}`,Gp=`${hi}.${Bl}`,lm=`${hi}.${$o}`,hm=`${hi}.${jo}`,mm=`${hi}.${tr}`,fm=`${hi}.${Ko}`,vN=[_p,Gp,lm,hm,mm,fm];class _t extends Q{constructor(e={}){super(),this.version=g(e,Vl,_t.defaultValues(Vl)),this.messageImprint=g(e,Bl,_t.defaultValues(Bl)),$o in e&&(this.reqPolicy=g(e,$o,_t.defaultValues($o))),jo in e&&(this.nonce=g(e,jo,_t.defaultValues(jo))),tr in e&&(this.certReq=g(e,tr,_t.defaultValues(tr))),Ko in e&&(this.extensions=g(e,Ko,_t.defaultValues(Ko))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vl:return 0;case Bl:return new At;case $o:return C;case jo:return new q;case tr:return!1;case Ko:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vl:case $o:case tr:return t===_t.defaultValues(e);case Bl:return At.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&At.compareWithDefault("hashedMessage",t.hashedMessage);case jo:return t.isEqual(_t.defaultValues(e));case Ko:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||hi,value:[new q({name:t.version||_p}),At.schema(t.messageImprint||{names:{blockName:Gp}}),new le({name:t.reqPolicy||lm,optional:!0}),new q({name:t.nonce||hm,optional:!0}),new Ra({name:t.certReq||mm,optional:!0}),new j({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ye({name:t.extensions||fm,value:st.schema()})]})]})}fromSchema(e){ee(e,vN);const t=te(e,e,_t.schema());G.assertSchema(t,this.className),this.version=t.result[_p].valueBlock.valueDec,this.messageImprint=new At({schema:t.result[Gp]}),lm in t.result&&(this.reqPolicy=t.result[lm].valueBlock.toString()),hm in t.result&&(this.nonce=t.result[hm]),mm in t.result&&(this.certReq=t.result[mm].valueBlock.value),fm in t.result&&(this.extensions=Array.from(t.result[fm],s=>new st({schema:s})))}toSchema(){const e=[];return e.push(new q({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new le({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),tr in this&&_t.compareWithDefault(tr,this.certReq)===!1&&e.push(new Ra({value:this.certReq})),this.extensions&&e.push(new j({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,t=>t.toSchema())})),new D({value:e})}toJSON(){const e={version:this.version,messageImprint:this.messageImprint.toJSON()};return this.reqPolicy!==void 0&&(e.reqPolicy=this.reqPolicy),this.nonce!==void 0&&(e.nonce=this.nonce.toJSON()),this.certReq!==void 0&&_t.compareWithDefault(tr,this.certReq)===!1&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}}_t.CLASS_NAME="TimeStampReq";const Mo="status",Ho="timeStampToken",xd="TimeStampResp",zp=`${xd}.${Mo}`,pm=`${xd}.${Ho}`,bN=[zp,pm];class Dl extends Q{constructor(e={}){super(),this.status=g(e,Mo,Dl.defaultValues(Mo)),Ho in e&&(this.timeStampToken=g(e,Ho,Dl.defaultValues(Ho))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mo:return new ps;case Ho:return new Ie;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mo:return ps.compareWithDefault(Mo,t.status)&&!("statusStrings"in t)&&!("failInfo"in t);case Ho:return t.contentType===C&&t.content instanceof de;default:return super.defaultValues(e)}}static schema(e={}){const t=g(e,"names",{});return new D({name:t.blockName||xd,value:[ps.schema(t.status||{names:{blockName:zp}}),Ie.schema(t.timeStampToken||{names:{blockName:pm,optional:!0}})]})}fromSchema(e){ee(e,bN);const t=te(e,e,Dl.schema());G.assertSchema(t,this.className),this.status=new ps({schema:t.result[zp]}),pm in t.result&&(this.timeStampToken=new Ie({schema:t.result[pm]}))}toSchema(){const e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new D({value:e})}toJSON(){const e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,s=we(!0)){return this.assertContentType(),new lt({schema:this.timeStampToken.content}).sign(e,0,t,void 0,s)}async verify(e={signer:0,trustedCerts:[],data:We},t=we(!0)){return this.assertContentType(),new lt({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==kw)throw new Error(`Wrong format of timeStampToken: ${this.timeStampToken.contentType}`)}}Dl.CLASS_NAME="TimeStampResp";function SN(){if(typeof globalThis<"u"&&"crypto"in globalThis){let r="webcrypto";"webkitSubtle"in globalThis.crypto&&(r="safari"),qg(r,new ql({name:r,crypto:globalThis.crypto}))}else if(typeof crypto<"u"&&"webcrypto"in crypto){const r="NodeJS ^15",e=crypto.webcrypto;qg(r,new ql({name:r,crypto:e}))}}SN();var lp={exports:{}},uy;function AN(){return uy||(uy=1,function(r,e){const{hasOwnProperty:t}=Object.prototype,s=I();s.configure=I,s.stringify=s,s.default=s,e.stringify=s,e.configure=I,r.exports=s;const a=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]/;function n(p){return p.length<5e3&&!a.test(p)?`"${p}"`:JSON.stringify(p)}function i(p,w){if(p.length>200||w)return p.sort(w);for(let E=1;E<p.length;E++){const O=p[E];let x=E;for(;x!==0&&p[x-1]>O;)p[x]=p[x-1],x--;p[x]=O}return p}const o=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function l(p){return o.call(p)!==void 0&&p.length!==0}function u(p,w,E){p.length<E&&(E=p.length);const O=w===","?"":" ";let x=`"0":${O}${p[0]}`;for(let T=1;T<E;T++)x+=`${w}"${T}":${O}${p[T]}`;return x}function c(p){if(t.call(p,"circularValue")){const w=p.circularValue;if(typeof w=="string")return`"${w}"`;if(w==null)return w;if(w===Error||w===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}function f(p){let w;if(t.call(p,"deterministic")&&(w=p.deterministic,typeof w!="boolean"&&typeof w!="function"))throw new TypeError('The "deterministic" argument must be of type boolean or comparator function');return w===void 0?!0:w}function h(p,w){let E;if(t.call(p,w)&&(E=p[w],typeof E!="boolean"))throw new TypeError(`The "${w}" argument must be of type boolean`);return E===void 0?!0:E}function v(p,w){let E;if(t.call(p,w)){if(E=p[w],typeof E!="number")throw new TypeError(`The "${w}" argument must be of type number`);if(!Number.isInteger(E))throw new TypeError(`The "${w}" argument must be an integer`);if(E<1)throw new RangeError(`The "${w}" argument must be >= 1`)}return E===void 0?1/0:E}function d(p){return p===1?"1 item":`${p} items`}function A(p){const w=new Set;for(const E of p)(typeof E=="string"||typeof E=="number")&&w.add(String(E));return w}function b(p){if(t.call(p,"strict")){const w=p.strict;if(typeof w!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(w)return E=>{let O=`Object can not safely be stringified. Received type ${typeof E}`;throw typeof E!="function"&&(O+=` (${E.toString()})`),new Error(O)}}}function I(p){p={...p};const w=b(p);w&&(p.bigint===void 0&&(p.bigint=!1),"circularValue"in p||(p.circularValue=Error));const E=c(p),O=h(p,"bigint"),x=f(p),T=typeof x=="function"?x:void 0,B=v(p,"maximumDepth"),k=v(p,"maximumBreadth");function J(X,K,W,ne,se,Z){let _=K[X];switch(typeof _=="object"&&_!==null&&typeof _.toJSON=="function"&&(_=_.toJSON(X)),_=ne.call(K,X,_),typeof _){case"string":return n(_);case"object":{if(_===null)return"null";if(W.indexOf(_)!==-1)return E;let z="",oe=",";const ce=Z;if(Array.isArray(_)){if(_.length===0)return"[]";if(B<W.length+1)return'"[Array]"';W.push(_),se!==""&&(Z+=se,z+=`
${Z}`,oe=`,
${Z}`);const R=Math.min(_.length,k);let me=0;for(;me<R-1;me++){const he=J(String(me),_,W,ne,se,Z);z+=he!==void 0?he:"null",z+=oe}const ge=J(String(me),_,W,ne,se,Z);if(z+=ge!==void 0?ge:"null",_.length-1>k){const he=_.length-k-1;z+=`${oe}"... ${d(he)} not stringified"`}return se!==""&&(z+=`
${ce}`),W.pop(),`[${z}]`}let ue=Object.keys(_);const fe=ue.length;if(fe===0)return"{}";if(B<W.length+1)return'"[Object]"';let V="",S="";se!==""&&(Z+=se,oe=`,
${Z}`,V=" ");const $=Math.min(fe,k);x&&!l(_)&&(ue=i(ue,T)),W.push(_);for(let R=0;R<$;R++){const me=ue[R],ge=J(me,_,W,ne,se,Z);ge!==void 0&&(z+=`${S}${n(me)}:${V}${ge}`,S=oe)}if(fe>k){const R=fe-k;z+=`${S}"...":${V}"${d(R)} not stringified"`,S=oe}return se!==""&&S.length>1&&(z=`
${Z}${z}
${ce}`),W.pop(),`{${z}}`}case"number":return isFinite(_)?String(_):w?w(_):"null";case"boolean":return _===!0?"true":"false";case"undefined":return;case"bigint":if(O)return String(_);default:return w?w(_):void 0}}function F(X,K,W,ne,se,Z){switch(typeof K=="object"&&K!==null&&typeof K.toJSON=="function"&&(K=K.toJSON(X)),typeof K){case"string":return n(K);case"object":{if(K===null)return"null";if(W.indexOf(K)!==-1)return E;const _=Z;let z="",oe=",";if(Array.isArray(K)){if(K.length===0)return"[]";if(B<W.length+1)return'"[Array]"';W.push(K),se!==""&&(Z+=se,z+=`
${Z}`,oe=`,
${Z}`);const fe=Math.min(K.length,k);let V=0;for(;V<fe-1;V++){const $=F(String(V),K[V],W,ne,se,Z);z+=$!==void 0?$:"null",z+=oe}const S=F(String(V),K[V],W,ne,se,Z);if(z+=S!==void 0?S:"null",K.length-1>k){const $=K.length-k-1;z+=`${oe}"... ${d($)} not stringified"`}return se!==""&&(z+=`
${_}`),W.pop(),`[${z}]`}W.push(K);let ce="";se!==""&&(Z+=se,oe=`,
${Z}`,ce=" ");let ue="";for(const fe of ne){const V=F(fe,K[fe],W,ne,se,Z);V!==void 0&&(z+=`${ue}${n(fe)}:${ce}${V}`,ue=oe)}return se!==""&&ue.length>1&&(z=`
${Z}${z}
${_}`),W.pop(),`{${z}}`}case"number":return isFinite(K)?String(K):w?w(K):"null";case"boolean":return K===!0?"true":"false";case"undefined":return;case"bigint":if(O)return String(K);default:return w?w(K):void 0}}function P(X,K,W,ne,se){switch(typeof K){case"string":return n(K);case"object":{if(K===null)return"null";if(typeof K.toJSON=="function"){if(K=K.toJSON(X),typeof K!="object")return P(X,K,W,ne,se);if(K===null)return"null"}if(W.indexOf(K)!==-1)return E;const Z=se;if(Array.isArray(K)){if(K.length===0)return"[]";if(B<W.length+1)return'"[Array]"';W.push(K),se+=ne;let V=`
${se}`;const S=`,
${se}`,$=Math.min(K.length,k);let R=0;for(;R<$-1;R++){const ge=P(String(R),K[R],W,ne,se);V+=ge!==void 0?ge:"null",V+=S}const me=P(String(R),K[R],W,ne,se);if(V+=me!==void 0?me:"null",K.length-1>k){const ge=K.length-k-1;V+=`${S}"... ${d(ge)} not stringified"`}return V+=`
${Z}`,W.pop(),`[${V}]`}let _=Object.keys(K);const z=_.length;if(z===0)return"{}";if(B<W.length+1)return'"[Object]"';se+=ne;const oe=`,
${se}`;let ce="",ue="",fe=Math.min(z,k);l(K)&&(ce+=u(K,oe,k),_=_.slice(K.length),fe-=K.length,ue=oe),x&&(_=i(_,T)),W.push(K);for(let V=0;V<fe;V++){const S=_[V],$=P(S,K[S],W,ne,se);$!==void 0&&(ce+=`${ue}${n(S)}: ${$}`,ue=oe)}if(z>k){const V=z-k;ce+=`${ue}"...": "${d(V)} not stringified"`,ue=oe}return ue!==""&&(ce=`
${se}${ce}
${Z}`),W.pop(),`{${ce}}`}case"number":return isFinite(K)?String(K):w?w(K):"null";case"boolean":return K===!0?"true":"false";case"undefined":return;case"bigint":if(O)return String(K);default:return w?w(K):void 0}}function U(X,K,W){switch(typeof K){case"string":return n(K);case"object":{if(K===null)return"null";if(typeof K.toJSON=="function"){if(K=K.toJSON(X),typeof K!="object")return U(X,K,W);if(K===null)return"null"}if(W.indexOf(K)!==-1)return E;let ne="";const se=K.length!==void 0;if(se&&Array.isArray(K)){if(K.length===0)return"[]";if(B<W.length+1)return'"[Array]"';W.push(K);const ce=Math.min(K.length,k);let ue=0;for(;ue<ce-1;ue++){const V=U(String(ue),K[ue],W);ne+=V!==void 0?V:"null",ne+=","}const fe=U(String(ue),K[ue],W);if(ne+=fe!==void 0?fe:"null",K.length-1>k){const V=K.length-k-1;ne+=`,"... ${d(V)} not stringified"`}return W.pop(),`[${ne}]`}let Z=Object.keys(K);const _=Z.length;if(_===0)return"{}";if(B<W.length+1)return'"[Object]"';let z="",oe=Math.min(_,k);se&&l(K)&&(ne+=u(K,",",k),Z=Z.slice(K.length),oe-=K.length,z=","),x&&(Z=i(Z,T)),W.push(K);for(let ce=0;ce<oe;ce++){const ue=Z[ce],fe=U(ue,K[ue],W);fe!==void 0&&(ne+=`${z}${n(ue)}:${fe}`,z=",")}if(_>k){const ce=_-k;ne+=`${z}"...":"${d(ce)} not stringified"`}return W.pop(),`{${ne}}`}case"number":return isFinite(K)?String(K):w?w(K):"null";case"boolean":return K===!0?"true":"false";case"undefined":return;case"bigint":if(O)return String(K);default:return w?w(K):void 0}}function re(X,K,W){if(arguments.length>1){let ne="";if(typeof W=="number"?ne=" ".repeat(Math.min(W,10)):typeof W=="string"&&(ne=W.slice(0,10)),K!=null){if(typeof K=="function")return J("",{"":X},[],K,ne,"");if(Array.isArray(K))return F("",X,[],A(K),ne,"")}if(ne.length!==0)return P("",X,[],ne,"")}return U("",X,[])}return re}}(lp,lp.exports)),lp.exports}var NN=AN();const Od=Sy(NN);Od.configure;var cy={},EN=function(r,e,t,s,a){var n=new Worker(cy[e]||(cy[e]=URL.createObjectURL(new Blob([r+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return n.onmessage=function(i){var o=i.data,l=o.$e$;if(l){var u=new Error(l[0]);u.code=l[1],u.stack=l[2],a(u,null)}else a(null,o)},n.postMessage(t,s),n},it=Uint8Array,Mt=Uint16Array,Ql=Int32Array,mu=new it([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fu=new it([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Gl=new it([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rw=function(r,e){for(var t=new Mt(31),s=0;s<31;++s)t[s]=e+=1<<r[s-1];for(var a=new Ql(t[30]),s=1;s<30;++s)for(var n=t[s];n<t[s+1];++n)a[n]=n-t[s]<<5|s;return{b:t,r:a}},Uw=Rw(mu,2),Pd=Uw.b,Jm=Uw.r;Pd[28]=258,Jm[258]=28;for(var ly=Rw(fu,0),$w=ly.b,Xp=ly.r,zl=new Mt(32768),Ue=0;Ue<32768;++Ue){var Br=(Ue&43690)>>1|(Ue&21845)<<1;Br=(Br&52428)>>2|(Br&13107)<<2,Br=(Br&61680)>>4|(Br&3855)<<4,zl[Ue]=((Br&65280)>>8|(Br&255)<<8)>>1}for(var ys=function(e,t,s){for(var a=e.length,n=0,i=new Mt(t);n<a;++n)e[n]&&++i[e[n]-1];var o=new Mt(t);for(n=1;n<t;++n)o[n]=o[n-1]+i[n-1]<<1;var l;if(s){l=new Mt(1<<t);var u=15-t;for(n=0;n<a;++n)if(e[n])for(var c=n<<4|e[n],f=t-e[n],h=o[e[n]-1]++<<f,v=h|(1<<f)-1;h<=v;++h)l[zl[h]>>u]=c}else for(l=new Mt(a),n=0;n<a;++n)e[n]&&(l[n]=zl[o[e[n]-1]++]>>15-e[n]);return l},yr=new it(288),Ue=0;Ue<144;++Ue)yr[Ue]=8;for(var Ue=144;Ue<256;++Ue)yr[Ue]=9;for(var Ue=256;Ue<280;++Ue)yr[Ue]=7;for(var Ue=280;Ue<288;++Ue)yr[Ue]=8;for(var uu=new it(32),Ue=0;Ue<32;++Ue)uu[Ue]=5;var jw=ys(yr,9,0),Kw=ys(yr,9,1),Mw=ys(uu,5,0),Hw=ys(uu,5,1),dm=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},os=function(r,e,t){var s=e/8|0;return(r[s]|r[s+1]<<8)>>(e&7)&t},gm=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Zl=function(r){return(r+7)/8|0},sf=function(r,e,t){return(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length),new it(r.subarray(e,t))},Jw=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Wt=function(r,e,t){var s=new Error(e||Jw[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,Wt),!t)throw s;return s},Dd=function(r,e,t,s){var a=r.length,n=s?s.length:0;if(!a||e.f&&!e.l)return t||new it(0);var i=!t,o=i||e.i!=2,l=e.i;i&&(t=new it(a*3));var u=function(me){var ge=t.length;if(me>ge){var he=new it(Math.max(ge*2,me));he.set(t),t=he}},c=e.f||0,f=e.p||0,h=e.b||0,v=e.l,d=e.d,A=e.m,b=e.n,I=a*8;do{if(!v){c=os(r,f,1);var p=os(r,f+1,3);if(f+=3,p)if(p==1)v=Kw,d=Hw,A=9,b=5;else if(p==2){var w=os(r,f,31)+257,E=os(r,f+10,15)+4,O=w+os(r,f+5,31)+1;f+=14;for(var x=new it(O),T=new it(19),B=0;B<E;++B)T[Gl[B]]=os(r,f+B*3,7);f+=E*3;for(var k=dm(T),J=(1<<k)-1,F=ys(T,k,1),B=0;B<O;){var P=F[os(r,f,J)];f+=P&15;var U=P>>4;if(U<16)x[B++]=U;else{var re=0,X=0;for(U==16?(X=3+os(r,f,3),f+=2,re=x[B-1]):U==17?(X=3+os(r,f,7),f+=3):U==18&&(X=11+os(r,f,127),f+=7);X--;)x[B++]=re}}var K=x.subarray(0,w),W=x.subarray(w);A=dm(K),b=dm(W),v=ys(K,A,1),d=ys(W,b,1)}else Wt(1);else{var U=Zl(f)+4,ne=r[U-4]|r[U-3]<<8,se=U+ne;if(se>a){l&&Wt(0);break}o&&u(h+ne),t.set(r.subarray(U,se),h),e.b=h+=ne,e.p=f=se*8,e.f=c;continue}if(f>I){l&&Wt(0);break}}o&&u(h+131072);for(var Z=(1<<A)-1,_=(1<<b)-1,z=f;;z=f){var re=v[gm(r,f)&Z],oe=re>>4;if(f+=re&15,f>I){l&&Wt(0);break}if(re||Wt(2),oe<256)t[h++]=oe;else if(oe==256){z=f,v=null;break}else{var ce=oe-254;if(oe>264){var B=oe-257,ue=mu[B];ce=os(r,f,(1<<ue)-1)+Pd[B],f+=ue}var fe=d[gm(r,f)&_],V=fe>>4;fe||Wt(3),f+=fe&15;var W=$w[V];if(V>3){var ue=fu[V];W+=gm(r,f)&(1<<ue)-1,f+=ue}if(f>I){l&&Wt(0);break}o&&u(h+131072);var S=h+ce;if(h<W){var $=n-W,R=Math.min(W,S);for($+h<0&&Wt(3);h<R;++h)t[h]=s[$+h]}for(;h<S;++h)t[h]=t[h-W]}}e.l=v,e.p=z,e.b=h,e.f=c,v&&(c=1,e.m=A,e.d=d,e.n=b)}while(!c);return h!=t.length&&i?sf(t,0,h):t.subarray(0,h)},Ds=function(r,e,t){t<<=e&7;var s=e/8|0;r[s]|=t,r[s+1]|=t>>8},Jo=function(r,e,t){t<<=e&7;var s=e/8|0;r[s]|=t,r[s+1]|=t>>8,r[s+2]|=t>>16},ym=function(r,e){for(var t=[],s=0;s<r.length;++s)r[s]&&t.push({s,f:r[s]});var a=t.length,n=t.slice();if(!a)return{t:Ld,l:0};if(a==1){var i=new it(t[0].s+1);return i[t[0].s]=1,{t:i,l:1}}t.sort(function(O,x){return O.f-x.f}),t.push({s:-1,f:25001});var o=t[0],l=t[1],u=0,c=1,f=2;for(t[0]={s:-1,f:o.f+l.f,l:o,r:l};c!=a-1;)o=t[t[u].f<t[f].f?u++:f++],l=t[u!=c&&t[u].f<t[f].f?u++:f++],t[c++]={s:-1,f:o.f+l.f,l:o,r:l};for(var h=n[0].s,s=1;s<a;++s)n[s].s>h&&(h=n[s].s);var v=new Mt(h+1),d=Fm(t[c-1],v,0);if(d>e){var s=0,A=0,b=d-e,I=1<<b;for(n.sort(function(x,T){return v[T.s]-v[x.s]||x.f-T.f});s<a;++s){var p=n[s].s;if(v[p]>e)A+=I-(1<<d-v[p]),v[p]=e;else break}for(A>>=b;A>0;){var w=n[s].s;v[w]<e?A-=1<<e-v[w]++-1:++s}for(;s>=0&&A;--s){var E=n[s].s;v[E]==e&&(--v[E],++A)}d=e}return{t:new it(v),l:d}},Fm=function(r,e,t){return r.s==-1?Math.max(Fm(r.l,e,t+1),Fm(r.r,e,t+1)):e[r.s]=t},Yp=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new Mt(++e),s=0,a=r[0],n=1,i=function(l){t[s++]=l},o=1;o<=e;++o)if(r[o]==a&&o!=e)++n;else{if(!a&&n>2){for(;n>138;n-=138)i(32754);n>2&&(i(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(i(a),--n;n>6;n-=6)i(8304);n>2&&(i(n-3<<5|8208),n=0)}for(;n--;)i(a);n=1,a=r[o]}return{c:t.subarray(0,s),n:e}},Fo=function(r,e){for(var t=0,s=0;s<e.length;++s)t+=r[s]*e[s];return t},Td=function(r,e,t){var s=t.length,a=Zl(e+2);r[a]=s&255,r[a+1]=s>>8,r[a+2]=r[a]^255,r[a+3]=r[a+1]^255;for(var n=0;n<s;++n)r[a+n+4]=t[n];return(a+4+s)*8},Qp=function(r,e,t,s,a,n,i,o,l,u,c){Ds(e,c++,t),++a[256];for(var f=ym(a,15),h=f.t,v=f.l,d=ym(n,15),A=d.t,b=d.l,I=Yp(h),p=I.c,w=I.n,E=Yp(A),O=E.c,x=E.n,T=new Mt(19),B=0;B<p.length;++B)++T[p[B]&31];for(var B=0;B<O.length;++B)++T[O[B]&31];for(var k=ym(T,7),J=k.t,F=k.l,P=19;P>4&&!J[Gl[P-1]];--P);var U=u+5<<3,re=Fo(a,yr)+Fo(n,uu)+i,X=Fo(a,h)+Fo(n,A)+i+14+3*P+Fo(T,J)+2*T[16]+3*T[17]+7*T[18];if(l>=0&&U<=re&&U<=X)return Td(e,c,r.subarray(l,l+u));var K,W,ne,se;if(Ds(e,c,1+(X<re)),c+=2,X<re){K=ys(h,v,0),W=h,ne=ys(A,b,0),se=A;var Z=ys(J,F,0);Ds(e,c,w-257),Ds(e,c+5,x-1),Ds(e,c+10,P-4),c+=14;for(var B=0;B<P;++B)Ds(e,c+3*B,J[Gl[B]]);c+=3*P;for(var _=[p,O],z=0;z<2;++z)for(var oe=_[z],B=0;B<oe.length;++B){var ce=oe[B]&31;Ds(e,c,Z[ce]),c+=J[ce],ce>15&&(Ds(e,c,oe[B]>>5&127),c+=oe[B]>>12)}}else K=jw,W=yr,ne=Mw,se=uu;for(var B=0;B<o;++B){var ue=s[B];if(ue>255){var ce=ue>>18&31;Jo(e,c,K[ce+257]),c+=W[ce+257],ce>7&&(Ds(e,c,ue>>23&31),c+=mu[ce]);var fe=ue&31;Jo(e,c,ne[fe]),c+=se[fe],fe>3&&(Jo(e,c,ue>>5&8191),c+=fu[fe])}else Jo(e,c,K[ue]),c+=W[ue]}return Jo(e,c,K[256]),c+W[256]},Fw=new Ql([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ld=new it(0),qw=function(r,e,t,s,a,n){var i=n.z||r.length,o=new it(s+i+5*(1+Math.ceil(i/7e3))+a),l=o.subarray(s,o.length-a),u=n.l,c=(n.r||0)&7;if(e){c&&(l[0]=n.r>>3);for(var f=Fw[e-1],h=f>>13,v=f&8191,d=(1<<t)-1,A=n.p||new Mt(32768),b=n.h||new Mt(d+1),I=Math.ceil(t/3),p=2*I,w=function(Ze){return(r[Ze]^r[Ze+1]<<I^r[Ze+2]<<p)&d},E=new Ql(25e3),O=new Mt(288),x=new Mt(32),T=0,B=0,k=n.i||0,J=0,F=n.w||0,P=0;k+2<i;++k){var U=w(k),re=k&32767,X=b[U];if(A[re]=X,b[U]=re,F<=k){var K=i-k;if((T>7e3||J>24576)&&(K>423||!u)){c=Qp(r,l,0,E,O,x,B,J,P,k-P,c),J=T=B=0,P=k;for(var W=0;W<286;++W)O[W]=0;for(var W=0;W<30;++W)x[W]=0}var ne=2,se=0,Z=v,_=re-X&32767;if(K>2&&U==w(k-_))for(var z=Math.min(h,K)-1,oe=Math.min(32767,k),ce=Math.min(258,K);_<=oe&&--Z&&re!=X;){if(r[k+ne]==r[k+ne-_]){for(var ue=0;ue<ce&&r[k+ue]==r[k+ue-_];++ue);if(ue>ne){if(ne=ue,se=_,ue>z)break;for(var fe=Math.min(_,ue-2),V=0,W=0;W<fe;++W){var S=k-_+W&32767,$=A[S],R=S-$&32767;R>V&&(V=R,X=S)}}}re=X,X=A[re],_+=re-X&32767}if(se){E[J++]=268435456|Jm[ne]<<18|Xp[se];var me=Jm[ne]&31,ge=Xp[se]&31;B+=mu[me]+fu[ge],++O[257+me],++x[ge],F=k+ne,++T}else E[J++]=r[k],++O[r[k]]}}for(k=Math.max(k,F);k<i;++k)E[J++]=r[k],++O[r[k]];c=Qp(r,l,u,E,O,x,B,J,P,k-P,c),u||(n.r=c&7|l[c/8|0]<<3,c-=7,n.h=b,n.p=A,n.i=k,n.w=F)}else{for(var k=n.w||0;k<i+u;k+=65535){var he=k+65535;he>=i&&(l[c/8|0]=u,he=i),c=Td(l,c+1,r.subarray(k,he))}n.i=i}return sf(o,0,s+Zl(c)+a)},Ww=function(){for(var r=new Int32Array(256),e=0;e<256;++e){for(var t=e,s=9;--s;)t=(t&1&&-306674912)^t>>>1;r[e]=t}return r}(),_w=function(){var r=-1;return{p:function(e){for(var t=r,s=0;s<e.length;++s)t=Ww[t&255^e[s]]^t>>>8;r=t},d:function(){return~r}}},Rd=function(r,e,t,s,a){if(!a&&(a={l:1},e.dictionary)){var n=e.dictionary.subarray(-32768),i=new it(n.length+r.length);i.set(n),i.set(r,n.length),r=i,a.w=n.length}return qw(r,e.level==null?6:e.level,e.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+e.mem,t,s,a)},CN=function(r,e){var t={};for(var s in r)t[s]=r[s];for(var s in e)t[s]=e[s];return t},hy=function(r,e,t){for(var s=r(),a=r.toString(),n=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/\s+/g,"").split(","),i=0;i<s.length;++i){var o=s[i],l=n[i];if(typeof o=="function"){e+=";"+l+"=";var u=o.toString();if(o.prototype)if(u.indexOf("[native code]")!=-1){var c=u.indexOf(" ",8)+1;e+=u.slice(c,u.indexOf("(",c))}else{e+=u;for(var f in o.prototype)e+=";"+l+".prototype."+f+"="+o.prototype[f].toString()}else e+=u}else t[l]=o}return e},Lh=[],kN=function(r){var e=[];for(var t in r)r[t].buffer&&e.push((r[t]=new r[t].constructor(r[t])).buffer);return e},IN=function(r,e,t,s){if(!Lh[t]){for(var a="",n={},i=r.length-1,o=0;o<i;++o)a=hy(r[o],a,n);Lh[t]={c:hy(r[i],a,n),e:n}}var l=CN({},Lh[t].e);return EN(Lh[t].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,l,kN(l),s)},VN=function(){return[it,Mt,Ql,mu,fu,Gl,Pd,$w,Kw,Hw,zl,Jw,ys,dm,os,gm,Zl,sf,Wt,Dd,TN,rf,PN]},BN=function(){return[it,Mt,Ql,mu,fu,Gl,Jm,Xp,jw,yr,Mw,uu,zl,Fw,Ld,ys,Ds,Jo,ym,Fm,Yp,Fo,Td,Qp,Zl,sf,qw,Rd,DN,rf]},xN=function(){return[zw,Qw,qm,_w,Ww]},ON=function(){return[Xw,Yw]},rf=function(r){return postMessage(r,[r.buffer])},PN=function(r){return r&&{out:r.size&&new it(r.size),dictionary:r.dictionary}},Gw=function(r,e,t,s,a,n){var i=IN(t,s,a,function(o,l){i.terminate(),n(o,l)});return i.postMessage([r,e],e.consume?[r.buffer]:[]),function(){i.terminate()}},qm=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8},zw=function(r,e){var t=e.filename;if(r[0]=31,r[1]=139,r[2]=8,r[8]=e.level<2?4:e.level==9?2:0,r[9]=3,e.mtime!=0&&qm(r,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){r[3]=8;for(var s=0;s<=t.length;++s)r[s+10]=t.charCodeAt(s)}},Xw=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Wt(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!r[t++]);return t+(e&2)},Yw=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Qw=function(r){return 10+(r.filename?r.filename.length+1:0)};function DN(r,e){return Rd(r,e||{},0,0)}function TN(r,e){return Dd(r,{i:2},e&&e.out,e&&e.dictionary)}function LN(r,e,t){return t||(t=e,e={}),typeof t!="function"&&Wt(7),Gw(r,e,[BN,xN,function(){return[my]}],function(s){return rf(my(s.data[0],s.data[1]))},2,t)}function my(r,e){e||(e={});var t=_w(),s=r.length;t.p(r);var a=Rd(r,e,Qw(e),8),n=a.length;return zw(a,e),qm(a,n-8,t.d()),qm(a,n-4,s),a}function RN(r,e,t){return t||(t=e,e={}),typeof t!="function"&&Wt(7),Gw(r,e,[VN,ON,function(){return[fy]}],function(s){return rf(fy(s.data[0],s.data[1]))},3,t)}function fy(r,e){var t=Xw(r);return t+8>r.length&&Wt(6,"invalid gzip data"),Dd(r.subarray(t,-8),{i:2},e&&e.out||new it(Yw(r)),e&&e.dictionary)}var UN=typeof TextDecoder<"u"&&new TextDecoder,$N=0;try{UN.decode(Ld,{stream:!0}),$N=1}catch{}function jN(r){const{promise:e,resolve:t,reject:s}=Promise.withResolvers();return RN(r,{consume:!0},(a,n)=>{a&&(Ne.error("Error decompressing data",{error:a}),s(a)),t(new Uint8Array(n))}),e}function KN(r){const{promise:e,resolve:t,reject:s}=Promise.withResolvers();return LN(r,{consume:!0},(a,n)=>{a&&(Ne.error("Error compressing data",{error:a}),s(a)),t(new Uint8Array(n))}),e}async function Zw(r,e,t={}){const s=self.crypto.getRandomValues(new Uint8Array(12)),a=await self.crypto.subtle.encrypt({name:"AES-GCM",iv:s,tagLength:128,...t},e,r),n=new Uint8Array(a.slice(-16));return{encryptedContent:new Uint8Array(a),iv:s,tag:n}}async function Ud(r,e,t={}){return await self.crypto.subtle.decrypt({name:"AES-GCM",tagLength:128,...t},e,r)}async function MN(r,e){return await self.crypto.subtle.decrypt({name:"RSA-OAEP"},e,r)}async function e0(r){return await self.crypto.subtle.importKey("raw",r,{name:"AES-GCM",length:128},!0,["decrypt","encrypt"])}async function HN(r,e){return await self.crypto.subtle.importKey("spki",r,{name:"RSASSA-PKCS1-v1_5",hash:e},!0,["verify"])}async function JN(r){return await self.crypto.subtle.importKey("pkcs8",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])}async function FN(r){return new Uint8Array(await self.crypto.subtle.exportKey("raw",r))}async function t0(r){const e=await self.crypto.subtle.digest("SHA-256",r);return ab(new Uint8Array(e))}async function s0(r,e){const t=await HN(fd(e),r.signatureAlgorithm.hash.name);return r.verify({publicKey:t},qN())}function qN(){return{...self.crypto,subtle:{...self.crypto.subtle,async verify(r,e,t,s){return self.crypto.subtle.verify(r,e,new Uint8Array(t),new Uint8Array(s))}}}}async function WN(r,e,t){const s=Ie.fromBER(e),a=new lt({schema:s.content}),n=a.signerInfos[0];if(n===void 0)throw new Error("Signer not found in the users array");const i=n.sid.issuer.typesAndValues.find(({type:u})=>u==="2.5.4.3").value.valueBlock.value,o=t.find(({userId:u})=>u===i);if(o===void 0)throw new Error("Signer not found in the users array");const l=Ae.fromBER(fd(o.certificate));return await a.verify({signer:0,trustedCerts:[l],data:r.buffer,checkChain:!0},GN())}class _N extends ql{verify(e,t,s,a){return super.verify(e,t,s,new Uint8Array(a))}}function GN(){return new _N({crypto:self.crypto})}async function zN(){return await self.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["encrypt","decrypt"])}async function XN(r,e){if(!r.extractable)throw new Error("Private key is not extractable");e=e.toLowerCase().replaceAll(/\s+/g,"");const t=self.crypto.getRandomValues(new Uint8Array(40)),s=await wm(e,t,{hash:"SHA-256",iterations:6e5}),a=new Uint8Array(await self.crypto.subtle.exportKey("pkcs8",r)),n=nb(a,"private"),i=Kl(Na(Kl(n))),{encryptedContent:o,iv:l}=await Zw(i,s,{tagLength:128});return{encryptedPrivateKey:o,iv:l,salt:t}}async function r0(r,e){Ne.debug("Decrypting private key",{privateKeyInfo:r,mnemonic:e});const t=await Promise.all([await wm(e,r.salt,{hash:"SHA-256",iterations:6e5}),await wm(e,r.salt,{hash:"SHA-1",iterations:1024}),await wm(e,r.salt,{hash:"SHA-1",iterations:6e5})]);for(const s of t)try{const a=await Ud(r.encryptedPrivateKey,s,{iv:r.iv,tagLength:128}).then(Cp).then(rs).then(Cp).then(fd);return JN(a)}catch(a){Ne.debug("Failed to decrypt private key with mnemonic",{error:a})}throw new Error("Failed to decrypt private key")}async function a0(r){const e={...await self.crypto.subtle.exportKey("jwk",r),alg:"RS256",key_ops:["sign"],kty:"RSA"};return await self.crypto.subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},!0,["sign"])}async function wm(r,e,t){const s=await crypto.subtle.importKey("raw",new TextEncoder().encode(r.replaceAll(" ","")),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:e,...t},s,{name:"AES-GCM",length:256},!0,["decrypt","encrypt"])}class Wm{#t;#s;#a;#e;#r="2.0";constructor(e){this.#s=e,this.#e={},this.#a=[]}async addUser(e,t){Ne.debug(`Adding user ${e} to folder metadata`);let s=await t.publicKey.export();s.usages.includes("encrypt")||(s=await globalThis.crypto.subtle.importKey("jwk",{...await globalThis.crypto.subtle.exportKey("jwk",s),key_ops:["encrypt"],alg:"RSA-OAEP-256"},{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]));const{encryptedMetadataKey:a,keyChecksum:n}=await this.#i(s);this.#a.push({userId:e,certificate:t.toString("pem"),encryptedMetadataKey:a}),this.#t.keyChecksums.push(n)}getUsers(){return this.#a.map(e=>e.userId)}getFile(e){return this.#t?.files[e]}addFile(e,t){this.#t.files[e]=t}async export(e){if(e.privateKey===void 0)throw new Error("Certificate does not have a private key for signing");const t=await this.#n(),s=await this.#u(e,t);return{metadata:t,signature:s}}async#n(){const e=JSON.stringify(this.#t),t=await KN(Kl(e)),{encryptedContent:s,tag:a,iv:n}=await Zw(t,this.#s);return{metadata:{ciphertext:Na(s),nonce:Na(n),authenticationTag:Na(a)},filedrop:this.#e,users:this.#a,version:this.#r}}async#u(e,t){delete t.filedrop;const s=Kl(btoa(Od(t))),a=Ae.fromBER(e.rawData),n=new lt({version:1,certificates:[a],encapContentInfo:new $t({eContentType:Ie.DATA}),signerInfos:[new He({sid:new Ge({issuer:a.issuer,serialNumber:a.serialNumber}),signatureAlgorithm:a.signatureAlgorithm,digestAlgorithm:new H({algorithmId:"sha-256"}),signedAttrs:new Re({type:0,attributes:[new Oe({type:"1.2.840.113549.1.9.3",values:[new le({value:Ie.DATA})]}),new Oe({type:"1.2.840.113549.1.9.4",values:[new ae({valueHex:await globalThis.crypto.subtle.digest("SHA-256",s)})]}),new Oe({type:"1.2.840.113549.1.9.5",values:[new Nm({valueDate:new Date})]})]})})]}),i=await a0(e.privateKey);return await n.sign(i,0,"SHA-256",s),new Ie({contentType:Ie.SIGNED_DATA,content:n.toSchema(!0)}).toString("base64")}async#i(e){if(!this.#s)throw new Error("Metadata key is not set");const t=await globalThis.crypto.subtle.exportKey("raw",this.#s),s=await globalThis.crypto.subtle.encrypt({name:"RSA-OAEP"},e,t);return{encryptedMetadataKey:Na(new Uint8Array(s)),keyChecksum:await t0(new Uint8Array(t))}}static async fromJson(e,t,s){const a=JSON.parse(e),n=a.users.find(c=>c.userId===t);if(!n)throw new Error("Current user has no access to this folder");const i=await globalThis.crypto.subtle.decrypt({name:"RSA-OAEP"},s,rs(n.encryptedMetadataKey)),o=await globalThis.crypto.subtle.importKey("raw",i,{name:"AES-GCM",length:128},!1,["decrypt","encrypt"]),l=await globalThis.crypto.subtle.decrypt({name:"AES-GCM",iv:rs(a.metadata.nonce),tagLength:128},s,rs(n.encryptedMetadataKey)).then(c=>jN(new Uint8Array(c))).then(c=>Cp(c)),u=new Wm(o);return u.#a=a.users,u.#e=a.filedrop,u.#t=JSON.parse(l),u}static async createNew(){const e=await globalThis.crypto.subtle.generateKey({name:"AES-GCM",length:128},!0,["encrypt","decrypt"]),t=new Wm(e);return t.#t={keyChecksums:[],counter:0,deleted:!1,folders:{},files:{}},t}}async function YN(r,e,t){const s=wg(e.path,r),a=(await Ms.request({method:"MKCOL",url:rw+wg(Sv,s)})).headers["oc-fileid"].split("oc")[0];if(!a)throw new Error("Could not retrieve fileid for newly created folder");const n=Number.parseInt(a);await cb(n);const i=await lb(n,1);try{const o=await Wm.createNew();await o.addUser(cu().uid,t);const{metadata:l,signature:u}=await o.export(t);return await mb(n,JSON.stringify(l),i,u),n}finally{await hb(n,i)}}let su,ss;function QN(){if(!(!ss||!ss.privateKey))return ss}async function ZN(r){ss=r,await ss.publicKey.export()}async function eE(){if(!ss){const r=await ob();if(!r)return!1;ss=new ed(r),su&&(ss.privateKey=su),await ss.publicKey.export()}return!0}async function n0(r){if(!su){const e=await uw();if(e===null)return!1;su=await r0(e,r),ss&&(ss.privateKey=su)}return!0}function tE(r){ss&&(ss.privateKey=r),su=r}const af=Symbol.for("CreateFolderDialogContext"),sE=oi({__name:"CreateFolderDialogStepFolderName",props:pp({content:{},context:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:pp(["folderCreated"],["update:modelValue"]),setup(r,{emit:e}){const t=Gm(r,"modelValue"),s=r,a=e,{buttonLabel:n,onContinue:i}=Zp(af);zm(()=>{n.value=Ce("end_to_end_encryption","Create folder"),t.value=!1,i.value=c});const o=es(""),l=bm(()=>{if(o.value.trim().length===0)return Ce("end_to_end_encryption","Folder name cannot be empty");if(s.content.find(f=>f.basename===o.value.trim()))return Ce("end_to_end_encryption","A folder with this name already exists");try{Hv(o.value.trim())}catch(f){const h=f;return h.reason===Ep.Character?Ce("end_to_end_encryption",'"{char}" is not allowed in folder names',{char:h.segment}):h.reason===Ep.Extension?Ce("end_to_end_encryption",'Folder name cannot end with "{extension}"',{extension:h.segment}):Ce("end_to_end_encryption","Folder name is invalid")}return""}),u=bm(()=>o.value.trim().length>0&&l.value==="");N0(u,f=>{t.value=f});async function c(){if(!u.value)return;t.value=!1,n.value=Ce("end_to_end_encryption","Creating folder …");const f=await YN(o.value.trim(),s.context,QN()),h=new Qm({id:f,owner:cu().uid,source:s.context.source+"/"+o.value.trim(),attributes:{"is-encrypted":1}});return a("folderCreated",h),!0}return(f,h)=>(St(),rr(xe(E0),{modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=v=>o.value=v),error:o.value.length>0&&l.value.length>0,"helper-text":l.value,label:xe(Ce)("end_to_end_encryption","Folder name"),"max-length":"250","min-length":"1",required:""},null,8,["modelValue","error","helper-text","label"]))}}),Tl=C0("end_to_end_encryption").persist(!1).build(),Ll=Object.freeze({SuppressBrowserWarning:"suppress_browser_warning",Mnemonic:"mnemonic"}),i0=oi({__name:"BrowserWarning",props:pp({heading:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=Gm(r,"modelValue"),t=es(Tl.getItem(Ll.SuppressBrowserWarning)==="true");return Ny(()=>{t.value?(e.value=!0,Tl.setItem(Ll.SuppressBrowserWarning,"true")):Tl.removeItem(Ll.SuppressBrowserWarning)}),(s,a)=>(St(),rr(xe(k0),{heading:r.heading,"show-alert":"",type:"warning"},{default:Aa(()=>[Oa(Rs(xe(Ce)("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" ",1),ni(xe(Wd),{modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=n=>e.value=n),required:"",type:"switch"},{default:Aa(()=>[Oa(Rs(xe(Ce)("end_to_end_encryption","I understand the risks")),1)]),_:1},8,["modelValue"]),e.value?(St(),rr(xe(Wd),{key:0,modelValue:t.value,"onUpdate:modelValue":a[1]||(a[1]=n=>t.value=n),required:"",type:"switch"},{default:Aa(()=>[Oa(Rs(xe(Ce)("end_to_end_encryption","Do not show this warning the next time")),1)]),_:1},8,["modelValue"])):qo("",!0)]),_:1},8,["heading"]))}}),rE=oi({__name:"CreateFolderDialogStepMnemonic",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(r){const e=Gm(r,"modelValue"),{buttonLabel:t,onContinue:s}=Zp(af);zm(()=>{t.value=Ce("end_to_end_encryption","Submit"),s.value=o});const a=es(""),n=es(!1),i=es(!1);Ny(()=>{if(!n.value||!a.value){e.value=!1;return}e.value=/^\w+(\s+\w+){11}$/.test(a.value)});async function o(){try{await n0(a.value)}catch(l){throw Ne.error("Failed to get user private key:",{error:l}),l}return!0}return(l,u)=>(St(),va(I0,null,[ni(i0,{modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=c=>n.value=c),heading:xe(Ce)("end_to_end_encryption","Encrypting your files in the browser can weaken security")},null,8,["modelValue","heading"]),ni(xe(Ey),{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=c=>a.value=c),autofocus:"",error:i.value,"helper-text":i.value?xe(Ce)("end_to_end_encryption","Decrypting with given mnemonic failed"):void 0,required:"",pattern:"^(\\w+\\s+){11}\\w+$",label:xe(Ce)("end_to_end_encryption","Mnemonic")},null,8,["modelValue","error","helper-text","label"])],64))}});async function aE(){const r=await cw(),e=await zN(),t=await a0(e.privateKey),s=(await H0.create({keys:{publicKey:e.publicKey,privateKey:t},signingAlgorithm:{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},name:`CN=${cu().uid}`,extensions:[new J0(Gd.digitalSignature|Gd.keyEncipherment)]})).toString("pem"),a=new ed(await ub(s));if(!await s0(a,r))throw new Error("Public key not correctly signed by server");const n=await nE(),i=await XN(e.privateKey,n.join(""));return await ib(i),{mnemonic:n,publicKeyCertificate:a,...e}}async function nE(){const{default:r}=await Xv(async()=>{const{default:t}=await import("./english-CPDoVNHx.chunk.mjs");return{default:t}},[],import.meta.url),e=self.crypto.getRandomValues(new Uint16Array(12));return Array.from(e).map(t=>r.at(t%r.length))}const iE={key:0},oE={key:1},uE=oi({__name:"CreateFolderDialogStepSetupEncryption",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(r){const e=Gm(r,"modelValue"),{buttonLabel:t,onContinue:s}=Zp(af);zm(()=>{t.value=Ce("end_to_end_encryption","Setup encryption"),s.value=n,e.value=!0});const a=es("");async function n(){if(a.value)return Ne.debug("Continue with creating encrypted folder"),!0;{e.value=!1,Ne.debug("Initializing encryption for new user");const i=await aE();await ZN(i.publicKeyCertificate),tE(i.privateKey),a.value=i.mnemonic.join(" "),t.value=Ce("end_to_end_encryption","Continue ({secondsLeft})",{secondsLeft:5});let o=5;const l=window.setInterval(()=>{--o>0?t.value=Ce("end_to_end_encryption","Continue ({secondsLeft})",{secondsLeft:o}):(window.clearInterval(l),t.value=Ce("end_to_end_encryption","Continue"),e.value=!0)},1e3)}}return(i,o)=>a.value?(St(),va("div",oE,[rh("p",null,Rs(xe(Ce)("end_to_end_encryption","Your recovery phrase is:")),1),rh("div",{class:Cy(i.$style.setupEncryption__mnemonic)},[rh("code",null,Rs(a.value),1)],2)])):(St(),va("p",iE,[Oa(Rs(xe(Ce)("end_to_end_encryption","To set up encryption, a new private key will be generated for you."))+" ",1),o[0]||(o[0]=rh("br",null,null,-1)),Oa(" "+Rs(xe(Ce)("end_to_end_encryption","Please make sure to back up the following recovery phrase, as it will be required to access your encrypted files.")),1)]))}}),cE="_setupEncryption__mnemonic_75san_2",lE={setupEncryption__mnemonic:cE},hE={$style:lE},mE=ky(uE,[["__cssModules",hE]]),py=0,hp=1,dy=2,mp=3,fE=oi({__name:"CreateFolderDialog",props:{context:{},content:{}},emits:["close"],setup(r,{emit:e}){const t=e,s=es(py);zm(async()=>{try{await eE()?Tl.getItem(Ll.Mnemonic)?(await n0(Tl.getItem(Ll.Mnemonic)),s.value=mp):s.value=dy:s.value=hp}catch(l){Ne.error("Error while checking encryption setup:",{error:l}),t("close",l)}});const a=es(!1),n=es(),i=es("");x0(af,{buttonLabel:i,onContinue:n});async function o(){if(a.value)try{await n.value?.()&&(s.value===hp?s.value=mp:s.value++)}catch(l){t("close",l)}}return(l,u)=>(St(),rr(xe(Iy),{"content-classes":l.$style.createFolderDialog,size:"normal",name:xe(Ce)("end_to_end_encryption","Create new encrypted folder"),"onUpdate:open":u[4]||(u[4]=c=>c||t("close",!1))},{actions:Aa(()=>[ni(xe(B0),{class:Cy(l.$style.createFolderDialog__buttonContinue),"aria-disabled":!a.value,variant:"primary",onClick:o},{default:Aa(()=>[Oa(Rs(i.value||xe(Ce)("end_to_end_encryption","Submit")),1)]),_:1},8,["class","aria-disabled"])]),default:Aa(()=>[s.value===py?(St(),rr(xe(rb),{key:0,name:xe(Ce)("end_to_end_encryption","Checking encryption setup …")},{icon:Aa(()=>[ni(xe(V0))]),_:1},8,["name"])):s.value===hp?(St(),rr(mE,{key:1,modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=c=>a.value=c)},null,8,["modelValue"])):s.value===dy?(St(),rr(rE,{key:2,modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=c=>a.value=c)},null,8,["modelValue"])):s.value===mp?(St(),rr(sE,{key:3,modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=c=>a.value=c),content:r.content,context:r.context,onFolderCreated:u[3]||(u[3]=c=>t("close",c))},null,8,["modelValue","content","context"])):qo("",!0)]),_:1},8,["content-classes","name"]))}}),pE="_createFolderDialog_kohss_2",dE="_createFolderDialog__buttonContinue_kohss_6",gE={createFolderDialog:pE,createFolderDialog__buttonContinue:dE},yE={$style:gE},wE=ky(fE,[["__cssModules",yE]]);function vE(){Mv({id:"end_to_end_encryption:new-encrypted-folder",category:ow.CreateNew,displayName:Ce("end_to_end_encryption","New encrypted folder"),iconSvgInline:_v,order:5,enabled(r){return(r.permissions&ii.CREATE)!==0},async handler(r,e){try{const t=await Vy(wE,{context:r,content:e});if(t instanceof Qm)O0("files:node:created",t);else if(t===!1)P0(Ce("end_to_end_encryption","Creating new encrypted folder: Cancelled"));else throw t}catch(t){Ne.error("Error while creating new encrypted folder:",{error:t}),D0(Ce("end_to_end_encryption","Creating new encrypted folder: Failed"))}}})}function bE(r){return typeof r=="function"?r:Array.isArray(r)?e=>{for(const t of r)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}const SE=`
`;function AE(r,e){let t="";return e.format&&e.indentBy.length>0&&(t=SE),o0(r,e,"",t)}function o0(r,e,t,s){let a="",n=!1;for(let i=0;i<r.length;i++){const o=r[i],l=NE(o);if(l===void 0)continue;let u="";if(t.length===0?u=l:u=`${t}.${l}`,l===e.textNodeName){let d=o[l];EE(u,e)||(d=e.tagValueProcessor(l,d),d=u0(d,e)),n&&(a+=s),a+=d,n=!1;continue}else if(l===e.cdataPropName){n&&(a+=s),a+=`<![CDATA[${o[l][0][e.textNodeName]}]]>`,n=!1;continue}else if(l===e.commentPropName){a+=s+`<!--${o[l][0][e.textNodeName]}-->`,n=!0;continue}else if(l[0]==="?"){const d=gy(o[":@"],e),A=l==="?xml"?"":s;let b=o[l][0][e.textNodeName];b=b.length!==0?" "+b:"",a+=A+`<${l}${b}${d}?>`,n=!0;continue}let c=s;c!==""&&(c+=e.indentBy);const f=gy(o[":@"],e),h=s+`<${l}${f}`,v=o0(o[l],e,u,c);e.unpairedTags.indexOf(l)!==-1?e.suppressUnpairedNode?a+=h+">":a+=h+"/>":(!v||v.length===0)&&e.suppressEmptyNode?a+=h+"/>":v&&v.endsWith(">")?a+=h+`>${v}${s}</${l}>`:(a+=h+">",v&&s!==""&&(v.includes("/>")||v.includes("</"))?a+=s+e.indentBy+v+s:a+=v,a+=`</${l}>`),n=!0}return a}function NE(r){const e=Object.keys(r);for(let t=0;t<e.length;t++){const s=e[t];if(r.hasOwnProperty(s)&&s!==":@")return s}}function gy(r,e){let t="";if(r&&!e.ignoreAttributes)for(let s in r){if(!r.hasOwnProperty(s))continue;let a=e.attributeValueProcessor(s,r[s]);a=u0(a,e),a===!0&&e.suppressBooleanAttributes?t+=` ${s.substr(e.attributeNamePrefix.length)}`:t+=` ${s.substr(e.attributeNamePrefix.length)}="${a}"`}return t}function EE(r,e){r=r.substr(0,r.length-e.textNodeName.length-1);let t=r.substr(r.lastIndexOf(".")+1);for(let s in e.stopNodes)if(e.stopNodes[s]===r||e.stopNodes[s]==="*."+t)return!0;return!1}function u0(r,e){if(r&&r.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const s=e.entities[t];r=r.replace(s.regex,s.val)}return r}const CE={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function xa(r){this.options=Object.assign({},CE,r),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=bE(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=VE),this.processTextOrObjNode=kE,this.options.format?(this.indentate=IE,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}xa.prototype.build=function(r){return this.options.preserveOrder?AE(r,this.options):(Array.isArray(r)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(r={[this.options.arrayNodeName]:r}),this.j2x(r,0,[]).val)},xa.prototype.j2x=function(r,e,t){let s="",a="";const n=t.join(".");for(let i in r)if(Object.prototype.hasOwnProperty.call(r,i))if(typeof r[i]>"u")this.isAttribute(i)&&(a+="");else if(r[i]===null)this.isAttribute(i)||i===this.options.cdataPropName?a+="":i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(r[i]instanceof Date)a+=this.buildTextValNode(r[i],i,"",e);else if(typeof r[i]!="object"){const o=this.isAttribute(i);if(o&&!this.ignoreAttributesFn(o,n))s+=this.buildAttrPairStr(o,""+r[i]);else if(!o)if(i===this.options.textNodeName){let l=this.options.tagValueProcessor(i,""+r[i]);a+=this.replaceEntitiesValue(l)}else a+=this.buildTextValNode(r[i],i,"",e)}else if(Array.isArray(r[i])){const o=r[i].length;let l="",u="";for(let c=0;c<o;c++){const f=r[i][c];if(!(typeof f>"u"))if(f===null)i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(typeof f=="object")if(this.options.oneListGroup){const h=this.j2x(f,e+1,t.concat(i));l+=h.val,this.options.attributesGroupName&&f.hasOwnProperty(this.options.attributesGroupName)&&(u+=h.attrStr)}else l+=this.processTextOrObjNode(f,i,e,t);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(i,f);h=this.replaceEntitiesValue(h),l+=h}else l+=this.buildTextValNode(f,i,"",e)}this.options.oneListGroup&&(l=this.buildObjectNode(l,i,u,e)),a+=l}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const o=Object.keys(r[i]),l=o.length;for(let u=0;u<l;u++)s+=this.buildAttrPairStr(o[u],""+r[i][o[u]])}else a+=this.processTextOrObjNode(r[i],i,e,t);return{attrStr:s,val:a}},xa.prototype.buildAttrPairStr=function(r,e){return e=this.options.attributeValueProcessor(r,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+r:" "+r+'="'+e+'"'};function kE(r,e,t,s){const a=this.j2x(r,t+1,s.concat(e));return r[this.options.textNodeName]!==void 0&&Object.keys(r).length===1?this.buildTextValNode(r[this.options.textNodeName],e,a.attrStr,t):this.buildObjectNode(a.val,e,a.attrStr,t)}xa.prototype.buildObjectNode=function(r,e,t,s){if(r==="")return e[0]==="?"?this.indentate(s)+"<"+e+t+"?"+this.tagEndChar:this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let a="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",a=""),(t||t==="")&&r.indexOf("<")===-1?this.indentate(s)+"<"+e+t+n+">"+r+a:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(s)+`<!--${r}-->`+this.newLine:this.indentate(s)+"<"+e+t+n+this.tagEndChar+r+this.indentate(s)+a}},xa.prototype.closeTag=function(r){let e="";return this.options.unpairedTags.indexOf(r)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${r}`,e},xa.prototype.buildTextValNode=function(r,e,t,s){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(s)+`<![CDATA[${r}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(s)+`<!--${r}-->`+this.newLine;if(e[0]==="?")return this.indentate(s)+"<"+e+t+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(e,r);return a=this.replaceEntitiesValue(a),a===""?this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(s)+"<"+e+t+">"+a+"</"+e+this.tagEndChar}},xa.prototype.replaceEntitiesValue=function(r){if(r&&r.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];r=r.replace(t.regex,t.val)}return r};function IE(r){return this.options.indentBy.repeat(r)}function VE(r){return r.startsWith(this.options.attributeNamePrefix)&&r!==this.options.textNodeName?r.substr(this.attrPrefixLen):!1}function vm(r){return r.users!==void 0}async function BE(r,e){Ne.debug("Decrypting metadata info",{metadata:r});const[t,s]=r.metadata.ciphertext.split("|"),a=await Ud(rs(t),e,{iv:rs(r.metadata.nonce||s)}),n=JSON.parse(await PE(a));return xE(n,r),await OE(n,e),n}function xE(r,e){if(r.keyChecksums?.length!==e.users?.length)throw new Error("Key checksums length does not match users length")}async function OE(r,e){if(r.keyChecksums===void 0)return;const t=await FN(e),s=await t0(t);if(!r.keyChecksums.includes(s))throw new Error("Key checksum is not in keyChecksums")}async function PE(r){const e=new ReadableStream({start(t){t.enqueue(new Uint8Array(r)),t.close()}}).pipeThrough(new DecompressionStream("gzip"));return await new Response(e).text()}async function DE(r,e,t){Ne.debug("Getting metadata private key",{metadata:r,userId:e});const s=r.users?.find(i=>i.userId===e);if(!s)throw new Error("User not found in metadata");const a=rs(s.encryptedMetadataKey),n=await MN(a,t);return await e0(new Uint8Array(n))}const TE=oi({__name:"MnemonicPromptDialog",emits:["close"],setup(r,{emit:e}){const t=e,s=es(),a=es(""),n=es(!1),i=bm(()=>n.value===!0&&a.value.trim().split(/\s+/g).length===12);function o(){t("close",a.value)}const l=bm(()=>[{label:Ce("end_to_en_encryption","Submit"),type:"submit",variant:"primary",disabled:!i.value,callback:o}]);return(u,c)=>(St(),rr(xe(Iy),{ref_key:"dialogRef",ref:s,name:xe(Ce)("end_to_end_encryption","Enter your 12 words mnemonic"),buttons:l.value,"is-form":!0,onSubmit:o},{default:Aa(()=>[ni(i0,{modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=f=>n.value=f),heading:xe(Ce)("end_to_end_encryption","Decrypting your files in the browser can weaken security")},null,8,["modelValue","heading"]),ni(xe(Ey),{modelValue:a.value,"onUpdate:modelValue":c[1]||(c[1]=f=>a.value=f),autofocus:"",required:"",pattern:"^(\\w+\\s+){11}\\w+$",label:xe(Ce)("end_to_end_encryption","Mnemonic")},null,8,["modelValue","label"])]),_:1},8,["name","buttons"]))}});async function LE(){return await Vy(TE)}async function yy(r,e,t){const s=Od(r,(n,i)=>{if(n!=="filedrop")return i}),a=await WN(Kl(btoa(s)),rs(e),t.users);if(!a)throw new Error("Metadata signature verification failed");return a}async function RE(r,e){const t=r.users.map(async({userId:s,certificate:a})=>{const n=await s0(new ed(a),e);if(!n)throw new Error(`Certificate verification failed for user ${s}`);return n});return await Promise.all(t)}const UE=Nv(),It={_userPrivateKey:void 0,_serverPublicKey:void 0,_metadataCache:{},async getUserPrivateKey(){const r=await uw();if(!r)throw new Error("No private key found for user");return this._userPrivateKey??=await r0(r,await LE()),this._userPrivateKey},async getServerPublicKeyPEM(){return this._serverPublicKey??=await cw(),this._serverPublicKey},async getMetadata(r){if(this._metadataCache[r])return Ne.debug("Found metadata in cache",{path:r,state:It}),this._metadataCache[r];if(Ne.debug("Fetching PROPFIND for metadata",{path:r,state:It}),await UE.stat(decodeURI(r).replace("remote.php/dav/",""),{details:!0,data:vv()}),this._metadataCache[r])return Ne.debug("Found metadata in cache after PROPFIND",{path:r,state:It}),this._metadataCache[r];throw new Error(`Could not find metadata for ${r}`)},async setMetadata(r,e,t){const s=JSON.parse(e);vm(s)?(await yy(s,t,s),await RE(s,await this.getServerPublicKeyPEM())):await yy(s,t,await this.getRootMetadata(Xt.dirname(r))),this._metadataCache[r]=s,Ne.debug("Added metadata in cache",{path:r,state:It})},async getMetadataInfo(r){const e=await this.getMetadata(r),t=await this.getRootMetadata(r),s=cu();if(s===null)throw new Error("No user logged in");return BE(e,await DE(t,s.uid,await It.getUserPrivateKey()))},async getRootMetadata(r){const e=Object.entries(It._metadataCache).filter(([t])=>r.startsWith(t)).map(([,t])=>t).find(t=>vm(t));if(e)return Ne.debug("Found root metadata in cache",{path:r,state:It}),e;for(Ne.debug("Looking for root metadata",{path:r,state:It});r!=="/";){const t=await It.getMetadata(r);if(vm(t))return Ne.debug("Fetched root metadata",{path:r,state:It}),t;r=Xt.dirname(r)}throw new Error(`Found no root metadata for ${r}`)}};let _m;function $E(){_m=window.fetch,Ne.debug("Setting up WebDAV decryption proxy"),window.fetch=async(r,e={})=>{let t=new Request(r,e);if(!(t.url.includes("/remote.php/dav/files/")&&(t.method==="GET"||t.method==="PROPFIND")))return _m(t);Ne.debug(`Proxying ${t.method} ${t.url}`,{request:t});const s=new Headers(t.headers);switch(s.set("X-E2EE-SUPPORTED","true"),t=new Request(t,{headers:s}),t.method){case"PROPFIND":return KE(t);case"GET":default:return jE(t)}}}async function jE(r){const e=new URL(r.url).pathname,t=_m(r);try{const s=await It.getMetadataInfo(Xt.dirname(e)),a=s.files[Xt.basename(r.url)];if(a===void 0)throw Ne.debug("Could not find file in metadata",{path:e,metadataInfo:s}),new Error("Could not find file in metadata");return await ME(await t,a)}catch{return await t}}async function KE(r){Ne.debug("Fetching raw PROPFIND",{request:r});const e=await _m(r),t=new URL(r.url).pathname,s=await e.text(),a=await dv(s),n=pv(a,t,!0);if(n.props?.["e2ee-is-encrypted"]!==1)return Ne.debug("Node is not e2ee",{xml:a}),new Response(s,e);if(n.type==="directory"){const i=n.props["e2ee-metadata"],o=n.props["e2ee-metadata-signature"];i!==void 0&&o!==void 0&&await It.setMetadata(t,i,o);const l=await It.getMetadata(t),u=await It.getMetadataInfo(t);if(vm(l))fp(a,t,u);else{const c=await It.getMetadataInfo(Xt.dirname(t));fp(a,t,u,c)}}else if(n.type==="file"){const i=await It.getMetadataInfo(Xt.dirname(t));if(i===void 0)return Ne.debug("Cannot find metadata for parent folder",{path:t}),new Response(s,e);fp(a,t,void 0,i)}return new Response(new xa().build(a),e)}function fp(r,e,t,s){Ne.debug("Updating PROPFIND info",{path:e,decryptedMetadata:t,decryptedParentMetadata:s,xml:r}),r.multistatus.response.forEach(a=>{if(a.propstat===void 0)return;const n=a.href===e?s:t,i=a.propstat.prop.displayname;let o=i;n!==void 0&&(n.files[i]?(o=n.files[i].filename,a.propstat.prop.getcontenttype=n.files[i].mimetype):n.folders[i]&&(o=n.folders[i],a.propstat.prop.getcontenttype="httpd/unix-directory")),a.propstat.prop.displayname=o,a.propstat.prop.permissions=a.propstat.prop.permissions.replace(/(R)|(D)|(N)|(V)|(W)|(CK)/g,"")})}async function ME(r,e){Ne.debug("Decrypting encrypted file",{response:r,fileEncryptionInfo:e});const t=await Ud(new Uint8Array(await r.arrayBuffer()),await e0(rs(e.key)),{iv:rs(e.nonce)}),s=new Headers(r.headers);return s.set("Content-Type",e.mimetype),new Response(t,{status:r.status,statusText:r.statusText,headers:s})}const wy=T0("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1}),vy=typeof window.crypto<"u"&&typeof window.crypto.subtle<"u";wy.e2eeInBrowserEnabled&&vy?($E(),Sf("nc:e2ee-is-encrypted",{nc:"http://nextcloud.org/ns"}),Sf("nc:e2ee-metadata",{nc:"http://nextcloud.org/ns"}),Sf("nc:e2ee-metadata-signature",{nc:"http://nextcloud.org/ns"}),xv(Wv),by("download"),by("move-copy"),vE()):wy.e2eeInBrowserEnabled&&!vy&&Ne.error("End-to-end encryption in the browser is not supported by your browser or you are not using a secure connection (HTTPS).");function by(r){Ne.debug(`Inhibiting ${r} actions for e2ee files`);const e=Ov().find(s=>s.id===r),t=e._action.enabled;e._action.enabled=(s,a)=>s.some(n=>n.attributes["e2ee-is-encrypted"]===1)?!1:t(s,a)}
//# sourceMappingURL=end_to_end_encryption-files.mjs.map
