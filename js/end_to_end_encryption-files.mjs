(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode("/*!\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */.toastify.dialogs{min-width:200px;background:none;background-color:var(--color-main-background);color:var(--color-main-text);box-shadow:0 0 6px 0 var(--color-box-shadow);padding:0 12px;margin-top:45px;position:fixed;z-index:10100;border-radius:var(--border-radius);display:flex;align-items:center;min-height:50px}.toastify.dialogs .toast-loader-container,.toastify.dialogs .toast-undo-container{display:flex;align-items:center;width:100%}.toastify.dialogs .toast-undo-button,.toastify.dialogs .toast-close{position:static;overflow:hidden;box-sizing:border-box;min-width:44px;height:100%;padding:12px;white-space:nowrap;background-repeat:no-repeat;background-position:center;background-color:transparent;min-height:0}.toastify.dialogs .toast-undo-button.toast-close,.toastify.dialogs .toast-close.toast-close{text-indent:0;opacity:.4;border:none;min-height:44px;margin-left:10px;font-size:0}.toastify.dialogs .toast-undo-button.toast-close:before,.toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\");content:\" \";filter:var(--background-invert-if-dark);display:inline-block;width:16px;height:16px}.toastify.dialogs .toast-undo-button.toast-undo-button,.toastify.dialogs .toast-close.toast-undo-button{height:calc(100% - 6px);margin:3px 3px 3px 12px}.toastify.dialogs .toast-undo-button:hover,.toastify.dialogs .toast-undo-button:focus,.toastify.dialogs .toast-undo-button:active,.toastify.dialogs .toast-close:hover,.toastify.dialogs .toast-close:focus,.toastify.dialogs .toast-close:active{cursor:pointer;opacity:1}.toastify.dialogs.toastify-top{right:10px}.toastify.dialogs.toast-with-click{cursor:pointer}.toastify.dialogs.toast-error{border-left:3px solid var(--color-element-error, var(--color-error))}.toastify.dialogs.toast-info{border-left:3px solid var(--color-element-info, var(--color-primary))}.toastify.dialogs.toast-warning{border-left:3px solid var(--color-element-warning, var(--color-warning))}.toastify.dialogs.toast-success,.toastify.dialogs.toast-undo{border-left:3px solid var(--color-element-success, var(--color-success))}.toastify.dialogs.toast-loading{border-left:3px solid var(--color-element-info, var(--color-primary))}.toastify.dialogs.toast-loading .toast-loader{display:inline-block;width:20px;height:20px;animation:rotate var(--animation-duration, .8s) linear infinite;margin-left:auto}.theme--dark .toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill:%23fff;fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\")}.nc-generic-dialog .dialog__actions{justify-content:space-between;min-width:calc(100% - 12px)}/*!\n * SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */._file-picker__file-icon_3v9zx_9{position:relative;width:32px;height:32px;min-width:32px;min-height:32px;background-repeat:no-repeat;background-size:contain;display:flex;justify-content:center}._file-picker__file-icon--primary_3v9zx_21{color:var(--color-primary-element)}._file-picker__file-icon-overlay_3v9zx_25{color:var(--color-primary-element-text);position:absolute;inset-block-start:10px}tr.file-picker__row[data-v-15187afc]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-15187afc]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-15187afc]{padding:0 2px}tr.file-picker__row td[data-v-15187afc]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-15187afc]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-15187afc]{padding-inline:2px 0}@keyframes gradient-15187afc{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}.loading-row .row-checkbox[data-v-15187afc]{text-align:center!important}.loading-row span[data-v-15187afc]{display:inline-block;height:24px;background:linear-gradient(to right,var(--color-background-darker),var(--color-text-maxcontrast),var(--color-background-darker));background-size:600px 100%;border-radius:var(--border-radius);animation:gradient-15187afc 12s ease infinite}.loading-row .row-wrapper[data-v-15187afc]{display:inline-flex;align-items:center}.loading-row .row-checkbox span[data-v-15187afc]{width:24px}.loading-row .row-name span[data-v-15187afc]:last-of-type{margin-inline-start:6px;width:130px}.loading-row .row-size span[data-v-15187afc]{width:80px}.loading-row .row-modified span[data-v-15187afc]{width:90px}/*!\n* SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n* SPDX-License-Identifier: AGPL-3.0-or-later\n*/tr.file-picker__row[data-v-82f380c9]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-82f380c9]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-82f380c9]{padding:0 2px}tr.file-picker__row td[data-v-82f380c9]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-82f380c9]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-82f380c9]{padding-inline:2px 0}.file-picker__row *[data-v-82f380c9]{cursor:pointer}.file-picker__row--selected[data-v-82f380c9]{background-color:var(--color-background-dark)}.file-picker__row--not-navigatable[data-v-82f380c9]{filter:saturate(.7);opacity:.7}.file-picker__row--not-navigatable *[data-v-82f380c9],.file-picker__row--not-pickable *[data-v-82f380c9]{cursor:default!important}.file-picker__row[data-v-82f380c9]:hover{background-color:var(--color-background-hover)}.file-picker__name-container[data-v-82f380c9]{display:flex;justify-content:start;align-items:center;height:100%}.file-picker__file-name[data-v-82f380c9]{padding-inline-start:6px;min-width:0;overflow:hidden;text-overflow:ellipsis}.file-picker__file-extension[data-v-82f380c9]{color:var(--color-text-maxcontrast);min-width:fit-content}.file-picker__header-preview[data-v-6503afab]{width:22px;height:32px;flex:0 0 auto}.file-picker__files[data-v-6503afab]{margin:2px;margin-inline-start:12px;overflow:scroll auto}.file-picker__files table[data-v-6503afab]{width:100%;max-height:100%;table-layout:fixed}.file-picker__files th[data-v-6503afab]{position:-webkit-sticky;position:sticky;z-index:1;top:0;background-color:var(--color-main-background);padding:2px}.file-picker__files th .header-wrapper[data-v-6503afab]{display:flex}.file-picker__files th.row-checkbox[data-v-6503afab]{width:44px}.file-picker__files th.row-name[data-v-6503afab]{width:230px}.file-picker__files th.row-size[data-v-6503afab]{width:100px}.file-picker__files th.row-modified[data-v-6503afab]{width:120px}.file-picker__files th[data-v-6503afab]:not(.row-size) .button-vue__wrapper{justify-content:start;flex-direction:row-reverse}.file-picker__files th[data-v-6503afab]:not(.row-size) .button-vue{padding-inline:16px 4px}.file-picker__files th.row-size[data-v-6503afab] .button-vue__wrapper{justify-content:end}.file-picker__files th[data-v-6503afab] .button-vue__wrapper{color:var(--color-text-maxcontrast)}.file-picker__files th[data-v-6503afab] .button-vue__wrapper .button-vue__text{font-weight:400}.file-picker__breadcrumbs[data-v-1a8cb0b2]{flex-grow:0!important}.file-picker__side[data-v-f5975252]{display:flex;flex-direction:column;align-items:stretch;gap:.5rem;min-width:200px;padding:2px;margin-block-start:7px;overflow:auto}.file-picker__side[data-v-f5975252] .button-vue__wrapper{justify-content:start}.file-picker__filter-input[data-v-f5975252]{margin-block:7px;max-width:260px}@media (max-width: 736px){.file-picker__side[data-v-f5975252]{flex-direction:row;min-width:unset}}@media (max-width: 512px){.file-picker__side[data-v-f5975252]{flex-direction:row;min-width:unset}.file-picker__filter-input[data-v-f5975252]{max-width:unset}}.file-picker__navigation{padding-inline:8px 2px}.file-picker__navigation,.file-picker__navigation *{box-sizing:border-box}.file-picker__navigation .v-select.select{min-width:220px}@media (min-width: 513px) and (max-width: 736px){.file-picker__navigation{gap:11px}}@media (max-width: 512px){.file-picker__navigation{flex-direction:column-reverse!important}}.file-picker__view[data-v-dda9b42b]{height:50px;display:flex;justify-content:start;align-items:center}.file-picker__view h3[data-v-dda9b42b]{font-weight:700;height:fit-content;margin:0}.file-picker__main[data-v-dda9b42b]{box-sizing:border-box;width:100%;display:flex;flex-direction:column;min-height:0;flex:1;padding-inline:2px}.file-picker__main *[data-v-dda9b42b]{box-sizing:border-box}[data-v-dda9b42b] .file-picker{height:min(80vh,800px)!important}@media (max-width: 512px){[data-v-dda9b42b] .file-picker{height:calc(100% - 16px - var(--default-clickable-area))!important}}[data-v-dda9b42b] .file-picker__content{display:flex;flex-direction:column;overflow:hidden}.public-auth-prompt__text[data-v-a2f36bdb]{font-size:1.25em;margin-block:0 calc(3 * var(--default-grid-baseline))}.public-auth-prompt__header[data-v-a2f36bdb]{margin-block:0 calc(3 * var(--default-grid-baseline))}.public-auth-prompt__header[data-v-a2f36bdb]:first-child{margin-top:0}.public-auth-prompt__input[data-v-a2f36bdb]{margin-block:calc(4 * var(--default-grid-baseline)) calc(2 * var(--default-grid-baseline))}.material-design-icon[data-v-a3ad91bd]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}/*!\n * SPDX-FileCopyrightText: 2025 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */.input-field[data-v-a3ad91bd]{--input-border-color: var(--color-border-maxcontrast);--input-border-radius: var(--border-radius-element);--input-padding-start: var(--border-radius-large);--input-padding-end: var(--border-radius-large);position:relative;width:100%;margin-block-start:6px}.input-field--disabled[data-v-a3ad91bd]{opacity:.4;filter:saturate(.4)}.input-field--label-outside[data-v-a3ad91bd]{margin-block-start:0}.input-field--leading-icon[data-v-a3ad91bd]{--input-padding-start: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--trailing-icon[data-v-a3ad91bd]{--input-padding-end: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--pill[data-v-a3ad91bd]{--input-border-radius: var(--border-radius-pill)}.input-field__main-wrapper[data-v-a3ad91bd]{height:var(--default-clickable-area);padding:var(--border-width-input-focused, 2px);position:relative}.input-field__input[data-v-a3ad91bd]{--input-border-box-shadow-light: 0 -1px var(--input-border-color), 0 0 0 1px color-mix(in srgb, var(--input-border-color), 65% transparent);--input-border-box-shadow-dark: 0 1px var(--input-border-color), 0 0 0 1px color-mix(in srgb, var(--input-border-color), 65% transparent);--input-border-box-shadow: var(--input-border-box-shadow-light);border:none;border-radius:var(--border-radius-element);box-shadow:var(--input-border-box-shadow)}.input-field__input[data-v-a3ad91bd]:hover:not([disabled]){box-shadow:0 0 0 1px var(--input-border-color)}@media (prefers-color-scheme: dark){.input-field__input .input-field__input[data-v-a3ad91bd]{--input-border-box-shadow: var(--input-border-box-shadow-dark)}}[data-theme-dark] .input-field__input[data-v-a3ad91bd]{--input-border-box-shadow: var(--input-border-box-shadow-dark)}[data-theme-light] .input-field__input[data-v-a3ad91bd]{--input-border-box-shadow: var(--input-border-box-shadow-light)}.input-field--legacy .input-field__input[data-v-a3ad91bd]{box-shadow:0 0 0 1px var(--input-border-color)}.input-field--legacy .input-field__input[data-v-a3ad91bd]:hover:not([disabled]){box-shadow:0 0 0 2px var(--input-border-color)}.input-field__input[data-v-a3ad91bd]:focus-within:not([disabled]),.input-field__input[data-v-a3ad91bd]:active:not([disabled]){box-shadow:0 0 0 2px var(--input-border-color),0 0 0 4px var(--color-main-background)!important}.input-field__input[data-v-a3ad91bd]{background-color:var(--color-main-background);color:var(--color-main-text);border-radius:var(--input-border-radius);cursor:pointer;-webkit-appearance:textfield!important;-moz-appearance:textfield!important;appearance:textfield!important;font-size:var(--default-font-size);text-overflow:ellipsis;padding-block:0;padding-inline:var(--input-padding-start) var(--input-padding-end);height:100%!important;min-height:unset;width:100%}.input-field__input[data-v-a3ad91bd]::placeholder{color:var(--color-text-maxcontrast)}.input-field__input[data-v-a3ad91bd]::-webkit-search-cancel-button{display:none}.input-field__input[data-v-a3ad91bd]::-webkit-search-decoration,.input-field__input[data-v-a3ad91bd]::-webkit-search-results-button,.input-field__input[data-v-a3ad91bd]::-webkit-search-results-decoration,.input-field__input[data-v-a3ad91bd]::-ms-clear{display:none}.input-field__input[data-v-a3ad91bd]:active:not([disabled]),.input-field__input[data-v-a3ad91bd]:focus:not([disabled]){--input-border-color: var(--color-main-text)}.input-field__input:focus+.input-field__label[data-v-a3ad91bd],.input-field__input:hover:not(:placeholder-shown)+.input-field__label[data-v-a3ad91bd]{color:var(--color-main-text)}.input-field__input[data-v-a3ad91bd]:focus{cursor:text}.input-field__input[data-v-a3ad91bd]:disabled{cursor:default}.input-field__input[data-v-a3ad91bd]:focus-visible{box-shadow:unset!important}.input-field__input--success[data-v-a3ad91bd]{border-color:var(--color-border-success, var(--color-success))!important}.input-field__input--success[data-v-a3ad91bd]:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field__input--error[data-v-a3ad91bd],.input-field__input[data-v-a3ad91bd]:user-invalid{border-color:var(--color-border-error, var(--color-error))!important}.input-field__input--error[data-v-a3ad91bd]:focus-visible,.input-field__input[data-v-a3ad91bd]:user-invalid:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field:not(.input-field--label-outside) .input-field__input[data-v-a3ad91bd]:not(:focus)::placeholder{opacity:0}.input-field__label[data-v-a3ad91bd]{--input-label-font-size: var(--default-font-size);position:absolute;margin-inline:var(--input-padding-start) var(--input-padding-end);max-width:fit-content;font-size:var(--input-label-font-size);inset-block-start:calc((var(--default-clickable-area) - 1lh) / 2);inset-inline:var(--border-width-input-focused, 2px);color:var(--color-text-maxcontrast);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;pointer-events:none;transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick),background-color var(--animation-quick) var(--animation-slow)}.input-field__input:focus+.input-field__label[data-v-a3ad91bd],.input-field__input:not(:placeholder-shown)+.input-field__label[data-v-a3ad91bd]{--input-label-font-size: 13px;line-height:1.5;inset-block-start:calc(-1.5 * var(--input-label-font-size) / 2);font-weight:500;border-radius:var(--default-grid-baseline) var(--default-grid-baseline) 0 0;background-color:var(--color-main-background);padding-inline:var(--default-grid-baseline);margin-inline:calc(var(--input-padding-start) - var(--default-grid-baseline)) calc(var(--input-padding-end) - var(--default-grid-baseline));transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick)}.input-field__icon[data-v-a3ad91bd]{position:absolute;height:var(--default-clickable-area);width:var(--default-clickable-area);display:flex;align-items:center;justify-content:center;opacity:.7;inset-block-end:0}.input-field__icon--leading[data-v-a3ad91bd]{inset-inline-start:0px}.input-field__icon--trailing[data-v-a3ad91bd]{inset-inline-end:0px}.input-field__trailing-button[data-v-a3ad91bd]{--button-size: calc(var(--default-clickable-area) - 2 * var(--border-width-input-focused, 2px)) !important;--button-radius: calc(var(--input-border-radius) - var(--border-width-input-focused, 2px))}.input-field__trailing-button.button-vue[data-v-a3ad91bd]{position:absolute;top:var(--border-width-input-focused, 2px);inset-inline-end:var(--border-width-input-focused, 2px)}.input-field__trailing-button.button-vue[data-v-a3ad91bd]:focus-visible{box-shadow:none!important}.input-field__helper-text-message[data-v-a3ad91bd]{padding-block:4px;padding-inline:var(--border-radius-large);display:flex;align-items:center;color:var(--color-text-maxcontrast);word-break:break-all}.input-field__helper-text-message__icon[data-v-a3ad91bd]{margin-inline-end:8px}.input-field__helper-text-message--error[data-v-a3ad91bd]{color:var(--color-text-error, var(--color-error))}.input-field--error .input-field__input[data-v-a3ad91bd],.input-field__input[data-v-a3ad91bd]:user-invalid{--input-border-color: var(--color-border-error, var(--color-error)) !important}.input-field--error .input-field__input[data-v-a3ad91bd]:focus-visible,.input-field__input[data-v-a3ad91bd]:user-invalid:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field--success .input-field__input[data-v-a3ad91bd]{--input-border-color: var(--color-border-success, var(--color-success)) !important}.input-field--success .input-field__input[data-v-a3ad91bd]:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}")),document.head.appendChild(a)}}catch(i){console.error("vite-plugin-css-injected-by-js",i)}})();
var Zw=Object.defineProperty,ey=Object.defineProperties;var ty=Object.getOwnPropertyDescriptors;var qd=Object.getOwnPropertySymbols;var sy=Object.prototype.hasOwnProperty,ry=Object.prototype.propertyIsEnumerable;var _d=s=>{throw TypeError(s)};var fm=(s,e,t)=>e in s?Zw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ht=(s,e)=>{for(var t in e||(e={}))sy.call(e,t)&&fm(s,t,e[t]);if(qd)for(var t of qd(e))ry.call(e,t)&&fm(s,t,e[t]);return s},ps=(s,e)=>ey(s,ty(e));var Je=(s,e,t)=>fm(s,typeof e!="symbol"?e+"":e,t),dm=(s,e,t)=>e.has(s)||_d("Cannot "+t);var M=(s,e,t)=>(dm(s,e,"read from private field"),t?t.call(s):e.get(s)),Dt=(s,e,t)=>e.has(s)?_d("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),De=(s,e,t,r)=>(dm(s,e,"write to private field"),r?r.call(s,t):e.set(s,t),t),er=(s,e,t)=>(dm(s,e,"access private method"),t);import{p as Ye,g as Lt,a as vf,b as cd,c as ay,o as ny,d as iy,e as oy,f as uy,B as pm,h as Ig,i as xg,n as nm,N as ly,j as Wd,G as cy,l as hy,r as my,k as fy,m as dy,q as py,s as gy,t as Ec,u as wy,v as yy,w as vy,x as gm,y as Gd,z as bf,A as by,C as Ay}from"./_plugin-vue2_normalizer-FyMxODMF.chunk.mjs";import{f as Ke,B as ve,s as Do,a as Uh,O as $,N as We,I as O,S as N,g as f,A as z,b as J,c as L,d as U,e as ie,C as V,R as Z,h as Ie,P as G,i as me,j as Ge,G as Ve,k as fa,u as Co,l as hc,m as jh,t as Af,n as mc,o as Sy,p as Ny,q as Xd,r as zd,E as fc,U as Sf,v as $h,w as Nf,x as kf,y as sh,z as Fs,T as Ef,V as ky,D as Vg,F as Ey,H as Cy,J as Iy,K as xy,X as Vy,L as To}from"./x509.es-ChfhDOFu.chunk.mjs";import{N as Py,a as By,b as Oy,s as Dy}from"./NcCheckboxRadioSwitch-Di43R9CE-AiKV1x1B.chunk.mjs";import{u as Pg}from"./useModelMigration-EhAWvqDD-LEj1DBKw.chunk.mjs";function Bg(s,e,t){var n;const r="#initial-state-".concat(s,"-").concat(e);if((n=window._nc_initial_state)!=null&&n.has(r))return window._nc_initial_state.get(r);window._nc_initial_state||(window._nc_initial_state=new Map);const a=document.querySelector(r);if(a===null)return t;try{const i=JSON.parse(atob(a.value));return window._nc_initial_state.set(r,i),i}catch(i){return console.error("[@nextcloud/initial-state] Could not parse initial state",{key:e,app:s,error:i}),t}}function Og(){var s;return(s=Bg("files_sharing","isPublic",null))!=null?s:document.querySelector('input#isPublic[type="hidden"][name="isPublic"][value="1"]')!==null}function Ty(){var s,e,t;return(t=(e=Bg("files_sharing","sharingToken",null))!=null?e:(s=document.querySelector('input#sharingToken[type="hidden"]'))==null?void 0:s.value)!=null?t:null}function or(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Yd(s,e,t){Ry(s,e),e.set(s,t)}function Ry(s,e){if(e.has(s))throw new TypeError("Cannot initialize the same private elements twice on an object")}function lt(s,e){var t=Dg(s,e,"get");return Ly(s,t)}function Ly(s,e){return e.get?e.get.call(s):e.value}function Qd(s,e,t){var r=Dg(s,e,"set");return Uy(s,r,t),t}function Dg(s,e,t){if(!e.has(s))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(s)}function Uy(s,e,t){if(e.set)e.set.call(s,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}var jy=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",mt=new WeakMap,Ho=new WeakMap;class im{constructor(e){var{executor:t=()=>{},internals:r=md(),promise:a=new Promise((n,i)=>t(n,i,o=>{r.onCancelList.push(o)}))}=e;Yd(this,mt,{writable:!0,value:void 0}),Yd(this,Ho,{writable:!0,value:void 0}),or(this,jy,"CancelablePromise"),this.cancel=this.cancel.bind(this),Qd(this,mt,r),Qd(this,Ho,a||new Promise((n,i)=>t(n,i,o=>{r.onCancelList.push(o)})))}then(e,t){return rh(lt(this,Ho).then(Cc(e,lt(this,mt)),Cc(t,lt(this,mt))),lt(this,mt))}catch(e){return rh(lt(this,Ho).catch(Cc(e,lt(this,mt))),lt(this,mt))}finally(e,t){return t&&lt(this,mt).onCancelList.push(e),rh(lt(this,Ho).finally(Cc(()=>{if(e)return t&&(lt(this,mt).onCancelList=lt(this,mt).onCancelList.filter(r=>r!==e)),e()},lt(this,mt))),lt(this,mt))}cancel(){lt(this,mt).isCanceled=!0;var e=lt(this,mt).onCancelList;lt(this,mt).onCancelList=[];for(var t of e)if(typeof t=="function")try{t()}catch(r){console.error(r)}}isCanceled(){return lt(this,mt).isCanceled===!0}}class ur extends im{constructor(e){super({executor:e})}}or(ur,"all",function(s){return Ic(s,Promise.all(s))}),or(ur,"allSettled",function(s){return Ic(s,Promise.allSettled(s))}),or(ur,"any",function(s){return Ic(s,Promise.any(s))}),or(ur,"race",function(s){return Ic(s,Promise.race(s))}),or(ur,"resolve",function(s){return Zd(Promise.resolve(s))}),or(ur,"reject",function(s){return Zd(Promise.reject(s))}),or(ur,"isCancelable",hd);function Zd(s){return rh(s,md())}function hd(s){return s instanceof ur||s instanceof im}function Cc(s,e){if(s)return t=>{if(!e.isCanceled){var r=s(t);return hd(r)&&e.onCancelList.push(r.cancel),r}return t}}function rh(s,e){return new im({internals:e,promise:s})}function Ic(s,e){var t=md();return t.onCancelList.push(()=>{for(var r of s)hd(r)&&r.cancel()}),new im({internals:t,promise:e})}function md(){return{isCanceled:!1,onCancelList:[]}}var wm={},$y={2:s=>{function e(a,n,i){a instanceof RegExp&&(a=t(a,i)),n instanceof RegExp&&(n=t(n,i));var o=r(a,n,i);return o&&{start:o[0],end:o[1],pre:i.slice(0,o[0]),body:i.slice(o[0]+a.length,o[1]),post:i.slice(o[1]+n.length)}}function t(a,n){var i=n.match(a);return i?i[0]:null}function r(a,n,i){var o,u,c,l,m,h=i.indexOf(a),w=i.indexOf(n,h+1),g=h;if(h>=0&&w>0){for(o=[],c=i.length;g>=0&&!m;)g==h?(o.push(g),h=i.indexOf(a,g+1)):o.length==1?m=[o.pop(),w]:((u=o.pop())<c&&(c=u,l=w),w=i.indexOf(n,g+1)),g=h<w&&h>=0?h:w;o.length&&(m=[c,l])}return m}s.exports=e,e.range=r},47:(s,e,t)=>{var r=t(410),a=function(c){return typeof c=="string"};function n(c,l){for(var m=[],h=0;h<c.length;h++){var w=c[h];w&&w!=="."&&(w===".."?m.length&&m[m.length-1]!==".."?m.pop():l&&m.push(".."):m.push(w))}return m}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o={};function u(c){return i.exec(c).slice(1)}o.resolve=function(){for(var c="",l=!1,m=arguments.length-1;m>=-1&&!l;m--){var h=m>=0?arguments[m]:Ye.cwd();if(!a(h))throw new TypeError("Arguments to path.resolve must be strings");h&&(c=h+"/"+c,l=h.charAt(0)==="/")}return(l?"/":"")+(c=n(c.split("/"),!l).join("/"))||"."},o.normalize=function(c){var l=o.isAbsolute(c),m=c.substr(-1)==="/";return(c=n(c.split("/"),!l).join("/"))||l||(c="."),c&&m&&(c+="/"),(l?"/":"")+c},o.isAbsolute=function(c){return c.charAt(0)==="/"},o.join=function(){for(var c="",l=0;l<arguments.length;l++){var m=arguments[l];if(!a(m))throw new TypeError("Arguments to path.join must be strings");m&&(c+=c?"/"+m:m)}return o.normalize(c)},o.relative=function(c,l){function m(A){for(var E=0;E<A.length&&A[E]==="";E++);for(var k=A.length-1;k>=0&&A[k]==="";k--);return E>k?[]:A.slice(E,k+1)}c=o.resolve(c).substr(1),l=o.resolve(l).substr(1);for(var h=m(c.split("/")),w=m(l.split("/")),g=Math.min(h.length,w.length),p=g,d=0;d<g;d++)if(h[d]!==w[d]){p=d;break}var S=[];for(d=p;d<h.length;d++)S.push("..");return(S=S.concat(w.slice(p))).join("/")},o._makeLong=function(c){return c},o.dirname=function(c){var l=u(c),m=l[0],h=l[1];return m||h?(h&&(h=h.substr(0,h.length-1)),m+h):"."},o.basename=function(c,l){var m=u(c)[2];return l&&m.substr(-1*l.length)===l&&(m=m.substr(0,m.length-l.length)),m},o.extname=function(c){return u(c)[3]},o.format=function(c){if(!r.isObject(c))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof c);var l=c.root||"";if(!a(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof c.root);return(c.dir?c.dir+o.sep:"")+(c.base||"")},o.parse=function(c){if(!a(c))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof c);var l=u(c);if(!l||l.length!==4)throw new TypeError("Invalid path '"+c+"'");return l[1]=l[1]||"",l[2]=l[2]||"",l[3]=l[3]||"",{root:l[0],dir:l[0]+l[1].slice(0,l[1].length-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},o.sep="/",o.delimiter=":",s.exports=o},101:function(s,e,t){var r;s=t.nmd(s),function(){var a=(s&&s.exports,typeof Lt=="object"&&Lt);a.global!==a&&a.window;var n=function(l){this.message=l};(n.prototype=new Error).name="InvalidCharacterError";var i=function(l){throw new n(l)},o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=/[\t\n\f\r ]/g,c={encode:function(l){l=String(l),/[^\0-\xFF]/.test(l)&&i("The string to be encoded contains characters outside of the Latin1 range.");for(var m,h,w,g,p=l.length%3,d="",S=-1,A=l.length-p;++S<A;)m=l.charCodeAt(S)<<16,h=l.charCodeAt(++S)<<8,w=l.charCodeAt(++S),d+=o.charAt((g=m+h+w)>>18&63)+o.charAt(g>>12&63)+o.charAt(g>>6&63)+o.charAt(63&g);return p==2?(m=l.charCodeAt(S)<<8,h=l.charCodeAt(++S),d+=o.charAt((g=m+h)>>10)+o.charAt(g>>4&63)+o.charAt(g<<2&63)+"="):p==1&&(g=l.charCodeAt(S),d+=o.charAt(g>>2)+o.charAt(g<<4&63)+"=="),d},decode:function(l){var m=(l=String(l).replace(u,"")).length;m%4==0&&(m=(l=l.replace(/==?$/,"")).length),(m%4==1||/[^+a-zA-Z0-9/]/.test(l))&&i("Invalid character: the string to be decoded is not correctly encoded.");for(var h,w,g=0,p="",d=-1;++d<m;)w=o.indexOf(l.charAt(d)),h=g%4?64*h+w:w,g++%4&&(p+=String.fromCharCode(255&h>>(-2*g&6)));return p},version:"1.0.0"};(r=function(){return c}.call(e,t,e,s))===void 0||(s.exports=r)}()},135:s=>{function e(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}s.exports=function(t){return t!=null&&(e(t)||function(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&e(r.slice(0,0))}(t)||!!t._isBuffer)}},172:(s,e)=>{e.d=function(t){if(!t)return 0;for(var r=(t=t.toString()).length,a=t.length;a--;){var n=t.charCodeAt(a);56320<=n&&n<=57343&&a--,127<n&&n<=2047?r++:2047<n&&n<=65535&&(r+=2)}return r}},285:(s,e,t)=>{var r=t(2);s.exports=function(S){return S?(S.substr(0,2)==="{}"&&(S="\\{\\}"+S.substr(2)),d(function(A){return A.split("\\\\").join(a).split("\\{").join(n).split("\\}").join(i).split("\\,").join(o).split("\\.").join(u)}(S),!0).map(l)):[]};var a="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",i="\0CLOSE"+Math.random()+"\0",o="\0COMMA"+Math.random()+"\0",u="\0PERIOD"+Math.random()+"\0";function c(S){return parseInt(S,10)==S?parseInt(S,10):S.charCodeAt(0)}function l(S){return S.split(a).join("\\").split(n).join("{").split(i).join("}").split(o).join(",").split(u).join(".")}function m(S){if(!S)return[""];var A=[],E=r("{","}",S);if(!E)return S.split(",");var k=E.pre,I=E.body,R=E.post,j=k.split(",");j[j.length-1]+="{"+I+"}";var K=m(R);return R.length&&(j[j.length-1]+=K.shift(),j.push.apply(j,K)),A.push.apply(A,j),A}function h(S){return"{"+S+"}"}function w(S){return/^-?0\d/.test(S)}function g(S,A){return S<=A}function p(S,A){return S>=A}function d(S,A){var E=[],k=r("{","}",S);if(!k)return[S];var I=k.pre,R=k.post.length?d(k.post,!1):[""];if(/\$$/.test(k.pre))for(var j=0;j<R.length;j++){var K=I+"{"+k.body+"}"+R[j];E.push(K)}else{var C,Y,Q=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(k.body),X=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(k.body),H=Q||X,ye=k.body.indexOf(",")>=0;if(!H&&!ye)return k.post.match(/,(?!,).*\}/)?d(S=k.pre+"{"+k.body+i+k.post):[S];if(H)C=k.body.split(/\.\./);else if((C=m(k.body)).length===1&&(C=d(C[0],!1).map(h)).length===1)return R.map(function($t){return k.pre+C[0]+$t});if(H){var he=c(C[0]),xe=c(C[1]),W=Math.max(C[0].length,C[1].length),pe=C.length==3?Math.abs(c(C[2])):1,ue=g;xe<he&&(pe*=-1,ue=p);var q=C.some(w);Y=[];for(var _=he;ue(_,xe);_+=pe){var F;if(X)(F=String.fromCharCode(_))==="\\"&&(F="");else if(F=String(_),q){var ee=W-F.length;if(ee>0){var ae=new Array(ee+1).join("0");F=_<0?"-"+ae+F.slice(1):ae+F}}Y.push(F)}}else{Y=[];for(var Ae=0;Ae<C.length;Ae++)Y.push.apply(Y,d(C[Ae],!1))}for(Ae=0;Ae<Y.length;Ae++)for(j=0;j<R.length;j++)K=I+Y[Ae]+R[j],(!A||H||K)&&E.push(K)}return E}},298:s=>{var e,t;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(r,a){return r<<a|r>>>32-a},rotr:function(r,a){return r<<32-a|r>>>a},endian:function(r){if(r.constructor==Number)return 16711935&t.rotl(r,8)|4278255360&t.rotl(r,24);for(var a=0;a<r.length;a++)r[a]=t.endian(r[a]);return r},randomBytes:function(r){for(var a=[];r>0;r--)a.push(Math.floor(256*Math.random()));return a},bytesToWords:function(r){for(var a=[],n=0,i=0;n<r.length;n++,i+=8)a[i>>>5]|=r[n]<<24-i%32;return a},wordsToBytes:function(r){for(var a=[],n=0;n<32*r.length;n+=8)a.push(r[n>>>5]>>>24-n%32&255);return a},bytesToHex:function(r){for(var a=[],n=0;n<r.length;n++)a.push((r[n]>>>4).toString(16)),a.push((15&r[n]).toString(16));return a.join("")},hexToBytes:function(r){for(var a=[],n=0;n<r.length;n+=2)a.push(parseInt(r.substr(n,2),16));return a},bytesToBase64:function(r){for(var a=[],n=0;n<r.length;n+=3)for(var i=r[n]<<16|r[n+1]<<8|r[n+2],o=0;o<4;o++)8*n+6*o<=8*r.length?a.push(e.charAt(i>>>6*(3-o)&63)):a.push("=");return a.join("")},base64ToBytes:function(r){r=r.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],n=0,i=0;n<r.length;i=++n%4)i!=0&&a.push((e.indexOf(r.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|e.indexOf(r.charAt(n))>>>6-2*i);return a}},s.exports=t},345:()=>{},388:()=>{},410:()=>{},526:s=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var r=[],a=0;a<t.length;a++)r.push(255&t.charCodeAt(a));return r},bytesToString:function(t){for(var r=[],a=0;a<t.length;a++)r.push(String.fromCharCode(t[a]));return r.join("")}}};s.exports=e},542:(s,e,t)=>{(function(){var r=t(298),a=t(526).utf8,n=t(135),i=t(526).bin,o=function(u,c){u.constructor==String?u=c&&c.encoding==="binary"?i.stringToBytes(u):a.stringToBytes(u):n(u)?u=Array.prototype.slice.call(u,0):Array.isArray(u)||u.constructor===Uint8Array||(u=u.toString());for(var l=r.bytesToWords(u),m=8*u.length,h=1732584193,w=-271733879,g=-1732584194,p=271733878,d=0;d<l.length;d++)l[d]=16711935&(l[d]<<8|l[d]>>>24)|4278255360&(l[d]<<24|l[d]>>>8);l[m>>>5]|=128<<m%32,l[14+(m+64>>>9<<4)]=m;var S=o._ff,A=o._gg,E=o._hh,k=o._ii;for(d=0;d<l.length;d+=16){var I=h,R=w,j=g,K=p;h=S(h,w,g,p,l[d+0],7,-680876936),p=S(p,h,w,g,l[d+1],12,-389564586),g=S(g,p,h,w,l[d+2],17,606105819),w=S(w,g,p,h,l[d+3],22,-1044525330),h=S(h,w,g,p,l[d+4],7,-176418897),p=S(p,h,w,g,l[d+5],12,1200080426),g=S(g,p,h,w,l[d+6],17,-1473231341),w=S(w,g,p,h,l[d+7],22,-45705983),h=S(h,w,g,p,l[d+8],7,1770035416),p=S(p,h,w,g,l[d+9],12,-1958414417),g=S(g,p,h,w,l[d+10],17,-42063),w=S(w,g,p,h,l[d+11],22,-1990404162),h=S(h,w,g,p,l[d+12],7,1804603682),p=S(p,h,w,g,l[d+13],12,-40341101),g=S(g,p,h,w,l[d+14],17,-1502002290),h=A(h,w=S(w,g,p,h,l[d+15],22,1236535329),g,p,l[d+1],5,-165796510),p=A(p,h,w,g,l[d+6],9,-1069501632),g=A(g,p,h,w,l[d+11],14,643717713),w=A(w,g,p,h,l[d+0],20,-373897302),h=A(h,w,g,p,l[d+5],5,-701558691),p=A(p,h,w,g,l[d+10],9,38016083),g=A(g,p,h,w,l[d+15],14,-660478335),w=A(w,g,p,h,l[d+4],20,-405537848),h=A(h,w,g,p,l[d+9],5,568446438),p=A(p,h,w,g,l[d+14],9,-1019803690),g=A(g,p,h,w,l[d+3],14,-187363961),w=A(w,g,p,h,l[d+8],20,1163531501),h=A(h,w,g,p,l[d+13],5,-1444681467),p=A(p,h,w,g,l[d+2],9,-51403784),g=A(g,p,h,w,l[d+7],14,1735328473),h=E(h,w=A(w,g,p,h,l[d+12],20,-1926607734),g,p,l[d+5],4,-378558),p=E(p,h,w,g,l[d+8],11,-2022574463),g=E(g,p,h,w,l[d+11],16,1839030562),w=E(w,g,p,h,l[d+14],23,-35309556),h=E(h,w,g,p,l[d+1],4,-1530992060),p=E(p,h,w,g,l[d+4],11,1272893353),g=E(g,p,h,w,l[d+7],16,-155497632),w=E(w,g,p,h,l[d+10],23,-1094730640),h=E(h,w,g,p,l[d+13],4,681279174),p=E(p,h,w,g,l[d+0],11,-358537222),g=E(g,p,h,w,l[d+3],16,-722521979),w=E(w,g,p,h,l[d+6],23,76029189),h=E(h,w,g,p,l[d+9],4,-640364487),p=E(p,h,w,g,l[d+12],11,-421815835),g=E(g,p,h,w,l[d+15],16,530742520),h=k(h,w=E(w,g,p,h,l[d+2],23,-995338651),g,p,l[d+0],6,-198630844),p=k(p,h,w,g,l[d+7],10,1126891415),g=k(g,p,h,w,l[d+14],15,-1416354905),w=k(w,g,p,h,l[d+5],21,-57434055),h=k(h,w,g,p,l[d+12],6,1700485571),p=k(p,h,w,g,l[d+3],10,-1894986606),g=k(g,p,h,w,l[d+10],15,-1051523),w=k(w,g,p,h,l[d+1],21,-2054922799),h=k(h,w,g,p,l[d+8],6,1873313359),p=k(p,h,w,g,l[d+15],10,-30611744),g=k(g,p,h,w,l[d+6],15,-1560198380),w=k(w,g,p,h,l[d+13],21,1309151649),h=k(h,w,g,p,l[d+4],6,-145523070),p=k(p,h,w,g,l[d+11],10,-1120210379),g=k(g,p,h,w,l[d+2],15,718787259),w=k(w,g,p,h,l[d+9],21,-343485551),h=h+I>>>0,w=w+R>>>0,g=g+j>>>0,p=p+K>>>0}return r.endian([h,w,g,p])};o._ff=function(u,c,l,m,h,w,g){var p=u+(c&l|~c&m)+(h>>>0)+g;return(p<<w|p>>>32-w)+c},o._gg=function(u,c,l,m,h,w,g){var p=u+(c&m|l&~m)+(h>>>0)+g;return(p<<w|p>>>32-w)+c},o._hh=function(u,c,l,m,h,w,g){var p=u+(c^l^m)+(h>>>0)+g;return(p<<w|p>>>32-w)+c},o._ii=function(u,c,l,m,h,w,g){var p=u+(l^(c|~m))+(h>>>0)+g;return(p<<w|p>>>32-w)+c},o._blocksize=16,o._digestsize=16,s.exports=function(u,c){if(u==null)throw new Error("Illegal argument "+u);var l=r.wordsToBytes(o(u,c));return c&&c.asBytes?l:c&&c.asString?i.bytesToString(l):r.bytesToHex(l)}})()},647:(s,e)=>{var t=Object.prototype.hasOwnProperty;function r(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch(i){return null}}function a(n){try{return encodeURIComponent(n)}catch(i){return null}}e.stringify=function(n,i){i=i||"";var o,u,c=[];for(u in typeof i!="string"&&(i="?"),n)if(t.call(n,u)){if((o=n[u])||o!=null&&!isNaN(o)||(o=""),u=a(u),o=a(o),u===null||o===null)continue;c.push(u+"="+o)}return c.length?i+c.join("&"):""},e.parse=function(n){for(var i,o=/([^=?#&]+)=?([^&]*)/g,u={};i=o.exec(n);){var c=r(i[1]),l=r(i[2]);c===null||l===null||c in u||(u[c]=l)}return u}},670:s=>{s.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}},737:(s,e,t)=>{var r=t(670),a=t(647),n=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,i=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,u=/:\d+$/,c=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,l=/^[a-zA-Z]:/;function m(A){return(A||"").toString().replace(n,"")}var h=[["#","hash"],["?","query"],function(A,E){return p(E.protocol)?A.replace(/\\/g,"/"):A},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],w={hash:1,query:1};function g(A){var E,k=(typeof window<"u"?window:typeof Lt<"u"?Lt:typeof self<"u"?self:{}).location||{},I={},R=typeof(A=A||k);if(A.protocol==="blob:")I=new S(unescape(A.pathname),{});else if(R==="string")for(E in I=new S(A,{}),w)delete I[E];else if(R==="object"){for(E in A)E in w||(I[E]=A[E]);I.slashes===void 0&&(I.slashes=o.test(A.href))}return I}function p(A){return A==="file:"||A==="ftp:"||A==="http:"||A==="https:"||A==="ws:"||A==="wss:"}function d(A,E){A=(A=m(A)).replace(i,""),E=E||{};var k,I=c.exec(A),R=I[1]?I[1].toLowerCase():"",j=!!I[2],K=!!I[3],C=0;return j?K?(k=I[2]+I[3]+I[4],C=I[2].length+I[3].length):(k=I[2]+I[4],C=I[2].length):K?(k=I[3]+I[4],C=I[3].length):k=I[4],R==="file:"?C>=2&&(k=k.slice(2)):p(R)?k=I[4]:R?j&&(k=k.slice(2)):C>=2&&p(E.protocol)&&(k=I[4]),{protocol:R,slashes:j||p(R),slashesCount:C,rest:k}}function S(A,E,k){if(A=(A=m(A)).replace(i,""),!(this instanceof S))return new S(A,E,k);var I,R,j,K,C,Y,Q=h.slice(),X=typeof E,H=this,ye=0;for(X!=="object"&&X!=="string"&&(k=E,E=null),k&&typeof k!="function"&&(k=a.parse),I=!(R=d(A||"",E=g(E))).protocol&&!R.slashes,H.slashes=R.slashes||I&&E.slashes,H.protocol=R.protocol||E.protocol||"",A=R.rest,(R.protocol==="file:"&&(R.slashesCount!==2||l.test(A))||!R.slashes&&(R.protocol||R.slashesCount<2||!p(H.protocol)))&&(Q[3]=[/(.*)/,"pathname"]);ye<Q.length;ye++)typeof(K=Q[ye])!="function"?(j=K[0],Y=K[1],j!=j?H[Y]=A:typeof j=="string"?~(C=j==="@"?A.lastIndexOf(j):A.indexOf(j))&&(typeof K[2]=="number"?(H[Y]=A.slice(0,C),A=A.slice(C+K[2])):(H[Y]=A.slice(C),A=A.slice(0,C))):(C=j.exec(A))&&(H[Y]=C[1],A=A.slice(0,C.index)),H[Y]=H[Y]||I&&K[3]&&E[Y]||"",K[4]&&(H[Y]=H[Y].toLowerCase())):A=K(A,H);k&&(H.query=k(H.query)),I&&E.slashes&&H.pathname.charAt(0)!=="/"&&(H.pathname!==""||E.pathname!=="")&&(H.pathname=function(he,xe){if(he==="")return xe;for(var W=(xe||"/").split("/").slice(0,-1).concat(he.split("/")),pe=W.length,ue=W[pe-1],q=!1,_=0;pe--;)W[pe]==="."?W.splice(pe,1):W[pe]===".."?(W.splice(pe,1),_++):_&&(pe===0&&(q=!0),W.splice(pe,1),_--);return q&&W.unshift(""),ue!=="."&&ue!==".."||W.push(""),W.join("/")}(H.pathname,E.pathname)),H.pathname.charAt(0)!=="/"&&p(H.protocol)&&(H.pathname="/"+H.pathname),r(H.port,H.protocol)||(H.host=H.hostname,H.port=""),H.username=H.password="",H.auth&&(~(C=H.auth.indexOf(":"))?(H.username=H.auth.slice(0,C),H.username=encodeURIComponent(decodeURIComponent(H.username)),H.password=H.auth.slice(C+1),H.password=encodeURIComponent(decodeURIComponent(H.password))):H.username=encodeURIComponent(decodeURIComponent(H.auth)),H.auth=H.password?H.username+":"+H.password:H.username),H.origin=H.protocol!=="file:"&&p(H.protocol)&&H.host?H.protocol+"//"+H.host:"null",H.href=H.toString()}S.prototype={set:function(A,E,k){var I=this;switch(A){case"query":typeof E=="string"&&E.length&&(E=(k||a.parse)(E)),I[A]=E;break;case"port":I[A]=E,r(E,I.protocol)?E&&(I.host=I.hostname+":"+E):(I.host=I.hostname,I[A]="");break;case"hostname":I[A]=E,I.port&&(E+=":"+I.port),I.host=E;break;case"host":I[A]=E,u.test(E)?(E=E.split(":"),I.port=E.pop(),I.hostname=E.join(":")):(I.hostname=E,I.port="");break;case"protocol":I.protocol=E.toLowerCase(),I.slashes=!k;break;case"pathname":case"hash":if(E){var R=A==="pathname"?"/":"#";I[A]=E.charAt(0)!==R?R+E:E}else I[A]=E;break;case"username":case"password":I[A]=encodeURIComponent(E);break;case"auth":var j=E.indexOf(":");~j?(I.username=E.slice(0,j),I.username=encodeURIComponent(decodeURIComponent(I.username)),I.password=E.slice(j+1),I.password=encodeURIComponent(decodeURIComponent(I.password))):I.username=encodeURIComponent(decodeURIComponent(E))}for(var K=0;K<h.length;K++){var C=h[K];C[4]&&(I[C[1]]=I[C[1]].toLowerCase())}return I.auth=I.password?I.username+":"+I.password:I.username,I.origin=I.protocol!=="file:"&&p(I.protocol)&&I.host?I.protocol+"//"+I.host:"null",I.href=I.toString(),I},toString:function(A){A&&typeof A=="function"||(A=a.stringify);var E,k=this,I=k.host,R=k.protocol;R&&R.charAt(R.length-1)!==":"&&(R+=":");var j=R+(k.protocol&&k.slashes||p(k.protocol)?"//":"");return k.username?(j+=k.username,k.password&&(j+=":"+k.password),j+="@"):k.password?(j+=":"+k.password,j+="@"):k.protocol!=="file:"&&p(k.protocol)&&!I&&k.pathname!=="/"&&(j+="@"),(I[I.length-1]===":"||u.test(k.hostname)&&!k.port)&&(I+=":"),j+=I+k.pathname,(E=typeof k.query=="object"?A(k.query):k.query)&&(j+=E.charAt(0)!=="?"?"?"+E:E),k.hash&&(j+=k.hash),j}},S.extractProtocol=d,S.location=g,S.trimLeft=m,S.qs=a,s.exports=S},800:()=>{},805:()=>{},829:s=>{function e(c){return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},e(c)}function t(c){var l=typeof Map=="function"?new Map:void 0;return t=function(m){if(m===null||(h=m,Function.toString.call(h).indexOf("[native code]")===-1))return m;var h;if(typeof m!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(m))return l.get(m);l.set(m,w)}function w(){return r(m,arguments,n(this).constructor)}return w.prototype=Object.create(m.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),a(w,m)},t(c)}function r(c,l,m){return r=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(h){return!1}}()?Reflect.construct:function(h,w,g){var p=[null];p.push.apply(p,w);var d=new(Function.bind.apply(h,p));return g&&a(d,g.prototype),d},r.apply(null,arguments)}function a(c,l){return a=Object.setPrototypeOf||function(m,h){return m.__proto__=h,m},a(c,l)}function n(c){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(l){return l.__proto__||Object.getPrototypeOf(l)},n(c)}var i=function(c){function l(m){var h;return function(w,g){if(!(w instanceof g))throw new TypeError("Cannot call a class as a function")}(this,l),(h=function(w,g){return!g||e(g)!=="object"&&typeof g!="function"?function(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}(w):g}(this,n(l).call(this,m))).name="ObjectPrototypeMutationError",h}return function(m,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(h&&h.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),h&&a(m,h)}(l,c),l}(t(Error));function o(c,l){for(var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},h=l.split("."),w=h.length,g=function(S){var A=h[S];if(!c)return{v:void 0};if(A==="+"){if(Array.isArray(c))return{v:c.map(function(k,I){var R=h.slice(S+1);return R.length>0?o(k,R.join("."),m):m(c,I,h,S)})};var E=h.slice(0,S).join(".");throw new Error("Object at wildcard (".concat(E,") is not an array"))}c=m(c,A,h,S)},p=0;p<w;p++){var d=g(p);if(e(d)==="object")return d.v}return c}function u(c,l){return c.length===l+1}s.exports={set:function(c,l,m){if(e(c)!="object"||c===null||l===void 0)return c;if(typeof l=="number")return c[l]=m,c[l];try{return o(c,l,function(h,w,g,p){if(h===Reflect.getPrototypeOf({}))throw new i("Attempting to mutate Object.prototype");if(!h[w]){var d=Number.isInteger(Number(g[p+1])),S=g[p+1]==="+";h[w]=d||S?[]:{}}return u(g,p)&&(h[w]=m),h[w]})}catch(h){if(h instanceof i)throw h;return c}},get:function(c,l){if(e(c)!="object"||c===null||l===void 0)return c;if(typeof l=="number")return c[l];try{return o(c,l,function(m,h){return m[h]})}catch(m){return c}},has:function(c,l){var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e(c)!="object"||c===null||l===void 0)return!1;if(typeof l=="number")return l in c;try{var h=!1;return o(c,l,function(w,g,p,d){if(!u(p,d))return w&&w[g];h=m.own?w.hasOwnProperty(g):g in w}),h}catch(w){return!1}},hasOwn:function(c,l,m){return this.has(c,l,m||{own:!0})},isIn:function(c,l,m){var h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(e(c)!="object"||c===null||l===void 0)return!1;try{var w=!1,g=!1;return o(c,l,function(p,d,S,A){return w=w||p===m||!!p&&p[d]===m,g=u(S,A)&&e(p)==="object"&&d in p,p&&p[d]}),h.validPath?w&&g:w}catch(p){return!1}},ObjectPrototypeMutationError:i}}},ep={};function Se(s){var e=ep[s];if(e!==void 0)return e.exports;var t=ep[s]={id:s,loaded:!1,exports:{}};return $y[s].call(t.exports,t,t.exports,Se),t.loaded=!0,t.exports}Se.n=s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return Se.d(e,{a:e}),e},Se.d=(s,e)=>{for(var t in e)Se.o(e,t)&&!Se.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})},Se.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e),Se.nmd=s=>(s.paths=[],s.children||(s.children=[]),s);var Ky=Se(737),My=Se.n(Ky);function ym(s){if(!Cf(s))throw new Error("Parameter was not an error")}function Cf(s){return!!s&&typeof s=="object"&&(e=s,Object.prototype.toString.call(e)==="[object Error]")||s instanceof Error;var e}class xt extends Error{constructor(e,t){const r=[...arguments],{options:a,shortMessage:n}=function(o){let u,c="";if(o.length===0)u={};else if(Cf(o[0]))u={cause:o[0]},c=o.slice(1).join(" ")||"";else if(o[0]&&typeof o[0]=="object")u=Object.assign({},o[0]),c=o.slice(1).join(" ")||"";else{if(typeof o[0]!="string")throw new Error("Invalid arguments passed to Layerr");u={},c=c=o.join(" ")||""}return{options:u,shortMessage:c}}(r);let i=n;if(a.cause&&(i="".concat(i,": ").concat(a.cause.message)),super(i),this.message=i,a.name&&typeof a.name=="string"?this.name=a.name:this.name="Layerr",a.cause&&Object.defineProperty(this,"_cause",{value:a.cause}),Object.defineProperty(this,"_info",{value:{}}),a.info&&typeof a.info=="object"&&Object.assign(this._info,a.info),Error.captureStackTrace){const o=a.constructorOpt||this.constructor;Error.captureStackTrace(this,o)}}static cause(e){return ym(e),e._cause&&Cf(e._cause)?e._cause:null}static fullStack(e){var r;ym(e);const t=xt.cause(e);return t?"".concat(e.stack,"\ncaused by: ").concat(xt.fullStack(t)):(r=e.stack)!=null?r:""}static info(e){ym(e);const t={},r=xt.cause(e);return r&&Object.assign(t,xt.info(r)),e._info&&Object.assign(t,e._info),t}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e="".concat(e,": ").concat(this.message)),e}}var Hy=Se(47),Kh=Se.n(Hy);const tp="__PATH_SEPARATOR_POSIX__",sp="__PATH_SEPARATOR_WINDOWS__";function Pe(s){try{const e=s.replace(/\//g,tp).replace(/\\\\/g,sp);return encodeURIComponent(e).split(sp).join("\\\\").split(tp).join("/")}catch(e){throw new xt(e,"Failed encoding path")}}function rp(s){return s.startsWith("/")?s:"/"+s}function dc(s){let e=s;return e[0]!=="/"&&(e="/"+e),/^.+\/$/.test(e)&&(e=e.substr(0,e.length-1)),e}function Fy(s){let e=new(My())(s).pathname;return e.length<=0&&(e="/"),dc(e)}function Be(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return function(){return function(r){var a=[];if(r.length===0)return"";if(typeof r[0]!="string")throw new TypeError("Url must be a string. Received "+r[0]);if(r[0].match(/^[^/:]+:\/*$/)&&r.length>1){var n=r.shift();r[0]=n+r[0]}r[0].match(/^file:\/\/\//)?r[0]=r[0].replace(/^([^/:]+):\/*/,"$1:///"):r[0]=r[0].replace(/^([^/:]+):\/*/,"$1://");for(var i=0;i<r.length;i++){var o=r[i];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(i>0&&(o=o.replace(/^[\/]+/,"")),o=i<r.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),a.push(o))}var u=a.join("/"),c=(u=u.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return c.shift()+(c.length>0?"?":"")+c.join("&")}(typeof arguments[0]=="object"?arguments[0]:[].slice.call(arguments))}(e.reduce((r,a,n)=>((n===0||a!=="/"||a==="/"&&r[r.length-1]!=="/")&&r.push(a),r),[]))}var Jy=Se(542),Fo=Se.n(Jy);function ap(s,e){const t=s.url.replace("//",""),r=t.indexOf("/")==-1?"/":t.slice(t.indexOf("/")),a=s.method?s.method.toUpperCase():"GET",n=!!/(^|,)\s*auth\s*($|,)/.test(e.qop)&&"auth",i="00000000".concat(e.nc).slice(-8),o=function(h,w,g,p,d,S,A){const E=A||Fo()("".concat(w,":").concat(g,":").concat(p));return h&&h.toLowerCase()==="md5-sess"?Fo()("".concat(E,":").concat(d,":").concat(S)):E}(e.algorithm,e.username,e.realm,e.password,e.nonce,e.cnonce,e.ha1),u=Fo()("".concat(a,":").concat(r)),c=n?Fo()("".concat(o,":").concat(e.nonce,":").concat(i,":").concat(e.cnonce,":").concat(n,":").concat(u)):Fo()("".concat(o,":").concat(e.nonce,":").concat(u)),l={username:e.username,realm:e.realm,nonce:e.nonce,uri:r,qop:n,response:c,nc:i,cnonce:e.cnonce,algorithm:e.algorithm,opaque:e.opaque},m=[];for(const h in l)l[h]&&(h==="qop"||h==="nc"||h==="algorithm"?m.push("".concat(h,"=").concat(l[h])):m.push("".concat(h,'="').concat(l[h],'"')));return"Digest ".concat(m.join(", "))}function Tg(s){return(s.headers&&s.headers.get("www-authenticate")||"").split(/\s/)[0].toLowerCase()==="digest"}var qy=Se(101),Rg=Se.n(qy);function np(s){return Rg().decode(s)}function ip(s,e){var t;return"Basic ".concat((t="".concat(s,":").concat(e),Rg().encode(t)))}const op=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:typeof window<"u"?window:globalThis,_y=op.fetch.bind(op);let Ut=function(s){return s.Auto="auto",s.Digest="digest",s.None="none",s.Password="password",s.Token="token",s}({}),da=function(s){return s.DataTypeNoLength="data-type-no-length",s.InvalidAuthType="invalid-auth-type",s.InvalidOutputFormat="invalid-output-format",s.LinkUnsupportedAuthType="link-unsupported-auth",s.InvalidUpdateRange="invalid-update-range",s.NotSupported="not-supported",s}({});function Lg(s,e,t,r,a){switch(s.authType){case Ut.Auto:e&&t&&(s.headers.Authorization=ip(e,t));break;case Ut.Digest:s.digest=function(i,o,u){return{username:i,password:o,ha1:u,nc:0,algorithm:"md5",hasDigestAuth:!1}}(e,t,a);break;case Ut.None:break;case Ut.Password:s.headers.Authorization=ip(e,t);break;case Ut.Token:s.headers.Authorization="".concat((n=r).token_type," ").concat(n.access_token);break;default:throw new xt({info:{code:da.InvalidAuthType}},"Invalid auth type: ".concat(s.authType))}var n}Se(345),Se(800);const up="@@HOTPATCHER",Wy=()=>{};function vm(s){return{original:s,methods:[s],final:!1}}class Gy{constructor(){this._configuration={registry:{},getEmptyAction:"null"},this.__type__=up}get configuration(){return this._configuration}get getEmptyAction(){return this.configuration.getEmptyAction}set getEmptyAction(e){this.configuration.getEmptyAction=e}control(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e||e.__type__!==up)throw new Error("Failed taking control of target HotPatcher instance: Invalid type or object");return Object.keys(e.configuration.registry).forEach(r=>{this.configuration.registry.hasOwnProperty(r)?t&&(this.configuration.registry[r]=Object.assign({},e.configuration.registry[r])):this.configuration.registry[r]=Object.assign({},e.configuration.registry[r])}),e._configuration=this.configuration,this}execute(e){const t=this.get(e)||Wy;for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];return t(...a)}get(e){const t=this.configuration.registry[e];if(!t)switch(this.getEmptyAction){case"null":return null;case"throw":throw new Error("Failed handling method request: No method provided for override: ".concat(e));default:throw new Error("Failed handling request which resulted in an empty method: Invalid empty-action specified: ".concat(this.getEmptyAction))}return function(){for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];if(a.length===0)throw new Error("Failed creating sequence: No functions provided");return function(){for(var i=arguments.length,o=new Array(i),u=0;u<i;u++)o[u]=arguments[u];let c=o;const l=this;for(;a.length>0;)c=[a.shift().apply(l,c)];return c[0]}}(...t.methods)}isPatched(e){return!!this.configuration.registry[e]}patch(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{chain:a=!1}=r;if(this.configuration.registry[e]&&this.configuration.registry[e].final)throw new Error("Failed patching '".concat(e,"': Method marked as being final"));if(typeof t!="function")throw new Error("Failed patching '".concat(e,"': Provided method is not a function"));if(a)this.configuration.registry[e]?this.configuration.registry[e].methods.push(t):this.configuration.registry[e]=vm(t);else if(this.isPatched(e)){const{original:n}=this.configuration.registry[e];this.configuration.registry[e]=Object.assign(vm(t),{original:n})}else this.configuration.registry[e]=vm(t);return this}patchInline(e,t){this.isPatched(e)||this.patch(e,t);for(var r=arguments.length,a=new Array(r>2?r-2:0),n=2;n<r;n++)a[n-2]=arguments[n];return this.execute(e,...a)}plugin(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return r.forEach(n=>{this.patch(e,n,{chain:!0})}),this}restore(e){if(!this.isPatched(e))throw new Error("Failed restoring method: No method present for key: ".concat(e));if(typeof this.configuration.registry[e].original!="function")throw new Error("Failed restoring method: Original method not found or of invalid type for key: ".concat(e));return this.configuration.registry[e].methods=[this.configuration.registry[e].original],this}setFinal(e){if(!this.configuration.registry.hasOwnProperty(e))throw new Error("Failed marking '".concat(e,"' as final: No method found for key"));return this.configuration.registry[e].final=!0,this}}let bm=null;function Ug(){return bm||(bm=new Gy),bm}function Mh(s){return function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(s)?Object.assign({},s):Object.setPrototypeOf(Object.assign({},s),Object.getPrototypeOf(s))}function lp(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];let r=null,a=[...e];for(;a.length>0;){const n=a.shift();r=r?jg(r,n):Mh(n)}return r}function jg(s,e){const t=Mh(s);return Object.keys(e).forEach(r=>{t.hasOwnProperty(r)?Array.isArray(e[r])?t[r]=Array.isArray(t[r])?[...t[r],...e[r]]:[...e[r]]:typeof e[r]=="object"&&e[r]?t[r]=typeof t[r]=="object"&&t[r]?jg(t[r],e[r]):Mh(e[r]):t[r]=e[r]:t[r]=e[r]}),t}function Xy(s){const e={};for(const t of s.keys())e[t]=s.get(t);return e}function If(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];if(e.length===0)return{};const r={};return e.reduce((a,n)=>(Object.keys(n).forEach(i=>{const o=i.toLowerCase();r.hasOwnProperty(o)?a[r[o]]=n[i]:(r[o]=i,a[i]=n[i])}),a),{})}Se(805);const zy=typeof ArrayBuffer=="function",{toString:Yy}=Object.prototype;function $g(s){return zy&&(s instanceof ArrayBuffer||Yy.call(s)==="[object ArrayBuffer]")}function Kg(s){return s!=null&&s.constructor!=null&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s)}function fd(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}function xf(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const Mg=fd(function(s){const e=s._digest;return delete s._digest,e.hasDigestAuth&&(s=lp(s,{headers:{Authorization:ap(s,e)}})),xf(Hh(s),function(t){let r=!1;return a=function(i){return r?i:t},(n=function(){if(t.status==401)return e.hasDigestAuth=function(i,o){if(!Tg(i))return!1;const u=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;for(;;){const c=i.headers&&i.headers.get("www-authenticate")||"",l=u.exec(c);if(!l)break;o[l[1]]=l[2]||l[3]}return o.nc+=1,o.cnonce=function(){let c="";for(let l=0;l<32;++l)c="".concat(c).concat("abcdef0123456789"[Math.floor(16*Math.random())]);return c}(),!0}(t,e),function(){if(e.hasDigestAuth)return xf(Hh(s=lp(s,{headers:{Authorization:ap(s,e)}})),function(i){return i.status==401?e.hasDigestAuth=!1:e.nc++,r=!0,i})}();e.nc++}())&&n.then?n.then(a):a(n);var a,n})}),Qy=fd(function(s,e){return xf(Hh(s),function(t){return t.ok?(e.authType=Ut.Password,t):t.status==401&&Tg(t)?(e.authType=Ut.Digest,Lg(e,e.username,e.password,void 0,void 0),s._digest=e.digest,Mg(s)):t})}),et=fd(function(s,e){return e.authType===Ut.Auto?Qy(s,e):s._digest?Mg(s):Hh(s)});function tt(s,e,t){const r=Mh(s);return r.headers=If(e.headers,r.headers||{},t.headers||{}),t.data!==void 0&&(r.data=t.data),t.signal&&(r.signal=t.signal),e.httpAgent&&(r.httpAgent=e.httpAgent),e.httpsAgent&&(r.httpsAgent=e.httpsAgent),e.digest&&(r._digest=e.digest),typeof e.withCredentials=="boolean"&&(r.withCredentials=e.withCredentials),r}function Hh(s){const e=Ug();return e.patchInline("request",t=>e.patchInline("fetch",_y,t.url,function(r){let a={};const n={method:r.method};if(r.headers&&(a=If(a,r.headers)),r.data!==void 0){const[i,o]=function(u){if(typeof u=="string")return[u,{}];if(Kg(u))return[u,{}];if($g(u))return[u,{}];if(u&&typeof u=="object")return[JSON.stringify(u),{"content-type":"application/json"}];throw new Error("Unable to convert request body: Unexpected body type: "+typeof u)}(r.data);n.body=i,a=If(a,o)}return r.signal&&(n.signal=r.signal),r.withCredentials&&(n.credentials="include"),n.headers=a,n}(t)),s)}var Zy=Se(285);const Fh=s=>{if(typeof s!="string")throw new TypeError("invalid pattern");if(s.length>65536)throw new TypeError("pattern is too long")},e0={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Jo=s=>s.replace(/[[\]\\-]/g,"\\$&"),cp=s=>s.join(""),t0=(s,e)=>{const t=e;if(s.charAt(t)!=="[")throw new Error("not in a brace expression");const r=[],a=[];let n=t+1,i=!1,o=!1,u=!1,c=!1,l=t,m="";e:for(;n<s.length;){const p=s.charAt(n);if(p!=="!"&&p!=="^"||n!==t+1){if(p==="]"&&i&&!u){l=n+1;break}if(i=!0,p!=="\\"||u){if(p==="["&&!u){for(const[d,[S,A,E]]of Object.entries(e0))if(s.startsWith(d,n)){if(m)return["$.",!1,s.length-t,!0];n+=d.length,E?a.push(S):r.push(S),o=o||A;continue e}}u=!1,m?(p>m?r.push(Jo(m)+"-"+Jo(p)):p===m&&r.push(Jo(p)),m="",n++):s.startsWith("-]",n+1)?(r.push(Jo(p+"-")),n+=2):s.startsWith("-",n+1)?(m=p,n+=2):(r.push(Jo(p)),n++)}else u=!0,n++}else c=!0,n++}if(l<n)return["",!1,0,!1];if(!r.length&&!a.length)return["$.",!1,s.length-t,!0];if(a.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!c)return[(h=r[0].length===2?r[0].slice(-1):r[0],h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,l-t,!1];var h;const w="["+(c?"^":"")+cp(r)+"]",g="["+(c?"":"^")+cp(a)+"]";return[r.length&&a.length?"("+w+"|"+g+")":r.length?w:g,o,l-t,!0]},lu=function(s){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?s.replace(/\[([^\/\\])\]/g,"$1"):s.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1")},s0=new Set(["!","?","+","*","@"]),hp=s=>s0.has(s),Am="(?!\\.)",r0=new Set(["[","."]),a0=new Set(["..","."]),n0=new Set("().*{}+?[]^$\\!"),dd="[^/]",mp=dd+"*?",fp=dd+"+?";var ze,at,Ms,ke,qe,Zr,Bn,ea,vs,On,Sc,Fn,Hg,ma,ah,Vf,Fg;const At=class At{constructor(e,t){Dt(this,Fn);Je(this,"type");Dt(this,ze);Dt(this,at);Dt(this,Ms,!1);Dt(this,ke,[]);Dt(this,qe);Dt(this,Zr);Dt(this,Bn);Dt(this,ea,!1);Dt(this,vs);Dt(this,On);Dt(this,Sc,!1);let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.type=e,e&&De(this,at,!0),De(this,qe,t),De(this,ze,M(this,qe)?M(M(this,qe),ze):this),De(this,vs,M(this,ze)===this?r:M(M(this,ze),vs)),De(this,Bn,M(this,ze)===this?[]:M(M(this,ze),Bn)),e!=="!"||M(M(this,ze),ea)||M(this,Bn).push(this),De(this,Zr,M(this,qe)?M(M(this,qe),ke).length:0)}get hasMagic(){if(M(this,at)!==void 0)return M(this,at);for(const e of M(this,ke))if(typeof e!="string"&&(e.type||e.hasMagic))return De(this,at,!0);return M(this,at)}toString(){return M(this,On)!==void 0?M(this,On):this.type?De(this,On,this.type+"("+M(this,ke).map(e=>String(e)).join("|")+")"):De(this,On,M(this,ke).map(e=>String(e)).join(""))}push(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const a of t)if(a!==""){if(typeof a!="string"&&!(a instanceof At&&M(a,qe)===this))throw new Error("invalid part: "+a);M(this,ke).push(a)}}toJSON(){var t;const e=this.type===null?M(this,ke).slice().map(r=>typeof r=="string"?r:r.toJSON()):[this.type,...M(this,ke).map(r=>r.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===M(this,ze)||M(M(this,ze),ea)&&((t=M(this,qe))==null?void 0:t.type)==="!")&&e.push({}),e}isStart(){var t;if(M(this,ze)===this)return!0;if(!((t=M(this,qe))!=null&&t.isStart()))return!1;if(M(this,Zr)===0)return!0;const e=M(this,qe);for(let r=0;r<M(this,Zr);r++){const a=M(e,ke)[r];if(!(a instanceof At&&a.type==="!"))return!1}return!0}isEnd(){var t,r,a;if(M(this,ze)===this||((t=M(this,qe))==null?void 0:t.type)==="!")return!0;if(!((r=M(this,qe))!=null&&r.isEnd()))return!1;if(!this.type)return(a=M(this,qe))==null?void 0:a.isEnd();const e=M(this,qe)?M(M(this,qe),ke).length:0;return M(this,Zr)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new At(this.type,e);for(const r of M(this,ke))t.copyIn(r);return t}static fromGlob(e){var a;let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new At(null,void 0,t);return er(a=At,ma,ah).call(a,e,r,0,t),r}toMMPattern(){if(this!==M(this,ze))return M(this,ze).toMMPattern();const e=this.toString(),[t,r,a,n]=this.toRegExpSource();if(!(a||M(this,at)||M(this,vs).nocase&&!M(this,vs).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return r;const i=(M(this,vs).nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp("^".concat(t,"$"),i),{_src:t,_glob:e})}get options(){return M(this,vs)}toRegExpSource(e){var u;const t=e!=null?e:!!M(this,vs).dot;if(M(this,ze)===this&&er(this,Fn,Hg).call(this),!this.type){const c=this.isStart()&&this.isEnd(),l=M(this,ke).map(w=>{var A;const[g,p,d,S]=typeof w=="string"?er(A=At,ma,Fg).call(A,w,M(this,at),c):w.toRegExpSource(e);return De(this,at,M(this,at)||d),De(this,Ms,M(this,Ms)||S),g}).join("");let m="";if(this.isStart()&&typeof M(this,ke)[0]=="string"&&(M(this,ke).length!==1||!a0.has(M(this,ke)[0]))){const w=r0,g=t&&w.has(l.charAt(0))||l.startsWith("\\.")&&w.has(l.charAt(2))||l.startsWith("\\.\\.")&&w.has(l.charAt(4)),p=!t&&!e&&w.has(l.charAt(0));m=g?"(?!(?:^|/)\\.\\.?(?:$|/))":p?Am:""}let h="";return this.isEnd()&&M(M(this,ze),ea)&&((u=M(this,qe))==null?void 0:u.type)==="!"&&(h="(?:$|\\/)"),[m+l+h,lu(l),De(this,at,!!M(this,at)),M(this,Ms)]}const r=this.type==="*"||this.type==="+",a=this.type==="!"?"(?:(?!(?:":"(?:";let n=er(this,Fn,Vf).call(this,t);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){const c=this.toString();return De(this,ke,[c]),this.type=null,De(this,at,void 0),[c,lu(this.toString()),!1,!1]}let i=!r||e||t?"":er(this,Fn,Vf).call(this,!0);i===n&&(i=""),i&&(n="(?:".concat(n,")(?:").concat(i,")*?"));let o="";return o=this.type==="!"&&M(this,Sc)?(this.isStart()&&!t?Am:"")+fp:a+n+(this.type==="!"?"))"+(!this.isStart()||t||e?"":Am)+mp+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":")".concat(this.type)),[o,lu(n),De(this,at,!!M(this,at)),M(this,Ms)]}};ze=new WeakMap,at=new WeakMap,Ms=new WeakMap,ke=new WeakMap,qe=new WeakMap,Zr=new WeakMap,Bn=new WeakMap,ea=new WeakMap,vs=new WeakMap,On=new WeakMap,Sc=new WeakMap,Fn=new WeakSet,Hg=function(){if(this!==M(this,ze))throw new Error("should only call on root");if(M(this,ea))return this;let e;for(this.toString(),De(this,ea,!0);e=M(this,Bn).pop();){if(e.type!=="!")continue;let t=e,r=M(t,qe);for(;r;){for(let a=M(t,Zr)+1;!r.type&&a<M(r,ke).length;a++)for(const n of M(e,ke)){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(M(r,ke)[a])}t=r,r=M(t,qe)}}return this},ma=new WeakSet,ah=function(e,t,r,a){var w,g;let n=!1,i=!1,o=-1,u=!1;if(t.type===null){let p=r,d="";for(;p<e.length;){const S=e.charAt(p++);if(n||S==="\\")n=!n,d+=S;else if(i)p===o+1?S!=="^"&&S!=="!"||(u=!0):S!=="]"||p===o+2&&u||(i=!1),d+=S;else if(S!=="[")if(a.noext||!hp(S)||e.charAt(p)!=="(")d+=S;else{t.push(d),d="";const A=new At(S,t);p=er(w=At,ma,ah).call(w,e,A,p,a),t.push(A)}else i=!0,o=p,u=!1,d+=S}return t.push(d),p}let c=r+1,l=new At(null,t);const m=[];let h="";for(;c<e.length;){const p=e.charAt(c++);if(n||p==="\\")n=!n,h+=p;else if(i)c===o+1?p!=="^"&&p!=="!"||(u=!0):p!=="]"||c===o+2&&u||(i=!1),h+=p;else if(p!=="[")if(hp(p)&&e.charAt(c)==="("){l.push(h),h="";const d=new At(p,l);l.push(d),c=er(g=At,ma,ah).call(g,e,d,c,a)}else if(p!=="|"){if(p===")")return h===""&&M(t,ke).length===0&&De(t,Sc,!0),l.push(h),h="",t.push(...m,l),c;h+=p}else l.push(h),h="",m.push(l),l=new At(null,t);else i=!0,o=c,u=!1,h+=p}return t.type=null,De(t,at,void 0),De(t,ke,[e.substring(r-1)]),c},Vf=function(e){return M(this,ke).map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[r,a,n,i]=t.toRegExpSource(e);return De(this,Ms,M(this,Ms)||i),r}).filter(t=>!(this.isStart()&&this.isEnd()&&!t)).join("|")},Fg=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=!1,n="",i=!1;for(let o=0;o<e.length;o++){const u=e.charAt(o);if(a)a=!1,n+=(n0.has(u)?"\\":"")+u;else if(u!=="\\"){if(u==="["){const[c,l,m,h]=t0(e,o);if(m){n+=c,i=i||l,o+=m-1,t=t||h;continue}}u!=="*"?u!=="?"?n+=u.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(n+=dd,t=!0):(n+=r&&e==="*"?fp:mp,t=!0)}else o===e.length-1?n+="\\\\":a=!0}return[n,lu(e),!!t,i]},Dt(At,ma);let Jh=At;const yt=function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Fh(e),!(!t.nocomment&&e.charAt(0)==="#")&&new qh(e,t).match(s)},i0=/^\*+([^+@!?\*\[\(]*)$/,o0=s=>e=>!e.startsWith(".")&&e.endsWith(s),u0=s=>e=>e.endsWith(s),l0=s=>(s=s.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(s)),c0=s=>(s=s.toLowerCase(),e=>e.toLowerCase().endsWith(s)),h0=/^\*+\.\*+$/,m0=s=>!s.startsWith(".")&&s.includes("."),f0=s=>s!=="."&&s!==".."&&s.includes("."),d0=/^\.\*+$/,p0=s=>s!=="."&&s!==".."&&s.startsWith("."),g0=/^\*+$/,w0=s=>s.length!==0&&!s.startsWith("."),y0=s=>s.length!==0&&s!=="."&&s!=="..",v0=/^\?+([^+@!?\*\[\(]*)?$/,b0=s=>{let[e,t=""]=s;const r=Jg([e]);return t?(t=t.toLowerCase(),a=>r(a)&&a.toLowerCase().endsWith(t)):r},A0=s=>{let[e,t=""]=s;const r=qg([e]);return t?(t=t.toLowerCase(),a=>r(a)&&a.toLowerCase().endsWith(t)):r},S0=s=>{let[e,t=""]=s;const r=qg([e]);return t?a=>r(a)&&a.endsWith(t):r},N0=s=>{let[e,t=""]=s;const r=Jg([e]);return t?a=>r(a)&&a.endsWith(t):r},Jg=s=>{let[e]=s;const t=e.length;return r=>r.length===t&&!r.startsWith(".")},qg=s=>{let[e]=s;const t=e.length;return r=>r.length===t&&r!=="."&&r!==".."},_g=typeof Ye=="object"&&Ye?typeof wm=="object"&&wm&&wm.__MINIMATCH_TESTING_PLATFORM__||Ye.platform:"posix";yt.sep=_g==="win32"?"\\":"/";const zt=Symbol("globstar **");yt.GLOBSTAR=zt,yt.filter=function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return t=>yt(t,s,e)};const Gt=function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.assign({},s,e)};yt.defaults=s=>{if(!s||typeof s!="object"||!Object.keys(s).length)return yt;const e=yt;return Object.assign(function(t,r){return e(t,r,Gt(s,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))},{Minimatch:class extends e.Minimatch{constructor(t){super(t,Gt(s,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}))}static defaults(t){return e.defaults(Gt(s,t)).Minimatch}},AST:class extends e.AST{constructor(t,r){super(t,r,Gt(s,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))}static fromGlob(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.AST.fromGlob(t,Gt(s,r))}},unescape:function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.unescape(t,Gt(s,r))},escape:function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.escape(t,Gt(s,r))},filter:function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.filter(t,Gt(s,r))},defaults:t=>e.defaults(Gt(s,t)),makeRe:function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.makeRe(t,Gt(s,r))},braceExpand:function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.braceExpand(t,Gt(s,r))},match:function(t,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e.match(t,r,Gt(s,a))},sep:e.sep,GLOBSTAR:zt})};const Wg=function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Fh(s),e.nobrace||!/\{(?:(?!\{).)*\}/.test(s)?[s]:Zy(s)};yt.braceExpand=Wg,yt.makeRe=function(s){return new qh(s,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).makeRe()},yt.match=function(s,e){const t=new qh(e,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{});return s=s.filter(r=>t.match(r)),t.options.nonull&&!s.length&&s.push(e),s};const dp=/[?*]|[+@!]\(.*?\)|\[|\]/;class qh{constructor(e){Je(this,"options");Je(this,"set");Je(this,"pattern");Je(this,"windowsPathsNoEscape");Je(this,"nonegate");Je(this,"negate");Je(this,"comment");Je(this,"empty");Je(this,"preserveMultipleSlashes");Je(this,"partial");Je(this,"globSet");Je(this,"globParts");Je(this,"nocase");Je(this,"isWindows");Je(this,"platform");Je(this,"windowsNoMagicRoot");Je(this,"regexp");let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Fh(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||_g,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#")return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=function(){return console.error(...arguments)}),this.debug(this.pattern,this.globSet);const r=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let a=this.globParts.map((n,i,o)=>{if(this.isWindows&&this.windowsNoMagicRoot){const u=!(n[0]!==""||n[1]!==""||n[2]!=="?"&&dp.test(n[2])||dp.test(n[3])),c=/^[a-z]:/i.test(n[0]);if(u)return[...n.slice(0,4),...n.slice(4).map(l=>this.parse(l))];if(c)return[n[0],...n.slice(1).map(l=>this.parse(l))]}return n.map(u=>this.parse(u))});if(this.debug(this.pattern,a),this.set=a.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){const i=this.set[n];i[0]===""&&i[1]===""&&this.globParts[n][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let r=0;r<e.length;r++)for(let a=0;a<e[r].length;a++)e[r][a]==="**"&&(e[r][a]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let r=-1;for(;(r=t.indexOf("**",r+1))!==-1;){let a=r;for(;t[a+1]==="**";)a++;a!==r&&t.splice(r,a-r)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((r,a)=>{const n=r[r.length-1];return a==="**"&&n==="**"?r:a===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(r.pop(),r):(r.push(a),r)},[])).length===0?[""]:t)}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let a=1;a<e.length-1;a++){const n=e[a];a===1&&n===""&&e[0]===""||n!=="."&&n!==""||(t=!0,e.splice(a,1),a--)}e[0]!=="."||e.length!==2||e[1]!=="."&&e[1]!==""||(t=!0,e.pop())}let r=0;for(;(r=e.indexOf("..",r+1))!==-1;){const a=e[r-1];a&&a!=="."&&a!==".."&&a!=="**"&&(t=!0,e.splice(r-1,2),r-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let r of e){let a=-1;for(;(a=r.indexOf("**",a+1))!==-1;){let i=a;for(;r[i+1]==="**";)i++;i>a&&r.splice(a+1,i-a);let o=r[a+1];const u=r[a+2],c=r[a+3];if(o!==".."||!u||u==="."||u===".."||!c||c==="."||c==="..")continue;t=!0,r.splice(a,1);const l=r.slice(0);l[a]="**",e.push(l),a--}if(!this.preserveMultipleSlashes){for(let i=1;i<r.length-1;i++){const o=r[i];i===1&&o===""&&r[0]===""||o!=="."&&o!==""||(t=!0,r.splice(i,1),i--)}r[0]!=="."||r.length!==2||r[1]!=="."&&r[1]!==""||(t=!0,r.pop())}let n=0;for(;(n=r.indexOf("..",n+1))!==-1;){const i=r[n-1];if(i&&i!=="."&&i!==".."&&i!=="**"){t=!0;const o=n===1&&r[n+1]==="**"?["."]:[];r.splice(n-1,2,...o),r.length===0&&r.push(""),n-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){const a=this.partsMatch(e[t],e[r],!this.preserveMultipleSlashes);if(a){e[t]=[],e[r]=a;break}}return e.filter(t=>t.length)}partsMatch(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=0,n=0,i=[],o="";for(;a<e.length&&n<t.length;)if(e[a]===t[n])i.push(o==="b"?t[n]:e[a]),a++,n++;else if(r&&e[a]==="**"&&t[n]===e[a+1])i.push(e[a]),a++;else if(r&&t[n]==="**"&&e[a]===t[n+1])i.push(t[n]),n++;else if(e[a]!=="*"||!t[n]||!this.options.dot&&t[n].startsWith(".")||t[n]==="**"){if(t[n]!=="*"||!e[a]||!this.options.dot&&e[a].startsWith(".")||e[a]==="**"||o==="a")return!1;o="b",i.push(t[n]),a++,n++}else{if(o==="b")return!1;o="a",i.push(e[a]),a++,n++}return e.length===t.length&&i}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,r=0;for(let a=0;a<e.length&&e.charAt(a)==="!";a++)t=!t,r++;r&&(this.pattern=e.slice(r)),this.negate=t}matchOne(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const a=this.options;if(this.isWindows){const p=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),d=!p&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),S=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),A=d?3:p?0:void 0,E=!S&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3])?3:S?0:void 0;if(typeof A=="number"&&typeof E=="number"){const[k,I]=[e[A],t[E]];k.toLowerCase()===I.toLowerCase()&&(t[E]=k,E>A?t=t.slice(E):A>E&&(e=e.slice(A)))}}const{optimizationLevel:n=1}=this.options;n>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,o=0,u=e.length,c=t.length;i<u&&o<c;i++,o++){this.debug("matchOne loop");var l=t[o],m=e[i];if(this.debug(t,l,m),l===!1)return!1;if(l===zt){this.debug("GLOBSTAR",[t,l,m]);var h=i,w=o+1;if(w===c){for(this.debug("** at the end");i<u;i++)if(e[i]==="."||e[i]===".."||!a.dot&&e[i].charAt(0)===".")return!1;return!0}for(;h<u;){var g=e[h];if(this.debug("\nglobstar while",e,h,t,w,g),this.matchOne(e.slice(h),t.slice(w),r))return this.debug("globstar found match!",h,u,g),!0;if(g==="."||g===".."||!a.dot&&g.charAt(0)==="."){this.debug("dot detected!",e,h,t,w);break}this.debug("globstar swallow a segment, and continue"),h++}return!(!r||(this.debug("\n>>> no match, partial?",e,h,t,w),h!==u))}let p;if(typeof l=="string"?(p=m===l,this.debug("string match",l,m,p)):(p=l.test(m),this.debug("pattern match",l,m,p)),!p)return!1}if(i===u&&o===c)return!0;if(i===u)return r;if(o===c)return i===u-1&&e[i]==="";throw new Error("wtf?")}braceExpand(){return Wg(this.pattern,this.options)}parse(e){Fh(e);const t=this.options;if(e==="**")return zt;if(e==="")return"";let r,a=null;(r=e.match(g0))?a=t.dot?y0:w0:(r=e.match(i0))?a=(t.nocase?t.dot?c0:l0:t.dot?u0:o0)(r[1]):(r=e.match(v0))?a=(t.nocase?t.dot?A0:b0:t.dot?S0:N0)(r):(r=e.match(h0))?a=t.dot?f0:m0:(r=e.match(d0))&&(a=p0);const n=Jh.fromGlob(e,this.options).toMMPattern();return a&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:a}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,r=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",a=new Set(t.nocase?["i"]:[]);let n=e.map(u=>{const c=u.map(l=>{if(l instanceof RegExp)for(const m of l.flags.split(""))a.add(m);return typeof l=="string"?l.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):l===zt?zt:l._src});return c.forEach((l,m)=>{const h=c[m+1],w=c[m-1];l===zt&&w!==zt&&(w===void 0?h!==void 0&&h!==zt?c[m+1]="(?:\\/|"+r+"\\/)?"+h:c[m]=r:h===void 0?c[m-1]=w+"(?:\\/|"+r+")?":h!==zt&&(c[m-1]=w+"(?:\\/|\\/"+r+"\\/)"+h,c[m+1]=zt))}),c.filter(l=>l!==zt).join("/")}).join("|");const[i,o]=e.length>1?["(?:",")"]:["",""];n="^"+i+n+o+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...a].join(""))}catch(u){this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.partial;if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const r=this.options;this.isWindows&&(e=e.split("\\").join("/"));const a=this.slashSplit(e);this.debug(this.pattern,"split",a);const n=this.set;this.debug(this.pattern,"set",n);let i=a[a.length-1];if(!i)for(let o=a.length-2;!i&&o>=0;o--)i=a[o];for(let o=0;o<n.length;o++){const u=n[o];let c=a;if(r.matchBase&&u.length===1&&(c=[i]),this.matchOne(c,u,t))return!!r.flipNegate||!this.negate}return!r.flipNegate&&this.negate}static defaults(e){return yt.defaults(e).Minimatch}}function pd(s){const e=new Error("".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"","Invalid response: ").concat(s.status," ").concat(s.statusText));return e.status=s.status,e.response=s,e}function st(s,e){const{status:t}=e;if(t===401&&s.digest)return e;if(t>=400)throw pd(e);return e}function $o(s,e){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?{data:e,headers:s.headers?Xy(s.headers):{},status:s.status,statusText:s.statusText}:e}yt.AST=Jh,yt.Minimatch=qh,yt.escape=function(s){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?s.replace(/[?*()[\]]/g,"[$&]"):s.replace(/[?*()[\]\\]/g,"\\$&")},yt.unescape=lu;const k0=(pp=function(s,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=tt({url:Be(s.remoteURL,Pe(e)),method:"COPY",headers:{Destination:Be(s.remoteURL,Pe(t)),Overwrite:r.overwrite===!1?"F":"T",Depth:r.shallow?"0":"infinity"}},s,r);return i=function(o){st(s,o)},(n=et(a,s))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i},function(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];try{return Promise.resolve(pp.apply(this,s))}catch(t){return Promise.reject(t)}});var pp;const E0={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,e){return e},attributeValueProcessor:function(s,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,e,t){return s},captureMetaData:!1},gp=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",C0=new RegExp("^["+gp+"]["+gp+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$");function Gg(s,e){const t=[];let r=e.exec(s);for(;r;){const a=[];a.startIndex=e.lastIndex-r[0].length;const n=r.length;for(let i=0;i<n;i++)a.push(r[i]);t.push(a),r=e.exec(s)}return t}const om=function(s){return C0.exec(s)!=null};let Pf;Pf=typeof Symbol!="function"?"@@xmlMetadata":Symbol("XML Node Metadata");class Sn{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e,t){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child}),t!==void 0&&(this.child[this.child.length-1][Pf]={startIndex:t})}static getMetaDataSymbol(){return Pf}}class I0{constructor(e){this.suppressValidationErr=!e}readDocType(e,t){const r={};if(e[t+3]!=="O"||e[t+4]!=="C"||e[t+5]!=="T"||e[t+6]!=="Y"||e[t+7]!=="P"||e[t+8]!=="E")throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let a=1,n=!1,i=!1,o="";for(;t<e.length;t++)if(e[t]!=="<"||i)if(e[t]===">"){if(i?e[t-1]==="-"&&e[t-2]==="-"&&(i=!1,a--):a--,a===0)break}else e[t]==="["?n=!0:o+=e[t];else{if(n&&ga(e,"!ENTITY",t)){let u,c;t+=7,[u,c,t]=this.readEntityExp(e,t+1,this.suppressValidationErr),c.indexOf("&")===-1&&(r[u]={regx:RegExp("&".concat(u,";"),"g"),val:c})}else if(n&&ga(e,"!ELEMENT",t)){t+=8;const{index:u}=this.readElementExp(e,t+1);t=u}else if(n&&ga(e,"!ATTLIST",t))t+=8;else if(n&&ga(e,"!NOTATION",t)){t+=9;const{index:u}=this.readNotationExp(e,t+1,this.suppressValidationErr);t=u}else{if(!ga(e,"!--",t))throw new Error("Invalid DOCTYPE");i=!0}a++,o=""}if(a!==0)throw new Error("Unclosed DOCTYPE")}return{entities:r,i:t}}readEntityExp(e,t){t=Tt(e,t);let r="";for(;t<e.length&&!/\s/.test(e[t])&&e[t]!=='"'&&e[t]!=="'";)r+=e[t],t++;if(qo(r),t=Tt(e,t),!this.suppressValidationErr){if(e.substring(t,t+6).toUpperCase()==="SYSTEM")throw new Error("External entities are not supported");if(e[t]==="%")throw new Error("Parameter entities are not supported")}let a="";return[t,a]=this.readIdentifierVal(e,t,"entity"),[r,a,--t]}readNotationExp(e,t){t=Tt(e,t);let r="";for(;t<e.length&&!/\s/.test(e[t]);)r+=e[t],t++;!this.suppressValidationErr&&qo(r),t=Tt(e,t);const a=e.substring(t,t+6).toUpperCase();if(!this.suppressValidationErr&&a!=="SYSTEM"&&a!=="PUBLIC")throw new Error('Expected SYSTEM or PUBLIC, found "'.concat(a,'"'));t+=a.length,t=Tt(e,t);let n=null,i=null;if(a==="PUBLIC")[t,n]=this.readIdentifierVal(e,t,"publicIdentifier"),e[t=Tt(e,t)]!=='"'&&e[t]!=="'"||([t,i]=this.readIdentifierVal(e,t,"systemIdentifier"));else if(a==="SYSTEM"&&([t,i]=this.readIdentifierVal(e,t,"systemIdentifier"),!this.suppressValidationErr&&!i))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:r,publicIdentifier:n,systemIdentifier:i,index:--t}}readIdentifierVal(e,t,r){let a="";const n=e[t];if(n!=='"'&&n!=="'")throw new Error('Expected quoted string, found "'.concat(n,'"'));for(t++;t<e.length&&e[t]!==n;)a+=e[t],t++;if(e[t]!==n)throw new Error("Unterminated ".concat(r," value"));return[++t,a]}readElementExp(e,t){t=Tt(e,t);let r="";for(;t<e.length&&!/\s/.test(e[t]);)r+=e[t],t++;if(!this.suppressValidationErr&&!om(r))throw new Error('Invalid element name: "'.concat(r,'"'));let a="";if(e[t=Tt(e,t)]==="E"&&ga(e,"MPTY",t))t+=4;else if(e[t]==="A"&&ga(e,"NY",t))t+=2;else if(e[t]==="("){for(t++;t<e.length&&e[t]!==")";)a+=e[t],t++;if(e[t]!==")")throw new Error("Unterminated content model")}else if(!this.suppressValidationErr)throw new Error('Invalid Element Expression, found "'.concat(e[t],'"'));return{elementName:r,contentModel:a.trim(),index:t}}readAttlistExp(e,t){t=Tt(e,t);let r="";for(;t<e.length&&!/\s/.test(e[t]);)r+=e[t],t++;qo(r),t=Tt(e,t);let a="";for(;t<e.length&&!/\s/.test(e[t]);)a+=e[t],t++;if(!qo(a))throw new Error('Invalid attribute name: "'.concat(a,'"'));t=Tt(e,t);let n="";if(e.substring(t,t+8).toUpperCase()==="NOTATION"){if(n="NOTATION",e[t=Tt(e,t+=8)]!=="(")throw new Error("Expected '(', found \"".concat(e[t],'"'));t++;let o=[];for(;t<e.length&&e[t]!==")";){let u="";for(;t<e.length&&e[t]!=="|"&&e[t]!==")";)u+=e[t],t++;if(u=u.trim(),!qo(u))throw new Error('Invalid notation name: "'.concat(u,'"'));o.push(u),e[t]==="|"&&(t++,t=Tt(e,t))}if(e[t]!==")")throw new Error("Unterminated list of notations");t++,n+=" ("+o.join("|")+")"}else{for(;t<e.length&&!/\s/.test(e[t]);)n+=e[t],t++;const o=["CDATA","ID","IDREF","IDREFS","ENTITY","ENTITIES","NMTOKEN","NMTOKENS"];if(!this.suppressValidationErr&&!o.includes(n.toUpperCase()))throw new Error('Invalid attribute type: "'.concat(n,'"'))}t=Tt(e,t);let i="";return e.substring(t,t+8).toUpperCase()==="#REQUIRED"?(i="#REQUIRED",t+=8):e.substring(t,t+7).toUpperCase()==="#IMPLIED"?(i="#IMPLIED",t+=7):[t,i]=this.readIdentifierVal(e,t,"ATTLIST"),{elementName:r,attributeName:a,attributeType:n,defaultValue:i,index:t}}}const Tt=(s,e)=>{for(;e<s.length&&/\s/.test(s[e]);)e++;return e};function ga(s,e,t){for(let r=0;r<e.length;r++)if(e[r]!==s[t+r+1])return!1;return!0}function qo(s){if(om(s))return s;throw new Error("Invalid entity name ".concat(s))}const x0=/^[-+]?0x[a-fA-F0-9]+$/,V0=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,P0={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0},B0=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;function Xg(s){return typeof s=="function"?s:Array.isArray(s)?e=>{for(const t of s)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}class O0{constructor(e){if(this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,r)=>wp(r,10,"&#")},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,r)=>wp(r,16,"&#x")}},this.addExternalEntities=D0,this.parseXml=j0,this.parseTextData=T0,this.resolveNameSpace=R0,this.buildAttributesMap=U0,this.isItStopNode=H0,this.replaceEntitiesValue=K0,this.readStopNodeData=F0,this.saveTextToParentTag=M0,this.addChild=$0,this.ignoreAttributesFn=Xg(this.options.ignoreAttributes),this.options.stopNodes&&this.options.stopNodes.length>0){this.stopNodesExact=new Set,this.stopNodesWildcard=new Set;for(let t=0;t<this.options.stopNodes.length;t++){const r=this.options.stopNodes[t];typeof r=="string"&&(r.startsWith("*.")?this.stopNodesWildcard.add(r.substring(2)):this.stopNodesExact.add(r))}}}}function D0(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const r=e[t];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:s[r]}}}function T0(s,e,t,r,a,n,i){if(s!==void 0&&(this.options.trimValues&&!r&&(s=s.trim()),s.length>0)){i||(s=this.replaceEntitiesValue(s));const o=this.options.tagValueProcessor(e,s,t,a,n);return o==null?s:typeof o!=typeof s||o!==s?o:this.options.trimValues||s.trim()===s?zg(s,this.options.parseTagValue,this.options.numberParseOptions):s}}function R0(s){if(this.options.removeNSPrefix){const e=s.split(":"),t=s.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(s=t+e[1])}return s}const L0=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function U0(s,e){if(this.options.ignoreAttributes!==!0&&typeof s=="string"){const t=Gg(s,L0),r=t.length,a={};for(let n=0;n<r;n++){const i=this.resolveNameSpace(t[n][1]);if(this.ignoreAttributesFn(i,e))continue;let o=t[n][4],u=this.options.attributeNamePrefix+i;if(i.length)if(this.options.transformAttributeName&&(u=this.options.transformAttributeName(u)),u==="__proto__"&&(u="#__proto__"),o!==void 0){this.options.trimValues&&(o=o.trim()),o=this.replaceEntitiesValue(o);const c=this.options.attributeValueProcessor(i,o,e);a[u]=c==null?o:typeof c!=typeof o||c!==o?c:zg(o,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(a[u]=!0)}if(!Object.keys(a).length)return;if(this.options.attributesGroupName){const n={};return n[this.options.attributesGroupName]=a,n}return a}}const j0=function(s){s=s.replace(/\r\n?/g,"\n");const e=new Sn("!xml");let t=e,r="",a="";const n=new I0(this.options.processEntities);for(let i=0;i<s.length;i++)if(s[i]==="<")if(s[i+1]==="/"){const o=Cn(s,">",i,"Closing Tag is not closed.");let u=s.substring(i+2,o).trim();if(this.options.removeNSPrefix){const m=u.indexOf(":");m!==-1&&(u=u.substr(m+1))}this.options.transformTagName&&(u=this.options.transformTagName(u)),t&&(r=this.saveTextToParentTag(r,t,a));const c=a.substring(a.lastIndexOf(".")+1);if(u&&this.options.unpairedTags.indexOf(u)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(u,">"));let l=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(l=a.lastIndexOf(".",a.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=a.lastIndexOf("."),a=a.substring(0,l),t=this.tagsNodeStack.pop(),r="",i=o}else if(s[i+1]==="?"){let o=Bf(s,i,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,t,a),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const u=new Sn(o.tagName);u.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(u[":@"]=this.buildAttributesMap(o.tagExp,a)),this.addChild(t,u,a,i)}i=o.closeIndex+1}else if(s.substr(i+1,3)==="!--"){const o=Cn(s,"-->",i+4,"Comment is not closed.");if(this.options.commentPropName){const u=s.substring(i+4,o-2);r=this.saveTextToParentTag(r,t,a),t.add(this.options.commentPropName,[{[this.options.textNodeName]:u}])}i=o}else if(s.substr(i+1,2)==="!D"){const o=n.readDocType(s,i);this.docTypeEntities=o.entities,i=o.i}else if(s.substr(i+1,2)==="!["){const o=Cn(s,"]]>",i,"CDATA is not closed.")-2,u=s.substring(i+9,o);r=this.saveTextToParentTag(r,t,a);let c=this.parseTextData(u,t.tagname,a,!0,!1,!0,!0);c==null&&(c=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:u}]):t.add(this.options.textNodeName,c),i=o+2}else{let o=Bf(s,i,this.options.removeNSPrefix),u=o.tagName;const c=o.rawTagName;let l=o.tagExp,m=o.attrExpPresent,h=o.closeIndex;if(this.options.transformTagName){const p=this.options.transformTagName(u);l===u&&(l=p),u=p}t&&r&&t.tagname!=="!xml"&&(r=this.saveTextToParentTag(r,t,a,!1));const w=t;w&&this.options.unpairedTags.indexOf(w.tagname)!==-1&&(t=this.tagsNodeStack.pop(),a=a.substring(0,a.lastIndexOf("."))),u!==e.tagname&&(a+=a?"."+u:u);const g=i;if(this.isItStopNode(this.stopNodesExact,this.stopNodesWildcard,a,u)){let p="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)u[u.length-1]==="/"?(u=u.substr(0,u.length-1),a=a.substr(0,a.length-1),l=u):l=l.substr(0,l.length-1),i=o.closeIndex;else if(this.options.unpairedTags.indexOf(u)!==-1)i=o.closeIndex;else{const S=this.readStopNodeData(s,c,h+1);if(!S)throw new Error("Unexpected end of ".concat(c));i=S.i,p=S.tagContent}const d=new Sn(u);u!==l&&m&&(d[":@"]=this.buildAttributesMap(l,a)),p&&(p=this.parseTextData(p,u,a,!0,m,!0,!0)),a=a.substr(0,a.lastIndexOf(".")),d.add(this.options.textNodeName,p),this.addChild(t,d,a,g)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){if(u[u.length-1]==="/"?(u=u.substr(0,u.length-1),a=a.substr(0,a.length-1),l=u):l=l.substr(0,l.length-1),this.options.transformTagName){const d=this.options.transformTagName(u);l===u&&(l=d),u=d}const p=new Sn(u);u!==l&&m&&(p[":@"]=this.buildAttributesMap(l,a)),this.addChild(t,p,a,g),a=a.substr(0,a.lastIndexOf("."))}else{const p=new Sn(u);this.tagsNodeStack.push(t),u!==l&&m&&(p[":@"]=this.buildAttributesMap(l,a)),this.addChild(t,p,a,g),t=p}r="",i=h}}else r+=s[i];return e.child};function $0(s,e,t,r){this.options.captureMetaData||(r=void 0);const a=this.options.updateTag(e.tagname,t,e[":@"]);a===!1||(typeof a=="string"&&(e.tagname=a),s.addChild(e,r))}const K0=function(s){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];s=s.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];s=s.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];s=s.replace(t.regex,t.val)}s=s.replace(this.ampEntity.regex,this.ampEntity.val)}return s};function M0(s,e,t,r){return s&&(r===void 0&&(r=e.child.length===0),(s=this.parseTextData(s,e.tagname,t,!1,!!e[":@"]&&Object.keys(e[":@"]).length!==0,r))!==void 0&&s!==""&&e.add(this.options.textNodeName,s),s=""),s}function H0(s,e,t,r){return!(!e||!e.has(r))||!(!s||!s.has(t))}function Cn(s,e,t,r){const a=s.indexOf(e,t);if(a===-1)throw new Error(r);return a+e.length-1}function Bf(s,e,t){const r=function(l,m){let h,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",g="";for(let p=m;p<l.length;p++){let d=l[p];if(h)d===h&&(h="");else if(d==='"'||d==="'")h=d;else if(d===w[0]){if(!w[1])return{data:g,index:p};if(l[p+1]===w[1])return{data:g,index:p}}else d==="	"&&(d=" ");g+=d}}(s,e+1,arguments.length>3&&arguments[3]!==void 0?arguments[3]:">");if(!r)return;let a=r.data;const n=r.index,i=a.search(/\s/);let o=a,u=!0;i!==-1&&(o=a.substring(0,i),a=a.substring(i+1).trimStart());const c=o;if(t){const l=o.indexOf(":");l!==-1&&(o=o.substr(l+1),u=o!==r.data.substr(l+1))}return{tagName:o,tagExp:a,closeIndex:n,attrExpPresent:u,rawTagName:c}}function F0(s,e,t){const r=t;let a=1;for(;t<s.length;t++)if(s[t]==="<")if(s[t+1]==="/"){const n=Cn(s,">",t,"".concat(e," is not closed"));if(s.substring(t+2,n).trim()===e&&(a--,a===0))return{tagContent:s.substring(r,t),i:n};t=n}else if(s[t+1]==="?")t=Cn(s,"?>",t+1,"StopNode is not closed.");else if(s.substr(t+1,3)==="!--")t=Cn(s,"-->",t+3,"StopNode is not closed.");else if(s.substr(t+1,2)==="![")t=Cn(s,"]]>",t,"StopNode is not closed.")-2;else{const n=Bf(s,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&a++,t=n.closeIndex)}}function zg(s,e,t){if(e&&typeof s=="string"){const r=s.trim();return r==="true"||r!=="false"&&function(a){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n=Object.assign({},P0,n),!a||typeof a!="string")return a;let i=a.trim();if(n.skipLike!==void 0&&n.skipLike.test(i))return a;if(a==="0")return 0;if(n.hex&&x0.test(i))return function(u){if(parseInt)return parseInt(u,16);if(Number.parseInt)return Number.parseInt(u,16);if(window&&window.parseInt)return window.parseInt(u,16);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}(i);if(i.includes("e")||i.includes("E"))return function(u,c,l){if(!l.eNotation)return u;const m=c.match(B0);if(m){let h=m[1]||"";const w=m[3].indexOf("e")===-1?"E":"e",g=m[2],p=h?u[g.length+1]===w:u[g.length]===w;return g.length>1&&p?u:g.length!==1||!m[3].startsWith(".".concat(w))&&m[3][0]!==w?l.leadingZeros&&!p?(c=(m[1]||"")+m[3],Number(c)):u:Number(c)}return u}(a,i,n);{const u=V0.exec(i);if(u){const c=u[1]||"",l=u[2];let m=((o=u[3])&&o.indexOf(".")!==-1&&((o=o.replace(/0+$/,""))==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substring(0,o.length-1))),o);const h=c?a[l.length+1]===".":a[l.length]===".";if(!n.leadingZeros&&(l.length>1||l.length===1&&!h))return a;{const w=Number(i),g=String(w);if(w===0)return w;if(g.search(/[eE]/)!==-1)return n.eNotation?w:a;if(i.indexOf(".")!==-1)return g==="0"||g===m||g==="".concat(c).concat(m)?w:a;let p=l?m:i;return l?p===g||c+p===g?w:a:p===g||p===c+g?w:a}}return a}var o}(s,t)}return s!==void 0?s:""}function wp(s,e,t){const r=Number.parseInt(s,e);return r>=0&&r<=1114111?String.fromCodePoint(r):t+s+";"}const Sm=Sn.getMetaDataSymbol();function J0(s,e){return Yg(s,e)}function Yg(s,e,t){let r;const a={};for(let n=0;n<s.length;n++){const i=s[n],o=q0(i);let u="";if(u=t===void 0?o:t+"."+o,o===e.textNodeName)r===void 0?r=i[o]:r+=""+i[o];else{if(o===void 0)continue;if(i[o]){let c=Yg(i[o],e,u);const l=W0(c,e);i[Sm]!==void 0&&(c[Sm]=i[Sm]),i[":@"]?_0(c,i[":@"],u,e):Object.keys(c).length!==1||c[e.textNodeName]===void 0||e.alwaysCreateTextNode?Object.keys(c).length===0&&(e.alwaysCreateTextNode?c[e.textNodeName]="":c=""):c=c[e.textNodeName],a[o]!==void 0&&a.hasOwnProperty(o)?(Array.isArray(a[o])||(a[o]=[a[o]]),a[o].push(c)):e.isArray(o,u,l)?a[o]=[c]:a[o]=c}}}return typeof r=="string"?r.length>0&&(a[e.textNodeName]=r):r!==void 0&&(a[e.textNodeName]=r),a}function q0(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const r=e[t];if(r!==":@")return r}}function _0(s,e,t,r){if(e){const a=Object.keys(e),n=a.length;for(let i=0;i<n;i++){const o=a[i];r.isArray(o,t+"."+o,!0,!0)?s[o]=[e[o]]:s[o]=e[o]}}}function W0(s,e){const{textNodeName:t}=e,r=Object.keys(s).length;return r===0||!(r!==1||!s[t]&&typeof s[t]!="boolean"&&s[t]!==0)}const G0={allowBooleanAttributes:!1,unpairedTags:[]};function yp(s){return s===" "||s==="	"||s==="\n"||s==="\r"}function vp(s,e){const t=e;for(;e<s.length;e++)if(!(s[e]!="?"&&s[e]!=" ")){const r=s.substr(t,e-t);if(e>5&&r==="xml")return Te("InvalidXml","XML declaration allowed only at the start of the document.",vt(s,e));if(s[e]=="?"&&s[e+1]==">"){e++;break}}return e}function bp(s,e){if(s.length>e+5&&s[e+1]==="-"&&s[e+2]==="-"){for(e+=3;e<s.length;e++)if(s[e]==="-"&&s[e+1]==="-"&&s[e+2]===">"){e+=2;break}}else if(s.length>e+8&&s[e+1]==="D"&&s[e+2]==="O"&&s[e+3]==="C"&&s[e+4]==="T"&&s[e+5]==="Y"&&s[e+6]==="P"&&s[e+7]==="E"){let t=1;for(e+=8;e<s.length;e++)if(s[e]==="<")t++;else if(s[e]===">"&&(t--,t===0))break}else if(s.length>e+9&&s[e+1]==="["&&s[e+2]==="C"&&s[e+3]==="D"&&s[e+4]==="A"&&s[e+5]==="T"&&s[e+6]==="A"&&s[e+7]==="["){for(e+=8;e<s.length;e++)if(s[e]==="]"&&s[e+1]==="]"&&s[e+2]===">"){e+=2;break}}return e}function X0(s,e){let t="",r="",a=!1;for(;e<s.length;e++){if(s[e]==='"'||s[e]==="'")r===""?r=s[e]:r!==s[e]||(r="");else if(s[e]===">"&&r===""){a=!0;break}t+=s[e]}return r===""&&{value:t,index:e,tagClosed:a}}const z0=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function Ap(s,e){const t=Gg(s,z0),r={};for(let a=0;a<t.length;a++){if(t[a][1].length===0)return Te("InvalidAttr","Attribute '"+t[a][2]+"' has no space in starting.",_o(t[a]));if(t[a][3]!==void 0&&t[a][4]===void 0)return Te("InvalidAttr","Attribute '"+t[a][2]+"' is without value.",_o(t[a]));if(t[a][3]===void 0&&!e.allowBooleanAttributes)return Te("InvalidAttr","boolean attribute '"+t[a][2]+"' is not allowed.",_o(t[a]));const n=t[a][2];if(!Q0(n))return Te("InvalidAttr","Attribute '"+n+"' is an invalid name.",_o(t[a]));if(r.hasOwnProperty(n))return Te("InvalidAttr","Attribute '"+n+"' is repeated.",_o(t[a]));r[n]=1}return!0}function Y0(s,e){if(s[++e]===";")return-1;if(s[e]==="#")return function(r,a){let n=/\d/;for(r[a]==="x"&&(a++,n=/[\da-fA-F]/);a<r.length;a++){if(r[a]===";")return a;if(!r[a].match(n))break}return-1}(s,++e);let t=0;for(;e<s.length;e++,t++)if(!(s[e].match(/\w/)&&t<20)){if(s[e]===";")break;return-1}return e}function Te(s,e,t){return{err:{code:s,msg:e,line:t.line||t,col:t.col}}}function Q0(s){return om(s)}function vt(s,e){const t=s.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function _o(s){return s.startIndex+s[1].length}class Qg{constructor(e){this.externalEntities={},this.options=function(t){return Object.assign({},E0,t)}(e)}parse(e,t){if(typeof e!="string"&&e.toString)e=e.toString();else if(typeof e!="string")throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});const n=function(i,o){o=Object.assign({},G0,o);const u=[];let c=!1,l=!1;i[0]==="\uFEFF"&&(i=i.substr(1));for(let m=0;m<i.length;m++)if(i[m]==="<"&&i[m+1]==="?"){if(m+=2,m=vp(i,m),m.err)return m}else{if(i[m]!=="<"){if(yp(i[m]))continue;return Te("InvalidChar","char '"+i[m]+"' is not expected.",vt(i,m))}{let h=m;if(m++,i[m]==="!"){m=bp(i,m);continue}{let w=!1;i[m]==="/"&&(w=!0,m++);let g="";for(;m<i.length&&i[m]!==">"&&i[m]!==" "&&i[m]!=="	"&&i[m]!=="\n"&&i[m]!=="\r";m++)g+=i[m];if(g=g.trim(),g[g.length-1]==="/"&&(g=g.substring(0,g.length-1),m--),!om(g)){let S;return S=g.trim().length===0?"Invalid space after '<'.":"Tag '"+g+"' is an invalid name.",Te("InvalidTag",S,vt(i,m))}const p=X0(i,m);if(p===!1)return Te("InvalidAttr","Attributes for '"+g+"' have open quote.",vt(i,m));let d=p.value;if(m=p.index,d[d.length-1]==="/"){const S=m-d.length;d=d.substring(0,d.length-1);const A=Ap(d,o);if(A!==!0)return Te(A.err.code,A.err.msg,vt(i,S+A.err.line));c=!0}else if(w){if(!p.tagClosed)return Te("InvalidTag","Closing tag '"+g+"' doesn't have proper closing.",vt(i,m));if(d.trim().length>0)return Te("InvalidTag","Closing tag '"+g+"' can't have attributes or invalid starting.",vt(i,h));if(u.length===0)return Te("InvalidTag","Closing tag '"+g+"' has not been opened.",vt(i,h));{const S=u.pop();if(g!==S.tagName){let A=vt(i,S.tagStartPos);return Te("InvalidTag","Expected closing tag '"+S.tagName+"' (opened in line "+A.line+", col "+A.col+") instead of closing tag '"+g+"'.",vt(i,h))}u.length==0&&(l=!0)}}else{const S=Ap(d,o);if(S!==!0)return Te(S.err.code,S.err.msg,vt(i,m-d.length+S.err.line));if(l===!0)return Te("InvalidXml","Multiple possible root nodes found.",vt(i,m));o.unpairedTags.indexOf(g)!==-1||u.push({tagName:g,tagStartPos:h}),c=!0}for(m++;m<i.length;m++)if(i[m]==="<"){if(i[m+1]==="!"){m++,m=bp(i,m);continue}if(i[m+1]!=="?")break;if(m=vp(i,++m),m.err)return m}else if(i[m]==="&"){const S=Y0(i,m);if(S==-1)return Te("InvalidChar","char '&' is not expected.",vt(i,m));m=S}else if(l===!0&&!yp(i[m]))return Te("InvalidXml","Extra text at the end",vt(i,m));i[m]==="<"&&m--}}}return c?u.length==1?Te("InvalidTag","Unclosed tag '"+u[0].tagName+"'.",vt(i,u[0].tagStartPos)):!(u.length>0)||Te("InvalidXml","Invalid '"+JSON.stringify(u.map(m=>m.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):Te("InvalidXml","Start tag expected.",1)}(e,t);if(n!==!0)throw Error("".concat(n.err.msg,":").concat(n.err.line,":").concat(n.err.col))}const r=new O0(this.options);r.addExternalEntities(this.externalEntities);const a=r.parseXml(e);return this.options.preserveOrder||a===void 0?a:J0(a,this.options)}addEntity(e,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}static getMetaDataSymbol(){return Sn.getMetaDataSymbol()}}var Z0=Se(829),Ks=Se.n(Z0),So=function(s){return s.Array="array",s.Object="object",s.Original="original",s}(So||{});function Zg(s,e){if(!s.endsWith("propstat.prop.displayname"))return e}function xc(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:So.Original;const r=Ks().get(s,e);return t==="array"&&Array.isArray(r)===!1?[r]:t==="object"&&Array.isArray(r)?r[0]:r}function Nc(s,e){return e=e!=null?e:{attributeNamePrefix:"@",attributeParsers:[],tagParsers:[Zg]},new Promise(t=>{t(function(r){const{multistatus:a}=r;if(a==="")return{multistatus:{response:[]}};if(!a)throw new Error("Invalid response: No root multistatus found");const n={multistatus:Array.isArray(a)?a[0]:a};return Ks().set(n,"multistatus.response",xc(n,"multistatus.response",So.Array)),Ks().set(n,"multistatus.response",Ks().get(n,"multistatus.response").map(i=>function(o){const u=Object.assign({},o);return u.status?Ks().set(u,"status",xc(u,"status",So.Object)):(Ks().set(u,"propstat",xc(u,"propstat",So.Object)),Ks().set(u,"propstat.prop",xc(u,"propstat.prop",So.Object))),u}(i))),n}(function(r){let{attributeNamePrefix:a,attributeParsers:n,tagParsers:i}=r;return new Qg({allowBooleanAttributes:!0,attributeNamePrefix:a,textNodeName:"text",ignoreAttributes:!1,removeNSPrefix:!0,numberParseOptions:{hex:!0,leadingZeros:!1},attributeValueProcessor(o,u,c){for(const l of n)try{const m=l(c,u);if(m!==u)return m}catch(m){}return u},tagValueProcessor(o,u,c){for(const l of i)try{const m=l(c,u);if(m!==u)return m}catch(m){}return u}})}(e).parse(s)))})}function gd(s,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const{getlastmodified:r=null,getcontentlength:a="0",resourcetype:n=null,getcontenttype:i=null,getetag:o=null}=s,u=n&&typeof n=="object"&&n.collection!==void 0?"directory":"file",c={filename:e,basename:Kh().basename(e),lastmod:r,size:parseInt(a,10),type:u,etag:typeof o=="string"?o.replace(/"/g,""):null};return u==="file"&&(c.mime=i&&typeof i=="string"?i.split(";")[0]:""),t&&(s.displayname!==void 0&&(s.displayname=String(s.displayname)),c.props=s),c}function ew(s,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=null;try{s.multistatus.response[0].propstat&&(r=s.multistatus.response[0])}catch(l){}if(!r)throw new Error("Failed getting item stat: bad response");const{propstat:{prop:a,status:n}}=r,[i,o,u]=n.split(" ",3),c=parseInt(o,10);if(c>=400){const l=new Error("Invalid response: ".concat(c," ").concat(u));throw l.status=c,l}return gd(a,dc(e),t)}function ev(s){switch(String(s)){case"-3":return"unlimited";case"-2":case"-1":return"unknown";default:return parseInt(String(s),10)}}function Nm(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const wd=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:r=!1}=t,a=tt({url:Be(s.remoteURL,Pe(e)),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},s,t);return Nm(et(a,s),function(n){return st(s,n),Nm(n.text(),function(i){return Nm(Nc(i,s.parsing),function(o){const u=ew(o,e,r);return $o(n,u,r)})})})});function tw(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const tv=sw(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=function(n){if(!n||n==="/")return[];let i=n;const o=[];do o.push(i),i=Kh().dirname(i);while(i&&i!=="/");return o}(dc(e));r.sort((n,i)=>n.length>i.length?1:i.length>n.length?-1:0);let a=!1;return function(n,i,o){if(typeof n[Np]=="function"){let p=function(d){try{for(;!(u=m.next()).done;)if((d=i(u.value))&&d.then){if(!kp(d))return void d.then(p,l||(l=Ct.bind(null,c=new No,2)));d=d.v}c?Ct(c,1,d):c=d}catch(S){Ct(c||(c=new No),2,S)}};var u,c,l,m=n[Np]();if(p(),m.return){var h=function(d){try{u.done||m.return()}catch(S){}return d};if(c&&c.then)return c.then(h,function(d){throw h(d)});h()}return c}if(!("length"in n))throw new TypeError("Object is not iterable");for(var w=[],g=0;g<n.length;g++)w.push(n[g]);return function(p,d,S){var A,E,k=-1;return function I(R){try{for(;++k<p.length&&(!S||!S());)if((R=d(k))&&R.then){if(!kp(R))return void R.then(I,E||(E=Ct.bind(null,A=new No,2)));R=R.v}A?Ct(A,1,R):A=R}catch(j){Ct(A||(A=new No),2,j)}}(),A}(w,function(p){return i(w[p])},o)}(r,function(n){return i=function(){return function(u,c){try{var l=tw(wd(s,n),function(m){if(m.type!=="directory")throw new Error("Path includes a file: ".concat(e))})}catch(m){return c(m)}return l&&l.then?l.then(void 0,c):l}(0,function(u){const c=u;return function(){if(c.status===404)return a=!0,Sp(Of(s,n,ps(ht({},t),{recursive:!1})));throw u}()})},(o=function(){if(a)return Sp(Of(s,n,ps(ht({},t),{recursive:!1})))}())&&o.then?o.then(i):i();var i,o},function(){return!1})});function sw(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}function sv(){}function Sp(s,e){return s&&s.then?s.then(sv):Promise.resolve()}const Np=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function Ct(s,e,t){if(!s.s){if(t instanceof No){if(!t.s)return void(t.o=Ct.bind(null,s,e));1&e&&(e=t.s),t=t.v}if(t&&t.then)return void t.then(Ct.bind(null,s,e),Ct.bind(null,s,2));s.s=e,s.v=t;const r=s.o;r&&r(s)}}const No=function(){function s(){}return s.prototype.then=function(e,t){const r=new s,a=this.s;if(a){const n=1&a?e:t;if(n){try{Ct(r,1,n(this.v))}catch(i){Ct(r,2,i)}return r}return this}return this.o=function(n){try{const i=n.v;1&n.s?Ct(r,1,e?e(i):i):t?Ct(r,1,t(i)):Ct(r,2,i)}catch(i){Ct(r,2,i)}},r},s}();function kp(s){return s instanceof No&&1&s.s}const Of=sw(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.recursive===!0)return tv(s,e,t);const r=tt({url:Be(s.remoteURL,(a=Pe(e),a.endsWith("/")?a:a+"/")),method:"MKCOL"},s,t);var a;return tw(et(r,s),function(n){st(s,n)})});var rv=Se(388),Ep=Se.n(rv);const av=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r={};if(typeof t.range=="object"&&typeof t.range.start=="number"){let o="bytes=".concat(t.range.start,"-");typeof t.range.end=="number"&&(o="".concat(o).concat(t.range.end)),r.Range=o}const a=tt({url:Be(s.remoteURL,Pe(e)),method:"GET",headers:r},s,t);return i=function(o){if(st(s,o),r.Range&&o.status!==206){const u=new Error("Invalid response code for partial request: ".concat(o.status));throw u.status=o.status,u}return t.callback&&setTimeout(()=>{t.callback(o)},0),o.body},(n=et(a,s))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i}),nv=()=>{},iv=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e,t){t.url||(t.url=Be(s.remoteURL,Pe(e)));const r=tt(t,s,{});return n=function(i){return st(s,i),i},(a=et(r,s))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),ov=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=tt({url:Be(s.remoteURL,Pe(e)),method:"DELETE"},s,t);return n=function(i){st(s,i)},(a=et(r,s))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),uv=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function(r,a){try{var n=(i=wd(s,e,t),o=function(){return!0},u?o?o(i):i:(i&&i.then||(i=Promise.resolve(i)),o?i.then(o):i))}catch(c){return a(c)}var i,o,u;return n&&n.then?n.then(void 0,a):n}(0,function(r){if(r.status===404)return!1;throw r})});function km(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const lv=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=tt({url:Be(s.remoteURL,Pe(e),"/"),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:t.deep?"infinity":"1"}},s,t);return km(et(r,s),function(a){return st(s,a),km(a.text(),function(n){if(!n)throw new Error("Failed parsing directory contents: Empty response");return km(Nc(n,s.parsing),function(i){const o=rp(e);let u=function(c,l,m){let h=arguments.length>3&&arguments[3]!==void 0&&arguments[3],w=arguments.length>4&&arguments[4]!==void 0&&arguments[4];const g=Kh().join(l,"/"),{multistatus:{response:p}}=c,d=p.map(S=>{const A=function(k){try{return k.replace(/^https?:\/\/[^\/]+/,"")}catch(I){throw new xt(I,"Failed normalising HREF")}}(S.href),{propstat:{prop:E}}=S;return gd(E,g==="/"?decodeURIComponent(dc(A)):dc(Kh().relative(decodeURIComponent(g),decodeURIComponent(A))),h)});return w?d:d.filter(S=>S.basename&&(S.type==="file"||S.filename!==m.replace(/\/$/,"")))}(i,rp(s.remoteBasePath||s.remotePath),o,t.details,t.includeSelf);return t.glob&&(u=function(c,l){return c.filter(m=>yt(m.filename,l,{matchBase:!0}))}(u,t.glob)),$o(a,u,t.details)})})})});function yd(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}const cv=yd(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=tt({url:Be(s.remoteURL,Pe(e)),method:"GET",headers:{Accept:"text/plain"},transformResponse:[fv]},s,t);return _h(et(r,s),function(a){return st(s,a),_h(a.text(),function(n){return $o(a,n,t.details)})})});function _h(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const hv=yd(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=tt({url:Be(s.remoteURL,Pe(e)),method:"GET"},s,t);return _h(et(r,s),function(a){let n;return st(s,a),function(i,o){var u=i();return u&&u.then?u.then(o):o()}(function(){return _h(a.arrayBuffer(),function(i){n=i})},function(){return $o(a,n,t.details)})})}),mv=yd(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{format:r="binary"}=t;if(r!=="binary"&&r!=="text")throw new xt({info:{code:da.InvalidOutputFormat}},"Invalid output format: ".concat(r));return r==="text"?cv(s,e,t):hv(s,e,t)}),fv=s=>s;function dv(s,e){let t="";return e.format&&e.indentBy.length>0&&(t="\n"),rw(s,e,"",t)}function rw(s,e,t,r){let a="",n=!1;for(let i=0;i<s.length;i++){const o=s[i],u=pv(o);if(u===void 0)continue;let c="";if(c=t.length===0?u:"".concat(t,".").concat(u),u===e.textNodeName){let w=o[u];gv(c,e)||(w=e.tagValueProcessor(u,w),w=aw(w,e)),n&&(a+=r),a+=w,n=!1;continue}if(u===e.cdataPropName){n&&(a+=r),a+="<![CDATA[".concat(o[u][0][e.textNodeName],"]]>"),n=!1;continue}if(u===e.commentPropName){a+=r+"<!--".concat(o[u][0][e.textNodeName],"-->"),n=!0;continue}if(u[0]==="?"){const w=Cp(o[":@"],e),g=u==="?xml"?"":r;let p=o[u][0][e.textNodeName];p=p.length!==0?" "+p:"",a+=g+"<".concat(u).concat(p).concat(w,"?>"),n=!0;continue}let l=r;l!==""&&(l+=e.indentBy);const m=r+"<".concat(u).concat(Cp(o[":@"],e)),h=rw(o[u],e,c,l);e.unpairedTags.indexOf(u)!==-1?e.suppressUnpairedNode?a+=m+">":a+=m+"/>":h&&h.length!==0||!e.suppressEmptyNode?h&&h.endsWith(">")?a+=m+">".concat(h).concat(r,"</").concat(u,">"):(a+=m+">",h&&r!==""&&(h.includes("/>")||h.includes("</"))?a+=r+e.indentBy+h+r:a+=h,a+="</".concat(u,">")):a+=m+"/>",n=!0}return a}function pv(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const r=e[t];if(s.hasOwnProperty(r)&&r!==":@")return r}}function Cp(s,e){let t="";if(s&&!e.ignoreAttributes)for(let r in s){if(!s.hasOwnProperty(r))continue;let a=e.attributeValueProcessor(r,s[r]);a=aw(a,e),a===!0&&e.suppressBooleanAttributes?t+=" ".concat(r.substr(e.attributeNamePrefix.length)):t+=" ".concat(r.substr(e.attributeNamePrefix.length),'="').concat(a,'"')}return t}function gv(s,e){let t=(s=s.substr(0,s.length-e.textNodeName.length-1)).substr(s.lastIndexOf(".")+1);for(let r in e.stopNodes)if(e.stopNodes[r]===s||e.stopNodes[r]==="*."+t)return!0;return!1}function aw(s,e){if(s&&s.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const r=e.entities[t];s=s.replace(r.regex,r.val)}return s}const wv={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(s,e){return e},attributeValueProcessor:function(s,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function lr(s){this.options=Object.assign({},wv,s),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=Xg(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=bv),this.processTextOrObjNode=yv,this.options.format?(this.indentate=vv,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function yv(s,e,t,r){const a=this.j2x(s,t+1,r.concat(e));return s[this.options.textNodeName]!==void 0&&Object.keys(s).length===1?this.buildTextValNode(s[this.options.textNodeName],e,a.attrStr,t):this.buildObjectNode(a.val,e,a.attrStr,t)}function vv(s){return this.options.indentBy.repeat(s)}function bv(s){return!(!s.startsWith(this.options.attributeNamePrefix)||s===this.options.textNodeName)&&s.substr(this.attrPrefixLen)}function Av(s){return new lr({attributeNamePrefix:"@_",format:!0,ignoreAttributes:!1,suppressEmptyNode:!0}).build(nw({lockinfo:{"@_xmlns:d":"DAV:",lockscope:{exclusive:{}},locktype:{write:{}},owner:{href:s}}},"d"))}function nw(s,e){const t=ht({},s);for(const r in t)t.hasOwnProperty(r)&&(t[r]&&typeof t[r]=="object"&&r.indexOf(":")===-1?(t["".concat(e,":").concat(r)]=nw(t[r],e),delete t[r]):/^@_/.test(r)===!1&&(t["".concat(e,":").concat(r)]=t[r],delete t[r]));return t}function Df(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}function iw(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}lr.prototype.build=function(s){return this.options.preserveOrder?dv(s,this.options):(Array.isArray(s)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(s={[this.options.arrayNodeName]:s}),this.j2x(s,0,[]).val)},lr.prototype.j2x=function(s,e,t){let r="",a="";const n=t.join(".");for(let i in s)if(Object.prototype.hasOwnProperty.call(s,i))if(s[i]===void 0)this.isAttribute(i)&&(a+="");else if(s[i]===null)this.isAttribute(i)||i===this.options.cdataPropName?a+="":i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(s[i]instanceof Date)a+=this.buildTextValNode(s[i],i,"",e);else if(typeof s[i]!="object"){const o=this.isAttribute(i);if(o&&!this.ignoreAttributesFn(o,n))r+=this.buildAttrPairStr(o,""+s[i]);else if(!o)if(i===this.options.textNodeName){let u=this.options.tagValueProcessor(i,""+s[i]);a+=this.replaceEntitiesValue(u)}else a+=this.buildTextValNode(s[i],i,"",e)}else if(Array.isArray(s[i])){const o=s[i].length;let u="",c="";for(let l=0;l<o;l++){const m=s[i][l];if(m!==void 0)if(m===null)i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(typeof m=="object")if(this.options.oneListGroup){const h=this.j2x(m,e+1,t.concat(i));u+=h.val,this.options.attributesGroupName&&m.hasOwnProperty(this.options.attributesGroupName)&&(c+=h.attrStr)}else u+=this.processTextOrObjNode(m,i,e,t);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(i,m);h=this.replaceEntitiesValue(h),u+=h}else u+=this.buildTextValNode(m,i,"",e)}this.options.oneListGroup&&(u=this.buildObjectNode(u,i,c,e)),a+=u}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const o=Object.keys(s[i]),u=o.length;for(let c=0;c<u;c++)r+=this.buildAttrPairStr(o[c],""+s[i][o[c]])}else a+=this.processTextOrObjNode(s[i],i,e,t);return{attrStr:r,val:a}},lr.prototype.buildAttrPairStr=function(s,e){return e=this.options.attributeValueProcessor(s,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+s:" "+s+'="'+e+'"'},lr.prototype.buildObjectNode=function(s,e,t,r){if(s==="")return e[0]==="?"?this.indentate(r)+"<"+e+t+"?"+this.tagEndChar:this.indentate(r)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let a="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",a=""),!t&&t!==""||s.indexOf("<")!==-1?this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(r)+"<!--".concat(s,"-->")+this.newLine:this.indentate(r)+"<"+e+t+n+this.tagEndChar+s+this.indentate(r)+a:this.indentate(r)+"<"+e+t+n+">"+s+a}},lr.prototype.closeTag=function(s){let e="";return this.options.unpairedTags.indexOf(s)!==-1?this.options.suppressUnpairedNode||(e="/"):e=this.options.suppressEmptyNode?"/":"></".concat(s),e},lr.prototype.buildTextValNode=function(s,e,t,r){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(r)+"<![CDATA[".concat(s,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(r)+"<!--".concat(s,"-->")+this.newLine;if(e[0]==="?")return this.indentate(r)+"<"+e+t+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(e,s);return a=this.replaceEntitiesValue(a),a===""?this.indentate(r)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(r)+"<"+e+t+">"+a+"</"+e+this.tagEndChar}},lr.prototype.replaceEntitiesValue=function(s){if(s&&s.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];s=s.replace(t.regex,t.val)}return s};const Sv=iw(function(s,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=tt({url:Be(s.remoteURL,Pe(e)),method:"UNLOCK",headers:{"Lock-Token":t}},s,r);return Df(et(a,s),function(n){if(st(s,n),n.status!==204&&n.status!==200)throw pd(n)})}),Nv=iw(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{refreshToken:r,timeout:a=kv}=t,n={Accept:"text/plain,application/xml",Timeout:a};r&&(n.If=r);const i=tt({url:Be(s.remoteURL,Pe(e)),method:"LOCK",headers:n,data:Av(s.contactHref)},s,t);return Df(et(i,s),function(o){return st(s,o),Df(o.text(),function(u){const c=(h=u,new Qg({removeNSPrefix:!0,parseAttributeValue:!0,parseTagValue:!0}).parse(h)),l=Ks().get(c,"prop.lockdiscovery.activelock.locktoken.href"),m=Ks().get(c,"prop.lockdiscovery.activelock.timeout");var h;if(!l)throw pd(o,"No lock token received: ");return{token:l,serverTimeout:m}})})}),kv="Infinite, Second-4100000000";function Em(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const Ev=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.path||"/",r=tt({url:Be(s.remoteURL,t),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},s,e);return Em(et(r,s),function(a){return st(s,a),Em(a.text(),function(n){return Em(Nc(n,s.parsing),function(i){const o=function(u){try{const[c]=u.multistatus.response,{propstat:{prop:{"quota-used-bytes":l,"quota-available-bytes":m}}}=c;return l!==void 0&&m!==void 0?{used:parseInt(String(l),10),available:ev(m)}:null}catch(c){}return null}(i);return $o(a,o,e.details)})})})});function Cm(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const Cv=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:r=!1}=t,a=tt({url:Be(s.remoteURL,Pe(e)),method:"SEARCH",headers:{Accept:"text/plain,application/xml","Content-Type":s.headers["Content-Type"]||"application/xml; charset=utf-8"}},s,t);return Cm(et(a,s),function(n){return st(s,n),Cm(n.text(),function(i){return Cm(Nc(i,s.parsing),function(o){const u=function(c,l,m){const h={truncated:!1,results:[]};return h.truncated=c.multistatus.response.some(w=>{var g,p;return((p=(w.status||((g=w.propstat)==null?void 0:g.status)).split(" ",3))==null?void 0:p[1])==="507"&&w.href.replace(/\/$/,"").endsWith(Pe(l).replace(/\/$/,""))}),c.multistatus.response.forEach(w=>{if(w.propstat===void 0)return;const g=w.href.split("/").map(decodeURIComponent).join("/");h.results.push(gd(w.propstat.prop,g,m))}),h}(o,e,r);return $o(n,u,r)})})})}),Iv=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=tt({url:Be(s.remoteURL,Pe(e)),method:"MOVE",headers:{Destination:Be(s.remoteURL,Pe(t)),Overwrite:r.overwrite===!1?"F":"T"}},s,r);return i=function(o){st(s,o)},(n=et(a,s))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i});var xv=Se(172);function Vv(s){if($g(s))return s.byteLength;if(Kg(s))return s.length;if(typeof s=="string")return(0,xv.d)(s);throw new xt({info:{code:da.DataTypeNoLength}},"Cannot calculate data length: Invalid type")}const Pv=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const{contentLength:a=!0,overwrite:n=!0}=r,i={"Content-Type":"application/octet-stream"};a===!1||(i["Content-Length"]=typeof a=="number"?"".concat(a):"".concat(Vv(t))),n||(i["If-None-Match"]="*");const o=tt({url:Be(s.remoteURL,Pe(e)),method:"PUT",headers:i,data:t},s,r);return c=function(l){try{st(s,l)}catch(m){const h=m;if(h.status!==412||n)throw h;return!1}return!0},(u=et(o,s))&&u.then||(u=Promise.resolve(u)),c?u.then(c):u;var u,c}),ow=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=tt({url:Be(s.remoteURL,Pe(e)),method:"OPTIONS"},s,t);return n=function(i){var o,u;try{st(s,i)}catch(c){throw c}return{compliance:((o=i.headers.get("DAV"))!=null?o:"").split(",").map(c=>c.trim()),server:(u=i.headers.get("Server"))!=null?u:""}},(a=et(r,s))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n});function oc(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const Bv=vd(function(s,e,t,r,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>r||t<0)throw new xt({info:{code:da.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const i={"Content-Type":"application/octet-stream","Content-Length":""+(r-t+1),"Content-Range":"bytes ".concat(t,"-").concat(r,"/*")},o=tt({url:Be(s.remoteURL,Pe(e)),method:"PUT",headers:i,data:a},s,n);return oc(et(o,s),function(u){st(s,u)})});function Ip(s,e){var t=s();return t&&t.then?t.then(e):e(t)}const Ov=vd(function(s,e,t,r,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>r||t<0)throw new xt({info:{code:da.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const i={"Content-Type":"application/x-sabredav-partialupdate","Content-Length":""+(r-t+1),"X-Update-Range":"bytes=".concat(t,"-").concat(r)},o=tt({url:Be(s.remoteURL,Pe(e)),method:"PATCH",headers:i,data:a},s,n);return oc(et(o,s),function(u){st(s,u)})});function vd(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}const Dv=vd(function(s,e,t,r,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};return oc(ow(s,e,n),function(i){let o=!1;return Ip(function(){if(i.compliance.includes("sabredav-partialupdate"))return oc(Ov(s,e,t,r,a,n),function(u){return o=!0,u})},function(u){let c=!1;return o?u:Ip(function(){if(i.server.includes("Apache")&&i.compliance.includes("<http://apache.org/dav/propset/fs/1>"))return oc(Bv(s,e,t,r,a,n),function(l){return c=!0,l})},function(l){if(c)return l;throw new xt({info:{code:da.NotSupported}},"Not supported")})})})}),Tv="https://github.com/perry-mitchell/webdav-client/blob/master/LOCK_CONTACT.md";function Rv(s){var p;let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{authType:t=null,remoteBasePath:r,contactHref:a=Tv,ha1:n,headers:i={},httpAgent:o,httpsAgent:u,password:c,token:l,username:m,withCredentials:h}=e;let w=t;w||(w=m||c?Ut.Password:Ut.None);const g={authType:w,remoteBasePath:r,contactHref:a,ha1:n,headers:Object.assign({},i),httpAgent:o,httpsAgent:u,password:c,parsing:{attributeNamePrefix:(p=e.attributeNamePrefix)!=null?p:"@",attributeParsers:[],tagParsers:[Zg]},remotePath:Fy(s),remoteURL:s,token:l,username:m,withCredentials:h};return Lg(g,m,c,l,n),{copyFile:(d,S,A)=>k0(g,d,S,A),createDirectory:(d,S)=>Of(g,d,S),createReadStream:(d,S)=>function(A,E){let k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const I=new(Ep()).PassThrough;return av(A,E,k).then(R=>{R.pipe(I)}).catch(R=>{I.emit("error",R)}),I}(g,d,S),createWriteStream:(d,S,A)=>function(E,k){let I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},R=arguments.length>3&&arguments[3]!==void 0?arguments[3]:nv;const j=new(Ep()).PassThrough,K={};I.overwrite===!1&&(K["If-None-Match"]="*");const C=tt({url:Be(E.remoteURL,Pe(k)),method:"PUT",headers:K,data:j,maxRedirects:0},E,I);return et(C,E).then(Y=>st(E,Y)).then(Y=>{setTimeout(()=>{R(Y)},0)}).catch(Y=>{j.emit("error",Y)}),j}(g,d,S,A),customRequest:(d,S)=>iv(g,d,S),deleteFile:(d,S)=>ov(g,d,S),exists:(d,S)=>uv(g,d,S),getDirectoryContents:(d,S)=>lv(g,d,S),getFileContents:(d,S)=>mv(g,d,S),getFileDownloadLink:d=>function(S,A){let E=Be(S.remoteURL,Pe(A));const k=/^https:/i.test(E)?"https":"http";switch(S.authType){case Ut.None:break;case Ut.Password:{const I=np(S.headers.Authorization.replace(/^Basic /i,"").trim());E=E.replace(/^https?:\/\//,"".concat(k,"://").concat(I,"@"));break}default:throw new xt({info:{code:da.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(S.authType))}return E}(g,d),getFileUploadLink:d=>function(S,A){let E="".concat(Be(S.remoteURL,Pe(A)),"?Content-Type=application/octet-stream");const k=/^https:/i.test(E)?"https":"http";switch(S.authType){case Ut.None:break;case Ut.Password:{const I=np(S.headers.Authorization.replace(/^Basic /i,"").trim());E=E.replace(/^https?:\/\//,"".concat(k,"://").concat(I,"@"));break}default:throw new xt({info:{code:da.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(S.authType))}return E}(g,d),getHeaders:()=>Object.assign({},g.headers),getQuota:d=>Ev(g,d),lock:(d,S)=>Nv(g,d,S),moveFile:(d,S,A)=>Iv(g,d,S,A),putFileContents:(d,S,A)=>Pv(g,d,S,A),partialUpdateFileContents:(d,S,A,E,k)=>Dv(g,d,S,A,E,k),getDAVCompliance:d=>ow(g,d),search:(d,S)=>Cv(g,d,S),setHeaders:d=>{g.headers=Object.assign({},d)},stat:(d,S)=>wd(g,d,S),unlock:(d,S,A)=>Sv(g,d,S,A),registerAttributeParser:d=>{g.parsing.attributeParsers.push(d)},registerTagParser:d=>{g.parsing.tagParsers.push(d)}}}const Io=vf().setApp("@nextcloud/files").detectUser().build();var uw=(s=>(s.Folder="folder",s.File="file",s))(uw||{}),lw=(s=>(s[s.NONE=0]="NONE",s[s.CREATE=4]="CREATE",s[s.READ=1]="READ",s[s.UPDATE=2]="UPDATE",s[s.DELETE=8]="DELETE",s[s.SHARE=16]="SHARE",s[s.ALL=31]="ALL",s))(lw||{});const cw=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],hw={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},Im=function(s,e={nc:"http://nextcloud.org/ns"}){typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...cw],window._nc_dav_namespaces=ht({},hw));const t=ht(ht({},window._nc_dav_namespaces),e);if(window._nc_dav_properties.find(a=>a===s))return Io.warn("".concat(s," already registered"),{prop:s}),!1;if(s.startsWith("<")||s.split(":").length!==2)return Io.error("".concat(s," is not valid. See example: 'oc:fileid'"),{prop:s}),!1;const r=s.split(":")[0];return t[r]?(window._nc_dav_properties.push(s),window._nc_dav_namespaces=t,!0):(Io.error("".concat(s," namespace unknown"),{prop:s,namespaces:t}),!1)},Lv=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...cw]),window._nc_dav_properties.map(s=>"<".concat(s," />")).join(" ")},Uv=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces=ht({},hw)),Object.keys(window._nc_dav_namespaces).map(s=>{var e;return"xmlns:".concat(s,'="').concat((e=window._nc_dav_namespaces)==null?void 0:e[s],'"')}).join(" ")},jv=function(){return'<?xml version="1.0"?>\n		<d:propfind '.concat(Uv(),">\n			<d:prop>\n				").concat(Lv(),"\n			</d:prop>\n		</d:propfind>")};function $v(){var s;return Og()?"/files/".concat(Ty()):"/files/".concat((s=cd())==null?void 0:s.uid)}$v();function Kv(){const s=ay("dav");return Og()?s.replace("remote.php","public.php"):s}const Mv=Kv(),Hv=function(s=Mv,e={}){const t=Rv(s,{headers:e});function r(a){t.setHeaders(ps(ht({},e),{"X-Requested-With":"XMLHttpRequest",requesttoken:a!=null?a:""}))}return ny(r),r(iy()),Ug().patch("fetch",(a,n)=>{const i=n.headers;return i!=null&&i.method&&(n.method=i.method,delete i.method),fetch(a,n)}),t};var mw={},Tf={exports:{}};const Fv=oy(uy);(function(s,e){var t=Fv,r=t.Buffer;function a(i,o){for(var u in i)o[u]=i[u]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?s.exports=t:(a(t,e),e.Buffer=n);function n(i,o,u){return r(i,o,u)}n.prototype=Object.create(r.prototype),a(r,n),n.from=function(i,o,u){if(typeof i=="number")throw new TypeError("Argument must not be a number");return r(i,o,u)},n.alloc=function(i,o,u){if(typeof i!="number")throw new TypeError("Argument must be a number");var c=r(i);return o!==void 0?typeof u=="string"?c.fill(o,u):c.fill(o):c.fill(0),c},n.allocUnsafe=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return r(i)},n.allocUnsafeSlow=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(i)}})(Tf,Tf.exports);var Jv=Tf.exports,bd=Jv.Buffer,xp=bd.isEncoding||function(s){switch(s=""+s,s&&s.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function qv(s){if(!s)return"utf8";for(var e;;)switch(s){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return s;default:if(e)return;s=(""+s).toLowerCase(),e=!0}}function _v(s){var e=qv(s);if(typeof e!="string"&&(bd.isEncoding===xp||!xp(s)))throw new Error("Unknown encoding: "+s);return e||s}mw.StringDecoder=cu;function cu(s){this.encoding=_v(s);var e;switch(this.encoding){case"utf16le":this.text=Qv,this.end=Zv,e=4;break;case"utf8":this.fillLast=Xv,e=4;break;case"base64":this.text=eb,this.end=tb,e=3;break;default:this.write=sb,this.end=rb;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=bd.allocUnsafe(e)}cu.prototype.write=function(s){if(s.length===0)return"";var e,t;if(this.lastNeed){if(e=this.fillLast(s),e===void 0)return"";t=this.lastNeed,this.lastNeed=0}else t=0;return t<s.length?e?e+this.text(s,t):this.text(s,t):e||""},cu.prototype.end=Yv,cu.prototype.text=zv,cu.prototype.fillLast=function(s){if(this.lastNeed<=s.length)return s.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);s.copy(this.lastChar,this.lastTotal-this.lastNeed,0,s.length),this.lastNeed-=s.length};function xm(s){return s<=127?0:s>>5===6?2:s>>4===14?3:s>>3===30?4:s>>6===2?-1:-2}function Wv(s,e,t){var r=e.length-1;if(r<t)return 0;var a=xm(e[r]);return a>=0?(a>0&&(s.lastNeed=a-1),a):--r<t||a===-2?0:(a=xm(e[r]),a>=0?(a>0&&(s.lastNeed=a-2),a):--r<t||a===-2?0:(a=xm(e[r]),a>=0?(a>0&&(a===2?a=0:s.lastNeed=a-3),a):0))}function Gv(s,e,t){if((e[0]&192)!==128)return s.lastNeed=0,"";if(s.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return s.lastNeed=1,"";if(s.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return s.lastNeed=2,""}}function Xv(s){var e=this.lastTotal-this.lastNeed,t=Gv(this,s);if(t!==void 0)return t;if(this.lastNeed<=s.length)return s.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);s.copy(this.lastChar,e,0,s.length),this.lastNeed-=s.length}function zv(s,e){var t=Wv(this,s,e);if(!this.lastNeed)return s.toString("utf8",e);this.lastTotal=t;var r=s.length-(t-this.lastNeed);return s.copy(this.lastChar,0,r),s.toString("utf8",e,r)}function Yv(s){var e=s&&s.length?this.write(s):"";return this.lastNeed?e+"":e}function Qv(s,e){if((s.length-e)%2===0){var t=s.toString("utf16le",e);if(t){var r=t.charCodeAt(t.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=s[s.length-2],this.lastChar[1]=s[s.length-1],t.slice(0,-1)}return t}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=s[s.length-1],s.toString("utf16le",e,s.length-1)}function Zv(s){var e=s&&s.length?this.write(s):"";if(this.lastNeed){var t=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,t)}return e}function eb(s,e){var t=(s.length-e)%3;return t===0?s.toString("base64",e):(this.lastNeed=3-t,this.lastTotal=3,t===1?this.lastChar[0]=s[s.length-1]:(this.lastChar[0]=s[s.length-2],this.lastChar[1]=s[s.length-1]),s.toString("base64",e,s.length-t))}function tb(s){var e=s&&s.length?this.write(s):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function sb(s){return s.toString(this.encoding)}function rb(s){return s&&s.length?this.write(s):""}var Vm={},Ad=(s=>(s.DEFAULT="default",s.HIDDEN="hidden",s))(Ad||{});class ab{constructor(e){Je(this,"_action");this.validateAction(e),this._action=e}get id(){return this._action.id}get displayName(){return this._action.displayName}get title(){return this._action.title}get iconSvgInline(){return this._action.iconSvgInline}get enabled(){return this._action.enabled}get exec(){return this._action.exec}get execBatch(){return this._action.execBatch}get hotkey(){return this._action.hotkey}get order(){return this._action.order}get parent(){return this._action.parent}get default(){return this._action.default}get destructive(){return this._action.destructive}get inline(){return this._action.inline}get renderInline(){return this._action.renderInline}validateAction(e){if(!e.id||typeof e.id!="string")throw new Error("Invalid id");if(!e.displayName||typeof e.displayName!="function")throw new Error("Invalid displayName function");if("title"in e&&typeof e.title!="function")throw new Error("Invalid title function");if(!e.iconSvgInline||typeof e.iconSvgInline!="function")throw new Error("Invalid iconSvgInline function");if(!e.exec||typeof e.exec!="function")throw new Error("Invalid exec function");if("enabled"in e&&typeof e.enabled!="function")throw new Error("Invalid enabled function");if("execBatch"in e&&typeof e.execBatch!="function")throw new Error("Invalid execBatch function");if("order"in e&&typeof e.order!="number")throw new Error("Invalid order");if(e.destructive!==void 0&&typeof e.destructive!="boolean")throw new Error("Invalid destructive flag");if("parent"in e&&typeof e.parent!="string")throw new Error("Invalid parent");if(e.default&&!Object.values(Ad).includes(e.default))throw new Error("Invalid default");if("inline"in e&&typeof e.inline!="function")throw new Error("Invalid inline function");if("renderInline"in e&&typeof e.renderInline!="function")throw new Error("Invalid renderInline function");if("hotkey"in e&&e.hotkey!==void 0){if(typeof e.hotkey!="object")throw new Error("Invalid hotkey configuration");if(typeof e.hotkey.key!="string"||!e.hotkey.key)throw new Error("Missing or invalid hotkey key");if(typeof e.hotkey.description!="string"||!e.hotkey.description)throw new Error("Missing or invalid hotkey description")}}}const nb=function(s){if(typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],Io.debug("FileActions initialized")),window._nc_fileactions.find(e=>e.id===s.id)){Io.error("FileAction ".concat(s.id," already registered"),{action:s});return}window._nc_fileactions.push(s)},ib=function(){return typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],Io.debug("FileActions initialized")),window._nc_fileactions};var Vp,Pp;function fw(){return Pp||(Pp=1,Vp=typeof Ye=="object"&&Vm&&Vm.NODE_DEBUG&&/\bsemver\b/i.test(Vm.NODE_DEBUG)?(...s)=>console.error("SEMVER",...s):()=>{}),Vp}var Pm,Bp;function dw(){if(Bp)return Pm;Bp=1;const s="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,a=e-6;return Pm={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:s,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Pm}var Bm={exports:{}},Op;function ob(){return Op||(Op=1,function(s,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:a}=dw(),n=fw();e=s.exports={};const i=e.re=[],o=e.safeRe=[],u=e.src=[],c=e.safeSrc=[],l=e.t={};let m=0;const h="[a-zA-Z0-9-]",w=[["\\s",1],["\\d",a],[h,r]],g=d=>{for(const[S,A]of w)d=d.split("".concat(S,"*")).join("".concat(S,"{0,").concat(A,"}")).split("".concat(S,"+")).join("".concat(S,"{1,").concat(A,"}"));return d},p=(d,S,A)=>{const E=g(S),k=m++;n(d,k,S),l[d]=k,u[k]=S,c[k]=E,i[k]=new RegExp(S,A?"g":void 0),o[k]=new RegExp(E,A?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-]".concat(h,"*")),p("MAINVERSION","(".concat(u[l.NUMERICIDENTIFIER],")\\.(").concat(u[l.NUMERICIDENTIFIER],")\\.(").concat(u[l.NUMERICIDENTIFIER],")")),p("MAINVERSIONLOOSE","(".concat(u[l.NUMERICIDENTIFIERLOOSE],")\\.(").concat(u[l.NUMERICIDENTIFIERLOOSE],")\\.(").concat(u[l.NUMERICIDENTIFIERLOOSE],")")),p("PRERELEASEIDENTIFIER","(?:".concat(u[l.NONNUMERICIDENTIFIER],"|").concat(u[l.NUMERICIDENTIFIER],")")),p("PRERELEASEIDENTIFIERLOOSE","(?:".concat(u[l.NONNUMERICIDENTIFIER],"|").concat(u[l.NUMERICIDENTIFIERLOOSE],")")),p("PRERELEASE","(?:-(".concat(u[l.PRERELEASEIDENTIFIER],"(?:\\.").concat(u[l.PRERELEASEIDENTIFIER],")*))")),p("PRERELEASELOOSE","(?:-?(".concat(u[l.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(u[l.PRERELEASEIDENTIFIERLOOSE],")*))")),p("BUILDIDENTIFIER","".concat(h,"+")),p("BUILD","(?:\\+(".concat(u[l.BUILDIDENTIFIER],"(?:\\.").concat(u[l.BUILDIDENTIFIER],")*))")),p("FULLPLAIN","v?".concat(u[l.MAINVERSION]).concat(u[l.PRERELEASE],"?").concat(u[l.BUILD],"?")),p("FULL","^".concat(u[l.FULLPLAIN],"$")),p("LOOSEPLAIN","[v=\\s]*".concat(u[l.MAINVERSIONLOOSE]).concat(u[l.PRERELEASELOOSE],"?").concat(u[l.BUILD],"?")),p("LOOSE","^".concat(u[l.LOOSEPLAIN],"$")),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE","".concat(u[l.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),p("XRANGEIDENTIFIER","".concat(u[l.NUMERICIDENTIFIER],"|x|X|\\*")),p("XRANGEPLAIN","[v=\\s]*(".concat(u[l.XRANGEIDENTIFIER],")(?:\\.(").concat(u[l.XRANGEIDENTIFIER],")(?:\\.(").concat(u[l.XRANGEIDENTIFIER],")(?:").concat(u[l.PRERELEASE],")?").concat(u[l.BUILD],"?)?)?")),p("XRANGEPLAINLOOSE","[v=\\s]*(".concat(u[l.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(u[l.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(u[l.XRANGEIDENTIFIERLOOSE],")(?:").concat(u[l.PRERELEASELOOSE],")?").concat(u[l.BUILD],"?)?)?")),p("XRANGE","^".concat(u[l.GTLT],"\\s*").concat(u[l.XRANGEPLAIN],"$")),p("XRANGELOOSE","^".concat(u[l.GTLT],"\\s*").concat(u[l.XRANGEPLAINLOOSE],"$")),p("COERCEPLAIN","(^|[^\\d])(\\d{1,".concat(t,"})(?:\\.(\\d{1,").concat(t,"}))?(?:\\.(\\d{1,").concat(t,"}))?")),p("COERCE","".concat(u[l.COERCEPLAIN],"(?:$|[^\\d])")),p("COERCEFULL",u[l.COERCEPLAIN]+"(?:".concat(u[l.PRERELEASE],")?(?:").concat(u[l.BUILD],")?(?:$|[^\\d])")),p("COERCERTL",u[l.COERCE],!0),p("COERCERTLFULL",u[l.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM","(\\s*)".concat(u[l.LONETILDE],"\\s+"),!0),e.tildeTrimReplace="$1~",p("TILDE","^".concat(u[l.LONETILDE]).concat(u[l.XRANGEPLAIN],"$")),p("TILDELOOSE","^".concat(u[l.LONETILDE]).concat(u[l.XRANGEPLAINLOOSE],"$")),p("LONECARET","(?:\\^)"),p("CARETTRIM","(\\s*)".concat(u[l.LONECARET],"\\s+"),!0),e.caretTrimReplace="$1^",p("CARET","^".concat(u[l.LONECARET]).concat(u[l.XRANGEPLAIN],"$")),p("CARETLOOSE","^".concat(u[l.LONECARET]).concat(u[l.XRANGEPLAINLOOSE],"$")),p("COMPARATORLOOSE","^".concat(u[l.GTLT],"\\s*(").concat(u[l.LOOSEPLAIN],")$|^$")),p("COMPARATOR","^".concat(u[l.GTLT],"\\s*(").concat(u[l.FULLPLAIN],")$|^$")),p("COMPARATORTRIM","(\\s*)".concat(u[l.GTLT],"\\s*(").concat(u[l.LOOSEPLAIN],"|").concat(u[l.XRANGEPLAIN],")"),!0),e.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE","^\\s*(".concat(u[l.XRANGEPLAIN],")\\s+-\\s+(").concat(u[l.XRANGEPLAIN],")\\s*$")),p("HYPHENRANGELOOSE","^\\s*(".concat(u[l.XRANGEPLAINLOOSE],")\\s+-\\s+(").concat(u[l.XRANGEPLAINLOOSE],")\\s*$")),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Bm,Bm.exports)),Bm.exports}var Om,Dp;function ub(){if(Dp)return Om;Dp=1;const s=Object.freeze({loose:!0}),e=Object.freeze({});return Om=t=>t?typeof t!="object"?s:t:e,Om}var Dm,Tp;function lb(){if(Tp)return Dm;Tp=1;const s=/^[0-9]+$/,e=(t,r)=>{if(typeof t=="number"&&typeof r=="number")return t===r?0:t<r?-1:1;const a=s.test(t),n=s.test(r);return a&&n&&(t=+t,r=+r),t===r?0:a&&!n?-1:n&&!a?1:t<r?-1:1};return Dm={compareIdentifiers:e,rcompareIdentifiers:(t,r)=>e(r,t)},Dm}var Tm,Rp;function pw(){if(Rp)return Tm;Rp=1;const s=fw(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=dw(),{safeRe:r,t:a}=ob(),n=ub(),{compareIdentifiers:i}=lb();class o{constructor(c,l){if(l=n(l),c instanceof o){if(c.loose===!!l.loose&&c.includePrerelease===!!l.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError('Invalid version. Must be a string. Got type "'.concat(typeof c,'".'));if(c.length>e)throw new TypeError("version is longer than ".concat(e," characters"));s("SemVer",c,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const m=c.trim().match(l.loose?r[a.LOOSE]:r[a.FULL]);if(!m)throw new TypeError("Invalid Version: ".concat(c));if(this.raw=c,this.major=+m[1],this.minor=+m[2],this.patch=+m[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");m[4]?this.prerelease=m[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const w=+h;if(w>=0&&w<t)return w}return h}):this.prerelease=[],this.build=m[5]?m[5].split("."):[],this.format()}format(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}toString(){return this.version}compare(c){if(s("SemVer.compare",this.version,this.options,c),!(c instanceof o)){if(typeof c=="string"&&c===this.version)return 0;c=new o(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof o||(c=new o(c,this.options)),this.major<c.major?-1:this.major>c.major?1:this.minor<c.minor?-1:this.minor>c.minor?1:this.patch<c.patch?-1:this.patch>c.patch?1:0}comparePre(c){if(c instanceof o||(c=new o(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let l=0;do{const m=this.prerelease[l],h=c.prerelease[l];if(s("prerelease compare",l,m,h),m===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(m===void 0)return-1;if(m!==h)return i(m,h)}while(++l)}compareBuild(c){c instanceof o||(c=new o(c,this.options));let l=0;do{const m=this.build[l],h=c.build[l];if(s("build compare",l,m,h),m===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(m===void 0)return-1;if(m!==h)return i(m,h)}while(++l)}inc(c,l,m){if(c.startsWith("pre")){if(!l&&m===!1)throw new Error("invalid increment argument: identifier is empty");if(l){const h="-".concat(l).match(this.options.loose?r[a.PRERELEASELOOSE]:r[a.PRERELEASE]);if(!h||h[1]!==l)throw new Error("invalid identifier: ".concat(l))}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",l,m);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",l,m);break;case"prepatch":this.prerelease.length=0,this.inc("patch",l,m),this.inc("pre",l,m);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",l,m),this.inc("pre",l,m);break;case"release":if(this.prerelease.length===0)throw new Error("version ".concat(this.raw," is not a prerelease"));this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(m)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let w=this.prerelease.length;for(;--w>=0;)typeof this.prerelease[w]=="number"&&(this.prerelease[w]++,w=-2);if(w===-1){if(l===this.prerelease.join(".")&&m===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(l){let w=[l,h];m===!1&&(w=[l]),i(this.prerelease[0],l)===0?isNaN(this.prerelease[1])&&(this.prerelease=w):this.prerelease=w}break}default:throw new Error("invalid increment argument: ".concat(c))}return this.raw=this.format(),this.build.length&&(this.raw+="+".concat(this.build.join("."))),this}}return Tm=o,Tm}var Rm,Lp;function cb(){if(Lp)return Rm;Lp=1;const s=pw();return Rm=(e,t)=>new s(e,t).major,Rm}cb();var Lm,Up;function hb(){if(Up)return Lm;Up=1;const s=pw();return Lm=(e,t,r=!1)=>{if(e instanceof s)return e;try{return new s(e,t)}catch(a){if(!r)return null;throw a}},Lm}var Um,jp;function mb(){if(jp)return Um;jp=1;const s=hb();return Um=(e,t)=>{const r=s(e,t);return r?r.version:null},Um}mb();var $p={},Kp;function fb(){return Kp||(Kp=1,function(s){(function(e){e.parser=function(b,y){return new r(b,y)},e.SAXParser=r,e.SAXStream=l,e.createStream=c,e.MAX_BUFFER_LENGTH=64*1024;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function r(b,y){if(!(this instanceof r))return new r(b,y);var P=this;n(P),P.q=P.c="",P.bufferCheckPosition=e.MAX_BUFFER_LENGTH,P.opt=y||{},P.opt.lowercase=P.opt.lowercase||P.opt.lowercasetags,P.looseCase=P.opt.lowercase?"toLowerCase":"toUpperCase",P.tags=[],P.closed=P.closedRoot=P.sawRoot=!1,P.tag=P.error=null,P.strict=!!b,P.noscript=!!(b||P.opt.noscript),P.state=C.BEGIN,P.strictEntities=P.opt.strictEntities,P.ENTITIES=P.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),P.attribList=[],P.opt.xmlns&&(P.ns=Object.create(p)),P.opt.unquotedAttributeValues===void 0&&(P.opt.unquotedAttributeValues=!b),P.trackPosition=P.opt.position!==!1,P.trackPosition&&(P.position=P.line=P.column=0),Q(P,"onready")}Object.create||(Object.create=function(b){function y(){}y.prototype=b;var P=new y;return P}),Object.keys||(Object.keys=function(b){var y=[];for(var P in b)b.hasOwnProperty(P)&&y.push(P);return y});function a(b){for(var y=Math.max(e.MAX_BUFFER_LENGTH,10),P=0,x=0,ne=t.length;x<ne;x++){var ge=b[t[x]].length;if(ge>y)switch(t[x]){case"textNode":H(b);break;case"cdata":X(b,"oncdata",b.cdata),b.cdata="";break;case"script":X(b,"onscript",b.script),b.script="";break;default:he(b,"Max buffer length exceeded: "+t[x])}P=Math.max(P,ge)}var te=e.MAX_BUFFER_LENGTH-P;b.bufferCheckPosition=te+b.position}function n(b){for(var y=0,P=t.length;y<P;y++)b[t[y]]=""}function i(b){H(b),b.cdata!==""&&(X(b,"oncdata",b.cdata),b.cdata=""),b.script!==""&&(X(b,"onscript",b.script),b.script="")}r.prototype={end:function(){xe(this)},write:$t,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){i(this)}};var o;try{o=require("stream").Stream}catch(b){o=function(){}}o||(o=function(){});var u=e.EVENTS.filter(function(b){return b!=="error"&&b!=="end"});function c(b,y){return new l(b,y)}function l(b,y){if(!(this instanceof l))return new l(b,y);o.apply(this),this._parser=new r(b,y),this.writable=!0,this.readable=!0;var P=this;this._parser.onend=function(){P.emit("end")},this._parser.onerror=function(x){P.emit("error",x),P._parser.error=null},this._decoder=null,u.forEach(function(x){Object.defineProperty(P,"on"+x,{get:function(){return P._parser["on"+x]},set:function(ne){if(!ne)return P.removeAllListeners(x),P._parser["on"+x]=ne,ne;P.on(x,ne)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(o.prototype,{constructor:{value:l}}),l.prototype.write=function(b){if(typeof pm=="function"&&typeof pm.isBuffer=="function"&&pm.isBuffer(b)){if(!this._decoder){var y=mw.StringDecoder;this._decoder=new y("utf8")}b=this._decoder.write(b)}return this._parser.write(b.toString()),this.emit("data",b),!0},l.prototype.end=function(b){return b&&b.length&&this.write(b),this._parser.end(),!0},l.prototype.on=function(b,y){var P=this;return!P._parser["on"+b]&&u.indexOf(b)!==-1&&(P._parser["on"+b]=function(){var x=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);x.splice(0,0,b),P.emit.apply(P,x)}),o.prototype.on.call(P,b,y)};var m="[CDATA[",h="DOCTYPE",w="http://www.w3.org/XML/1998/namespace",g="http://www.w3.org/2000/xmlns/",p={xml:w,xmlns:g},d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,S=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,A=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,E=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function k(b){return b===" "||b==="\n"||b==="\r"||b==="	"}function I(b){return b==='"'||b==="'"}function R(b){return b===">"||k(b)}function j(b,y){return b.test(y)}function K(b,y){return!j(b,y)}var C=0;e.STATE={BEGIN:C++,BEGIN_WHITESPACE:C++,TEXT:C++,TEXT_ENTITY:C++,OPEN_WAKA:C++,SGML_DECL:C++,SGML_DECL_QUOTED:C++,DOCTYPE:C++,DOCTYPE_QUOTED:C++,DOCTYPE_DTD:C++,DOCTYPE_DTD_QUOTED:C++,COMMENT_STARTING:C++,COMMENT:C++,COMMENT_ENDING:C++,COMMENT_ENDED:C++,CDATA:C++,CDATA_ENDING:C++,CDATA_ENDING_2:C++,PROC_INST:C++,PROC_INST_BODY:C++,PROC_INST_ENDING:C++,OPEN_TAG:C++,OPEN_TAG_SLASH:C++,ATTRIB:C++,ATTRIB_NAME:C++,ATTRIB_NAME_SAW_WHITE:C++,ATTRIB_VALUE:C++,ATTRIB_VALUE_QUOTED:C++,ATTRIB_VALUE_CLOSED:C++,ATTRIB_VALUE_UNQUOTED:C++,ATTRIB_VALUE_ENTITY_Q:C++,ATTRIB_VALUE_ENTITY_U:C++,CLOSE_TAG:C++,CLOSE_TAG_SAW_WHITE:C++,SCRIPT:C++,SCRIPT_ENDING:C++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(b){var y=e.ENTITIES[b],P=typeof y=="number"?String.fromCharCode(y):y;e.ENTITIES[b]=P});for(var Y in e.STATE)e.STATE[e.STATE[Y]]=Y;C=e.STATE;function Q(b,y,P){b[y]&&b[y](P)}function X(b,y,P){b.textNode&&H(b),Q(b,y,P)}function H(b){b.textNode=ye(b.opt,b.textNode),b.textNode&&Q(b,"ontext",b.textNode),b.textNode=""}function ye(b,y){return b.trim&&(y=y.trim()),b.normalize&&(y=y.replace(/\s+/g," ")),y}function he(b,y){return H(b),b.trackPosition&&(y+="\nLine: "+b.line+"\nColumn: "+b.column+"\nChar: "+b.c),y=new Error(y),b.error=y,Q(b,"onerror",y),b}function xe(b){return b.sawRoot&&!b.closedRoot&&W(b,"Unclosed root tag"),b.state!==C.BEGIN&&b.state!==C.BEGIN_WHITESPACE&&b.state!==C.TEXT&&he(b,"Unexpected end"),H(b),b.c="",b.closed=!0,Q(b,"onend"),r.call(b,b.strict,b.opt),b}function W(b,y){if(typeof b!="object"||!(b instanceof r))throw new Error("bad call to strictFail");b.strict&&he(b,y)}function pe(b){b.strict||(b.tagName=b.tagName[b.looseCase]());var y=b.tags[b.tags.length-1]||b,P=b.tag={name:b.tagName,attributes:{}};b.opt.xmlns&&(P.ns=y.ns),b.attribList.length=0,X(b,"onopentagstart",P)}function ue(b,y){var P=b.indexOf(":"),x=P<0?["",b]:b.split(":"),ne=x[0],ge=x[1];return y&&b==="xmlns"&&(ne="xmlns",ge=""),{prefix:ne,local:ge}}function q(b){if(b.strict||(b.attribName=b.attribName[b.looseCase]()),b.attribList.indexOf(b.attribName)!==-1||b.tag.attributes.hasOwnProperty(b.attribName)){b.attribName=b.attribValue="";return}if(b.opt.xmlns){var y=ue(b.attribName,!0),P=y.prefix,x=y.local;if(P==="xmlns")if(x==="xml"&&b.attribValue!==w)W(b,"xml: prefix must be bound to "+w+"\nActual: "+b.attribValue);else if(x==="xmlns"&&b.attribValue!==g)W(b,"xmlns: prefix must be bound to "+g+"\nActual: "+b.attribValue);else{var ne=b.tag,ge=b.tags[b.tags.length-1]||b;ne.ns===ge.ns&&(ne.ns=Object.create(ge.ns)),ne.ns[x]=b.attribValue}b.attribList.push([b.attribName,b.attribValue])}else b.tag.attributes[b.attribName]=b.attribValue,X(b,"onattribute",{name:b.attribName,value:b.attribValue});b.attribName=b.attribValue=""}function _(b,y){if(b.opt.xmlns){var P=b.tag,x=ue(b.tagName);P.prefix=x.prefix,P.local=x.local,P.uri=P.ns[x.prefix]||"",P.prefix&&!P.uri&&(W(b,"Unbound namespace prefix: "+JSON.stringify(b.tagName)),P.uri=x.prefix);var ne=b.tags[b.tags.length-1]||b;P.ns&&ne.ns!==P.ns&&Object.keys(P.ns).forEach(function(Jd){X(b,"onopennamespace",{prefix:Jd,uri:P.ns[Jd]})});for(var ge=0,te=b.attribList.length;ge<te;ge++){var Bt=b.attribList[ge],Ot=Bt[0],Wn=Bt[1],ut=ue(Ot,!0),Cs=ut.prefix,Qw=ut.local,Fd=Cs===""?"":P.ns[Cs]||"",mm={name:Ot,value:Wn,prefix:Cs,local:Qw,uri:Fd};Cs&&Cs!=="xmlns"&&!Fd&&(W(b,"Unbound namespace prefix: "+JSON.stringify(Cs)),mm.uri=Cs),b.tag.attributes[Ot]=mm,X(b,"onattribute",mm)}b.attribList.length=0}b.tag.isSelfClosing=!!y,b.sawRoot=!0,b.tags.push(b.tag),X(b,"onopentag",b.tag),y||(!b.noscript&&b.tagName.toLowerCase()==="script"?b.state=C.SCRIPT:b.state=C.TEXT,b.tag=null,b.tagName=""),b.attribName=b.attribValue="",b.attribList.length=0}function F(b){if(!b.tagName){W(b,"Weird empty close tag."),b.textNode+="</>",b.state=C.TEXT;return}if(b.script){if(b.tagName!=="script"){b.script+="</"+b.tagName+">",b.tagName="",b.state=C.SCRIPT;return}X(b,"onscript",b.script),b.script=""}var y=b.tags.length,P=b.tagName;b.strict||(P=P[b.looseCase]());for(var x=P;y--;){var ne=b.tags[y];if(ne.name!==x)W(b,"Unexpected close tag");else break}if(y<0){W(b,"Unmatched closing tag: "+b.tagName),b.textNode+="</"+b.tagName+">",b.state=C.TEXT;return}b.tagName=P;for(var ge=b.tags.length;ge-- >y;){var te=b.tag=b.tags.pop();b.tagName=b.tag.name,X(b,"onclosetag",b.tagName);var Bt={};for(var Ot in te.ns)Bt[Ot]=te.ns[Ot];var Wn=b.tags[b.tags.length-1]||b;b.opt.xmlns&&te.ns!==Wn.ns&&Object.keys(te.ns).forEach(function(ut){var Cs=te.ns[ut];X(b,"onclosenamespace",{prefix:ut,uri:Cs})})}y===0&&(b.closedRoot=!0),b.tagName=b.attribValue=b.attribName="",b.attribList.length=0,b.state=C.TEXT}function ee(b){var y=b.entity,P=y.toLowerCase(),x,ne="";return b.ENTITIES[y]?b.ENTITIES[y]:b.ENTITIES[P]?b.ENTITIES[P]:(y=P,y.charAt(0)==="#"&&(y.charAt(1)==="x"?(y=y.slice(2),x=parseInt(y,16),ne=x.toString(16)):(y=y.slice(1),x=parseInt(y,10),ne=x.toString(10))),y=y.replace(/^0+/,""),isNaN(x)||ne.toLowerCase()!==y?(W(b,"Invalid character entity"),"&"+b.entity+";"):String.fromCodePoint(x))}function ae(b,y){y==="<"?(b.state=C.OPEN_WAKA,b.startTagPosition=b.position):k(y)||(W(b,"Non-whitespace before first tag."),b.textNode=y,b.state=C.TEXT)}function Ae(b,y){var P="";return y<b.length&&(P=b.charAt(y)),P}function $t(b){var y=this;if(this.error)throw this.error;if(y.closed)return he(y,"Cannot write after close. Assign an onready handler.");if(b===null)return xe(y);typeof b=="object"&&(b=b.toString());for(var P=0,x="";x=Ae(b,P++),y.c=x,!!x;)switch(y.trackPosition&&(y.position++,x==="\n"?(y.line++,y.column=0):y.column++),y.state){case C.BEGIN:if(y.state=C.BEGIN_WHITESPACE,x==="\uFEFF")continue;ae(y,x);continue;case C.BEGIN_WHITESPACE:ae(y,x);continue;case C.TEXT:if(y.sawRoot&&!y.closedRoot){for(var ne=P-1;x&&x!=="<"&&x!=="&";)x=Ae(b,P++),x&&y.trackPosition&&(y.position++,x==="\n"?(y.line++,y.column=0):y.column++);y.textNode+=b.substring(ne,P-1)}x==="<"&&!(y.sawRoot&&y.closedRoot&&!y.strict)?(y.state=C.OPEN_WAKA,y.startTagPosition=y.position):(!k(x)&&(!y.sawRoot||y.closedRoot)&&W(y,"Text data outside of root node."),x==="&"?y.state=C.TEXT_ENTITY:y.textNode+=x);continue;case C.SCRIPT:x==="<"?y.state=C.SCRIPT_ENDING:y.script+=x;continue;case C.SCRIPT_ENDING:x==="/"?y.state=C.CLOSE_TAG:(y.script+="<"+x,y.state=C.SCRIPT);continue;case C.OPEN_WAKA:if(x==="!")y.state=C.SGML_DECL,y.sgmlDecl="";else if(!k(x))if(j(d,x))y.state=C.OPEN_TAG,y.tagName=x;else if(x==="/")y.state=C.CLOSE_TAG,y.tagName="";else if(x==="?")y.state=C.PROC_INST,y.procInstName=y.procInstBody="";else{if(W(y,"Unencoded <"),y.startTagPosition+1<y.position){var ge=y.position-y.startTagPosition;x=new Array(ge).join(" ")+x}y.textNode+="<"+x,y.state=C.TEXT}continue;case C.SGML_DECL:if(y.sgmlDecl+x==="--"){y.state=C.COMMENT,y.comment="",y.sgmlDecl="";continue}y.doctype&&y.doctype!==!0&&y.sgmlDecl?(y.state=C.DOCTYPE_DTD,y.doctype+="<!"+y.sgmlDecl+x,y.sgmlDecl=""):(y.sgmlDecl+x).toUpperCase()===m?(X(y,"onopencdata"),y.state=C.CDATA,y.sgmlDecl="",y.cdata=""):(y.sgmlDecl+x).toUpperCase()===h?(y.state=C.DOCTYPE,(y.doctype||y.sawRoot)&&W(y,"Inappropriately located doctype declaration"),y.doctype="",y.sgmlDecl=""):x===">"?(X(y,"onsgmldeclaration",y.sgmlDecl),y.sgmlDecl="",y.state=C.TEXT):(I(x)&&(y.state=C.SGML_DECL_QUOTED),y.sgmlDecl+=x);continue;case C.SGML_DECL_QUOTED:x===y.q&&(y.state=C.SGML_DECL,y.q=""),y.sgmlDecl+=x;continue;case C.DOCTYPE:x===">"?(y.state=C.TEXT,X(y,"ondoctype",y.doctype),y.doctype=!0):(y.doctype+=x,x==="["?y.state=C.DOCTYPE_DTD:I(x)&&(y.state=C.DOCTYPE_QUOTED,y.q=x));continue;case C.DOCTYPE_QUOTED:y.doctype+=x,x===y.q&&(y.q="",y.state=C.DOCTYPE);continue;case C.DOCTYPE_DTD:x==="]"?(y.doctype+=x,y.state=C.DOCTYPE):x==="<"?(y.state=C.OPEN_WAKA,y.startTagPosition=y.position):I(x)?(y.doctype+=x,y.state=C.DOCTYPE_DTD_QUOTED,y.q=x):y.doctype+=x;continue;case C.DOCTYPE_DTD_QUOTED:y.doctype+=x,x===y.q&&(y.state=C.DOCTYPE_DTD,y.q="");continue;case C.COMMENT:x==="-"?y.state=C.COMMENT_ENDING:y.comment+=x;continue;case C.COMMENT_ENDING:x==="-"?(y.state=C.COMMENT_ENDED,y.comment=ye(y.opt,y.comment),y.comment&&X(y,"oncomment",y.comment),y.comment=""):(y.comment+="-"+x,y.state=C.COMMENT);continue;case C.COMMENT_ENDED:x!==">"?(W(y,"Malformed comment"),y.comment+="--"+x,y.state=C.COMMENT):y.doctype&&y.doctype!==!0?y.state=C.DOCTYPE_DTD:y.state=C.TEXT;continue;case C.CDATA:x==="]"?y.state=C.CDATA_ENDING:y.cdata+=x;continue;case C.CDATA_ENDING:x==="]"?y.state=C.CDATA_ENDING_2:(y.cdata+="]"+x,y.state=C.CDATA);continue;case C.CDATA_ENDING_2:x===">"?(y.cdata&&X(y,"oncdata",y.cdata),X(y,"onclosecdata"),y.cdata="",y.state=C.TEXT):x==="]"?y.cdata+="]":(y.cdata+="]]"+x,y.state=C.CDATA);continue;case C.PROC_INST:x==="?"?y.state=C.PROC_INST_ENDING:k(x)?y.state=C.PROC_INST_BODY:y.procInstName+=x;continue;case C.PROC_INST_BODY:if(!y.procInstBody&&k(x))continue;x==="?"?y.state=C.PROC_INST_ENDING:y.procInstBody+=x;continue;case C.PROC_INST_ENDING:x===">"?(X(y,"onprocessinginstruction",{name:y.procInstName,body:y.procInstBody}),y.procInstName=y.procInstBody="",y.state=C.TEXT):(y.procInstBody+="?"+x,y.state=C.PROC_INST_BODY);continue;case C.OPEN_TAG:j(S,x)?y.tagName+=x:(pe(y),x===">"?_(y):x==="/"?y.state=C.OPEN_TAG_SLASH:(k(x)||W(y,"Invalid character in tag name"),y.state=C.ATTRIB));continue;case C.OPEN_TAG_SLASH:x===">"?(_(y,!0),F(y)):(W(y,"Forward-slash in opening tag not followed by >"),y.state=C.ATTRIB);continue;case C.ATTRIB:if(k(x))continue;x===">"?_(y):x==="/"?y.state=C.OPEN_TAG_SLASH:j(d,x)?(y.attribName=x,y.attribValue="",y.state=C.ATTRIB_NAME):W(y,"Invalid attribute name");continue;case C.ATTRIB_NAME:x==="="?y.state=C.ATTRIB_VALUE:x===">"?(W(y,"Attribute without value"),y.attribValue=y.attribName,q(y),_(y)):k(x)?y.state=C.ATTRIB_NAME_SAW_WHITE:j(S,x)?y.attribName+=x:W(y,"Invalid attribute name");continue;case C.ATTRIB_NAME_SAW_WHITE:if(x==="=")y.state=C.ATTRIB_VALUE;else{if(k(x))continue;W(y,"Attribute without value"),y.tag.attributes[y.attribName]="",y.attribValue="",X(y,"onattribute",{name:y.attribName,value:""}),y.attribName="",x===">"?_(y):j(d,x)?(y.attribName=x,y.state=C.ATTRIB_NAME):(W(y,"Invalid attribute name"),y.state=C.ATTRIB)}continue;case C.ATTRIB_VALUE:if(k(x))continue;I(x)?(y.q=x,y.state=C.ATTRIB_VALUE_QUOTED):(y.opt.unquotedAttributeValues||he(y,"Unquoted attribute value"),y.state=C.ATTRIB_VALUE_UNQUOTED,y.attribValue=x);continue;case C.ATTRIB_VALUE_QUOTED:if(x!==y.q){x==="&"?y.state=C.ATTRIB_VALUE_ENTITY_Q:y.attribValue+=x;continue}q(y),y.q="",y.state=C.ATTRIB_VALUE_CLOSED;continue;case C.ATTRIB_VALUE_CLOSED:k(x)?y.state=C.ATTRIB:x===">"?_(y):x==="/"?y.state=C.OPEN_TAG_SLASH:j(d,x)?(W(y,"No whitespace between attributes"),y.attribName=x,y.attribValue="",y.state=C.ATTRIB_NAME):W(y,"Invalid attribute name");continue;case C.ATTRIB_VALUE_UNQUOTED:if(!R(x)){x==="&"?y.state=C.ATTRIB_VALUE_ENTITY_U:y.attribValue+=x;continue}q(y),x===">"?_(y):y.state=C.ATTRIB;continue;case C.CLOSE_TAG:if(y.tagName)x===">"?F(y):j(S,x)?y.tagName+=x:y.script?(y.script+="</"+y.tagName,y.tagName="",y.state=C.SCRIPT):(k(x)||W(y,"Invalid tagname in closing tag"),y.state=C.CLOSE_TAG_SAW_WHITE);else{if(k(x))continue;K(d,x)?y.script?(y.script+="</"+x,y.state=C.SCRIPT):W(y,"Invalid tagname in closing tag."):y.tagName=x}continue;case C.CLOSE_TAG_SAW_WHITE:if(k(x))continue;x===">"?F(y):W(y,"Invalid characters in closing tag");continue;case C.TEXT_ENTITY:case C.ATTRIB_VALUE_ENTITY_Q:case C.ATTRIB_VALUE_ENTITY_U:var te,Bt;switch(y.state){case C.TEXT_ENTITY:te=C.TEXT,Bt="textNode";break;case C.ATTRIB_VALUE_ENTITY_Q:te=C.ATTRIB_VALUE_QUOTED,Bt="attribValue";break;case C.ATTRIB_VALUE_ENTITY_U:te=C.ATTRIB_VALUE_UNQUOTED,Bt="attribValue";break}if(x===";"){var Ot=ee(y);y.opt.unparsedEntities&&!Object.values(e.XML_ENTITIES).includes(Ot)?(y.entity="",y.state=te,y.write(Ot)):(y[Bt]+=Ot,y.entity="",y.state=te)}else j(y.entity.length?E:A,x)?y.entity+=x:(W(y,"Invalid character in entity name"),y[Bt]+="&"+y.entity+x,y.entity="",y.state=te);continue;default:throw new Error(y,"Unknown state: "+y.state)}return y.position>=y.bufferCheckPosition&&a(y),y}String.fromCodePoint||function(){var b=String.fromCharCode,y=Math.floor,P=function(){var x=16384,ne=[],ge,te,Bt=-1,Ot=arguments.length;if(!Ot)return"";for(var Wn="";++Bt<Ot;){var ut=Number(arguments[Bt]);if(!isFinite(ut)||ut<0||ut>1114111||y(ut)!==ut)throw RangeError("Invalid code point: "+ut);ut<=65535?ne.push(ut):(ut-=65536,ge=(ut>>10)+55296,te=ut%1024+56320,ne.push(ge,te)),(Bt+1===Ot||ne.length>x)&&(Wn+=b.apply(null,ne),ne.length=0)}return Wn};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:P,configurable:!0,writable:!0}):String.fromCodePoint=P}()})(s)}($p)),$p}fb();var Sd={},um={};(function(s){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",r="["+e+"]["+t+"]*",a=new RegExp("^"+r+"$"),n=function(o,u){const c=[];let l=u.exec(o);for(;l;){const m=[];m.startIndex=u.lastIndex-l[0].length;const h=l.length;for(let w=0;w<h;w++)m.push(l[w]);c.push(m),l=u.exec(o)}return c},i=function(o){const u=a.exec(o);return!(u===null||typeof u>"u")};s.isExist=function(o){return typeof o<"u"},s.isEmptyObject=function(o){return Object.keys(o).length===0},s.merge=function(o,u,c){if(u){const l=Object.keys(u),m=l.length;for(let h=0;h<m;h++)c==="strict"?o[l[h]]=[u[l[h]]]:o[l[h]]=u[l[h]]}},s.getValue=function(o){return s.isExist(o)?o:""},s.isName=i,s.getAllMatches=n,s.nameRegexp=r})(um);const Nd=um,db={allowBooleanAttributes:!1,unpairedTags:[]};Sd.validate=function(s,e){e=Object.assign({},db,e);const t=[];let r=!1,a=!1;s[0]==="\uFEFF"&&(s=s.substr(1));for(let n=0;n<s.length;n++)if(s[n]==="<"&&s[n+1]==="?"){if(n+=2,n=Hp(s,n),n.err)return n}else if(s[n]==="<"){let i=n;if(n++,s[n]==="!"){n=Fp(s,n);continue}else{let o=!1;s[n]==="/"&&(o=!0,n++);let u="";for(;n<s.length&&s[n]!==">"&&s[n]!==" "&&s[n]!=="	"&&s[n]!=="\n"&&s[n]!=="\r";n++)u+=s[n];if(u=u.trim(),u[u.length-1]==="/"&&(u=u.substring(0,u.length-1),n--),!Sb(u)){let m;return u.trim().length===0?m="Invalid space after '<'.":m="Tag '"+u+"' is an invalid name.",Re("InvalidTag",m,bt(s,n))}const c=wb(s,n);if(c===!1)return Re("InvalidAttr","Attributes for '"+u+"' have open quote.",bt(s,n));let l=c.value;if(n=c.index,l[l.length-1]==="/"){const m=n-l.length;l=l.substring(0,l.length-1);const h=Jp(l,e);if(h===!0)r=!0;else return Re(h.err.code,h.err.msg,bt(s,m+h.err.line))}else if(o)if(c.tagClosed){if(l.trim().length>0)return Re("InvalidTag","Closing tag '"+u+"' can't have attributes or invalid starting.",bt(s,i));if(t.length===0)return Re("InvalidTag","Closing tag '"+u+"' has not been opened.",bt(s,i));{const m=t.pop();if(u!==m.tagName){let h=bt(s,m.tagStartPos);return Re("InvalidTag","Expected closing tag '"+m.tagName+"' (opened in line "+h.line+", col "+h.col+") instead of closing tag '"+u+"'.",bt(s,i))}t.length==0&&(a=!0)}}else return Re("InvalidTag","Closing tag '"+u+"' doesn't have proper closing.",bt(s,n));else{const m=Jp(l,e);if(m!==!0)return Re(m.err.code,m.err.msg,bt(s,n-l.length+m.err.line));if(a===!0)return Re("InvalidXml","Multiple possible root nodes found.",bt(s,n));e.unpairedTags.indexOf(u)!==-1||t.push({tagName:u,tagStartPos:i}),r=!0}for(n++;n<s.length;n++)if(s[n]==="<")if(s[n+1]==="!"){n++,n=Fp(s,n);continue}else if(s[n+1]==="?"){if(n=Hp(s,++n),n.err)return n}else break;else if(s[n]==="&"){const m=bb(s,n);if(m==-1)return Re("InvalidChar","char '&' is not expected.",bt(s,n));n=m}else if(a===!0&&!Mp(s[n]))return Re("InvalidXml","Extra text at the end",bt(s,n));s[n]==="<"&&n--}}else{if(Mp(s[n]))continue;return Re("InvalidChar","char '"+s[n]+"' is not expected.",bt(s,n))}if(r){if(t.length==1)return Re("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",bt(s,t[0].tagStartPos));if(t.length>0)return Re("InvalidXml","Invalid '"+JSON.stringify(t.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Re("InvalidXml","Start tag expected.",1);return!0};function Mp(s){return s===" "||s==="	"||s==="\n"||s==="\r"}function Hp(s,e){const t=e;for(;e<s.length;e++)if(s[e]=="?"||s[e]==" "){const r=s.substr(t,e-t);if(e>5&&r==="xml")return Re("InvalidXml","XML declaration allowed only at the start of the document.",bt(s,e));if(s[e]=="?"&&s[e+1]==">"){e++;break}else continue}return e}function Fp(s,e){if(s.length>e+5&&s[e+1]==="-"&&s[e+2]==="-"){for(e+=3;e<s.length;e++)if(s[e]==="-"&&s[e+1]==="-"&&s[e+2]===">"){e+=2;break}}else if(s.length>e+8&&s[e+1]==="D"&&s[e+2]==="O"&&s[e+3]==="C"&&s[e+4]==="T"&&s[e+5]==="Y"&&s[e+6]==="P"&&s[e+7]==="E"){let t=1;for(e+=8;e<s.length;e++)if(s[e]==="<")t++;else if(s[e]===">"&&(t--,t===0))break}else if(s.length>e+9&&s[e+1]==="["&&s[e+2]==="C"&&s[e+3]==="D"&&s[e+4]==="A"&&s[e+5]==="T"&&s[e+6]==="A"&&s[e+7]==="["){for(e+=8;e<s.length;e++)if(s[e]==="]"&&s[e+1]==="]"&&s[e+2]===">"){e+=2;break}}return e}const pb='"',gb="'";function wb(s,e){let t="",r="",a=!1;for(;e<s.length;e++){if(s[e]===pb||s[e]===gb)r===""?r=s[e]:r!==s[e]||(r="");else if(s[e]===">"&&r===""){a=!0;break}t+=s[e]}return r!==""?!1:{value:t,index:e,tagClosed:a}}const yb=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function Jp(s,e){const t=Nd.getAllMatches(s,yb),r={};for(let a=0;a<t.length;a++){if(t[a][1].length===0)return Re("InvalidAttr","Attribute '"+t[a][2]+"' has no space in starting.",Wo(t[a]));if(t[a][3]!==void 0&&t[a][4]===void 0)return Re("InvalidAttr","Attribute '"+t[a][2]+"' is without value.",Wo(t[a]));if(t[a][3]===void 0&&!e.allowBooleanAttributes)return Re("InvalidAttr","boolean attribute '"+t[a][2]+"' is not allowed.",Wo(t[a]));const n=t[a][2];if(!Ab(n))return Re("InvalidAttr","Attribute '"+n+"' is an invalid name.",Wo(t[a]));if(!r.hasOwnProperty(n))r[n]=1;else return Re("InvalidAttr","Attribute '"+n+"' is repeated.",Wo(t[a]))}return!0}function vb(s,e){let t=/\d/;for(s[e]==="x"&&(e++,t=/[\da-fA-F]/);e<s.length;e++){if(s[e]===";")return e;if(!s[e].match(t))break}return-1}function bb(s,e){if(e++,s[e]===";")return-1;if(s[e]==="#")return e++,vb(s,e);let t=0;for(;e<s.length;e++,t++)if(!(s[e].match(/\w/)&&t<20)){if(s[e]===";")break;return-1}return e}function Re(s,e,t){return{err:{code:s,msg:e,line:t.line||t,col:t.col}}}function Ab(s){return Nd.isName(s)}function Sb(s){return Nd.isName(s)}function bt(s,e){const t=s.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function Wo(s){return s.startIndex+s[1].length}var Rf={};const gw={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,e){return e},attributeValueProcessor:function(s,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,e,t){return s}},Nb=function(s){return Object.assign({},gw,s)};Rf.buildOptions=Nb,Rf.defaultOptions=gw;class kb{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}var Eb=kb;const Cb=um;function Ib(s,e){const t={};if(s[e+3]==="O"&&s[e+4]==="C"&&s[e+5]==="T"&&s[e+6]==="Y"&&s[e+7]==="P"&&s[e+8]==="E"){e=e+9;let r=1,a=!1,n=!1,i="";for(;e<s.length;e++)if(s[e]==="<"&&!n){if(a&&Pb(s,e)){e+=7;let o,u;[o,u,e]=xb(s,e+1),u.indexOf("&")===-1&&(t[Tb(o)]={regx:RegExp("&".concat(o,";"),"g"),val:u})}else if(a&&Bb(s,e))e+=8;else if(a&&Ob(s,e))e+=8;else if(a&&Db(s,e))e+=9;else if(Vb)n=!0;else throw new Error("Invalid DOCTYPE");r++,i=""}else if(s[e]===">"){if(n?s[e-1]==="-"&&s[e-2]==="-"&&(n=!1,r--):r--,r===0)break}else s[e]==="["?a=!0:i+=s[e];if(r!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function xb(s,e){let t="";for(;e<s.length&&s[e]!=="'"&&s[e]!=='"';e++)t+=s[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");const r=s[e++];let a="";for(;e<s.length&&s[e]!==r;e++)a+=s[e];return[t,a,e]}function Vb(s,e){return s[e+1]==="!"&&s[e+2]==="-"&&s[e+3]==="-"}function Pb(s,e){return s[e+1]==="!"&&s[e+2]==="E"&&s[e+3]==="N"&&s[e+4]==="T"&&s[e+5]==="I"&&s[e+6]==="T"&&s[e+7]==="Y"}function Bb(s,e){return s[e+1]==="!"&&s[e+2]==="E"&&s[e+3]==="L"&&s[e+4]==="E"&&s[e+5]==="M"&&s[e+6]==="E"&&s[e+7]==="N"&&s[e+8]==="T"}function Ob(s,e){return s[e+1]==="!"&&s[e+2]==="A"&&s[e+3]==="T"&&s[e+4]==="T"&&s[e+5]==="L"&&s[e+6]==="I"&&s[e+7]==="S"&&s[e+8]==="T"}function Db(s,e){return s[e+1]==="!"&&s[e+2]==="N"&&s[e+3]==="O"&&s[e+4]==="T"&&s[e+5]==="A"&&s[e+6]==="T"&&s[e+7]==="I"&&s[e+8]==="O"&&s[e+9]==="N"}function Tb(s){if(Cb.isName(s))return s;throw new Error("Invalid entity name ".concat(s))}var Rb=Ib;const Lb=/^[-+]?0x[a-fA-F0-9]+$/,Ub=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,jb={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function $b(s,e={}){if(e=Object.assign({},jb,e),!s||typeof s!="string")return s;let t=s.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return s;if(s==="0")return 0;if(e.hex&&Lb.test(t))return Mb(t,16);if(t.search(/[eE]/)!==-1){const r=t.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(r){if(e.leadingZeros)t=(r[1]||"")+r[3];else if(!(r[2]==="0"&&r[3][0]==="."))return s;return e.eNotation?Number(t):s}else return s}else{const r=Ub.exec(t);if(r){const a=r[1],n=r[2];let i=Kb(r[3]);if(!e.leadingZeros&&n.length>0&&a&&t[2]!=="."||!e.leadingZeros&&n.length>0&&!a&&t[1]!==".")return s;if(e.leadingZeros&&n===s)return 0;{const o=Number(t),u=""+o;return u.search(/[eE]/)!==-1?e.eNotation?o:s:t.indexOf(".")!==-1?u==="0"&&i===""||u===i||a&&u==="-"+i?o:s:n?i===u||a+i===u?o:s:t===u||t===a+u?o:s}}else return s}}function Kb(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}function Mb(s,e){if(parseInt)return parseInt(s,e);if(Number.parseInt)return Number.parseInt(s,e);if(window&&window.parseInt)return window.parseInt(s,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}var Hb=$b;function Fb(s){return typeof s=="function"?s:Array.isArray(s)?e=>{for(const t of s)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}var ww=Fb;const yw=um,Go=Eb,Jb=Rb,qb=Hb,_b=ww;let Wb=class{constructor(s){this.options=s,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=Gb,this.parseXml=Zb,this.parseTextData=Xb,this.resolveNameSpace=zb,this.buildAttributesMap=Qb,this.isItStopNode=r1,this.replaceEntitiesValue=t1,this.readStopNodeData=n1,this.saveTextToParentTag=s1,this.addChild=e1,this.ignoreAttributesFn=_b(this.options.ignoreAttributes)}};function Gb(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const r=e[t];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:s[r]}}}function Xb(s,e,t,r,a,n,i){if(s!==void 0&&(this.options.trimValues&&!r&&(s=s.trim()),s.length>0)){i||(s=this.replaceEntitiesValue(s));const o=this.options.tagValueProcessor(e,s,t,a,n);return o==null?s:typeof o!=typeof s||o!==s?o:this.options.trimValues?Uf(s,this.options.parseTagValue,this.options.numberParseOptions):s.trim()===s?Uf(s,this.options.parseTagValue,this.options.numberParseOptions):s}}function zb(s){if(this.options.removeNSPrefix){const e=s.split(":"),t=s.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(s=t+e[1])}return s}const Yb=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function Qb(s,e,t){if(this.options.ignoreAttributes!==!0&&typeof s=="string"){const r=yw.getAllMatches(s,Yb),a=r.length,n={};for(let i=0;i<a;i++){const o=this.resolveNameSpace(r[i][1]);if(this.ignoreAttributesFn(o,e))continue;let u=r[i][4],c=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),u!==void 0){this.options.trimValues&&(u=u.trim()),u=this.replaceEntitiesValue(u);const l=this.options.attributeValueProcessor(o,u,e);l==null?n[c]=u:typeof l!=typeof u||l!==u?n[c]=l:n[c]=Uf(u,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[c]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const i={};return i[this.options.attributesGroupName]=n,i}return n}}const Zb=function(s){s=s.replace(/\r\n?/g,"\n");const e=new Go("!xml");let t=e,r="",a="";for(let n=0;n<s.length;n++)if(s[n]==="<")if(s[n+1]==="/"){const i=In(s,">",n,"Closing Tag is not closed.");let o=s.substring(n+2,i).trim();if(this.options.removeNSPrefix){const l=o.indexOf(":");l!==-1&&(o=o.substr(l+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&(r=this.saveTextToParentTag(r,t,a));const u=a.substring(a.lastIndexOf(".")+1);if(o&&this.options.unpairedTags.indexOf(o)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(o,">"));let c=0;u&&this.options.unpairedTags.indexOf(u)!==-1?(c=a.lastIndexOf(".",a.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=a.lastIndexOf("."),a=a.substring(0,c),t=this.tagsNodeStack.pop(),r="",n=i}else if(s[n+1]==="?"){let i=Lf(s,n,!1,"?>");if(!i)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,t,a),!(this.options.ignoreDeclaration&&i.tagName==="?xml"||this.options.ignorePiTags)){const o=new Go(i.tagName);o.add(this.options.textNodeName,""),i.tagName!==i.tagExp&&i.attrExpPresent&&(o[":@"]=this.buildAttributesMap(i.tagExp,a,i.tagName)),this.addChild(t,o,a)}n=i.closeIndex+1}else if(s.substr(n+1,3)==="!--"){const i=In(s,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const o=s.substring(n+4,i-2);r=this.saveTextToParentTag(r,t,a),t.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}n=i}else if(s.substr(n+1,2)==="!D"){const i=Jb(s,n);this.docTypeEntities=i.entities,n=i.i}else if(s.substr(n+1,2)==="!["){const i=In(s,"]]>",n,"CDATA is not closed.")-2,o=s.substring(n+9,i);r=this.saveTextToParentTag(r,t,a);let u=this.parseTextData(o,t.tagname,a,!0,!1,!0,!0);u==null&&(u=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]):t.add(this.options.textNodeName,u),n=i+2}else{let i=Lf(s,n,this.options.removeNSPrefix),o=i.tagName;const u=i.rawTagName;let c=i.tagExp,l=i.attrExpPresent,m=i.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&r&&t.tagname!=="!xml"&&(r=this.saveTextToParentTag(r,t,a,!1));const h=t;if(h&&this.options.unpairedTags.indexOf(h.tagname)!==-1&&(t=this.tagsNodeStack.pop(),a=a.substring(0,a.lastIndexOf("."))),o!==e.tagname&&(a+=a?"."+o:o),this.isItStopNode(this.options.stopNodes,a,o)){let w="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)o[o.length-1]==="/"?(o=o.substr(0,o.length-1),a=a.substr(0,a.length-1),c=o):c=c.substr(0,c.length-1),n=i.closeIndex;else if(this.options.unpairedTags.indexOf(o)!==-1)n=i.closeIndex;else{const p=this.readStopNodeData(s,u,m+1);if(!p)throw new Error("Unexpected end of ".concat(u));n=p.i,w=p.tagContent}const g=new Go(o);o!==c&&l&&(g[":@"]=this.buildAttributesMap(c,a,o)),w&&(w=this.parseTextData(w,o,a,!0,l,!0,!0)),a=a.substr(0,a.lastIndexOf(".")),g.add(this.options.textNodeName,w),this.addChild(t,g,a)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){o[o.length-1]==="/"?(o=o.substr(0,o.length-1),a=a.substr(0,a.length-1),c=o):c=c.substr(0,c.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const w=new Go(o);o!==c&&l&&(w[":@"]=this.buildAttributesMap(c,a,o)),this.addChild(t,w,a),a=a.substr(0,a.lastIndexOf("."))}else{const w=new Go(o);this.tagsNodeStack.push(t),o!==c&&l&&(w[":@"]=this.buildAttributesMap(c,a,o)),this.addChild(t,w,a),t=w}r="",n=m}}else r+=s[n];return e.child};function e1(s,e,t){const r=this.options.updateTag(e.tagname,t,e[":@"]);r===!1||(typeof r=="string"&&(e.tagname=r),s.addChild(e))}const t1=function(s){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];s=s.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];s=s.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];s=s.replace(t.regex,t.val)}s=s.replace(this.ampEntity.regex,this.ampEntity.val)}return s};function s1(s,e,t,r){return s&&(r===void 0&&(r=e.child.length===0),s=this.parseTextData(s,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,r),s!==void 0&&s!==""&&e.add(this.options.textNodeName,s),s=""),s}function r1(s,e,t){const r="*."+t;for(const a in s){const n=s[a];if(r===n||e===n)return!0}return!1}function a1(s,e,t=">"){let r,a="";for(let n=e;n<s.length;n++){let i=s[n];if(r)i===r&&(r="");else if(i==='"'||i==="'")r=i;else if(i===t[0])if(t[1]){if(s[n+1]===t[1])return{data:a,index:n}}else return{data:a,index:n};else i==="	"&&(i=" ");a+=i}}function In(s,e,t,r){const a=s.indexOf(e,t);if(a===-1)throw new Error(r);return a+e.length-1}function Lf(s,e,t,r=">"){const a=a1(s,e+1,r);if(!a)return;let n=a.data;const i=a.index,o=n.search(/\s/);let u=n,c=!0;o!==-1&&(u=n.substring(0,o),n=n.substring(o+1).trimStart());const l=u;if(t){const m=u.indexOf(":");m!==-1&&(u=u.substr(m+1),c=u!==a.data.substr(m+1))}return{tagName:u,tagExp:n,closeIndex:i,attrExpPresent:c,rawTagName:l}}function n1(s,e,t){const r=t;let a=1;for(;t<s.length;t++)if(s[t]==="<")if(s[t+1]==="/"){const n=In(s,">",t,"".concat(e," is not closed"));if(s.substring(t+2,n).trim()===e&&(a--,a===0))return{tagContent:s.substring(r,t),i:n};t=n}else if(s[t+1]==="?")t=In(s,"?>",t+1,"StopNode is not closed.");else if(s.substr(t+1,3)==="!--")t=In(s,"-->",t+3,"StopNode is not closed.");else if(s.substr(t+1,2)==="![")t=In(s,"]]>",t,"StopNode is not closed.")-2;else{const n=Lf(s,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&a++,t=n.closeIndex)}}function Uf(s,e,t){if(e&&typeof s=="string"){const r=s.trim();return r==="true"?!0:r==="false"?!1:qb(s,t)}else return yw.isExist(s)?s:""}var i1=Wb,vw={};function o1(s,e){return bw(s,e)}function bw(s,e,t){let r;const a={};for(let n=0;n<s.length;n++){const i=s[n],o=u1(i);let u="";if(t===void 0?u=o:u=t+"."+o,o===e.textNodeName)r===void 0?r=i[o]:r+=""+i[o];else{if(o===void 0)continue;if(i[o]){let c=bw(i[o],e,u);const l=c1(c,e);i[":@"]?l1(c,i[":@"],u,e):Object.keys(c).length===1&&c[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?c=c[e.textNodeName]:Object.keys(c).length===0&&(e.alwaysCreateTextNode?c[e.textNodeName]="":c=""),a[o]!==void 0&&a.hasOwnProperty(o)?(Array.isArray(a[o])||(a[o]=[a[o]]),a[o].push(c)):e.isArray(o,u,l)?a[o]=[c]:a[o]=c}}}return typeof r=="string"?r.length>0&&(a[e.textNodeName]=r):r!==void 0&&(a[e.textNodeName]=r),a}function u1(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const r=e[t];if(r!==":@")return r}}function l1(s,e,t,r){if(e){const a=Object.keys(e),n=a.length;for(let i=0;i<n;i++){const o=a[i];r.isArray(o,t+"."+o,!0,!0)?s[o]=[e[o]]:s[o]=e[o]}}}function c1(s,e){const{textNodeName:t}=e,r=Object.keys(s).length;return!!(r===0||r===1&&(s[t]||typeof s[t]=="boolean"||s[t]===0))}vw.prettify=o1;const{buildOptions:h1}=Rf,m1=i1,{prettify:f1}=vw,d1=Sd;let p1=class{constructor(s){this.externalEntities={},this.options=h1(s)}parse(s,e){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const a=d1.validate(s,e);if(a!==!0)throw Error("".concat(a.err.msg,":").concat(a.err.line,":").concat(a.err.col))}const t=new m1(this.options);t.addExternalEntities(this.externalEntities);const r=t.parseXml(s);return this.options.preserveOrder||r===void 0?r:f1(r,this.options)}addEntity(s,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=e}};var g1=p1;const w1="\n";function y1(s,e){let t="";return e.format&&e.indentBy.length>0&&(t=w1),Aw(s,e,"",t)}function Aw(s,e,t,r){let a="",n=!1;for(let i=0;i<s.length;i++){const o=s[i],u=v1(o);if(u===void 0)continue;let c="";if(t.length===0?c=u:c="".concat(t,".").concat(u),u===e.textNodeName){let g=o[u];b1(c,e)||(g=e.tagValueProcessor(u,g),g=Sw(g,e)),n&&(a+=r),a+=g,n=!1;continue}else if(u===e.cdataPropName){n&&(a+=r),a+="<![CDATA[".concat(o[u][0][e.textNodeName],"]]>"),n=!1;continue}else if(u===e.commentPropName){a+=r+"<!--".concat(o[u][0][e.textNodeName],"-->"),n=!0;continue}else if(u[0]==="?"){const g=qp(o[":@"],e),p=u==="?xml"?"":r;let d=o[u][0][e.textNodeName];d=d.length!==0?" "+d:"",a+=p+"<".concat(u).concat(d).concat(g,"?>"),n=!0;continue}let l=r;l!==""&&(l+=e.indentBy);const m=qp(o[":@"],e),h=r+"<".concat(u).concat(m),w=Aw(o[u],e,c,l);e.unpairedTags.indexOf(u)!==-1?e.suppressUnpairedNode?a+=h+">":a+=h+"/>":(!w||w.length===0)&&e.suppressEmptyNode?a+=h+"/>":w&&w.endsWith(">")?a+=h+">".concat(w).concat(r,"</").concat(u,">"):(a+=h+">",w&&r!==""&&(w.includes("/>")||w.includes("</"))?a+=r+e.indentBy+w+r:a+=w,a+="</".concat(u,">")),n=!0}return a}function v1(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const r=e[t];if(s.hasOwnProperty(r)&&r!==":@")return r}}function qp(s,e){let t="";if(s&&!e.ignoreAttributes)for(let r in s){if(!s.hasOwnProperty(r))continue;let a=e.attributeValueProcessor(r,s[r]);a=Sw(a,e),a===!0&&e.suppressBooleanAttributes?t+=" ".concat(r.substr(e.attributeNamePrefix.length)):t+=" ".concat(r.substr(e.attributeNamePrefix.length),'="').concat(a,'"')}return t}function b1(s,e){s=s.substr(0,s.length-e.textNodeName.length-1);let t=s.substr(s.lastIndexOf(".")+1);for(let r in e.stopNodes)if(e.stopNodes[r]===s||e.stopNodes[r]==="*."+t)return!0;return!1}function Sw(s,e){if(s&&s.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const r=e.entities[t];s=s.replace(r.regex,r.val)}return s}var A1=y1;const S1=A1,N1=ww,k1={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(s,e){return e},attributeValueProcessor:function(s,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function ta(s){this.options=Object.assign({},k1,s),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=N1(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=I1),this.processTextOrObjNode=E1,this.options.format?(this.indentate=C1,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}ta.prototype.build=function(s){return this.options.preserveOrder?S1(s,this.options):(Array.isArray(s)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(s={[this.options.arrayNodeName]:s}),this.j2x(s,0,[]).val)},ta.prototype.j2x=function(s,e,t){let r="",a="";const n=t.join(".");for(let i in s)if(Object.prototype.hasOwnProperty.call(s,i))if(typeof s[i]>"u")this.isAttribute(i)&&(a+="");else if(s[i]===null)this.isAttribute(i)||i===this.options.cdataPropName?a+="":i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(s[i]instanceof Date)a+=this.buildTextValNode(s[i],i,"",e);else if(typeof s[i]!="object"){const o=this.isAttribute(i);if(o&&!this.ignoreAttributesFn(o,n))r+=this.buildAttrPairStr(o,""+s[i]);else if(!o)if(i===this.options.textNodeName){let u=this.options.tagValueProcessor(i,""+s[i]);a+=this.replaceEntitiesValue(u)}else a+=this.buildTextValNode(s[i],i,"",e)}else if(Array.isArray(s[i])){const o=s[i].length;let u="",c="";for(let l=0;l<o;l++){const m=s[i][l];if(!(typeof m>"u"))if(m===null)i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(typeof m=="object")if(this.options.oneListGroup){const h=this.j2x(m,e+1,t.concat(i));u+=h.val,this.options.attributesGroupName&&m.hasOwnProperty(this.options.attributesGroupName)&&(c+=h.attrStr)}else u+=this.processTextOrObjNode(m,i,e,t);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(i,m);h=this.replaceEntitiesValue(h),u+=h}else u+=this.buildTextValNode(m,i,"",e)}this.options.oneListGroup&&(u=this.buildObjectNode(u,i,c,e)),a+=u}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const o=Object.keys(s[i]),u=o.length;for(let c=0;c<u;c++)r+=this.buildAttrPairStr(o[c],""+s[i][o[c]])}else a+=this.processTextOrObjNode(s[i],i,e,t);return{attrStr:r,val:a}},ta.prototype.buildAttrPairStr=function(s,e){return e=this.options.attributeValueProcessor(s,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+s:" "+s+'="'+e+'"'};function E1(s,e,t,r){const a=this.j2x(s,t+1,r.concat(e));return s[this.options.textNodeName]!==void 0&&Object.keys(s).length===1?this.buildTextValNode(s[this.options.textNodeName],e,a.attrStr,t):this.buildObjectNode(a.val,e,a.attrStr,t)}ta.prototype.buildObjectNode=function(s,e,t,r){if(s==="")return e[0]==="?"?this.indentate(r)+"<"+e+t+"?"+this.tagEndChar:this.indentate(r)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let a="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",a=""),(t||t==="")&&s.indexOf("<")===-1?this.indentate(r)+"<"+e+t+n+">"+s+a:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(r)+"<!--".concat(s,"-->")+this.newLine:this.indentate(r)+"<"+e+t+n+this.tagEndChar+s+this.indentate(r)+a}},ta.prototype.closeTag=function(s){let e="";return this.options.unpairedTags.indexOf(s)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e="></".concat(s),e},ta.prototype.buildTextValNode=function(s,e,t,r){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(r)+"<![CDATA[".concat(s,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(r)+"<!--".concat(s,"-->")+this.newLine;if(e[0]==="?")return this.indentate(r)+"<"+e+t+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(e,s);return a=this.replaceEntitiesValue(a),a===""?this.indentate(r)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(r)+"<"+e+t+">"+a+"</"+e+this.tagEndChar}},ta.prototype.replaceEntitiesValue=function(s){if(s&&s.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];s=s.replace(t.regex,t.val)}return s};function C1(s){return this.options.indentBy.repeat(s)}function I1(s){return s.startsWith(this.options.attributeNamePrefix)&&s!==this.options.textNodeName?s.substr(this.attrPrefixLen):!1}var x1=ta;const V1=Sd,P1=g1,B1=x1;var O1={XMLParser:P1,XMLValidator:V1,XMLBuilder:B1};function nh(s){return s.users!==void 0}const D1=s=>s===null?vf().setApp("end_to_end_encryption").build():vf().setApp("end_to_end_encryption").setUid(s.uid).build(),Ze=D1(cd());class Ce{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}toString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)r+=String.fromCharCode(this.view[a]);return r}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);let a=0,n=0;for(let i=0;i<t;i++)i%2?(n|=r.get(e.charAt(i)),this.view[a]=n,a++):n=r.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){const n=this.view[a].toString(16).toUpperCase();r=r+(n.length==1?"0":"")+n}return r}copy(e=0,t=this.length-e){if(!e&&!this.length)return new Ce;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Ce({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new Ce;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Ce({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,r=e.length,a=e._view.subarray();this.realloc(t+r),this._view.set(a,t)}insert(e,t=0,r=this.length-t){return t>this.length-1?!1:(r>this.length-t&&(r=this.length-t),r>e.length&&(r=e.length),r==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,r),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a),u=e.length;if(u>i)return-1;const c=[];for(let l=0;l<u;l++)c.push(e.view[l]);for(let l=0;l<=i-u;l++){let m=!0;const h=o?n-u-l:n+l;for(let w=0;w<u;w++)if(this.view[w+h]!=c[w]){m=!1;break}if(m)return o?n-u-l:n+u+l}return-1}findFirstIn(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a),u={id:-1,position:o?0:n+i,length:0};for(let c=0;c<e.length;c++){const l=this.findPattern(e[c],n,i,o);if(l!=-1){let m=!1;const h=e[c].length;o?l-h>=u.position-u.length&&(m=!0):l-h<=u.position-u.length&&(m=!0),m&&(u.position=l,u.id=c,u.length=h)}}return u}findAllIn(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const i=[];let o={id:-1,position:a};do{const u=o.position;if(o=this.findFirstIn(e,o.position,n),o.id==-1)break;n-=o.position-u,i.push({id:o.id,position:o.position})}while(!0);return i}findAllPatternIn(e,t,r){const{start:a,length:n}=this.prepareFindParameters(t,r),i=[],o=e.length;if(o>n)return-1;const u=Array.from(e.view);for(let c=0;c<=n-o;c++){let l=!0;const m=a+c;for(let h=0;h<o;h++)if(this.view[h+m]!=u[h]){l=!1;break}l&&(i.push(a+o+c),c+=o-1)}return i}findFirstNotIn(e,t,r,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);const u={left:{id:-1,position:n},right:{id:-1,position:0},value:new Ce};let c=i;for(;c>0;){if(u.right=this.findFirstIn(e,o?n-i+c:n+i-c,c,o),u.right.id==-1){i=c,o?n-=i:n=u.left.position,u.value=new Ce({buffer:this._buffer.slice(n,n+i)});break}if(u.right.position!=(o?u.left.position-e[u.right.id].length:u.left.position+e[u.right.id].length)){o?(n=u.right.position+e[u.right.id].length,i=u.left.position-u.right.position-e[u.right.id].length):(n=u.left.position,i=u.right.position-u.left.position-e[u.right.id].length),u.value=new Ce({buffer:this._buffer.slice(n,n+i)});break}u.left=u.right,c-=e[u.right.id].length}if(o){const l=u.right;u.right=u.left,u.left=l}return u}findAllNotIn(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const i=[];let o={left:{id:-1,position:a},right:{id:-1,position:a},value:new Ce};do{const u=o.right.position;o=this.findFirstNotIn(e,o.right.position,n),n-=o.right.position-u,i.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(o.right.id!=-1);return i}findFirstSequence(e,t,r,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);const u=this.skipNotPatterns(e,n,i,o);if(u==-1)return{position:-1,value:new Ce};const c=this.skipPatterns(e,u,i-(o?n-u:u-n),o);o?(n=c,i=u-c):(n=u,i=c-u);const l=new Ce({buffer:this._buffer.slice(n,n+i)});return{position:c,value:l}}findAllSequences(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const i=[];let o={position:a,value:new Ce};do{const u=o.position;o=this.findFirstSequence(e,o.position,n),o.position!=-1&&(n-=o.position-u,i.push({position:o.position,value:o.value}))}while(o.position!=-1);return i}findPairedPatterns(e,t,r,a){const n=[];if(e.isEqual(t))return n;const{start:i,length:o}=this.prepareFindParameters(r,a);let u=0;const c=this.findAllPatternIn(e,i,o);if(!Array.isArray(c)||c.length==0)return n;const l=this.findAllPatternIn(t,i,o);if(!Array.isArray(l)||l.length==0)return n;for(;u<c.length&&l.length!=0;){if(c[0]==l[0]){n.push({left:c[0],right:l[0]}),c.splice(0,1),l.splice(0,1);continue}if(c[u]>l[0])break;for(;c[u]<l[0]&&(u++,!(u>=c.length)););n.push({left:c[u-1],right:l[0]}),c.splice(u-1,1),l.splice(0,1),u=0}return n.sort((m,h)=>m.left-h.left),n}findPairedArrays(e,t,r,a){const{start:n,length:i}=this.prepareFindParameters(r,a),o=[];let u=0;const c=this.findAllIn(e,n,i);if(c.length==0)return o;const l=this.findAllIn(t,n,i);if(l.length==0)return o;for(;u<c.length&&l.length!=0;){if(c[0].position==l[0].position){o.push({left:c[0],right:l[0]}),c.splice(0,1),l.splice(0,1);continue}if(c[u].position>l[0].position)break;for(;c[u].position<l[0].position&&(u++,!(u>=c.length)););o.push({left:c[u-1],right:l[0]}),c.splice(u-1,1),l.splice(0,1),u=0}return o.sort((m,h)=>m.left.position-h.left.position),o}replacePattern(e,t,r,a,n=null){let i=[],o;const u={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:c,length:l}=this.prepareFindParameters(r,a);if(n==null){if(i=this.findAllIn([e],c,l),i.length==0)return u}else i=n;u.searchPatternPositions.push(...Array.from(i,g=>g.position));const m=e.length-t.length,h=new ArrayBuffer(this.view.length-i.length*m),w=new Uint8Array(h);for(w.set(new Uint8Array(this.buffer,0,c)),o=0;o<i.length;o++){const g=o==0?c:i[o-1].position;w.set(new Uint8Array(this.buffer,g,i[o].position-e.length-g),g-o*m),w.set(t.view,i[o].position-e.length-o*m),u.replacePatternPositions.push(i[o].position-e.length-o*m)}return o--,w.set(new Uint8Array(this.buffer,i[o].position,this.length-i[o].position),i[o].position-e.length+t.length-o*m),this.buffer=h,this.view=new Uint8Array(this.buffer),u.status=1,u}skipPatterns(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);let u=n;for(let c=0;c<e.length;c++){const l=e[c].length,m=o?u-l:u;let h=!0;for(let w=0;w<l;w++)if(this.view[w+m]!=e[c].view[w]){h=!1;break}if(h){if(c=-1,o){if(u-=l,u<=0)return u}else if(u+=l,u>=n+i)return u}}return u}skipNotPatterns(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);let u=-1;for(let c=0;c<i;c++){for(let l=0;l<e.length;l++){const m=e[l].length,h=o?n-c-m:n+c;let w=!0;for(let g=0;g<m;g++)if(this.view[g+h]!=e[l].view[g]){w=!1;break}if(w){u=o?n-c:n+c;break}}if(u!=-1)break}return u}prepareFindParameters(e=null,t=null,r=!1){return e===null&&(e=r?this.length:0),e>this.length&&(e=this.length),r?(t===null&&(t=e),t>e&&(t=e)):(t===null&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:r}}}const T1=16777216;class ua{constructor(e={}){this._stream=new Ce,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new Ce({view:e.view}):"buffer"in e?this.stream=new Ce({buffer:e.buffer}):"string"in e?this.stream=new Ce({string:e.string}):"hexstring"in e?this.stream=new Ce({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new Ce,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(t==null||t>this.length)&&(t=this.length);const r=this.stream.findPattern(e,this.start,this.length,this.backward);if(r==-1)return r;if(this.backward){if(r<this.start-e.length-t)return-1}else if(r>this.start+e.length+t)return-1;return this.start=r,r}findFirstIn(e,t=null){(t==null||t>this.length)&&(t=this.length);const r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(r.id==-1)return r;if(this.backward){if(r.position<this.start-e[r.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(t==null||t>this._length)&&(t=this._length);const r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(r.left.id==-1&&r.right.id==-1)return r;if(this.backward){if(r.right.id!=-1&&r.right.position<this._start-e[r.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Ce}}else if(r.left.id!=-1&&r.left.position>this._start+e[r.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Ce};return this.backward?r.left.id==-1?this.start=0:this.start=r.left.position:r.right.id==-1?this.start=this._start+this._length:this.start=r.right.position,r}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,r=null){(t==null||t>this._length)&&(t=this._length),(r==null||r>t)&&(r=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(a.value.length==0)return a;if(this.backward){if(a.position<this._start-a.value.length-r)return{position:-1,value:new Ce}}else if(a.position>this._start+a.value.length+r)return{position:-1,value:new Ce};return this.start=a.position,a}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,r=null){(r==null||r>this.length)&&(r=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right<this.start-t.length-r)return[]}else if(n[0].left>this.start+e.length+r)return[]}return n}findPairedArrays(e,t,r=null){(r==null||r>this.length)&&(r=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-r)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+r)return[]}return n}replacePattern(e,t){const r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return t==-1?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this.stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[2],this._stream.view[this._start+1]=r[1],this._stream.view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);this._length<e&&(e=this._length);let r;if(this.backward){const a=this._stream.view.subarray(this._length-e,this._length);r=new Uint8Array(e);for(let n=0;n<e;n++)r[e-1-n]=a[n]}else r=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),r}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),r=32768;return t&r?-(r-(t^r)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:t[0]*T1+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),r=2147483648;return t&r?-(r-(t^r)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+ua.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}ua.APPEND_BLOCK=1e3;function R1(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function Nw(s,...e){if(!R1(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error("Uint8Array expected of length "+e+", got length="+s.length)}function _p(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function L1(s,e){Nw(s);const t=e.outputLen;if(s.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const jm=s=>new DataView(s.buffer,s.byteOffset,s.byteLength),gs=(s,e)=>s<<32-e|s>>>e,$m=(s,e)=>s<<e|s>>>32-e>>>0;function U1(s){if(typeof s!="string")throw new Error("utf8ToBytes expected string, got "+typeof s);return new Uint8Array(new TextEncoder().encode(s))}function kw(s){return typeof s=="string"&&(s=U1(s)),Nw(s),s}class j1{clone(){return this._cloneInto()}}function lm(s){const e=r=>s().update(kw(r)).digest(),t=s();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>s(),e}function $1(s,e,t,r){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,t,r);const a=BigInt(32),n=BigInt(4294967295),i=Number(t>>a&n),o=Number(t&n),u=r?4:0,c=r?0:4;s.setUint32(e+u,i,r),s.setUint32(e+c,o,r)}const Ew=(s,e,t)=>s&e^~s&t,Cw=(s,e,t)=>s&e^s&t^e&t;class kd extends j1{constructor(e,t,r,a){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=jm(this.buffer)}update(e){_p(this);const{view:t,buffer:r,blockLen:a}=this;e=kw(e);const n=e.length;for(let i=0;i<n;){const o=Math.min(a-this.pos,n-i);if(o===a){const u=jm(e);for(;a<=n-i;i+=a)this.process(u,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){_p(this),L1(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:a,isLE:n}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>a-i&&(this.process(r,0),i=0);for(let m=i;m<a;m++)t[m]=0;$1(r,a-8,BigInt(this.length*8),n),this.process(r,0);const o=jm(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)o.setUint32(4*m,l[m],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:a,finished:n,destroyed:i,pos:o}=this;return e.length=a,e.pos=o,e.finished=n,e.destroyed=i,a%t&&e.buffer.set(r),e}}const Xo=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),tr=new Uint32Array(80);let K1=class extends kd{constructor(){super(64,20,8,!1),this.A=Xo[0]|0,this.B=Xo[1]|0,this.C=Xo[2]|0,this.D=Xo[3]|0,this.E=Xo[4]|0}get(){const{A:s,B:e,C:t,D:r,E:a}=this;return[s,e,t,r,a]}set(s,e,t,r,a){this.A=s|0,this.B=e|0,this.C=t|0,this.D=r|0,this.E=a|0}process(s,e){for(let o=0;o<16;o++,e+=4)tr[o]=s.getUint32(e,!1);for(let o=16;o<80;o++)tr[o]=$m(tr[o-3]^tr[o-8]^tr[o-14]^tr[o-16],1);let{A:t,B:r,C:a,D:n,E:i}=this;for(let o=0;o<80;o++){let u,c;o<20?(u=Ew(r,a,n),c=1518500249):o<40?(u=r^a^n,c=1859775393):o<60?(u=Cw(r,a,n),c=2400959708):(u=r^a^n,c=3395469782);const l=$m(t,5)+u+i+c+tr[o]|0;i=n,n=a,a=$m(r,30),r=t,t=l}t=t+this.A|0,r=r+this.B|0,a=a+this.C|0,n=n+this.D|0,i=i+this.E|0,this.set(t,r,a,n,i)}roundClean(){tr.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}};const M1=lm(()=>new K1),H1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),sr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),rr=new Uint32Array(64);let F1=class extends kd{constructor(){super(64,32,8,!1),this.A=sr[0]|0,this.B=sr[1]|0,this.C=sr[2]|0,this.D=sr[3]|0,this.E=sr[4]|0,this.F=sr[5]|0,this.G=sr[6]|0,this.H=sr[7]|0}get(){const{A:s,B:e,C:t,D:r,E:a,F:n,G:i,H:o}=this;return[s,e,t,r,a,n,i,o]}set(s,e,t,r,a,n,i,o){this.A=s|0,this.B=e|0,this.C=t|0,this.D=r|0,this.E=a|0,this.F=n|0,this.G=i|0,this.H=o|0}process(s,e){for(let l=0;l<16;l++,e+=4)rr[l]=s.getUint32(e,!1);for(let l=16;l<64;l++){const m=rr[l-15],h=rr[l-2],w=gs(m,7)^gs(m,18)^m>>>3,g=gs(h,17)^gs(h,19)^h>>>10;rr[l]=g+rr[l-7]+w+rr[l-16]|0}let{A:t,B:r,C:a,D:n,E:i,F:o,G:u,H:c}=this;for(let l=0;l<64;l++){const m=gs(i,6)^gs(i,11)^gs(i,25),h=c+m+Ew(i,o,u)+H1[l]+rr[l]|0,w=(gs(t,2)^gs(t,13)^gs(t,22))+Cw(t,r,a)|0;c=u,u=o,o=i,i=n+h|0,n=a,a=r,r=t,t=h+w|0}t=t+this.A|0,r=r+this.B|0,a=a+this.C|0,n=n+this.D|0,i=i+this.E|0,o=o+this.F|0,u=u+this.G|0,c=c+this.H|0,this.set(t,r,a,n,i,o,u,c)}roundClean(){rr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const J1=lm(()=>new F1),Vc=BigInt(2**32-1),jf=BigInt(32);function Iw(s,e=!1){return e?{h:Number(s&Vc),l:Number(s>>jf&Vc)}:{h:Number(s>>jf&Vc)|0,l:Number(s&Vc)|0}}function q1(s,e=!1){let t=new Uint32Array(s.length),r=new Uint32Array(s.length);for(let a=0;a<s.length;a++){const{h:n,l:i}=Iw(s[a],e);[t[a],r[a]]=[n,i]}return[t,r]}const _1=(s,e)=>BigInt(s>>>0)<<jf|BigInt(e>>>0),W1=(s,e,t)=>s>>>t,G1=(s,e,t)=>s<<32-t|e>>>t,X1=(s,e,t)=>s>>>t|e<<32-t,z1=(s,e,t)=>s<<32-t|e>>>t,Y1=(s,e,t)=>s<<64-t|e>>>t-32,Q1=(s,e,t)=>s>>>t-32|e<<64-t,Z1=(s,e)=>e,eA=(s,e)=>s,tA=(s,e,t)=>s<<t|e>>>32-t,sA=(s,e,t)=>e<<t|s>>>32-t,rA=(s,e,t)=>e<<t-32|s>>>64-t,aA=(s,e,t)=>s<<t-32|e>>>64-t;function nA(s,e,t,r){const a=(e>>>0)+(r>>>0);return{h:s+t+(a/2**32|0)|0,l:a|0}}const iA=(s,e,t)=>(s>>>0)+(e>>>0)+(t>>>0),oA=(s,e,t,r)=>e+t+r+(s/2**32|0)|0,uA=(s,e,t,r)=>(s>>>0)+(e>>>0)+(t>>>0)+(r>>>0),lA=(s,e,t,r,a)=>e+t+r+a+(s/2**32|0)|0,cA=(s,e,t,r,a)=>(s>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(a>>>0),hA=(s,e,t,r,a,n)=>e+t+r+a+n+(s/2**32|0)|0,re={fromBig:Iw,split:q1,toBig:_1,shrSH:W1,shrSL:G1,rotrSH:X1,rotrSL:z1,rotrBH:Y1,rotrBL:Q1,rotr32H:Z1,rotr32L:eA,rotlSH:tA,rotlSL:sA,rotlBH:rA,rotlBL:aA,add:nA,add3L:iA,add3H:oA,add4L:uA,add4H:lA,add5H:hA,add5L:cA},[mA,fA]=re.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(s=>BigInt(s))),ar=new Uint32Array(80),nr=new Uint32Array(80);let xw=class extends kd{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:s,Al:e,Bh:t,Bl:r,Ch:a,Cl:n,Dh:i,Dl:o,Eh:u,El:c,Fh:l,Fl:m,Gh:h,Gl:w,Hh:g,Hl:p}=this;return[s,e,t,r,a,n,i,o,u,c,l,m,h,w,g,p]}set(s,e,t,r,a,n,i,o,u,c,l,m,h,w,g,p){this.Ah=s|0,this.Al=e|0,this.Bh=t|0,this.Bl=r|0,this.Ch=a|0,this.Cl=n|0,this.Dh=i|0,this.Dl=o|0,this.Eh=u|0,this.El=c|0,this.Fh=l|0,this.Fl=m|0,this.Gh=h|0,this.Gl=w|0,this.Hh=g|0,this.Hl=p|0}process(s,e){for(let A=0;A<16;A++,e+=4)ar[A]=s.getUint32(e),nr[A]=s.getUint32(e+=4);for(let A=16;A<80;A++){const E=ar[A-15]|0,k=nr[A-15]|0,I=re.rotrSH(E,k,1)^re.rotrSH(E,k,8)^re.shrSH(E,k,7),R=re.rotrSL(E,k,1)^re.rotrSL(E,k,8)^re.shrSL(E,k,7),j=ar[A-2]|0,K=nr[A-2]|0,C=re.rotrSH(j,K,19)^re.rotrBH(j,K,61)^re.shrSH(j,K,6),Y=re.rotrSL(j,K,19)^re.rotrBL(j,K,61)^re.shrSL(j,K,6),Q=re.add4L(R,Y,nr[A-7],nr[A-16]),X=re.add4H(Q,I,C,ar[A-7],ar[A-16]);ar[A]=X|0,nr[A]=Q|0}let{Ah:t,Al:r,Bh:a,Bl:n,Ch:i,Cl:o,Dh:u,Dl:c,Eh:l,El:m,Fh:h,Fl:w,Gh:g,Gl:p,Hh:d,Hl:S}=this;for(let A=0;A<80;A++){const E=re.rotrSH(l,m,14)^re.rotrSH(l,m,18)^re.rotrBH(l,m,41),k=re.rotrSL(l,m,14)^re.rotrSL(l,m,18)^re.rotrBL(l,m,41),I=l&h^~l&g,R=m&w^~m&p,j=re.add5L(S,k,R,fA[A],nr[A]),K=re.add5H(j,d,E,I,mA[A],ar[A]),C=j|0,Y=re.rotrSH(t,r,28)^re.rotrBH(t,r,34)^re.rotrBH(t,r,39),Q=re.rotrSL(t,r,28)^re.rotrBL(t,r,34)^re.rotrBL(t,r,39),X=t&a^t&i^a&i,H=r&n^r&o^n&o;d=g|0,S=p|0,g=h|0,p=w|0,h=l|0,w=m|0,{h:l,l:m}=re.add(u|0,c|0,K|0,C|0),u=i|0,c=o|0,i=a|0,o=n|0,a=t|0,n=r|0;const ye=re.add3L(C,Q,H);t=re.add3H(ye,K,Y,X),r=ye|0}({h:t,l:r}=re.add(this.Ah|0,this.Al|0,t|0,r|0)),{h:a,l:n}=re.add(this.Bh|0,this.Bl|0,a|0,n|0),{h:i,l:o}=re.add(this.Ch|0,this.Cl|0,i|0,o|0),{h:u,l:c}=re.add(this.Dh|0,this.Dl|0,u|0,c|0),{h:l,l:m}=re.add(this.Eh|0,this.El|0,l|0,m|0),{h,l:w}=re.add(this.Fh|0,this.Fl|0,h|0,w|0),{h:g,l:p}=re.add(this.Gh|0,this.Gl|0,g|0,p|0),{h:d,l:S}=re.add(this.Hh|0,this.Hl|0,d|0,S|0),this.set(t,r,a,n,i,o,u,c,l,m,h,w,g,p,d,S)}roundClean(){ar.fill(0),nr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},dA=class extends xw{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}};const pA=lm(()=>new xw),gA=lm(()=>new dA),Me=new ArrayBuffer(0),v="";class fe extends TypeError{constructor(){super(...arguments),this.name=fe.NAME}static isType(e,t){if(typeof t=="string"){if(t==="Array"&&Array.isArray(e)||t==="ArrayBuffer"&&e instanceof ArrayBuffer||t==="ArrayBufferView"&&ArrayBuffer.isView(e)||typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...r){for(const n of r)if(this.isType(e,n))return;const a=r.map(n=>n instanceof Function&&"name"in n?n.name:"".concat(n));throw new fe("Parameter '".concat(t,"' is not of type ").concat(a.length>1?"(".concat(a.join(" or "),")"):a[0]))}}fe.NAME="ArgumentError";class oe extends TypeError{static assert(...e){let t=null,r,a;typeof e[0]=="string"?(t=e[0],r=e[1],a=e.slice(2)):(r=e[0],a=e.slice(1)),fe.assert(r,"parameters","object");for(const n of a)if(r[n]==null)throw new oe(n,t)}static assertEmpty(e,t,r){if(e==null)throw new oe(t,r)}constructor(e,t=null,r){super(),this.name=oe.NAME,this.field=e,t&&(this.target=t),r?this.message=r:this.message="Absent mandatory parameter '".concat(e,"' ").concat(t?" in '".concat(t,"'"):v)}}oe.NAME="ParameterError";class D extends Error{static assertSchema(e,t){if(!e.verified)throw new Error("Object's schema was not verified against input data for ".concat(t))}static assert(e,t){if(e.offset===-1)throw new D("Error during parsing of ASN.1 data. Data is not correct for '".concat(t,"'."))}constructor(e){super(e),this.name="AsnError"}}class T{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=Ke(e);D.assert(t,this.name);try{return new this({schema:t.result})}catch(r){throw new D("Cannot create '".concat(this.CLASS_NAME,"' from ASN.1 object"))}}static defaultValues(e){throw new Error("Invalid member name for ".concat(this.CLASS_NAME," class: ").concat(e))}static schema(e={}){throw new Error("Method '".concat(this.CLASS_NAME,".schema' should be overridden"))}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch(r){t=this.toSchema(!0)}return me.ToString(t.toBER(),e)}}T.CLASS_NAME="PkiObject";function Gr(s){let e=!1,t=v;const r=s.trim();for(let a=0;a<r.length;a++)r.charCodeAt(a)===32?e===!1&&(e=!0):(e&&(t+=" ",e=!1),t+=r[a]);return t.toLowerCase()}const zo="type",Km="value";class sa extends T{constructor(e={}){super(),this.type=f(e,zo,sa.defaultValues(zo)),this.value=f(e,Km,sa.defaultValues(Km)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zo:return v;case Km:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.type||v}),new z({name:t.value||v})]})}fromSchema(e){L(e,[zo,"typeValue"]);const t=U(e,e,sa.schema({names:{type:zo,value:"typeValue"}}));D.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new N({value:[new J({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return Object.keys(this.value).length!==0?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[$h.blockName(),Nf.blockName(),kf.blockName(),sh.blockName(),Fs.blockName(),Ef.blockName(),ky.blockName(),Vg.blockName(),Ey.blockName(),Cy.blockName(),Iy.blockName(),xy.blockName()];if(e instanceof ArrayBuffer)return ve.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===sa.blockName()){if(this.type!==e.type)return!1;const r=[!1,!1],a=this.value.constructor.blockName();for(const n of t)a===n&&(r[0]=!0),e.value.constructor.blockName()===n&&(r[1]=!0);if(r[0]!==r[1])return!1;if(r[0]&&r[1]){const n=Gr(this.value.valueBlock.value),i=Gr(e.value.valueBlock.value);if(n.localeCompare(i)!==0)return!1}else if(!ve.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}sa.CLASS_NAME="AttributeTypeAndValue";const wa="typesAndValues",Pc="valueBeforeDecode",Wp="RDN";class de extends T{constructor(e={}){super(),this.typesAndValues=f(e,wa,de.defaultValues(wa)),this.valueBeforeDecode=f(e,Pc,de.defaultValues(Pc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wa:return[];case Pc:return Me;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wa:return t.length===0;case Pc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.repeatedSequence||v,value:new Ge({value:[new Z({name:t.repeatedSet||v,value:sa.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){L(e,[Wp,wa]);const t=U(e,e,de.schema({names:{blockName:Wp,repeatedSet:wa}}));D.assertSchema(t,this.className),wa in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,r=>new sa({schema:r}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(this.valueBeforeDecode.byteLength===0)return new N({value:[new Ge({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=Ke(this.valueBeforeDecode);if(D.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof N))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof de){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,r]of this.typesAndValues.entries())if(r.isEqual(e.typesAndValues[t])===!1)return!1;return!0}return e instanceof ArrayBuffer?hc(this.valueBeforeDecode,e):!1}}de.CLASS_NAME="RelativeDistinguishedNames";const hu="type",mu="value";function wA(s={},e=!1){const t=f(s,"names",{});return new N({optional:e,value:[new V({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:t.country_name||v,value:[new Ie({value:[new sh,new Fs]})]}),new V({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:t.administration_domain_name||v,value:[new Ie({value:[new sh,new Fs]})]}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:t.network_address||v,isHexOnly:!0}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:t.terminal_identifier||v,isHexOnly:!0}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:t.private_domain_name||v,value:[new Ie({value:[new sh,new Fs]})]}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:t.organization_name||v,isHexOnly:!0}),new G({optional:!0,name:t.numeric_user_identifier||v,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new V({optional:!0,name:t.personal_name||v,idBlock:{tagClass:3,tagNumber:5},value:[new G({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new V({optional:!0,name:t.organizational_unit_names||v,idBlock:{tagClass:3,tagNumber:6},value:[new Z({value:new Fs})]})]})}function yA(s=!1){return new N({optional:s,value:[new Fs,new Fs]})}function vA(s=!1){return new Ge({optional:s,value:[new G({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new z]})]})}class ce extends T{constructor(e={}){super(),this.type=f(e,hu,ce.defaultValues(hu)),this.value=f(e,mu,ce.defaultValues(mu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hu:return 9;case mu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hu:return t===ce.defaultValues(e);case mu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new Ie({value:[new V({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||v,value:[new J,new V({idBlock:{tagClass:3,tagNumber:0},value:[new z]})]}),new G({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:1}}),new G({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:2}}),new V({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||v,value:[wA(t.builtInStandardAttributes||{},!1),yA(!0),vA(!0)]}),new V({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||v,value:[de.schema(t.directoryName||{})]}),new V({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||v,value:[new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ie({value:[new Ef,new Fs,new kf,new $h,new Nf]})]}),new V({idBlock:{tagClass:3,tagNumber:1},value:[new Ie({value:[new Ef,new Fs,new kf,new $h,new Nf]})]})]}),new G({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:6}}),new G({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:7}}),new G({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){L(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=U(e,e,ce.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(D.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=t.result.blockName;break;case 1:case 2:case 6:{const r=t.result.blockName;r.idBlock.tagClass=1,r.idBlock.tagNumber=22;const a=r.toBER(!1),n=Ke(a);D.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value}break;case 3:this.value=t.result.blockName;break;case 4:this.value=new de({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new $({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const r=t.result.blockName;r.idBlock.tagClass=1,r.idBlock.tagNumber=6;const a=r.toBER(!1),n=Ke(a);D.assert(n,"GeneralName registeredID"),this.value=n.result.valueBlock.toString()}break}}toSchema(){switch(this.type){case 0:case 3:case 5:return new V({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new Vg({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new V({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new J({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return ce.schema()}}toJSON(){const e={type:this.type,value:v};if(typeof this.value=="string")e.value=this.value;else try{e.value=this.value.toJSON()}catch(t){}return e}}ce.CLASS_NAME="GeneralName";const fu="accessMethod",du="accessLocation",bA=[fu,du];class Dn extends T{constructor(e={}){super(),this.accessMethod=f(e,fu,Dn.defaultValues(fu)),this.accessLocation=f(e,du,Dn.defaultValues(du)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fu:return v;case du:return new ce;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.accessMethod||v}),ce.schema(t.accessLocation||{})]})}fromSchema(e){L(e,bA);const t=U(e,e,Dn.schema({names:{accessMethod:fu,accessLocation:{names:{blockName:du}}}}));D.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new ce({schema:t.result.accessLocation})}toSchema(){return new N({value:[new J({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}Dn.CLASS_NAME="AccessDescription";const cr="seconds",hr="millis",mr="micros";class Ft extends T{constructor(e={}){super(),cr in e&&(this.seconds=f(e,cr,Ft.defaultValues(cr))),hr in e&&(this.millis=f(e,hr,Ft.defaultValues(hr))),mr in e&&(this.micros=f(e,mr,Ft.defaultValues(mr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cr:case hr:case mr:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cr:case hr:case mr:return t===Ft.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,optional:!0,value:[new O({optional:!0,name:t.seconds||v}),new G({name:t.millis||v,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new G({name:t.micros||v,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){L(e,[cr,hr,mr]);const t=U(e,e,Ft.schema({names:{seconds:cr,millis:hr,micros:mr}}));if(D.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const r=new O({valueHex:t.result.millis.valueBlock.valueHex});this.millis=r.valueBlock.valueDec}if("micros"in t.result){const r=new O({valueHex:t.result.micros.valueBlock.valueHex});this.micros=r.valueBlock.valueDec}}toSchema(){const e=[];if(this.seconds!==void 0&&e.push(new O({value:this.seconds})),this.millis!==void 0){const t=new O({value:this.millis});e.push(new G({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(this.micros!==void 0){const t=new O({value:this.micros});e.push(new G({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new N({value:e})}toJSON(){const e={};return this.seconds!==void 0&&(e.seconds=this.seconds),this.millis!==void 0&&(e.millis=this.millis),this.micros!==void 0&&(e.micros=this.micros),e}}Ft.CLASS_NAME="Accuracy";const Bc="algorithmId",Yo="algorithmParams",Vw="algorithm",$f="params",AA=[Vw,$f];class B extends T{constructor(e={}){super(),this.algorithmId=f(e,Bc,B.defaultValues(Bc)),Yo in e&&(this.algorithmParams=f(e,Yo,B.defaultValues(Yo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bc:return v;case Yo:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bc:return t===v;case Yo:return t instanceof z;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,optional:t.optional||!1,value:[new J({name:t.algorithmIdentifier||v}),new z({name:t.algorithmParams||v,optional:!0})]})}fromSchema(e){L(e,AA);const t=U(e,e,B.schema({names:{algorithmIdentifier:Vw,algorithmParams:$f}}));D.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),$f in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new J({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof z)&&e.push(this.algorithmParams),new N({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof z)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return!(e instanceof B)||this.algorithmId!==e.algorithmId?!1:this.algorithmParams?e.algorithmParams?JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!1:!e.algorithmParams}}B.CLASS_NAME="AlgorithmIdentifier";const ti="altNames",SA=[ti];class Ro extends T{constructor(e={}){super(),this.altNames=f(e,ti,Ro.defaultValues(ti)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ti:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.altNames||v,value:ce.schema()})]})}fromSchema(e){L(e,SA);const t=U(e,e,Ro.schema({names:{altNames:ti}}));D.assertSchema(t,this.className),ti in t.result&&(this.altNames=Array.from(t.result.altNames,r=>new ce({schema:r})))}toSchema(){return new N({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}Ro.CLASS_NAME="AltName";const si="type",ri="values",NA=[si,ri];class be extends T{constructor(e={}){super(),this.type=f(e,si,be.defaultValues(si)),this.values=f(e,ri,be.defaultValues(ri)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case si:return v;case ri:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case si:return t===v;case ri:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.type||v}),new Ge({name:t.setName||v,value:[new Z({name:t.values||v,value:new z})]})]})}fromSchema(e){L(e,NA);const t=U(e,e,be.schema({names:{type:si,values:ri}}));D.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new N({value:[new J({value:this.type}),new Ge({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}be.CLASS_NAME="Attribute";const pu="notBeforeTime",gu="notAfterTime",kA=[pu,gu];class ms extends T{constructor(e={}){super(),this.notBeforeTime=f(e,pu,ms.defaultValues(pu)),this.notAfterTime=f(e,gu,ms.defaultValues(gu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pu:case gu:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Ve({name:t.notBeforeTime||v}),new Ve({name:t.notAfterTime||v})]})}fromSchema(e){L(e,kA);const t=U(e,e,ms.schema({names:{notBeforeTime:pu,notAfterTime:gu}}));D.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new N({value:[new Ve({valueDate:this.notBeforeTime}),new Ve({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}ms.CLASS_NAME="AttCertValidityPeriod";const Qo="names",Gp="generalNames";class Xe extends T{constructor(e={}){super(),this.names=f(e,Qo,Xe.defaultValues(Qo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"names":return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=f(e,Qo,{});return new N({optional:t,name:r.blockName||v,value:[new Z({name:r.generalNames||v,value:ce.schema()})]})}fromSchema(e){L(e,[Qo,Gp]);const t=U(e,e,Xe.schema({names:{blockName:Qo,generalNames:Gp}}));D.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,r=>new ce({schema:r}))}toSchema(){return new N({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}Xe.CLASS_NAME="GeneralNames";const EA="2.5.29.9",CA="2.5.29.14",IA="2.5.29.15",xA="2.5.29.16",Pw="2.5.29.17",Bw="2.5.29.18",Ed="2.5.29.19",VA="2.5.29.20",PA="2.5.29.27",BA="2.5.29.21",OA="2.5.29.24",Ow="2.5.29.28",Dw="2.5.29.29",Tw="2.5.29.30",Rw="2.5.29.31",Cd="2.5.29.46",Lw="2.5.29.32",Xt="2.5.29.32.0",DA="1.3.6.1.4.1.311.21.10",Uw="2.5.29.33",Id="2.5.29.35",jw="2.5.29.36",TA="2.5.29.37",RA="2.5.29.54",xd="1.3.6.1.5.5.7.1.1",LA="1.3.6.1.5.5.7.1.11",UA="1.3.6.1.4.1.11129.2.4.2",jA="1.3.6.1.4.1.311.21.7",$A="1.3.6.1.4.1.311.21.1",KA="1.3.6.1.5.5.7.1.3",Vd="1.2.840.113549.1.7.1",$w="1.2.840.113549.1.7.2",Kw="1.2.840.113549.1.7.3",Mw="1.2.840.113549.1.7.6",MA="1.2.840.113549.1.9.16.1.4",Xp="1.2.840.113549.1.9.22.1",HA="1.2.840.113549.1.9.22.2",zp="1.2.840.113549.1.9.22.3",Yp="1.2.840.113549.1.9.23.1",FA="1.3.6.1.5.5.7",JA="".concat(FA,".48"),ih="".concat(JA,".1.1"),Sa="keyIdentifier",Na="authorityCertIssuer",ka="authorityCertSerialNumber",qA=[Sa,Na,ka];class ra extends T{constructor(e={}){super(),Sa in e&&(this.keyIdentifier=f(e,Sa,ra.defaultValues(Sa))),Na in e&&(this.authorityCertIssuer=f(e,Na,ra.defaultValues(Na))),ka in e&&(this.authorityCertSerialNumber=f(e,ka,ra.defaultValues(ka))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Sa:return new $;case Na:return[];case ka:return new O;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new G({name:t.keyIdentifier||v,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Z({name:t.authorityCertIssuer||v,value:ce.schema()})]}),new G({name:t.authorityCertSerialNumber||v,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){L(e,qA);const t=U(e,e,ra.schema({names:{keyIdentifier:Sa,authorityCertIssuer:Na,authorityCertSerialNumber:ka}}));D.assertSchema(t,this.className),Sa in t.result&&(this.keyIdentifier=new $({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),Na in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,r=>new ce({schema:r}))),ka in t.result&&(this.authorityCertSerialNumber=new O({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new G({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new V({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new G({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new N({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}ra.CLASS_NAME="AuthorityKeyIdentifier";const ya="pathLenConstraint",va="cA";class Tn extends T{constructor(e={}){super(),this.cA=f(e,va,!1),ya in e&&(this.pathLenConstraint=f(e,ya,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case va:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new fa({optional:!0,name:t.cA||v}),new O({optional:!0,name:t.pathLenConstraint||v})]})}fromSchema(e){L(e,[va,ya]);const t=U(e,e,Tn.schema({names:{cA:va,pathLenConstraint:ya}}));D.assertSchema(t,this.className),va in t.result&&(this.cA=t.result.cA.valueBlock.value),ya in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==Tn.defaultValues(va)&&e.push(new fa({value:this.cA})),ya in this&&(this.pathLenConstraint instanceof O?e.push(this.pathLenConstraint):e.push(new O({value:this.pathLenConstraint}))),new N({value:e})}toJSON(){const e={};return this.cA!==Tn.defaultValues(va)&&(e.cA=this.cA),ya in this&&(this.pathLenConstraint instanceof O?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}Tn.CLASS_NAME="BasicConstraints";const Mm="certificateIndex",Hm="keyIndex";class pc extends T{constructor(e={}){super(),this.certificateIndex=f(e,Mm,pc.defaultValues(Mm)),this.keyIndex=f(e,Hm,pc.defaultValues(Hm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mm:case Hm:return 0;default:return super.defaultValues(e)}}static schema(){return new O}fromSchema(e){if(e.constructor.blockName()!==O.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const r=new Uint8Array(t);switch(!0){case t.byteLength<4:{const m=new ArrayBuffer(4);new Uint8Array(m).set(r,4-t.byteLength),t=m.slice(0)}break;case t.byteLength>4:{const m=new ArrayBuffer(4);new Uint8Array(m).set(r.slice(0,4)),t=m.slice(0)}break}const a=t.slice(0,2),n=new Uint8Array(a);let i=n[0];n[0]=n[1],n[1]=i;const o=new Uint16Array(a);this.keyIndex=o[0];const u=t.slice(2),c=new Uint8Array(u);i=c[0],c[0]=c[1],c[1]=i;const l=new Uint16Array(u);this.certificateIndex=l[0]}toSchema(){const e=new ArrayBuffer(2),t=new Uint16Array(e);t[0]=this.certificateIndex;const r=new Uint8Array(e);let a=r[0];r[0]=r[1],r[1]=a;const n=new ArrayBuffer(2),i=new Uint16Array(n);i[0]=this.keyIndex;const o=new Uint8Array(n);return a=o[0],o[0]=o[1],o[1]=a,new O({valueHex:Co(n,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}pc.CLASS_NAME="CAVersion";const wu="policyQualifierId",yu="qualifier",_A=[wu,yu];class Rn extends T{constructor(e={}){super(),this.policyQualifierId=f(e,wu,Rn.defaultValues(wu)),this.qualifier=f(e,yu,Rn.defaultValues(yu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wu:return v;case yu:return new z;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.policyQualifierId||v}),new z({name:t.qualifier||v})]})}fromSchema(e){L(e,_A);const t=U(e,e,Rn.schema({names:{policyQualifierId:wu,qualifier:yu}}));D.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new N({value:[new J({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}Rn.CLASS_NAME="PolicyQualifierInfo";const vu="policyIdentifier",Ea="policyQualifiers",WA=[vu,Ea];class Ln extends T{constructor(e={}){super(),this.policyIdentifier=f(e,vu,Ln.defaultValues(vu)),Ea in e&&(this.policyQualifiers=f(e,Ea,Ln.defaultValues(Ea))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vu:return v;case Ea:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.policyIdentifier||v}),new N({optional:!0,value:[new Z({name:t.policyQualifiers||v,value:Rn.schema()})]})]})}fromSchema(e){L(e,WA);const t=U(e,e,Ln.schema({names:{policyIdentifier:vu,policyQualifiers:Ea}}));D.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),Ea in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,r=>new Rn({schema:r})))}toSchema(){const e=[];return e.push(new J({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new N({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new N({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}Ln.CLASS_NAME="PolicyInformation";const bu="certificatePolicies",GA=[bu];class Lo extends T{constructor(e={}){super(),this.certificatePolicies=f(e,bu,Lo.defaultValues(bu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.certificatePolicies||v,value:Ln.schema()})]})}fromSchema(e){L(e,GA);const t=U(e,e,Lo.schema({names:{certificatePolicies:bu}}));D.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,r=>new Ln({schema:r}))}toSchema(){return new N({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}Lo.CLASS_NAME="CertificatePolicies";const Au="templateID",xs="templateMajorVersion",Vs="templateMinorVersion",XA=[Au,xs,Vs];class ko extends T{constructor(e={}){super(),this.templateID=f(e,Au,ko.defaultValues(Au)),xs in e&&(this.templateMajorVersion=f(e,xs,ko.defaultValues(xs))),Vs in e&&(this.templateMinorVersion=f(e,Vs,ko.defaultValues(Vs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Au:return v;case xs:case Vs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.templateID||v}),new O({name:t.templateMajorVersion||v,optional:!0}),new O({name:t.templateMinorVersion||v,optional:!0})]})}fromSchema(e){L(e,XA);const t=U(e,e,ko.schema({names:{templateID:Au,templateMajorVersion:xs,templateMinorVersion:Vs}}));D.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),xs in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),Vs in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new J({value:this.templateID})),xs in this&&e.push(new O({value:this.templateMajorVersion})),Vs in this&&e.push(new O({value:this.templateMinorVersion})),new N({value:e})}toJSON(){const e={templateID:this.templateID};return xs in this&&(e.templateMajorVersion=this.templateMajorVersion),Vs in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}const Ca="distributionPoint",Hw="distributionPointNames",Ia="reasons",xa="cRLIssuer",Fw="cRLIssuerNames",zA=[Ca,Hw,Ia,xa,Fw];class aa extends T{constructor(e={}){super(),Ca in e&&(this.distributionPoint=f(e,Ca,aa.defaultValues(Ca))),Ia in e&&(this.reasons=f(e,Ia,aa.defaultValues(Ia))),xa in e&&(this.cRLIssuer=f(e,xa,aa.defaultValues(xa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ca:return[];case Ia:return new ie;case xa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ie({value:[new V({name:t.distributionPoint||v,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.distributionPointNames||v,value:ce.schema()})]}),new V({name:t.distributionPoint||v,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:de.schema().valueBlock.value})]})]}),new G({name:t.reasons||v,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new V({name:t.cRLIssuer||v,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new Z({name:t.cRLIssuerNames||v,value:ce.schema()})]})]})}fromSchema(e){L(e,zA);const t=U(e,e,aa.schema({names:{distributionPoint:Ca,distributionPointNames:Hw,reasons:Ia,cRLIssuer:xa,cRLIssuerNames:Fw}}));D.assertSchema(t,this.className),Ca in t.result&&(t.result.distributionPoint.idBlock.tagNumber===0&&(this.distributionPoint=Array.from(t.result.distributionPointNames,r=>new ce({schema:r}))),t.result.distributionPoint.idBlock.tagNumber===1&&(this.distributionPoint=new de({schema:new N({value:t.result.distributionPoint.valueBlock.value})}))),Ia in t.result&&(this.reasons=new ie({valueHex:t.result.reasons.valueBlock.valueHex})),xa in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,r=>new ce({schema:r})))}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new V({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,r=>r.toSchema())}):t=new V({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new G({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new V({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new N({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}aa.CLASS_NAME="DistributionPoint";const Su="distributionPoints",YA=[Su];class Uo extends T{constructor(e={}){super(),this.distributionPoints=f(e,Su,Uo.defaultValues(Su)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Su:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.distributionPoints||v,value:aa.schema()})]})}fromSchema(e){L(e,YA);const t=U(e,e,Uo.schema({names:{distributionPoints:Su}}));D.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,r=>new aa({schema:r}))}toSchema(){return new N({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}Uo.CLASS_NAME="CRLDistributionPoints";const Nu="keyPurposes",QA=[Nu];class gc extends T{constructor(e={}){super(),this.keyPurposes=f(e,Nu,gc.defaultValues(Nu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.keyPurposes||v,value:new J})]})}fromSchema(e){L(e,QA);const t=U(e,e,gc.schema({names:{keyPurposes:Nu}}));D.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,r=>r.valueBlock.toString())}toSchema(){return new N({value:Array.from(this.keyPurposes,e=>new J({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}gc.CLASS_NAME="ExtKeyUsage";const Zo="accessDescriptions";class jo extends T{constructor(e={}){super(),this.accessDescriptions=f(e,Zo,jo.defaultValues(Zo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zo:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.accessDescriptions||v,value:Dn.schema()})]})}fromSchema(e){L(e,[Zo]);const t=U(e,e,jo.schema({names:{accessDescriptions:Zo}}));D.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,r=>new Dn({schema:r}))}toSchema(){return new N({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}jo.CLASS_NAME="InfoAccess";const Va="distributionPoint",Jw="distributionPointNames",fr="onlyContainsUserCerts",dr="onlyContainsCACerts",pr="onlySomeReasons",gr="indirectCRL",wr="onlyContainsAttributeCerts",ZA=[Va,Jw,fr,dr,pr,gr,wr];class rt extends T{constructor(e={}){super(),Va in e&&(this.distributionPoint=f(e,Va,rt.defaultValues(Va))),this.onlyContainsUserCerts=f(e,fr,rt.defaultValues(fr)),this.onlyContainsCACerts=f(e,dr,rt.defaultValues(dr)),pr in e&&(this.onlySomeReasons=f(e,pr,rt.defaultValues(pr))),this.indirectCRL=f(e,gr,rt.defaultValues(gr)),this.onlyContainsAttributeCerts=f(e,wr,rt.defaultValues(wr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Va:return[];case fr:return!1;case dr:return!1;case pr:return 0;case gr:return!1;case wr:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ie({value:[new V({name:t.distributionPoint||v,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.distributionPointNames||v,value:ce.schema()})]}),new V({name:t.distributionPoint||v,idBlock:{tagClass:3,tagNumber:1},value:de.schema().valueBlock.value})]})]}),new G({name:t.onlyContainsUserCerts||v,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new G({name:t.onlyContainsCACerts||v,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new G({name:t.onlySomeReasons||v,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new G({name:t.indirectCRL||v,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new G({name:t.onlyContainsAttributeCerts||v,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){L(e,ZA);const t=U(e,e,rt.schema({names:{distributionPoint:Va,distributionPointNames:Jw,onlyContainsUserCerts:fr,onlyContainsCACerts:dr,onlySomeReasons:pr,indirectCRL:gr,onlyContainsAttributeCerts:wr}}));if(D.assertSchema(t,this.className),Va in t.result)switch(!0){case t.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(t.result.distributionPointNames,r=>new ce({schema:r}));break;case t.result.distributionPoint.idBlock.tagNumber===1:this.distributionPoint=new de({schema:new N({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(fr in t.result){const r=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=r[0]!==0}if(dr in t.result){const r=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=r[0]!==0}if(pr in t.result){const r=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=r[0]}if(gr in t.result){const r=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=r[0]!==0}if(wr in t.result){const r=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=r[0]!==0}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new V({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,r=>r.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==rt.defaultValues(fr)&&e.push(new G({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==rt.defaultValues(dr)&&e.push(new G({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),this.onlySomeReasons!==void 0){const t=new ArrayBuffer(1),r=new Uint8Array(t);r[0]=this.onlySomeReasons,e.push(new G({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==rt.defaultValues(gr)&&e.push(new G({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==rt.defaultValues(wr)&&e.push(new G({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new N({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==rt.defaultValues(fr)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==rt.defaultValues(dr)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),pr in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==rt.defaultValues(gr)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==rt.defaultValues(wr)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}rt.CLASS_NAME="IssuingDistributionPoint";const ku="base",ai="minimum",yr="maximum",eS=[ku,ai,yr];class As extends T{constructor(e={}){super(),this.base=f(e,ku,As.defaultValues(ku)),this.minimum=f(e,ai,As.defaultValues(ai)),yr in e&&(this.maximum=f(e,yr,As.defaultValues(yr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ku:return new ce;case ai:return 0;case yr:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[ce.schema(t.base||{}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({name:t.minimum||v})]}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new O({name:t.maximum||v})]})]})}fromSchema(e){L(e,eS);const t=U(e,e,As.schema({names:{base:{names:{blockName:ku}},minimum:ai,maximum:yr}}));D.assertSchema(t,this.className),this.base=new ce({schema:t.result.base}),ai in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),yr in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),this.minimum!==0){let t=0;this.minimum instanceof O?t=this.minimum:t=new O({value:this.minimum}),e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(yr in this){let t=0;this.maximum instanceof O?t=this.maximum:t=new O({value:this.maximum}),e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new N({value:e})}toJSON(){const e={base:this.base.toJSON()};return this.minimum!==0&&(typeof this.minimum=="number"?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),this.maximum!==void 0&&(typeof this.maximum=="number"?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}As.CLASS_NAME="GeneralSubtree";const Pa="permittedSubtrees",Ba="excludedSubtrees",tS=[Pa,Ba];class xo extends T{constructor(e={}){super(),Pa in e&&(this.permittedSubtrees=f(e,Pa,xo.defaultValues(Pa))),Ba in e&&(this.excludedSubtrees=f(e,Ba,xo.defaultValues(Ba))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pa:case Ba:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.permittedSubtrees||v,value:As.schema()})]}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Z({name:t.excludedSubtrees||v,value:As.schema()})]})]})}fromSchema(e){L(e,tS);const t=U(e,e,xo.schema({names:{permittedSubtrees:Pa,excludedSubtrees:Ba}}));D.assertSchema(t,this.className),Pa in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,r=>new As({schema:r}))),Ba in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,r=>new As({schema:r})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new V({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new N({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}xo.CLASS_NAME="NameConstraints";const Ps="requireExplicitPolicy",Bs="inhibitPolicyMapping",sS=[Ps,Bs];class Vo extends T{constructor(e={}){super(),Ps in e&&(this.requireExplicitPolicy=f(e,Ps,Vo.defaultValues(Ps))),Bs in e&&(this.inhibitPolicyMapping=f(e,Bs,Vo.defaultValues(Bs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ps:return 0;case Bs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new G({name:t.requireExplicitPolicy||v,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new G({name:t.inhibitPolicyMapping||v,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){L(e,sS);const t=U(e,e,Vo.schema({names:{requireExplicitPolicy:Ps,inhibitPolicyMapping:Bs}}));if(D.assertSchema(t,this.className),Ps in t.result){const r=t.result.requireExplicitPolicy;r.idBlock.tagClass=1,r.idBlock.tagNumber=2;const a=r.toBER(!1),n=Ke(a);D.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(Bs in t.result){const r=t.result.inhibitPolicyMapping;r.idBlock.tagClass=1,r.idBlock.tagNumber=2;const a=r.toBER(!1),n=Ke(a);D.assert(n,"Integer"),this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if(Ps in this){const t=new O({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(Bs in this){const t=new O({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new N({value:e})}toJSON(){const e={};return Ps in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),Bs in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}Vo.CLASS_NAME="PolicyConstraints";const Eu="issuerDomainPolicy",Cu="subjectDomainPolicy",rS=[Eu,Cu];class Un extends T{constructor(e={}){super(),this.issuerDomainPolicy=f(e,Eu,Un.defaultValues(Eu)),this.subjectDomainPolicy=f(e,Cu,Un.defaultValues(Cu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Eu:return v;case Cu:return v;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.issuerDomainPolicy||v}),new J({name:t.subjectDomainPolicy||v})]})}fromSchema(e){L(e,rS);const t=U(e,e,Un.schema({names:{issuerDomainPolicy:Eu,subjectDomainPolicy:Cu}}));D.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new N({value:[new J({value:this.issuerDomainPolicy}),new J({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}Un.CLASS_NAME="PolicyMapping";const Iu="mappings",aS=[Iu];class wc extends T{constructor(e={}){super(),this.mappings=f(e,Iu,wc.defaultValues(Iu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Iu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.mappings||v,value:Un.schema()})]})}fromSchema(e){L(e,aS);const t=U(e,e,wc.schema({names:{mappings:Iu}}));D.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,r=>new Un({schema:r}))}toSchema(){return new N({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}wc.CLASS_NAME="PolicyMappings";const vr="notBefore",br="notAfter",nS=[vr,br];class Po extends T{constructor(e={}){super(),vr in e&&(this.notBefore=f(e,vr,Po.defaultValues(vr))),br in e&&(this.notAfter=f(e,br,Po.defaultValues(br))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vr:return new Date;case br:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new G({name:t.notBefore||v,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new G({name:t.notAfter||v,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){L(e,nS);const t=U(e,e,Po.schema({names:{notBefore:vr,notAfter:br}}));if(D.assertSchema(t,this.className),vr in t.result){const r=new Ve;r.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=r.toDate()}if(br in t.result){const r=new Ve({valueHex:t.result.notAfter.valueBlock.valueHex});r.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=r.toDate()}}toSchema(){const e=[];return vr in this&&e.push(new G({idBlock:{tagClass:3,tagNumber:0},valueHex:new Ve({valueDate:this.notBefore}).valueBlock.valueHexView})),br in this&&e.push(new G({idBlock:{tagClass:3,tagNumber:1},valueHex:new Ve({valueDate:this.notAfter}).valueBlock.valueHexView})),new N({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}Po.CLASS_NAME="PrivateKeyUsagePeriod";const ni="id",Os="type",ii="values",iS=[ni,Os],oS=[ii];class jn extends T{constructor(e={}){super(),this.id=f(e,ni,jn.defaultValues(ni)),Os in e&&(this.type=f(e,Os,jn.defaultValues(Os))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ni:return v;case Os:return new We;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ni:return t===v;case Os:return t instanceof We;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.id||v}),new z({name:t.type||v,optional:!0})]})}fromSchema(e){L(e,iS);const t=U(e,e,jn.schema({names:{id:ni,type:Os}}));D.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),Os in t.result&&(this.type=t.result.type)}toSchema(){const e=[new J({value:this.id})];return Os in this&&e.push(this.type),new N({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}jn.CLASS_NAME="QCStatement";class yc extends T{constructor(e={}){super(),this.values=f(e,ii,yc.defaultValues(ii)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ii:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ii:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.values||v,value:jn.schema(t.value||{})})]})}fromSchema(e){L(e,oS);const t=U(e,e,yc.schema({names:{values:ii}}));D.assertSchema(t,this.className),this.values=Array.from(t.result.values,r=>new jn({schema:r}))}toSchema(){return new N({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}yc.CLASS_NAME="QCStatements";var ba;class la{static register(e,t,r){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:r}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}ba=la,la.namedCurves={},ba.register("P-256","1.2.840.10045.3.1.7",32),ba.register("P-384","1.3.132.0.34",48),ba.register("P-521","1.3.132.0.35",66),ba.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),ba.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),ba.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const Oc="x",Dc="y",Tc="namedCurve";class It extends T{constructor(e={}){super(),this.x=f(e,Oc,It.defaultValues(Oc)),this.y=f(e,Dc,It.defaultValues(Dc)),this.namedCurve=f(e,Tc,It.defaultValues(Tc)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oc:case Dc:return Me;case Tc:return v;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Oc:case Dc:return t instanceof ArrayBuffer&&hc(t,It.defaultValues(e));case Tc:return typeof t=="string"&&t===It.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new jh}fromSchema(e){const t=ve.toUint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");const r=la.find(this.namedCurve);if(!r)throw new Error("Incorrect curve OID: ".concat(this.namedCurve));const a=r.size;if(t.byteLength!==a*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=r.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,a*2+1).buffer}toSchema(){return new jh({data:Co(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=la.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:Af(Uh(this.x),!0,!0,!1),y:Af(Uh(this.y),!0,!0,!1)}}fromJSON(e){oe.assert("json",e,"crv","x","y");let t=0;const r=la.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);const a=Do(mc(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const i=new Uint8Array(this.x),o=new Uint8Array(a);i.set(o,1)}else this.x=a.slice(0,t);const n=Do(mc(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const i=new Uint8Array(this.y),o=new Uint8Array(n);i.set(o,1)}else this.y=n.slice(0,t)}}It.CLASS_NAME="ECPublicKey";const xu="modulus",Vu="publicExponent",uS=[xu,Vu];class $n extends T{constructor(e={}){super(),this.modulus=f(e,xu,$n.defaultValues(xu)),this.publicExponent=f(e,Vu,$n.defaultValues(Vu)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xu:return new O;case Vu:return new O;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.modulus||v}),new O({name:t.publicExponent||v})]})}fromSchema(e){L(e,uS);const t=U(e,e,$n.schema({names:{modulus:xu,publicExponent:Vu}}));D.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new N({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:me.ToBase64Url(this.modulus.valueBlock.valueHexView),e:me.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){oe.assert("json",e,"n","e");const t=Do(mc(e.n,!0));this.modulus=new O({valueHex:t.slice(0,Math.pow(2,Sy(t.byteLength)))}),this.publicExponent=new O({valueHex:Do(mc(e.e,!0)).slice(0,3)})}}$n.CLASS_NAME="RSAPublicKey";const Pu="algorithm",Bu="subjectPublicKey",lS=[Pu,Bu];class Pt extends T{get parsedKey(){if(this._parsedKey===void 0){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===J.blockName())try{this._parsedKey=new It({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":{const e=Ke(this.subjectPublicKey.valueBlock.valueHexView);if(e.offset!==-1)try{this._parsedKey=new $n({schema:e.result})}catch(t){}}break}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=f(e,Pu,Pt.defaultValues(Pu)),this.subjectPublicKey=f(e,Bu,Pt.defaultValues(Bu));const t=f(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pu:return new B;case Bu:return new ie;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[B.schema(t.algorithm||{}),new ie({name:t.subjectPublicKey||v})]})}fromSchema(e){L(e,lS);const t=U(e,e,Pt.schema({names:{algorithm:{names:{blockName:Pu}},subjectPublicKey:Bu}}));D.assertSchema(t,this.className),this.algorithm=new B({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new N({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new It({json:e}),this.algorithm=new B({algorithmId:"1.2.840.10045.2.1",algorithmParams:new J({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new $n({json:e}),this.algorithm=new B({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new We});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.subjectPublicKey=new ie({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=se(!0)){try{if(!e)throw new Error("Need to provide publicKey input parameter");const r=await t.exportKey("spki",e),a=Ke(r);try{this.fromSchema(a.result)}catch(n){throw new Error("Error during initializing object from schema")}}catch(r){const a=r instanceof Error?r.message:"".concat(r);throw new Error("Error during exporting public key: ".concat(a))}}}Pt.CLASS_NAME="PublicKeyInfo";const oi="version",ui="privateKey",as="namedCurve",Ar="publicKey",cS=[oi,ui,as,Ar];class Yt extends T{constructor(e={}){super(),this.version=f(e,oi,Yt.defaultValues(oi)),this.privateKey=f(e,ui,Yt.defaultValues(ui)),as in e&&(this.namedCurve=f(e,as,Yt.defaultValues(as))),Ar in e&&(this.publicKey=f(e,Ar,Yt.defaultValues(Ar))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oi:return 1;case ui:return new $;case as:return v;case Ar:return new It;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oi:return t===Yt.defaultValues(e);case ui:return t.isEqual(Yt.defaultValues(e));case as:return t===v;case Ar:return It.compareWithDefault(as,t.namedCurve)&&It.compareWithDefault("x",t.x)&&It.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),new $({name:t.privateKey||v}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new J({name:t.namedCurve||v})]}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ie({name:t.publicKey||v})]})]})}fromSchema(e){L(e,cS);const t=U(e,e,Yt.schema({names:{version:oi,privateKey:ui,namedCurve:as,publicKey:Ar}}));if(D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,as in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),Ar in t.result){const r={schema:t.result.publicKey.valueBlock.valueHex};as in this&&(r.namedCurve=this.namedCurve),this.publicKey=new It(r)}}toSchema(){const e=[new O({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[new J({value:this.namedCurve})]})),this.publicKey&&e.push(new V({idBlock:{tagClass:3,tagNumber:1},value:[new ie({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new N({value:e})}toJSON(){if(!this.namedCurve||Yt.compareWithDefault(as,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=la.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:me.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const r=this.publicKey.toJSON();t.x=r.x,t.y=r.y}return t}fromJSON(e){oe.assert("json",e,"crv","d");let t=0;const r=la.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);const a=me.FromBase64Url(e.d);if(a.byteLength<t){const n=new ArrayBuffer(t),i=new Uint8Array(n),o=new Uint8Array(a);i.set(o,1),this.privateKey=new $({valueHex:n})}else this.privateKey=new $({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new It({json:e}))}}Yt.CLASS_NAME="ECPrivateKey";const Ou="prime",Du="exponent",Tu="coefficient",hS=[Ou,Du,Tu];class Js extends T{constructor(e={}){super(),this.prime=f(e,Ou,Js.defaultValues(Ou)),this.exponent=f(e,Du,Js.defaultValues(Du)),this.coefficient=f(e,Tu,Js.defaultValues(Tu)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ou:return new O;case Du:return new O;case Tu:return new O;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.prime||v}),new O({name:t.exponent||v}),new O({name:t.coefficient||v})]})}fromSchema(e){L(e,hS);const t=U(e,e,Js.schema({names:{prime:Ou,exponent:Du,coefficient:Tu}}));D.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new N({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:me.ToBase64Url(this.prime.valueBlock.valueHexView),d:me.ToBase64Url(this.exponent.valueBlock.valueHexView),t:me.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){oe.assert("json",e,"r","d","r"),this.prime=new O({valueHex:me.FromBase64Url(e.r)}),this.exponent=new O({valueHex:me.FromBase64Url(e.d)}),this.coefficient=new O({valueHex:me.FromBase64Url(e.t)})}}Js.CLASS_NAME="OtherPrimeInfo";const Ru="version",Lu="modulus",Uu="publicExponent",ju="privateExponent",$u="prime1",Ku="prime2",Mu="exponent1",Hu="exponent2",Fu="coefficient",Oa="otherPrimeInfos",mS=[Ru,Lu,Uu,ju,$u,Ku,Mu,Hu,Fu,Oa];class St extends T{constructor(e={}){super(),this.version=f(e,Ru,St.defaultValues(Ru)),this.modulus=f(e,Lu,St.defaultValues(Lu)),this.publicExponent=f(e,Uu,St.defaultValues(Uu)),this.privateExponent=f(e,ju,St.defaultValues(ju)),this.prime1=f(e,$u,St.defaultValues($u)),this.prime2=f(e,Ku,St.defaultValues(Ku)),this.exponent1=f(e,Mu,St.defaultValues(Mu)),this.exponent2=f(e,Hu,St.defaultValues(Hu)),this.coefficient=f(e,Fu,St.defaultValues(Fu)),Oa in e&&(this.otherPrimeInfos=f(e,Oa,St.defaultValues(Oa))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ru:return 0;case Lu:return new O;case Uu:return new O;case ju:return new O;case $u:return new O;case Ku:return new O;case Mu:return new O;case Hu:return new O;case Fu:return new O;case Oa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),new O({name:t.modulus||v}),new O({name:t.publicExponent||v}),new O({name:t.privateExponent||v}),new O({name:t.prime1||v}),new O({name:t.prime2||v}),new O({name:t.exponent1||v}),new O({name:t.exponent2||v}),new O({name:t.coefficient||v}),new N({optional:!0,value:[new Z({name:t.otherPrimeInfosName||v,value:Js.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){L(e,mS);const t=U(e,e,St.schema({names:{version:Ru,modulus:Lu,publicExponent:Uu,privateExponent:ju,prime1:$u,prime2:Ku,exponent1:Mu,exponent2:Hu,coefficient:Fu,otherPrimeInfo:{names:{blockName:Oa}}}}));D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),Oa in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,r=>new Js({schema:r})))}toSchema(){const e=[];return e.push(new O({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new N({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new N({value:e})}toJSON(){const e={n:me.ToBase64Url(this.modulus.valueBlock.valueHexView),e:me.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:me.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:me.ToBase64Url(this.prime1.valueBlock.valueHexView),q:me.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:me.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:me.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:me.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){oe.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new O({valueHex:me.FromBase64Url(e.n)}),this.publicExponent=new O({valueHex:me.FromBase64Url(e.e)}),this.privateExponent=new O({valueHex:me.FromBase64Url(e.d)}),this.prime1=new O({valueHex:me.FromBase64Url(e.p)}),this.prime2=new O({valueHex:me.FromBase64Url(e.q)}),this.exponent1=new O({valueHex:me.FromBase64Url(e.dp)}),this.exponent2=new O({valueHex:me.FromBase64Url(e.dq)}),this.coefficient=new O({valueHex:me.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new Js({json:t})))}}St.CLASS_NAME="RSAPrivateKey";const Ju="version",qu="privateKeyAlgorithm",_u="privateKey",Da="attributes",Rc="parsedKey",fS=[Ju,qu,_u,Da];class Zt extends T{constructor(e={}){super(),this.version=f(e,Ju,Zt.defaultValues(Ju)),this.privateKeyAlgorithm=f(e,qu,Zt.defaultValues(qu)),this.privateKey=f(e,_u,Zt.defaultValues(_u)),Da in e&&(this.attributes=f(e,Da,Zt.defaultValues(Da))),Rc in e&&(this.parsedKey=f(e,Rc,Zt.defaultValues(Rc))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ju:return 0;case qu:return new B;case _u:return new $;case Da:return[];case Rc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),B.schema(t.privateKeyAlgorithm||{}),new $({name:t.privateKey||v}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.attributes||v,value:be.schema()})]})]})}fromSchema(e){L(e,fS);const t=U(e,e,Zt.schema({names:{version:Ju,privateKeyAlgorithm:{names:{blockName:qu}},privateKey:_u,attributes:Da}}));switch(D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new B({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,Da in t.result&&(this.attributes=Array.from(t.result.attributes,r=>new be({schema:r}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const r=Ke(this.privateKey.valueBlock.valueHexView);r.offset!==-1&&(this.parsedKey=new St({schema:r.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof J){const r=Ke(this.privateKey.valueBlock.valueHexView);r.offset!==-1&&(this.parsedKey=new Yt({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:r.result}))}break}}toSchema(){const e=[new O({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new N({value:e})}toJSON(){if(!this.parsedKey){const r={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(r.attributes=Array.from(this.attributes,a=>a.toJSON())),r}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Yt({json:e}),this.privateKeyAlgorithm=new B({algorithmId:"1.2.840.10045.2.1",algorithmParams:new J({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new St({json:e}),this.privateKeyAlgorithm=new B({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new We});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.privateKey=new $({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}Zt.CLASS_NAME="PrivateKeyInfo";const li="contentType",ci="contentEncryptionAlgorithm",Ta="encryptedContent",dS=[li,ci,Ta],Qp=1024;class Le extends T{constructor(e={}){if(super(),this.contentType=f(e,li,Le.defaultValues(li)),this.contentEncryptionAlgorithm=f(e,ci,Le.defaultValues(ci)),Ta in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4&&this.encryptedContent.idBlock.isConstructed===!1&&!e.disableSplit)){const t=new $({idBlock:{isConstructed:!0},isConstructed:!0});let r=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,r,r+Qp>a.byteLength?a.byteLength-r:Qp),o=new ArrayBuffer(i.length),u=new Uint8Array(o);for(let c=0;c<u.length;c++)u[c]=i[c];t.valueBlock.value.push(new $({valueHex:o})),n-=i.length,r+=i.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case li:return v;case ci:return new B;case Ta:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case li:return t===v;case ci:return t.algorithmId===v&&!("algorithmParams"in t);case Ta:return t.isEqual(Le.defaultValues(Ta));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.contentType||v}),B.schema(t.contentEncryptionAlgorithm||{}),new Ie({value:[new V({name:t.encryptedContent||v,idBlock:{tagClass:3,tagNumber:0},value:[new Z({value:new $})]}),new G({name:t.encryptedContent||v,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){L(e,dS);const t=U(e,e,Le.schema({names:{contentType:li,contentEncryptionAlgorithm:{names:{blockName:ci}},encryptedContent:Ta}}));D.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new B({schema:t.result.contentEncryptionAlgorithm}),Ta in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new J({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new N({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return $.prototype.getValue.call(this.encryptedContent)}}Le.CLASS_NAME="EncryptedContentInfo";const Sr="hashAlgorithm",Nr="maskGenAlgorithm",kr="saltLength",Er="trailerField",pS=[Sr,Nr,kr,Er];class nt extends T{constructor(e={}){super(),this.hashAlgorithm=f(e,Sr,nt.defaultValues(Sr)),this.maskGenAlgorithm=f(e,Nr,nt.defaultValues(Nr)),this.saltLength=f(e,kr,nt.defaultValues(kr)),this.trailerField=f(e,Er,nt.defaultValues(Er)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Sr:return new B({algorithmId:"1.3.14.3.2.26",algorithmParams:new We});case Nr:return new B({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new B({algorithmId:"1.3.14.3.2.26",algorithmParams:new We}).toSchema()});case kr:return 20;case Er:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new V({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[B.schema(t.hashAlgorithm||{})]}),new V({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[B.schema(t.maskGenAlgorithm||{})]}),new V({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new O({name:t.saltLength||v})]}),new V({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new O({name:t.trailerField||v})]})]})}fromSchema(e){L(e,pS);const t=U(e,e,nt.schema({names:{hashAlgorithm:{names:{blockName:Sr}},maskGenAlgorithm:{names:{blockName:Nr}},saltLength:kr,trailerField:Er}}));D.assertSchema(t,this.className),Sr in t.result&&(this.hashAlgorithm=new B({schema:t.result.hashAlgorithm})),Nr in t.result&&(this.maskGenAlgorithm=new B({schema:t.result.maskGenAlgorithm})),kr in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),Er in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(nt.defaultValues(Sr))||e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(nt.defaultValues(Nr))||e.push(new V({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==nt.defaultValues(kr)&&e.push(new V({idBlock:{tagClass:3,tagNumber:2},value:[new O({value:this.saltLength})]})),this.trailerField!==nt.defaultValues(Er)&&e.push(new V({idBlock:{tagClass:3,tagNumber:3},value:[new O({value:this.trailerField})]})),new N({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(nt.defaultValues(Sr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(nt.defaultValues(Nr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==nt.defaultValues(kr)&&(e.saltLength=this.saltLength),this.trailerField!==nt.defaultValues(Er)&&(e.trailerField=this.trailerField),e}}nt.CLASS_NAME="RSASSAPSSParams";const hi="salt",Wu="iterationCount",ns="keyLength",Ds="prf",gS=[hi,Wu,ns,Ds];class wt extends T{constructor(e={}){super(),this.salt=f(e,hi,wt.defaultValues(hi)),this.iterationCount=f(e,Wu,wt.defaultValues(Wu)),ns in e&&(this.keyLength=f(e,ns,wt.defaultValues(ns))),Ds in e&&(this.prf=f(e,Ds,wt.defaultValues(Ds))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hi:return{};case Wu:return-1;case ns:return 0;case Ds:return new B({algorithmId:"1.3.14.3.2.26",algorithmParams:new We});default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Ie({value:[new $({name:t.saltPrimitive||v}),B.schema(t.saltConstructed||{})]}),new O({name:t.iterationCount||v}),new O({name:t.keyLength||v,optional:!0}),B.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){L(e,gS);const t=U(e,e,wt.schema({names:{saltPrimitive:hi,saltConstructed:{names:{blockName:hi}},iterationCount:Wu,keyLength:ns,prf:{names:{blockName:Ds,optional:!0}}}}));D.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,ns in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),Ds in t.result&&(this.prf=new B({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new O({value:this.iterationCount})),ns in this&&wt.defaultValues(ns)!==this.keyLength&&e.push(new O({value:this.keyLength})),this.prf&&wt.defaultValues(Ds).isEqual(this.prf)===!1&&e.push(this.prf.toSchema()),new N({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return ns in this&&wt.defaultValues(ns)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&wt.defaultValues(Ds).isEqual(this.prf)===!1&&(e.prf=this.prf.toJSON()),e}}wt.CLASS_NAME="PBKDF2Params";const Gu="keyDerivationFunc",Xu="encryptionScheme",wS=[Gu,Xu];class Kn extends T{constructor(e={}){super(),this.keyDerivationFunc=f(e,Gu,Kn.defaultValues(Gu)),this.encryptionScheme=f(e,Xu,Kn.defaultValues(Xu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gu:return new B;case Xu:return new B;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[B.schema(t.keyDerivationFunc||{}),B.schema(t.encryptionScheme||{})]})}fromSchema(e){L(e,wS);const t=U(e,e,Kn.schema({names:{keyDerivationFunc:{names:{blockName:Gu}},encryptionScheme:{names:{blockName:Xu}}}}));D.assertSchema(t,this.className),this.keyDerivationFunc=new B({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new B({schema:t.result.encryptionScheme})}toSchema(){return new N({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}Kn.CLASS_NAME="PBES2Params";class yS{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=f(e,"name",v)}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){return this.crypto.getRandomValues(e)}}async function Zp(s,e,t,r,a){let n,i,o;switch(s.toUpperCase()){case"SHA-1":n=20,i=64,o=M1;break;case"SHA-256":n=32,i=64,o=J1;break;case"SHA-384":n=48,i=128,o=gA;break;case"SHA-512":n=64,i=128,o=pA;break;default:throw new Error("Unsupported hashing algorithm")}const u=new Uint8Array(t);let c=new TextDecoder().decode(t);new TextEncoder().encode(c).some((E,k)=>E!==u[k])&&(c=String.fromCharCode(...u));const l=new Uint8Array(c.length*2+2),m=new DataView(l.buffer);for(let E=0;E<c.length;E++)m.setUint16(E*2,c.charCodeAt(E),!1);m.setUint16(c.length*2,0,!1);const h=new Uint8Array(i).fill(3),w=new Uint8Array(r),g=new Uint8Array(i*Math.ceil(w.length/i)).map((E,k)=>w[k%w.length]),p=new Uint8Array(i*Math.ceil(l.length/i)).map((E,k)=>l[k%l.length]);let d=new Uint8Array(g.length+p.length);d.set(g),d.set(p,g.length);const S=Math.ceil((e>>3)/n),A=[];for(let E=0;E<S;E++){let k=new Uint8Array(h.length+d.length);k.set(h),k.set(d,h.length);for(let K=0;K<a;K++)k=o(k);const I=new Uint8Array(i).map((K,C)=>k[C%k.length]),R=Math.ceil(w.length/i)+Math.ceil(l.length/i),j=[];for(let K=0;K<R;K++){const C=Array.from(d.slice(K*i,(K+1)*i));let Y=511;for(let Q=I.length-1;Q>=0;Q--)Y>>=8,Y+=I[Q]+(C[Q]||0),C[Q]=Y&255;j.push(...C)}d=new Uint8Array(j),A.push(...k)}return new Uint8Array(A.slice(0,e>>3)).buffer}function qw(s){const e=typeof s=="string"?{name:s}:s;return"hash"in e?ps(ht({},e),{hash:qw(e.hash)}):e}class vc extends yS{async importKey(e,t,r,a,n){var i,o,u,c,l,m;let h={};const w=qw(r);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,r,a,n);case"spki":{const g=Ke(ve.toArrayBuffer(t));D.assert(g,"keyData");const p=new Pt;try{p.fromSchema(g.result)}catch(d){throw new fe("Incorrect keyData")}switch(w.name.toUpperCase()){case"RSA-PSS":{if(!w.hash)throw new oe("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(w.hash.name.toUpperCase()){case"SHA-1":h.alg="PS1";break;case"SHA-256":h.alg="PS256";break;case"SHA-384":h.alg="PS384";break;case"SHA-512":h.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(w.hash.name.toUpperCase()))}}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],h.kty="RSA",h.ext=a,h.key_ops=n,p.algorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect public key algorithm: ".concat(p.algorithm.algorithmId));if(!h.alg){if(!w.hash)throw new oe("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(w.hash.name.toUpperCase()){case"SHA-1":h.alg="RS1";break;case"SHA-256":h.alg="RS256";break;case"SHA-384":h.alg="RS384";break;case"SHA-512":h.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(w.hash.name.toUpperCase()))}}const d=p.toJSON();Object.assign(h,d)}break;case"ECDSA":n=["verify"];case"ECDH":{if(h={kty:"EC",ext:a,key_ops:n},p.algorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect public key algorithm: ".concat(p.algorithm.algorithmId));const d=p.toJSON();Object.assign(h,d)}break;case"RSA-OAEP":{if(h.kty="RSA",h.ext=a,h.key_ops=n,this.name.toLowerCase()==="safari")h.alg="RSA-OAEP";else{if(!w.hash)throw new oe("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(w.hash.name.toUpperCase()){case"SHA-1":h.alg="RSA-OAEP";break;case"SHA-256":h.alg="RSA-OAEP-256";break;case"SHA-384":h.alg="RSA-OAEP-384";break;case"SHA-512":h.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat(w.hash.name.toUpperCase()))}}const d=p.toJSON();Object.assign(h,d)}break;case"RSAES-PKCS1-V1_5":{h.kty="RSA",h.ext=a,h.key_ops=n,h.alg="PS1";const d=p.toJSON();Object.assign(h,d)}break;default:throw new Error("Incorrect algorithm name: ".concat(w.name.toUpperCase()))}}break;case"pkcs8":{const g=new Zt,p=Ke(ve.toArrayBuffer(t));D.assert(p,"keyData");try{g.fromSchema(p.result)}catch(d){throw new Error("Incorrect keyData")}if(!g.parsedKey)throw new Error("Incorrect keyData");switch(w.name.toUpperCase()){case"RSA-PSS":switch((i=w.hash)===null||i===void 0?void 0:i.name.toUpperCase()){case"SHA-1":h.alg="PS1";break;case"SHA-256":h.alg="PS256";break;case"SHA-384":h.alg="PS384";break;case"SHA-512":h.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((o=w.hash)===null||o===void 0?void 0:o.name.toUpperCase()))}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],h.kty="RSA",h.ext=a,h.key_ops=n,g.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect private key algorithm: ".concat(g.privateKeyAlgorithm.algorithmId));if(!("alg"in h))switch((u=w.hash)===null||u===void 0?void 0:u.name.toUpperCase()){case"SHA-1":h.alg="RS1";break;case"SHA-256":h.alg="RS256";break;case"SHA-384":h.alg="RS384";break;case"SHA-512":h.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((c=w.hash)===null||c===void 0?void 0:c.name.toUpperCase()))}const d=g.toJSON();Object.assign(h,d)}break;case"ECDSA":n=["sign"];case"ECDH":{if(h={kty:"EC",ext:a,key_ops:n},g.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect algorithm: ".concat(g.privateKeyAlgorithm.algorithmId));const d=g.toJSON();Object.assign(h,d)}break;case"RSA-OAEP":{if(h.kty="RSA",h.ext=a,h.key_ops=n,this.name.toLowerCase()==="safari")h.alg="RSA-OAEP";else switch((l=w.hash)===null||l===void 0?void 0:l.name.toUpperCase()){case"SHA-1":h.alg="RSA-OAEP";break;case"SHA-256":h.alg="RSA-OAEP-256";break;case"SHA-384":h.alg="RSA-OAEP-384";break;case"SHA-512":h.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat((m=w.hash)===null||m===void 0?void 0:m.name.toUpperCase()))}const d=g.toJSON();Object.assign(h,d)}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],h.kty="RSA",h.ext=a,h.key_ops=n,h.alg="PS1";const d=g.toJSON();Object.assign(h,d)}break;default:throw new Error("Incorrect algorithm name: ".concat(w.name.toUpperCase()))}}break;case"jwk":h=t;break;default:throw new Error("Incorrect format: ".concat(e))}if(this.name.toLowerCase()==="safari")try{return this.subtle.importKey("jwk",Do(JSON.stringify(h)),r,a,n)}catch(g){return this.subtle.importKey("jwk",h,r,a,n)}return this.subtle.importKey("jwk",h,r,a,n)}async exportKey(e,t){let r=await this.subtle.exportKey("jwk",t);switch(this.name.toLowerCase()==="safari"&&r instanceof ArrayBuffer&&(r=JSON.parse(Uh(r))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{const a=new Pt;try{a.fromJSON(r)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new Zt;try{a.fromJSON(r)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return r;default:throw new Error("Incorrect format: ".concat(e))}}async convert(e,t,r,a,n,i){if(e.toLowerCase()===t.toLowerCase())return r;const o=await this.importKey(e,r,a,n,i);return this.exportKey(t,o)}getAlgorithmByOID(e,t=!1,r){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error("Unsupported algorithm identifier ".concat(r?"for ".concat(r," "):v,": ").concat(e));return{}}getOIDByAlgorithm(e,t=!1,r){let a=v;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11";break}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35";break}if(!a&&t)throw new Error("Unsupported algorithm ".concat(r?"for ".concat(r," "):v,": ").concat(e.name));return a}getAlgorithmParameters(e,t){let r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return r}getHashAlgorithm(e){let t=v;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const r=new nt({schema:e.algorithmParams});if(r.hashAlgorithm){const a=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if("name"in a)t=a.name;else return v}else t="SHA-1"}catch(r){}break}return t}async encryptEncryptedContentInfo(e){oe.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),r=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),n=new ArrayBuffer(16),i=new Uint8Array(n);this.getRandomValues(i);const o=new ArrayBuffer(64),u=new Uint8Array(o);this.getRandomValues(u);const c=new Uint8Array(e.contentToEncrypt),l=new wt({salt:new $({valueHex:o}),iterationCount:e.iterationCount,prf:new B({algorithmId:a,algorithmParams:new We})}),m=new Uint8Array(e.password),h=await this.importKey("raw",m,"PBKDF2",!1,["deriveKey"]),w=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:u,iterations:e.iterationCount},h,e.contentEncryptionAlgorithm,!1,["encrypt"]),g=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:i},w,c),p=new Kn({keyDerivationFunc:new B({algorithmId:r,algorithmParams:l.toSchema()}),encryptionScheme:new B({algorithmId:t,algorithmParams:new $({valueHex:n})})});return new Le({contentType:e.contentType,contentEncryptionAlgorithm:new B({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:p.toSchema()}),encryptedContent:new $({valueHex:g})})}async decryptEncryptedContentInfo(e){if(oe.assert(e,"password","encryptedContentInfo"),e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")throw new Error('Unknown "contentEncryptionAlgorithm": '.concat(e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId));let t;try{t=new Kn({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(g){throw new Error('Incorrectly encoded "pbes2Parameters"')}let r;try{r=new wt({schema:t.keyDerivationFunc.algorithmParams})}catch(g){throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),n=t.encryptionScheme.algorithmParams.valueBlock.valueHex,i=new Uint8Array(n),o=r.salt.valueBlock.valueHex,u=new Uint8Array(o),c=r.iterationCount;let l="SHA-1";r.prf&&(l=this.getAlgorithmByOID(r.prf.algorithmId,!0).hash.name);const m=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),h=await this.deriveKey({name:"PBKDF2",hash:{name:l},salt:u,iterations:c},m,a,!1,["decrypt"]),w=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:i},h,w)}async stampDataWithPassword(e){if(!(e instanceof Object))throw new Error('Parameters must have type "Object"');oe.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp");let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const r={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Zp(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),r,!1,["sign"]);return this.sign(r,n,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){oe.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const r={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Zp(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),r,!1,["verify"]);return this.verify(r,n,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");const r=new B,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const n=a.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?n.hash.name=e.algorithm.hash.name:n.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":r.algorithmId=this.getOIDByAlgorithm(n,!0);break;case"RSA-PSS":{switch(n.hash.name.toUpperCase()){case"SHA-256":n.saltLength=32;break;case"SHA-384":n.saltLength=48;break;case"SHA-512":n.saltLength=64;break}const i={};if(n.hash.name.toUpperCase()!=="SHA-1"){const u=this.getOIDByAlgorithm({name:n.hash.name},!0,"hashAlgorithm");i.hashAlgorithm=new B({algorithmId:u,algorithmParams:new We}),i.maskGenAlgorithm=new B({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:i.hashAlgorithm.toSchema()})}n.saltLength!==20&&(i.saltLength=n.saltLength);const o=new nt(i);r.algorithmId="1.2.840.113549.1.1.10",r.algorithmParams=o.toSchema()}break;default:throw new Error("Unsupported signature algorithm: ".concat(e.algorithm.name))}return{signatureAlgorithm:r,parameters:a}}async signWithPrivateKey(e,t,r){const a=await this.sign(r.algorithm,t,e);return r.algorithm.name==="ECDSA"?bS(a):a}fillPublicKeyParameters(e,t){const r={},a=this.getHashAlgorithm(t);if(a===v)throw new Error("Unsupported signature algorithm: ".concat(t.algorithmId));let n;t.algorithmId==="1.2.840.113549.1.1.10"?n=t.algorithmId:n=e.algorithm.algorithmId;const i=this.getAlgorithmByOID(n,!0);if(r.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in r.algorithm.algorithm&&(r.algorithm.algorithm.hash.name=a),i.name==="ECDSA"){const o=e.algorithm;if(!o.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const u=o.algorithmParams;if("idBlock"in o.algorithmParams&&!(u.idBlock.tagClass===1&&u.idBlock.tagNumber===6))throw new Error("Incorrect type for ECDSA public key parameters");const c=this.getAlgorithmByOID(u.valueBlock.toString(),!0);r.algorithm.algorithm.namedCurve=c.name}return r}async getPublicKey(e,t,r){r||(r=this.fillPublicKeyParameters(e,t));const a=e.toSchema().toBER(!1);return this.importKey("spki",a,r.algorithm.algorithm,!0,r.algorithm.usages)}async verifyWithPublicKey(e,t,r,a,n){let i;if(n){const c={};let l;a.algorithmId==="1.2.840.113549.1.1.10"?l=a.algorithmId:l=r.algorithm.algorithmId;const m=this.getAlgorithmByOID(l,!0);if(c.algorithm=this.getAlgorithmParameters(m.name,"importKey"),"hash"in c.algorithm.algorithm&&(c.algorithm.algorithm.hash.name=n),m.name==="ECDSA"){let h=!1;if("algorithmParams"in r.algorithm&&"idBlock"in r.algorithm.algorithmParams&&r.algorithm.algorithmParams.idBlock.tagClass===1&&r.algorithm.algorithmParams.idBlock.tagNumber===6&&(h=!0),h===!1)throw new Error("Incorrect type for ECDSA public key parameters");const w=this.getAlgorithmByOID(r.algorithm.algorithmParams.valueBlock.toString(),!0);c.algorithm.algorithm.namedCurve=w.name}i=await this.getPublicKey(r,null,c)}else{if(n=this.getHashAlgorithm(a),!n)throw new Error("Unsupported signature algorithm: ".concat(a.algorithmId));i=await this.getPublicKey(r,a)}const o=this.getAlgorithmParameters(i.algorithm.name,"verify");"hash"in o.algorithm&&(o.algorithm.hash.name=n);let u=t.valueBlock.valueHexView;if(i.algorithm.name==="ECDSA"){const c=la.find(i.algorithm.namedCurve);if(!c)throw new Error("Unsupported named curve in use");const l=Ke(u);D.assert(l,"Signature value"),u=AS(l.result,c.size)}if(i.algorithm.name==="RSA-PSS"){const c=new nt({schema:a.algorithmParams});"saltLength"in c?o.algorithm.saltLength=c.saltLength:o.algorithm.saltLength=20;let l="SHA-1";"hashAlgorithm"in c&&(l=this.getAlgorithmByOID(c.hashAlgorithm.algorithmId,!0).name),o.algorithm.hash.name=l}return this.verify(o.algorithm,i,u,e)}}let _w={name:"none",crypto:null};function eg(s){return!!(s&&typeof s=="object"&&"crypto"in s)}function tg(s,...e){let t=null;if(e.length<2)e.length?t=e[0]:t=typeof self<"u"&&self.crypto?new vc({name:"browser",crypto:self.crypto}):null;else{const r=e[0],a=e[1];eg(a)?t=a:eg(r)?t=r:"subtle"in r&&"getRandomValues"in r&&(t=new vc({crypto:r}))}if(typeof Ye<"u"&&"pid"in Ye&&typeof Lt<"u"&&typeof window>"u"){if(typeof Lt[Ye.pid]>"u")Lt[Ye.pid]={};else if(typeof Lt[Ye.pid]!="object")throw new Error("Name global.".concat(Ye.pid," already exists and it is not an object"));if(typeof Lt[Ye.pid].pkijs>"u")Lt[Ye.pid].pkijs={};else if(typeof Lt[Ye.pid].pkijs!="object")throw new Error("Name global.".concat(Ye.pid,".pkijs already exists and it is not an object"));Lt[Ye.pid].pkijs.engine={name:s,crypto:t}}else _w={name:s,crypto:t}}function vS(){if(typeof Ye<"u"&&"pid"in Ye&&typeof Lt<"u"&&typeof window>"u"){let s;try{s=Lt[Ye.pid].pkijs.engine}catch(e){throw new Error("Please call 'setEngine' before call to 'getEngine'")}return s}return _w}function se(s=!1){const e=vS();if(!e.crypto&&s)throw new Error("Unable to create WebCrypto object");return e.crypto}function bS(s){if(s.byteLength%2!==0)return Me;const e=s.byteLength/2,t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(s,0,e));const r=new O({valueHex:t}),a=new ArrayBuffer(e);new Uint8Array(a).set(new Uint8Array(s,e,e));const n=new O({valueHex:a});return new N({value:[r.convertToDER(),n.convertToDER()]}).toBER(!1)}function AS(s,e){if(!(s instanceof N&&s.valueBlock.value.length===2&&s.valueBlock.value[0]instanceof O&&s.valueBlock.value[1]instanceof O))return Me;const t=s.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,r=s.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,a=new Uint8Array(e*2);return a.set(t,e-t.byteLength),a.set(r,2*e-r.byteLength),a.buffer}async function SS(s,e,t,r,a){switch(s.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new fe("Unknown hash function: ".concat(s))}if(fe.assert(e,"zBuffer","ArrayBuffer"),e.byteLength===0)throw new fe("'zBuffer' has zero length, error");if(fe.assert(r,"SharedInfo","ArrayBuffer"),t>255)throw new fe("Please set 'Counter' argument to value less or equal to 255");const n=new ArrayBuffer(4),i=new Uint8Array(n);i[0]=0,i[1]=0,i[2]=0,i[3]=t;let o=Me;o=Co(o,e),o=Co(o,n),o=Co(o,r);const u=await a.digest({name:s},o);return{counter:t,result:u}}async function sg(s,e,t,r,a=se(!0)){let n=0,i=1;switch(s.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:throw new fe("Unknown hash function: ".concat(s))}if(fe.assert(e,"Zbuffer","ArrayBuffer"),e.byteLength===0)throw new fe("'Zbuffer' has zero length, error");fe.assert(r,"SharedInfo","ArrayBuffer");const o=t/n;Math.floor(o)>0&&(i=Math.floor(o),o-i>0&&i++);const u=[];for(let h=1;h<=i;h++)u.push(await SS(s,e,h,r,a));let c=Me,l=1,m=!0;for(;m;){m=!1;for(const h of u)if(h.counter===l){c=Co(c,h.result),m=!0;break}l++}if(t>>=3,c.byteLength>t){const h=new ArrayBuffer(t),w=new Uint8Array(h),g=new Uint8Array(c);for(let p=0;p<t;p++)w[p]=g[p];return h}return c}const Fm="version",Jm="logID",qm="extensions",_m="timestamp",Wm="hashAlgorithm",Gm="signatureAlgorithm",Xm="signature",rg="none",ag="md5",ng="sha1",ig="sha224",og="sha256",ug="sha384",lg="sha512",cg="anonymous",hg="rsa",mg="dsa",fg="ecdsa";class ys extends T{constructor(e={}){super(),this.version=f(e,Fm,ys.defaultValues(Fm)),this.logID=f(e,Jm,ys.defaultValues(Jm)),this.timestamp=f(e,_m,ys.defaultValues(_m)),this.extensions=f(e,qm,ys.defaultValues(qm)),this.hashAlgorithm=f(e,Wm,ys.defaultValues(Wm)),this.signatureAlgorithm=f(e,Gm,ys.defaultValues(Gm)),this.signature=f(e,Xm,ys.defaultValues(Xm)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fm:return 0;case Jm:case qm:return Me;case _m:return new Date(0);case Wm:case Gm:return v;case Xm:return new z;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof jh))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new ua({stream:new Ce({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(Ny(new Uint8Array(e.getBlock(8)),8));const r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=rg;break;case 1:this.hashAlgorithm=ag;break;case 2:this.hashAlgorithm=ng;break;case 3:this.hashAlgorithm=ig;break;case 4:this.hashAlgorithm=og;break;case 5:this.hashAlgorithm=ug;break;case 6:this.hashAlgorithm=lg;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=cg;break;case 1:this.signatureAlgorithm=hg;break;case 2:this.signatureAlgorithm=mg;break;case 3:this.signatureAlgorithm=fg;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16(),n=new Uint8Array(e.getBlock(a)).buffer.slice(0),i=Ke(n);if(D.assert(i,"SignedCertificateTimestamp"),this.signature=i.result,t!==47+r+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new jh({data:e.stream.buffer})}toStream(){const e=new ua;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),r=new Uint8Array(t),a=Xd(this.timestamp.valueOf(),8);r.set(new Uint8Array(a),8-a.byteLength),e.appendView(r),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions));let n;switch(this.hashAlgorithm.toLowerCase()){case rg:n=0;break;case ag:n=1;break;case ng:n=2;break;case ig:n=3;break;case og:n=4;break;case ug:n=5;break;case lg:n=6;break;default:throw new Error("Incorrect data for hashAlgorithm: ".concat(this.hashAlgorithm))}e.appendChar(n);let i;switch(this.signatureAlgorithm.toLowerCase()){case cg:i=0;break;case hg:i=1;break;case mg:i=2;break;case fg:i=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: ".concat(this.signatureAlgorithm))}e.appendChar(i);const o=this.signature.toBER(!1);return e.appendUint16(o.byteLength),e.appendView(new Uint8Array(o)),e}toJSON(){return{version:this.version,logID:zd(this.logID),timestamp:this.timestamp,extensions:zd(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,r=0,a=se(!0)){const n=Af(Uh(this.logID));let i=null;const o=new ua;for(const w of e)if(w.log_id===n){i=w.key;break}if(!i)throw new Error("Public key not found for CT with logId: ".concat(n));const u=Do(mc(i)),c=Pt.fromBER(u);o.appendChar(0),o.appendChar(0);const l=new ArrayBuffer(8),m=new Uint8Array(l),h=Xd(this.timestamp.valueOf(),8);return m.set(new Uint8Array(h),8-h.byteLength),o.appendView(m),o.appendUint16(r),r===0&&o.appendUint24(t.byteLength),o.appendView(new Uint8Array(t)),o.appendUint16(this.extensions.byteLength),this.extensions.byteLength!==0&&o.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(o.buffer.slice(0,o.length),new $({valueHex:this.signature.toBER(!1)}),c,{algorithmId:v},"SHA-256")}}ys.CLASS_NAME="SignedCertificateTimestamp";const Lc="timestamps";class cm extends T{constructor(e={}){super(),this.timestamps=f(e,Lc,cm.defaultValues(Lc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Lc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Lc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){var t;const r=f(e,"names",{});return(t=r.optional)!==null&&t!==void 0||(r.optional=!1),new $({name:r.blockName||"SignedCertificateTimestampList",optional:r.optional})}fromSchema(e){if(!(e instanceof $))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new ua({stream:new Ce({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new ys({stream:t}))}toSchema(){const e=new ua;let t=0;const r=[];for(const a of this.timestamps){const n=a.toStream();r.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const a of r)e.appendView(a.stream.view);return new $({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}cm.CLASS_NAME="SignedCertificateTimestampList";const zu="attributes",NS=[zu];class bc extends T{constructor(e={}){super(),this.attributes=f(e,zu,bc.defaultValues(zu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.attributes||v,value:be.schema()})]})}fromSchema(e){L(e,NS);const t=U(e,e,bc.schema({names:{attributes:zu}}));D.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,r=>new be({schema:r}))}toSchema(){return new N({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}bc.CLASS_NAME="SubjectDirectoryAttributes";class Ne{static getItems(){return this.types||(this.types={},Ne.register(Pw,"SubjectAltName",Ro),Ne.register(Bw,"IssuerAltName",Ro),Ne.register(Id,"AuthorityKeyIdentifier",ra),Ne.register(Ed,"BasicConstraints",Tn),Ne.register($A,"MicrosoftCaVersion",pc),Ne.register(Lw,"CertificatePolicies",Lo),Ne.register(DA,"CertificatePoliciesMicrosoft",Lo),Ne.register(jA,"MicrosoftCertTemplateV2",ko),Ne.register(Rw,"CRLDistributionPoints",Uo),Ne.register(Cd,"FreshestCRL",Uo),Ne.register(TA,"ExtKeyUsage",gc),Ne.register(Dw,"CertificateIssuer",Xe),Ne.register(xd,"AuthorityInfoAccess",jo),Ne.register(LA,"SubjectInfoAccess",jo),Ne.register(Ow,"IssuingDistributionPoint",rt),Ne.register(Tw,"NameConstraints",xo),Ne.register(jw,"PolicyConstraints",Vo),Ne.register(Uw,"PolicyMappings",wc),Ne.register(xA,"PrivateKeyUsagePeriod",Po),Ne.register(KA,"QCStatements",yc),Ne.register(UA,"SignedCertificateTimestampList",cm),Ne.register(EA,"SubjectDirectoryAttributes",bc)),this.types}static fromBER(e,t){const r=Ke(t);if(r.offset===-1)return null;const a=this.find(e);if(a)try{return new a.type({schema:r.result})}catch(n){const i=new a.type;return i.parsingError="Incorrectly formatted value of extension ".concat(a.name," (").concat(e,")"),i}return r.result}static find(e){return this.getItems()[e]||null}static register(e,t,r){this.getItems()[e]={name:t,type:r}}}const Yu="extnID",Cr="critical",Qu="extnValue",Uc="parsedValue",kS=[Yu,Cr,Qu];class Ue extends T{get parsedValue(){if(this._parsedValue===void 0){const e=Ne.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=f(e,Yu,Ue.defaultValues(Yu)),this.critical=f(e,Cr,Ue.defaultValues(Cr)),Qu in e?this.extnValue=new $({valueHex:e.extnValue}):this.extnValue=Ue.defaultValues(Qu),Uc in e&&(this.parsedValue=f(e,Uc,Ue.defaultValues(Uc))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yu:return v;case Cr:return!1;case Qu:return new $;case Uc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.extnID||v}),new fa({name:t.critical||v,optional:!0}),new $({name:t.extnValue||v})]})}fromSchema(e){L(e,kS);const t=U(e,e,Ue.schema({names:{extnID:Yu,critical:Cr,extnValue:Qu}}));D.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),Cr in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new J({value:this.extnID})),this.critical!==Ue.defaultValues(Cr)&&e.push(new fa({value:this.critical})),e.push(this.extnValue),new N({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Ue.defaultValues(Cr)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}Ue.CLASS_NAME="Extension";const Zu="extensions",ES=[Zu];class He extends T{constructor(e={}){super(),this.extensions=f(e,Zu,He.defaultValues(Zu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zu:return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=f(e,"names",{});return new N({optional:t,name:r.blockName||v,value:[new Z({name:r.extensions||v,value:Ue.schema(r.extension||{})})]})}fromSchema(e){L(e,ES);const t=U(e,e,He.schema({names:{extensions:Zu}}));D.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,r=>new Ue({schema:r}))}toSchema(){return new N({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}He.CLASS_NAME="Extensions";const el="issuer",tl="serialNumber",Ra="issuerUID",CS=[el,tl,Ra];class Vt extends T{constructor(e={}){super(),this.issuer=f(e,el,Vt.defaultValues(el)),this.serialNumber=f(e,tl,Vt.defaultValues(tl)),Ra in e&&(this.issuerUID=f(e,Ra,Vt.defaultValues(Ra))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case el:return new Xe;case tl:return new O;case Ra:return new ie;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[Xe.schema(t.issuer||{}),new O({name:t.serialNumber||v}),new ie({optional:!0,name:t.issuerUID||v})]})}fromSchema(e){L(e,CS);const t=U(e,e,Vt.schema({names:{issuer:{names:{blockName:el}},serialNumber:tl,issuerUID:Ra}}));D.assertSchema(t,this.className),this.issuer=new Xe({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,Ra in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new N({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}Vt.CLASS_NAME="IssuerSerial";const sl="version",La="baseCertificateID",Ua="subjectName",rl="issuer",al="signature",nl="serialNumber",il="attrCertValidityPeriod",ol="attributes",ja="issuerUniqueID",$a="extensions",IS=[sl,La,Ua,rl,al,nl,il,ol,ja,$a];class pt extends T{constructor(e={}){super(),this.version=f(e,sl,pt.defaultValues(sl)),La in e&&(this.baseCertificateID=f(e,La,pt.defaultValues(La))),Ua in e&&(this.subjectName=f(e,Ua,pt.defaultValues(Ua))),this.issuer=f(e,rl,pt.defaultValues(rl)),this.signature=f(e,al,pt.defaultValues(al)),this.serialNumber=f(e,nl,pt.defaultValues(nl)),this.attrCertValidityPeriod=f(e,il,pt.defaultValues(il)),this.attributes=f(e,ol,pt.defaultValues(ol)),ja in e&&(this.issuerUniqueID=f(e,ja,pt.defaultValues(ja))),$a in e&&(this.extensions=f(e,$a,pt.defaultValues($a))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sl:return 0;case La:return new Vt;case Ua:return new Xe;case rl:return new Xe;case al:return new B;case nl:return new O;case il:return new ms;case ol:return[];case ja:return new ie;case $a:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),new Ie({value:[new V({name:t.baseCertificateID||v,idBlock:{tagClass:3,tagNumber:0},value:Vt.schema().valueBlock.value}),new V({name:t.subjectName||v,idBlock:{tagClass:3,tagNumber:1},value:Xe.schema().valueBlock.value})]}),Xe.schema({names:{blockName:t.issuer||v}}),B.schema(t.signature||{}),new O({name:t.serialNumber||v}),ms.schema(t.attrCertValidityPeriod||{}),new N({name:t.attributes||v,value:[new Z({value:be.schema()})]}),new ie({optional:!0,name:t.issuerUniqueID||v}),He.schema(t.extensions||{},!0)]})}fromSchema(e){L(e,IS);const t=U(e,e,pt.schema({names:{version:sl,baseCertificateID:La,subjectName:Ua,issuer:rl,signature:{names:{blockName:al}},serialNumber:nl,attrCertValidityPeriod:{names:{blockName:il}},attributes:ol,issuerUniqueID:ja,extensions:{names:{blockName:$a}}}}));D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,La in t.result&&(this.baseCertificateID=new Vt({schema:new N({value:t.result.baseCertificateID.valueBlock.value})})),Ua in t.result&&(this.subjectName=new Xe({schema:new N({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new B({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ms({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,r=>new be({schema:r})),ja in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),$a in t.result&&(this.extensions=new He({schema:t.result.extensions}))}toSchema(){const e=new N({value:[new O({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new V({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new V({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new N({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}pt.CLASS_NAME="AttributeCertificateInfoV1";const ul="acinfo",ll="signatureAlgorithm",cl="signatureValue",xS=[ul,cl,ll];class qs extends T{constructor(e={}){super(),this.acinfo=f(e,ul,qs.defaultValues(ul)),this.signatureAlgorithm=f(e,ll,qs.defaultValues(ll)),this.signatureValue=f(e,cl,qs.defaultValues(cl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ul:return new pt;case ll:return new B;case cl:return new ie;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[pt.schema(t.acinfo||{}),B.schema(t.signatureAlgorithm||{}),new ie({name:t.signatureValue||v})]})}fromSchema(e){L(e,xS);const t=U(e,e,qs.schema({names:{acinfo:{names:{blockName:ul}},signatureAlgorithm:{names:{blockName:ll}},signatureValue:cl}}));D.assertSchema(t,this.className),this.acinfo=new pt({schema:t.result.acinfo}),this.signatureAlgorithm=new B({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new N({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}qs.CLASS_NAME="AttributeCertificateV1";const hl="digestedObjectType",Ka="otherObjectTypeID",ml="digestAlgorithm",fl="objectDigest",VS=[hl,Ka,ml,fl];class qt extends T{constructor(e={}){super(),this.digestedObjectType=f(e,hl,qt.defaultValues(hl)),Ka in e&&(this.otherObjectTypeID=f(e,Ka,qt.defaultValues(Ka))),this.digestAlgorithm=f(e,ml,qt.defaultValues(ml)),this.objectDigest=f(e,fl,qt.defaultValues(fl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hl:return new fc;case Ka:return new J;case ml:return new B;case fl:return new ie;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new fc({name:t.digestedObjectType||v}),new J({optional:!0,name:t.otherObjectTypeID||v}),B.schema(t.digestAlgorithm||{}),new ie({name:t.objectDigest||v})]})}fromSchema(e){L(e,VS);const t=U(e,e,qt.schema({names:{digestedObjectType:hl,otherObjectTypeID:Ka,digestAlgorithm:{names:{blockName:ml}},objectDigest:fl}}));D.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,Ka in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new B({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new N({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}qt.CLASS_NAME="ObjectDigestInfo";const Ma="issuerName",Ha="baseCertificateID",Fa="objectDigestInfo",PS=[Ma,Ha,Fa];class na extends T{constructor(e={}){super(),Ma in e&&(this.issuerName=f(e,Ma,na.defaultValues(Ma))),Ha in e&&(this.baseCertificateID=f(e,Ha,na.defaultValues(Ha))),Fa in e&&(this.objectDigestInfo=f(e,Fa,na.defaultValues(Fa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ma:return new Xe;case Ha:return new Vt;case Fa:return new qt;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[Xe.schema({names:{blockName:t.issuerName}},!0),new V({optional:!0,name:t.baseCertificateID||v,idBlock:{tagClass:3,tagNumber:0},value:Vt.schema().valueBlock.value}),new V({optional:!0,name:t.objectDigestInfo||v,idBlock:{tagClass:3,tagNumber:1},value:qt.schema().valueBlock.value})]})}fromSchema(e){L(e,PS);const t=U(e,e,na.schema({names:{issuerName:Ma,baseCertificateID:Ha,objectDigestInfo:Fa}}));D.assertSchema(t,this.className),Ma in t.result&&(this.issuerName=new Xe({schema:t.result.issuerName})),Ha in t.result&&(this.baseCertificateID=new Vt({schema:new N({value:t.result.baseCertificateID.valueBlock.value})})),Fa in t.result&&(this.objectDigestInfo=new qt({schema:new N({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new N;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new V({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new V({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}na.CLASS_NAME="V2Form";const Ja="baseCertificateID",qa="entityName",_a="objectDigestInfo",BS=[Ja,qa,_a];class _s extends T{constructor(e={}){super(),Ja in e&&(this.baseCertificateID=f(e,Ja,_s.defaultValues(Ja))),qa in e&&(this.entityName=f(e,qa,_s.defaultValues(qa))),_a in e&&(this.objectDigestInfo=f(e,_a,_s.defaultValues(_a))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ja:return new Vt;case qa:return new Xe;case _a:return new qt;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new V({optional:!0,name:t.baseCertificateID||v,idBlock:{tagClass:3,tagNumber:0},value:Vt.schema().valueBlock.value}),new V({optional:!0,name:t.entityName||v,idBlock:{tagClass:3,tagNumber:1},value:Xe.schema().valueBlock.value}),new V({optional:!0,name:t.objectDigestInfo||v,idBlock:{tagClass:3,tagNumber:2},value:qt.schema().valueBlock.value})]})}fromSchema(e){L(e,BS);const t=U(e,e,_s.schema({names:{baseCertificateID:Ja,entityName:qa,objectDigestInfo:_a}}));D.assertSchema(t,this.className),Ja in t.result&&(this.baseCertificateID=new Vt({schema:new N({value:t.result.baseCertificateID.valueBlock.value})})),qa in t.result&&(this.entityName=new Xe({schema:new N({value:t.result.entityName.valueBlock.value})})),_a in t.result&&(this.objectDigestInfo=new qt({schema:new N({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new N;return this.baseCertificateID&&e.valueBlock.value.push(new V({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new V({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new V({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}_s.CLASS_NAME="Holder";const dl="version",pl="holder",gl="issuer",wl="signature",yl="serialNumber",vl="attrCertValidityPeriod",bl="attributes",Wa="issuerUniqueID",Ga="extensions",OS=[dl,pl,gl,wl,yl,vl,bl,Wa,Ga];class Nt extends T{constructor(e={}){super(),this.version=f(e,dl,Nt.defaultValues(dl)),this.holder=f(e,pl,Nt.defaultValues(pl)),this.issuer=f(e,gl,Nt.defaultValues(gl)),this.signature=f(e,wl,Nt.defaultValues(wl)),this.serialNumber=f(e,yl,Nt.defaultValues(yl)),this.attrCertValidityPeriod=f(e,vl,Nt.defaultValues(vl)),this.attributes=f(e,bl,Nt.defaultValues(bl)),Wa in e&&(this.issuerUniqueID=f(e,Wa,Nt.defaultValues(Wa))),Ga in e&&(this.extensions=f(e,Ga,Nt.defaultValues(Ga))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case dl:return 1;case pl:return new _s;case gl:return{};case wl:return new B;case yl:return new O;case vl:return new ms;case bl:return[];case Wa:return new ie;case Ga:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),_s.schema(t.holder||{}),new Ie({value:[Xe.schema({names:{blockName:t.issuer||v}}),new V({name:t.issuer||v,idBlock:{tagClass:3,tagNumber:0},value:na.schema().valueBlock.value})]}),B.schema(t.signature||{}),new O({name:t.serialNumber||v}),ms.schema(t.attrCertValidityPeriod||{}),new N({name:t.attributes||v,value:[new Z({value:be.schema()})]}),new ie({optional:!0,name:t.issuerUniqueID||v}),He.schema(t.extensions||{},!0)]})}fromSchema(e){L(e,OS);const t=U(e,e,Nt.schema({names:{version:dl,holder:{names:{blockName:pl}},issuer:gl,signature:{names:{blockName:wl}},serialNumber:yl,attrCertValidityPeriod:{names:{blockName:vl}},attributes:bl,issuerUniqueID:Wa,extensions:{names:{blockName:Ga}}}}));switch(D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new _s({schema:t.result.holder}),t.result.issuer.idBlock.tagClass){case 3:this.issuer=new na({schema:new N({value:t.result.issuer.valueBlock.value})});break;case 1:default:throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2")}this.signature=new B({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ms({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,r=>new be({schema:r})),Wa in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),Ga in t.result&&(this.extensions=new He({schema:t.result.extensions}))}toSchema(){const e=new N({value:[new O({value:this.version}),this.holder.toSchema(),new V({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new N({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}Nt.CLASS_NAME="AttributeCertificateInfoV2";const Al="acinfo",Sl="signatureAlgorithm",Nl="signatureValue",DS=[Al,Sl,Nl];class _t extends T{constructor(e={}){super(),this.acinfo=f(e,Al,_t.defaultValues(Al)),this.signatureAlgorithm=f(e,Sl,_t.defaultValues(Sl)),this.signatureValue=f(e,Nl,_t.defaultValues(Nl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Al:return new Nt;case Sl:return new B;case Nl:return new ie;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[Nt.schema(t.acinfo||{}),B.schema(t.signatureAlgorithm||{}),new ie({name:t.signatureValue||v})]})}fromSchema(e){L(e,DS);const t=U(e,e,_t.schema({names:{acinfo:{names:{blockName:Al}},signatureAlgorithm:{names:{blockName:Sl}},signatureValue:Nl}}));D.assertSchema(t,this.className),this.acinfo=new Nt({schema:t.result.acinfo}),this.signatureAlgorithm=new B({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new N({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}_t.CLASS_NAME="AttributeCertificateV2";const Xa="contentType",mi="content",TS=[Xa,mi];class we extends T{constructor(e={}){super(),this.contentType=f(e,Xa,we.defaultValues(Xa)),this.content=f(e,mi,we.defaultValues(mi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xa:return v;case mi:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Xa:return typeof t=="string"&&t===this.defaultValues(Xa);case mi:return t instanceof z;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return"optional"in t||(t.optional=!1),new N({name:t.blockName||"ContentInfo",optional:t.optional,value:[new J({name:t.contentType||Xa}),new V({idBlock:{tagClass:3,tagNumber:0},value:[new z({name:t.content||mi})]})]})}fromSchema(e){L(e,TS);const t=U(e,e,we.schema());D.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new N({value:[new J({value:this.contentType}),new V({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof z||(e.content=this.content.toJSON()),e}}we.CLASS_NAME="ContentInfo",we.DATA=Vd,we.SIGNED_DATA=$w,we.ENVELOPED_DATA=Kw,we.ENCRYPTED_DATA=Mw;const zm="type",Ym="value",Kf="utcTimeName",Mf="generalTimeName",RS=[Kf,Mf];var dg;(function(s){s[s.UTCTime=0]="UTCTime",s[s.GeneralizedTime=1]="GeneralizedTime",s[s.empty=2]="empty"})(dg||(dg={}));class $e extends T{constructor(e={}){super(),this.type=f(e,zm,$e.defaultValues(zm)),this.value=f(e,Ym,$e.defaultValues(Ym)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zm:return 0;case Ym:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=f(e,"names",{});return new Ie({optional:t,value:[new Sf({name:r.utcTimeName||v}),new Ve({name:r.generalTimeName||v})]})}fromSchema(e){L(e,RS);const t=U(e,e,$e.schema({names:{utcTimeName:Kf,generalTimeName:Mf}}));D.assertSchema(t,this.className),Kf in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),Mf in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return this.type===0?new Sf({valueDate:this.value}):this.type===1?new Ve({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}$e.CLASS_NAME="Time";const Qm="tbs",Ir="version",oh="serialNumber",uh="signature",lh="issuer",ch="notBefore",hh="notAfter",mh="subject",fh="subjectPublicKeyInfo",kl="issuerUniqueID",El="subjectUniqueID",Cl="extensions",Il="signatureAlgorithm",xl="signatureValue",Wt="tbsCertificate",Wh="".concat(Wt,".").concat(Ir),Pd="".concat(Wt,".").concat(oh),Bd="".concat(Wt,".").concat(uh),Od="".concat(Wt,".").concat(lh),Gh="".concat(Wt,".").concat(ch),Xh="".concat(Wt,".").concat(hh),Dd="".concat(Wt,".").concat(mh),Td="".concat(Wt,".").concat(fh),zh="".concat(Wt,".").concat(kl),Yh="".concat(Wt,".").concat(El),uc="".concat(Wt,".").concat(Cl),LS=[Wt,Wh,Pd,Bd,Od,Gh,Xh,Dd,Td,zh,Yh,uc,Il,xl];function US(s={}){const e=f(s,"names",{});return new N({name:e.blockName||Wt,value:[new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({name:e.tbsCertificateVersion||Wh})]}),new O({name:e.tbsCertificateSerialNumber||Pd}),B.schema(e.signature||{names:{blockName:Bd}}),de.schema(e.issuer||{names:{blockName:Od}}),new N({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[$e.schema(e.notBefore||{names:{utcTimeName:Gh,generalTimeName:Gh}}),$e.schema(e.notAfter||{names:{utcTimeName:Xh,generalTimeName:Xh}})]}),de.schema(e.subject||{names:{blockName:Dd}}),Pt.schema(e.subjectPublicKeyInfo||{names:{blockName:Td}}),new G({name:e.tbsCertificateIssuerUniqueID||zh,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new G({name:e.tbsCertificateSubjectUniqueID||Yh,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[He.schema(e.extensions||{names:{blockName:uc}})]})]})}class le extends T{get tbs(){return ve.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,Qm,le.defaultValues(Qm))),this.version=f(e,Ir,le.defaultValues(Ir)),this.serialNumber=f(e,oh,le.defaultValues(oh)),this.signature=f(e,uh,le.defaultValues(uh)),this.issuer=f(e,lh,le.defaultValues(lh)),this.notBefore=f(e,ch,le.defaultValues(ch)),this.notAfter=f(e,hh,le.defaultValues(hh)),this.subject=f(e,mh,le.defaultValues(mh)),this.subjectPublicKeyInfo=f(e,fh,le.defaultValues(fh)),kl in e&&(this.issuerUniqueID=f(e,kl,le.defaultValues(kl))),El in e&&(this.subjectUniqueID=f(e,El,le.defaultValues(El))),Cl in e&&(this.extensions=f(e,Cl,le.defaultValues(Cl))),this.signatureAlgorithm=f(e,Il,le.defaultValues(Il)),this.signatureValue=f(e,xl,le.defaultValues(xl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qm:return Me;case Ir:return 0;case oh:return new O;case uh:return new B;case lh:return new de;case ch:return new $e;case hh:return new $e;case mh:return new de;case fh:return new Pt;case kl:return Me;case El:return Me;case Cl:return[];case Il:return new B;case xl:return new ie;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[US(t.tbsCertificate),B.schema(t.signatureAlgorithm||{names:{blockName:Il}}),new ie({name:t.signatureValue||xl})]})}fromSchema(e){L(e,LS);const t=U(e,e,le.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:uc}}}}}}));D.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,Wh in t.result&&(this.version=t.result[Wh].valueBlock.valueDec),this.serialNumber=t.result[Pd],this.signature=new B({schema:t.result[Bd]}),this.issuer=new de({schema:t.result[Od]}),this.notBefore=new $e({schema:t.result[Gh]}),this.notAfter=new $e({schema:t.result[Xh]}),this.subject=new de({schema:t.result[Dd]}),this.subjectPublicKeyInfo=new Pt({schema:t.result[Td]}),zh in t.result&&(this.issuerUniqueID=t.result[zh].valueBlock.valueHex),Yh in t.result&&(this.subjectUniqueID=t.result[Yh].valueBlock.valueHex),uc in t.result&&(this.extensions=Array.from(t.result[uc],r=>new Ue({schema:r}))),this.signatureAlgorithm=new B({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return Ir in this&&this.version!==le.defaultValues(Ir)&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new N({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new G({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new G({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new N({value:Array.from(this.extensions,t=>t.toSchema())})]})),new N({value:e})}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return le.schema().value[0];const r=Ke(this.tbsView);D.assert(r,"TBS Certificate"),t=r.result}else t=this.encodeTBS();return new N({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:me.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Ir in this&&this.version!==le.defaultValues(Ir)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=me.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=me.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async getPublicKey(e,t=se(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=se(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",r=se(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ie({valueHex:i})}async verify(e,t=se(!0)){let r;if(e?r=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(r=this.subjectPublicKeyInfo),!(r instanceof Pt))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,r,this.signatureAlgorithm)}}le.CLASS_NAME="Certificate";function Ww(s,e=null){if(e&&s.issuer.isEqual(e.issuer)&&s.serialNumber.isEqual(e.serialNumber))return null;let t=!1;if(s.extensions){for(const r of s.extensions)if(r.extnID===Ed&&r.parsedValue instanceof Tn&&r.parsedValue.cA){t=!0;break}}return t?s:null}const fi="certId",di="certValue",Gn="parsedValue",jS=[fi,di];class xn extends T{constructor(e={}){super(),this.certId=f(e,fi,xn.defaultValues(fi)),this.certValue=f(e,di,xn.defaultValues(di)),Gn in e&&(this.parsedValue=f(e,Gn,xn.defaultValues(Gn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fi:return v;case di:return new z;case Gn:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fi:return t===v;case di:return t instanceof z;case Gn:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.id||"id"}),new V({idBlock:{tagClass:3,tagNumber:0},value:[new z({name:t.value||"value"})]})]})}fromSchema(e){L(e,jS);const t=U(e,e,xn.schema({names:{id:fi,value:di}}));D.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const r=this.certValue.valueBlock.valueHexView;switch(this.certId){case Xp:try{this.parsedValue=le.fromBER(r)}catch(a){_t.fromBER(r)}break;case zp:this.parsedValue=_t.fromBER(r);break;case HA:default:throw new Error("Incorrect CERT_ID value in CertBag: ".concat(this.certId))}}toSchema(){return Gn in this&&("acinfo"in this.parsedValue?this.certId=zp:this.certId=Xp,this.certValue=new $({valueHex:this.parsedValue.toSchema().toBER(!1)})),new N({value:[new J({value:this.certId}),new V({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}xn.CLASS_NAME="CertBag";const Vl="userCertificate",pi="revocationDate",za="crlEntryExtensions",$S=[Vl,pi,za];class Vn extends T{constructor(e={}){super(),this.userCertificate=f(e,Vl,Vn.defaultValues(Vl)),this.revocationDate=f(e,pi,Vn.defaultValues(pi)),za in e&&(this.crlEntryExtensions=f(e,za,Vn.defaultValues(za))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vl:return new O;case pi:return new $e;case za:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.userCertificate||Vl}),$e.schema({names:{utcTimeName:t.revocationDate||pi,generalTimeName:t.revocationDate||pi}}),He.schema({names:{blockName:t.crlEntryExtensions||za}},!0)]})}fromSchema(e){L(e,$S);const t=U(e,e,Vn.schema());D.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new $e({schema:t.result.revocationDate}),za in t.result&&(this.crlEntryExtensions=new He({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new N({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}Vn.CLASS_NAME="RevokedCertificate";const Zm="tbs",eu="version",ef="signature",tf="issuer",sf="thisUpdate",jc="nextUpdate",$c="revokedCertificates",Kc="crlExtensions",Pl="signatureAlgorithm",Bl="signatureValue",Zs="tbsCertList",Qh="".concat(Zs,".version"),Rd="".concat(Zs,".signature"),Ld="".concat(Zs,".issuer"),Zh="".concat(Zs,".thisUpdate"),Ac="".concat(Zs,".nextUpdate"),em="".concat(Zs,".revokedCertificates"),tm="".concat(Zs,".extensions"),KS=[Zs,Qh,Rd,Ld,Zh,Ac,em,tm,Pl,Bl];function MS(s={}){const e=f(s,"names",{});return new N({name:e.blockName||Zs,value:[new O({optional:!0,name:e.tbsCertListVersion||Qh,value:2}),B.schema(e.signature||{names:{blockName:Rd}}),de.schema(e.issuer||{names:{blockName:Ld}}),$e.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:Zh,generalTimeName:Zh}}),$e.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:Ac,generalTimeName:Ac}},!0),new N({optional:!0,value:[new Z({name:e.tbsCertListRevokedCertificates||em,value:new N({value:[new O,$e.schema(),He.schema({},!0)]})})]}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[He.schema(e.crlExtensions||{names:{blockName:tm}})]})]})}const HS=[Id,Bw,VA,PA,Ow,Cd,xd,BA,OA,Dw];class _e extends T{get tbs(){return ve.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,Zm,_e.defaultValues(Zm))),this.version=f(e,eu,_e.defaultValues(eu)),this.signature=f(e,ef,_e.defaultValues(ef)),this.issuer=f(e,tf,_e.defaultValues(tf)),this.thisUpdate=f(e,sf,_e.defaultValues(sf)),jc in e&&(this.nextUpdate=f(e,jc,_e.defaultValues(jc))),$c in e&&(this.revokedCertificates=f(e,$c,_e.defaultValues($c))),Kc in e&&(this.crlExtensions=f(e,Kc,_e.defaultValues(Kc))),this.signatureAlgorithm=f(e,Pl,_e.defaultValues(Pl)),this.signatureValue=f(e,Bl,_e.defaultValues(Bl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zm:return Me;case eu:return 0;case ef:return new B;case tf:return new de;case sf:return new $e;case jc:return new $e;case $c:return[];case Kc:return new He;case Pl:return new B;case Bl:return new ie;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||"CertificateList",value:[MS(e),B.schema(t.signatureAlgorithm||{names:{blockName:Pl}}),new ie({name:t.signatureValue||Bl})]})}fromSchema(e){L(e,KS);const t=U(e,e,_e.schema());D.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,Qh in t.result&&(this.version=t.result[Qh].valueBlock.valueDec),this.signature=new B({schema:t.result[Rd]}),this.issuer=new de({schema:t.result[Ld]}),this.thisUpdate=new $e({schema:t.result[Zh]}),Ac in t.result&&(this.nextUpdate=new $e({schema:t.result[Ac]})),em in t.result&&(this.revokedCertificates=Array.from(t.result[em],r=>new Vn({schema:r}))),tm in t.result&&(this.crlExtensions=new He({schema:t.result[tm]})),this.signatureAlgorithm=new B({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==_e.defaultValues(eu)&&e.push(new O({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new N({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new N({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return _e.schema();const r=Ke(this.tbsView);D.assert(r,"TBS Certificate Revocation List"),t=r.result}return new N({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:me.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==_e.defaultValues(eu)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",r=se(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),{parameters:n}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ie({valueHex:i})}async verify(e={},t=se(!0)){let r;if(e.issuerCertificate&&(r=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(r=e.publicKeyInfo),!r)throw new Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(const a of this.crlExtensions.extensions)if(a.critical&&!HS.includes(a.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,r,this.signatureAlgorithm)}}_e.CLASS_NAME="CertificateRevocationList";const gi="crlId",wi="crlValue",tu="parsedValue",FS=[gi,wi];class Pn extends T{constructor(e={}){super(),this.crlId=f(e,gi,Pn.defaultValues(gi)),this.crlValue=f(e,wi,Pn.defaultValues(wi)),tu in e&&(this.parsedValue=f(e,tu,Pn.defaultValues(tu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gi:return v;case wi:return new z;case tu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case gi:return t===v;case wi:return t instanceof z;case tu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.id||"id"}),new V({idBlock:{tagClass:3,tagNumber:0},value:[new z({name:t.value||"value"})]})]})}fromSchema(e){L(e,FS);const t=U(e,e,Pn.schema({names:{id:gi,value:wi}}));switch(D.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId){case Yp:this.parsedValue=_e.fromBER(this.certValue.valueBlock.valueHex);break;default:throw new Error("Incorrect CRL_ID value in CRLBag: ".concat(this.crlId))}}toSchema(){return this.parsedValue&&(this.crlId=Yp,this.crlValue=new $({valueHex:this.parsedValue.toSchema().toBER(!1)})),new N({value:[new J({value:this.crlId}),new V({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}Pn.CLASS_NAME="CRLBag";const yi="version",vi="encryptedContentInfo",xr="unprotectedAttrs",JS=[yi,vi,xr];class Ss extends T{constructor(e={}){super(),this.version=f(e,yi,Ss.defaultValues(yi)),this.encryptedContentInfo=f(e,vi,Ss.defaultValues(vi)),xr in e&&(this.unprotectedAttrs=f(e,xr,Ss.defaultValues(xr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yi:return 0;case vi:return new Le;case xr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case yi:return t===0;case vi:return Le.compareWithDefault("contentType",t.contentType)&&Le.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Le.compareWithDefault("encryptedContent",t.encryptedContent);case xr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),Le.schema(t.encryptedContentInfo||{}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Z({name:t.unprotectedAttrs||v,value:be.schema()})]})]})}fromSchema(e){L(e,JS);const t=U(e,e,Ss.schema({names:{version:yi,encryptedContentInfo:{names:{blockName:vi}},unprotectedAttrs:xr}}));D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new Le({schema:t.result.encryptedContentInfo}),xr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,r=>new be({schema:r})))}toSchema(){const e=[];return e.push(new O({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new N({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}async encrypt(e,t=se(!0)){fe.assert(e,"parameters","object");const r=ps(ht({},e),{contentType:"1.2.840.113549.1.7.1"});this.encryptedContentInfo=await t.encryptEncryptedContentInfo(r)}async decrypt(e,t=se(!0)){fe.assert(e,"parameters","object");const r=ps(ht({},e),{encryptedContentInfo:this.encryptedContentInfo});return t.decryptEncryptedContentInfo(r)}}Ss.CLASS_NAME="EncryptedData";const Ya="encryptionAlgorithm",Vr="encryptedData",su="parsedValue",qS=[Ya,Vr];class Yr extends T{constructor(e={}){super(),this.encryptionAlgorithm=f(e,Ya,Yr.defaultValues(Ya)),this.encryptedData=f(e,Vr,Yr.defaultValues(Vr)),su in e&&(this.parsedValue=f(e,su,Yr.defaultValues(su))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ya:return new B;case Vr:return new $;case su:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ya:return B.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Vr:return t.isEqual(Yr.defaultValues(e));case su:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[B.schema(t.encryptionAlgorithm||{names:{blockName:Ya}}),new Ie({value:[new $({name:t.encryptedData||Vr}),new $({idBlock:{isConstructed:!0},name:t.encryptedData||Vr})]})]})}fromSchema(e){L(e,qS);const t=U(e,e,Yr.schema({names:{encryptionAlgorithm:{names:{blockName:Ya}},encryptedData:Vr}}));D.assertSchema(t,this.className),this.encryptionAlgorithm=new B({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new N({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=se(!0)){const r=await new Ss({encryptedContentInfo:new Le({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}).decrypt(e,t);this.parsedValue=Zt.fromBER(r)}async makeInternalValues(e,t=se(!0)){if(!this.parsedValue)throw new Error('Please initialize "parsedValue" first');const r=new Ss,a=ps(ht({},e),{contentToEncrypt:this.parsedValue.toSchema().toBER(!1)});if(await r.encrypt(a,t),!r.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=r.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=r.encryptedContentInfo.encryptedContent}}Yr.CLASS_NAME="PKCS8ShroudedKeyBag";const bi="secretTypeId",Ai="secretValue",_S=[bi,Ai];class Bo extends T{constructor(e={}){super(),this.secretTypeId=f(e,bi,Bo.defaultValues(bi)),this.secretValue=f(e,Ai,Bo.defaultValues(Ai)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bi:return v;case Ai:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bi:return t===v;case Ai:return t instanceof z;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.id||"id"}),new V({idBlock:{tagClass:3,tagNumber:0},value:[new z({name:t.value||"value"})]})]})}fromSchema(e){L(e,_S);const t=U(e,e,Bo.schema({names:{id:bi,value:Ai}}));D.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new N({value:[new J({value:this.secretTypeId}),new V({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}Bo.CLASS_NAME="SecretBag";class Xr{static getItems(){return this.items||(this.items={},Xr.register("1.2.840.113549.1.12.10.1.1",Zt),Xr.register("1.2.840.113549.1.12.10.1.2",Yr),Xr.register("1.2.840.113549.1.12.10.1.3",xn),Xr.register("1.2.840.113549.1.12.10.1.4",Pn),Xr.register("1.2.840.113549.1.12.10.1.5",Bo),Xr.register("1.2.840.113549.1.12.10.1.6",Ws)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}const Qa="bagId",Za="bagValue",Ts="bagAttributes",WS=[Qa,Za,Ts];class ia extends T{constructor(e={}){super(),this.bagId=f(e,Qa,ia.defaultValues(Qa)),this.bagValue=f(e,Za,ia.defaultValues(Za)),Ts in e&&(this.bagAttributes=f(e,Ts,ia.defaultValues(Ts))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qa:return v;case Za:return new z;case Ts:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qa:return t===v;case Za:return t instanceof z;case Ts:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.bagId||Qa}),new V({idBlock:{tagClass:3,tagNumber:0},value:[new z({name:t.bagValue||Za})]}),new Ge({optional:!0,value:[new Z({name:t.bagAttributes||Ts,value:be.schema()})]})]})}fromSchema(e){L(e,WS);const t=U(e,e,ia.schema({names:{bagId:Qa,bagValue:Za,bagAttributes:Ts}}));D.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const r=Xr.find(this.bagId);if(!r)throw new Error("Invalid BAG_ID for SafeBag: ".concat(this.bagId));this.bagValue=new r({schema:t.result.bagValue}),Ts in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new be({schema:a})))}toSchema(){const e=[new J({value:this.bagId}),new V({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new Ge({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new N({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}ia.CLASS_NAME="SafeBag";const Xn="safeBags";class Ws extends T{constructor(e={}){super(),this.safeBags=f(e,Xn,Ws.defaultValues(Xn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Xn:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.safeBags||v,value:ia.schema()})]})}fromSchema(e){L(e,[Xn]);const t=U(e,e,Ws.schema({names:{safeBags:Xn}}));D.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,r=>new ia({schema:r}))}toSchema(){return new N({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}Ws.CLASS_NAME="SafeContents";const Ol="otherCertFormat",Dl="otherCert",GS=[Ol,Dl];class ca extends T{constructor(e={}){super(),this.otherCertFormat=f(e,Ol,ca.defaultValues(Ol)),this.otherCert=f(e,Dl,ca.defaultValues(Dl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ol:return v;case Dl:return new z;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.otherCertFormat||Ol}),new z({name:t.otherCert||Dl})]})}fromSchema(e){L(e,GS);const t=U(e,e,ca.schema());D.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new N({value:[new J({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof z||(e.otherCert=this.otherCert.toJSON()),e}}const Tl="certificates",XS=[Tl];class Ns extends T{constructor(e={}){super(),this.certificates=f(e,Tl,Ns.defaultValues(Tl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new Ge({name:t.blockName||v,value:[new Z({name:t.certificates||Tl,value:new Ie({value:[le.schema(),new V({idBlock:{tagClass:3,tagNumber:0},value:[new z]}),new V({idBlock:{tagClass:3,tagNumber:1},value:[new N]}),new V({idBlock:{tagClass:3,tagNumber:2},value:_t.schema().valueBlock.value}),new V({idBlock:{tagClass:3,tagNumber:3},value:ca.schema().valueBlock.value})]})})]})}fromSchema(e){L(e,XS);const t=U(e,e,Ns.schema());D.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],r=>{const a=r.idBlock.tagNumber;if(r.idBlock.tagClass===1)return new le({schema:r});const n=new N({value:r.valueBlock.value});switch(a){case 1:return n.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec===1?new _t({schema:n}):new qs({schema:n});case 2:return new _t({schema:n});case 3:return new ca({schema:n})}return r})}toSchema(){return new Ge({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof le:return e.toSchema();case e instanceof qs:return new V({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof _t:return new V({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof ca:return new V({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}Ns.CLASS_NAME="CertificateSet";const Rl="otherRevInfoFormat",Ll="otherRevInfo",zS=[Rl,Ll];class zs extends T{constructor(e={}){super(),this.otherRevInfoFormat=f(e,Rl,zs.defaultValues(Rl)),this.otherRevInfo=f(e,Ll,zs.defaultValues(Ll)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rl:return v;case Ll:return new z;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.otherRevInfoFormat||Rl}),new z({name:t.otherRevInfo||Ll})]})}fromSchema(e){L(e,zS);const t=U(e,e,zs.schema());D.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new N({value:[new J({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof z||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}zs.CLASS_NAME="OtherRevocationInfoFormat";const Ul="crls",rf="otherRevocationInfos",YS=[Ul];class Ys extends T{constructor(e={}){super(),this.crls=f(e,Ul,Ys.defaultValues(Ul)),this.otherRevocationInfos=f(e,rf,Ys.defaultValues(rf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ul:return[];case rf:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new Ge({name:t.blockName||v,value:[new Z({name:t.crls||v,value:new Ie({value:[_e.schema(),new V({idBlock:{tagClass:3,tagNumber:1},value:[new J,new z]})]})})]})}fromSchema(e){L(e,YS);const t=U(e,e,Ys.schema({names:{crls:Ul}}));if(D.assertSchema(t,this.className),t.result.crls)for(const r of t.result.crls)r.idBlock.tagClass===1?this.crls.push(new _e({schema:r})):this.otherRevocationInfos.push(new zs({schema:r}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const r=t.toSchema();return r.idBlock.tagClass=3,r.idBlock.tagNumber=1,r})),new Ge({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}Ys.CLASS_NAME="RevocationInfoChoices";const jl="certs",en="crls",QS=[jl,en];class Mn extends T{constructor(e={}){super(),this.crls=f(e,en,Mn.defaultValues(en)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case jl:return new Ns;case en:return new Ys;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case jl:return t.certificates.length===0;case en:return t.crls.length===0&&t.otherRevocationInfos.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new V({name:t.certs||v,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Ns.schema().valueBlock.value}),new V({name:t.crls||v,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Ys.schema().valueBlock.value})]})}fromSchema(e){L(e,QS);const t=U(e,e,Mn.schema({names:{certs:jl,crls:en}}));D.assertSchema(t,this.className),jl in t.result&&(this.certs=new Ns({schema:new Ge({value:t.result.certs.valueBlock.value})})),en in t.result&&(this.crls=new Ys({schema:new Ge({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new V({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new N({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}Mn.CLASS_NAME="OriginatorInfo";const $l="issuer",Kl="serialNumber",ZS=[$l,Kl];class Fe extends T{constructor(e={}){super(),this.issuer=f(e,$l,Fe.defaultValues($l)),this.serialNumber=f(e,Kl,Fe.defaultValues(Kl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $l:return new de;case Kl:return new O;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[de.schema(t.issuer||{}),new O({name:t.serialNumber||v})]})}fromSchema(e){L(e,ZS);const t=U(e,e,Fe.schema({names:{issuer:{names:{blockName:$l}},serialNumber:Kl}}));D.assertSchema(t,this.className),this.issuer=new de({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new N({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}Fe.CLASS_NAME="IssuerAndSerialNumber";const Mc="variant",ru="value",eN=["blockName"];class Oo extends T{constructor(e={}){super(),this.variant=f(e,Mc,Oo.defaultValues(Mc)),ru in e&&(this.value=f(e,ru,Oo.defaultValues(ru))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mc:return-1;case ru:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mc:return t===-1;case ru:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new Ie({value:[Fe.schema({names:{blockName:t.blockName||v}}),new G({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){L(e,eN);const t=U(e,e,Oo.schema({names:{blockName:"blockName"}}));D.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Fe({schema:t.result.blockName})):(this.variant=2,this.value=new $({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof Fe))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof $))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new G({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new z}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&this.value&&(e.value=this.value.toJSON()),e}}Oo.CLASS_NAME="RecipientIdentifier";const tn="version",Si="rid",Ni="keyEncryptionAlgorithm",ki="encryptedKey",Hc="recipientCertificate",tN=[tn,Si,Ni,ki];class Mt extends T{constructor(e={}){super(),this.version=f(e,tn,Mt.defaultValues(tn)),this.rid=f(e,Si,Mt.defaultValues(Si)),this.keyEncryptionAlgorithm=f(e,Ni,Mt.defaultValues(Ni)),this.encryptedKey=f(e,ki,Mt.defaultValues(ki)),this.recipientCertificate=f(e,Hc,Mt.defaultValues(Hc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tn:return-1;case Si:return{};case Ni:return new B;case ki:return new $;case Hc:return new le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case tn:return t===Mt.defaultValues(tn);case Si:return Object.keys(t).length===0;case Ni:case ki:return t.isEqual(Mt.defaultValues(e));case Hc:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),Oo.schema(t.rid||{}),B.schema(t.keyEncryptionAlgorithm||{}),new $({name:t.encryptedKey||v})]})}fromSchema(e){L(e,tN);const t=U(e,e,Mt.schema({names:{version:tn,rid:{names:{blockName:Si}},keyEncryptionAlgorithm:{names:{blockName:Ni}},encryptedKey:ki}}));D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,t.result.rid.idBlock.tagClass===3?this.rid=new $({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new Fe({schema:t.result.rid}),this.keyEncryptionAlgorithm=new B({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof Fe?(this.version=0,e.push(new O({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new O({value:this.version})),e.push(new G({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new N({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Mt.CLASS_NAME="KeyTransRecipientInfo";const Ei="algorithm",Ci="publicKey",sN=[Ei,Ci];class Gs extends T{constructor(e={}){super(),this.algorithm=f(e,Ei,Gs.defaultValues(Ei)),this.publicKey=f(e,Ci,Gs.defaultValues(Ci)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ei:return new B;case Ci:return new ie;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ei:case Ci:return t.isEqual(Gs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[B.schema(t.algorithm||{}),new ie({name:t.publicKey||v})]})}fromSchema(e){L(e,sN);const t=U(e,e,Gs.schema({names:{algorithm:{names:{blockName:Ei}},publicKey:Ci}}));D.assertSchema(t,this.className),this.algorithm=new B({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new N({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}Gs.CLASS_NAME="OriginatorPublicKey";const Fc="variant",au="value",rN=["blockName"];class Qs extends T{constructor(e={}){super(),this.variant=f(e,Fc,Qs.defaultValues(Fc)),au in e&&(this.value=f(e,au,Qs.defaultValues(au))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fc:return-1;case au:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Fc:return t===-1;case au:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new Ie({value:[Fe.schema({names:{blockName:t.blockName||v}}),new G({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||v}),new V({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||v,value:Gs.schema().valueBlock.value})]})}fromSchema(e){L(e,rN);const t=U(e,e,Qs.schema({names:{blockName:"blockName"}}));D.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Fe({schema:t.result.blockName})):t.result.blockName.idBlock.tagNumber===0?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new Gs({schema:new N({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new z}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2||this.variant===3)&&(e.value=this.value.toJSON()),e}}Qs.CLASS_NAME="OriginatorIdentifierOrKey";const Ii="keyAttrId",ws="keyAttr",aN=[Ii,ws];class fs extends T{constructor(e={}){super(),this.keyAttrId=f(e,Ii,fs.defaultValues(Ii)),ws in e&&(this.keyAttr=f(e,ws,fs.defaultValues(ws))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ii:return v;case ws:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ii:return typeof t=="string"&&t===v;case ws:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({optional:t.optional||!0,name:t.blockName||v,value:[new J({name:t.keyAttrId||v}),new z({optional:!0,name:t.keyAttr||v})]})}fromSchema(e){L(e,aN);const t=U(e,e,fs.schema({names:{keyAttrId:Ii,keyAttr:ws}}));D.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),ws in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new J({value:this.keyAttrId})),ws in this&&e.push(this.keyAttr),new N({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return ws in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}fs.CLASS_NAME="OtherKeyAttribute";const sn="subjectKeyIdentifier",Pr="date",Br="other",nN=[sn,Pr,Br];class bs extends T{constructor(e={}){super(),this.subjectKeyIdentifier=f(e,sn,bs.defaultValues(sn)),Pr in e&&(this.date=f(e,Pr,bs.defaultValues(Pr))),Br in e&&(this.other=f(e,Br,bs.defaultValues(Br))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sn:return new $;case Pr:return new Ve;case Br:return new fs;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case sn:return t.isEqual(bs.defaultValues(sn));case Pr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Br:return t.keyAttrId===v&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new $({name:t.subjectKeyIdentifier||v}),new Ve({optional:!0,name:t.date||v}),fs.schema(t.other||{})]})}fromSchema(e){L(e,nN);const t=U(e,e,bs.schema({names:{subjectKeyIdentifier:sn,date:Pr,other:{names:{blockName:Br}}}}));D.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,Pr in t.result&&(this.date=t.result.date),Br in t.result&&(this.other=new fs({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new N({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}bs.CLASS_NAME="RecipientKeyIdentifier";const Jc="variant",qc="value",iN=["blockName"];class ks extends T{constructor(e={}){super(),this.variant=f(e,Jc,ks.defaultValues(Jc)),this.value=f(e,qc,ks.defaultValues(qc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jc:return-1;case qc:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Jc:return t===-1;case qc:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new Ie({value:[Fe.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||v}}),new V({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:0},value:bs.schema(t.rKeyId||{names:{blockName:t.blockName||v}}).valueBlock.value})]})}fromSchema(e){L(e,iN);const t=U(e,e,ks.schema({names:{blockName:"blockName"}}));D.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Fe({schema:t.result.blockName})):(this.variant=2,this.value=new bs({schema:new N({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new V({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new z}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&(e.value=this.value.toJSON()),e}}ks.CLASS_NAME="KeyAgreeRecipientIdentifier";const xi="rid",rn="encryptedKey",oN=[xi,rn];class Xs extends T{constructor(e={}){super(),this.rid=f(e,xi,Xs.defaultValues(xi)),this.encryptedKey=f(e,rn,Xs.defaultValues(rn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xi:return new ks;case rn:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case xi:return t.variant===-1&&!("value"in t);case rn:return t.isEqual(Xs.defaultValues(rn));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[ks.schema(t.rid||{}),new $({name:t.encryptedKey||v})]})}fromSchema(e){L(e,oN);const t=U(e,e,Xs.schema({names:{rid:{names:{blockName:xi}},encryptedKey:rn}}));D.assertSchema(t,this.className),this.rid=new ks({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new N({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Xs.CLASS_NAME="RecipientEncryptedKey";const _c="encryptedKeys",Gw="RecipientEncryptedKeys",uN=[Gw];class ha extends T{constructor(e={}){super(),this.encryptedKeys=f(e,_c,ha.defaultValues(_c)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _c:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case _c:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.RecipientEncryptedKeys||v,value:Xs.schema()})]})}fromSchema(e){L(e,uN);const t=U(e,e,ha.schema({names:{RecipientEncryptedKeys:Gw}}));D.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,r=>new Xs({schema:r}))}toSchema(){return new N({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}ha.CLASS_NAME="RecipientEncryptedKeys";const Vi="version",Pi="originator",Rs="ukm",Bi="keyEncryptionAlgorithm",Oi="recipientEncryptedKeys",Wc="recipientCertificate",Gc="recipientPublicKey",lN=[Vi,Pi,Rs,Bi,Oi];class Rt extends T{constructor(e={}){super(),this.version=f(e,Vi,Rt.defaultValues(Vi)),this.originator=f(e,Pi,Rt.defaultValues(Pi)),Rs in e&&(this.ukm=f(e,Rs,Rt.defaultValues(Rs))),this.keyEncryptionAlgorithm=f(e,Bi,Rt.defaultValues(Bi)),this.recipientEncryptedKeys=f(e,Oi,Rt.defaultValues(Oi)),this.recipientCertificate=f(e,Wc,Rt.defaultValues(Wc)),this.recipientPublicKey=f(e,Gc,Rt.defaultValues(Gc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vi:return 0;case Pi:return new Qs;case Rs:return new $;case Bi:return new B;case Oi:return new ha;case Wc:return new le;case Gc:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vi:return t===0;case Pi:return t.variant===-1&&!("value"in t);case Rs:return t.isEqual(Rt.defaultValues(Rs));case Bi:return t.algorithmId===v&&!("algorithmParams"in t);case Oi:return t.encryptedKeys.length===0;case Wc:return!1;case Gc:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),new V({idBlock:{tagClass:3,tagNumber:0},value:[Qs.schema(t.originator||{})]}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new $({name:t.ukm||v})]}),B.schema(t.keyEncryptionAlgorithm||{}),ha.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){L(e,lN);const t=U(e,e,Rt.schema({names:{version:Vi,originator:{names:{blockName:Pi}},ukm:Rs,keyEncryptionAlgorithm:{names:{blockName:Bi}},recipientEncryptedKeys:{names:{blockName:Oi}}}}));D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new Qs({schema:t.result.originator}),Rs in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new B({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new ha({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new O({value:this.version})),e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new N({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}Rt.CLASS_NAME="KeyAgreeRecipientInfo";const an="keyIdentifier",Or="date",Dr="other",cN=[an,Or,Dr];class cs extends T{constructor(e={}){super(),this.keyIdentifier=f(e,an,cs.defaultValues(an)),Or in e&&(this.date=f(e,Or,cs.defaultValues(Or))),Dr in e&&(this.other=f(e,Dr,cs.defaultValues(Dr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case an:return new $;case Or:return new Ve;case Dr:return new fs;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case an:return t.isEqual(cs.defaultValues(an));case Or:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Dr:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new $({name:t.keyIdentifier||v}),new Ve({optional:!0,name:t.date||v}),fs.schema(t.other||{})]})}fromSchema(e){L(e,cN);const t=U(e,e,cs.schema({names:{keyIdentifier:an,date:Or,other:{names:{blockName:Dr}}}}));D.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,Or in t.result&&(this.date=t.result.date),Dr in t.result&&(this.other=new fs({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new N({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}cs.CLASS_NAME="KEKIdentifier";const Di="version",Ti="kekid",Ri="keyEncryptionAlgorithm",nn="encryptedKey",Xc="preDefinedKEK",hN=[Di,Ti,Ri,nn];class Ht extends T{constructor(e={}){super(),this.version=f(e,Di,Ht.defaultValues(Di)),this.kekid=f(e,Ti,Ht.defaultValues(Ti)),this.keyEncryptionAlgorithm=f(e,Ri,Ht.defaultValues(Ri)),this.encryptedKey=f(e,nn,Ht.defaultValues(nn)),this.preDefinedKEK=f(e,Xc,Ht.defaultValues(Xc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Di:return 0;case Ti:return new cs;case Ri:return new B;case nn:return new $;case Xc:return Me;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===Ht.defaultValues(Di);case Ti:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case Ri:return t.algorithmId===v&&!("algorithmParams"in t);case nn:return t.isEqual(Ht.defaultValues(nn));case Xc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),cs.schema(t.kekid||{}),B.schema(t.keyEncryptionAlgorithm||{}),new $({name:t.encryptedKey||v})]})}fromSchema(e){L(e,hN);const t=U(e,e,Ht.schema({names:{version:Di,kekid:{names:{blockName:Ti}},keyEncryptionAlgorithm:{names:{blockName:Ri}},encryptedKey:nn}}));D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new cs({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new B({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new N({value:[new O({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Ht.CLASS_NAME="KEKRecipientInfo";const Li="version",Tr="keyDerivationAlgorithm",Ui="keyEncryptionAlgorithm",on="encryptedKey",zc="password",mN=[Li,Tr,Ui,on];class Qt extends T{constructor(e={}){super(),this.version=f(e,Li,Qt.defaultValues(Li)),Tr in e&&(this.keyDerivationAlgorithm=f(e,Tr,Qt.defaultValues(Tr))),this.keyEncryptionAlgorithm=f(e,Ui,Qt.defaultValues(Ui)),this.encryptedKey=f(e,on,Qt.defaultValues(on)),this.password=f(e,zc,Qt.defaultValues(zc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Li:return-1;case Tr:return new B;case Ui:return new B;case on:return new $;case zc:return Me;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Li:return t===-1;case Tr:case Ui:return t.algorithmId===v&&!("algorithmParams"in t);case on:return t.isEqual(Qt.defaultValues(on));case zc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),new V({name:t.keyDerivationAlgorithm||v,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:B.schema().valueBlock.value}),B.schema(t.keyEncryptionAlgorithm||{}),new $({name:t.encryptedKey||v})]})}fromSchema(e){L(e,mN);const t=U(e,e,Qt.schema({names:{version:Li,keyDerivationAlgorithm:Tr,keyEncryptionAlgorithm:{names:{blockName:Ui}},encryptedKey:on}}));D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Tr in t.result&&(this.keyDerivationAlgorithm=new B({schema:new N({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new B({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new O({value:this.version})),this.keyDerivationAlgorithm&&e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new N({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}Qt.CLASS_NAME="PasswordRecipientInfo";const ji="oriType",un="oriValue",fN=[ji,un];class oa extends T{constructor(e={}){super(),this.oriType=f(e,ji,oa.defaultValues(ji)),this.oriValue=f(e,un,oa.defaultValues(un)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ji:return v;case un:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ji:return t===v;case un:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.oriType||v}),new z({name:t.oriValue||v})]})}fromSchema(e){L(e,fN);const t=U(e,e,oa.schema({names:{oriType:ji,oriValue:un}}));D.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new N({value:[new J({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return oa.compareWithDefault(un,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}oa.CLASS_NAME="OtherRecipientInfo";const Yc="variant",nu="value",dN=["blockName"];class es extends T{constructor(e={}){super(),this.variant=f(e,Yc,es.defaultValues(Yc)),nu in e&&(this.value=f(e,nu,es.defaultValues(nu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yc:return-1;case nu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yc:return t===es.defaultValues(e);case nu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new Ie({value:[Mt.schema({names:{blockName:t.blockName||v}}),new V({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:1},value:Rt.schema().valueBlock.value}),new V({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:2},value:Ht.schema().valueBlock.value}),new V({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:3},value:Qt.schema().valueBlock.value}),new V({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:4},value:oa.schema().valueBlock.value})]})}fromSchema(e){L(e,dN);const t=U(e,e,es.schema({names:{blockName:"blockName"}}));if(D.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1)this.variant=1,this.value=new Mt({schema:t.result.blockName});else{const r=new N({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new Rt({schema:r});break;case 2:this.variant=3,this.value=new Ht({schema:r});break;case 3:this.variant=4,this.value=new Qt({schema:r});break;case 4:this.variant=5,this.value=new oa({schema:r});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){oe.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new z}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}es.CLASS_NAME="RecipientInfo";const Rr="hashAlgorithm",Lr="maskGenAlgorithm",Ur="pSourceAlgorithm",pN=[Rr,Lr,Ur];class kt extends T{constructor(e={}){super(),this.hashAlgorithm=f(e,Rr,kt.defaultValues(Rr)),this.maskGenAlgorithm=f(e,Lr,kt.defaultValues(Lr)),this.pSourceAlgorithm=f(e,Ur,kt.defaultValues(Ur)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rr:return new B({algorithmId:"1.3.14.3.2.26",algorithmParams:new We});case Lr:return new B({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new B({algorithmId:"1.3.14.3.2.26",algorithmParams:new We}).toSchema()});case Ur:return new B({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new $({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new V({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[B.schema(t.hashAlgorithm||{})]}),new V({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[B.schema(t.maskGenAlgorithm||{})]}),new V({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[B.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){L(e,pN);const t=U(e,e,kt.schema({names:{hashAlgorithm:{names:{blockName:Rr}},maskGenAlgorithm:{names:{blockName:Lr}},pSourceAlgorithm:{names:{blockName:Ur}}}}));D.assertSchema(t,this.className),Rr in t.result&&(this.hashAlgorithm=new B({schema:t.result.hashAlgorithm})),Lr in t.result&&(this.maskGenAlgorithm=new B({schema:t.result.maskGenAlgorithm})),Ur in t.result&&(this.pSourceAlgorithm=new B({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(kt.defaultValues(Rr))||e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(kt.defaultValues(Lr))||e.push(new V({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(kt.defaultValues(Ur))||e.push(new V({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new N({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(kt.defaultValues(Rr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(kt.defaultValues(Lr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(kt.defaultValues(Ur))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}kt.CLASS_NAME="RSAESOAEPParams";const $i="keyInfo",jr="entityUInfo",Ki="suppPubInfo",gN=[$i,jr,Ki];class Hs extends T{constructor(e={}){super(),this.keyInfo=f(e,$i,Hs.defaultValues($i)),jr in e&&(this.entityUInfo=f(e,jr,Hs.defaultValues(jr))),this.suppPubInfo=f(e,Ki,Hs.defaultValues(Ki)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $i:return new B;case jr:return new $;case Ki:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $i:case jr:case Ki:return t.isEqual(Hs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[B.schema(t.keyInfo||{}),new V({name:t.entityUInfo||v,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new $]}),new V({name:t.suppPubInfo||v,idBlock:{tagClass:3,tagNumber:2},value:[new $]})]})}fromSchema(e){L(e,gN);const t=U(e,e,Hs.schema({names:{keyInfo:{names:{blockName:$i}},entityUInfo:jr,suppPubInfo:Ki}}));D.assertSchema(t,this.className),this.keyInfo=new B({schema:t.result.keyInfo}),jr in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new V({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new N({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}Hs.CLASS_NAME="ECCCMSSharedInfo";const Mi="version",$r="originatorInfo",Hi="recipientInfos",Fi="encryptedContentInfo",Kr="unprotectedAttrs",wN=[Mi,$r,Hi,Fi,Kr],pg={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},yN={"P-256":256,"P-384":384,"P-521":528};class us extends T{constructor(e={}){super(),this.version=f(e,Mi,us.defaultValues(Mi)),$r in e&&(this.originatorInfo=f(e,$r,us.defaultValues($r))),this.recipientInfos=f(e,Hi,us.defaultValues(Hi)),this.encryptedContentInfo=f(e,Fi,us.defaultValues(Fi)),Kr in e&&(this.unprotectedAttrs=f(e,Kr,us.defaultValues(Kr))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mi:return 0;case $r:return new Mn;case Hi:return[];case Fi:return new Le;case Kr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mi:return t===us.defaultValues(e);case $r:return t.certs.certificates.length===0&&t.crls.crls.length===0;case Hi:case Kr:return t.length===0;case Fi:return Le.compareWithDefault("contentType",t.contentType)&&Le.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Le.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||v}),new V({name:t.originatorInfo||v,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Mn.schema().valueBlock.value}),new Ge({value:[new Z({name:t.recipientInfos||v,value:es.schema()})]}),Le.schema(t.encryptedContentInfo||{}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Z({name:t.unprotectedAttrs||v,value:be.schema()})]})]})}fromSchema(e){L(e,wN);const t=U(e,e,us.schema({names:{version:Mi,originatorInfo:$r,recipientInfos:Hi,encryptedContentInfo:{names:{blockName:Fi}},unprotectedAttrs:Kr}}));D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,$r in t.result&&(this.originatorInfo=new Mn({schema:new N({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,r=>new es({schema:r})),this.encryptedContentInfo=new Le({schema:t.result.encryptedContentInfo}),Kr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,r=>new be({schema:r})))}toSchema(){const e=[];return e.push(new O({value:this.version})),this.originatorInfo&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new Ge({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new N({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,r,a=se(!0)){const n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},pg,t||{});if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549")!==-1)r=1;else if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045")!==-1)r=2;else throw new Error("Unknown type of certificate's public key: ".concat(e.subjectPublicKeyInfo.algorithm.algorithmId));switch(r){case 1:{let i,o;if(n.useOAEP===!0){i=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const c=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),l=new B({algorithmId:c,algorithmParams:new We});o=new kt({hashAlgorithm:l,maskGenAlgorithm:new B({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:l.toSchema()})}).toSchema()}else{if(i=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),i===v)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");o=new We}const u=new Mt({version:0,rid:new Fe({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new B({algorithmId:i,algorithmParams:o}),recipientCertificate:e});this.recipientInfos.push(new es({variant:1,value:u}))}break;case 2:{const i=new ks({variant:1,value:new Fe({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(i,n,{recipientCertificate:e},a)}break;default:throw new Error('Unknown "variant" value: '.concat(r))}return!0}addRecipientByPreDefinedData(e,t={},r,a=se(!0)){if(fe.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const n=new ArrayBuffer(16),i=new Uint8Array(n);a.getRandomValues(i),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),t.iterationCount===void 0&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new We),r){case 1:{const n=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),i=new Ht({version:4,kekid:new cs({keyIdentifier:new $({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new B({algorithmId:n,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new es({variant:3,value:i}))}break;case 2:{const n=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),i=new ArrayBuffer(64),o=new Uint8Array(i);a.getRandomValues(o);const u=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),c=new wt({salt:new $({valueHex:i}),iterationCount:t.iterationCount,prf:new B({algorithmId:u,algorithmParams:new We})}),l=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),m=new Qt({version:0,keyDerivationAlgorithm:new B({algorithmId:n,algorithmParams:c.toSchema()}),keyEncryptionAlgorithm:new B({algorithmId:l,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new es({variant:4,value:m}))}break;default:throw new Error('Unknown value for "variant": '.concat(r))}}addRecipientByKeyIdentifier(e,t,r,a=se(!0)){const n=Object.assign({},pg,r||{}),i=new ks({variant:2,value:new bs({subjectKeyIdentifier:new $({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,n,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,r,a=se(!0)){const n=new Xs({rid:e}),i=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),o=new B({algorithmId:i}),u=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),c=new ArrayBuffer(64),l=new Uint8Array(c);a.getRandomValues(l);const m={version:3,ukm:new $({valueHex:c}),keyEncryptionAlgorithm:new B({algorithmId:u,algorithmParams:o.toSchema()}),recipientEncryptedKeys:new ha({encryptedKeys:[n]})},h=new Rt(Object.assign(m,r));this.recipientInfos.push(new es({variant:2,value:h}))}async encrypt(e,t,r=se(!0)){const a=new ArrayBuffer(16),n=new Uint8Array(a);r.getRandomValues(n);const i=new Uint8Array(t),o=r.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),u=await r.generateKey(e,!0,["encrypt"]),c=await r.encrypt({name:e.name,iv:n},u,i),l=await r.exportKey("raw",u);this.version=2,this.encryptedContentInfo=new Le({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new B({algorithmId:o,algorithmParams:new $({valueHex:a})}),encryptedContent:new $({valueHex:c})});const m=async d=>{const S=this.recipientInfos[d].value;let A,E;if(S.recipientPublicKey)A=S.recipientPublicKey.algorithm.namedCurve,E=S.recipientPublicKey;else if(S.recipientCertificate){const ue=S.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(ue.constructor.blockName()!==J.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(d));switch(ue.valueBlock.toString()){case"1.2.840.10045.3.1.7":A="P-256";break;case"1.3.132.0.34":A="P-384";break;case"1.3.132.0.35":A="P-521";break;default:throw new Error("Incorrect curve OID for index ".concat(d))}E=await S.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:A},usages:[]}},r)}else throw new Error("Unsupported RecipientInfo");const k=yN[A],I=await r.generateKey({name:"ECDH",namedCurve:A},!0,["deriveBits"]),R=await r.exportKey("spki",I.publicKey),j=await r.deriveBits({name:"ECDH",public:E},I.privateKey,k),K=new B({schema:S.keyEncryptionAlgorithm.algorithmParams}),C=r.getAlgorithmByOID(K.algorithmId,!0,"aesKWAlgorithm");let Y=C.length;const Q=new ArrayBuffer(4),X=new Uint8Array(Q);for(let ue=3;ue>=0;ue--)X[ue]=Y,Y>>=8;const H=new Hs({keyInfo:new B({algorithmId:K.algorithmId}),entityUInfo:S.ukm,suppPubInfo:new $({valueHex:Q})}).toSchema().toBER(!1),ye=r.getAlgorithmByOID(S.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),he=await sg(ye.kdf,j,C.length,H,r),xe=await r.importKey("raw",he,{name:"AES-KW"},!0,["wrapKey"]),W=await r.wrapKey("raw",u,xe,{name:"AES-KW"}),pe=new Qs;return pe.variant=3,pe.value=Gs.fromBER(R),S.originator=pe,S.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new $({valueHex:W}),{ecdhPrivateKey:I.privateKey}},h=async d=>{const S=this.recipientInfos[d].value,A=r.getAlgorithmByOID(S.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(A.name==="RSA-OAEP"){const E=S.keyEncryptionAlgorithm.algorithmParams,k=new kt({schema:E});if(A.hash=r.getAlgorithmByOID(k.hashAlgorithm.algorithmId),!("name"in A.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(k.hashAlgorithm.algorithmId))}try{const E=await S.recipientCertificate.getPublicKey({algorithm:{algorithm:A,usages:["encrypt","wrapKey"]}},r),k=await r.encrypt(E.algorithm,E,l);S.encryptedKey=new $({valueHex:k})}catch(E){}},w=async d=>{const S=this.recipientInfos[d].value,A=r.getAlgorithmByOID(S.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),E=await r.importKey("raw",new Uint8Array(S.preDefinedKEK),A,!0,["wrapKey"]),k=await r.wrapKey("raw",u,E,A);S.encryptedKey=new $({valueHex:k})},g=async d=>{const S=this.recipientInfos[d].value;let A;if(!S.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!S.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{A=new wt({schema:S.keyDerivationAlgorithm.algorithmParams})}catch(Q){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const E=new Uint8Array(S.password),k=await r.importKey("raw",E,"PBKDF2",!1,["deriveKey"]),I=r.getAlgorithmByOID(S.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let R="SHA-1";A.prf&&(R=r.getAlgorithmByOID(A.prf.algorithmId,!0,"prfAlgorithm").hash.name);const j=new Uint8Array(A.salt.valueBlock.valueHex),K=A.iterationCount,C=await r.deriveKey({name:"PBKDF2",hash:{name:R},salt:j,iterations:K},k,I,!0,["wrapKey"]),Y=await r.wrapKey("raw",u,C,I);S.encryptedKey=new $({valueHex:Y})},p=[];for(let d=0;d<this.recipientInfos.length;d++)switch(this.recipientInfos[d].variant){case 1:p.push(await h(d));break;case 2:p.push(await m(d));break;case 3:p.push(await w(d));break;case 4:p.push(await g(d));break;default:throw new Error("Unknown recipient type in array with index ".concat(d))}return p}async decrypt(e,t,r=se(!0)){const a=t||{};if(e+1>this.recipientInfos.length)throw new Error('Maximum value for "index" is: '.concat(this.recipientInfos.length-1));const n=async p=>{const d=this.recipientInfos[p].value;let S,A,E;const k=d.originator;if(a.recipientCertificate){const he=a.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(he.constructor.blockName()!==J.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(p));S=he.valueBlock.toString()}else if(k.value.algorithm.algorithmParams){const he=k.value.algorithm.algorithmParams;if(he.constructor.blockName()!==J.blockName())throw new Error("Incorrect originator for index ".concat(p));S=he.valueBlock.toString()}else throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(S){case"1.2.840.10045.3.1.7":A="P-256",E=256;break;case"1.3.132.0.34":A="P-384",E=384;break;case"1.3.132.0.35":A="P-521",E=528;break;default:throw new Error("Incorrect curve OID for index ".concat(p))}let I,R=r;ve.isBufferSource(a.recipientPrivateKey)?I=await r.importKey("pkcs8",a.recipientPrivateKey,{name:"ECDH",namedCurve:A},!0,["deriveBits"]):(I=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(R=a.crypto.subtle)),"algorithmParams"in k.value.algorithm||(k.value.algorithm.algorithmParams=new J({value:S}));const j=k.value.toSchema().toBER(!1),K=await r.importKey("spki",j,{name:"ECDH",namedCurve:A},!0,[]),C=await R.deriveBits({name:"ECDH",public:K},I,E);async function Y(he){he=he||!1;const xe=new B({schema:d.keyEncryptionAlgorithm.algorithmParams}),W=r.getAlgorithmByOID(xe.algorithmId,!0,"kwAlgorithm");let pe=W.length;const ue=new ArrayBuffer(4),q=new Uint8Array(ue);for(let ae=3;ae>=0;ae--)q[ae]=pe,pe>>=8;const _={algorithmId:xe.algorithmId};he&&(_.algorithmParams=new We);const F=new Hs({keyInfo:new B(_),entityUInfo:d.ukm,suppPubInfo:new $({valueHex:ue})}).toSchema().toBER(!1),ee=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!ee.name)throw new Error("Incorrect OID for key encryption algorithm: ".concat(d.keyEncryptionAlgorithm.algorithmId));return sg(ee.kdf,C,W.length,F,r)}const Q=await Y(),X=async he=>r.importKey("raw",he,{name:"AES-KW"},!0,["unwrapKey"]),H=await X(Q),ye=async he=>{const xe=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,W=r.getAlgorithmByOID(xe,!0,"contentEncryptionAlgorithm");return r.unwrapKey("raw",d.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,he,{name:"AES-KW"},W,!0,["decrypt"])};try{return await ye(H)}catch(he){const xe=await Y(!0),W=await X(xe);return ye(W)}},i=async p=>{const d=this.recipientInfos[p].value;if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const S=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(S.name==="RSA-OAEP"){const j=d.keyEncryptionAlgorithm.algorithmParams,K=new kt({schema:j});if(S.hash=r.getAlgorithmByOID(K.hashAlgorithm.algorithmId),!("name"in S.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(K.hashAlgorithm.algorithmId))}let A,E=r;ve.isBufferSource(a.recipientPrivateKey)?A=await r.importKey("pkcs8",a.recipientPrivateKey,S,!0,["decrypt"]):(A=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(E=a.crypto.subtle));const k=await E.decrypt(A.algorithm,A,d.encryptedKey.valueBlock.valueHexView),I=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,R=r.getAlgorithmByOID(I,!0,"contentEncryptionAlgorithm");if(!("name"in R))throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(I));return r.importKey("raw",k,R,!0,["decrypt"])},o=async p=>{const d=this.recipientInfos[p].value;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const S=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),A=await r.importKey("raw",a.preDefinedData,S,!0,["unwrapKey"]),E=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,k=r.getAlgorithmByOID(E,!0,"contentEncryptionAlgorithm");if(!k.name)throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(E));return r.unwrapKey("raw",d.encryptedKey.valueBlock.valueHexView,A,S,k,!0,["decrypt"])},u=async p=>{const d=this.recipientInfos[p].value;let S;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!d.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!d.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{S=new wt({schema:d.keyDerivationAlgorithm.algorithmParams})}catch(Y){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const A=await r.importKey("raw",a.preDefinedData,"PBKDF2",!1,["deriveKey"]),E=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),k=S.prf?r.getAlgorithmByOID(S.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",I=new Uint8Array(S.salt.valueBlock.valueHex),R=S.iterationCount,j=await r.deriveKey({name:"PBKDF2",hash:{name:k},salt:I,iterations:R},A,E,!0,["unwrapKey"]),K=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,C=r.getAlgorithmByOID(K,!0,"contentEncryptionAlgorithm");return r.unwrapKey("raw",d.encryptedKey.valueBlock.valueHexView,j,E,C,!0,["decrypt"])};let c;switch(this.recipientInfos[e].variant){case 1:c=await i(e);break;case 2:c=await n(e);break;case 3:c=await o(e);break;case 4:c=await u(e);break;default:throw new Error("Unknown recipient type in array with index ".concat(e))}const l=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,m=r.getAlgorithmByOID(l,!0,"contentEncryptionAlgorithm"),h=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,w=new Uint8Array(h);if(!this.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const g=this.encryptedContentInfo.getEncryptedContent();return r.decrypt({name:m.name,iv:w},c,g)}}us.CLASS_NAME="EnvelopedData";const zn="safeContents",iu="parsedValue",gg="contentInfos";class Hn extends T{constructor(e={}){super(),this.safeContents=f(e,zn,Hn.defaultValues(zn)),iu in e&&(this.parsedValue=f(e,iu,Hn.defaultValues(iu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zn:return[];case iu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zn:return t.length===0;case iu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new Z({name:t.contentInfos||v,value:we.schema()})]})}fromSchema(e){L(e,[gg]);const t=U(e,e,Hn.schema({names:{contentInfos:gg}}));D.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,r=>new we({schema:r}))}toSchema(){return new N({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=se(!0)){if(oe.assert(e,zn),fe.assert(e.safeContents,zn,"Array"),e.safeContents.length!==this.safeContents.length)throw new fe('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');this.parsedValue={safeContents:[]};for(const[r,a]of this.safeContents.entries()){const n=e.safeContents[r],i="parameters.safeContents[".concat(r,"]");switch(a.contentType){case Vd:{fe.assert(a.content,"this.safeContents[j].content",$);const o=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:Ws.fromBER(o)})}break;case Kw:{const o=new us({schema:a.content});oe.assert(i,n,"recipientCertificate","recipientKey");const u=n,c=u.recipientCertificate,l=u.recipientKey,m=await o.decrypt(0,{recipientCertificate:c,recipientPrivateKey:l},t);this.parsedValue.safeContents.push({privacyMode:2,value:Ws.fromBER(m)})}break;case Mw:{const o=new Ss({schema:a.content});oe.assert(i,n,"password");const u=n.password,c=await o.decrypt({password:u},t);this.parsedValue.safeContents.push({privacyMode:1,value:Ws.fromBER(c)})}break;default:throw new Error('Unknown "contentType" for AuthenticatedSafe: " '.concat(a.contentType))}}}async makeInternalValues(e,t=se(!0)){if(!this.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(fe.assert(this.parsedValue,"this.parsedValue","object"),fe.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),fe.assert(e,"parameters","object"),oe.assert(e,"safeContents"),fe.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new fe('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');this.safeContents=[];for(const[r,a]of this.parsedValue.safeContents.entries())switch(oe.assert("content",a,"privacyMode","value"),fe.assert(a.value,"content.value",Ws),a.privacyMode){case 0:{const n=a.value.toSchema().toBER(!1);this.safeContents.push(new we({contentType:"1.2.840.113549.1.7.1",content:new $({valueHex:n})}))}break;case 1:{const n=new Ss,i=e.safeContents[r];i.contentToEncrypt=a.value.toSchema().toBER(!1),await n.encrypt(i,t),this.safeContents.push(new we({contentType:"1.2.840.113549.1.7.6",content:n.toSchema()}))}break;case 2:{const n=new us,i=a.value.toSchema().toBER(!1),o=e.safeContents[r];switch(oe.assert("parameters.safeContents[".concat(r,"]"),o,"encryptingCertificate","encryptionAlgorithm"),!0){case o.encryptionAlgorithm.name.toLowerCase()==="aes-cbc":case o.encryptionAlgorithm.name.toLowerCase()==="aes-gcm":break;default:throw new Error('Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": '.concat(o.encryptionAlgorithm))}switch(!0){case o.encryptionAlgorithm.length===128:case o.encryptionAlgorithm.length===192:case o.encryptionAlgorithm.length===256:break;default:throw new Error('Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": '.concat(o.encryptionAlgorithm.length))}const u=o.encryptionAlgorithm;n.addRecipientByCertificate(o.encryptingCertificate,{},void 0,t),await n.encrypt(u,i,t),this.safeContents.push(new we({contentType:"1.2.840.113549.1.7.3",content:n.toSchema()}))}break;default:throw new Error('Incorrect value for "content.privacyMode": '.concat(a.privacyMode))}return this}}Hn.CLASS_NAME="AuthenticatedSafe";const ln="hashAlgorithm",Ji="issuerNameHash",qi="issuerKeyHash",cn="serialNumber",vN=[ln,Ji,qi,cn];class je extends T{static async create(e,t,r=se(!0)){const a=new je;return await a.createForCertificate(e,t,r),a}constructor(e={}){super(),this.hashAlgorithm=f(e,ln,je.defaultValues(ln)),this.issuerNameHash=f(e,Ji,je.defaultValues(Ji)),this.issuerKeyHash=f(e,qi,je.defaultValues(qi)),this.serialNumber=f(e,cn,je.defaultValues(cn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ln:return new B;case Ji:case qi:return new $;case cn:return new O;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ln:return t.algorithmId===v&&!("algorithmParams"in t);case Ji:case qi:case cn:return t.isEqual(je.defaultValues(cn));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[B.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||v}}),new $({name:t.issuerNameHash||v}),new $({name:t.issuerKeyHash||v}),new O({name:t.serialNumber||v})]})}fromSchema(e){L(e,vN);const t=U(e,e,je.schema({names:{hashAlgorithm:ln,issuerNameHash:Ji,issuerKeyHash:qi,serialNumber:cn}}));D.assertSchema(t,this.className),this.hashAlgorithm=new B({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new N({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!ve.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!ve.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,r=se(!0)){oe.assert(t,ln,"issuerCertificate");const a=r.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new B({algorithmId:a,algorithmParams:new We});const n=t.issuerCertificate;this.serialNumber=e.serialNumber;const i=await r.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1));this.issuerNameHash=new $({valueHex:i});const o=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,u=await r.digest({name:t.hashAlgorithm},o);this.issuerKeyHash=new $({valueHex:u})}}je.CLASS_NAME="CertID";const _i="certID",Wi="certStatus",Gi="thisUpdate",Mr="nextUpdate",hn="singleExtensions",bN=[_i,Wi,Gi,Mr,hn];class ls extends T{constructor(e={}){super(),this.certID=f(e,_i,ls.defaultValues(_i)),this.certStatus=f(e,Wi,ls.defaultValues(Wi)),this.thisUpdate=f(e,Gi,ls.defaultValues(Gi)),Mr in e&&(this.nextUpdate=f(e,Mr,ls.defaultValues(Mr))),hn in e&&(this.singleExtensions=f(e,hn,ls.defaultValues(hn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _i:return new je;case Wi:return{};case Gi:case Mr:return new Date(0,0,0);case hn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case _i:return je.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&je.compareWithDefault("issuerNameHash",t.issuerNameHash)&&je.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&je.compareWithDefault("serialNumber",t.serialNumber);case Wi:return Object.keys(t).length===0;case Gi:case Mr:return t===ls.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[je.schema(t.certID||{}),new Ie({value:[new G({name:t.certStatus||v,idBlock:{tagClass:3,tagNumber:0}}),new V({name:t.certStatus||v,idBlock:{tagClass:3,tagNumber:1},value:[new Ve,new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new fc]})]}),new G({name:t.certStatus||v,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new Ve({name:t.thisUpdate||v}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ve({name:t.nextUpdate||v})]}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[He.schema(t.singleExtensions||{})]})]})}fromSchema(e){L(e,bN);const t=U(e,e,ls.schema({names:{certID:{names:{blockName:_i}},certStatus:Wi,thisUpdate:Gi,nextUpdate:Mr,singleExtensions:{names:{blockName:hn}}}}));D.assertSchema(t,this.className),this.certID=new je({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),Mr in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),hn in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,r=>new Ue({schema:r})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new Ve({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[new Ve({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new N({value:Array.from(this.singleExtensions,t=>t.toSchema())})),new N({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}ls.CLASS_NAME="SingleResponse";const Qc="tbs",mn="version",Ml="responderID",Hl="producedAt",Fl="responses",Xi="responseExtensions",Jn="ResponseData",dh="".concat(Jn,".").concat(mn),zi="".concat(Jn,".").concat(Ml),Hf="".concat(Jn,".").concat(Hl),Ff="".concat(Jn,".").concat(Fl),ph="".concat(Jn,".").concat(Xi),AN=[Jn,dh,zi,Hf,Ff,ph];class Qe extends T{get tbs(){return ve.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,Qc,Qe.defaultValues(Qc))),mn in e&&(this.version=f(e,mn,Qe.defaultValues(mn))),this.responderID=f(e,Ml,Qe.defaultValues(Ml)),this.producedAt=f(e,Hl,Qe.defaultValues(Hl)),this.responses=f(e,Fl,Qe.defaultValues(Fl)),Xi in e&&(this.responseExtensions=f(e,Xi,Qe.defaultValues(Xi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mn:return 0;case Qc:return Me;case Ml:return{};case Hl:return new Date(0,0,0);case Fl:case Xi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qc:return t.byteLength===0;case Ml:return Object.keys(t).length===0;case Hl:return t===Qe.defaultValues(e);case Fl:case Xi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||Jn,value:[new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({name:t.version||dh})]}),new Ie({value:[new V({name:t.responderID||zi,idBlock:{tagClass:3,tagNumber:1},value:[de.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new V({name:t.responderID||zi,idBlock:{tagClass:3,tagNumber:2},value:[new $({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new Ve({name:t.producedAt||Hf}),new N({value:[new Z({name:Ff,value:ls.schema(t.response||{})})]}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[He.schema(t.extensions||{names:{blockName:ph}})]})]})}fromSchema(e){L(e,AN);const t=U(e,e,Qe.schema());D.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,dh in t.result&&(this.version=t.result[dh].valueBlock.valueDec),t.result[zi].idBlock.tagNumber===1?this.responderID=new de({schema:t.result[zi].valueBlock.value[0]}):this.responderID=t.result[zi].valueBlock.value[0],this.producedAt=t.result[Hf].toDate(),this.responses=Array.from(t.result[Ff],r=>new ls({schema:r})),ph in t.result&&(this.responseExtensions=Array.from(t.result[ph].valueBlock.value,r=>new Ue({schema:r})))}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return Qe.schema();const r=Ke(this.tbsView);D.assert(r,"TBS Response Data"),t=r.result}else{const r=[];mn in this&&r.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[new O({value:this.version})]})),this.responderID instanceof de?r.push(new V({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):r.push(new V({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),r.push(new Ve({valueDate:this.producedAt})),r.push(new N({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&r.push(new V({idBlock:{tagClass:3,tagNumber:1},value:[new N({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new N({value:r})}return t}toJSON(){const e={};return mn in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}Qe.CLASS_NAME="ResponseData";const af="trustedCerts",nf="certs",of="crls",uf="ocsps",lf="checkDate",cf="findOrigin",hf="findIssuer";var Nn;(function(s){s[s.unknown=-1]="unknown",s[s.success=0]="success",s[s.noRevocation=11]="noRevocation",s[s.noPath=60]="noPath",s[s.noValidPath=97]="noValidPath"})(Nn||(Nn={}));class Qr extends Error{constructor(e,t){super(t),this.name=Qr.NAME,this.code=e,this.message=t}}Qr.NAME="ChainValidationError";function SN(s,e){for(let t=0;t<e.length;t++)if(ve.isEqual(s.tbsView,e[t].tbsView))return!0;return!1}class hm{constructor(e={}){this.trustedCerts=f(e,af,this.defaultValues(af)),this.certs=f(e,nf,this.defaultValues(nf)),this.crls=f(e,of,this.defaultValues(of)),this.ocsps=f(e,uf,this.defaultValues(uf)),this.checkDate=f(e,lf,this.defaultValues(lf)),this.findOrigin=f(e,cf,this.defaultValues(cf)),this.findIssuer=f(e,hf,this.defaultValues(hf))}static defaultFindOrigin(e,t){e.tbsView.byteLength===0&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));for(const r of t.certs)if(r.tbsView.byteLength===0&&(r.tbsView=new Uint8Array(r.encodeTBS().toBER())),ve.isEqual(e.tbsView,r.tbsView))return"Intermediate Certificates";for(const r of t.trustedCerts)if(r.tbsView.byteLength===0&&(r.tbsView=new Uint8Array(r.encodeTBS().toBER())),ve.isEqual(e.tbsView,r.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,r=se(!0)){const a=[];let n=null,i=null,o=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,r))return[e]}catch(c){}if(e.extensions){for(const c of e.extensions)if(c.extnID===Id&&c.parsedValue instanceof ra){c.parsedValue.keyIdentifier?n=c.parsedValue.keyIdentifier:(c.parsedValue.authorityCertIssuer&&(i=c.parsedValue.authorityCertIssuer),c.parsedValue.authorityCertSerialNumber&&(o=c.parsedValue.authorityCertSerialNumber));break}}function u(c){if(n!==null&&c.extensions){let m=!1;for(const h of c.extensions)if(h.extnID===CA&&h.parsedValue){m=!0,ve.isEqual(h.parsedValue.valueBlock.valueHex,n.valueBlock.valueHexView)&&a.push(c);break}if(m)return}let l=!1;o!==null&&(l=c.serialNumber.isEqual(o)),i!==null?c.subject.isEqual(i)&&l&&a.push(c):e.issuer.isEqual(c.subject)&&a.push(c)}for(const c of t.trustedCerts)u(c);for(const c of t.certs)u(c);for(let c=a.length-1;c>=0;c--)try{await e.verify(a[c],r)===!1&&a.splice(c,1)}catch(l){a.splice(c,1)}return a}defaultValues(e){switch(e){case af:return[];case nf:return[];case of:return[];case uf:return[];case lf:return new Date;case cf:return hm.defaultFindOrigin;case hf:return this.defaultFindIssuer;default:throw new Error("Invalid member name for CertificateChainValidationEngine class: ".concat(e))}}async sort(e=!1,t=se(!0)){const r=[],a=async(g,p)=>{const d=[];function S(E){let k=!0;for(let I=0;I<E.length;I++){for(let R=0;R<E.length;R++)if(R!==I&&E[I]===E[R]){k=!1;break}if(!k)break}return k}if(SN(g,this.trustedCerts))return[[g]];const A=await this.findIssuer(g,this,p);if(A.length===0)throw new Error("No valid certificate paths found");for(let E=0;E<A.length;E++){if(ve.isEqual(A[E].tbsView,g.tbsView)){d.push([A[E]]);continue}const k=await a(A[E],p);for(let I=0;I<k.length;I++){const R=k[I].slice();R.splice(0,0,A[E]),S(R)?d.push(R):d.push(k[I])}}return d},n=async g=>{const p=[],d=[],S=[];if(p.push(...r.filter(A=>g.issuer.isEqual(A.subject))),p.length===0)return{status:1,statusMessage:"No certificate's issuers"};if(d.push(...this.crls.filter(A=>A.issuer.isEqual(g.issuer))),d.length===0)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let A=0;A<d.length;A++){const E=d[A];if(!(E.nextUpdate&&E.nextUpdate.value<this.checkDate))for(let k=0;k<p.length;k++)try{if(await d[A].verify({issuerCertificate:p[k]},t)){S.push({crl:d[A],certificate:p[k]});break}}catch(I){}}return S.length?{status:0,statusMessage:v,result:S}:{status:3,statusMessage:"No valid CRLs found"}},i=async(g,p)=>{const d=t.getAlgorithmByOID(g.signatureAlgorithm.algorithmId);if(!d.name||!d.hash)return 1;for(let S=0;S<this.ocsps.length;S++){const A=await this.ocsps[S].getCertificateStatus(g,p,t);if(A.isForCertificate)return A.status===0?0:1}return 2};async function o(g,p=!1){let d=!1,S=!1,A=!1,E=!1;if(g.extensions){for(let k=0;k<g.extensions.length;k++){const I=g.extensions[k];if(I.critical&&!I.parsedValue)return{result:!1,resultCode:6,resultMessage:"Unable to parse critical certificate extension: ".concat(I.extnID)};if(I.extnID===IA){A=!0;const R=new Uint8Array(I.parsedValue.valueBlock.valueHex);(R[0]&4)===4&&(S=!0),(R[0]&2)===2&&(E=!0)}I.extnID===Ed&&"cA"in I.parsedValue&&I.parsedValue.cA===!0&&(d=!0)}if(S===!0&&d===!1)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(A===!0&&d===!0&&S===!1)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(d===!0&&A===!0&&p&&E===!1)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return d===!1?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:v}}const u=async(g,p)=>{for(let d=0;d<g.length;d++)if(g[d].notBefore.value>p||g[d].notAfter.value<p)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(g.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let d=g.length-2;d>=0;d--)if(g[d].issuer.isEqual(g[d].subject)===!1&&g[d].issuer.isEqual(g[d+1].subject)===!1)return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(this.crls.length!==0||this.ocsps.length!==0)for(let d=0;d<g.length-1;d++){let S=2,A={status:0,statusMessage:v};if(this.ocsps.length!==0)switch(S=await i(g[d],g[d+1]),S){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(this.crls.length!==0){if(A=await n(g[d]),A.status===0&&A.result)for(let E=0;E<A.result.length;E++){if(A.result[E].crl.isCertificateRevoked(g[d]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if((await o(A.result[E].certificate,!0)).result===!1)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(e===!1)throw new Qr(Nn.noRevocation,"No revocation values found for one of certificates: ".concat(A.statusMessage))}else if(S===2)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(S===2&&A.status===2&&e){const E=g[d+1];let k=!1;if(E.extensions)for(const I of E.extensions)switch(I.extnID){case Rw:case Cd:case xd:k=!0;break}if(k)throw new Qr(Nn.noRevocation,"No revocation values found for one of certificates: ".concat(A.statusMessage))}}for(const[d,S]of g.entries())if(d&&!(await o(S)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}};r.push(...this.trustedCerts),r.push(...this.certs);for(let g=0;g<r.length;g++)for(let p=0;p<r.length;p++)if(g!==p&&ve.isEqual(r[g].tbsView,r[p].tbsView)){r.splice(p,1),g=0;break}const c=r[r.length-1];let l;const m=[c];if(l=await a(c,t),l.length===0)throw new Qr(Nn.noPath,"Unable to find certificate path");for(let g=l.length-1;g>=0;g--){let p=!1;for(let d=0;d<l[g].length;d++){const S=l[g][d];for(let A=0;A<this.trustedCerts.length;A++)if(ve.isEqual(S.tbsView,this.trustedCerts[A].tbsView)){p=!0;break}if(p)break}p||l.splice(g,1)}if(l.length===0)throw new Qr(Nn.noValidPath,"No valid certificate paths found");let h=l[0].length,w=0;for(let g=0;g<l.length;g++)l[g].length<h&&(h=l[g].length,w=g);for(let g=0;g<l[w].length;g++)m.push(l[w][g]);if(l=await u(m,this.checkDate),l.result===!1)throw l;return m}async verify(e={},t=se(!0)){function r(u,c){const l=Gr(u),m=Gr(c),h=l.split("."),w=m.split("."),g=h.length,p=w.length;if(g===0||p===0||g<p)return!1;for(let d=0;d<g;d++)if(h[d].length===0)return!1;for(let d=0;d<p;d++)if(w[d].length===0){if(d===0){if(p===1)return!1;continue}return!1}for(let d=0;d<p;d++)if(w[p-1-d].length!==0&&h[g-1-d].localeCompare(w[p-1-d])!==0)return!1;return!0}function a(u,c){const l=Gr(u),m=Gr(c),h=l.split("@"),w=m.split("@");if(h.length===0||w.length===0||h.length<w.length)return!1;if(w.length===1){if(r(h[1],w[0])){const g=h[1].split("."),p=w[0].split(".");return p[0].length===0?!0:g.length===p.length}return!1}return l.localeCompare(m)===0}function n(u,c){let l=Gr(u);const m=Gr(c),h=l.split("/");if(m.split("/").length>1)return!1;if(h.length>1){for(let w=0;w<h.length;w++)if(h[w].length>0&&h[w].charAt(h[w].length-1)!==":"){l=h[w].split(":")[0];break}}if(r(l,m)){const w=l.split("."),g=m.split(".");return g[0].length===0?!0:w.length===g.length}return!1}function i(u,c){const l=u.valueBlock.valueHexView,m=c.valueBlock.valueHexView;if(l.length===4&&m.length===8){for(let h=0;h<4;h++)if((l[h]^m[h])&m[h+4])return!1;return!0}if(l.length===16&&m.length===32){for(let h=0;h<16;h++)if((l[h]^m[h])&m[h+16])return!1;return!0}return!1}function o(u,c){if(u.typesAndValues.length===0||c.typesAndValues.length===0)return!0;if(u.typesAndValues.length<c.typesAndValues.length)return!1;let l=!0,m=0;for(let h=0;h<c.typesAndValues.length;h++){let w=!1;for(let g=m;g<u.typesAndValues.length;g++)if(w=u.typesAndValues[g].isEqual(c.typesAndValues[h]),u.typesAndValues[g].type===c.typesAndValues[h].type&&(l=l&&w),w===!0)if(m===0||m===g){m=g+1;break}else return!1;if(w===!1)return!1}return m===0?!1:l}try{if(this.certs.length===0)throw new Error("Empty certificate array");const u=e.passedWhenNotRevValues||!1,c=e.initialPolicySet||[Xt],l=e.initialExplicitPolicy||!1,m=e.initialPolicyMappingInhibit||!1,h=e.initialInhibitPolicy||!1,w=e.initialPermittedSubtreesSet||[],g=e.initialExcludedSubtreesSet||[],p=e.initialRequiredNameForms||[];let d=l,S=m,A=h;const E=[!1,!1,!1];let k=0,I=0,R=0,j=w,K=g;const C=p;let Y=1;this.certs=await this.sort(u,t);const Q=[];Q.push(Xt);const X=[],H=new Array(this.certs.length-1);for(let q=0;q<this.certs.length-1;q++)H[q]=!0;X.push(H);const ye=new Array(this.certs.length-1),he=new Array(this.certs.length-1);let xe=d?this.certs.length-1:-1;for(let q=this.certs.length-2;q>=0;q--,Y++){const _=this.certs[q];if(_.extensions){for(let F=0;F<_.extensions.length;F++){const ee=_.extensions[F];if(ee.extnID===Lw){he[q]=ee.parsedValue;for(let ae=0;ae<Q.length;ae++)if(Q[ae]===Xt){delete X[ae][q];break}for(let ae=0;ae<ee.parsedValue.certificatePolicies.length;ae++){let Ae=-1;const $t=ee.parsedValue.certificatePolicies[ae].policyIdentifier;for(let b=0;b<Q.length;b++)if($t===Q[b]){Ae=b;break}if(Ae===-1){Q.push($t);const b=new Array(this.certs.length-1);b[q]=!0,X.push(b)}else X[Ae][q]=!0}}if(ee.extnID===Uw){if(S)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};ye[q]=ee.parsedValue}ee.extnID===jw&&d===!1&&(ee.parsedValue.requireExplicitPolicy===0?(d=!0,xe=q):E[0]===!1?(E[0]=!0,k=ee.parsedValue.requireExplicitPolicy):k=k>ee.parsedValue.requireExplicitPolicy?ee.parsedValue.requireExplicitPolicy:k,ee.parsedValue.inhibitPolicyMapping===0?S=!0:E[1]===!1?(E[1]=!0,I=ee.parsedValue.inhibitPolicyMapping+1):I=I>ee.parsedValue.inhibitPolicyMapping+1?ee.parsedValue.inhibitPolicyMapping+1:I),ee.extnID===RA&&A===!1&&(ee.parsedValue.valueBlock.valueDec===0?A=!0:E[2]===!1?(E[2]=!0,R=ee.parsedValue.valueBlock.valueDec):R=R>ee.parsedValue.valueBlock.valueDec?ee.parsedValue.valueBlock.valueDec:R)}if(A===!0){let F=-1;for(let ee=0;ee<Q.length;ee++)if(Q[ee]===Xt){F=ee;break}F!==-1&&delete X[0][q]}d===!1&&E[0]===!0&&(k--,k===0&&(d=!0,xe=q,E[0]=!1)),S===!1&&E[1]===!0&&(I--,I===0&&(S=!0,E[1]=!1)),A===!1&&E[2]===!0&&(R--,R===0&&(A=!0,E[2]=!1))}}for(let q=0;q<this.certs.length-1;q++)if(q<this.certs.length-2&&typeof ye[q+1]<"u")for(let _=0;_<ye[q+1].mappings.length;_++){if(ye[q+1].mappings[_].issuerDomainPolicy===Xt||ye[q+1].mappings[_].subjectDomainPolicy===Xt)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let F=-1,ee=-1;for(let ae=0;ae<Q.length;ae++)Q[ae]===ye[q+1].mappings[_].issuerDomainPolicy&&(F=ae),Q[ae]===ye[q+1].mappings[_].subjectDomainPolicy&&(ee=ae);typeof X[F][q]<"u"&&delete X[F][q];for(let ae=0;ae<he[q].certificatePolicies.length;ae++)if(ye[q+1].mappings[_].subjectDomainPolicy===he[q].certificatePolicies[ae].policyIdentifier&&F!==-1&&ee!==-1)for(let Ae=0;Ae<=q;Ae++)typeof X[ee][Ae]<"u"&&(X[F][Ae]=!0,delete X[ee][Ae])}for(let q=0;q<Q.length;q++)if(Q[q]===Xt)for(let _=0;_<xe;_++)delete X[q][_];const W=[];for(let q=0;q<X.length;q++){let _=!0;for(let F=0;F<this.certs.length-1;F++){let ee=!1;if(F<xe&&Q[q]===Xt&&Q.length>1){_=!1;break}if(typeof X[q][F]>"u"){if(F>=xe){for(let ae=0;ae<Q.length;ae++)if(Q[ae]===Xt){X[ae][F]===!0&&(ee=!0);break}}if(!ee){_=!1;break}}}_===!0&&W.push(Q[q])}let pe=[];if(c.length===1&&c[0]===Xt&&d===!1)pe=c;else if(W.length===1&&W[0]===Xt)pe=c;else for(let q=0;q<W.length;q++)for(let _=0;_<c.length;_++)if(c[_]===W[q]||c[_]===Xt){pe.push(W[q]);break}const ue={result:pe.length>0,resultCode:0,resultMessage:pe.length>0?v:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:W,userConstrPolicies:pe,explicitPolicyIndicator:d,policyMappings:ye,certificatePath:this.certs};if(pe.length===0||ue.result===!1)return ue;Y=1;for(let q=this.certs.length-2;q>=0;q--,Y++){const _=this.certs[q];let F=[],ee=[],ae=[];if(_.extensions)for(let y=0;y<_.extensions.length;y++){const P=_.extensions[y];P.extnID===Tw&&("permittedSubtrees"in P.parsedValue&&(ee=ee.concat(P.parsedValue.permittedSubtrees)),"excludedSubtrees"in P.parsedValue&&(ae=ae.concat(P.parsedValue.excludedSubtrees))),P.extnID===Pw&&(F=F.concat(P.parsedValue.altNames))}let Ae=C.length<=0;for(let y=0;y<C.length;y++)switch(C[y].base.type){case 4:{if(C[y].base.value.typesAndValues.length!==_.subject.typesAndValues.length)continue;Ae=!0;for(let P=0;P<_.subject.typesAndValues.length;P++)if(_.subject.typesAndValues[P].type!==C[y].base.value.typesAndValues[P].type){Ae=!1;break}if(Ae===!0)break}break;default:}if(Ae===!1)throw ue.result=!1,ue.resultCode=21,ue.resultMessage="No necessary name form found",ue;const $t=[[],[],[],[],[]];for(let y=0;y<j.length;y++)switch(j[y].base.type){case 1:$t[0].push(j[y]);break;case 2:$t[1].push(j[y]);break;case 4:$t[2].push(j[y]);break;case 6:$t[3].push(j[y]);break;case 7:$t[4].push(j[y]);break;default:}for(let y=0;y<5;y++){let P=!1,x=!1;const ne=$t[y];for(let ge=0;ge<ne.length;ge++){switch(y){case 0:if(F.length>0)for(let te=0;te<F.length;te++)F[te].type===1&&(x=!0,P=P||a(F[te].value,ne[ge].base.value));else for(let te=0;te<_.subject.typesAndValues.length;te++)(_.subject.typesAndValues[te].type==="1.2.840.113549.1.9.1"||_.subject.typesAndValues[te].type==="0.9.2342.19200300.100.1.3")&&(x=!0,P=P||a(_.subject.typesAndValues[te].value.valueBlock.value,ne[ge].base.value));break;case 1:if(F.length>0)for(let te=0;te<F.length;te++)F[te].type===2&&(x=!0,P=P||r(F[te].value,ne[ge].base.value));break;case 2:x=!0,P=o(_.subject,ne[ge].base.value);break;case 3:if(F.length>0)for(let te=0;te<F.length;te++)F[te].type===6&&(x=!0,P=P||n(F[te].value,ne[ge].base.value));break;case 4:if(F.length>0)for(let te=0;te<F.length;te++)F[te].type===7&&(x=!0,P=P||i(F[te].value,ne[ge].base.value));break;default:}if(P)break}if(P===!1&&ne.length>0&&x)throw ue.result=!1,ue.resultCode=41,ue.resultMessage='Failed to meet "permitted sub-trees" name constraint',ue}let b=!1;for(let y=0;y<K.length;y++){switch(K[y].base.type){case 1:if(F.length>=0)for(let P=0;P<F.length;P++)F[P].type===1&&(b=b||a(F[P].value,K[y].base.value));else for(let P=0;P<_.subject.typesAndValues.length;P++)(_.subject.typesAndValues[P].type==="1.2.840.113549.1.9.1"||_.subject.typesAndValues[P].type==="0.9.2342.19200300.100.1.3")&&(b=b||a(_.subject.typesAndValues[P].value.valueBlock.value,K[y].base.value));break;case 2:if(F.length>0)for(let P=0;P<F.length;P++)F[P].type===2&&(b=b||r(F[P].value,K[y].base.value));break;case 4:b=b||o(_.subject,K[y].base.value);break;case 6:if(F.length>0)for(let P=0;P<F.length;P++)F[P].type===6&&(b=b||n(F[P].value,K[y].base.value));break;case 7:if(F.length>0)for(let P=0;P<F.length;P++)F[P].type===7&&(b=b||i(F[P].value,K[y].base.value));break;default:}if(b)break}if(b===!0)throw ue.result=!1,ue.resultCode=42,ue.resultMessage='Failed to meet "excluded sub-trees" name constraint',ue;j=j.concat(ee),K=K.concat(ae)}return ue}catch(u){return u instanceof Error?u instanceof Qr?{result:!1,resultCode:u.code,resultMessage:u.message,error:u}:{result:!1,resultCode:Nn.unknown,resultMessage:u.message,error:u}:u&&typeof u=="object"&&"resultMessage"in u?u:{result:!1,resultCode:-1,resultMessage:"".concat(u)}}}}const gh="tbsResponseData",Jl="signatureAlgorithm",ql="signature",Yi="certs",kc="BasicOCSPResponse",Jf="".concat(kc,".").concat(gh),qf="".concat(kc,".").concat(Jl),_f="".concat(kc,".").concat(ql),wh="".concat(kc,".").concat(Yi),NN=[Jf,qf,_f,wh];class ts extends T{constructor(e={}){super(),this.tbsResponseData=f(e,gh,ts.defaultValues(gh)),this.signatureAlgorithm=f(e,Jl,ts.defaultValues(Jl)),this.signature=f(e,ql,ts.defaultValues(ql)),Yi in e&&(this.certs=f(e,Yi,ts.defaultValues(Yi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gh:return new Qe;case Jl:return new B;case ql:return new ie;case Yi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let r=Qe.compareWithDefault("tbs",t.tbs)&&Qe.compareWithDefault("responderID",t.responderID)&&Qe.compareWithDefault("producedAt",t.producedAt)&&Qe.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(r=r&&Qe.compareWithDefault("responseExtensions",t.responseExtensions)),r}case Jl:return t.algorithmId===v&&!("algorithmParams"in t);case ql:return t.isEqual(ts.defaultValues(e));case Yi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||kc,value:[Qe.schema(t.tbsResponseData||{names:{blockName:Jf}}),B.schema(t.signatureAlgorithm||{names:{blockName:qf}}),new ie({name:t.signature||_f}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new N({value:[new Z({name:wh,value:le.schema(t.certs||{})})]})]})]})}fromSchema(e){L(e,NN);const t=U(e,e,ts.schema());D.assertSchema(t,this.className),this.tbsResponseData=new Qe({schema:t.result[Jf]}),this.signatureAlgorithm=new B({schema:t.result[qf]}),this.signature=t.result[_f],wh in t.result&&(this.certs=Array.from(t.result[wh],r=>new le({schema:r})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[new N({value:Array.from(this.certs,t=>t.toSchema())})]})),new N({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}async getCertificateStatus(e,t,r=se(!0)){const a={isForCertificate:!1,status:2},n={},i=[];for(const o of this.tbsResponseData.responses){const u=r.getAlgorithmByOID(o.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!n[u.name]){n[u.name]=1;const c=new je;i.push(c),await c.createForCertificate(e,{hashAlgorithm:u.name,issuerCertificate:t},r)}}for(const o of this.tbsResponseData.responses)for(const u of i)if(o.certID.isEqual(u)){a.isForCertificate=!0;try{switch(o.certStatus.idBlock.isConstructed){case!0:o.certStatus.idBlock.tagNumber===1&&(a.status=1);break;case!1:switch(o.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2;break;default:}break;default:}}catch(c){}return a}return a}async sign(e,t="SHA-1",r=se(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters.algorithm;if(!("name"in n))throw new Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());const i=await r.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:n});this.signature=new ie({valueHex:i})}async verify(e={},t=se(!0)){let r=null,a=-1;const n=e.trustedCerts||[];if(!this.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof de:for(const[o,u]of this.certs.entries())if(u.subject.isEqual(this.tbsResponseData.responderID)){a=o;break}break;case this.tbsResponseData.responderID instanceof $:for(const[o,u]of this.certs.entries()){const c=await t.digest({name:"sha-1"},u.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(hc(c,this.tbsResponseData.responderID.valueBlock.valueHex)){a=o;break}}break;default:throw new Error("Wrong value for responderID")}if(a===-1)throw new Error("Correct certificate was not found in OCSP response");r=this.certs[a];const i=[r];for(const o of this.certs){const u=await Ww(o,r);u&&i.push(u)}if(!(await new hm({certs:i,trustedCerts:n}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}ts.CLASS_NAME="BasicOCSPResponse";const mf="tbs",ff="version",df="subject",pf="subjectPublicKeyInfo",Yn="attributes",_l="signatureAlgorithm",Wl="signatureValue",Ko="CertificationRequestInfo",Ud="".concat(Ko,".version"),jd="".concat(Ko,".subject"),$d="".concat(Ko,".subjectPublicKeyInfo"),sm="".concat(Ko,".attributes"),kN=[Ko,Ud,jd,$d,sm,_l,Wl];function EN(s={}){const e=f(s,"names",{});return new N({name:e.CertificationRequestInfo||Ko,value:[new O({name:e.CertificationRequestInfoVersion||Ud}),de.schema(e.subject||{names:{blockName:jd}}),Pt.schema({names:{blockName:$d}}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({optional:!0,name:e.CertificationRequestInfoAttributes||sm,value:be.schema(e.attributes||{})})]})]})}class os extends T{get tbs(){return ve.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,mf,os.defaultValues(mf))),this.version=f(e,ff,os.defaultValues(ff)),this.subject=f(e,df,os.defaultValues(df)),this.subjectPublicKeyInfo=f(e,pf,os.defaultValues(pf)),Yn in e&&(this.attributes=f(e,Yn,os.defaultValues(Yn))),this.signatureAlgorithm=f(e,_l,os.defaultValues(_l)),this.signatureValue=f(e,Wl,os.defaultValues(Wl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mf:return Me;case ff:return 0;case df:return new de;case pf:return new Pt;case Yn:return[];case _l:return new B;case Wl:return new ie;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({value:[EN(t.certificationRequestInfo||{}),new N({name:t.signatureAlgorithm||_l,value:[new J,new z({optional:!0})]}),new ie({name:t.signatureValue||Wl})]})}fromSchema(e){L(e,kN);const t=U(e,e,os.schema());D.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[Ud].valueBlock.valueDec,this.subject=new de({schema:t.result[jd]}),this.subjectPublicKeyInfo=new Pt({schema:t.result[$d]}),sm in t.result&&(this.attributes=Array.from(t.result[sm],r=>new be({schema:r}))),this.signatureAlgorithm=new B({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new O({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return Yn in this&&e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new N({value:e})}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return os.schema();const r=Ke(this.tbsView);D.assert(r,"PKCS#10 Certificate Request"),t=r.result}else t=this.encodeTBS();return new N({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:me.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Yn in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}async sign(e,t="SHA-1",r=se(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ie({valueHex:i})}async verify(e=se(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=se(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}os.CLASS_NAME="CertificationRequest";const fn="digestAlgorithm",dn="digest",CN=[fn,dn];class rs extends T{constructor(e={}){super(),this.digestAlgorithm=f(e,fn,rs.defaultValues(fn)),this.digest=f(e,dn,rs.defaultValues(dn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fn:return new B;case dn:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fn:return B.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case dn:return t.isEqual(rs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[B.schema(t.digestAlgorithm||{names:{blockName:fn}}),new $({name:t.digest||dn})]})}fromSchema(e){L(e,CN);const t=U(e,e,rs.schema({names:{digestAlgorithm:{names:{blockName:fn}},digest:dn}}));D.assertSchema(t,this.className),this.digestAlgorithm=new B({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new N({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}rs.CLASS_NAME="DigestInfo";const Qi="eContentType",is="eContent",IN=[Qi,is];class jt extends T{constructor(e={}){if(super(),this.eContentType=f(e,Qi,jt.defaultValues(Qi)),is in e&&(this.eContent=f(e,is,jt.defaultValues(is)),this.eContent.idBlock.tagClass===1&&this.eContent.idBlock.tagNumber===4&&this.eContent.idBlock.isConstructed===!1)){const t=new $({idBlock:{isConstructed:!0},isConstructed:!0});let r=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,r,r+65536>a.byteLength?a.byteLength-r:65536),o=new ArrayBuffer(i.length),u=new Uint8Array(o);for(let c=0;c<u.length;c++)u[c]=i[c];t.valueBlock.value.push(new $({valueHex:o})),n-=i.length,r+=i.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qi:return v;case is:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qi:return t===v;case is:return t.idBlock.tagClass===1&&t.idBlock.tagNumber===4?t.isEqual(jt.defaultValues(is)):!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.eContentType||v}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new z({name:t.eContent||v})]})]})}fromSchema(e){L(e,IN);const t=U(e,e,jt.schema({names:{eContentType:Qi,eContent:is}}));D.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),is in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new J({value:this.eContentType})),this.eContent&&jt.compareWithDefault(is,this.eContent)===!1&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new N({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&jt.compareWithDefault(is,this.eContent)===!1&&(e.eContent=this.eContent.toJSON()),e}}jt.CLASS_NAME="EncapsulatedContentInfo";const pn="mac",gn="macSalt",Ls="iterations",xN=[pn,gn,Ls];class Et extends T{constructor(e={}){super(),this.mac=f(e,pn,Et.defaultValues(pn)),this.macSalt=f(e,gn,Et.defaultValues(gn)),Ls in e&&(this.iterations=f(e,Ls,Et.defaultValues(Ls))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pn:return new rs;case gn:return new $;case Ls:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case pn:return rs.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&rs.compareWithDefault("digest",t.digest);case gn:return t.isEqual(Et.defaultValues(e));case Ls:return t===Et.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,optional:t.optional||!0,value:[rs.schema(t.mac||{names:{blockName:pn}}),new $({name:t.macSalt||gn}),new O({optional:!0,name:t.iterations||Ls})]})}fromSchema(e){L(e,xN);const t=U(e,e,Et.schema({names:{mac:{names:{blockName:pn}},macSalt:gn,iterations:Ls}}));D.assertSchema(t,this.className),this.mac=new rs({schema:t.result.mac}),this.macSalt=t.result.macSalt,Ls in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return this.iterations!==void 0&&e.push(new O({value:this.iterations})),new N({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return this.iterations!==void 0&&(e.iterations=this.iterations),e}}Et.CLASS_NAME="MacData";const kn="hashAlgorithm",En="hashedMessage",VN=[kn,En];class ct extends T{static async create(e,t,r=se(!0)){const a=r.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),n=await r.digest(e,t);return new ct({hashAlgorithm:new B({algorithmId:a,algorithmParams:new We}),hashedMessage:new $({valueHex:n})})}constructor(e={}){super(),this.hashAlgorithm=f(e,kn,ct.defaultValues(kn)),this.hashedMessage=f(e,En,ct.defaultValues(En)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kn:return new B;case En:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case kn:return t.algorithmId===v&&!("algorithmParams"in t);case En:return t.isEqual(ct.defaultValues(e))===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[B.schema(t.hashAlgorithm||{}),new $({name:t.hashedMessage||v})]})}fromSchema(e){L(e,VN);const t=U(e,e,ct.schema({names:{hashAlgorithm:{names:{blockName:kn}},hashedMessage:En}}));D.assertSchema(t,this.className),this.hashAlgorithm=new B({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new N({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}ct.CLASS_NAME="MessageImprint";const Zi="reqCert",Hr="singleRequestExtensions",PN=[Zi,Hr];let rm=class Gl extends T{constructor(e={}){super(),this.reqCert=f(e,Zi,Gl.defaultValues(Zi)),Hr in e&&(this.singleRequestExtensions=f(e,Hr,Gl.defaultValues(Hr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zi:return new je;case Hr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Zi:return t.isEqual(Gl.defaultValues(e));case Hr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[je.schema(t.reqCert||{}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Ue.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||v}})]})]})}fromSchema(e){L(e,PN);const t=U(e,e,Gl.schema({names:{reqCert:{names:{blockName:Zi}},extensions:{names:{blockName:Hr}}}}));D.assertSchema(t,this.className),this.reqCert=new je({schema:t.result.reqCert}),Hr in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,r=>new Ue({schema:r})))}toSchema(){const e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new N({value:Array.from(this.singleRequestExtensions,t=>t.toSchema())})]})),new N({value:e})}toJSON(){const e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,t=>t.toJSON())),e}};rm.CLASS_NAME="Request";const Zc="tbs",eo="version",to="requestorName",eh="requestList",so="requestExtensions",Mo="TBSRequest",yh="".concat(Mo,".").concat(eo),vh="".concat(Mo,".").concat(to),Wf="".concat(Mo,".requests"),bh="".concat(Mo,".").concat(so),BN=[Mo,yh,vh,Wf,bh];class ot extends T{get tbs(){return ve.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,Zc,ot.defaultValues(Zc))),eo in e&&(this.version=f(e,eo,ot.defaultValues(eo))),to in e&&(this.requestorName=f(e,to,ot.defaultValues(to))),this.requestList=f(e,eh,ot.defaultValues(eh)),so in e&&(this.requestExtensions=f(e,so,ot.defaultValues(so))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zc:return Me;case eo:return 0;case to:return new ce;case eh:case so:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Zc:return t.byteLength===0;case eo:return t===ot.defaultValues(e);case to:return t.type===ce.defaultValues("type")&&Object.keys(t.value).length===0;case eh:case so:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||Mo,value:[new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({name:t.TBSRequestVersion||yh})]}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[ce.schema(t.requestorName||{names:{blockName:vh}})]}),new N({name:t.requestList||"TBSRequest.requestList",value:[new Z({name:t.requests||Wf,value:rm.schema(t.requestNames||{})})]}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[He.schema(t.extensions||{names:{blockName:t.requestExtensions||bh}})]})]})}fromSchema(e){L(e,BN);const t=U(e,e,ot.schema());D.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,yh in t.result&&(this.version=t.result[yh].valueBlock.valueDec),vh in t.result&&(this.requestorName=new ce({schema:t.result[vh]})),this.requestList=Array.from(t.result[Wf],r=>new rm({schema:r})),bh in t.result&&(this.requestExtensions=Array.from(t.result[bh].valueBlock.value,r=>new Ue({schema:r})))}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return ot.schema();const r=Ke(this.tbsView);if(D.assert(r,"TBS Request"),!(r.result instanceof N))throw new Error("ASN.1 result should be SEQUENCE");t=r.result}else{const r=[];this.version!==void 0&&r.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[new O({value:this.version})]})),this.requestorName&&r.push(new V({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),r.push(new N({value:Array.from(this.requestList,a=>a.toSchema())})),this.requestExtensions&&r.push(new V({idBlock:{tagClass:3,tagNumber:2},value:[new N({value:Array.from(this.requestExtensions,a=>a.toSchema())})]})),t=new N({value:r})}return t}toJSON(){const e={};return this.version!=null&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,t=>t.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,t=>t.toJSON())),e}}ot.CLASS_NAME="TBSRequest";const Qn="signatureAlgorithm",Zn="signature",ir="certs";class Jt extends T{constructor(e={}){super(),this.signatureAlgorithm=f(e,Qn,Jt.defaultValues(Qn)),this.signature=f(e,Zn,Jt.defaultValues(Zn)),ir in e&&(this.certs=f(e,ir,Jt.defaultValues(ir))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qn:return new B;case Zn:return new ie;case ir:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qn:return t.algorithmId===v&&!("algorithmParams"in t);case Zn:return t.isEqual(Jt.defaultValues(e));case ir:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[B.schema(t.signatureAlgorithm||{}),new ie({name:t.signature||v}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new N({value:[new Z({name:t.certs||v,value:le.schema({})})]})]})]})}fromSchema(e){L(e,[Qn,Zn,ir]);const t=U(e,e,Jt.schema({names:{signatureAlgorithm:{names:{blockName:Qn}},signature:Zn,certs:ir}}));D.assertSchema(t,this.className),this.signatureAlgorithm=new B({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,ir in t.result&&(this.certs=Array.from(t.result.certs,r=>new le({schema:r})))}toSchema(){const e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new N({value:Array.from(this.certs,t=>t.toSchema())})]})),new N({value:e})}toJSON(){const e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}}Jt.CLASS_NAME="Signature";const ro="tbsRequest",Fr="optionalSignature",ON=[ro,Fr];class lc extends T{constructor(e={}){super(),this.tbsRequest=f(e,ro,lc.defaultValues(ro)),Fr in e&&(this.optionalSignature=f(e,Fr,lc.defaultValues(Fr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ro:return new ot;case Fr:return new Jt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ro:return ot.compareWithDefault("tbs",t.tbs)&&ot.compareWithDefault("version",t.version)&&ot.compareWithDefault("requestorName",t.requestorName)&&ot.compareWithDefault("requestList",t.requestList)&&ot.compareWithDefault("requestExtensions",t.requestExtensions);case Fr:return Jt.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&Jt.compareWithDefault("signature",t.signature)&&Jt.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||"OCSPRequest",value:[ot.schema(t.tbsRequest||{names:{blockName:ro}}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Jt.schema(t.optionalSignature||{names:{blockName:Fr}})]})]})}fromSchema(e){L(e,ON);const t=U(e,e,lc.schema());D.assertSchema(t,this.className),this.tbsRequest=new ot({schema:t.result.tbsRequest}),Fr in t.result&&(this.optionalSignature=new Jt({schema:t.result.optionalSignature}))}toSchema(e=!1){const t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new N({value:t})}toJSON(){const e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,r=se(!0)){const a=new je;await a.createForCertificate(e,t,r),this.tbsRequest.requestList.push(new rm({reqCert:a}))}async sign(e,t="SHA-1",r=se(!0)){if(oe.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw new Error('Need to create "optionalSignature" field before signing');const a=await r.getSignatureParameters(e,t),n=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;const i=this.tbsRequest.toSchema(!0).toBER(!1),o=await r.signWithPrivateKey(i,e,n);this.optionalSignature.signature=new ie({valueHex:o})}verify(){}}lc.CLASS_NAME="OCSPRequest";const ao="responseType",no="response",DN=[ao,no];class hs extends T{constructor(e={}){super(),this.responseType=f(e,ao,hs.defaultValues(ao)),this.response=f(e,no,hs.defaultValues(no)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ao:return v;case no:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ao:return t===v;case no:return t.isEqual(hs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new J({name:t.responseType||v}),new $({name:t.response||v})]})}fromSchema(e){L(e,DN);const t=U(e,e,hs.schema({names:{responseType:ao,response:no}}));D.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new N({value:[new J({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}hs.CLASS_NAME="ResponseBytes";const ei="responseStatus",Is="responseBytes";class Eo extends T{constructor(e={}){super(),this.responseStatus=f(e,ei,Eo.defaultValues(ei)),Is in e&&(this.responseBytes=f(e,Is,Eo.defaultValues(Is))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ei:return new fc;case Is:return new hs;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ei:return t.isEqual(Eo.defaultValues(e));case Is:return hs.compareWithDefault("responseType",t.responseType)&&hs.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||"OCSPResponse",value:[new fc({name:t.responseStatus||ei}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[hs.schema(t.responseBytes||{names:{blockName:Is}})]})]})}fromSchema(e){L(e,[ei,Is]);const t=U(e,e,Eo.schema());D.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,Is in t.result&&(this.responseBytes=new hs({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new N({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,r=se(!0)){let a;const n={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==ih)return n;try{const i=Ke(this.responseBytes.response.valueBlock.valueHexView);D.assert(i,"Basic OCSP response"),a=new ts({schema:i.result})}catch(i){return n}return a.getCertificateStatus(e,t,r)}async sign(e,t,r=se(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===ih)return ts.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,r);throw new Error("Unknown ResponseBytes type: ".concat(((a=this.responseBytes)===null||a===void 0?void 0:a.responseType)||"Unknown"))}async verify(e=null,t=se(!0)){var r;if(!(Is in this))throw new Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===ih){const a=ts.fromBER(this.responseBytes.response.valueBlock.valueHexView);return e!==null&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw new Error("Unknown ResponseBytes type: ".concat(((r=this.responseBytes)===null||r===void 0?void 0:r.responseType)||"Unknown"))}}Eo.CLASS_NAME="OCSPResponse";const Aa="type",Us="attributes",th="encodedValue",TN=[Us];class Ee extends T{constructor(e={}){super(),this.type=f(e,Aa,Ee.defaultValues(Aa)),this.attributes=f(e,Us,Ee.defaultValues(Us)),this.encodedValue=f(e,th,Ee.defaultValues(th)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Aa:return-1;case Us:return[];case th:return Me;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Aa:return t===Ee.defaultValues(Aa);case Us:return t.length===0;case th:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new V({name:t.blockName||v,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new Z({name:t.attributes||v,value:be.schema()})]})}fromSchema(e){L(e,TN);const t=U(e,e,Ee.schema({names:{tagNumber:this.type,attributes:Us}}));D.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=ve.toArrayBuffer(t.result.valueBeforeDecodeView);const r=new Uint8Array(this.encodedValue);if(r[0]=49,!(Us in t.result)){if(this.type===0)throw new Error("Wrong structure of SignedUnsignedAttributes");return}this.attributes=Array.from(t.result.attributes,a=>new be({schema:a}))}toSchema(){if(Ee.compareWithDefault(Aa,this.type)||Ee.compareWithDefault(Us,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new V({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(Ee.compareWithDefault(Aa,this.type)||Ee.compareWithDefault(Us,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}Ee.CLASS_NAME="SignedAndUnsignedAttributes";const io="version",wn="sid",oo="digestAlgorithm",Jr="signedAttrs",uo="signatureAlgorithm",Xl="signature",qr="unsignedAttrs",pa="SignerInfo",Gf="".concat(pa,".").concat(io),zl="".concat(pa,".").concat(wn),Xf="".concat(pa,".").concat(oo),Ah="".concat(pa,".").concat(Jr),zf="".concat(pa,".").concat(uo),Yf="".concat(pa,".").concat(Xl),Sh="".concat(pa,".").concat(qr),RN=[Gf,zl,Xf,Ah,zf,Yf,Sh];class Oe extends T{constructor(e={}){super(),this.version=f(e,io,Oe.defaultValues(io)),this.sid=f(e,wn,Oe.defaultValues(wn)),this.digestAlgorithm=f(e,oo,Oe.defaultValues(oo)),Jr in e&&(this.signedAttrs=f(e,Jr,Oe.defaultValues(Jr))),this.signatureAlgorithm=f(e,uo,Oe.defaultValues(uo)),this.signature=f(e,Xl,Oe.defaultValues(Xl)),qr in e&&(this.unsignedAttrs=f(e,qr,Oe.defaultValues(qr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case io:return 0;case wn:return new z;case oo:return new B;case Jr:return new Ee({type:0});case uo:return new B;case Xl:return new $;case qr:return new Ee({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case io:return Oe.defaultValues(io)===t;case wn:return t instanceof z;case oo:return t instanceof B?t.isEqual(Oe.defaultValues(oo)):!1;case Jr:return Ee.compareWithDefault("type",t.type)&&Ee.compareWithDefault("attributes",t.attributes)&&Ee.compareWithDefault("encodedValue",t.encodedValue);case uo:return t instanceof B?t.isEqual(Oe.defaultValues(uo)):!1;case Xl:case qr:return Ee.compareWithDefault("type",t.type)&&Ee.compareWithDefault("attributes",t.attributes)&&Ee.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:pa,value:[new O({name:t.version||Gf}),new Ie({value:[Fe.schema(t.sidSchema||{names:{blockName:zl}}),new Ie({value:[new V({optional:!0,name:t.sid||zl,idBlock:{tagClass:3,tagNumber:0},value:[new $]}),new G({optional:!0,name:t.sid||zl,idBlock:{tagClass:3,tagNumber:0}})]})]}),B.schema(t.digestAlgorithm||{names:{blockName:Xf}}),Ee.schema(t.signedAttrs||{names:{blockName:Ah,tagNumber:0}}),B.schema(t.signatureAlgorithm||{names:{blockName:zf}}),new $({name:t.signature||Yf}),Ee.schema(t.unsignedAttrs||{names:{blockName:Sh,tagNumber:1}})]})}fromSchema(e){L(e,RN);const t=U(e,e,Oe.schema());D.assertSchema(t,this.className),this.version=t.result[Gf].valueBlock.valueDec;const r=t.result[zl];r.idBlock.tagClass===1?this.sid=new Fe({schema:r}):this.sid=r,this.digestAlgorithm=new B({schema:t.result[Xf]}),Ah in t.result&&(this.signedAttrs=new Ee({type:0,schema:t.result[Ah]})),this.signatureAlgorithm=new B({schema:t.result[zf]}),this.signature=t.result[Yf],Sh in t.result&&(this.unsignedAttrs=new Ee({type:1,schema:t.result[Sh]}))}toSchema(){if(Oe.compareWithDefault(wn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new O({value:this.version})),this.sid instanceof Fe?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&Oe.compareWithDefault(Jr,this.signedAttrs)===!1&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&Oe.compareWithDefault(qr,this.unsignedAttrs)===!1&&e.push(this.unsignedAttrs.toSchema()),new N({value:e})}toJSON(){if(Oe.compareWithDefault(wn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof z||(e.sid=this.sid.toJSON()),this.signedAttrs&&Oe.compareWithDefault(Jr,this.signedAttrs)===!1&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&Oe.compareWithDefault(qr,this.unsignedAttrs)===!1&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}Oe.CLASS_NAME="SignerInfo";const Yl="version",Ql="policy",Zl="messageImprint",ec="serialNumber",tc="genTime",yn="ordering",vn="nonce",lo="accuracy",co="tsa",ho="extensions",ds="TSTInfo",Qf="".concat(ds,".").concat(Yl),Zf="".concat(ds,".").concat(Ql),ed="".concat(ds,".").concat(Zl),td="".concat(ds,".").concat(ec),sd="".concat(ds,".").concat(tc),Nh="".concat(ds,".").concat(lo),kh="".concat(ds,".").concat(yn),Eh="".concat(ds,".").concat(vn),Ch="".concat(ds,".").concat(co),Ih="".concat(ds,".").concat(ho),LN=[Qf,Zf,ed,td,sd,Nh,kh,Eh,Ch,Ih];class dt extends T{constructor(e={}){super(),this.version=f(e,Yl,dt.defaultValues(Yl)),this.policy=f(e,Ql,dt.defaultValues(Ql)),this.messageImprint=f(e,Zl,dt.defaultValues(Zl)),this.serialNumber=f(e,ec,dt.defaultValues(ec)),this.genTime=f(e,tc,dt.defaultValues(tc)),lo in e&&(this.accuracy=f(e,lo,dt.defaultValues(lo))),yn in e&&(this.ordering=f(e,yn,dt.defaultValues(yn))),vn in e&&(this.nonce=f(e,vn,dt.defaultValues(vn))),co in e&&(this.tsa=f(e,co,dt.defaultValues(co))),ho in e&&(this.extensions=f(e,ho,dt.defaultValues(ho))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yl:return 0;case Ql:return v;case Zl:return new ct;case ec:return new O;case tc:return new Date(0,0,0);case lo:return new Ft;case yn:return!1;case vn:return new O;case co:return new ce;case ho:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yl:case Ql:case tc:case yn:return t===dt.defaultValues(yn);case Zl:return ct.compareWithDefault(kn,t.hashAlgorithm)&&ct.compareWithDefault(En,t.hashedMessage);case ec:case vn:return t.isEqual(dt.defaultValues(vn));case lo:return Ft.compareWithDefault(cr,t.seconds)&&Ft.compareWithDefault(hr,t.millis)&&Ft.compareWithDefault(mr,t.micros);case co:return ce.compareWithDefault(hu,t.type)&&ce.compareWithDefault(mu,t.value);case ho:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||ds,value:[new O({name:t.version||Qf}),new J({name:t.policy||Zf}),ct.schema(t.messageImprint||{names:{blockName:ed}}),new O({name:t.serialNumber||td}),new Ve({name:t.genTime||sd}),Ft.schema(t.accuracy||{names:{blockName:Nh}}),new fa({name:t.ordering||kh,optional:!0}),new O({name:t.nonce||Eh,optional:!0}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ce.schema(t.tsa||{names:{blockName:Ch}})]}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Z({name:t.extensions||Ih,value:Ue.schema(t.extension||{})})]})]})}fromSchema(e){L(e,LN);const t=U(e,e,dt.schema());D.assertSchema(t,this.className),this.version=t.result[Qf].valueBlock.valueDec,this.policy=t.result[Zf].valueBlock.toString(),this.messageImprint=new ct({schema:t.result[ed]}),this.serialNumber=t.result[td],this.genTime=t.result[sd].toDate(),Nh in t.result&&(this.accuracy=new Ft({schema:t.result[Nh]})),kh in t.result&&(this.ordering=t.result[kh].valueBlock.value),Eh in t.result&&(this.nonce=t.result[Eh]),Ch in t.result&&(this.tsa=new ce({schema:t.result[Ch]})),Ih in t.result&&(this.extensions=Array.from(t.result[Ih],r=>new Ue({schema:r})))}toSchema(){const e=[];return e.push(new O({value:this.version})),e.push(new J({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new Ve({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),this.ordering!==void 0&&e.push(new fa({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new N({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),this.ordering!==void 0&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async verify(e,t=se(!0)){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const r=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),n=await t.digest(a.name,new Uint8Array(r));return ve.isEqual(n,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}dt.CLASS_NAME="TSTInfo";const mo="version",sc="digestAlgorithms",rc="encapContentInfo",fo="certificates",po="crls",ac="signerInfos",ou="ocsps",qn="SignedData",rd="".concat(qn,".").concat(mo),xh="".concat(qn,".").concat(sc),ad="".concat(qn,".").concat(rc),Vh="".concat(qn,".").concat(fo),Ph="".concat(qn,".").concat(po),Bh="".concat(qn,".").concat(ac),UN=[rd,xh,ad,Vh,Ph,Bh];class ft extends Error{constructor({message:e,code:t=0,date:r=new Date,signatureVerified:a=null,signerCertificate:n=null,signerCertificateVerified:i=null,timestampSerial:o=null,certificatePath:u=[]}){super(e),this.name="SignedDataVerifyError",this.date=r,this.code=t,this.timestampSerial=o,this.signatureVerified=a,this.signerCertificate=n,this.signerCertificateVerified=i,this.certificatePath=u}}class it extends T{constructor(e={}){super(),this.version=f(e,mo,it.defaultValues(mo)),this.digestAlgorithms=f(e,sc,it.defaultValues(sc)),this.encapContentInfo=f(e,rc,it.defaultValues(rc)),fo in e&&(this.certificates=f(e,fo,it.defaultValues(fo))),po in e&&(this.crls=f(e,po,it.defaultValues(po))),ou in e&&(this.ocsps=f(e,ou,it.defaultValues(ou))),this.signerInfos=f(e,ac,it.defaultValues(ac)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mo:return 0;case sc:return[];case rc:return new jt;case fo:return[];case po:return[];case ou:return[];case ac:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mo:return t===it.defaultValues(mo);case rc:return jt.compareWithDefault("eContentType",t.eContentType)&&jt.compareWithDefault("eContent",t.eContent);case sc:case fo:case po:case ou:case ac:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return t.optional===void 0&&(t.optional=!1),new N({name:t.blockName||qn,optional:t.optional,value:[new O({name:t.version||rd}),new Ge({value:[new Z({name:t.digestAlgorithms||xh,value:B.schema()})]}),jt.schema(t.encapContentInfo||{names:{blockName:ad}}),new V({name:t.certificates||Vh,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Ns.schema().valueBlock.value}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Ys.schema(t.crls||{names:{crls:Ph}}).valueBlock.value}),new Ge({value:[new Z({name:t.signerInfos||Bh,value:Oe.schema()})]})]})}fromSchema(e){L(e,UN);const t=U(e,e,it.schema());if(D.assertSchema(t,this.className),this.version=t.result[rd].valueBlock.valueDec,xh in t.result&&(this.digestAlgorithms=Array.from(t.result[xh],r=>new B({schema:r}))),this.encapContentInfo=new jt({schema:t.result[ad]}),Vh in t.result){const r=new Ns({schema:new Ge({value:t.result[Vh].valueBlock.value})});this.certificates=r.certificates.slice(0)}Ph in t.result&&(this.crls=Array.from(t.result[Ph],r=>r.idBlock.tagClass===1?new _e({schema:r}):(r.idBlock.tagClass=1,r.idBlock.tagNumber=16,new zs({schema:r})))),Bh in t.result&&(this.signerInfos=Array.from(t.result[Bh],r=>new Oe({schema:r})))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof ca)||this.crls&&this.crls.length&&this.crls.some(r=>r instanceof zs)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof _t)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof qs)||this.signerInfos.some(r=>r.version===3)||this.encapContentInfo.eContentType!==it.ID_DATA?this.version=3:this.version=1,t.push(new O({value:this.version})),t.push(new Ge({value:Array.from(this.digestAlgorithms,r=>r.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const r=new Ns({certificates:this.certificates}).toSchema();t.push(new V({idBlock:{tagClass:3,tagNumber:0},value:r.valueBlock.value}))}return this.crls&&t.push(new V({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,r=>{if(r instanceof zs){const a=r.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return r.toSchema(e)})})),t.push(new Ge({value:Array.from(this.signerInfos,r=>r.toSchema())})),new N({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}async verify({signer:e=-1,data:t=Me,trustedCerts:r=[],checkDate:a=new Date,checkChain:n=!1,passedWhenNotRevValues:i=!1,extendedMode:o=!1,findOrigin:u=null,findIssuer:c=null}={},l=se(!0)){let m=null,h=null;try{let w=Me,g=v,p=[];const d=this.signerInfos[e];if(!d)throw new ft({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new ft({date:a,code:2,message:"No certificates attached to this signed data"});if(d.sid instanceof Fe){for(const k of this.certificates)if(k instanceof le&&k.issuer.isEqual(d.sid.issuer)&&k.serialNumber.isEqual(d.sid.serialNumber)){m=k;break}}else{const k=d.sid,I=k.idBlock.isConstructed?k.valueBlock.value[0].valueBlock.valueHex:k.valueBlock.valueHex;for(const R of this.certificates){if(!(R instanceof le))continue;const j=await l.digest({name:"sha-1"},R.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(hc(j,I)){m=R;break}}}if(!m)throw new ft({date:a,code:3,message:"Unable to find signer certificate"});if(this.encapContentInfo.eContentType===MA){if(!this.encapContentInfo.eContent)throw new ft({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0});let k;try{k=dt.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch(I){throw new ft({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0})}if(a=k.genTime,h=k.serialNumber.valueBlock.valueHexView.slice(),t.byteLength===0)throw new ft({date:a,code:4,message:"Missed detached data input array"});if(!await k.verify({data:t},l))throw new ft({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0})}if(n){const k=this.certificates.filter(K=>K instanceof le&&!!Ww(K,m)),I={checkDate:a,certs:k,trustedCerts:r};c&&(I.findIssuer=c),u&&(I.findOrigin=u);const R=new hm(I);if(R.certs.push(m),this.crls)for(const K of this.crls)"thisUpdate"in K?R.crls.push(K):K.otherRevInfoFormat===ih&&R.ocsps.push(new ts({schema:K.otherRevInfo}));this.ocsps&&R.ocsps.push(...this.ocsps);const j=await R.verify({passedWhenNotRevValues:i},l).catch(K=>{throw new ft({date:a,code:5,message:"Validation of signer's certificate failed with error: ".concat(K instanceof Object?K.resultMessage:K),signerCertificate:m,signerCertificateVerified:!1})});if(j.certificatePath&&(p=j.certificatePath),!j.result)throw new ft({date:a,code:5,message:"Validation of signer's certificate failed: ".concat(j.resultMessage),signerCertificate:m,signerCertificateVerified:!1})}const S=l.getAlgorithmByOID(d.digestAlgorithm.algorithmId);if(!("name"in S))throw new ft({date:a,code:7,message:"Unsupported signature algorithm: ".concat(d.digestAlgorithm.algorithmId),signerCertificate:m,signerCertificateVerified:!0});g=S.name;const A=this.encapContentInfo.eContent;if(A)A.idBlock.tagClass===1&&A.idBlock.tagNumber===4?t=A.getValue():t=A.valueBlock.valueBeforeDecodeView;else if(t.byteLength===0)throw new ft({date:a,code:8,message:"Missed detached data input array",signerCertificate:m,signerCertificateVerified:!0});if(d.signedAttrs){let k=!1,I=!1;for(const R of d.signedAttrs.attributes)if(R.type==="1.2.840.113549.1.9.3"&&(k=!0),R.type==="1.2.840.113549.1.9.4"&&(I=!0,w=R.values[0].valueBlock.valueHex),k&&I)break;if(k===!1)throw new ft({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:m,signerCertificateVerified:!0});if(I===!1)throw new ft({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:m,signerCertificateVerified:!0})}if(d.signedAttrs){const k=await l.digest(g,new Uint8Array(t));if(!hc(k,w))throw new ft({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0});t=d.signedAttrs.encodedValue}const E=d.signatureAlgorithm.algorithmId==="1.2.840.113549.1.1.1"?await l.verifyWithPublicKey(t,d.signature,m.subjectPublicKeyInfo,d.signatureAlgorithm,g):await l.verifyWithPublicKey(t,d.signature,m.subjectPublicKeyInfo,d.signatureAlgorithm);return o?{date:a,code:14,message:v,signatureVerified:E,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0,certificatePath:p}:E}catch(w){throw w instanceof ft?w:new ft({date:a,code:15,message:"Error during verification: ".concat(w instanceof Error?w.message:w),signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0})}}async sign(e,t,r="SHA-1",a=Me,n=se(!0)){var i;if(!e)throw new Error("Need to provide a private key for signing");const o=this.signerInfos[t];if(!o)throw new RangeError("SignerInfo index is out of range");!(!((i=o.signedAttrs)===null||i===void 0)&&i.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(r=e.algorithm.hash.name);const u=n.getOIDByAlgorithm({name:r},!0,"hashAlgorithm");this.digestAlgorithms.filter(h=>h.algorithmId===u).length===0&&this.digestAlgorithms.push(new B({algorithmId:u,algorithmParams:new We})),o.digestAlgorithm=new B({algorithmId:u,algorithmParams:new We});const c=await n.getSignatureParameters(e,r),l=c.parameters;if(o.signatureAlgorithm=c.signatureAlgorithm,o.signedAttrs)if(o.signedAttrs.encodedValue.byteLength!==0)a=o.signedAttrs.encodedValue;else{a=o.signedAttrs.toSchema().toBER();const h=ve.toUint8Array(a);h[0]=49}else{const h=this.encapContentInfo.eContent;if(h)h.idBlock.tagClass===1&&h.idBlock.tagNumber===4?a=h.getValue():a=h.valueBlock.valueBeforeDecodeView;else if(a.byteLength===0)throw new Error("Missed detached data input array")}const m=await n.signWithPrivateKey(a,e,l);o.signature=new $({valueHex:m})}}it.CLASS_NAME="SignedData",it.ID_DATA=Vd;const bn="version",An="authSafe",js="macData",uu="parsedValue",jN=[bn,An,js];class zr extends T{constructor(e={}){super(),this.version=f(e,bn,zr.defaultValues(bn)),this.authSafe=f(e,An,zr.defaultValues(An)),js in e&&(this.macData=f(e,js,zr.defaultValues(js))),uu in e&&(this.parsedValue=f(e,uu,zr.defaultValues(uu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bn:return 3;case An:return new we;case js:return new Et;case uu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bn:return t===zr.defaultValues(e);case An:return we.compareWithDefault("contentType",t.contentType)&&we.compareWithDefault("content",t.content);case js:return Et.compareWithDefault("mac",t.mac)&&Et.compareWithDefault("macSalt",t.macSalt)&&Et.compareWithDefault("iterations",t.iterations);case uu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.version||bn}),we.schema(t.authSafe||{names:{blockName:An}}),Et.schema(t.macData||{names:{blockName:js,optional:!0}})]})}fromSchema(e){L(e,jN);const t=U(e,e,zr.schema({names:{version:bn,authSafe:{names:{blockName:An}},macData:{names:{blockName:js}}}}));D.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new we({schema:t.result.authSafe}),js in t.result&&(this.macData=new Et({schema:t.result.macData}))}toSchema(){const e=[new O({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new N({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=se(!0)){if(fe.assert(e,"parameters","object"),!this.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(oe.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),oe.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new oe("iterations");oe.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),oe.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),oe.assertEmpty(e.password,"password");const r=new ArrayBuffer(64),a=new Uint8Array(r);t.getRandomValues(a);const n=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new we({contentType:we.DATA,content:new $({valueHex:n})});const i=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:r,iterationCount:e.iterations,contentToStamp:n});this.macData=new Et({mac:new rs({digestAlgorithm:new B({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new $({valueHex:i})}),macSalt:new $({valueHex:r}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new oe("signingCertificate");oe.assertEmpty(e.privateKey,"privateKey"),oe.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const r=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new it({version:1,encapContentInfo:new jt({eContentType:"1.2.840.113549.1.7.1",eContent:new $({valueHex:r})}),certificates:[e.signingCertificate]}),n=await t.digest({name:e.hashAlgorithm},new Uint8Array(r)),i=[];i.push(new be({type:"1.2.840.113549.1.9.3",values:[new J({value:"1.2.840.113549.1.7.1"})]})),i.push(new be({type:"1.2.840.113549.1.9.5",values:[new Sf({valueDate:new Date})]})),i.push(new be({type:"1.2.840.113549.1.9.4",values:[new $({valueHex:n})]})),a.signerInfos.push(new Oe({version:1,sid:new Fe({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new Ee({type:0,attributes:i})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new we({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw new Error('Parameter "integrityMode" has unknown value: '.concat(this.parsedValue.integrityMode))}}async parseInternalValues(e,t=se(!0)){switch(fe.assert(e,"parameters","object"),e.checkIntegrity===void 0&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case we.DATA:{oe.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,fe.assert(this.authSafe.content,"authSafe.content",$);const r=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=Hn.fromBER(r),e.checkIntegrity){if(!this.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:ve.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:r,signatureToVerify:ve.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case we.SIGNED_DATA:{this.parsedValue.integrityMode=1;const r=new it({schema:this.authSafe.content}),a=r.encapContentInfo.eContent;oe.assert(a,"eContent","cmsSigned.encapContentInfo"),fe.assert(a,"eContent",$);const n=a.getValue();if(this.parsedValue.authenticatedSafe=Hn.fromBER(n),!await r.verify({signer:0,checkChain:!1},t))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error('Incorrect value for "this.authSafe.contentType": '.concat(this.authSafe.contentType))}}}zr.CLASS_NAME="PFX";const go="status",_r="statusStrings",Wr="failInfo",$N=[go,_r,Wr];var wg;(function(s){s[s.granted=0]="granted",s[s.grantedWithMods=1]="grantedWithMods",s[s.rejection=2]="rejection",s[s.waiting=3]="waiting",s[s.revocationWarning=4]="revocationWarning",s[s.revocationNotification=5]="revocationNotification"})(wg||(wg={}));class ss extends T{constructor(e={}){super(),this.status=f(e,go,ss.defaultValues(go)),_r in e&&(this.statusStrings=f(e,_r,ss.defaultValues(_r))),Wr in e&&(this.failInfo=f(e,Wr,ss.defaultValues(Wr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case go:return 2;case _r:return[];case Wr:return new ie;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case go:return t===ss.defaultValues(e);case _r:return t.length===0;case Wr:return t.isEqual(ss.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||v,value:[new O({name:t.status||v}),new N({optional:!0,value:[new Z({name:t.statusStrings||v,value:new $h})]}),new ie({name:t.failInfo||v,optional:!0})]})}fromSchema(e){L(e,$N);const t=U(e,e,ss.schema({names:{status:go,statusStrings:_r,failInfo:Wr}}));D.assertSchema(t,this.className);const r=t.result.status;if(r.valueBlock.isHexOnly===!0||r.valueBlock.valueDec<0||r.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=r.valueBlock.valueDec,_r in t.result&&(this.statusStrings=t.result.statusStrings),Wr in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){const e=[];return e.push(new O({value:this.status})),this.statusStrings&&e.push(new N({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new N({value:e})}toJSON(){const e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,t=>t.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}ss.CLASS_NAME="PKIStatusInfo";const nc="version",ic="messageImprint",wo="reqPolicy",yo="nonce",$s="certReq",vo="extensions",_n="TimeStampReq",nd="".concat(_n,".").concat(nc),id="".concat(_n,".").concat(ic),Oh="".concat(_n,".").concat(wo),Dh="".concat(_n,".").concat(yo),Th="".concat(_n,".").concat($s),Rh="".concat(_n,".").concat(vo),KN=[nd,id,Oh,Dh,Th,Rh];class Kt extends T{constructor(e={}){super(),this.version=f(e,nc,Kt.defaultValues(nc)),this.messageImprint=f(e,ic,Kt.defaultValues(ic)),wo in e&&(this.reqPolicy=f(e,wo,Kt.defaultValues(wo))),yo in e&&(this.nonce=f(e,yo,Kt.defaultValues(yo))),$s in e&&(this.certReq=f(e,$s,Kt.defaultValues($s))),vo in e&&(this.extensions=f(e,vo,Kt.defaultValues(vo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nc:return 0;case ic:return new ct;case wo:return v;case yo:return new O;case $s:return!1;case vo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nc:case wo:case $s:return t===Kt.defaultValues(e);case ic:return ct.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&ct.compareWithDefault("hashedMessage",t.hashedMessage);case yo:return t.isEqual(Kt.defaultValues(e));case vo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||_n,value:[new O({name:t.version||nd}),ct.schema(t.messageImprint||{names:{blockName:id}}),new J({name:t.reqPolicy||Oh,optional:!0}),new O({name:t.nonce||Dh,optional:!0}),new fa({name:t.certReq||Th,optional:!0}),new V({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.extensions||Rh,value:Ue.schema()})]})]})}fromSchema(e){L(e,KN);const t=U(e,e,Kt.schema());D.assertSchema(t,this.className),this.version=t.result[nd].valueBlock.valueDec,this.messageImprint=new ct({schema:t.result[id]}),Oh in t.result&&(this.reqPolicy=t.result[Oh].valueBlock.toString()),Dh in t.result&&(this.nonce=t.result[Dh]),Th in t.result&&(this.certReq=t.result[Th].valueBlock.value),Rh in t.result&&(this.extensions=Array.from(t.result[Rh],r=>new Ue({schema:r})))}toSchema(){const e=[];return e.push(new O({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new J({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),$s in this&&Kt.compareWithDefault($s,this.certReq)===!1&&e.push(new fa({value:this.certReq})),this.extensions&&e.push(new V({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,t=>t.toSchema())})),new N({value:e})}toJSON(){const e={version:this.version,messageImprint:this.messageImprint.toJSON()};return this.reqPolicy!==void 0&&(e.reqPolicy=this.reqPolicy),this.nonce!==void 0&&(e.nonce=this.nonce.toJSON()),this.certReq!==void 0&&Kt.compareWithDefault($s,this.certReq)===!1&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}}Kt.CLASS_NAME="TimeStampReq";const bo="status",Ao="timeStampToken",Kd="TimeStampResp",od="".concat(Kd,".").concat(bo),Lh="".concat(Kd,".").concat(Ao),MN=[od,Lh];class cc extends T{constructor(e={}){super(),this.status=f(e,bo,cc.defaultValues(bo)),Ao in e&&(this.timeStampToken=f(e,Ao,cc.defaultValues(Ao))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bo:return new ss;case Ao:return new we;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bo:return ss.compareWithDefault(bo,t.status)&&!("statusStrings"in t)&&!("failInfo"in t);case Ao:return t.contentType===v&&t.content instanceof z;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new N({name:t.blockName||Kd,value:[ss.schema(t.status||{names:{blockName:od}}),we.schema(t.timeStampToken||{names:{blockName:Lh,optional:!0}})]})}fromSchema(e){L(e,MN);const t=U(e,e,cc.schema());D.assertSchema(t,this.className),this.status=new ss({schema:t.result[od]}),Lh in t.result&&(this.timeStampToken=new we({schema:t.result[Lh]}))}toSchema(){const e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new N({value:e})}toJSON(){const e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,r=se(!0)){return this.assertContentType(),new it({schema:this.timeStampToken.content}).sign(e,0,t,void 0,r)}async verify(e={signer:0,trustedCerts:[],data:Me},t=se(!0)){return this.assertContentType(),new it({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==$w)throw new Error("Wrong format of timeStampToken: ".concat(this.timeStampToken.contentType))}}cc.CLASS_NAME="TimeStampResp";function HN(){if(typeof self<"u"){if("crypto"in self){let s="webcrypto";"webkitSubtle"in self.crypto&&(s="safari"),tg(s,new vc({name:s,crypto}))}}else if(typeof crypto<"u"&&"webcrypto"in crypto){const s="NodeJS ^15",e=crypto.webcrypto;tg(s,new vc({name:s,crypto:e}))}}HN();function FN(s){return String.fromCharCode(...s)}function Xw(s){return Uint8Array.from(s,e=>e.charCodeAt(0))}function JN(s){return Array.from(s).map(e=>e.toString(16).padStart(2,"0")).join("")}function Es(s){return Xw(atob(s))}function Md(s){const e=s.replace(/-----BEGIN ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/-----END ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/\n/g,"");return Es(e)}var qN=Object.defineProperty,_N=Object.defineProperties,WN=Object.getOwnPropertyDescriptors,yg=Object.getOwnPropertySymbols,GN=Object.prototype.hasOwnProperty,XN=Object.prototype.propertyIsEnumerable,vg=(s,e,t)=>e in s?qN(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ud=(s,e)=>{for(var t in e||(e={}))GN.call(e,t)&&vg(s,t,e[t]);if(yg)for(var t of yg(e))XN.call(e,t)&&vg(s,t,e[t]);return s},bg=(s,e)=>_N(s,WN(e));async function Hd(s,e,t={}){return await self.crypto.subtle.decrypt(ud({name:"AES-GCM"},t),e,s)}async function zN(s,e){return await self.crypto.subtle.decrypt({name:"RSA-OAEP"},e,s)}async function zw(s){return await self.crypto.subtle.importKey("raw",s,{name:"AES-GCM",length:128},!0,["decrypt","encrypt"])}async function YN(s,e){return await self.crypto.subtle.importKey("spki",s,{name:"RSASSA-PKCS1-v1_5",hash:e},!0,["verify"])}async function QN(s){return await self.crypto.subtle.importKey("pkcs8",s,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])}async function ZN(s){return new Uint8Array(await self.crypto.subtle.exportKey("raw",s))}async function ek(s){const e=await self.crypto.subtle.digest("SHA-256",s);return JN(new Uint8Array(e))}async function tk(s,e){const t=new Vy(s),r=await YN(Md(e),t.signatureAlgorithm.hash.name);return t.verify({publicKey:r},sk())}function sk(){return bg(ud({},self.crypto),{subtle:bg(ud({},self.crypto.subtle),{async verify(s,e,t,r){return self.crypto.subtle.verify(s,e,new Uint8Array(t),new Uint8Array(r))}})})}async function rk(s,e,t){const r=we.fromBER(e),a=new it({schema:r.content}),n=a.signerInfos[0].sid.issuer.typesAndValues.find(({type:u})=>u==="2.5.4.3").value.valueBlock.value,i=t.find(({userId:u})=>u===n);if(i===void 0)throw new Error("Signer not found in the users array");const o=le.fromBER(Md(i.certificate));return await a.verify({signer:0,trustedCerts:[o],data:s,checkChain:!0},nk())}class ak extends vc{verify(e,t,r,a){return super.verify(e,t,r,new Uint8Array(a))}}function nk(){return new ak({crypto:self.crypto})}var ik=Object.defineProperty,Ag=Object.getOwnPropertySymbols,ok=Object.prototype.hasOwnProperty,uk=Object.prototype.propertyIsEnumerable,Sg=(s,e,t)=>e in s?ik(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,lk=(s,e)=>{for(var t in e||(e={}))ok.call(e,t)&&Sg(s,t,e[t]);if(Ag)for(var t of Ag(e))uk.call(e,t)&&Sg(s,t,e[t]);return s};async function ck(s,e){Ze.debug("Decrypting private key",{privateKeyInfo:s,mnemonic:e});const t=await Promise.all([await gf(e,s.salt,{hash:"SHA-256",iterations:6e5}),await gf(e,s.salt,{hash:"SHA-1",iterations:1024}),await gf(e,s.salt,{hash:"SHA-1",iterations:6e5})]);for(const r of t)try{const a=await Hd(s.encryptedPrivateKey,r,{iv:s.iv,tagLength:128}),n=atob(FN(new Uint8Array(a)));return QN(Md(n))}catch(a){}throw new Error("Failed to decrypt private key")}async function gf(s,e,t){const r=await crypto.subtle.importKey("raw",new TextEncoder().encode(s.replaceAll(" ","")),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey(lk({name:"PBKDF2",salt:e},t),r,{name:"AES-GCM",length:256},!0,["decrypt","encrypt"])}const wf="apps/end_to_end_encryption/api/v2",Yw={PrivateKey:wf+"/private-key",Metadata:wf+"/meta-data/{fileId}",ServerKey:wf+"/server-key"};async function hk(){const s=(await Ig.get(xg(Yw.PrivateKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["private-key"],[e,t,r]=s.split("|");return{encryptedPrivateKey:Es(e),iv:Es(t),salt:Es(r)}}async function mk(){return await(await Ig.get(xg(Yw.ServerKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["public-key"]}const fk={name:"AlertCircleOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var dk=function(){var s=this,e=s._self._c;return e("span",s._b({staticClass:"material-design-icon alert-circle-outline-icon",attrs:{"aria-hidden":s.title?null:"true","aria-label":s.title,role:"img"},on:{click:function(t){return s.$emit("click",t)}}},"span",s.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:s.fillColor,width:s.size,height:s.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z"}},[s.title?e("title",[s._v(s._s(s.title))]):s._e()])])])},pk=[],gk=nm(fk,dk,pk,!1,null,null);const wk=gk.exports,yk={name:"CheckIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var vk=function(){var s=this,e=s._self._c;return e("span",s._b({staticClass:"material-design-icon check-icon",attrs:{"aria-hidden":s.title?null:"true","aria-label":s.title,role:"img"},on:{click:function(t){return s.$emit("click",t)}}},"span",s.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:s.fillColor,width:s.size,height:s.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}},[s.title?e("title",[s._v(s._s(s.title))]):s._e()])])])},bk=[],Ak=nm(yk,vk,bk,!1,null,null);const Sk=Ak.exports,Nk={name:"NcInputField",components:{NcButton:ly,AlertCircle:wk,Check:Sk},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:{value:{type:[String,Number],default:void 0},modelValue:{type:[String,Number],default:void 0},type:{type:String,default:"text",validator:s=>["text","password","email","tel","url","search","number"].includes(s)},label:{type:String,default:void 0},labelOutside:{type:Boolean,default:!1},placeholder:{type:String,default:void 0},showTrailingButton:{type:Boolean,default:!1},trailingButtonLabel:{type:String,default:""},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1},helperText:{type:String,default:""},disabled:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},inputClass:{type:[Object,String],default:""}},emits:["update:value","update:modelValue","update:model-value","trailing-button-click"],setup(){const s=Pg("value","update:value",!0);return{isLegacy32:Wd,model:s}},computed:{computedId(){return this.$attrs.id&&this.$attrs.id!==""?this.$attrs.id:this.inputName},inputName(){return"input"+cy()},hasTrailingIcon(){return this.success},computedPlaceholder(){if(this.placeholder)return this.placeholder;if(this.label)return Wd?this.label:""},isValidLabel(){const s=this.label||this.labelOutside;return s||hy.warn("You need to add a label to the NcInputField component. Either use the prop label or use an external one, as per the example in the documentation."),s},ariaDescribedby(){const s=[];return this.helperText.length>0&&s.push("".concat(this.inputName,"-helper-text")),this.$attrs["aria-describedby"]&&s.push(this.$attrs["aria-describedby"]),s.join(" ")||null}},methods:{focus(){this.$refs.input.focus()},select(){this.$refs.input.select()},handleInput(s){const e=this.type==="number"&&typeof this.model=="number"?parseFloat(s.target.value,10):s.target.value;this.model=e},handleTrailingButtonClick(s){this.$emit("trailing-button-click",s)}}};var kk=function(){var t;var s=this,e=s._self._c;return e("div",{staticClass:"input-field",class:{"input-field--disabled":s.disabled,"input-field--error":s.error,"input-field--label-outside":s.labelOutside||!s.isValidLabel,"input-field--leading-icon":!!s.$scopedSlots.icon||!!s.$scopedSlots.default||!!s.$slots.default,"input-field--success":s.success,"input-field--trailing-icon":s.showTrailingButton||s.hasTrailingIcon,"input-field--pill":s.pill,"input-field--legacy":s.isLegacy32}},[e("div",{staticClass:"input-field__main-wrapper"},[e("input",s._g(s._b({ref:"input",staticClass:"input-field__input",class:[s.inputClass,{"input-field__input--success":s.success,"input-field__input--error":s.error}],attrs:{id:s.computedId,type:s.type,disabled:s.disabled,placeholder:s.computedPlaceholder,"aria-describedby":s.ariaDescribedby,"aria-live":"polite"},domProps:{value:(t=s.model)==null?void 0:t.toString()},on:{input:s.handleInput}},"input",s.$attrs,!1),s.$listeners)),!s.labelOutside&&s.isValidLabel?e("label",{staticClass:"input-field__label",attrs:{for:s.computedId}},[s._v(" "+s._s(s.label)+" ")]):s._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:!!s.$scopedSlots.icon||!!s.$scopedSlots.default||!!s.$slots.default,expression:"!!$scopedSlots.icon || !!$scopedSlots.default || !!$slots.default"}],staticClass:"input-field__icon input-field__icon--leading"},[s._t("icon",function(){return[s._t("default")]})],2),s.showTrailingButton?e("NcButton",{staticClass:"input-field__trailing-button",attrs:{"aria-label":s.trailingButtonLabel,disabled:s.disabled,variant:"tertiary-no-background"},on:{click:s.handleTrailingButtonClick},scopedSlots:s._u([{key:"icon",fn:function(){return[s._t("trailing-button-icon")]},proxy:!0}],null,!0)}):s.success||s.error?e("div",{staticClass:"input-field__icon input-field__icon--trailing"},[s.success?e("Check",{staticStyle:{color:"var(--color-success-text)"},attrs:{size:20}}):s.error?e("AlertCircle",{staticStyle:{color:"var(--color-error-text)"},attrs:{size:20}}):s._e()],1):s._e()],1),s.helperText.length>0?e("p",{staticClass:"input-field__helper-text-message",class:{"input-field__helper-text-message--error":s.error,"input-field__helper-text-message--success":s.success},attrs:{id:"".concat(s.inputName,"-helper-text")}},[s.success?e("Check",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):s.error?e("AlertCircle",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):s._e(),s._v(" "+s._s(s.helperText)+" ")],1):s._e()])},Ek=[],Ck=nm(Nk,kk,Ek,!1,null,"a3ad91bd");const ld=Ck.exports;my(yy,wy);const Ik=new Set(Object.keys(ld.props)),xk={name:"NcTextField",components:{NcIconSvgWrapper:fy,NcInputField:ld},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:ps(ht({" ":{}},ld.props),{trailingButtonLabel:{type:String,default:""},trailingButtonIcon:{type:String,default:"close",validator:s=>["close","arrowEnd","arrowRight","undo"].includes(s)}}),emits:["update:value","update:modelValue","update:model-value"],setup(){return{model:Pg("value","update:value"),mdiArrowRight:dy,mdiClose:py,mdiUndo:gy}},computed:{isArrow(){return this.trailingButtonIcon==="arrowEnd"||this.trailingButtonIcon==="arrowRight"},propsAndAttrsToForward(){const s={arrowEnd:Ec("Save changes"),arrowRight:Ec("Save changes"),close:Ec("Clear text"),undo:Ec("Undo changes")};return ps(ht(ht({},this.$attrs),Object.fromEntries(Object.entries(this.$props).filter(([e])=>Ik.has(e)))),{trailingButtonLabel:this.trailingButtonLabel||s[this.trailingButtonIcon]})}},methods:{focus(){this.$refs.inputField.focus()},select(){this.$refs.inputField.select()}}};var Vk=function(){var s=this,e=s._self._c;return e("NcInputField",s._g(s._b({ref:"inputField",scopedSlots:s._u([s.$scopedSlots.icon||s.$slots.default||s.$scopedSlots.default?{key:"icon",fn:function(){return[s._t("icon",function(){return[s._t("default")]})]},proxy:!0}:null,s.type!=="search"?{key:"trailing-button-icon",fn:function(){return[s.isArrow?e("NcIconSvgWrapper",{attrs:{directional:"",path:s.mdiArrowRight}}):e("NcIconSvgWrapper",{attrs:{path:s.trailingButtonIcon==="undo"?s.mdiUndo:s.mdiClose}})]},proxy:!0}:null],null,!0)},"NcInputField",s.propsAndAttrsToForward,!1),s.$listeners))},Pk=[],Bk=nm(xk,Vk,Pk,!1,null,null);const Ok=Bk.exports,Dk=vy({__name:"MnemonicPromptDialog",emits:["close"],setup(s,{emit:e}){const t=gm(),r=gm(""),a=gm(!1),n=Gd(()=>a.value===!0&&r.value.trim().split(/\s+/g).length===12);function i(){e("close",r.value)}const o=Gd(()=>[{label:bf("end_to_en_encryption","Submit"),nativeType:"submit",type:"primary",disabled:!n.value,callback:i}]);return{__sfc:!0,emit:e,dialogRef:t,mnemonic:r,confirmToggle:a,isFormValid:n,submit:i,buttons:o,t:bf,NcDialog:Py,NcTextField:Ok,NcNoteCard:By,NcCheckboxRadioSwitch:Oy}}});var Tk=function(){var s=this,e=s._self._c,t=s._self._setupProxy;return e(t.NcDialog,{ref:"dialogRef",attrs:{name:t.t("end_to_end_encryption","Enter your 12 words mnemonic"),buttons:t.buttons,"is-form":!0},on:{submit:t.submit}},[e(t.NcNoteCard,{attrs:{type:"warning","show-alert":!0,heading:t.t("end_to_end_encryption","Decrypting your files in the browser can weaken security")}},[s._v(" "+s._s(t.t("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" "),e(t.NcCheckboxRadioSwitch,{attrs:{required:!0,"data-cy-e2ee-mnemonic-prompt":"i_understand_the_risks",type:"switch"},model:{value:t.confirmToggle,callback:function(r){t.confirmToggle=r},expression:"confirmToggle"}},[s._v(" "+s._s(t.t("end_to_end_encryption","I understand the risks"))+" ")])],1),e(t.NcTextField,{attrs:{value:t.mnemonic,required:"true",pattern:"^(\\w+\\s+){11}\\w+$",label:t.t("end_to_end_encryption","Mnemonic"),autofocus:!0},on:{"update:value":function(r){t.mnemonic=r}}})],1)},Rk=[],Lk=by(Dk,Tk,Rk,!1,null,null);const Uk=Lk.exports;async function jk(){const s=Promise.withResolvers();return Dy(Uk,void 0,e=>{e!==void 0?s.resolve(e):s.reject()}),s.promise}async function $k(s,e){Ze.debug("Decrypting metadata info",{metadata:s});const[t,r]=s.metadata.ciphertext.split("|"),a=await Hd(Es(t),e,{iv:Es(r)}),n=JSON.parse(await Hk(a));return Kk(n,s),await Mk(n,e),n}function Kk(s,e){var t,r;if(((t=s.keyChecksums)==null?void 0:t.length)!==((r=e.users)==null?void 0:r.length))throw new Error("Key checksums length does not match users length")}async function Mk(s,e){if(s.keyChecksums===void 0)return;const t=await ZN(e),r=await ek(t);if(!s.keyChecksums.includes(r))throw new Error("Key checksum is not in keyChecksums")}async function Hk(s){const e=new ReadableStream({start(t){t.enqueue(new Uint8Array(s)),t.close()}}).pipeThrough(new DecompressionStream("gzip"));return await new Response(e).text()}async function Fk(s,e,t){var r;Ze.debug("Getting metadata private key",{metadata:s,userId:e});const a=(r=s.users)==null?void 0:r.find(o=>o.userId===e);if(!a)throw new Error("User not found in metadata");const n=Es(a.encryptedMetadataKey),i=await zN(n,t);return await zw(new Uint8Array(i))}async function Ng(s,e,t){const r=JSON.stringify(s,(n,i)=>{if(n!=="filedrop")return i}),a=await rk(Xw(btoa(r)),Es(e),t.users);if(!a)throw new Error("Metadata signature verification failed");return a}async function Jk(s,e){const t=s.users.map(async({userId:r,certificate:a})=>{const n=await tk(a,e);if(!n)throw new Error("Certificate verification failed for user ".concat(r));return n});return await Promise.all(t)}const qk=Hv(),gt={_userPrivateKey:void 0,_serverPublicKey:void 0,_metadataCache:{},async getUserPrivateKey(){var s;return(s=this._userPrivateKey)!=null||(this._userPrivateKey=await ck(await hk(),await jk())),this._userPrivateKey},async getServerPublicKeyPEM(){var s;return(s=this._serverPublicKey)!=null||(this._serverPublicKey=await mk()),this._serverPublicKey},async getMetadata(s){if(this._metadataCache[s])return Ze.debug("Found metadata in cache",{path:s,state:gt}),this._metadataCache[s];if(Ze.debug("Fetching PROPFIND for metadata",{path:s,state:gt}),await qk.stat(decodeURI(s).replace("remote.php/dav/",""),{details:!0,data:jv()}),this._metadataCache[s])return Ze.debug("Found metadata in cache after PROPFIND",{path:s,state:gt}),this._metadataCache[s];throw new Error("Could not find metadata for ".concat(s))},async setMetadata(s,e,t){const r=JSON.parse(e);nh(r)?(await Ng(r,t,r),await Jk(r,await this.getServerPublicKeyPEM())):await Ng(r,t,await this.getRootMetadata(To.dirname(s))),this._metadataCache[s]=r,Ze.debug("Added metadata in cache",{path:s,state:gt})},async getMetadataInfo(s){const e=await this.getMetadata(s),t=await this.getRootMetadata(s),r=cd();if(r===null)throw new Error("No user logged in");return $k(e,await Fk(t,r.uid,await gt.getUserPrivateKey()))},async getRootMetadata(s){const e=Object.entries(gt._metadataCache).filter(([t])=>s.startsWith(t)).map(([,t])=>t).find(t=>nh(t));if(e)return Ze.debug("Found root metadata in cache",{path:s,state:gt}),e;for(Ze.debug("Looking for root metadata",{path:s,state:gt});s!=="/";){const t=await gt.getMetadata(s);if(nh(t))return Ze.debug("Fetched root metadata",{path:s,state:gt}),t;s=To.dirname(s)}throw new Error("Found no root metadata for ".concat(s))}};var _k=Object.defineProperty,Wk=Object.defineProperties,Gk=Object.getOwnPropertyDescriptors,kg=Object.getOwnPropertySymbols,Xk=Object.prototype.hasOwnProperty,zk=Object.prototype.propertyIsEnumerable,Eg=(s,e,t)=>e in s?_k(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Yk=(s,e)=>{for(var t in e||(e={}))Xk.call(e,t)&&Eg(s,t,e[t]);if(kg)for(var t of kg(e))zk.call(e,t)&&Eg(s,t,e[t]);return s},Qk=(s,e)=>Wk(s,Gk(e));let am;function Zk(){am=window.fetch,Ze.debug("Setting up WebDAV decryption proxy"),window.fetch=async(s,e={})=>{let t=new Request(s,e);if(!(t.url.includes("/remote.php/dav/files/")&&(t.method==="GET"||t.method==="PROPFIND")))return am(t);Ze.debug("Proxying ".concat(t.method," ").concat(t.url),{request:t});const r=new Headers(t.headers);switch(r.set("X-E2EE-SUPPORTED","true"),t=new Request(t,{headers:r}),t.method){case"PROPFIND":return tE(t);case"GET":default:return eE(t)}}}async function eE(s){const e=new URL(s.url).pathname,t=am(s);try{const r=await gt.getMetadataInfo(To.dirname(e)),a=r.files[To.basename(s.url)];if(a===void 0)throw Ze.debug("Could not find file in metadata",{path:e,metadataInfo:r}),new Error("Could not find file in metadata");return await sE(await t,a)}catch(r){return await t}}async function tE(s){var e;Ze.debug("Fetching raw PROPFIND",{request:s});const t=await am(s),r=new URL(s.url).pathname,a=await t.text(),n=await Nc(a),i=ew(n,r,!0);if(((e=i.props)==null?void 0:e["e2ee-is-encrypted"])!==1)return Ze.debug("Node is not e2ee",{xml:n}),new Response(a,t);if(i.type==="directory"){const o=i.props["e2ee-metadata"],u=i.props["e2ee-metadata-signature"];o!==void 0&&u!==void 0&&await gt.setMetadata(r,o,u);const c=await gt.getMetadata(r),l=await gt.getMetadataInfo(r);if(nh(c))yf(n,r,l);else{const m=await gt.getMetadataInfo(To.dirname(r));yf(n,r,l,m)}}else if(i.type==="file"){const o=await gt.getMetadataInfo(To.dirname(r));if(o===void 0)return Ze.debug("Cannot find metadata for parent folder",{path:r}),new Response(a,t);yf(n,r,void 0,o)}return new Response(new O1.XMLBuilder().build(n),t)}function yf(s,e,t,r){Ze.debug("Updating PROPFIND info",{path:e,decryptedMetadata:t,decryptedParentMetadata:r,xml:s}),s.multistatus.response.forEach(a=>{if(a.propstat===void 0)return;const n=a.href===e?r:t,i=a.propstat.prop.displayname;let o=i;n!==void 0&&(n.files[i]?(o=n.files[i].filename,a.propstat.prop.getcontenttype=n.files[i].mimetype):n.folders[i]&&(o=n.folders[i],a.propstat.prop.getcontenttype="httpd/unix-directory")),a.propstat.prop.displayname=o,a.propstat.prop.permissions=a.propstat.prop.permissions.replace(/(R)|(D)|(N)|(V)|(W)|(CK)/g,"")})}async function sE(s,e){Ze.debug("Decrypting encrypted file",{response:s,fileEncryptionInfo:e});const t=await Hd(new Uint8Array(await s.arrayBuffer()),await zw(Es(e.key)),{iv:Es(e.nonce)}),r=new Headers(s.headers);return r.set("Content-Type",e.mimetype),new Response(t,Qk(Yk({},s),{headers:r}))}const rE='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-arrow-down" viewBox="0 0 24 24"><path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" /></svg>';function aE(s){if(!(s.permissions&lw.READ))return!1;if(s.attributes["share-attributes"]){const e=JSON.parse(s.attributes["share-attributes"]||"[]").find(({scope:t,key:r})=>t==="permissions"&&r==="download");if(e!==void 0)return e.value===!0}return!0}async function nE([s]){const e=await(await fetch(s.encodedSource)).arrayBuffer(),t=new Blob([e],{type:s.mime}),r=document.createElement("a");r.href=window.URL.createObjectURL(t),r.download=s.displayname,r.click()}const iE=new ab({id:"download_unencrypted",default:Ad.DEFAULT,displayName:()=>bf("files","Download unencrypted"),iconSvgInline:()=>rE,enabled(s){return s.length!==1||s.some(e=>e.attributes["e2ee-is-encrypted"]!==1)||s.some(e=>!e.isDavRessource)||s.some(e=>e.type!==uw.File)?!1:s.every(aE)},async exec(s){return nE([s]),null},order:30}),oE=Ay("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1});oE.e2eeInBrowserEnabled&&(Zk(),Im("nc:e2ee-is-encrypted",{nc:"http://nextcloud.org/ns"}),Im("nc:e2ee-metadata",{nc:"http://nextcloud.org/ns"}),Im("nc:e2ee-metadata-signature",{nc:"http://nextcloud.org/ns"}),nb(iE),Cg("download"),Cg("move-copy"));function Cg(s){Ze.debug("Inhibiting ".concat(s," actions for e2ee files"));const e=ib().find(r=>r.id===s),t=e._action.enabled;e._action.enabled=(r,a)=>r.some(n=>n.attributes["e2ee-is-encrypted"]===1)?!1:t(r,a)}
//# sourceMappingURL=end_to_end_encryption-files.mjs.map
