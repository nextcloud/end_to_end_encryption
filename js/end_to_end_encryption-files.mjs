(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(`/*!
 * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors
 * SPDX-License-Identifier: AGPL-3.0-or-later
 */.toastify.dialogs{min-width:200px;background:none;background-color:var(--color-main-background);color:var(--color-main-text);box-shadow:0 0 6px 0 var(--color-box-shadow);padding:0 12px;margin-top:45px;position:fixed;z-index:10100;border-radius:var(--border-radius);display:flex;align-items:center;min-height:50px}.toastify.dialogs .toast-loader-container,.toastify.dialogs .toast-undo-container{display:flex;align-items:center;width:100%}.toastify.dialogs .toast-undo-button,.toastify.dialogs .toast-close{position:static;overflow:hidden;box-sizing:border-box;min-width:44px;height:100%;padding:12px;white-space:nowrap;background-repeat:no-repeat;background-position:center;background-color:transparent;min-height:0}.toastify.dialogs .toast-undo-button.toast-close,.toastify.dialogs .toast-close.toast-close{text-indent:0;opacity:.4;border:none;min-height:44px;margin-left:10px;font-size:0}.toastify.dialogs .toast-undo-button.toast-close:before,.toastify.dialogs .toast-close.toast-close:before{background-image:url("data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e");content:" ";filter:var(--background-invert-if-dark);display:inline-block;width:16px;height:16px}.toastify.dialogs .toast-undo-button.toast-undo-button,.toastify.dialogs .toast-close.toast-undo-button{height:calc(100% - 6px);margin:3px 3px 3px 12px}.toastify.dialogs .toast-undo-button:hover,.toastify.dialogs .toast-undo-button:focus,.toastify.dialogs .toast-undo-button:active,.toastify.dialogs .toast-close:hover,.toastify.dialogs .toast-close:focus,.toastify.dialogs .toast-close:active{cursor:pointer;opacity:1}.toastify.dialogs.toastify-top{right:10px}.toastify.dialogs.toast-with-click{cursor:pointer}.toastify.dialogs.toast-error{border-left:3px solid var(--color-element-error, var(--color-error))}.toastify.dialogs.toast-info{border-left:3px solid var(--color-element-info, var(--color-primary))}.toastify.dialogs.toast-warning{border-left:3px solid var(--color-element-warning, var(--color-warning))}.toastify.dialogs.toast-success,.toastify.dialogs.toast-undo{border-left:3px solid var(--color-element-success, var(--color-success))}.toastify.dialogs.toast-loading{border-left:3px solid var(--color-element-info, var(--color-primary))}.toastify.dialogs.toast-loading .toast-loader{display:inline-block;width:20px;height:20px;animation:rotate var(--animation-duration, .8s) linear infinite;margin-left:auto}.theme--dark .toastify.dialogs .toast-close.toast-close:before{background-image:url("data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill:%23fff;fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e")}.nc-generic-dialog .dialog__actions{justify-content:space-between;min-width:calc(100% - 12px)}._pickerEntry_xk2pl_1:not(:last-of-type){border-bottom:1px solid var(--color-border)}._pickerEntryItem_xk2pl_5{display:flex;align-items:center;height:64px}._pickerEntryIcon_xk2pl_11,._pickerEntryPreview_xk2pl_12{height:64px;width:64px;margin:0 var(--secondary-margin);display:block;flex:0 0 64px}._pickerEntryIcon_xk2pl_11{color:var(--color-text-maxcontrast)}._pickerEntryIcon_folder_xk2pl_24{color:var(--color-primary-element)}._pickerEntryPreview_xk2pl_12{overflow:hidden;border-radius:calc(var(--border-radius) * 2);object-fit:cover}._pickerEntryDescription_xk2pl_34{display:flex;flex-direction:column}._pickerEntryDescription_xk2pl_34 span{white-space:nowrap}._picker_6q4ek_1{--margin: 36px;--secondary-margin: 18px}._pickerHeader_6q4ek_6{position:sticky;z-index:10;top:0;padding:0 var(--margin);padding-bottom:var(--secondary-margin);background-color:var(--color-main-background)}._pickerForm_6q4ek_15{position:relative;overflow:auto;padding:0 var(--margin);margin-top:calc(-1 * var(--secondary-margin))}._pickerActionSubmit_disabled_6q4ek_22{opacity:.7;filter:saturate(50%)}._pickerSelectAll_6q4ek_27{display:grid;width:100%;margin-top:calc(var(--secondary-margin) * 1.5);padding-bottom:var(--secondary-margin);grid-template-columns:1fr 1fr}._pickerSelectAll_6q4ek_27 legend{display:flex;align-items:center;width:100%;margin-bottom:calc(var(--secondary-margin) / 2)}._pickerSelectAll_6q4ek_27._conflict-picker__all_6q4ek_40{position:sticky;top:0;margin:0;padding:var(--secondary-margin) 0;background-image:linear-gradient(to top,transparent,var(--color-main-background-blur) 10%,var(--color-main-background) 15%)}._pickerSelectAll_6q4ek_27._conflict-picker__all_6q4ek_40+fieldset{margin-top:0}._pickerSelectAll_6q4ek_27._conflict-picker__all_6q4ek_40 :deep(label){font-weight:700}._file-picker__file-icon_3v9zx_9{position:relative;width:32px;height:32px;min-width:32px;min-height:32px;background-repeat:no-repeat;background-size:contain;display:flex;justify-content:center}._file-picker__file-icon--primary_3v9zx_21{color:var(--color-primary-element)}._file-picker__file-icon-overlay_3v9zx_25{color:var(--color-primary-element-text);position:absolute;inset-block-start:10px}tr.file-picker__row[data-v-bfa2ae80]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-bfa2ae80]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-bfa2ae80]{padding:0 2px}tr.file-picker__row td[data-v-bfa2ae80]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-bfa2ae80]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-bfa2ae80]{padding-inline:2px 0}.file-picker__row--selected[data-v-bfa2ae80]{background-color:var(--color-background-dark)}.file-picker__row[data-v-bfa2ae80]:hover{background-color:var(--color-background-hover)}.file-picker__name-container[data-v-bfa2ae80]{display:flex;justify-content:start;align-items:center;height:100%}.file-picker__file-name[data-v-bfa2ae80]{padding-inline-start:6px;min-width:0;overflow:hidden;text-overflow:ellipsis}.file-picker__file-extension[data-v-bfa2ae80]{color:var(--color-text-maxcontrast);min-width:fit-content}/*!
* SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors
* SPDX-License-Identifier: AGPL-3.0-or-later
*/tr.file-picker__row[data-v-1f96131b]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-1f96131b]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-1f96131b]{padding:0 2px}tr.file-picker__row td[data-v-1f96131b]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-1f96131b]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-1f96131b]{padding-inline:2px 0}@keyframes gradient-1f96131b{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}.loading-row .row-checkbox[data-v-1f96131b]{text-align:center!important}.loading-row span[data-v-1f96131b]{display:inline-block;height:24px;background:linear-gradient(to right,var(--color-background-darker),var(--color-text-maxcontrast),var(--color-background-darker));background-size:600px 100%;border-radius:var(--border-radius);animation:gradient-1f96131b 12s ease infinite}.loading-row .row-wrapper[data-v-1f96131b]{display:inline-flex;align-items:center}.loading-row .row-checkbox span[data-v-1f96131b]{width:24px}.loading-row .row-name span[data-v-1f96131b]:last-of-type{margin-inline-start:6px;width:130px}.loading-row .row-size span[data-v-1f96131b]{width:80px}.loading-row .row-modified span[data-v-1f96131b]{width:90px}.file-picker__header-preview[data-v-149cddc3]{width:22px;height:32px;flex:0 0 auto}.file-picker__files[data-v-149cddc3]{margin:2px;margin-inline-start:12px;overflow:scroll auto}.file-picker__files table[data-v-149cddc3]{width:100%;max-height:100%;table-layout:fixed}.file-picker__files th[data-v-149cddc3]{position:sticky;z-index:1;top:0;background-color:var(--color-main-background);padding:2px}.file-picker__files th .header-wrapper[data-v-149cddc3]{display:flex}.file-picker__files th.row-checkbox[data-v-149cddc3]{width:44px}.file-picker__files th.row-name[data-v-149cddc3]{width:230px}.file-picker__files th.row-size[data-v-149cddc3]{width:100px}.file-picker__files th.row-modified[data-v-149cddc3]{width:120px}.file-picker__files th[data-v-149cddc3]:not(.row-size) .button-vue__wrapper{justify-content:start;flex-direction:row-reverse}.file-picker__files th[data-v-149cddc3]:not(.row-size) .button-vue{padding-inline:16px 4px}.file-picker__files th.row-size[data-v-149cddc3] .button-vue__wrapper{justify-content:end}.file-picker__files th[data-v-149cddc3] .button-vue__wrapper{color:var(--color-text-maxcontrast)}.file-picker__files th[data-v-149cddc3] .button-vue__wrapper .button-vue__text{font-weight:400}.file-picker__breadcrumbs[data-v-4e6fd4e4]{flex-grow:0!important}.file-picker__side[data-v-86223490]{display:flex;flex-direction:column;align-items:stretch;gap:.5rem;min-width:200px;padding:2px;margin-block-start:7px;overflow:auto}.file-picker__side[data-v-86223490] .button-vue__wrapper{justify-content:start}.file-picker__filter-input[data-v-86223490]{margin-block:7px;max-width:260px}@media (max-width: 736px){.file-picker__side[data-v-86223490]{flex-direction:row;min-width:unset}}@media (max-width: 512px){.file-picker__side[data-v-86223490]{flex-direction:row;min-width:unset}.file-picker__filter-input[data-v-86223490]{max-width:unset}}.file-picker__navigation{padding-inline:8px 2px}.file-picker__navigation,.file-picker__navigation *{box-sizing:border-box}.file-picker__navigation .v-select.select{min-width:220px}@media (min-width: 513px) and (max-width: 736px){.file-picker__navigation{gap:11px}}@media (max-width: 512px){.file-picker__navigation{flex-direction:column-reverse!important}}.file-picker__view[data-v-ce116f72]{height:50px;display:flex;justify-content:start;align-items:center}.file-picker__view h3[data-v-ce116f72]{font-weight:700;height:fit-content;margin:0}.file-picker__main[data-v-ce116f72]{box-sizing:border-box;width:100%;display:flex;flex-direction:column;min-height:0;flex:1;padding-inline:2px}.file-picker__main[data-v-ce116f72] *{box-sizing:border-box}[data-v-ce116f72] .file-picker{height:min(80vh,800px)!important}@media (max-width: 512px){[data-v-ce116f72] .file-picker{height:calc(100% - 16px - var(--default-clickable-area))!important}}[data-v-ce116f72] .file-picker__content{display:flex;flex-direction:column;overflow:hidden}.public-auth-prompt__text[data-v-b33d88e5]{font-size:1.25em;margin-block:0 calc(3 * var(--default-grid-baseline))}.public-auth-prompt__header[data-v-b33d88e5]{margin-block:0 calc(3 * var(--default-grid-baseline))}.public-auth-prompt__header[data-v-b33d88e5]:first-child{margin-top:0}.public-auth-prompt__input[data-v-b33d88e5]{margin-block:calc(4 * var(--default-grid-baseline)) calc(2 * var(--default-grid-baseline))}`)),document.head.appendChild(e)}}catch(i){console.error("vite-plugin-css-injected-by-js",i)}})();
import{p as at,g as jt,a as ow,b as Jd,U as uw,c as cw,o as lw,d as hw,B as sm,t as ya,e as qd,v as Wd,l as Ze,f as mw,r as rm,h as Ep,i as fw,j as pw,w as am,k as nm,u as Vs,N as dw,m as Cp,n as kp,q as gw,_ as ww,s as yw,x as vw,y as bw}from"./NcTextField.vue_vue_type_script_setup_true_lang-Dl9AQfwW-Ddcf3db-.chunk.mjs";import{f as Ge,B as xe,s as ko,a as Ch,O as Y,N as et,g as d,S as O,I as H,C as U,R as he,c as X,b as z,d as re,e as we,h as Le,A as ue,P as oe,i as Ae,j as tt,k as el,n as Aw,l as tl,m as kh,u as vo,t as of,G as Ue,o as ha,U as uf,T as cf,p as Js,q as lf,r as Ih,v as hf,w as Gd,x as ql,V as Sw,y as Nw,z as Ew,D as Cw,E as kw,F as sl,H as Iw,J as Ip,K as Vp,X as Vw,L as Io}from"./x509.es-7SkES3FK.chunk.mjs";function Xd(r,e,t){const s=document.querySelector(`#initial-state-${r}-${e}`);if(s===null)return t;try{return JSON.parse(atob(s.value))}catch{throw new Error(`Could not parse initial state ${e} of ${r}`)}}function zd(){return Xd("files_sharing","isPublic",null)??document.querySelector('input#isPublic[type="hidden"][name="isPublic"][value="1"]')!==null}function xw(){return Xd("files_sharing","sharingToken",null)??document.querySelector('input#sharingToken[type="hidden"]')?.value??null}function cr(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function xp(r,e,t){Bw(r,e),e.set(r,t)}function Bw(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function dt(r,e){var t=Yd(r,e,"get");return Ow(r,t)}function Ow(r,e){return e.get?e.get.call(r):e.value}function Bp(r,e,t){var s=Yd(r,e,"set");return Pw(r,s,t),t}function Yd(r,e,t){if(!e.has(r))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(r)}function Pw(r,e,t){if(e.set)e.set.call(r,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}var Dw=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",yt=new WeakMap,Lo=new WeakMap;class Gh{constructor(e){var{executor:t=()=>{},internals:s=Hf(),promise:a=new Promise((n,i)=>t(n,i,o=>{s.onCancelList.push(o)}))}=e;xp(this,yt,{writable:!0,value:void 0}),xp(this,Lo,{writable:!0,value:void 0}),cr(this,Dw,"CancelablePromise"),this.cancel=this.cancel.bind(this),Bp(this,yt,s),Bp(this,Lo,a||new Promise((n,i)=>t(n,i,o=>{s.onCancelList.push(o)})))}then(e,t){return Wl(dt(this,Lo).then(dl(e,dt(this,yt)),dl(t,dt(this,yt))),dt(this,yt))}catch(e){return Wl(dt(this,Lo).catch(dl(e,dt(this,yt))),dt(this,yt))}finally(e,t){return t&&dt(this,yt).onCancelList.push(e),Wl(dt(this,Lo).finally(dl(()=>{if(e)return t&&(dt(this,yt).onCancelList=dt(this,yt).onCancelList.filter(s=>s!==e)),e()},dt(this,yt))),dt(this,yt))}cancel(){dt(this,yt).isCanceled=!0;var e=dt(this,yt).onCancelList;dt(this,yt).onCancelList=[];for(var t of e)if(typeof t=="function")try{t()}catch(s){console.error(s)}}isCanceled(){return dt(this,yt).isCanceled===!0}}class lr extends Gh{constructor(e){super({executor:e})}}cr(lr,"all",function(r){return gl(r,Promise.all(r))}),cr(lr,"allSettled",function(r){return gl(r,Promise.allSettled(r))}),cr(lr,"any",function(r){return gl(r,Promise.any(r))}),cr(lr,"race",function(r){return gl(r,Promise.race(r))}),cr(lr,"resolve",function(r){return Op(Promise.resolve(r))}),cr(lr,"reject",function(r){return Op(Promise.reject(r))}),cr(lr,"isCancelable",Mf);function Op(r){return Wl(r,Hf())}function Mf(r){return r instanceof lr||r instanceof Gh}function dl(r,e){if(r)return t=>{if(!e.isCanceled){var s=r(t);return Mf(s)&&e.onCancelList.push(s.cancel),s}return t}}function Wl(r,e){return new Gh({internals:e,promise:r})}function gl(r,e){var t=Hf();return t.onCancelList.push(()=>{for(var s of r)Mf(s)&&s.cancel()}),new Gh({internals:t,promise:e})}function Hf(){return{isCanceled:!1,onCancelList:[]}}var im={},Tw={2:r=>{function e(a,n,i){a instanceof RegExp&&(a=t(a,i)),n instanceof RegExp&&(n=t(n,i));var o=s(a,n,i);return o&&{start:o[0],end:o[1],pre:i.slice(0,o[0]),body:i.slice(o[0]+a.length,o[1]),post:i.slice(o[1]+n.length)}}function t(a,n){var i=n.match(a);return i?i[0]:null}function s(a,n,i){var o,h,u,c,f,m=i.indexOf(a),y=i.indexOf(n,m+1),w=m;if(m>=0&&y>0){for(o=[],u=i.length;w>=0&&!f;)w==m?(o.push(w),m=i.indexOf(a,w+1)):o.length==1?f=[o.pop(),y]:((h=o.pop())<u&&(u=h,c=y),y=i.indexOf(n,w+1)),w=m<y&&m>=0?m:y;o.length&&(f=[u,c])}return f}r.exports=e,e.range=s},101:function(r,e,t){var s;r=t.nmd(r),function(a){var n=(r&&r.exports,typeof jt=="object"&&jt);n.global!==n&&n.window;var i=function(f){this.message=f};(i.prototype=new Error).name="InvalidCharacterError";var o=function(f){throw new i(f)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=/[\t\n\f\r ]/g,c={encode:function(f){f=String(f),/[^\0-\xFF]/.test(f)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var m,y,w,S,v=f.length%3,C="",p=-1,b=f.length-v;++p<b;)m=f.charCodeAt(p)<<16,y=f.charCodeAt(++p)<<8,w=f.charCodeAt(++p),C+=h.charAt((S=m+y+w)>>18&63)+h.charAt(S>>12&63)+h.charAt(S>>6&63)+h.charAt(63&S);return v==2?(m=f.charCodeAt(p)<<8,y=f.charCodeAt(++p),C+=h.charAt((S=m+y)>>10)+h.charAt(S>>4&63)+h.charAt(S<<2&63)+"="):v==1&&(S=f.charCodeAt(p),C+=h.charAt(S>>2)+h.charAt(S<<4&63)+"=="),C},decode:function(f){var m=(f=String(f).replace(u,"")).length;m%4==0&&(m=(f=f.replace(/==?$/,"")).length),(m%4==1||/[^+a-zA-Z0-9/]/.test(f))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var y,w,S=0,v="",C=-1;++C<m;)w=h.indexOf(f.charAt(C)),y=S%4?64*y+w:w,S++%4&&(v+=String.fromCharCode(255&y>>(-2*S&6)));return v},version:"1.0.0"};(s=function(){return c}.call(e,t,e,r))===void 0||(r.exports=s)}()},172:(r,e)=>{e.d=function(t){if(!t)return 0;for(var s=(t=t.toString()).length,a=t.length;a--;){var n=t.charCodeAt(a);56320<=n&&n<=57343&&a--,127<n&&n<=2047?s++:2047<n&&n<=65535&&(s+=2)}return s}},526:r=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var s=[],a=0;a<t.length;a++)s.push(255&t.charCodeAt(a));return s},bytesToString:function(t){for(var s=[],a=0;a<t.length;a++)s.push(String.fromCharCode(t[a]));return s.join("")}}};r.exports=e},298:r=>{var e,t;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(s,a){return s<<a|s>>>32-a},rotr:function(s,a){return s<<32-a|s>>>a},endian:function(s){if(s.constructor==Number)return 16711935&t.rotl(s,8)|4278255360&t.rotl(s,24);for(var a=0;a<s.length;a++)s[a]=t.endian(s[a]);return s},randomBytes:function(s){for(var a=[];s>0;s--)a.push(Math.floor(256*Math.random()));return a},bytesToWords:function(s){for(var a=[],n=0,i=0;n<s.length;n++,i+=8)a[i>>>5]|=s[n]<<24-i%32;return a},wordsToBytes:function(s){for(var a=[],n=0;n<32*s.length;n+=8)a.push(s[n>>>5]>>>24-n%32&255);return a},bytesToHex:function(s){for(var a=[],n=0;n<s.length;n++)a.push((s[n]>>>4).toString(16)),a.push((15&s[n]).toString(16));return a.join("")},hexToBytes:function(s){for(var a=[],n=0;n<s.length;n+=2)a.push(parseInt(s.substr(n,2),16));return a},bytesToBase64:function(s){for(var a=[],n=0;n<s.length;n+=3)for(var i=s[n]<<16|s[n+1]<<8|s[n+2],o=0;o<4;o++)8*n+6*o<=8*s.length?a.push(e.charAt(i>>>6*(3-o)&63)):a.push("=");return a.join("")},base64ToBytes:function(s){s=s.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],n=0,i=0;n<s.length;i=++n%4)i!=0&&a.push((e.indexOf(s.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|e.indexOf(s.charAt(n))>>>6-2*i);return a}},r.exports=t},635:(r,e,t)=>{const s=t(31),a=t(338),n=t(221);r.exports={XMLParser:a,XMLValidator:s,XMLBuilder:n}},118:r=>{r.exports=function(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const s of e)if(typeof s=="string"&&t===s||s instanceof RegExp&&s.test(t))return!0}:()=>!1}},705:(r,e)=>{const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",s="["+t+"]["+t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",a=new RegExp("^"+s+"$");e.isExist=function(n){return n!==void 0},e.isEmptyObject=function(n){return Object.keys(n).length===0},e.merge=function(n,i,o){if(i){const h=Object.keys(i),u=h.length;for(let c=0;c<u;c++)n[h[c]]=o==="strict"?[i[h[c]]]:i[h[c]]}},e.getValue=function(n){return e.isExist(n)?n:""},e.isName=function(n){return a.exec(n)!=null},e.getAllMatches=function(n,i){const o=[];let h=i.exec(n);for(;h;){const u=[];u.startIndex=i.lastIndex-h[0].length;const c=h.length;for(let f=0;f<c;f++)u.push(h[f]);o.push(u),h=i.exec(n)}return o},e.nameRegexp=s},31:(r,e,t)=>{const s=t(705),a={allowBooleanAttributes:!1,unpairedTags:[]};function n(p){return p===" "||p==="	"||p===`
`||p==="\r"}function i(p,b){const k=b;for(;b<p.length;b++)if(!(p[b]!="?"&&p[b]!=" ")){const P=p.substr(k,b-k);if(b>5&&P==="xml")return w("InvalidXml","XML declaration allowed only at the start of the document.",v(p,b));if(p[b]=="?"&&p[b+1]==">"){b++;break}}return b}function o(p,b){if(p.length>b+5&&p[b+1]==="-"&&p[b+2]==="-"){for(b+=3;b<p.length;b++)if(p[b]==="-"&&p[b+1]==="-"&&p[b+2]===">"){b+=2;break}}else if(p.length>b+8&&p[b+1]==="D"&&p[b+2]==="O"&&p[b+3]==="C"&&p[b+4]==="T"&&p[b+5]==="Y"&&p[b+6]==="P"&&p[b+7]==="E"){let k=1;for(b+=8;b<p.length;b++)if(p[b]==="<")k++;else if(p[b]===">"&&(k--,k===0))break}else if(p.length>b+9&&p[b+1]==="["&&p[b+2]==="C"&&p[b+3]==="D"&&p[b+4]==="A"&&p[b+5]==="T"&&p[b+6]==="A"&&p[b+7]==="["){for(b+=8;b<p.length;b++)if(p[b]==="]"&&p[b+1]==="]"&&p[b+2]===">"){b+=2;break}}return b}e.validate=function(p,b){b=Object.assign({},a,b);const k=[];let P=!1,x=!1;p[0]==="\uFEFF"&&(p=p.substr(1));for(let B=0;B<p.length;B++)if(p[B]==="<"&&p[B+1]==="?"){if(B+=2,B=i(p,B),B.err)return B}else{if(p[B]!=="<"){if(n(p[B]))continue;return w("InvalidChar","char '"+p[B]+"' is not expected.",v(p,B))}{let V=B;if(B++,p[B]==="!"){B=o(p,B);continue}{let J=!1;p[B]==="/"&&(J=!0,B++);let F="";for(;B<p.length&&p[B]!==">"&&p[B]!==" "&&p[B]!=="	"&&p[B]!==`
`&&p[B]!=="\r";B++)F+=p[B];if(F=F.trim(),F[F.length-1]==="/"&&(F=F.substring(0,F.length-1),B--),T=F,!s.isName(T)){let ee;return ee=F.trim().length===0?"Invalid space after '<'.":"Tag '"+F+"' is an invalid name.",w("InvalidTag",ee,v(p,B))}const D=c(p,B);if(D===!1)return w("InvalidAttr","Attributes for '"+F+"' have open quote.",v(p,B));let j=D.value;if(B=D.index,j[j.length-1]==="/"){const ee=B-j.length;j=j.substring(0,j.length-1);const _=m(j,b);if(_!==!0)return w(_.err.code,_.err.msg,v(p,ee+_.err.line));P=!0}else if(J){if(!D.tagClosed)return w("InvalidTag","Closing tag '"+F+"' doesn't have proper closing.",v(p,B));if(j.trim().length>0)return w("InvalidTag","Closing tag '"+F+"' can't have attributes or invalid starting.",v(p,V));if(k.length===0)return w("InvalidTag","Closing tag '"+F+"' has not been opened.",v(p,V));{const ee=k.pop();if(F!==ee.tagName){let _=v(p,ee.tagStartPos);return w("InvalidTag","Expected closing tag '"+ee.tagName+"' (opened in line "+_.line+", col "+_.col+") instead of closing tag '"+F+"'.",v(p,V))}k.length==0&&(x=!0)}}else{const ee=m(j,b);if(ee!==!0)return w(ee.err.code,ee.err.msg,v(p,B-j.length+ee.err.line));if(x===!0)return w("InvalidXml","Multiple possible root nodes found.",v(p,B));b.unpairedTags.indexOf(F)!==-1||k.push({tagName:F,tagStartPos:V}),P=!0}for(B++;B<p.length;B++)if(p[B]==="<"){if(p[B+1]==="!"){B++,B=o(p,B);continue}if(p[B+1]!=="?")break;if(B=i(p,++B),B.err)return B}else if(p[B]==="&"){const ee=y(p,B);if(ee==-1)return w("InvalidChar","char '&' is not expected.",v(p,B));B=ee}else if(x===!0&&!n(p[B]))return w("InvalidXml","Extra text at the end",v(p,B));p[B]==="<"&&B--}}}var T;return P?k.length==1?w("InvalidTag","Unclosed tag '"+k[0].tagName+"'.",v(p,k[0].tagStartPos)):!(k.length>0)||w("InvalidXml","Invalid '"+JSON.stringify(k.map(B=>B.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):w("InvalidXml","Start tag expected.",1)};const h='"',u="'";function c(p,b){let k="",P="",x=!1;for(;b<p.length;b++){if(p[b]===h||p[b]===u)P===""?P=p[b]:P!==p[b]||(P="");else if(p[b]===">"&&P===""){x=!0;break}k+=p[b]}return P===""&&{value:k,index:b,tagClosed:x}}const f=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function m(p,b){const k=s.getAllMatches(p,f),P={};for(let x=0;x<k.length;x++){if(k[x][1].length===0)return w("InvalidAttr","Attribute '"+k[x][2]+"' has no space in starting.",C(k[x]));if(k[x][3]!==void 0&&k[x][4]===void 0)return w("InvalidAttr","Attribute '"+k[x][2]+"' is without value.",C(k[x]));if(k[x][3]===void 0&&!b.allowBooleanAttributes)return w("InvalidAttr","boolean attribute '"+k[x][2]+"' is not allowed.",C(k[x]));const T=k[x][2];if(!S(T))return w("InvalidAttr","Attribute '"+T+"' is an invalid name.",C(k[x]));if(P.hasOwnProperty(T))return w("InvalidAttr","Attribute '"+T+"' is repeated.",C(k[x]));P[T]=1}return!0}function y(p,b){if(p[++b]===";")return-1;if(p[b]==="#")return function(P,x){let T=/\d/;for(P[x]==="x"&&(x++,T=/[\da-fA-F]/);x<P.length;x++){if(P[x]===";")return x;if(!P[x].match(T))break}return-1}(p,++b);let k=0;for(;b<p.length;b++,k++)if(!(p[b].match(/\w/)&&k<20)){if(p[b]===";")break;return-1}return b}function w(p,b,k){return{err:{code:p,msg:b,line:k.line||k,col:k.col}}}function S(p){return s.isName(p)}function v(p,b){const k=p.substring(0,b).split(/\r?\n/);return{line:k.length,col:k[k.length-1].length+1}}function C(p){return p.startIndex+p[1].length}},221:(r,e,t)=>{const s=t(87),a=t(118),n={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(c,f){return f},attributeValueProcessor:function(c,f){return f},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function i(c){this.options=Object.assign({},n,c),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=a(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=u),this.processTextOrObjNode=o,this.options.format?(this.indentate=h,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function o(c,f,m,y){const w=this.j2x(c,m+1,y.concat(f));return c[this.options.textNodeName]!==void 0&&Object.keys(c).length===1?this.buildTextValNode(c[this.options.textNodeName],f,w.attrStr,m):this.buildObjectNode(w.val,f,w.attrStr,m)}function h(c){return this.options.indentBy.repeat(c)}function u(c){return!(!c.startsWith(this.options.attributeNamePrefix)||c===this.options.textNodeName)&&c.substr(this.attrPrefixLen)}i.prototype.build=function(c){return this.options.preserveOrder?s(c,this.options):(Array.isArray(c)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(c={[this.options.arrayNodeName]:c}),this.j2x(c,0,[]).val)},i.prototype.j2x=function(c,f,m){let y="",w="";const S=m.join(".");for(let v in c)if(Object.prototype.hasOwnProperty.call(c,v))if(c[v]===void 0)this.isAttribute(v)&&(w+="");else if(c[v]===null)this.isAttribute(v)?w+="":v[0]==="?"?w+=this.indentate(f)+"<"+v+"?"+this.tagEndChar:w+=this.indentate(f)+"<"+v+"/"+this.tagEndChar;else if(c[v]instanceof Date)w+=this.buildTextValNode(c[v],v,"",f);else if(typeof c[v]!="object"){const C=this.isAttribute(v);if(C&&!this.ignoreAttributesFn(C,S))y+=this.buildAttrPairStr(C,""+c[v]);else if(!C)if(v===this.options.textNodeName){let p=this.options.tagValueProcessor(v,""+c[v]);w+=this.replaceEntitiesValue(p)}else w+=this.buildTextValNode(c[v],v,"",f)}else if(Array.isArray(c[v])){const C=c[v].length;let p="",b="";for(let k=0;k<C;k++){const P=c[v][k];if(P!==void 0)if(P===null)v[0]==="?"?w+=this.indentate(f)+"<"+v+"?"+this.tagEndChar:w+=this.indentate(f)+"<"+v+"/"+this.tagEndChar;else if(typeof P=="object")if(this.options.oneListGroup){const x=this.j2x(P,f+1,m.concat(v));p+=x.val,this.options.attributesGroupName&&P.hasOwnProperty(this.options.attributesGroupName)&&(b+=x.attrStr)}else p+=this.processTextOrObjNode(P,v,f,m);else if(this.options.oneListGroup){let x=this.options.tagValueProcessor(v,P);x=this.replaceEntitiesValue(x),p+=x}else p+=this.buildTextValNode(P,v,"",f)}this.options.oneListGroup&&(p=this.buildObjectNode(p,v,b,f)),w+=p}else if(this.options.attributesGroupName&&v===this.options.attributesGroupName){const C=Object.keys(c[v]),p=C.length;for(let b=0;b<p;b++)y+=this.buildAttrPairStr(C[b],""+c[v][C[b]])}else w+=this.processTextOrObjNode(c[v],v,f,m);return{attrStr:y,val:w}},i.prototype.buildAttrPairStr=function(c,f){return f=this.options.attributeValueProcessor(c,""+f),f=this.replaceEntitiesValue(f),this.options.suppressBooleanAttributes&&f==="true"?" "+c:" "+c+'="'+f+'"'},i.prototype.buildObjectNode=function(c,f,m,y){if(c==="")return f[0]==="?"?this.indentate(y)+"<"+f+m+"?"+this.tagEndChar:this.indentate(y)+"<"+f+m+this.closeTag(f)+this.tagEndChar;{let w="</"+f+this.tagEndChar,S="";return f[0]==="?"&&(S="?",w=""),!m&&m!==""||c.indexOf("<")!==-1?this.options.commentPropName!==!1&&f===this.options.commentPropName&&S.length===0?this.indentate(y)+`<!--${c}-->`+this.newLine:this.indentate(y)+"<"+f+m+S+this.tagEndChar+c+this.indentate(y)+w:this.indentate(y)+"<"+f+m+S+">"+c+w}},i.prototype.closeTag=function(c){let f="";return this.options.unpairedTags.indexOf(c)!==-1?this.options.suppressUnpairedNode||(f="/"):f=this.options.suppressEmptyNode?"/":`></${c}`,f},i.prototype.buildTextValNode=function(c,f,m,y){if(this.options.cdataPropName!==!1&&f===this.options.cdataPropName)return this.indentate(y)+`<![CDATA[${c}]]>`+this.newLine;if(this.options.commentPropName!==!1&&f===this.options.commentPropName)return this.indentate(y)+`<!--${c}-->`+this.newLine;if(f[0]==="?")return this.indentate(y)+"<"+f+m+"?"+this.tagEndChar;{let w=this.options.tagValueProcessor(f,c);return w=this.replaceEntitiesValue(w),w===""?this.indentate(y)+"<"+f+m+this.closeTag(f)+this.tagEndChar:this.indentate(y)+"<"+f+m+">"+w+"</"+f+this.tagEndChar}},i.prototype.replaceEntitiesValue=function(c){if(c&&c.length>0&&this.options.processEntities)for(let f=0;f<this.options.entities.length;f++){const m=this.options.entities[f];c=c.replace(m.regex,m.val)}return c},r.exports=i},87:r=>{function e(i,o,h,u){let c="",f=!1;for(let m=0;m<i.length;m++){const y=i[m],w=t(y);if(w===void 0)continue;let S="";if(S=h.length===0?w:`${h}.${w}`,w===o.textNodeName){let b=y[w];a(S,o)||(b=o.tagValueProcessor(w,b),b=n(b,o)),f&&(c+=u),c+=b,f=!1;continue}if(w===o.cdataPropName){f&&(c+=u),c+=`<![CDATA[${y[w][0][o.textNodeName]}]]>`,f=!1;continue}if(w===o.commentPropName){c+=u+`<!--${y[w][0][o.textNodeName]}-->`,f=!0;continue}if(w[0]==="?"){const b=s(y[":@"],o),k=w==="?xml"?"":u;let P=y[w][0][o.textNodeName];P=P.length!==0?" "+P:"",c+=k+`<${w}${P}${b}?>`,f=!0;continue}let v=u;v!==""&&(v+=o.indentBy);const C=u+`<${w}${s(y[":@"],o)}`,p=e(y[w],o,S,v);o.unpairedTags.indexOf(w)!==-1?o.suppressUnpairedNode?c+=C+">":c+=C+"/>":p&&p.length!==0||!o.suppressEmptyNode?p&&p.endsWith(">")?c+=C+`>${p}${u}</${w}>`:(c+=C+">",p&&u!==""&&(p.includes("/>")||p.includes("</"))?c+=u+o.indentBy+p+u:c+=p,c+=`</${w}>`):c+=C+"/>",f=!0}return c}function t(i){const o=Object.keys(i);for(let h=0;h<o.length;h++){const u=o[h];if(i.hasOwnProperty(u)&&u!==":@")return u}}function s(i,o){let h="";if(i&&!o.ignoreAttributes)for(let u in i){if(!i.hasOwnProperty(u))continue;let c=o.attributeValueProcessor(u,i[u]);c=n(c,o),c===!0&&o.suppressBooleanAttributes?h+=` ${u.substr(o.attributeNamePrefix.length)}`:h+=` ${u.substr(o.attributeNamePrefix.length)}="${c}"`}return h}function a(i,o){let h=(i=i.substr(0,i.length-o.textNodeName.length-1)).substr(i.lastIndexOf(".")+1);for(let u in o.stopNodes)if(o.stopNodes[u]===i||o.stopNodes[u]==="*."+h)return!0;return!1}function n(i,o){if(i&&i.length>0&&o.processEntities)for(let h=0;h<o.entities.length;h++){const u=o.entities[h];i=i.replace(u.regex,u.val)}return i}r.exports=function(i,o){let h="";return o.format&&o.indentBy.length>0&&(h=`
`),e(i,o,"",h)}},193:(r,e,t)=>{const s=t(705);function a(f,m){let y="";for(;m<f.length&&f[m]!=="'"&&f[m]!=='"';m++)y+=f[m];if(y=y.trim(),y.indexOf(" ")!==-1)throw new Error("External entites are not supported");const w=f[m++];let S="";for(;m<f.length&&f[m]!==w;m++)S+=f[m];return[y,S,m]}function n(f,m){return f[m+1]==="!"&&f[m+2]==="-"&&f[m+3]==="-"}function i(f,m){return f[m+1]==="!"&&f[m+2]==="E"&&f[m+3]==="N"&&f[m+4]==="T"&&f[m+5]==="I"&&f[m+6]==="T"&&f[m+7]==="Y"}function o(f,m){return f[m+1]==="!"&&f[m+2]==="E"&&f[m+3]==="L"&&f[m+4]==="E"&&f[m+5]==="M"&&f[m+6]==="E"&&f[m+7]==="N"&&f[m+8]==="T"}function h(f,m){return f[m+1]==="!"&&f[m+2]==="A"&&f[m+3]==="T"&&f[m+4]==="T"&&f[m+5]==="L"&&f[m+6]==="I"&&f[m+7]==="S"&&f[m+8]==="T"}function u(f,m){return f[m+1]==="!"&&f[m+2]==="N"&&f[m+3]==="O"&&f[m+4]==="T"&&f[m+5]==="A"&&f[m+6]==="T"&&f[m+7]==="I"&&f[m+8]==="O"&&f[m+9]==="N"}function c(f){if(s.isName(f))return f;throw new Error(`Invalid entity name ${f}`)}r.exports=function(f,m){const y={};if(f[m+3]!=="O"||f[m+4]!=="C"||f[m+5]!=="T"||f[m+6]!=="Y"||f[m+7]!=="P"||f[m+8]!=="E")throw new Error("Invalid Tag instead of DOCTYPE");{m+=9;let w=1,S=!1,v=!1,C="";for(;m<f.length;m++)if(f[m]!=="<"||v)if(f[m]===">"){if(v?f[m-1]==="-"&&f[m-2]==="-"&&(v=!1,w--):w--,w===0)break}else f[m]==="["?S=!0:C+=f[m];else{if(S&&i(f,m)){let p,b;m+=7,[p,b,m]=a(f,m+1),b.indexOf("&")===-1&&(y[c(p)]={regx:RegExp(`&${p};`,"g"),val:b})}else if(S&&o(f,m))m+=8;else if(S&&h(f,m))m+=8;else if(S&&u(f,m))m+=9;else{if(!n)throw new Error("Invalid DOCTYPE");v=!0}w++,C=""}if(w!==0)throw new Error("Unclosed DOCTYPE")}return{entities:y,i:m}}},63:(r,e)=>{const t={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,a){return a},attributeValueProcessor:function(s,a){return a},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,a,n){return s}};e.buildOptions=function(s){return Object.assign({},t,s)},e.defaultOptions=t},299:(r,e,t)=>{const s=t(705),a=t(365),n=t(193),i=t(494),o=t(118);function h(x){const T=Object.keys(x);for(let B=0;B<T.length;B++){const V=T[B];this.lastEntities[V]={regex:new RegExp("&"+V+";","g"),val:x[V]}}}function u(x,T,B,V,J,F,D){if(x!==void 0&&(this.options.trimValues&&!V&&(x=x.trim()),x.length>0)){D||(x=this.replaceEntitiesValue(x));const j=this.options.tagValueProcessor(T,x,B,J,F);return j==null?x:typeof j!=typeof x||j!==x?j:this.options.trimValues||x.trim()===x?P(x,this.options.parseTagValue,this.options.numberParseOptions):x}}function c(x){if(this.options.removeNSPrefix){const T=x.split(":"),B=x.charAt(0)==="/"?"/":"";if(T[0]==="xmlns")return"";T.length===2&&(x=B+T[1])}return x}const f=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function m(x,T,B){if(this.options.ignoreAttributes!==!0&&typeof x=="string"){const V=s.getAllMatches(x,f),J=V.length,F={};for(let D=0;D<J;D++){const j=this.resolveNameSpace(V[D][1]);if(this.ignoreAttributesFn(j,T))continue;let ee=V[D][4],_=this.options.attributeNamePrefix+j;if(j.length)if(this.options.transformAttributeName&&(_=this.options.transformAttributeName(_)),_==="__proto__"&&(_="#__proto__"),ee!==void 0){this.options.trimValues&&(ee=ee.trim()),ee=this.replaceEntitiesValue(ee);const ie=this.options.attributeValueProcessor(j,ee,T);F[_]=ie==null?ee:typeof ie!=typeof ee||ie!==ee?ie:P(ee,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(F[_]=!0)}if(!Object.keys(F).length)return;if(this.options.attributesGroupName){const D={};return D[this.options.attributesGroupName]=F,D}return F}}const y=function(x){x=x.replace(/\r\n?/g,`
`);const T=new a("!xml");let B=T,V="",J="";for(let F=0;F<x.length;F++)if(x[F]==="<")if(x[F+1]==="/"){const D=p(x,">",F,"Closing Tag is not closed.");let j=x.substring(F+2,D).trim();if(this.options.removeNSPrefix){const ie=j.indexOf(":");ie!==-1&&(j=j.substr(ie+1))}this.options.transformTagName&&(j=this.options.transformTagName(j)),B&&(V=this.saveTextToParentTag(V,B,J));const ee=J.substring(J.lastIndexOf(".")+1);if(j&&this.options.unpairedTags.indexOf(j)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${j}>`);let _=0;ee&&this.options.unpairedTags.indexOf(ee)!==-1?(_=J.lastIndexOf(".",J.lastIndexOf(".")-1),this.tagsNodeStack.pop()):_=J.lastIndexOf("."),J=J.substring(0,_),B=this.tagsNodeStack.pop(),V="",F=D}else if(x[F+1]==="?"){let D=b(x,F,!1,"?>");if(!D)throw new Error("Pi Tag is not closed.");if(V=this.saveTextToParentTag(V,B,J),!(this.options.ignoreDeclaration&&D.tagName==="?xml"||this.options.ignorePiTags)){const j=new a(D.tagName);j.add(this.options.textNodeName,""),D.tagName!==D.tagExp&&D.attrExpPresent&&(j[":@"]=this.buildAttributesMap(D.tagExp,J,D.tagName)),this.addChild(B,j,J)}F=D.closeIndex+1}else if(x.substr(F+1,3)==="!--"){const D=p(x,"-->",F+4,"Comment is not closed.");if(this.options.commentPropName){const j=x.substring(F+4,D-2);V=this.saveTextToParentTag(V,B,J),B.add(this.options.commentPropName,[{[this.options.textNodeName]:j}])}F=D}else if(x.substr(F+1,2)==="!D"){const D=n(x,F);this.docTypeEntities=D.entities,F=D.i}else if(x.substr(F+1,2)==="!["){const D=p(x,"]]>",F,"CDATA is not closed.")-2,j=x.substring(F+9,D);V=this.saveTextToParentTag(V,B,J);let ee=this.parseTextData(j,B.tagname,J,!0,!1,!0,!0);ee==null&&(ee=""),this.options.cdataPropName?B.add(this.options.cdataPropName,[{[this.options.textNodeName]:j}]):B.add(this.options.textNodeName,ee),F=D+2}else{let D=b(x,F,this.options.removeNSPrefix),j=D.tagName;const ee=D.rawTagName;let _=D.tagExp,ie=D.attrExpPresent,ae=D.closeIndex;this.options.transformTagName&&(j=this.options.transformTagName(j)),B&&V&&B.tagname!=="!xml"&&(V=this.saveTextToParentTag(V,B,J,!1));const pe=B;if(pe&&this.options.unpairedTags.indexOf(pe.tagname)!==-1&&(B=this.tagsNodeStack.pop(),J=J.substring(0,J.lastIndexOf("."))),j!==T.tagname&&(J+=J?"."+j:j),this.isItStopNode(this.options.stopNodes,J,j)){let ne="";if(_.length>0&&_.lastIndexOf("/")===_.length-1)j[j.length-1]==="/"?(j=j.substr(0,j.length-1),J=J.substr(0,J.length-1),_=j):_=_.substr(0,_.length-1),F=D.closeIndex;else if(this.options.unpairedTags.indexOf(j)!==-1)F=D.closeIndex;else{const te=this.readStopNodeData(x,ee,ae+1);if(!te)throw new Error(`Unexpected end of ${ee}`);F=te.i,ne=te.tagContent}const se=new a(j);j!==_&&ie&&(se[":@"]=this.buildAttributesMap(_,J,j)),ne&&(ne=this.parseTextData(ne,j,J,!0,ie,!0,!0)),J=J.substr(0,J.lastIndexOf(".")),se.add(this.options.textNodeName,ne),this.addChild(B,se,J)}else{if(_.length>0&&_.lastIndexOf("/")===_.length-1){j[j.length-1]==="/"?(j=j.substr(0,j.length-1),J=J.substr(0,J.length-1),_=j):_=_.substr(0,_.length-1),this.options.transformTagName&&(j=this.options.transformTagName(j));const ne=new a(j);j!==_&&ie&&(ne[":@"]=this.buildAttributesMap(_,J,j)),this.addChild(B,ne,J),J=J.substr(0,J.lastIndexOf("."))}else{const ne=new a(j);this.tagsNodeStack.push(B),j!==_&&ie&&(ne[":@"]=this.buildAttributesMap(_,J,j)),this.addChild(B,ne,J),B=ne}V="",F=ae}}else V+=x[F];return T.child};function w(x,T,B){const V=this.options.updateTag(T.tagname,B,T[":@"]);V===!1||(typeof V=="string"&&(T.tagname=V),x.addChild(T))}const S=function(x){if(this.options.processEntities){for(let T in this.docTypeEntities){const B=this.docTypeEntities[T];x=x.replace(B.regx,B.val)}for(let T in this.lastEntities){const B=this.lastEntities[T];x=x.replace(B.regex,B.val)}if(this.options.htmlEntities)for(let T in this.htmlEntities){const B=this.htmlEntities[T];x=x.replace(B.regex,B.val)}x=x.replace(this.ampEntity.regex,this.ampEntity.val)}return x};function v(x,T,B,V){return x&&(V===void 0&&(V=Object.keys(T.child).length===0),(x=this.parseTextData(x,T.tagname,B,!1,!!T[":@"]&&Object.keys(T[":@"]).length!==0,V))!==void 0&&x!==""&&T.add(this.options.textNodeName,x),x=""),x}function C(x,T,B){const V="*."+B;for(const J in x){const F=x[J];if(V===F||T===F)return!0}return!1}function p(x,T,B,V){const J=x.indexOf(T,B);if(J===-1)throw new Error(V);return J+T.length-1}function b(x,T,B){const V=function(ie,ae){let pe,ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",se="";for(let te=ae;te<ie.length;te++){let Z=ie[te];if(pe)Z===pe&&(pe="");else if(Z==='"'||Z==="'")pe=Z;else if(Z===ne[0]){if(!ne[1])return{data:se,index:te};if(ie[te+1]===ne[1])return{data:se,index:te}}else Z==="	"&&(Z=" ");se+=Z}}(x,T+1,arguments.length>3&&arguments[3]!==void 0?arguments[3]:">");if(!V)return;let J=V.data;const F=V.index,D=J.search(/\s/);let j=J,ee=!0;D!==-1&&(j=J.substring(0,D),J=J.substring(D+1).trimStart());const _=j;if(B){const ie=j.indexOf(":");ie!==-1&&(j=j.substr(ie+1),ee=j!==V.data.substr(ie+1))}return{tagName:j,tagExp:J,closeIndex:F,attrExpPresent:ee,rawTagName:_}}function k(x,T,B){const V=B;let J=1;for(;B<x.length;B++)if(x[B]==="<")if(x[B+1]==="/"){const F=p(x,">",B,`${T} is not closed`);if(x.substring(B+2,F).trim()===T&&(J--,J===0))return{tagContent:x.substring(V,B),i:F};B=F}else if(x[B+1]==="?")B=p(x,"?>",B+1,"StopNode is not closed.");else if(x.substr(B+1,3)==="!--")B=p(x,"-->",B+3,"StopNode is not closed.");else if(x.substr(B+1,2)==="![")B=p(x,"]]>",B,"StopNode is not closed.")-2;else{const F=b(x,B,">");F&&((F&&F.tagName)===T&&F.tagExp[F.tagExp.length-1]!=="/"&&J++,B=F.closeIndex)}}function P(x,T,B){if(T&&typeof x=="string"){const V=x.trim();return V==="true"||V!=="false"&&i(x,B)}return s.isExist(x)?x:""}r.exports=class{constructor(x){this.options=x,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(T,B)=>String.fromCharCode(Number.parseInt(B,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(T,B)=>String.fromCharCode(Number.parseInt(B,16))}},this.addExternalEntities=h,this.parseXml=y,this.parseTextData=u,this.resolveNameSpace=c,this.buildAttributesMap=m,this.isItStopNode=C,this.replaceEntitiesValue=S,this.readStopNodeData=k,this.saveTextToParentTag=v,this.addChild=w,this.ignoreAttributesFn=o(this.options.ignoreAttributes)}}},338:(r,e,t)=>{const{buildOptions:s}=t(63),a=t(299),{prettify:n}=t(728),i=t(31);r.exports=class{constructor(o){this.externalEntities={},this.options=s(o)}parse(o,h){if(typeof o!="string"){if(!o.toString)throw new Error("XML data is accepted in String or Bytes[] form.");o=o.toString()}if(h){h===!0&&(h={});const f=i.validate(o,h);if(f!==!0)throw Error(`${f.err.msg}:${f.err.line}:${f.err.col}`)}const u=new a(this.options);u.addExternalEntities(this.externalEntities);const c=u.parseXml(o);return this.options.preserveOrder||c===void 0?c:n(c,this.options)}addEntity(o,h){if(h.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(o.indexOf("&")!==-1||o.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(h==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[o]=h}}},728:(r,e)=>{function t(i,o,h){let u;const c={};for(let f=0;f<i.length;f++){const m=i[f],y=s(m);let w="";if(w=h===void 0?y:h+"."+y,y===o.textNodeName)u===void 0?u=m[y]:u+=""+m[y];else{if(y===void 0)continue;if(m[y]){let S=t(m[y],o,w);const v=n(S,o);m[":@"]?a(S,m[":@"],w,o):Object.keys(S).length!==1||S[o.textNodeName]===void 0||o.alwaysCreateTextNode?Object.keys(S).length===0&&(o.alwaysCreateTextNode?S[o.textNodeName]="":S=""):S=S[o.textNodeName],c[y]!==void 0&&c.hasOwnProperty(y)?(Array.isArray(c[y])||(c[y]=[c[y]]),c[y].push(S)):o.isArray(y,w,v)?c[y]=[S]:c[y]=S}}}return typeof u=="string"?u.length>0&&(c[o.textNodeName]=u):u!==void 0&&(c[o.textNodeName]=u),c}function s(i){const o=Object.keys(i);for(let h=0;h<o.length;h++){const u=o[h];if(u!==":@")return u}}function a(i,o,h,u){if(o){const c=Object.keys(o),f=c.length;for(let m=0;m<f;m++){const y=c[m];u.isArray(y,h+"."+y,!0,!0)?i[y]=[o[y]]:i[y]=o[y]}}}function n(i,o){const{textNodeName:h}=o,u=Object.keys(i).length;return u===0||!(u!==1||!i[h]&&typeof i[h]!="boolean"&&i[h]!==0)}e.prettify=function(i,o){return t(i,o)}},365:r=>{r.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},135:r=>{function e(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}r.exports=function(t){return t!=null&&(e(t)||function(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&e(s.slice(0,0))}(t)||!!t._isBuffer)}},542:(r,e,t)=>{(function(){var s=t(298),a=t(526).utf8,n=t(135),i=t(526).bin,o=function(h,u){h.constructor==String?h=u&&u.encoding==="binary"?i.stringToBytes(h):a.stringToBytes(h):n(h)?h=Array.prototype.slice.call(h,0):Array.isArray(h)||h.constructor===Uint8Array||(h=h.toString());for(var c=s.bytesToWords(h),f=8*h.length,m=1732584193,y=-271733879,w=-1732584194,S=271733878,v=0;v<c.length;v++)c[v]=16711935&(c[v]<<8|c[v]>>>24)|4278255360&(c[v]<<24|c[v]>>>8);c[f>>>5]|=128<<f%32,c[14+(f+64>>>9<<4)]=f;var C=o._ff,p=o._gg,b=o._hh,k=o._ii;for(v=0;v<c.length;v+=16){var P=m,x=y,T=w,B=S;m=C(m,y,w,S,c[v+0],7,-680876936),S=C(S,m,y,w,c[v+1],12,-389564586),w=C(w,S,m,y,c[v+2],17,606105819),y=C(y,w,S,m,c[v+3],22,-1044525330),m=C(m,y,w,S,c[v+4],7,-176418897),S=C(S,m,y,w,c[v+5],12,1200080426),w=C(w,S,m,y,c[v+6],17,-1473231341),y=C(y,w,S,m,c[v+7],22,-45705983),m=C(m,y,w,S,c[v+8],7,1770035416),S=C(S,m,y,w,c[v+9],12,-1958414417),w=C(w,S,m,y,c[v+10],17,-42063),y=C(y,w,S,m,c[v+11],22,-1990404162),m=C(m,y,w,S,c[v+12],7,1804603682),S=C(S,m,y,w,c[v+13],12,-40341101),w=C(w,S,m,y,c[v+14],17,-1502002290),m=p(m,y=C(y,w,S,m,c[v+15],22,1236535329),w,S,c[v+1],5,-165796510),S=p(S,m,y,w,c[v+6],9,-1069501632),w=p(w,S,m,y,c[v+11],14,643717713),y=p(y,w,S,m,c[v+0],20,-373897302),m=p(m,y,w,S,c[v+5],5,-701558691),S=p(S,m,y,w,c[v+10],9,38016083),w=p(w,S,m,y,c[v+15],14,-660478335),y=p(y,w,S,m,c[v+4],20,-405537848),m=p(m,y,w,S,c[v+9],5,568446438),S=p(S,m,y,w,c[v+14],9,-1019803690),w=p(w,S,m,y,c[v+3],14,-187363961),y=p(y,w,S,m,c[v+8],20,1163531501),m=p(m,y,w,S,c[v+13],5,-1444681467),S=p(S,m,y,w,c[v+2],9,-51403784),w=p(w,S,m,y,c[v+7],14,1735328473),m=b(m,y=p(y,w,S,m,c[v+12],20,-1926607734),w,S,c[v+5],4,-378558),S=b(S,m,y,w,c[v+8],11,-2022574463),w=b(w,S,m,y,c[v+11],16,1839030562),y=b(y,w,S,m,c[v+14],23,-35309556),m=b(m,y,w,S,c[v+1],4,-1530992060),S=b(S,m,y,w,c[v+4],11,1272893353),w=b(w,S,m,y,c[v+7],16,-155497632),y=b(y,w,S,m,c[v+10],23,-1094730640),m=b(m,y,w,S,c[v+13],4,681279174),S=b(S,m,y,w,c[v+0],11,-358537222),w=b(w,S,m,y,c[v+3],16,-722521979),y=b(y,w,S,m,c[v+6],23,76029189),m=b(m,y,w,S,c[v+9],4,-640364487),S=b(S,m,y,w,c[v+12],11,-421815835),w=b(w,S,m,y,c[v+15],16,530742520),m=k(m,y=b(y,w,S,m,c[v+2],23,-995338651),w,S,c[v+0],6,-198630844),S=k(S,m,y,w,c[v+7],10,1126891415),w=k(w,S,m,y,c[v+14],15,-1416354905),y=k(y,w,S,m,c[v+5],21,-57434055),m=k(m,y,w,S,c[v+12],6,1700485571),S=k(S,m,y,w,c[v+3],10,-1894986606),w=k(w,S,m,y,c[v+10],15,-1051523),y=k(y,w,S,m,c[v+1],21,-2054922799),m=k(m,y,w,S,c[v+8],6,1873313359),S=k(S,m,y,w,c[v+15],10,-30611744),w=k(w,S,m,y,c[v+6],15,-1560198380),y=k(y,w,S,m,c[v+13],21,1309151649),m=k(m,y,w,S,c[v+4],6,-145523070),S=k(S,m,y,w,c[v+11],10,-1120210379),w=k(w,S,m,y,c[v+2],15,718787259),y=k(y,w,S,m,c[v+9],21,-343485551),m=m+P>>>0,y=y+x>>>0,w=w+T>>>0,S=S+B>>>0}return s.endian([m,y,w,S])};o._ff=function(h,u,c,f,m,y,w){var S=h+(u&c|~u&f)+(m>>>0)+w;return(S<<y|S>>>32-y)+u},o._gg=function(h,u,c,f,m,y,w){var S=h+(u&f|c&~f)+(m>>>0)+w;return(S<<y|S>>>32-y)+u},o._hh=function(h,u,c,f,m,y,w){var S=h+(u^c^f)+(m>>>0)+w;return(S<<y|S>>>32-y)+u},o._ii=function(h,u,c,f,m,y,w){var S=h+(c^(u|~f))+(m>>>0)+w;return(S<<y|S>>>32-y)+u},o._blocksize=16,o._digestsize=16,r.exports=function(h,u){if(h==null)throw new Error("Illegal argument "+h);var c=s.wordsToBytes(o(h,u));return u&&u.asBytes?c:u&&u.asString?i.bytesToString(c):s.bytesToHex(c)}})()},285:(r,e,t)=>{var s=t(2);r.exports=function(C){return C?(C.substr(0,2)==="{}"&&(C="\\{\\}"+C.substr(2)),v(function(p){return p.split("\\\\").join(a).split("\\{").join(n).split("\\}").join(i).split("\\,").join(o).split("\\.").join(h)}(C),!0).map(c)):[]};var a="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",i="\0CLOSE"+Math.random()+"\0",o="\0COMMA"+Math.random()+"\0",h="\0PERIOD"+Math.random()+"\0";function u(C){return parseInt(C,10)==C?parseInt(C,10):C.charCodeAt(0)}function c(C){return C.split(a).join("\\").split(n).join("{").split(i).join("}").split(o).join(",").split(h).join(".")}function f(C){if(!C)return[""];var p=[],b=s("{","}",C);if(!b)return C.split(",");var k=b.pre,P=b.body,x=b.post,T=k.split(",");T[T.length-1]+="{"+P+"}";var B=f(x);return x.length&&(T[T.length-1]+=B.shift(),T.push.apply(T,B)),p.push.apply(p,T),p}function m(C){return"{"+C+"}"}function y(C){return/^-?0\d/.test(C)}function w(C,p){return C<=p}function S(C,p){return C>=p}function v(C,p){var b=[],k=s("{","}",C);if(!k)return[C];var P=k.pre,x=k.post.length?v(k.post,!1):[""];if(/\$$/.test(k.pre))for(var T=0;T<x.length;T++){var B=P+"{"+k.body+"}"+x[T];b.push(B)}else{var V,J,F=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(k.body),D=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(k.body),j=F||D,ee=k.body.indexOf(",")>=0;if(!j&&!ee)return k.post.match(/,.*\}/)?v(C=k.pre+"{"+k.body+i+k.post):[C];if(j)V=k.body.split(/\.\./);else if((V=f(k.body)).length===1&&(V=v(V[0],!1).map(m)).length===1)return x.map(function(Me){return k.pre+V[0]+Me});if(j){var _=u(V[0]),ie=u(V[1]),ae=Math.max(V[0].length,V[1].length),pe=V.length==3?Math.abs(u(V[2])):1,ne=w;ie<_&&(pe*=-1,ne=S);var se=V.some(y);J=[];for(var te=_;ne(te,ie);te+=pe){var Z;if(D)(Z=String.fromCharCode(te))==="\\"&&(Z="");else if(Z=String(te),se){var ce=ae-Z.length;if(ce>0){var fe=new Array(ce+1).join("0");Z=te<0?"-"+fe+Z.slice(1):fe+Z}}J.push(Z)}}else{J=[];for(var ke=0;ke<V.length;ke++)J.push.apply(J,v(V[ke],!1))}for(ke=0;ke<J.length;ke++)for(T=0;T<x.length;T++)B=P+J[ke]+x[T],(!p||j||B)&&b.push(B)}return b}},829:r=>{function e(u){return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},e(u)}function t(u){var c=typeof Map=="function"?new Map:void 0;return t=function(f){if(f===null||(m=f,Function.toString.call(m).indexOf("[native code]")===-1))return f;var m;if(typeof f!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(f))return c.get(f);c.set(f,y)}function y(){return s(f,arguments,n(this).constructor)}return y.prototype=Object.create(f.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),a(y,f)},t(u)}function s(u,c,f){return s=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}()?Reflect.construct:function(m,y,w){var S=[null];S.push.apply(S,y);var v=new(Function.bind.apply(m,S));return w&&a(v,w.prototype),v},s.apply(null,arguments)}function a(u,c){return a=Object.setPrototypeOf||function(f,m){return f.__proto__=m,f},a(u,c)}function n(u){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},n(u)}var i=function(u){function c(f){var m;return function(y,w){if(!(y instanceof w))throw new TypeError("Cannot call a class as a function")}(this,c),(m=function(y,w){return!w||e(w)!=="object"&&typeof w!="function"?function(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}(y):w}(this,n(c).call(this,f))).name="ObjectPrototypeMutationError",m}return function(f,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(m&&m.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),m&&a(f,m)}(c,u),c}(t(Error));function o(u,c){for(var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},m=c.split("."),y=m.length,w=function(C){var p=m[C];if(!u)return{v:void 0};if(p==="+"){if(Array.isArray(u))return{v:u.map(function(k,P){var x=m.slice(C+1);return x.length>0?o(k,x.join("."),f):f(u,P,m,C)})};var b=m.slice(0,C).join(".");throw new Error("Object at wildcard (".concat(b,") is not an array"))}u=f(u,p,m,C)},S=0;S<y;S++){var v=w(S);if(e(v)==="object")return v.v}return u}function h(u,c){return u.length===c+1}r.exports={set:function(u,c,f){if(e(u)!="object"||u===null||c===void 0)return u;if(typeof c=="number")return u[c]=f,u[c];try{return o(u,c,function(m,y,w,S){if(m===Reflect.getPrototypeOf({}))throw new i("Attempting to mutate Object.prototype");if(!m[y]){var v=Number.isInteger(Number(w[S+1])),C=w[S+1]==="+";m[y]=v||C?[]:{}}return h(w,S)&&(m[y]=f),m[y]})}catch(m){if(m instanceof i)throw m;return u}},get:function(u,c){if(e(u)!="object"||u===null||c===void 0)return u;if(typeof c=="number")return u[c];try{return o(u,c,function(f,m){return f[m]})}catch{return u}},has:function(u,c){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e(u)!="object"||u===null||c===void 0)return!1;if(typeof c=="number")return c in u;try{var m=!1;return o(u,c,function(y,w,S,v){if(!h(S,v))return y&&y[w];m=f.own?y.hasOwnProperty(w):w in y}),m}catch{return!1}},hasOwn:function(u,c,f){return this.has(u,c,f||{own:!0})},isIn:function(u,c,f){var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(e(u)!="object"||u===null||c===void 0)return!1;try{var y=!1,w=!1;return o(u,c,function(S,v,C,p){return y=y||S===f||!!S&&S[v]===f,w=h(C,p)&&e(S)==="object"&&v in S,S&&S[v]}),m.validPath?y&&w:y}catch{return!1}},ObjectPrototypeMutationError:i}},47:(r,e,t)=>{var s=t(410),a=function(u){return typeof u=="string"};function n(u,c){for(var f=[],m=0;m<u.length;m++){var y=u[m];y&&y!=="."&&(y===".."?f.length&&f[f.length-1]!==".."?f.pop():c&&f.push(".."):f.push(y))}return f}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o={};function h(u){return i.exec(u).slice(1)}o.resolve=function(){for(var u="",c=!1,f=arguments.length-1;f>=-1&&!c;f--){var m=f>=0?arguments[f]:at.cwd();if(!a(m))throw new TypeError("Arguments to path.resolve must be strings");m&&(u=m+"/"+u,c=m.charAt(0)==="/")}return(c?"/":"")+(u=n(u.split("/"),!c).join("/"))||"."},o.normalize=function(u){var c=o.isAbsolute(u),f=u.substr(-1)==="/";return(u=n(u.split("/"),!c).join("/"))||c||(u="."),u&&f&&(u+="/"),(c?"/":"")+u},o.isAbsolute=function(u){return u.charAt(0)==="/"},o.join=function(){for(var u="",c=0;c<arguments.length;c++){var f=arguments[c];if(!a(f))throw new TypeError("Arguments to path.join must be strings");f&&(u+=u?"/"+f:f)}return o.normalize(u)},o.relative=function(u,c){function f(p){for(var b=0;b<p.length&&p[b]==="";b++);for(var k=p.length-1;k>=0&&p[k]==="";k--);return b>k?[]:p.slice(b,k+1)}u=o.resolve(u).substr(1),c=o.resolve(c).substr(1);for(var m=f(u.split("/")),y=f(c.split("/")),w=Math.min(m.length,y.length),S=w,v=0;v<w;v++)if(m[v]!==y[v]){S=v;break}var C=[];for(v=S;v<m.length;v++)C.push("..");return(C=C.concat(y.slice(S))).join("/")},o._makeLong=function(u){return u},o.dirname=function(u){var c=h(u),f=c[0],m=c[1];return f||m?(m&&(m=m.substr(0,m.length-1)),f+m):"."},o.basename=function(u,c){var f=h(u)[2];return c&&f.substr(-1*c.length)===c&&(f=f.substr(0,f.length-c.length)),f},o.extname=function(u){return h(u)[3]},o.format=function(u){if(!s.isObject(u))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof u);var c=u.root||"";if(!a(c))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof u.root);return(u.dir?u.dir+o.sep:"")+(u.base||"")},o.parse=function(u){if(!a(u))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof u);var c=h(u);if(!c||c.length!==4)throw new TypeError("Invalid path '"+u+"'");return c[1]=c[1]||"",c[2]=c[2]||"",c[3]=c[3]||"",{root:c[0],dir:c[0]+c[1].slice(0,c[1].length-1),base:c[2],ext:c[3],name:c[2].slice(0,c[2].length-c[3].length)}},o.sep="/",o.delimiter=":",r.exports=o},647:(r,e)=>{var t=Object.prototype.hasOwnProperty;function s(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return null}}function a(n){try{return encodeURIComponent(n)}catch{return null}}e.stringify=function(n,i){i=i||"";var o,h,u=[];for(h in typeof i!="string"&&(i="?"),n)if(t.call(n,h)){if((o=n[h])||o!=null&&!isNaN(o)||(o=""),h=a(h),o=a(o),h===null||o===null)continue;u.push(h+"="+o)}return u.length?i+u.join("&"):""},e.parse=function(n){for(var i,o=/([^=?#&]+)=?([^&]*)/g,h={};i=o.exec(n);){var u=s(i[1]),c=s(i[2]);u===null||c===null||u in h||(h[u]=c)}return h}},670:r=>{r.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}},494:r=>{const e=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const s={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};r.exports=function(a){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n=Object.assign({},s,n),!a||typeof a!="string")return a;let i=a.trim();if(n.skipLike!==void 0&&n.skipLike.test(i))return a;if(n.hex&&e.test(i))return Number.parseInt(i,16);{const h=t.exec(i);if(h){const u=h[1],c=h[2];let f=((o=h[3])&&o.indexOf(".")!==-1&&((o=o.replace(/0+$/,""))==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substr(0,o.length-1))),o);const m=h[4]||h[6];if(!n.leadingZeros&&c.length>0&&u&&i[2]!=="."||!n.leadingZeros&&c.length>0&&!u&&i[1]!==".")return a;{const y=Number(i),w=""+y;return w.search(/[eE]/)!==-1||m?n.eNotation?y:a:i.indexOf(".")!==-1?w==="0"&&f===""||w===f||u&&w==="-"+f?y:a:c?f===w||u+f===w?y:a:i===w||i===u+w?y:a}}return a}var o}},737:(r,e,t)=>{var s=t(670),a=t(647),n=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,i=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,h=/:\d+$/,u=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,c=/^[a-zA-Z]:/;function f(p){return(p||"").toString().replace(n,"")}var m=[["#","hash"],["?","query"],function(p,b){return S(b.protocol)?p.replace(/\\/g,"/"):p},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],y={hash:1,query:1};function w(p){var b,k=(typeof window<"u"?window:typeof jt<"u"?jt:typeof self<"u"?self:{}).location||{},P={},x=typeof(p=p||k);if(p.protocol==="blob:")P=new C(unescape(p.pathname),{});else if(x==="string")for(b in P=new C(p,{}),y)delete P[b];else if(x==="object"){for(b in p)b in y||(P[b]=p[b]);P.slashes===void 0&&(P.slashes=o.test(p.href))}return P}function S(p){return p==="file:"||p==="ftp:"||p==="http:"||p==="https:"||p==="ws:"||p==="wss:"}function v(p,b){p=(p=f(p)).replace(i,""),b=b||{};var k,P=u.exec(p),x=P[1]?P[1].toLowerCase():"",T=!!P[2],B=!!P[3],V=0;return T?B?(k=P[2]+P[3]+P[4],V=P[2].length+P[3].length):(k=P[2]+P[4],V=P[2].length):B?(k=P[3]+P[4],V=P[3].length):k=P[4],x==="file:"?V>=2&&(k=k.slice(2)):S(x)?k=P[4]:x?T&&(k=k.slice(2)):V>=2&&S(b.protocol)&&(k=P[4]),{protocol:x,slashes:T||S(x),slashesCount:V,rest:k}}function C(p,b,k){if(p=(p=f(p)).replace(i,""),!(this instanceof C))return new C(p,b,k);var P,x,T,B,V,J,F=m.slice(),D=typeof b,j=this,ee=0;for(D!=="object"&&D!=="string"&&(k=b,b=null),k&&typeof k!="function"&&(k=a.parse),P=!(x=v(p||"",b=w(b))).protocol&&!x.slashes,j.slashes=x.slashes||P&&b.slashes,j.protocol=x.protocol||b.protocol||"",p=x.rest,(x.protocol==="file:"&&(x.slashesCount!==2||c.test(p))||!x.slashes&&(x.protocol||x.slashesCount<2||!S(j.protocol)))&&(F[3]=[/(.*)/,"pathname"]);ee<F.length;ee++)typeof(B=F[ee])!="function"?(T=B[0],J=B[1],T!=T?j[J]=p:typeof T=="string"?~(V=T==="@"?p.lastIndexOf(T):p.indexOf(T))&&(typeof B[2]=="number"?(j[J]=p.slice(0,V),p=p.slice(V+B[2])):(j[J]=p.slice(V),p=p.slice(0,V))):(V=T.exec(p))&&(j[J]=V[1],p=p.slice(0,V.index)),j[J]=j[J]||P&&B[3]&&b[J]||"",B[4]&&(j[J]=j[J].toLowerCase())):p=B(p,j);k&&(j.query=k(j.query)),P&&b.slashes&&j.pathname.charAt(0)!=="/"&&(j.pathname!==""||b.pathname!=="")&&(j.pathname=function(_,ie){if(_==="")return ie;for(var ae=(ie||"/").split("/").slice(0,-1).concat(_.split("/")),pe=ae.length,ne=ae[pe-1],se=!1,te=0;pe--;)ae[pe]==="."?ae.splice(pe,1):ae[pe]===".."?(ae.splice(pe,1),te++):te&&(pe===0&&(se=!0),ae.splice(pe,1),te--);return se&&ae.unshift(""),ne!=="."&&ne!==".."||ae.push(""),ae.join("/")}(j.pathname,b.pathname)),j.pathname.charAt(0)!=="/"&&S(j.protocol)&&(j.pathname="/"+j.pathname),s(j.port,j.protocol)||(j.host=j.hostname,j.port=""),j.username=j.password="",j.auth&&(~(V=j.auth.indexOf(":"))?(j.username=j.auth.slice(0,V),j.username=encodeURIComponent(decodeURIComponent(j.username)),j.password=j.auth.slice(V+1),j.password=encodeURIComponent(decodeURIComponent(j.password))):j.username=encodeURIComponent(decodeURIComponent(j.auth)),j.auth=j.password?j.username+":"+j.password:j.username),j.origin=j.protocol!=="file:"&&S(j.protocol)&&j.host?j.protocol+"//"+j.host:"null",j.href=j.toString()}C.prototype={set:function(p,b,k){var P=this;switch(p){case"query":typeof b=="string"&&b.length&&(b=(k||a.parse)(b)),P[p]=b;break;case"port":P[p]=b,s(b,P.protocol)?b&&(P.host=P.hostname+":"+b):(P.host=P.hostname,P[p]="");break;case"hostname":P[p]=b,P.port&&(b+=":"+P.port),P.host=b;break;case"host":P[p]=b,h.test(b)?(b=b.split(":"),P.port=b.pop(),P.hostname=b.join(":")):(P.hostname=b,P.port="");break;case"protocol":P.protocol=b.toLowerCase(),P.slashes=!k;break;case"pathname":case"hash":if(b){var x=p==="pathname"?"/":"#";P[p]=b.charAt(0)!==x?x+b:b}else P[p]=b;break;case"username":case"password":P[p]=encodeURIComponent(b);break;case"auth":var T=b.indexOf(":");~T?(P.username=b.slice(0,T),P.username=encodeURIComponent(decodeURIComponent(P.username)),P.password=b.slice(T+1),P.password=encodeURIComponent(decodeURIComponent(P.password))):P.username=encodeURIComponent(decodeURIComponent(b))}for(var B=0;B<m.length;B++){var V=m[B];V[4]&&(P[V[1]]=P[V[1]].toLowerCase())}return P.auth=P.password?P.username+":"+P.password:P.username,P.origin=P.protocol!=="file:"&&S(P.protocol)&&P.host?P.protocol+"//"+P.host:"null",P.href=P.toString(),P},toString:function(p){p&&typeof p=="function"||(p=a.stringify);var b,k=this,P=k.host,x=k.protocol;x&&x.charAt(x.length-1)!==":"&&(x+=":");var T=x+(k.protocol&&k.slashes||S(k.protocol)?"//":"");return k.username?(T+=k.username,k.password&&(T+=":"+k.password),T+="@"):k.password?(T+=":"+k.password,T+="@"):k.protocol!=="file:"&&S(k.protocol)&&!P&&k.pathname!=="/"&&(T+="@"),(P[P.length-1]===":"||h.test(k.hostname)&&!k.port)&&(P+=":"),T+=P+k.pathname,(b=typeof k.query=="object"?p(k.query):k.query)&&(T+=b.charAt(0)!=="?"?"?"+b:b),k.hash&&(T+=k.hash),T}},C.extractProtocol=v,C.location=w,C.trimLeft=f,C.qs=a,r.exports=C},410:()=>{},388:()=>{},805:()=>{},345:()=>{},800:()=>{}},Pp={};function Ie(r){var e=Pp[r];if(e!==void 0)return e.exports;var t=Pp[r]={id:r,loaded:!1,exports:{}};return Tw[r].call(t.exports,t,t.exports,Ie),t.loaded=!0,t.exports}Ie.n=r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return Ie.d(e,{a:e}),e},Ie.d=(r,e)=>{for(var t in e)Ie.o(e,t)&&!Ie.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},Ie.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),Ie.nmd=r=>(r.paths=[],r.children||(r.children=[]),r);var as={};Ie.d(as,{hT:()=>Bt,O4:()=>er,Kd:()=>Fw,YK:()=>Jw,UU:()=>Yy,Gu:()=>eg,ky:()=>cg,h4:()=>hl,ch:()=>Xh,hq:()=>Rn,i5:()=>lg});var Rw=Ie(737),Lw=Ie.n(Rw);function om(r){if(!mf(r))throw new Error("Parameter was not an error")}function mf(r){return!!r&&typeof r=="object"&&(e=r,Object.prototype.toString.call(e)==="[object Error]")||r instanceof Error;var e}class Dt extends Error{constructor(e,t){const s=[...arguments],{options:a,shortMessage:n}=function(o){let h,u="";if(o.length===0)h={};else if(mf(o[0]))h={cause:o[0]},u=o.slice(1).join(" ")||"";else if(o[0]&&typeof o[0]=="object")h=Object.assign({},o[0]),u=o.slice(1).join(" ")||"";else{if(typeof o[0]!="string")throw new Error("Invalid arguments passed to Layerr");h={},u=u=o.join(" ")||""}return{options:h,shortMessage:u}}(s);let i=n;if(a.cause&&(i=`${i}: ${a.cause.message}`),super(i),this.message=i,a.name&&typeof a.name=="string"?this.name=a.name:this.name="Layerr",a.cause&&Object.defineProperty(this,"_cause",{value:a.cause}),Object.defineProperty(this,"_info",{value:{}}),a.info&&typeof a.info=="object"&&Object.assign(this._info,a.info),Error.captureStackTrace){const o=a.constructorOpt||this.constructor;Error.captureStackTrace(this,o)}}static cause(e){return om(e),e._cause&&mf(e._cause)?e._cause:null}static fullStack(e){om(e);const t=Dt.cause(e);return t?`${e.stack}
caused by: ${Dt.fullStack(t)}`:e.stack??""}static info(e){om(e);const t={},s=Dt.cause(e);return s&&Object.assign(t,Dt.info(s)),e._info&&Object.assign(t,e._info),t}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e=`${e}: ${this.message}`),e}}var Uw=Ie(47),Vh=Ie.n(Uw);const Dp="__PATH_SEPARATOR_POSIX__",Tp="__PATH_SEPARATOR_WINDOWS__";function je(r){try{const e=r.replace(/\//g,Dp).replace(/\\\\/g,Tp);return encodeURIComponent(e).split(Tp).join("\\\\").split(Dp).join("/")}catch(e){throw new Dt(e,"Failed encoding path")}}function Rp(r){return r.startsWith("/")?r:"/"+r}function rl(r){let e=r;return e[0]!=="/"&&(e="/"+e),/^.+\/$/.test(e)&&(e=e.substr(0,e.length-1)),e}function jw(r){let e=new(Lw())(r).pathname;return e.length<=0&&(e="/"),rl(e)}function $e(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return function(){return function(s){var a=[];if(s.length===0)return"";if(typeof s[0]!="string")throw new TypeError("Url must be a string. Received "+s[0]);if(s[0].match(/^[^/:]+:\/*$/)&&s.length>1){var n=s.shift();s[0]=n+s[0]}s[0].match(/^file:\/\/\//)?s[0]=s[0].replace(/^([^/:]+):\/*/,"$1:///"):s[0]=s[0].replace(/^([^/:]+):\/*/,"$1://");for(var i=0;i<s.length;i++){var o=s[i];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(i>0&&(o=o.replace(/^[\/]+/,"")),o=i<s.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),a.push(o))}var h=a.join("/"),u=(h=h.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return u.shift()+(u.length>0?"?":"")+u.join("&")}(typeof arguments[0]=="object"?arguments[0]:[].slice.call(arguments))}(e.reduce((s,a,n)=>((n===0||a!=="/"||a==="/"&&s[s.length-1]!=="/")&&s.push(a),s),[]))}var $w=Ie(542),Uo=Ie.n($w);const Kw="abcdef0123456789";function Lp(r,e){const t=r.url.replace("//",""),s=t.indexOf("/")==-1?"/":t.slice(t.indexOf("/")),a=r.method?r.method.toUpperCase():"GET",n=!!/(^|,)\s*auth\s*($|,)/.test(e.qop)&&"auth",i=`00000000${e.nc}`.slice(-8),o=function(m,y,w,S,v,C,p){const b=p||Uo()(`${y}:${w}:${S}`);return m&&m.toLowerCase()==="md5-sess"?Uo()(`${b}:${v}:${C}`):b}(e.algorithm,e.username,e.realm,e.password,e.nonce,e.cnonce,e.ha1),h=Uo()(`${a}:${s}`),u=n?Uo()(`${o}:${e.nonce}:${i}:${e.cnonce}:${n}:${h}`):Uo()(`${o}:${e.nonce}:${h}`),c={username:e.username,realm:e.realm,nonce:e.nonce,uri:s,qop:n,response:u,nc:i,cnonce:e.cnonce,algorithm:e.algorithm,opaque:e.opaque},f=[];for(const m in c)c[m]&&(m==="qop"||m==="nc"||m==="algorithm"?f.push(`${m}=${c[m]}`):f.push(`${m}="${c[m]}"`));return`Digest ${f.join(", ")}`}function _d(r){return(r.headers&&r.headers.get("www-authenticate")||"").split(/\s/)[0].toLowerCase()==="digest"}var Mw=Ie(101),Qd=Ie.n(Mw);function Up(r){return Qd().decode(r)}function jp(r,e){var t;return`Basic ${t=`${r}:${e}`,Qd().encode(t)}`}const xh=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:typeof window<"u"?window:globalThis,Hw=xh.fetch.bind(xh),Fw=xh.Request,Jw=xh.Response;let Bt=function(r){return r.Auto="auto",r.Digest="digest",r.None="none",r.Password="password",r.Token="token",r}({}),er=function(r){return r.DataTypeNoLength="data-type-no-length",r.InvalidAuthType="invalid-auth-type",r.InvalidOutputFormat="invalid-output-format",r.LinkUnsupportedAuthType="link-unsupported-auth",r.InvalidUpdateRange="invalid-update-range",r.NotSupported="not-supported",r}({});function Zd(r,e,t,s,a){switch(r.authType){case Bt.Auto:e&&t&&(r.headers.Authorization=jp(e,t));break;case Bt.Digest:r.digest=function(i,o,h){return{username:i,password:o,ha1:h,nc:0,algorithm:"md5",hasDigestAuth:!1}}(e,t,a);break;case Bt.None:break;case Bt.Password:r.headers.Authorization=jp(e,t);break;case Bt.Token:r.headers.Authorization=`${(n=s).token_type} ${n.access_token}`;break;default:throw new Dt({info:{code:er.InvalidAuthType}},`Invalid auth type: ${r.authType}`)}var n}Ie(345),Ie(800);const $p="@@HOTPATCHER",qw=()=>{};function um(r){return{original:r,methods:[r],final:!1}}class Ww{constructor(){this._configuration={registry:{},getEmptyAction:"null"},this.__type__=$p}get configuration(){return this._configuration}get getEmptyAction(){return this.configuration.getEmptyAction}set getEmptyAction(e){this.configuration.getEmptyAction=e}control(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e||e.__type__!==$p)throw new Error("Failed taking control of target HotPatcher instance: Invalid type or object");return Object.keys(e.configuration.registry).forEach(s=>{this.configuration.registry.hasOwnProperty(s)?t&&(this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])):this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])}),e._configuration=this.configuration,this}execute(e){const t=this.get(e)||qw;for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];return t(...a)}get(e){const t=this.configuration.registry[e];if(!t)switch(this.getEmptyAction){case"null":return null;case"throw":throw new Error(`Failed handling method request: No method provided for override: ${e}`);default:throw new Error(`Failed handling request which resulted in an empty method: Invalid empty-action specified: ${this.getEmptyAction}`)}return function(){for(var s=arguments.length,a=new Array(s),n=0;n<s;n++)a[n]=arguments[n];if(a.length===0)throw new Error("Failed creating sequence: No functions provided");return function(){for(var i=arguments.length,o=new Array(i),h=0;h<i;h++)o[h]=arguments[h];let u=o;const c=this;for(;a.length>0;)u=[a.shift().apply(c,u)];return u[0]}}(...t.methods)}isPatched(e){return!!this.configuration.registry[e]}patch(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{chain:a=!1}=s;if(this.configuration.registry[e]&&this.configuration.registry[e].final)throw new Error(`Failed patching '${e}': Method marked as being final`);if(typeof t!="function")throw new Error(`Failed patching '${e}': Provided method is not a function`);if(a)this.configuration.registry[e]?this.configuration.registry[e].methods.push(t):this.configuration.registry[e]=um(t);else if(this.isPatched(e)){const{original:n}=this.configuration.registry[e];this.configuration.registry[e]=Object.assign(um(t),{original:n})}else this.configuration.registry[e]=um(t);return this}patchInline(e,t){this.isPatched(e)||this.patch(e,t);for(var s=arguments.length,a=new Array(s>2?s-2:0),n=2;n<s;n++)a[n-2]=arguments[n];return this.execute(e,...a)}plugin(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return s.forEach(n=>{this.patch(e,n,{chain:!0})}),this}restore(e){if(!this.isPatched(e))throw new Error(`Failed restoring method: No method present for key: ${e}`);if(typeof this.configuration.registry[e].original!="function")throw new Error(`Failed restoring method: Original method not found or of invalid type for key: ${e}`);return this.configuration.registry[e].methods=[this.configuration.registry[e].original],this}setFinal(e){if(!this.configuration.registry.hasOwnProperty(e))throw new Error(`Failed marking '${e}' as final: No method found for key`);return this.configuration.registry[e].final=!0,this}}let cm=null;function eg(){return cm||(cm=new Ww),cm}function Bh(r){return function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(r)?Object.assign({},r):Object.setPrototypeOf(Object.assign({},r),Object.getPrototypeOf(r))}function Kp(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let s=null,a=[...e];for(;a.length>0;){const n=a.shift();s=s?tg(s,n):Bh(n)}return s}function tg(r,e){const t=Bh(r);return Object.keys(e).forEach(s=>{t.hasOwnProperty(s)?Array.isArray(e[s])?t[s]=Array.isArray(t[s])?[...t[s],...e[s]]:[...e[s]]:typeof e[s]=="object"&&e[s]?t[s]=typeof t[s]=="object"&&t[s]?tg(t[s],e[s]):Bh(e[s]):t[s]=e[s]:t[s]=e[s]}),t}function Gw(r){const e={};for(const t of r.keys())e[t]=r.get(t);return e}function ff(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(e.length===0)return{};const s={};return e.reduce((a,n)=>(Object.keys(n).forEach(i=>{const o=i.toLowerCase();s.hasOwnProperty(o)?a[s[o]]=n[i]:(s[o]=i,a[i]=n[i])}),a),{})}Ie(805);const Xw=typeof ArrayBuffer=="function",{toString:zw}=Object.prototype;function sg(r){return Xw&&(r instanceof ArrayBuffer||zw.call(r)==="[object ArrayBuffer]")}function rg(r){return r!=null&&r.constructor!=null&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function Ff(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function pf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const ag=Ff(function(r){const e=r._digest;return delete r._digest,e.hasDigestAuth&&(r=Kp(r,{headers:{Authorization:Lp(r,e)}})),pf(Oh(r),function(t){let s=!1;return a=function(i){return s?i:t},(n=function(){if(t.status==401)return e.hasDigestAuth=function(i,o){if(!_d(i))return!1;const h=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;for(;;){const u=i.headers&&i.headers.get("www-authenticate")||"",c=h.exec(u);if(!c)break;o[c[1]]=c[2]||c[3]}return o.nc+=1,o.cnonce=function(){let u="";for(let c=0;c<32;++c)u=`${u}${Kw[Math.floor(16*Math.random())]}`;return u}(),!0}(t,e),function(){if(e.hasDigestAuth)return pf(Oh(r=Kp(r,{headers:{Authorization:Lp(r,e)}})),function(i){return i.status==401?e.hasDigestAuth=!1:e.nc++,s=!0,i})}();e.nc++}())&&n.then?n.then(a):a(n);var a,n})}),Yw=Ff(function(r,e){return pf(Oh(r),function(t){return t.ok?(e.authType=Bt.Password,t):t.status==401&&_d(t)?(e.authType=Bt.Digest,Zd(e,e.username,e.password,void 0,void 0),r._digest=e.digest,ag(r)):t})}),it=Ff(function(r,e){return e.authType===Bt.Auto?Yw(r,e):r._digest?ag(r):Oh(r)});function ot(r,e,t){const s=Bh(r);return s.headers=ff(e.headers,s.headers||{},t.headers||{}),t.data!==void 0&&(s.data=t.data),t.signal&&(s.signal=t.signal),e.httpAgent&&(s.httpAgent=e.httpAgent),e.httpsAgent&&(s.httpsAgent=e.httpsAgent),e.digest&&(s._digest=e.digest),typeof e.withCredentials=="boolean"&&(s.withCredentials=e.withCredentials),s}function Oh(r){const e=eg();return e.patchInline("request",t=>e.patchInline("fetch",Hw,t.url,function(s){let a={};const n={method:s.method};if(s.headers&&(a=ff(a,s.headers)),s.data!==void 0){const[i,o]=function(h){if(typeof h=="string")return[h,{}];if(rg(h))return[h,{}];if(sg(h))return[h,{}];if(h&&typeof h=="object")return[JSON.stringify(h),{"content-type":"application/json"}];throw new Error("Unable to convert request body: Unexpected body type: "+typeof h)}(s.data);n.body=i,a=ff(a,o)}return s.signal&&(n.signal=s.signal),s.withCredentials&&(n.credentials="include"),n.headers=a,n}(t)),r)}var _w=Ie(285);const Ph=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>65536)throw new TypeError("pattern is too long")},Qw={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},jo=r=>r.replace(/[[\]\\-]/g,"\\$&"),Mp=r=>r.join(""),Zw=(r,e)=>{const t=e;if(r.charAt(t)!=="[")throw new Error("not in a brace expression");const s=[],a=[];let n=t+1,i=!1,o=!1,h=!1,u=!1,c=t,f="";e:for(;n<r.length;){const S=r.charAt(n);if(S!=="!"&&S!=="^"||n!==t+1){if(S==="]"&&i&&!h){c=n+1;break}if(i=!0,S!=="\\"||h){if(S==="["&&!h){for(const[v,[C,p,b]]of Object.entries(Qw))if(r.startsWith(v,n)){if(f)return["$.",!1,r.length-t,!0];n+=v.length,b?a.push(C):s.push(C),o=o||p;continue e}}h=!1,f?(S>f?s.push(jo(f)+"-"+jo(S)):S===f&&s.push(jo(S)),f="",n++):r.startsWith("-]",n+1)?(s.push(jo(S+"-")),n+=2):r.startsWith("-",n+1)?(f=S,n+=2):(s.push(jo(S)),n++)}else h=!0,n++}else u=!0,n++}if(c<n)return["",!1,0,!1];if(!s.length&&!a.length)return["$.",!1,r.length-t,!0];if(a.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!u)return[(m=s[0].length===2?s[0].slice(-1):s[0],m.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,c-t,!1];var m;const y="["+(u?"^":"")+Mp(s)+"]",w="["+(u?"":"^")+Mp(a)+"]";return[s.length&&a.length?"("+y+"|"+w+")":s.length?y:w,o,c-t,!0]},Zo=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/\[([^\/\\])\]/g,"$1"):r.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1")},ey=new Set(["!","?","+","*","@"]),Hp=r=>ey.has(r),lm="(?!\\.)",ty=new Set(["[","."]),sy=new Set(["..","."]),ry=new Set("().*{}+?[]^$\\!"),Jf="[^/]",Fp=Jf+"*?",Jp=Jf+"+?";class Ct{type;#s;#r;#n=!1;#e=[];#t;#i;#u;#o=!1;#a;#c;#h=!1;constructor(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.type=e,e&&(this.#r=!0),this.#t=t,this.#s=this.#t?this.#t.#s:this,this.#a=this.#s===this?s:this.#s.#a,this.#u=this.#s===this?[]:this.#s.#u,e!=="!"||this.#s.#o||this.#u.push(this),this.#i=this.#t?this.#t.#e.length:0}get hasMagic(){if(this.#r!==void 0)return this.#r;for(const e of this.#e)if(typeof e!="string"&&(e.type||e.hasMagic))return this.#r=!0;return this.#r}toString(){return this.#c!==void 0?this.#c:this.type?this.#c=this.type+"("+this.#e.map(e=>String(e)).join("|")+")":this.#c=this.#e.map(e=>String(e)).join("")}#f(){if(this!==this.#s)throw new Error("should only call on root");if(this.#o)return this;let e;for(this.toString(),this.#o=!0;e=this.#u.pop();){if(e.type!=="!")continue;let t=e,s=t.#t;for(;s;){for(let a=t.#i+1;!s.type&&a<s.#e.length;a++)for(const n of e.#e){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(s.#e[a])}t=s,s=t.#t}}return this}push(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];for(const a of t)if(a!==""){if(typeof a!="string"&&!(a instanceof Ct&&a.#t===this))throw new Error("invalid part: "+a);this.#e.push(a)}}toJSON(){const e=this.type===null?this.#e.slice().map(t=>typeof t=="string"?t:t.toJSON()):[this.type,...this.#e.map(t=>t.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===this.#s||this.#s.#o&&this.#t?.type==="!")&&e.push({}),e}isStart(){if(this.#s===this)return!0;if(!this.#t?.isStart())return!1;if(this.#i===0)return!0;const e=this.#t;for(let t=0;t<this.#i;t++){const s=e.#e[t];if(!(s instanceof Ct&&s.type==="!"))return!1}return!0}isEnd(){if(this.#s===this||this.#t?.type==="!")return!0;if(!this.#t?.isEnd())return!1;if(!this.type)return this.#t?.isEnd();const e=this.#t?this.#t.#e.length:0;return this.#i===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new Ct(this.type,e);for(const s of this.#e)t.copyIn(s);return t}static#l(e,t,s,a){let n=!1,i=!1,o=-1,h=!1;if(t.type===null){let y=s,w="";for(;y<e.length;){const S=e.charAt(y++);if(n||S==="\\")n=!n,w+=S;else if(i)y===o+1?S!=="^"&&S!=="!"||(h=!0):S!=="]"||y===o+2&&h||(i=!1),w+=S;else if(S!=="[")if(a.noext||!Hp(S)||e.charAt(y)!=="(")w+=S;else{t.push(w),w="";const v=new Ct(S,t);y=Ct.#l(e,v,y,a),t.push(v)}else i=!0,o=y,h=!1,w+=S}return t.push(w),y}let u=s+1,c=new Ct(null,t);const f=[];let m="";for(;u<e.length;){const y=e.charAt(u++);if(n||y==="\\")n=!n,m+=y;else if(i)u===o+1?y!=="^"&&y!=="!"||(h=!0):y!=="]"||u===o+2&&h||(i=!1),m+=y;else if(y!=="[")if(Hp(y)&&e.charAt(u)==="("){c.push(m),m="";const w=new Ct(y,c);c.push(w),u=Ct.#l(e,w,u,a)}else if(y!=="|"){if(y===")")return m===""&&t.#e.length===0&&(t.#h=!0),c.push(m),m="",t.push(...f,c),u;m+=y}else c.push(m),m="",f.push(c),c=new Ct(null,t);else i=!0,o=u,h=!1,m+=y}return t.type=null,t.#r=void 0,t.#e=[e.substring(s-1)],u}static fromGlob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new Ct(null,void 0,t);return Ct.#l(e,s,0,t),s}toMMPattern(){if(this!==this.#s)return this.#s.toMMPattern();const e=this.toString(),[t,s,a,n]=this.toRegExpSource();if(!(a||this.#r||this.#a.nocase&&!this.#a.nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;const i=(this.#a.nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp(`^${t}$`,i),{_src:t,_glob:e})}get options(){return this.#a}toRegExpSource(e){const t=e??!!this.#a.dot;if(this.#s===this&&this.#f(),!this.type){const h=this.isStart()&&this.isEnd(),u=this.#e.map(m=>{const[y,w,S,v]=typeof m=="string"?Ct.#p(m,this.#r,h):m.toRegExpSource(e);return this.#r=this.#r||S,this.#n=this.#n||v,y}).join("");let c="";if(this.isStart()&&typeof this.#e[0]=="string"&&(this.#e.length!==1||!sy.has(this.#e[0]))){const m=ty,y=t&&m.has(u.charAt(0))||u.startsWith("\\.")&&m.has(u.charAt(2))||u.startsWith("\\.\\.")&&m.has(u.charAt(4)),w=!t&&!e&&m.has(u.charAt(0));c=y?"(?!(?:^|/)\\.\\.?(?:$|/))":w?lm:""}let f="";return this.isEnd()&&this.#s.#o&&this.#t?.type==="!"&&(f="(?:$|\\/)"),[c+u+f,Zo(u),this.#r=!!this.#r,this.#n]}const s=this.type==="*"||this.type==="+",a=this.type==="!"?"(?:(?!(?:":"(?:";let n=this.#m(t);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){const h=this.toString();return this.#e=[h],this.type=null,this.#r=void 0,[h,Zo(this.toString()),!1,!1]}let i=!s||e||t?"":this.#m(!0);i===n&&(i=""),i&&(n=`(?:${n})(?:${i})*?`);let o="";return o=this.type==="!"&&this.#h?(this.isStart()&&!t?lm:"")+Jp:a+n+(this.type==="!"?"))"+(!this.isStart()||t||e?"":lm)+Fp+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":`)${this.type}`),[o,Zo(n),this.#r=!!this.#r,this.#n]}#m(e){return this.#e.map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[s,a,n,i]=t.toRegExpSource(e);return this.#n=this.#n||i,s}).filter(t=>!(this.isStart()&&this.isEnd()&&!t)).join("|")}static#p(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=!1,n="",i=!1;for(let o=0;o<e.length;o++){const h=e.charAt(o);if(a)a=!1,n+=(ry.has(h)?"\\":"")+h;else if(h!=="\\"){if(h==="["){const[u,c,f,m]=Zw(e,o);if(f){n+=u,i=i||c,o+=f-1,t=t||m;continue}}h!=="*"?h!=="?"?n+=h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(n+=Jf,t=!0):(n+=s&&e==="*"?Jp:Fp,t=!0)}else o===e.length-1?n+="\\\\":a=!0}return[n,Zo(e),!!t,i]}}const Et=function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Ph(e),!(!t.nocomment&&e.charAt(0)==="#")&&new Dh(e,t).match(r)},ay=/^\*+([^+@!?\*\[\(]*)$/,ny=r=>e=>!e.startsWith(".")&&e.endsWith(r),iy=r=>e=>e.endsWith(r),oy=r=>(r=r.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(r)),uy=r=>(r=r.toLowerCase(),e=>e.toLowerCase().endsWith(r)),cy=/^\*+\.\*+$/,ly=r=>!r.startsWith(".")&&r.includes("."),hy=r=>r!=="."&&r!==".."&&r.includes("."),my=/^\.\*+$/,fy=r=>r!=="."&&r!==".."&&r.startsWith("."),py=/^\*+$/,dy=r=>r.length!==0&&!r.startsWith("."),gy=r=>r.length!==0&&r!=="."&&r!=="..",wy=/^\?+([^+@!?\*\[\(]*)?$/,yy=r=>{let[e,t=""]=r;const s=ng([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},vy=r=>{let[e,t=""]=r;const s=ig([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},by=r=>{let[e,t=""]=r;const s=ig([e]);return t?a=>s(a)&&a.endsWith(t):s},Ay=r=>{let[e,t=""]=r;const s=ng([e]);return t?a=>s(a)&&a.endsWith(t):s},ng=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&!s.startsWith(".")},ig=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&s!=="."&&s!==".."},og=typeof at=="object"&&at?typeof im=="object"&&im&&im.__MINIMATCH_TESTING_PLATFORM__||at.platform:"posix";Et.sep=og==="win32"?"\\":"/";const Yt=Symbol("globstar **");Et.GLOBSTAR=Yt,Et.filter=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return t=>Et(t,r,e)};const Xt=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.assign({},r,e)};Et.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return Et;const e=Et;return Object.assign(function(t,s){return e(t,s,Xt(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))},{Minimatch:class extends e.Minimatch{constructor(t){super(t,Xt(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}))}static defaults(t){return e.defaults(Xt(r,t)).Minimatch}},AST:class extends e.AST{constructor(t,s){super(t,s,Xt(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))}static fromGlob(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.AST.fromGlob(t,Xt(r,s))}},unescape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.unescape(t,Xt(r,s))},escape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.escape(t,Xt(r,s))},filter:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.filter(t,Xt(r,s))},defaults:t=>e.defaults(Xt(r,t)),makeRe:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.makeRe(t,Xt(r,s))},braceExpand:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.braceExpand(t,Xt(r,s))},match:function(t,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e.match(t,s,Xt(r,a))},sep:e.sep,GLOBSTAR:Yt})};const ug=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ph(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:_w(r)};Et.braceExpand=ug,Et.makeRe=function(r){return new Dh(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).makeRe()},Et.match=function(r,e){const t=new Dh(e,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{});return r=r.filter(s=>t.match(s)),t.options.nonull&&!r.length&&r.push(e),r};const qp=/[?*]|[+@!]\(.*?\)|\[|\]/;class Dh{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ph(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||og,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#")return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=function(){return console.error(...arguments)}),this.debug(this.pattern,this.globSet);const s=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let a=this.globParts.map((n,i,o)=>{if(this.isWindows&&this.windowsNoMagicRoot){const h=!(n[0]!==""||n[1]!==""||n[2]!=="?"&&qp.test(n[2])||qp.test(n[3])),u=/^[a-z]:/i.test(n[0]);if(h)return[...n.slice(0,4),...n.slice(4).map(c=>this.parse(c))];if(u)return[n[0],...n.slice(1).map(c=>this.parse(c))]}return n.map(h=>this.parse(h))});if(this.debug(this.pattern,a),this.set=a.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){const i=this.set[n];i[0]===""&&i[1]===""&&this.globParts[n][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)e[s][a]==="**"&&(e[s][a]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let a=s;for(;t[a+1]==="**";)a++;a!==s&&t.splice(s,a-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,a)=>{const n=s[s.length-1];return a==="**"&&n==="**"?s:a===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(s.pop(),s):(s.push(a),s)},[])).length===0?[""]:t)}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let a=1;a<e.length-1;a++){const n=e[a];a===1&&n===""&&e[0]===""||n!=="."&&n!==""||(t=!0,e.splice(a,1),a--)}e[0]!=="."||e.length!==2||e[1]!=="."&&e[1]!==""||(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){const a=e[s-1];a&&a!=="."&&a!==".."&&a!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let a=-1;for(;(a=s.indexOf("**",a+1))!==-1;){let i=a;for(;s[i+1]==="**";)i++;i>a&&s.splice(a+1,i-a);let o=s[a+1];const h=s[a+2],u=s[a+3];if(o!==".."||!h||h==="."||h===".."||!u||u==="."||u==="..")continue;t=!0,s.splice(a,1);const c=s.slice(0);c[a]="**",e.push(c),a--}if(!this.preserveMultipleSlashes){for(let i=1;i<s.length-1;i++){const o=s[i];i===1&&o===""&&s[0]===""||o!=="."&&o!==""||(t=!0,s.splice(i,1),i--)}s[0]!=="."||s.length!==2||s[1]!=="."&&s[1]!==""||(t=!0,s.pop())}let n=0;for(;(n=s.indexOf("..",n+1))!==-1;){const i=s[n-1];if(i&&i!=="."&&i!==".."&&i!=="**"){t=!0;const o=n===1&&s[n+1]==="**"?["."]:[];s.splice(n-1,2,...o),s.length===0&&s.push(""),n-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){const a=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(a){e[t]=[],e[s]=a;break}}return e.filter(t=>t.length)}partsMatch(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=0,n=0,i=[],o="";for(;a<e.length&&n<t.length;)if(e[a]===t[n])i.push(o==="b"?t[n]:e[a]),a++,n++;else if(s&&e[a]==="**"&&t[n]===e[a+1])i.push(e[a]),a++;else if(s&&t[n]==="**"&&e[a]===t[n+1])i.push(t[n]),n++;else if(e[a]!=="*"||!t[n]||!this.options.dot&&t[n].startsWith(".")||t[n]==="**"){if(t[n]!=="*"||!e[a]||!this.options.dot&&e[a].startsWith(".")||e[a]==="**"||o==="a")return!1;o="b",i.push(t[n]),a++,n++}else{if(o==="b")return!1;o="a",i.push(e[a]),a++,n++}return e.length===t.length&&i}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let a=0;a<e.length&&e.charAt(a)==="!";a++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const a=this.options;if(this.isWindows){const S=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),v=!S&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),C=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),p=v?3:S?0:void 0,b=!C&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3])?3:C?0:void 0;if(typeof p=="number"&&typeof b=="number"){const[k,P]=[e[p],t[b]];k.toLowerCase()===P.toLowerCase()&&(t[b]=k,b>p?t=t.slice(b):p>b&&(e=e.slice(p)))}}const{optimizationLevel:n=1}=this.options;n>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,o=0,h=e.length,u=t.length;i<h&&o<u;i++,o++){this.debug("matchOne loop");var c=t[o],f=e[i];if(this.debug(t,c,f),c===!1)return!1;if(c===Yt){this.debug("GLOBSTAR",[t,c,f]);var m=i,y=o+1;if(y===u){for(this.debug("** at the end");i<h;i++)if(e[i]==="."||e[i]===".."||!a.dot&&e[i].charAt(0)===".")return!1;return!0}for(;m<h;){var w=e[m];if(this.debug(`
globstar while`,e,m,t,y,w),this.matchOne(e.slice(m),t.slice(y),s))return this.debug("globstar found match!",m,h,w),!0;if(w==="."||w===".."||!a.dot&&w.charAt(0)==="."){this.debug("dot detected!",e,m,t,y);break}this.debug("globstar swallow a segment, and continue"),m++}return!(!s||(this.debug(`
>>> no match, partial?`,e,m,t,y),m!==h))}let S;if(typeof c=="string"?(S=f===c,this.debug("string match",c,f,S)):(S=c.test(f),this.debug("pattern match",c,f,S)),!S)return!1}if(i===h&&o===u)return!0;if(i===h)return s;if(o===u)return i===h-1&&e[i]==="";throw new Error("wtf?")}braceExpand(){return ug(this.pattern,this.options)}parse(e){Ph(e);const t=this.options;if(e==="**")return Yt;if(e==="")return"";let s,a=null;(s=e.match(py))?a=t.dot?gy:dy:(s=e.match(ay))?a=(t.nocase?t.dot?uy:oy:t.dot?iy:ny)(s[1]):(s=e.match(wy))?a=(t.nocase?t.dot?vy:yy:t.dot?by:Ay)(s):(s=e.match(cy))?a=t.dot?hy:ly:(s=e.match(my))&&(a=fy);const n=Ct.fromGlob(e,this.options).toMMPattern();return a&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:a}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",a=new Set(t.nocase?["i"]:[]);let n=e.map(h=>{const u=h.map(c=>{if(c instanceof RegExp)for(const f of c.flags.split(""))a.add(f);return typeof c=="string"?c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):c===Yt?Yt:c._src});return u.forEach((c,f)=>{const m=u[f+1],y=u[f-1];c===Yt&&y!==Yt&&(y===void 0?m!==void 0&&m!==Yt?u[f+1]="(?:\\/|"+s+"\\/)?"+m:u[f]=s:m===void 0?u[f-1]=y+"(?:\\/|"+s+")?":m!==Yt&&(u[f-1]=y+"(?:\\/|\\/"+s+"\\/)"+m,u[f+1]=Yt))}),u.filter(c=>c!==Yt).join("/")}).join("|");const[i,o]=e.length>1?["(?:",")"]:["",""];n="^"+i+n+o+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...a].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.partial;if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const s=this.options;this.isWindows&&(e=e.split("\\").join("/"));const a=this.slashSplit(e);this.debug(this.pattern,"split",a);const n=this.set;this.debug(this.pattern,"set",n);let i=a[a.length-1];if(!i)for(let o=a.length-2;!i&&o>=0;o--)i=a[o];for(let o=0;o<n.length;o++){const h=n[o];let u=a;if(s.matchBase&&h.length===1&&(u=[i]),this.matchOne(u,h,t))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(e){return Et.defaults(e).Minimatch}}function qf(r){const e=new Error(`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:""}Invalid response: ${r.status} ${r.statusText}`);return e.status=r.status,e.response=r,e}function ut(r,e){const{status:t}=e;if(t===401&&r.digest)return e;if(t>=400)throw qf(e);return e}function Rn(r,e){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?{data:e,headers:r.headers?Gw(r.headers):{},status:r.status,statusText:r.statusText}:e}Et.AST=Ct,Et.Minimatch=Dh,Et.escape=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/[?*()[\]]/g,"[$&]"):r.replace(/[?*()[\]\\]/g,"\\$&")},Et.unescape=Zo;const Sy=(Wp=function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ot({url:$e(r.remoteURL,je(e)),method:"COPY",headers:{Destination:$e(r.remoteURL,je(t)),Overwrite:s.overwrite===!1?"F":"T",Depth:s.shallow?"0":"infinity"}},r,s);return i=function(o){ut(r,o)},(n=it(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i},function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];try{return Promise.resolve(Wp.apply(this,r))}catch(t){return Promise.reject(t)}});var Wp,Wf=Ie(635),Ny=Ie(829),Hs=Ie.n(Ny),po=function(r){return r.Array="array",r.Object="object",r.Original="original",r}(po||{});function wl(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:po.Original;const s=Hs().get(r,e);return t==="array"&&Array.isArray(s)===!1?[s]:t==="object"&&Array.isArray(s)?s[0]:s}function hl(r){return new Promise(e=>{e(function(t){const{multistatus:s}=t;if(s==="")return{multistatus:{response:[]}};if(!s)throw new Error("Invalid response: No root multistatus found");const a={multistatus:Array.isArray(s)?s[0]:s};return Hs().set(a,"multistatus.response",wl(a,"multistatus.response",po.Array)),Hs().set(a,"multistatus.response",Hs().get(a,"multistatus.response").map(n=>function(i){const o=Object.assign({},i);return o.status?Hs().set(o,"status",wl(o,"status",po.Object)):(Hs().set(o,"propstat",wl(o,"propstat",po.Object)),Hs().set(o,"propstat.prop",wl(o,"propstat.prop",po.Object))),o}(n))),a}(new Wf.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",textNodeName:"text",ignoreAttributes:!1,removeNSPrefix:!0,numberParseOptions:{hex:!0,leadingZeros:!1},attributeValueProcessor:(t,s,a)=>s==="true"||s==="false"?s==="true":s,tagValueProcessor(t,s,a){if(!a.endsWith("propstat.prop.displayname"))return s}}).parse(r)))})}function Xh(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const{getlastmodified:s=null,getcontentlength:a="0",resourcetype:n=null,getcontenttype:i=null,getetag:o=null}=r,h=n&&typeof n=="object"&&n.collection!==void 0?"directory":"file",u={filename:e,basename:Vh().basename(e),lastmod:s,size:parseInt(a,10),type:h,etag:typeof o=="string"?o.replace(/"/g,""):null};return h==="file"&&(u.mime=i&&typeof i=="string"?i.split(";")[0]:""),t&&(r.displayname!==void 0&&(r.displayname=String(r.displayname)),u.props=r),u}function cg(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=null;try{r.multistatus.response[0].propstat&&(s=r.multistatus.response[0])}catch{}if(!s)throw new Error("Failed getting item stat: bad response");const{propstat:{prop:a,status:n}}=s,[i,o,h]=n.split(" ",3),u=parseInt(o,10);if(u>=400){const c=new Error(`Invalid response: ${u} ${h}`);throw c.status=u,c}return Xh(a,rl(e),t)}function lg(r){switch(String(r)){case"-3":return"unlimited";case"-2":case"-1":return"unknown";default:return parseInt(String(r),10)}}function hm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Gf=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=ot({url:$e(r.remoteURL,je(e)),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,t);return hm(it(a,r),function(n){return ut(r,n),hm(n.text(),function(i){return hm(hl(i),function(o){const h=cg(o,e,s);return Rn(n,h,s)})})})});function hg(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Ey=mg(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=function(n){if(!n||n==="/")return[];let i=n;const o=[];do o.push(i),i=Vh().dirname(i);while(i&&i!=="/");return o}(rl(e));s.sort((n,i)=>n.length>i.length?1:i.length>n.length?-1:0);let a=!1;return function(n,i,o){if(typeof n[Xp]=="function"){let S=function(v){try{for(;!(h=f.next()).done;)if((v=i(h.value))&&v.then){if(!zp(v))return void v.then(S,c||(c=Ot.bind(null,u=new go,2)));v=v.v}u?Ot(u,1,v):u=v}catch(C){Ot(u||(u=new go),2,C)}};var h,u,c,f=n[Xp]();if(S(),f.return){var m=function(v){try{h.done||f.return()}catch{}return v};if(u&&u.then)return u.then(m,function(v){throw m(v)});m()}return u}if(!("length"in n))throw new TypeError("Object is not iterable");for(var y=[],w=0;w<n.length;w++)y.push(n[w]);return function(S,v,C){var p,b,k=-1;return function P(x){try{for(;++k<S.length&&(!C||!C());)if((x=v(k))&&x.then){if(!zp(x))return void x.then(P,b||(b=Ot.bind(null,p=new go,2)));x=x.v}p?Ot(p,1,x):p=x}catch(T){Ot(p||(p=new go),2,T)}}(),p}(y,function(S){return i(y[S])},o)}(s,function(n){return i=function(){return function(h,u){try{var c=hg(Gf(r,n),function(f){if(f.type!=="directory")throw new Error(`Path includes a file: ${e}`)})}catch(f){return u(f)}return c&&c.then?c.then(void 0,u):c}(0,function(h){const u=h;return function(){if(u.status===404)return a=!0,Gp(df(r,n,{...t,recursive:!1}));throw h}()})},(o=function(){if(a)return Gp(df(r,n,{...t,recursive:!1}))}())&&o.then?o.then(i):i();var i,o},function(){return!1})});function mg(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function Cy(){}function Gp(r,e){return r&&r.then?r.then(Cy):Promise.resolve()}const Xp=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function Ot(r,e,t){if(!r.s){if(t instanceof go){if(!t.s)return void(t.o=Ot.bind(null,r,e));1&e&&(e=t.s),t=t.v}if(t&&t.then)return void t.then(Ot.bind(null,r,e),Ot.bind(null,r,2));r.s=e,r.v=t;const s=r.o;s&&s(r)}}const go=function(){function r(){}return r.prototype.then=function(e,t){const s=new r,a=this.s;if(a){const n=1&a?e:t;if(n){try{Ot(s,1,n(this.v))}catch(i){Ot(s,2,i)}return s}return this}return this.o=function(n){try{const i=n.v;1&n.s?Ot(s,1,e?e(i):i):t?Ot(s,1,t(i)):Ot(s,2,i)}catch(i){Ot(s,2,i)}},s},r}();function zp(r){return r instanceof go&&1&r.s}const df=mg(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.recursive===!0)return Ey(r,e,t);const s=ot({url:$e(r.remoteURL,(a=je(e),a.endsWith("/")?a:a+"/")),method:"MKCOL"},r,t);var a;return hg(it(s,r),function(n){ut(r,n)})});var ky=Ie(388),Yp=Ie.n(ky);const Iy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s={};if(typeof t.range=="object"&&typeof t.range.start=="number"){let o=`bytes=${t.range.start}-`;typeof t.range.end=="number"&&(o=`${o}${t.range.end}`),s.Range=o}const a=ot({url:$e(r.remoteURL,je(e)),method:"GET",headers:s},r,t);return i=function(o){if(ut(r,o),s.Range&&o.status!==206){const h=new Error(`Invalid response code for partial request: ${o.status}`);throw h.status=o.status,h}return t.callback&&setTimeout(()=>{t.callback(o)},0),o.body},(n=it(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i}),Vy=()=>{},xy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){t.url||(t.url=$e(r.remoteURL,je(e)));const s=ot(t,r,{});return n=function(i){return ut(r,i),i},(a=it(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),By=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ot({url:$e(r.remoteURL,je(e)),method:"DELETE"},r,t);return n=function(i){ut(r,i)},(a=it(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),Oy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function(s,a){try{var n=(i=Gf(r,e,t),o=function(){return!0},h?o?o(i):i:(i&&i.then||(i=Promise.resolve(i)),o?i.then(o):i))}catch(u){return a(u)}var i,o,h;return n&&n.then?n.then(void 0,a):n}(0,function(s){if(s.status===404)return!1;throw s})});function mm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Py=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ot({url:$e(r.remoteURL,je(e),"/"),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:t.deep?"infinity":"1"}},r,t);return mm(it(s,r),function(a){return ut(r,a),mm(a.text(),function(n){if(!n)throw new Error("Failed parsing directory contents: Empty response");return mm(hl(n),function(i){const o=Rp(e);let h=function(u,c,f){let m=arguments.length>3&&arguments[3]!==void 0&&arguments[3],y=arguments.length>4&&arguments[4]!==void 0&&arguments[4];const w=Vh().join(c,"/"),{multistatus:{response:S}}=u,v=S.map(C=>{const p=function(k){try{return k.replace(/^https?:\/\/[^\/]+/,"")}catch(P){throw new Dt(P,"Failed normalising HREF")}}(C.href),{propstat:{prop:b}}=C;return Xh(b,w==="/"?decodeURIComponent(rl(p)):rl(Vh().relative(decodeURIComponent(w),decodeURIComponent(p))),m)});return y?v:v.filter(C=>C.basename&&(C.type==="file"||C.filename!==f.replace(/\/$/,"")))}(i,Rp(r.remoteBasePath||r.remotePath),o,t.details,t.includeSelf);return t.glob&&(h=function(u,c){return u.filter(f=>Et(f.filename,c,{matchBase:!0}))}(h,t.glob)),Rn(a,h,t.details)})})})});function Xf(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const Dy=Xf(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ot({url:$e(r.remoteURL,je(e)),method:"GET",headers:{Accept:"text/plain"},transformResponse:[Ly]},r,t);return Th(it(s,r),function(a){return ut(r,a),Th(a.text(),function(n){return Rn(a,n,t.details)})})});function Th(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Ty=Xf(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ot({url:$e(r.remoteURL,je(e)),method:"GET"},r,t);return Th(it(s,r),function(a){let n;return ut(r,a),function(i,o){var h=i();return h&&h.then?h.then(o):o()}(function(){return Th(a.arrayBuffer(),function(i){n=i})},function(){return Rn(a,n,t.details)})})}),Ry=Xf(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{format:s="binary"}=t;if(s!=="binary"&&s!=="text")throw new Dt({info:{code:er.InvalidOutputFormat}},`Invalid output format: ${s}`);return s==="text"?Dy(r,e,t):Ty(r,e,t)}),Ly=r=>r;function Uy(r){return new Wf.XMLBuilder({attributeNamePrefix:"@_",format:!0,ignoreAttributes:!1,suppressEmptyNode:!0}).build(fg({lockinfo:{"@_xmlns:d":"DAV:",lockscope:{exclusive:{}},locktype:{write:{}},owner:{href:r}}},"d"))}function fg(r,e){const t={...r};for(const s in t)t.hasOwnProperty(s)&&(t[s]&&typeof t[s]=="object"&&s.indexOf(":")===-1?(t[`${e}:${s}`]=fg(t[s],e),delete t[s]):/^@_/.test(s)===!1&&(t[`${e}:${s}`]=t[s],delete t[s]));return t}function gf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}function pg(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const jy=pg(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ot({url:$e(r.remoteURL,je(e)),method:"UNLOCK",headers:{"Lock-Token":t}},r,s);return gf(it(a,r),function(n){if(ut(r,n),n.status!==204&&n.status!==200)throw qf(n)})}),$y=pg(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{refreshToken:s,timeout:a=Ky}=t,n={Accept:"text/plain,application/xml",Timeout:a};s&&(n.If=s);const i=ot({url:$e(r.remoteURL,je(e)),method:"LOCK",headers:n,data:Uy(r.contactHref)},r,t);return gf(it(i,r),function(o){return ut(r,o),gf(o.text(),function(h){const u=(m=h,new Wf.XMLParser({removeNSPrefix:!0,parseAttributeValue:!0,parseTagValue:!0}).parse(m)),c=Hs().get(u,"prop.lockdiscovery.activelock.locktoken.href"),f=Hs().get(u,"prop.lockdiscovery.activelock.timeout");var m;if(!c)throw qf(o,"No lock token received: ");return{token:c,serverTimeout:f}})})}),Ky="Infinite, Second-4100000000";function fm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const My=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.path||"/",s=ot({url:$e(r.remoteURL,t),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,e);return fm(it(s,r),function(a){return ut(r,a),fm(a.text(),function(n){return fm(hl(n),function(i){const o=function(h){try{const[u]=h.multistatus.response,{propstat:{prop:{"quota-used-bytes":c,"quota-available-bytes":f}}}=u;return c!==void 0&&f!==void 0?{used:parseInt(String(c),10),available:lg(f)}:null}catch{}return null}(i);return Rn(a,o,e.details)})})})});function pm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Hy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=ot({url:$e(r.remoteURL,je(e)),method:"SEARCH",headers:{Accept:"text/plain,application/xml","Content-Type":r.headers["Content-Type"]||"application/xml; charset=utf-8"}},r,t);return pm(it(a,r),function(n){return ut(r,n),pm(n.text(),function(i){return pm(hl(i),function(o){const h=function(u,c,f){const m={truncated:!1,results:[]};return m.truncated=u.multistatus.response.some(y=>(y.status||y.propstat?.status).split(" ",3)?.[1]==="507"&&y.href.replace(/\/$/,"").endsWith(je(c).replace(/\/$/,""))),u.multistatus.response.forEach(y=>{if(y.propstat===void 0)return;const w=y.href.split("/").map(decodeURIComponent).join("/");m.results.push(Xh(y.propstat.prop,w,f))}),m}(o,e,s);return Rn(n,h,s)})})})}),Fy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ot({url:$e(r.remoteURL,je(e)),method:"MOVE",headers:{Destination:$e(r.remoteURL,je(t)),Overwrite:s.overwrite===!1?"F":"T"}},r,s);return i=function(o){ut(r,o)},(n=it(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i});var Jy=Ie(172);const qy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const{contentLength:a=!0,overwrite:n=!0}=s,i={"Content-Type":"application/octet-stream"};a===!1||(i["Content-Length"]=typeof a=="number"?`${a}`:`${function(c){if(sg(c))return c.byteLength;if(rg(c))return c.length;if(typeof c=="string")return(0,Jy.d)(c);throw new Dt({info:{code:er.DataTypeNoLength}},"Cannot calculate data length: Invalid type")}(t)}`),n||(i["If-None-Match"]="*");const o=ot({url:$e(r.remoteURL,je(e)),method:"PUT",headers:i,data:t},r,s);return u=function(c){try{ut(r,c)}catch(f){const m=f;if(m.status!==412||n)throw m;return!1}return!0},(h=it(o,r))&&h.then||(h=Promise.resolve(h)),u?h.then(u):h;var h,u}),dg=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ot({url:$e(r.remoteURL,je(e)),method:"OPTIONS"},r,t);return n=function(i){try{ut(r,i)}catch(o){throw o}return{compliance:(i.headers.get("DAV")??"").split(",").map(o=>o.trim()),server:i.headers.get("Server")??""}},(a=it(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n});function Yc(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Wy=zf(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new Dt({info:{code:er.InvalidUpdateRange}},`Invalid update range ${t} for partial update`);const i={"Content-Type":"application/octet-stream","Content-Length":""+(s-t+1),"Content-Range":`bytes ${t}-${s}/*`},o=ot({url:$e(r.remoteURL,je(e)),method:"PUT",headers:i,data:a},r,n);return Yc(it(o,r),function(h){ut(r,h)})});function _p(r,e){var t=r();return t&&t.then?t.then(e):e(t)}const Gy=zf(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new Dt({info:{code:er.InvalidUpdateRange}},`Invalid update range ${t} for partial update`);const i={"Content-Type":"application/x-sabredav-partialupdate","Content-Length":""+(s-t+1),"X-Update-Range":`bytes=${t}-${s}`},o=ot({url:$e(r.remoteURL,je(e)),method:"PATCH",headers:i,data:a},r,n);return Yc(it(o,r),function(h){ut(r,h)})});function zf(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const Xy=zf(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};return Yc(dg(r,e,n),function(i){let o=!1;return _p(function(){if(i.compliance.includes("sabredav-partialupdate"))return Yc(Gy(r,e,t,s,a,n),function(h){return o=!0,h})},function(h){let u=!1;return o?h:_p(function(){if(i.server.includes("Apache")&&i.compliance.includes("<http://apache.org/dav/propset/fs/1>"))return Yc(Wy(r,e,t,s,a,n),function(c){return u=!0,c})},function(c){if(u)return c;throw new Dt({info:{code:er.NotSupported}},"Not supported")})})})}),zy="https://github.com/perry-mitchell/webdav-client/blob/master/LOCK_CONTACT.md";function Yy(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{authType:t=null,remoteBasePath:s,contactHref:a=zy,ha1:n,headers:i={},httpAgent:o,httpsAgent:h,password:u,token:c,username:f,withCredentials:m}=e;let y=t;y||(y=f||u?Bt.Password:Bt.None);const w={authType:y,remoteBasePath:s,contactHref:a,ha1:n,headers:Object.assign({},i),httpAgent:o,httpsAgent:h,password:u,remotePath:jw(r),remoteURL:r,token:c,username:f,withCredentials:m};return Zd(w,f,u,c,n),{copyFile:(S,v,C)=>Sy(w,S,v,C),createDirectory:(S,v)=>df(w,S,v),createReadStream:(S,v)=>function(C,p){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const k=new(Yp()).PassThrough;return Iy(C,p,b).then(P=>{P.pipe(k)}).catch(P=>{k.emit("error",P)}),k}(w,S,v),createWriteStream:(S,v,C)=>function(p,b){let k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Vy;const x=new(Yp()).PassThrough,T={};k.overwrite===!1&&(T["If-None-Match"]="*");const B=ot({url:$e(p.remoteURL,je(b)),method:"PUT",headers:T,data:x,maxRedirects:0},p,k);return it(B,p).then(V=>ut(p,V)).then(V=>{setTimeout(()=>{P(V)},0)}).catch(V=>{x.emit("error",V)}),x}(w,S,v,C),customRequest:(S,v)=>xy(w,S,v),deleteFile:(S,v)=>By(w,S,v),exists:(S,v)=>Oy(w,S,v),getDirectoryContents:(S,v)=>Py(w,S,v),getFileContents:(S,v)=>Ry(w,S,v),getFileDownloadLink:S=>function(v,C){let p=$e(v.remoteURL,je(C));const b=/^https:/i.test(p)?"https":"http";switch(v.authType){case Bt.None:break;case Bt.Password:{const k=Up(v.headers.Authorization.replace(/^Basic /i,"").trim());p=p.replace(/^https?:\/\//,`${b}://${k}@`);break}default:throw new Dt({info:{code:er.LinkUnsupportedAuthType}},`Unsupported auth type for file link: ${v.authType}`)}return p}(w,S),getFileUploadLink:S=>function(v,C){let p=`${$e(v.remoteURL,je(C))}?Content-Type=application/octet-stream`;const b=/^https:/i.test(p)?"https":"http";switch(v.authType){case Bt.None:break;case Bt.Password:{const k=Up(v.headers.Authorization.replace(/^Basic /i,"").trim());p=p.replace(/^https?:\/\//,`${b}://${k}@`);break}default:throw new Dt({info:{code:er.LinkUnsupportedAuthType}},`Unsupported auth type for file link: ${v.authType}`)}return p}(w,S),getHeaders:()=>Object.assign({},w.headers),getQuota:S=>My(w,S),lock:(S,v)=>$y(w,S,v),moveFile:(S,v,C)=>Fy(w,S,v,C),putFileContents:(S,v,C)=>qy(w,S,v,C),partialUpdateFileContents:(S,v,C,p,b)=>Xy(w,S,v,C,p,b),getDAVCompliance:S=>dg(w,S),search:(S,v)=>Hy(w,S,v),setHeaders:S=>{w.headers=Object.assign({},S)},stat:(S,v)=>Gf(w,S,v),unlock:(S,v,C)=>jy(w,S,v,C)}}as.hT,as.O4,as.Kd,as.YK;var _y=as.UU,Qy=as.Gu,Zy=as.ky,e0=as.h4;as.ch,as.hq,as.i5;const bo=ow().setApp("@nextcloud/files").detectUser().build();var gg=(r=>(r.Folder="folder",r.File="file",r))(gg||{}),wg=(r=>(r[r.NONE=0]="NONE",r[r.CREATE=4]="CREATE",r[r.READ=1]="READ",r[r.UPDATE=2]="UPDATE",r[r.DELETE=8]="DELETE",r[r.SHARE=16]="SHARE",r[r.ALL=31]="ALL",r))(wg||{});const yg=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],vg={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},dm=function(r,e={nc:"http://nextcloud.org/ns"}){typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...yg],window._nc_dav_namespaces={...vg});const t={...window._nc_dav_namespaces,...e};if(window._nc_dav_properties.find(a=>a===r))return bo.warn(`${r} already registered`,{prop:r}),!1;if(r.startsWith("<")||r.split(":").length!==2)return bo.error(`${r} is not valid. See example: 'oc:fileid'`,{prop:r}),!1;const s=r.split(":")[0];return t[s]?(window._nc_dav_properties.push(r),window._nc_dav_namespaces=t,!0):(bo.error(`${r} namespace unknown`,{prop:r,namespaces:t}),!1)},t0=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...yg]),window._nc_dav_properties.map(r=>`<${r} />`).join(" ")},s0=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces={...vg}),Object.keys(window._nc_dav_namespaces).map(r=>`xmlns:${r}="${window._nc_dav_namespaces?.[r]}"`).join(" ")},r0=function(){return`<?xml version="1.0"?>
		<d:propfind ${s0()}>
			<d:prop>
				${t0()}
			</d:prop>
		</d:propfind>`};function a0(){return zd()?`/files/${xw()}`:`/files/${Jd()?.uid}`}a0();function n0(){const r=uw("dav");return zd()?r.replace("remote.php","public.php"):r}const i0=n0(),o0=function(r=i0,e={}){const t=_y(r,{headers:e});function s(a){t.setHeaders({...e,"X-Requested-With":"XMLHttpRequest",requesttoken:a??""})}return lw(s),s(cw()),Qy().patch("fetch",(a,n)=>{const i=n.headers;return i?.method&&(n.method=i.method,delete i.method),fetch(a,n)}),t};var gm={},wm={exports:{}},Qp={},Zp;function u0(){return Zp||(Zp=1,function(r){Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},t={};t.byteLength=c,t.toByteArray=m,t.fromByteArray=S;for(var s=[],a=[],n=typeof Uint8Array<"u"?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=i.length;o<h;++o)s[o]=i[o],a[i.charCodeAt(o)]=o;a[45]=62,a[95]=63;function u(p){var b=p.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=p.indexOf("=");k===-1&&(k=b);var P=k===b?0:4-k%4;return[k,P]}function c(p){var b=u(p),k=b[0],P=b[1];return(k+P)*3/4-P}function f(p,b,k){return(b+k)*3/4-k}function m(p){var b,k=u(p),P=k[0],x=k[1],T=new n(f(p,P,x)),B=0,V=x>0?P-4:P,J;for(J=0;J<V;J+=4)b=a[p.charCodeAt(J)]<<18|a[p.charCodeAt(J+1)]<<12|a[p.charCodeAt(J+2)]<<6|a[p.charCodeAt(J+3)],T[B++]=b>>16&255,T[B++]=b>>8&255,T[B++]=b&255;return x===2&&(b=a[p.charCodeAt(J)]<<2|a[p.charCodeAt(J+1)]>>4,T[B++]=b&255),x===1&&(b=a[p.charCodeAt(J)]<<10|a[p.charCodeAt(J+1)]<<4|a[p.charCodeAt(J+2)]>>2,T[B++]=b>>8&255,T[B++]=b&255),T}function y(p){return s[p>>18&63]+s[p>>12&63]+s[p>>6&63]+s[p&63]}function w(p,b,k){for(var P,x=[],T=b;T<k;T+=3)P=(p[T]<<16&16711680)+(p[T+1]<<8&65280)+(p[T+2]&255),x.push(y(P));return x.join("")}function S(p){for(var b,k=p.length,P=k%3,x=[],T=16383,B=0,V=k-P;B<V;B+=T)x.push(w(p,B,B+T>V?V:B+T));return P===1?(b=p[k-1],x.push(s[b>>2]+s[b<<4&63]+"==")):P===2&&(b=(p[k-2]<<8)+p[k-1],x.push(s[b>>10]+s[b>>4&63]+s[b<<2&63]+"=")),x.join("")}var v={};v.read=function(p,b,k,P,x){var T,B,V=x*8-P-1,J=(1<<V)-1,F=J>>1,D=-7,j=k?x-1:0,ee=k?-1:1,_=p[b+j];for(j+=ee,T=_&(1<<-D)-1,_>>=-D,D+=V;D>0;T=T*256+p[b+j],j+=ee,D-=8);for(B=T&(1<<-D)-1,T>>=-D,D+=P;D>0;B=B*256+p[b+j],j+=ee,D-=8);if(T===0)T=1-F;else{if(T===J)return B?NaN:(_?-1:1)*(1/0);B=B+Math.pow(2,P),T=T-F}return(_?-1:1)*B*Math.pow(2,T-P)},v.write=function(p,b,k,P,x,T){var B,V,J,F=T*8-x-1,D=(1<<F)-1,j=D>>1,ee=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=P?0:T-1,ie=P?1:-1,ae=b<0||b===0&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(V=isNaN(b)?1:0,B=D):(B=Math.floor(Math.log(b)/Math.LN2),b*(J=Math.pow(2,-B))<1&&(B--,J*=2),B+j>=1?b+=ee/J:b+=ee*Math.pow(2,1-j),b*J>=2&&(B++,J/=2),B+j>=D?(V=0,B=D):B+j>=1?(V=(b*J-1)*Math.pow(2,x),B=B+j):(V=b*Math.pow(2,j-1)*Math.pow(2,x),B=0));x>=8;p[k+_]=V&255,_+=ie,V/=256,x-=8);for(B=B<<x|V,F+=x;F>0;p[k+_]=B&255,_+=ie,B/=256,F-=8);p[k+_-ie]|=ae*128},function(p){const b=t,k=v,P=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;p.Buffer=D,p.SlowBuffer=ce,p.INSPECT_MAX_BYTES=50;const x=2147483647;p.kMaxLength=x;const{Uint8Array:T,ArrayBuffer:B,SharedArrayBuffer:V}=globalThis;D.TYPED_ARRAY_SUPPORT=J(),!D.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function J(){try{const l=new T(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,T.prototype),Object.setPrototypeOf(l,g),l.foo()===42}catch{return!1}}Object.defineProperty(D.prototype,"parent",{enumerable:!0,get:function(){if(D.isBuffer(this))return this.buffer}}),Object.defineProperty(D.prototype,"offset",{enumerable:!0,get:function(){if(D.isBuffer(this))return this.byteOffset}});function F(l){if(l>x)throw new RangeError('The value "'+l+'" is invalid for option "size"');const g=new T(l);return Object.setPrototypeOf(g,D.prototype),g}function D(l,g,N){if(typeof l=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return ie(l)}return j(l,g,N)}D.poolSize=8192;function j(l,g,N){if(typeof l=="string")return ae(l,g);if(B.isView(l))return ne(l);if(l==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l);if(ws(l,B)||l&&ws(l.buffer,B)||typeof V<"u"&&(ws(l,V)||l&&ws(l.buffer,V)))return se(l,g,N);if(typeof l=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const R=l.valueOf&&l.valueOf();if(R!=null&&R!==l)return D.from(R,g,N);const K=te(l);if(K)return K;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof l[Symbol.toPrimitive]=="function")return D.from(l[Symbol.toPrimitive]("string"),g,N);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l)}D.from=function(l,g,N){return j(l,g,N)},Object.setPrototypeOf(D.prototype,T.prototype),Object.setPrototypeOf(D,T);function ee(l){if(typeof l!="number")throw new TypeError('"size" argument must be of type number');if(l<0)throw new RangeError('The value "'+l+'" is invalid for option "size"')}function _(l,g,N){return ee(l),l<=0?F(l):g!==void 0?typeof N=="string"?F(l).fill(g,N):F(l).fill(g):F(l)}D.alloc=function(l,g,N){return _(l,g,N)};function ie(l){return ee(l),F(l<0?0:Z(l)|0)}D.allocUnsafe=function(l){return ie(l)},D.allocUnsafeSlow=function(l){return ie(l)};function ae(l,g){if((typeof g!="string"||g==="")&&(g="utf8"),!D.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const N=fe(l,g)|0;let R=F(N);const K=R.write(l,g);return K!==N&&(R=R.slice(0,K)),R}function pe(l){const g=l.length<0?0:Z(l.length)|0,N=F(g);for(let R=0;R<g;R+=1)N[R]=l[R]&255;return N}function ne(l){if(ws(l,T)){const g=new T(l);return se(g.buffer,g.byteOffset,g.byteLength)}return pe(l)}function se(l,g,N){if(g<0||l.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(l.byteLength<g+(N||0))throw new RangeError('"length" is outside of buffer bounds');let R;return g===void 0&&N===void 0?R=new T(l):N===void 0?R=new T(l,g):R=new T(l,g,N),Object.setPrototypeOf(R,D.prototype),R}function te(l){if(D.isBuffer(l)){const g=Z(l.length)|0,N=F(g);return N.length===0||l.copy(N,0,0,g),N}if(l.length!==void 0)return typeof l.length!="number"||tm(l.length)?F(0):pe(l);if(l.type==="Buffer"&&Array.isArray(l.data))return pe(l.data)}function Z(l){if(l>=x)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+x.toString(16)+" bytes");return l|0}function ce(l){return+l!=l&&(l=0),D.alloc(+l)}D.isBuffer=function(l){return l!=null&&l._isBuffer===!0&&l!==D.prototype},D.compare=function(l,g){if(ws(l,T)&&(l=D.from(l,l.offset,l.byteLength)),ws(g,T)&&(g=D.from(g,g.offset,g.byteLength)),!D.isBuffer(l)||!D.isBuffer(g))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(l===g)return 0;let N=l.length,R=g.length;for(let K=0,W=Math.min(N,R);K<W;++K)if(l[K]!==g[K]){N=l[K],R=g[K];break}return N<R?-1:R<N?1:0},D.isEncoding=function(l){switch(String(l).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},D.concat=function(l,g){if(!Array.isArray(l))throw new TypeError('"list" argument must be an Array of Buffers');if(l.length===0)return D.alloc(0);let N;if(g===void 0)for(g=0,N=0;N<l.length;++N)g+=l[N].length;const R=D.allocUnsafe(g);let K=0;for(N=0;N<l.length;++N){let W=l[N];if(ws(W,T))K+W.length>R.length?(D.isBuffer(W)||(W=D.from(W)),W.copy(R,K)):T.prototype.set.call(R,W,K);else if(D.isBuffer(W))W.copy(R,K);else throw new TypeError('"list" argument must be an Array of Buffers');K+=W.length}return R};function fe(l,g){if(D.isBuffer(l))return l.length;if(B.isView(l)||ws(l,B))return l.byteLength;if(typeof l!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof l);const N=l.length,R=arguments.length>2&&arguments[2]===!0;if(!R&&N===0)return 0;let K=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return N;case"utf8":case"utf-8":return em(l).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N*2;case"hex":return N>>>1;case"base64":return Np(l).length;default:if(K)return R?-1:em(l).length;g=(""+g).toLowerCase(),K=!0}}D.byteLength=fe;function ke(l,g,N){let R=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((N===void 0||N>this.length)&&(N=this.length),N<=0)||(N>>>=0,g>>>=0,N<=g))return"";for(l||(l="utf8");;)switch(l){case"hex":return fl(this,g,N);case"utf8":case"utf-8":return ft(this,g,N);case"ascii":return ns(this,g,N);case"latin1":case"binary":return Qh(this,g,N);case"base64":return wt(this,g,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return To(this,g,N);default:if(R)throw new TypeError("Unknown encoding: "+l);l=(l+"").toLowerCase(),R=!0}}D.prototype._isBuffer=!0;function Me(l,g,N){const R=l[g];l[g]=l[N],l[N]=R}D.prototype.swap16=function(){const l=this.length;if(l%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let g=0;g<l;g+=2)Me(this,g,g+1);return this},D.prototype.swap32=function(){const l=this.length;if(l%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let g=0;g<l;g+=4)Me(this,g,g+3),Me(this,g+1,g+2);return this},D.prototype.swap64=function(){const l=this.length;if(l%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let g=0;g<l;g+=8)Me(this,g,g+7),Me(this,g+1,g+6),Me(this,g+2,g+5),Me(this,g+3,g+4);return this},D.prototype.toString=function(){const l=this.length;return l===0?"":arguments.length===0?ft(this,0,l):ke.apply(this,arguments)},D.prototype.toLocaleString=D.prototype.toString,D.prototype.equals=function(l){if(!D.isBuffer(l))throw new TypeError("Argument must be a Buffer");return this===l?!0:D.compare(this,l)===0},D.prototype.inspect=function(){let l="";const g=p.INSPECT_MAX_BYTES;return l=this.toString("hex",0,g).replace(/(.{2})/g,"$1 ").trim(),this.length>g&&(l+=" ... "),"<Buffer "+l+">"},P&&(D.prototype[P]=D.prototype.inspect),D.prototype.compare=function(l,g,N,R,K){if(ws(l,T)&&(l=D.from(l,l.offset,l.byteLength)),!D.isBuffer(l))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof l);if(g===void 0&&(g=0),N===void 0&&(N=l?l.length:0),R===void 0&&(R=0),K===void 0&&(K=this.length),g<0||N>l.length||R<0||K>this.length)throw new RangeError("out of range index");if(R>=K&&g>=N)return 0;if(R>=K)return-1;if(g>=N)return 1;if(g>>>=0,N>>>=0,R>>>=0,K>>>=0,this===l)return 0;let W=K-R,Q=N-g;const Oe=Math.min(W,Q),pt=this.slice(R,K),Pe=l.slice(g,N);for(let Ve=0;Ve<Oe;++Ve)if(pt[Ve]!==Pe[Ve]){W=pt[Ve],Q=Pe[Ve];break}return W<Q?-1:Q<W?1:0};function I(l,g,N,R,K){if(l.length===0)return-1;if(typeof N=="string"?(R=N,N=0):N>2147483647?N=2147483647:N<-2147483648&&(N=-2147483648),N=+N,tm(N)&&(N=K?0:l.length-1),N<0&&(N=l.length+N),N>=l.length){if(K)return-1;N=l.length-1}else if(N<0)if(K)N=0;else return-1;if(typeof g=="string"&&(g=D.from(g,R)),D.isBuffer(g))return g.length===0?-1:A(l,g,N,R,K);if(typeof g=="number")return g=g&255,typeof T.prototype.indexOf=="function"?K?T.prototype.indexOf.call(l,g,N):T.prototype.lastIndexOf.call(l,g,N):A(l,[g],N,R,K);throw new TypeError("val must be string, number or Buffer")}function A(l,g,N,R,K){let W=1,Q=l.length,Oe=g.length;if(R!==void 0&&(R=String(R).toLowerCase(),R==="ucs2"||R==="ucs-2"||R==="utf16le"||R==="utf-16le")){if(l.length<2||g.length<2)return-1;W=2,Q/=2,Oe/=2,N/=2}function pt(Ve,_e){return W===1?Ve[_e]:Ve.readUInt16BE(_e*W)}let Pe;if(K){let Ve=-1;for(Pe=N;Pe<Q;Pe++)if(pt(l,Pe)===pt(g,Ve===-1?0:Pe-Ve)){if(Ve===-1&&(Ve=Pe),Pe-Ve+1===Oe)return Ve*W}else Ve!==-1&&(Pe-=Pe-Ve),Ve=-1}else for(N+Oe>Q&&(N=Q-Oe),Pe=N;Pe>=0;Pe--){let Ve=!0;for(let _e=0;_e<Oe;_e++)if(pt(l,Pe+_e)!==pt(g,_e)){Ve=!1;break}if(Ve)return Pe}return-1}D.prototype.includes=function(l,g,N){return this.indexOf(l,g,N)!==-1},D.prototype.indexOf=function(l,g,N){return I(this,l,g,N,!0)},D.prototype.lastIndexOf=function(l,g,N){return I(this,l,g,N,!1)};function $(l,g,N,R){N=Number(N)||0;const K=l.length-N;R?(R=Number(R),R>K&&(R=K)):R=K;const W=g.length;R>W/2&&(R=W/2);let Q;for(Q=0;Q<R;++Q){const Oe=parseInt(g.substr(Q*2,2),16);if(tm(Oe))return Q;l[N+Q]=Oe}return Q}function L(l,g,N,R){return pl(em(g,l.length-N),l,N,R)}function de(l,g,N,R){return pl(rw(g),l,N,R)}function Ee(l,g,N,R){return pl(Np(g),l,N,R)}function le(l,g,N,R){return pl(aw(g,l.length-N),l,N,R)}D.prototype.write=function(l,g,N,R){if(g===void 0)R="utf8",N=this.length,g=0;else if(N===void 0&&typeof g=="string")R=g,N=this.length,g=0;else if(isFinite(g))g=g>>>0,isFinite(N)?(N=N>>>0,R===void 0&&(R="utf8")):(R=N,N=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const K=this.length-g;if((N===void 0||N>K)&&(N=K),l.length>0&&(N<0||g<0)||g>this.length)throw new RangeError("Attempt to write outside buffer bounds");R||(R="utf8");let W=!1;for(;;)switch(R){case"hex":return $(this,l,g,N);case"utf8":case"utf-8":return L(this,l,g,N);case"ascii":case"latin1":case"binary":return de(this,l,g,N);case"base64":return Ee(this,l,g,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return le(this,l,g,N);default:if(W)throw new TypeError("Unknown encoding: "+R);R=(""+R).toLowerCase(),W=!0}},D.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function wt(l,g,N){return g===0&&N===l.length?b.fromByteArray(l):b.fromByteArray(l.slice(g,N))}function ft(l,g,N){N=Math.min(l.length,N);const R=[];let K=g;for(;K<N;){const W=l[K];let Q=null,Oe=W>239?4:W>223?3:W>191?2:1;if(K+Oe<=N){let pt,Pe,Ve,_e;switch(Oe){case 1:W<128&&(Q=W);break;case 2:pt=l[K+1],(pt&192)===128&&(_e=(W&31)<<6|pt&63,_e>127&&(Q=_e));break;case 3:pt=l[K+1],Pe=l[K+2],(pt&192)===128&&(Pe&192)===128&&(_e=(W&15)<<12|(pt&63)<<6|Pe&63,_e>2047&&(_e<55296||_e>57343)&&(Q=_e));break;case 4:pt=l[K+1],Pe=l[K+2],Ve=l[K+3],(pt&192)===128&&(Pe&192)===128&&(Ve&192)===128&&(_e=(W&15)<<18|(pt&63)<<12|(Pe&63)<<6|Ve&63,_e>65535&&_e<1114112&&(Q=_e))}}Q===null?(Q=65533,Oe=1):Q>65535&&(Q-=65536,R.push(Q>>>10&1023|55296),Q=56320|Q&1023),R.push(Q),K+=Oe}return rt(R)}const Is=4096;function rt(l){const g=l.length;if(g<=Is)return String.fromCharCode.apply(String,l);let N="",R=0;for(;R<g;)N+=String.fromCharCode.apply(String,l.slice(R,R+=Is));return N}function ns(l,g,N){let R="";N=Math.min(l.length,N);for(let K=g;K<N;++K)R+=String.fromCharCode(l[K]&127);return R}function Qh(l,g,N){let R="";N=Math.min(l.length,N);for(let K=g;K<N;++K)R+=String.fromCharCode(l[K]);return R}function fl(l,g,N){const R=l.length;(!g||g<0)&&(g=0),(!N||N<0||N>R)&&(N=R);let K="";for(let W=g;W<N;++W)K+=nw[l[W]];return K}function To(l,g,N){const R=l.slice(g,N);let K="";for(let W=0;W<R.length-1;W+=2)K+=String.fromCharCode(R[W]+R[W+1]*256);return K}D.prototype.slice=function(l,g){const N=this.length;l=~~l,g=g===void 0?N:~~g,l<0?(l+=N,l<0&&(l=0)):l>N&&(l=N),g<0?(g+=N,g<0&&(g=0)):g>N&&(g=N),g<l&&(g=l);const R=this.subarray(l,g);return Object.setPrototypeOf(R,D.prototype),R};function He(l,g,N){if(l%1!==0||l<0)throw new RangeError("offset is not uint");if(l+g>N)throw new RangeError("Trying to access beyond buffer length")}D.prototype.readUintLE=D.prototype.readUIntLE=function(l,g,N){l=l>>>0,g=g>>>0,N||He(l,g,this.length);let R=this[l],K=1,W=0;for(;++W<g&&(K*=256);)R+=this[l+W]*K;return R},D.prototype.readUintBE=D.prototype.readUIntBE=function(l,g,N){l=l>>>0,g=g>>>0,N||He(l,g,this.length);let R=this[l+--g],K=1;for(;g>0&&(K*=256);)R+=this[l+--g]*K;return R},D.prototype.readUint8=D.prototype.readUInt8=function(l,g){return l=l>>>0,g||He(l,1,this.length),this[l]},D.prototype.readUint16LE=D.prototype.readUInt16LE=function(l,g){return l=l>>>0,g||He(l,2,this.length),this[l]|this[l+1]<<8},D.prototype.readUint16BE=D.prototype.readUInt16BE=function(l,g){return l=l>>>0,g||He(l,2,this.length),this[l]<<8|this[l+1]},D.prototype.readUint32LE=D.prototype.readUInt32LE=function(l,g){return l=l>>>0,g||He(l,4,this.length),(this[l]|this[l+1]<<8|this[l+2]<<16)+this[l+3]*16777216},D.prototype.readUint32BE=D.prototype.readUInt32BE=function(l,g){return l=l>>>0,g||He(l,4,this.length),this[l]*16777216+(this[l+1]<<16|this[l+2]<<8|this[l+3])},D.prototype.readBigUInt64LE=sr(function(l){l=l>>>0,Kn(l,"offset");const g=this[l],N=this[l+7];(g===void 0||N===void 0)&&Ro(l,this.length-8);const R=g+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24,K=this[++l]+this[++l]*2**8+this[++l]*2**16+N*2**24;return BigInt(R)+(BigInt(K)<<BigInt(32))}),D.prototype.readBigUInt64BE=sr(function(l){l=l>>>0,Kn(l,"offset");const g=this[l],N=this[l+7];(g===void 0||N===void 0)&&Ro(l,this.length-8);const R=g*2**24+this[++l]*2**16+this[++l]*2**8+this[++l],K=this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+N;return(BigInt(R)<<BigInt(32))+BigInt(K)}),D.prototype.readIntLE=function(l,g,N){l=l>>>0,g=g>>>0,N||He(l,g,this.length);let R=this[l],K=1,W=0;for(;++W<g&&(K*=256);)R+=this[l+W]*K;return K*=128,R>=K&&(R-=Math.pow(2,8*g)),R},D.prototype.readIntBE=function(l,g,N){l=l>>>0,g=g>>>0,N||He(l,g,this.length);let R=g,K=1,W=this[l+--R];for(;R>0&&(K*=256);)W+=this[l+--R]*K;return K*=128,W>=K&&(W-=Math.pow(2,8*g)),W},D.prototype.readInt8=function(l,g){return l=l>>>0,g||He(l,1,this.length),this[l]&128?(255-this[l]+1)*-1:this[l]},D.prototype.readInt16LE=function(l,g){l=l>>>0,g||He(l,2,this.length);const N=this[l]|this[l+1]<<8;return N&32768?N|4294901760:N},D.prototype.readInt16BE=function(l,g){l=l>>>0,g||He(l,2,this.length);const N=this[l+1]|this[l]<<8;return N&32768?N|4294901760:N},D.prototype.readInt32LE=function(l,g){return l=l>>>0,g||He(l,4,this.length),this[l]|this[l+1]<<8|this[l+2]<<16|this[l+3]<<24},D.prototype.readInt32BE=function(l,g){return l=l>>>0,g||He(l,4,this.length),this[l]<<24|this[l+1]<<16|this[l+2]<<8|this[l+3]},D.prototype.readBigInt64LE=sr(function(l){l=l>>>0,Kn(l,"offset");const g=this[l],N=this[l+7];(g===void 0||N===void 0)&&Ro(l,this.length-8);const R=this[l+4]+this[l+5]*2**8+this[l+6]*2**16+(N<<24);return(BigInt(R)<<BigInt(32))+BigInt(g+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24)}),D.prototype.readBigInt64BE=sr(function(l){l=l>>>0,Kn(l,"offset");const g=this[l],N=this[l+7];(g===void 0||N===void 0)&&Ro(l,this.length-8);const R=(g<<24)+this[++l]*2**16+this[++l]*2**8+this[++l];return(BigInt(R)<<BigInt(32))+BigInt(this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+N)}),D.prototype.readFloatLE=function(l,g){return l=l>>>0,g||He(l,4,this.length),k.read(this,l,!0,23,4)},D.prototype.readFloatBE=function(l,g){return l=l>>>0,g||He(l,4,this.length),k.read(this,l,!1,23,4)},D.prototype.readDoubleLE=function(l,g){return l=l>>>0,g||He(l,8,this.length),k.read(this,l,!0,52,8)},D.prototype.readDoubleBE=function(l,g){return l=l>>>0,g||He(l,8,this.length),k.read(this,l,!1,52,8)};function Lt(l,g,N,R,K,W){if(!D.isBuffer(l))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>K||g<W)throw new RangeError('"value" argument is out of bounds');if(N+R>l.length)throw new RangeError("Index out of range")}D.prototype.writeUintLE=D.prototype.writeUIntLE=function(l,g,N,R){if(l=+l,g=g>>>0,N=N>>>0,!R){const Q=Math.pow(2,8*N)-1;Lt(this,l,g,N,Q,0)}let K=1,W=0;for(this[g]=l&255;++W<N&&(K*=256);)this[g+W]=l/K&255;return g+N},D.prototype.writeUintBE=D.prototype.writeUIntBE=function(l,g,N,R){if(l=+l,g=g>>>0,N=N>>>0,!R){const Q=Math.pow(2,8*N)-1;Lt(this,l,g,N,Q,0)}let K=N-1,W=1;for(this[g+K]=l&255;--K>=0&&(W*=256);)this[g+K]=l/W&255;return g+N},D.prototype.writeUint8=D.prototype.writeUInt8=function(l,g,N){return l=+l,g=g>>>0,N||Lt(this,l,g,1,255,0),this[g]=l&255,g+1},D.prototype.writeUint16LE=D.prototype.writeUInt16LE=function(l,g,N){return l=+l,g=g>>>0,N||Lt(this,l,g,2,65535,0),this[g]=l&255,this[g+1]=l>>>8,g+2},D.prototype.writeUint16BE=D.prototype.writeUInt16BE=function(l,g,N){return l=+l,g=g>>>0,N||Lt(this,l,g,2,65535,0),this[g]=l>>>8,this[g+1]=l&255,g+2},D.prototype.writeUint32LE=D.prototype.writeUInt32LE=function(l,g,N){return l=+l,g=g>>>0,N||Lt(this,l,g,4,4294967295,0),this[g+3]=l>>>24,this[g+2]=l>>>16,this[g+1]=l>>>8,this[g]=l&255,g+4},D.prototype.writeUint32BE=D.prototype.writeUInt32BE=function(l,g,N){return l=+l,g=g>>>0,N||Lt(this,l,g,4,4294967295,0),this[g]=l>>>24,this[g+1]=l>>>16,this[g+2]=l>>>8,this[g+3]=l&255,g+4};function gp(l,g,N,R,K){Sp(g,R,K,l,N,7);let W=Number(g&BigInt(4294967295));l[N++]=W,W=W>>8,l[N++]=W,W=W>>8,l[N++]=W,W=W>>8,l[N++]=W;let Q=Number(g>>BigInt(32)&BigInt(4294967295));return l[N++]=Q,Q=Q>>8,l[N++]=Q,Q=Q>>8,l[N++]=Q,Q=Q>>8,l[N++]=Q,N}function wp(l,g,N,R,K){Sp(g,R,K,l,N,7);let W=Number(g&BigInt(4294967295));l[N+7]=W,W=W>>8,l[N+6]=W,W=W>>8,l[N+5]=W,W=W>>8,l[N+4]=W;let Q=Number(g>>BigInt(32)&BigInt(4294967295));return l[N+3]=Q,Q=Q>>8,l[N+2]=Q,Q=Q>>8,l[N+1]=Q,Q=Q>>8,l[N]=Q,N+8}D.prototype.writeBigUInt64LE=sr(function(l,g=0){return gp(this,l,g,BigInt(0),BigInt("0xffffffffffffffff"))}),D.prototype.writeBigUInt64BE=sr(function(l,g=0){return wp(this,l,g,BigInt(0),BigInt("0xffffffffffffffff"))}),D.prototype.writeIntLE=function(l,g,N,R){if(l=+l,g=g>>>0,!R){const Oe=Math.pow(2,8*N-1);Lt(this,l,g,N,Oe-1,-Oe)}let K=0,W=1,Q=0;for(this[g]=l&255;++K<N&&(W*=256);)l<0&&Q===0&&this[g+K-1]!==0&&(Q=1),this[g+K]=(l/W>>0)-Q&255;return g+N},D.prototype.writeIntBE=function(l,g,N,R){if(l=+l,g=g>>>0,!R){const Oe=Math.pow(2,8*N-1);Lt(this,l,g,N,Oe-1,-Oe)}let K=N-1,W=1,Q=0;for(this[g+K]=l&255;--K>=0&&(W*=256);)l<0&&Q===0&&this[g+K+1]!==0&&(Q=1),this[g+K]=(l/W>>0)-Q&255;return g+N},D.prototype.writeInt8=function(l,g,N){return l=+l,g=g>>>0,N||Lt(this,l,g,1,127,-128),l<0&&(l=255+l+1),this[g]=l&255,g+1},D.prototype.writeInt16LE=function(l,g,N){return l=+l,g=g>>>0,N||Lt(this,l,g,2,32767,-32768),this[g]=l&255,this[g+1]=l>>>8,g+2},D.prototype.writeInt16BE=function(l,g,N){return l=+l,g=g>>>0,N||Lt(this,l,g,2,32767,-32768),this[g]=l>>>8,this[g+1]=l&255,g+2},D.prototype.writeInt32LE=function(l,g,N){return l=+l,g=g>>>0,N||Lt(this,l,g,4,2147483647,-2147483648),this[g]=l&255,this[g+1]=l>>>8,this[g+2]=l>>>16,this[g+3]=l>>>24,g+4},D.prototype.writeInt32BE=function(l,g,N){return l=+l,g=g>>>0,N||Lt(this,l,g,4,2147483647,-2147483648),l<0&&(l=4294967295+l+1),this[g]=l>>>24,this[g+1]=l>>>16,this[g+2]=l>>>8,this[g+3]=l&255,g+4},D.prototype.writeBigInt64LE=sr(function(l,g=0){return gp(this,l,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),D.prototype.writeBigInt64BE=sr(function(l,g=0){return wp(this,l,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function yp(l,g,N,R,K,W){if(N+R>l.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("Index out of range")}function vp(l,g,N,R,K){return g=+g,N=N>>>0,K||yp(l,g,N,4),k.write(l,g,N,R,23,4),N+4}D.prototype.writeFloatLE=function(l,g,N){return vp(this,l,g,!0,N)},D.prototype.writeFloatBE=function(l,g,N){return vp(this,l,g,!1,N)};function bp(l,g,N,R,K){return g=+g,N=N>>>0,K||yp(l,g,N,8),k.write(l,g,N,R,52,8),N+8}D.prototype.writeDoubleLE=function(l,g,N){return bp(this,l,g,!0,N)},D.prototype.writeDoubleBE=function(l,g,N){return bp(this,l,g,!1,N)},D.prototype.copy=function(l,g,N,R){if(!D.isBuffer(l))throw new TypeError("argument should be a Buffer");if(N||(N=0),!R&&R!==0&&(R=this.length),g>=l.length&&(g=l.length),g||(g=0),R>0&&R<N&&(R=N),R===N||l.length===0||this.length===0)return 0;if(g<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("Index out of range");if(R<0)throw new RangeError("sourceEnd out of bounds");R>this.length&&(R=this.length),l.length-g<R-N&&(R=l.length-g+N);const K=R-N;return this===l&&typeof T.prototype.copyWithin=="function"?this.copyWithin(g,N,R):T.prototype.set.call(l,this.subarray(N,R),g),K},D.prototype.fill=function(l,g,N,R){if(typeof l=="string"){if(typeof g=="string"?(R=g,g=0,N=this.length):typeof N=="string"&&(R=N,N=this.length),R!==void 0&&typeof R!="string")throw new TypeError("encoding must be a string");if(typeof R=="string"&&!D.isEncoding(R))throw new TypeError("Unknown encoding: "+R);if(l.length===1){const W=l.charCodeAt(0);(R==="utf8"&&W<128||R==="latin1")&&(l=W)}}else typeof l=="number"?l=l&255:typeof l=="boolean"&&(l=Number(l));if(g<0||this.length<g||this.length<N)throw new RangeError("Out of range index");if(N<=g)return this;g=g>>>0,N=N===void 0?this.length:N>>>0,l||(l=0);let K;if(typeof l=="number")for(K=g;K<N;++K)this[K]=l;else{const W=D.isBuffer(l)?l:D.from(l,R),Q=W.length;if(Q===0)throw new TypeError('The value "'+l+'" is invalid for argument "value"');for(K=0;K<N-g;++K)this[K+g]=W[K%Q]}return this};const $n={};function Zh(l,g,N){$n[l]=class extends N{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${l}]`,this.stack,delete this.name}get code(){return l}set code(R){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:R,writable:!0})}toString(){return`${this.name} [${l}]: ${this.message}`}}}Zh("ERR_BUFFER_OUT_OF_BOUNDS",function(l){return l?`${l} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Zh("ERR_INVALID_ARG_TYPE",function(l,g){return`The "${l}" argument must be of type number. Received type ${typeof g}`},TypeError),Zh("ERR_OUT_OF_RANGE",function(l,g,N){let R=`The value of "${l}" is out of range.`,K=N;return Number.isInteger(N)&&Math.abs(N)>2**32?K=Ap(String(N)):typeof N=="bigint"&&(K=String(N),(N>BigInt(2)**BigInt(32)||N<-(BigInt(2)**BigInt(32)))&&(K=Ap(K)),K+="n"),R+=` It must be ${g}. Received ${K}`,R},RangeError);function Ap(l){let g="",N=l.length;const R=l[0]==="-"?1:0;for(;N>=R+4;N-=3)g=`_${l.slice(N-3,N)}${g}`;return`${l.slice(0,N)}${g}`}function ew(l,g,N){Kn(g,"offset"),(l[g]===void 0||l[g+N]===void 0)&&Ro(g,l.length-(N+1))}function Sp(l,g,N,R,K,W){if(l>N||l<g){const Q=typeof g=="bigint"?"n":"";let Oe;throw g===0||g===BigInt(0)?Oe=`>= 0${Q} and < 2${Q} ** ${(W+1)*8}${Q}`:Oe=`>= -(2${Q} ** ${(W+1)*8-1}${Q}) and < 2 ** ${(W+1)*8-1}${Q}`,new $n.ERR_OUT_OF_RANGE("value",Oe,l)}ew(R,K,W)}function Kn(l,g){if(typeof l!="number")throw new $n.ERR_INVALID_ARG_TYPE(g,"number",l)}function Ro(l,g,N){throw Math.floor(l)!==l?(Kn(l,N),new $n.ERR_OUT_OF_RANGE("offset","an integer",l)):g<0?new $n.ERR_BUFFER_OUT_OF_BOUNDS:new $n.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,l)}const tw=/[^+/0-9A-Za-z-_]/g;function sw(l){if(l=l.split("=")[0],l=l.trim().replace(tw,""),l.length<2)return"";for(;l.length%4!==0;)l=l+"=";return l}function em(l,g){g=g||1/0;let N;const R=l.length;let K=null;const W=[];for(let Q=0;Q<R;++Q){if(N=l.charCodeAt(Q),N>55295&&N<57344){if(!K){if(N>56319){(g-=3)>-1&&W.push(239,191,189);continue}else if(Q+1===R){(g-=3)>-1&&W.push(239,191,189);continue}K=N;continue}if(N<56320){(g-=3)>-1&&W.push(239,191,189),K=N;continue}N=(K-55296<<10|N-56320)+65536}else K&&(g-=3)>-1&&W.push(239,191,189);if(K=null,N<128){if((g-=1)<0)break;W.push(N)}else if(N<2048){if((g-=2)<0)break;W.push(N>>6|192,N&63|128)}else if(N<65536){if((g-=3)<0)break;W.push(N>>12|224,N>>6&63|128,N&63|128)}else if(N<1114112){if((g-=4)<0)break;W.push(N>>18|240,N>>12&63|128,N>>6&63|128,N&63|128)}else throw new Error("Invalid code point")}return W}function rw(l){const g=[];for(let N=0;N<l.length;++N)g.push(l.charCodeAt(N)&255);return g}function aw(l,g){let N,R,K;const W=[];for(let Q=0;Q<l.length&&!((g-=2)<0);++Q)N=l.charCodeAt(Q),R=N>>8,K=N%256,W.push(K),W.push(R);return W}function Np(l){return b.toByteArray(sw(l))}function pl(l,g,N,R){let K;for(K=0;K<R&&!(K+N>=g.length||K>=l.length);++K)g[K+N]=l[K];return K}function ws(l,g){return l instanceof g||l!=null&&l.constructor!=null&&l.constructor.name!=null&&l.constructor.name===g.name}function tm(l){return l!==l}const nw=function(){const l="0123456789abcdef",g=new Array(256);for(let N=0;N<16;++N){const R=N*16;for(let K=0;K<16;++K)g[R+K]=l[N]+l[K]}return g}();function sr(l){return typeof BigInt>"u"?iw:l}function iw(){throw new Error("BigInt not supported")}}(e);const C=e.Buffer;r.Blob=e.Blob,r.BlobOptions=e.BlobOptions,r.Buffer=e.Buffer,r.File=e.File,r.FileOptions=e.FileOptions,r.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,r.SlowBuffer=e.SlowBuffer,r.TranscodeEncoding=e.TranscodeEncoding,r.atob=e.atob,r.btoa=e.btoa,r.constants=e.constants,r.default=C,r.isAscii=e.isAscii,r.isUtf8=e.isUtf8,r.kMaxLength=e.kMaxLength,r.kStringMaxLength=e.kStringMaxLength,r.resolveObjectURL=e.resolveObjectURL,r.transcode=e.transcode}(Qp)),Qp}var ed;function c0(){return ed||(ed=1,function(r,e){var t=u0(),s=t.Buffer;function a(i,o){for(var h in i)o[h]=i[h]}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?r.exports=t:(a(t,e),e.Buffer=n);function n(i,o,h){return s(i,o,h)}n.prototype=Object.create(s.prototype),a(s,n),n.from=function(i,o,h){if(typeof i=="number")throw new TypeError("Argument must not be a number");return s(i,o,h)},n.alloc=function(i,o,h){if(typeof i!="number")throw new TypeError("Argument must be a number");var u=s(i);return o!==void 0?typeof h=="string"?u.fill(o,h):u.fill(o):u.fill(0),u},n.allocUnsafe=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return s(i)},n.allocUnsafeSlow=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(i)}}(wm,wm.exports)),wm.exports}var td;function l0(){if(td)return gm;td=1;var r=c0().Buffer,e=r.isEncoding||function(C){switch(C=""+C,C&&C.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(C){if(!C)return"utf8";for(var p;;)switch(C){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return C;default:if(p)return;C=(""+C).toLowerCase(),p=!0}}function s(C){var p=t(C);if(typeof p!="string"&&(r.isEncoding===e||!e(C)))throw new Error("Unknown encoding: "+C);return p||C}gm.StringDecoder=a;function a(C){this.encoding=s(C);var p;switch(this.encoding){case"utf16le":this.text=f,this.end=m,p=4;break;case"utf8":this.fillLast=h,p=4;break;case"base64":this.text=y,this.end=w,p=3;break;default:this.write=S,this.end=v;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(p)}a.prototype.write=function(C){if(C.length===0)return"";var p,b;if(this.lastNeed){if(p=this.fillLast(C),p===void 0)return"";b=this.lastNeed,this.lastNeed=0}else b=0;return b<C.length?p?p+this.text(C,b):this.text(C,b):p||""},a.prototype.end=c,a.prototype.text=u,a.prototype.fillLast=function(C){if(this.lastNeed<=C.length)return C.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);C.copy(this.lastChar,this.lastTotal-this.lastNeed,0,C.length),this.lastNeed-=C.length};function n(C){return C<=127?0:C>>5===6?2:C>>4===14?3:C>>3===30?4:C>>6===2?-1:-2}function i(C,p,b){var k=p.length-1;if(k<b)return 0;var P=n(p[k]);return P>=0?(P>0&&(C.lastNeed=P-1),P):--k<b||P===-2?0:(P=n(p[k]),P>=0?(P>0&&(C.lastNeed=P-2),P):--k<b||P===-2?0:(P=n(p[k]),P>=0?(P>0&&(P===2?P=0:C.lastNeed=P-3),P):0))}function o(C,p,b){if((p[0]&192)!==128)return C.lastNeed=0,"�";if(C.lastNeed>1&&p.length>1){if((p[1]&192)!==128)return C.lastNeed=1,"�";if(C.lastNeed>2&&p.length>2&&(p[2]&192)!==128)return C.lastNeed=2,"�"}}function h(C){var p=this.lastTotal-this.lastNeed,b=o(this,C);if(b!==void 0)return b;if(this.lastNeed<=C.length)return C.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);C.copy(this.lastChar,p,0,C.length),this.lastNeed-=C.length}function u(C,p){var b=i(this,C,p);if(!this.lastNeed)return C.toString("utf8",p);this.lastTotal=b;var k=C.length-(b-this.lastNeed);return C.copy(this.lastChar,0,k),C.toString("utf8",p,k)}function c(C){var p=C&&C.length?this.write(C):"";return this.lastNeed?p+"�":p}function f(C,p){if((C.length-p)%2===0){var b=C.toString("utf16le",p);if(b){var k=b.charCodeAt(b.length-1);if(k>=55296&&k<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=C[C.length-2],this.lastChar[1]=C[C.length-1],b.slice(0,-1)}return b}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=C[C.length-1],C.toString("utf16le",p,C.length-1)}function m(C){var p=C&&C.length?this.write(C):"";if(this.lastNeed){var b=this.lastTotal-this.lastNeed;return p+this.lastChar.toString("utf16le",0,b)}return p}function y(C,p){var b=(C.length-p)%3;return b===0?C.toString("base64",p):(this.lastNeed=3-b,this.lastTotal=3,b===1?this.lastChar[0]=C[C.length-1]:(this.lastChar[0]=C[C.length-2],this.lastChar[1]=C[C.length-1]),C.toString("base64",p,C.length-b))}function w(C){var p=C&&C.length?this.write(C):"";return this.lastNeed?p+this.lastChar.toString("base64",0,3-this.lastNeed):p}function S(C){return C.toString(this.encoding)}function v(C){return C&&C.length?this.write(C):""}return gm}var h0=l0();const m0=hw(h0);var ym={},Yf=(r=>(r.DEFAULT="default",r.HIDDEN="hidden",r))(Yf||{});class f0{_action;constructor(e){this.validateAction(e),this._action=e}get id(){return this._action.id}get displayName(){return this._action.displayName}get title(){return this._action.title}get iconSvgInline(){return this._action.iconSvgInline}get enabled(){return this._action.enabled}get exec(){return this._action.exec}get execBatch(){return this._action.execBatch}get hotkey(){return this._action.hotkey}get order(){return this._action.order}get parent(){return this._action.parent}get default(){return this._action.default}get destructive(){return this._action.destructive}get inline(){return this._action.inline}get renderInline(){return this._action.renderInline}validateAction(e){if(!e.id||typeof e.id!="string")throw new Error("Invalid id");if(!e.displayName||typeof e.displayName!="function")throw new Error("Invalid displayName function");if("title"in e&&typeof e.title!="function")throw new Error("Invalid title function");if(!e.iconSvgInline||typeof e.iconSvgInline!="function")throw new Error("Invalid iconSvgInline function");if(!e.exec||typeof e.exec!="function")throw new Error("Invalid exec function");if("enabled"in e&&typeof e.enabled!="function")throw new Error("Invalid enabled function");if("execBatch"in e&&typeof e.execBatch!="function")throw new Error("Invalid execBatch function");if("order"in e&&typeof e.order!="number")throw new Error("Invalid order");if(e.destructive!==void 0&&typeof e.destructive!="boolean")throw new Error("Invalid destructive flag");if("parent"in e&&typeof e.parent!="string")throw new Error("Invalid parent");if(e.default&&!Object.values(Yf).includes(e.default))throw new Error("Invalid default");if("inline"in e&&typeof e.inline!="function")throw new Error("Invalid inline function");if("renderInline"in e&&typeof e.renderInline!="function")throw new Error("Invalid renderInline function");if("hotkey"in e&&e.hotkey!==void 0){if(typeof e.hotkey!="object")throw new Error("Invalid hotkey configuration");if(typeof e.hotkey.key!="string"||!e.hotkey.key)throw new Error("Missing or invalid hotkey key");if(typeof e.hotkey.description!="string"||!e.hotkey.description)throw new Error("Missing or invalid hotkey description")}}}const p0=function(r){if(typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],bo.debug("FileActions initialized")),window._nc_fileactions.find(e=>e.id===r.id)){bo.error(`FileAction ${r.id} already registered`,{action:r});return}window._nc_fileactions.push(r)},d0=function(){return typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],bo.debug("FileActions initialized")),window._nc_fileactions};var sd,rd;function bg(){return rd||(rd=1,sd=typeof at=="object"&&ym&&ym.NODE_DEBUG&&/\bsemver\b/i.test(ym.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{}),sd}var vm,ad;function Ag(){if(ad)return vm;ad=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,s=16,a=e-6;return vm={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},vm}var bm={exports:{}},nd;function g0(){return nd||(nd=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:a}=Ag(),n=bg();e=r.exports={};const i=e.re=[],o=e.safeRe=[],h=e.src=[],u=e.t={};let c=0;const f="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",a],[f,s]],y=S=>{for(const[v,C]of m)S=S.split(`${v}*`).join(`${v}{0,${C}}`).split(`${v}+`).join(`${v}{1,${C}}`);return S},w=(S,v,C)=>{const p=y(v),b=c++;n(S,b,v),u[S]=b,h[b]=v,i[b]=new RegExp(v,C?"g":void 0),o[b]=new RegExp(p,C?"g":void 0)};w("NUMERICIDENTIFIER","0|[1-9]\\d*"),w("NUMERICIDENTIFIERLOOSE","\\d+"),w("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),w("MAINVERSION",`(${h[u.NUMERICIDENTIFIER]})\\.(${h[u.NUMERICIDENTIFIER]})\\.(${h[u.NUMERICIDENTIFIER]})`),w("MAINVERSIONLOOSE",`(${h[u.NUMERICIDENTIFIERLOOSE]})\\.(${h[u.NUMERICIDENTIFIERLOOSE]})\\.(${h[u.NUMERICIDENTIFIERLOOSE]})`),w("PRERELEASEIDENTIFIER",`(?:${h[u.NUMERICIDENTIFIER]}|${h[u.NONNUMERICIDENTIFIER]})`),w("PRERELEASEIDENTIFIERLOOSE",`(?:${h[u.NUMERICIDENTIFIERLOOSE]}|${h[u.NONNUMERICIDENTIFIER]})`),w("PRERELEASE",`(?:-(${h[u.PRERELEASEIDENTIFIER]}(?:\\.${h[u.PRERELEASEIDENTIFIER]})*))`),w("PRERELEASELOOSE",`(?:-?(${h[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${h[u.PRERELEASEIDENTIFIERLOOSE]})*))`),w("BUILDIDENTIFIER",`${f}+`),w("BUILD",`(?:\\+(${h[u.BUILDIDENTIFIER]}(?:\\.${h[u.BUILDIDENTIFIER]})*))`),w("FULLPLAIN",`v?${h[u.MAINVERSION]}${h[u.PRERELEASE]}?${h[u.BUILD]}?`),w("FULL",`^${h[u.FULLPLAIN]}$`),w("LOOSEPLAIN",`[v=\\s]*${h[u.MAINVERSIONLOOSE]}${h[u.PRERELEASELOOSE]}?${h[u.BUILD]}?`),w("LOOSE",`^${h[u.LOOSEPLAIN]}$`),w("GTLT","((?:<|>)?=?)"),w("XRANGEIDENTIFIERLOOSE",`${h[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),w("XRANGEIDENTIFIER",`${h[u.NUMERICIDENTIFIER]}|x|X|\\*`),w("XRANGEPLAIN",`[v=\\s]*(${h[u.XRANGEIDENTIFIER]})(?:\\.(${h[u.XRANGEIDENTIFIER]})(?:\\.(${h[u.XRANGEIDENTIFIER]})(?:${h[u.PRERELEASE]})?${h[u.BUILD]}?)?)?`),w("XRANGEPLAINLOOSE",`[v=\\s]*(${h[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[u.XRANGEIDENTIFIERLOOSE]})(?:${h[u.PRERELEASELOOSE]})?${h[u.BUILD]}?)?)?`),w("XRANGE",`^${h[u.GTLT]}\\s*${h[u.XRANGEPLAIN]}$`),w("XRANGELOOSE",`^${h[u.GTLT]}\\s*${h[u.XRANGEPLAINLOOSE]}$`),w("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),w("COERCE",`${h[u.COERCEPLAIN]}(?:$|[^\\d])`),w("COERCEFULL",h[u.COERCEPLAIN]+`(?:${h[u.PRERELEASE]})?(?:${h[u.BUILD]})?(?:$|[^\\d])`),w("COERCERTL",h[u.COERCE],!0),w("COERCERTLFULL",h[u.COERCEFULL],!0),w("LONETILDE","(?:~>?)"),w("TILDETRIM",`(\\s*)${h[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",w("TILDE",`^${h[u.LONETILDE]}${h[u.XRANGEPLAIN]}$`),w("TILDELOOSE",`^${h[u.LONETILDE]}${h[u.XRANGEPLAINLOOSE]}$`),w("LONECARET","(?:\\^)"),w("CARETTRIM",`(\\s*)${h[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",w("CARET",`^${h[u.LONECARET]}${h[u.XRANGEPLAIN]}$`),w("CARETLOOSE",`^${h[u.LONECARET]}${h[u.XRANGEPLAINLOOSE]}$`),w("COMPARATORLOOSE",`^${h[u.GTLT]}\\s*(${h[u.LOOSEPLAIN]})$|^$`),w("COMPARATOR",`^${h[u.GTLT]}\\s*(${h[u.FULLPLAIN]})$|^$`),w("COMPARATORTRIM",`(\\s*)${h[u.GTLT]}\\s*(${h[u.LOOSEPLAIN]}|${h[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",w("HYPHENRANGE",`^\\s*(${h[u.XRANGEPLAIN]})\\s+-\\s+(${h[u.XRANGEPLAIN]})\\s*$`),w("HYPHENRANGELOOSE",`^\\s*(${h[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${h[u.XRANGEPLAINLOOSE]})\\s*$`),w("STAR","(<|>)?=?\\s*\\*"),w("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),w("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(bm,bm.exports)),bm.exports}var Am,id;function w0(){if(id)return Am;id=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return Am=t=>t?typeof t!="object"?r:t:e,Am}var Sm,od;function y0(){if(od)return Sm;od=1;const r=/^[0-9]+$/,e=(t,s)=>{const a=r.test(t),n=r.test(s);return a&&n&&(t=+t,s=+s),t===s?0:a&&!n?-1:n&&!a?1:t<s?-1:1};return Sm={compareIdentifiers:e,rcompareIdentifiers:(t,s)=>e(s,t)},Sm}var Nm,ud;function Sg(){if(ud)return Nm;ud=1;const r=bg(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Ag(),{safeRe:s,t:a}=g0(),n=w0(),{compareIdentifiers:i}=y0();class o{constructor(u,c){if(c=n(c),u instanceof o){if(u.loose===!!c.loose&&u.includePrerelease===!!c.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof u}".`);if(u.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",u,c),this.options=c,this.loose=!!c.loose,this.includePrerelease=!!c.includePrerelease;const f=u.trim().match(c.loose?s[a.LOOSE]:s[a.FULL]);if(!f)throw new TypeError(`Invalid Version: ${u}`);if(this.raw=u,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(m=>{if(/^[0-9]+$/.test(m)){const y=+m;if(y>=0&&y<t)return y}return m}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(u){if(r("SemVer.compare",this.version,this.options,u),!(u instanceof o)){if(typeof u=="string"&&u===this.version)return 0;u=new o(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof o||(u=new o(u,this.options)),i(this.major,u.major)||i(this.minor,u.minor)||i(this.patch,u.patch)}comparePre(u){if(u instanceof o||(u=new o(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let c=0;do{const f=this.prerelease[c],m=u.prerelease[c];if(r("prerelease compare",c,f,m),f===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(f===void 0)return-1;if(f!==m)return i(f,m)}while(++c)}compareBuild(u){u instanceof o||(u=new o(u,this.options));let c=0;do{const f=this.build[c],m=u.build[c];if(r("build compare",c,f,m),f===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(f===void 0)return-1;if(f!==m)return i(f,m)}while(++c)}inc(u,c,f){switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",c,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",c,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",c,f),this.inc("pre",c,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",c,f),this.inc("pre",c,f);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const m=Number(f)?1:0;if(!c&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[m];else{let y=this.prerelease.length;for(;--y>=0;)typeof this.prerelease[y]=="number"&&(this.prerelease[y]++,y=-2);if(y===-1){if(c===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(m)}}if(c){let y=[c,m];f===!1&&(y=[c]),i(this.prerelease[0],c)===0?isNaN(this.prerelease[1])&&(this.prerelease=y):this.prerelease=y}break}default:throw new Error(`invalid increment argument: ${u}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return Nm=o,Nm}var Em,cd;function v0(){if(cd)return Em;cd=1;const r=Sg();return Em=(e,t,s=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(a){if(!s)return null;throw a}},Em}var Cm,ld;function b0(){if(ld)return Cm;ld=1;const r=v0();return Cm=(e,t)=>{const s=r(e,t);return s?s.version:null},Cm}b0();var km,hd;function A0(){if(hd)return km;hd=1;const r=Sg();return km=(e,t)=>new r(e,t).major,km}A0();var md={},fd;function S0(){return fd||(fd=1,function(r){(function(e){e.parser=function(I,A){return new s(I,A)},e.SAXParser=s,e.SAXStream=c,e.createStream=u,e.MAX_BUFFER_LENGTH=64*1024;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function s(I,A){if(!(this instanceof s))return new s(I,A);var $=this;n($),$.q=$.c="",$.bufferCheckPosition=e.MAX_BUFFER_LENGTH,$.opt=A||{},$.opt.lowercase=$.opt.lowercase||$.opt.lowercasetags,$.looseCase=$.opt.lowercase?"toLowerCase":"toUpperCase",$.tags=[],$.closed=$.closedRoot=$.sawRoot=!1,$.tag=$.error=null,$.strict=!!I,$.noscript=!!(I||$.opt.noscript),$.state=V.BEGIN,$.strictEntities=$.opt.strictEntities,$.ENTITIES=$.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),$.attribList=[],$.opt.xmlns&&($.ns=Object.create(S)),$.opt.unquotedAttributeValues===void 0&&($.opt.unquotedAttributeValues=!I),$.trackPosition=$.opt.position!==!1,$.trackPosition&&($.position=$.line=$.column=0),F($,"onready")}Object.create||(Object.create=function(I){function A(){}A.prototype=I;var $=new A;return $}),Object.keys||(Object.keys=function(I){var A=[];for(var $ in I)I.hasOwnProperty($)&&A.push($);return A});function a(I){for(var A=Math.max(e.MAX_BUFFER_LENGTH,10),$=0,L=0,de=t.length;L<de;L++){var Ee=I[t[L]].length;if(Ee>A)switch(t[L]){case"textNode":j(I);break;case"cdata":D(I,"oncdata",I.cdata),I.cdata="";break;case"script":D(I,"onscript",I.script),I.script="";break;default:_(I,"Max buffer length exceeded: "+t[L])}$=Math.max($,Ee)}var le=e.MAX_BUFFER_LENGTH-$;I.bufferCheckPosition=le+I.position}function n(I){for(var A=0,$=t.length;A<$;A++)I[t[A]]=""}function i(I){j(I),I.cdata!==""&&(D(I,"oncdata",I.cdata),I.cdata=""),I.script!==""&&(D(I,"onscript",I.script),I.script="")}s.prototype={end:function(){ie(this)},write:Me,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){i(this)}};var o;try{o=require("stream").Stream}catch{o=function(){}}o||(o=function(){});var h=e.EVENTS.filter(function(I){return I!=="error"&&I!=="end"});function u(I,A){return new c(I,A)}function c(I,A){if(!(this instanceof c))return new c(I,A);o.apply(this),this._parser=new s(I,A),this.writable=!0,this.readable=!0;var $=this;this._parser.onend=function(){$.emit("end")},this._parser.onerror=function(L){$.emit("error",L),$._parser.error=null},this._decoder=null,h.forEach(function(L){Object.defineProperty($,"on"+L,{get:function(){return $._parser["on"+L]},set:function(de){if(!de)return $.removeAllListeners(L),$._parser["on"+L]=de,de;$.on(L,de)},enumerable:!0,configurable:!1})})}c.prototype=Object.create(o.prototype,{constructor:{value:c}}),c.prototype.write=function(I){if(typeof sm=="function"&&typeof sm.isBuffer=="function"&&sm.isBuffer(I)){if(!this._decoder){var A=m0.StringDecoder;this._decoder=new A("utf8")}I=this._decoder.write(I)}return this._parser.write(I.toString()),this.emit("data",I),!0},c.prototype.end=function(I){return I&&I.length&&this.write(I),this._parser.end(),!0},c.prototype.on=function(I,A){var $=this;return!$._parser["on"+I]&&h.indexOf(I)!==-1&&($._parser["on"+I]=function(){var L=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);L.splice(0,0,I),$.emit.apply($,L)}),o.prototype.on.call($,I,A)};var f="[CDATA[",m="DOCTYPE",y="http://www.w3.org/XML/1998/namespace",w="http://www.w3.org/2000/xmlns/",S={xml:y,xmlns:w},v=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,C=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,p=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,b=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function k(I){return I===" "||I===`
`||I==="\r"||I==="	"}function P(I){return I==='"'||I==="'"}function x(I){return I===">"||k(I)}function T(I,A){return I.test(A)}function B(I,A){return!T(I,A)}var V=0;e.STATE={BEGIN:V++,BEGIN_WHITESPACE:V++,TEXT:V++,TEXT_ENTITY:V++,OPEN_WAKA:V++,SGML_DECL:V++,SGML_DECL_QUOTED:V++,DOCTYPE:V++,DOCTYPE_QUOTED:V++,DOCTYPE_DTD:V++,DOCTYPE_DTD_QUOTED:V++,COMMENT_STARTING:V++,COMMENT:V++,COMMENT_ENDING:V++,COMMENT_ENDED:V++,CDATA:V++,CDATA_ENDING:V++,CDATA_ENDING_2:V++,PROC_INST:V++,PROC_INST_BODY:V++,PROC_INST_ENDING:V++,OPEN_TAG:V++,OPEN_TAG_SLASH:V++,ATTRIB:V++,ATTRIB_NAME:V++,ATTRIB_NAME_SAW_WHITE:V++,ATTRIB_VALUE:V++,ATTRIB_VALUE_QUOTED:V++,ATTRIB_VALUE_CLOSED:V++,ATTRIB_VALUE_UNQUOTED:V++,ATTRIB_VALUE_ENTITY_Q:V++,ATTRIB_VALUE_ENTITY_U:V++,CLOSE_TAG:V++,CLOSE_TAG_SAW_WHITE:V++,SCRIPT:V++,SCRIPT_ENDING:V++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(I){var A=e.ENTITIES[I],$=typeof A=="number"?String.fromCharCode(A):A;e.ENTITIES[I]=$});for(var J in e.STATE)e.STATE[e.STATE[J]]=J;V=e.STATE;function F(I,A,$){I[A]&&I[A]($)}function D(I,A,$){I.textNode&&j(I),F(I,A,$)}function j(I){I.textNode=ee(I.opt,I.textNode),I.textNode&&F(I,"ontext",I.textNode),I.textNode=""}function ee(I,A){return I.trim&&(A=A.trim()),I.normalize&&(A=A.replace(/\s+/g," ")),A}function _(I,A){return j(I),I.trackPosition&&(A+=`
Line: `+I.line+`
Column: `+I.column+`
Char: `+I.c),A=new Error(A),I.error=A,F(I,"onerror",A),I}function ie(I){return I.sawRoot&&!I.closedRoot&&ae(I,"Unclosed root tag"),I.state!==V.BEGIN&&I.state!==V.BEGIN_WHITESPACE&&I.state!==V.TEXT&&_(I,"Unexpected end"),j(I),I.c="",I.closed=!0,F(I,"onend"),s.call(I,I.strict,I.opt),I}function ae(I,A){if(typeof I!="object"||!(I instanceof s))throw new Error("bad call to strictFail");I.strict&&_(I,A)}function pe(I){I.strict||(I.tagName=I.tagName[I.looseCase]());var A=I.tags[I.tags.length-1]||I,$=I.tag={name:I.tagName,attributes:{}};I.opt.xmlns&&($.ns=A.ns),I.attribList.length=0,D(I,"onopentagstart",$)}function ne(I,A){var $=I.indexOf(":"),L=$<0?["",I]:I.split(":"),de=L[0],Ee=L[1];return A&&I==="xmlns"&&(de="xmlns",Ee=""),{prefix:de,local:Ee}}function se(I){if(I.strict||(I.attribName=I.attribName[I.looseCase]()),I.attribList.indexOf(I.attribName)!==-1||I.tag.attributes.hasOwnProperty(I.attribName)){I.attribName=I.attribValue="";return}if(I.opt.xmlns){var A=ne(I.attribName,!0),$=A.prefix,L=A.local;if($==="xmlns")if(L==="xml"&&I.attribValue!==y)ae(I,"xml: prefix must be bound to "+y+`
Actual: `+I.attribValue);else if(L==="xmlns"&&I.attribValue!==w)ae(I,"xmlns: prefix must be bound to "+w+`
Actual: `+I.attribValue);else{var de=I.tag,Ee=I.tags[I.tags.length-1]||I;de.ns===Ee.ns&&(de.ns=Object.create(Ee.ns)),de.ns[L]=I.attribValue}I.attribList.push([I.attribName,I.attribValue])}else I.tag.attributes[I.attribName]=I.attribValue,D(I,"onattribute",{name:I.attribName,value:I.attribValue});I.attribName=I.attribValue=""}function te(I,A){if(I.opt.xmlns){var $=I.tag,L=ne(I.tagName);$.prefix=L.prefix,$.local=L.local,$.uri=$.ns[L.prefix]||"",$.prefix&&!$.uri&&(ae(I,"Unbound namespace prefix: "+JSON.stringify(I.tagName)),$.uri=L.prefix);var de=I.tags[I.tags.length-1]||I;$.ns&&de.ns!==$.ns&&Object.keys($.ns).forEach(function(He){D(I,"onopennamespace",{prefix:He,uri:$.ns[He]})});for(var Ee=0,le=I.attribList.length;Ee<le;Ee++){var wt=I.attribList[Ee],ft=wt[0],Is=wt[1],rt=ne(ft,!0),ns=rt.prefix,Qh=rt.local,fl=ns===""?"":$.ns[ns]||"",To={name:ft,value:Is,prefix:ns,local:Qh,uri:fl};ns&&ns!=="xmlns"&&!fl&&(ae(I,"Unbound namespace prefix: "+JSON.stringify(ns)),To.uri=ns),I.tag.attributes[ft]=To,D(I,"onattribute",To)}I.attribList.length=0}I.tag.isSelfClosing=!!A,I.sawRoot=!0,I.tags.push(I.tag),D(I,"onopentag",I.tag),A||(!I.noscript&&I.tagName.toLowerCase()==="script"?I.state=V.SCRIPT:I.state=V.TEXT,I.tag=null,I.tagName=""),I.attribName=I.attribValue="",I.attribList.length=0}function Z(I){if(!I.tagName){ae(I,"Weird empty close tag."),I.textNode+="</>",I.state=V.TEXT;return}if(I.script){if(I.tagName!=="script"){I.script+="</"+I.tagName+">",I.tagName="",I.state=V.SCRIPT;return}D(I,"onscript",I.script),I.script=""}var A=I.tags.length,$=I.tagName;I.strict||($=$[I.looseCase]());for(var L=$;A--;){var de=I.tags[A];if(de.name!==L)ae(I,"Unexpected close tag");else break}if(A<0){ae(I,"Unmatched closing tag: "+I.tagName),I.textNode+="</"+I.tagName+">",I.state=V.TEXT;return}I.tagName=$;for(var Ee=I.tags.length;Ee-- >A;){var le=I.tag=I.tags.pop();I.tagName=I.tag.name,D(I,"onclosetag",I.tagName);var wt={};for(var ft in le.ns)wt[ft]=le.ns[ft];var Is=I.tags[I.tags.length-1]||I;I.opt.xmlns&&le.ns!==Is.ns&&Object.keys(le.ns).forEach(function(rt){var ns=le.ns[rt];D(I,"onclosenamespace",{prefix:rt,uri:ns})})}A===0&&(I.closedRoot=!0),I.tagName=I.attribValue=I.attribName="",I.attribList.length=0,I.state=V.TEXT}function ce(I){var A=I.entity,$=A.toLowerCase(),L,de="";return I.ENTITIES[A]?I.ENTITIES[A]:I.ENTITIES[$]?I.ENTITIES[$]:(A=$,A.charAt(0)==="#"&&(A.charAt(1)==="x"?(A=A.slice(2),L=parseInt(A,16),de=L.toString(16)):(A=A.slice(1),L=parseInt(A,10),de=L.toString(10))),A=A.replace(/^0+/,""),isNaN(L)||de.toLowerCase()!==A?(ae(I,"Invalid character entity"),"&"+I.entity+";"):String.fromCodePoint(L))}function fe(I,A){A==="<"?(I.state=V.OPEN_WAKA,I.startTagPosition=I.position):k(A)||(ae(I,"Non-whitespace before first tag."),I.textNode=A,I.state=V.TEXT)}function ke(I,A){var $="";return A<I.length&&($=I.charAt(A)),$}function Me(I){var A=this;if(this.error)throw this.error;if(A.closed)return _(A,"Cannot write after close. Assign an onready handler.");if(I===null)return ie(A);typeof I=="object"&&(I=I.toString());for(var $=0,L="";L=ke(I,$++),A.c=L,!!L;)switch(A.trackPosition&&(A.position++,L===`
`?(A.line++,A.column=0):A.column++),A.state){case V.BEGIN:if(A.state=V.BEGIN_WHITESPACE,L==="\uFEFF")continue;fe(A,L);continue;case V.BEGIN_WHITESPACE:fe(A,L);continue;case V.TEXT:if(A.sawRoot&&!A.closedRoot){for(var de=$-1;L&&L!=="<"&&L!=="&";)L=ke(I,$++),L&&A.trackPosition&&(A.position++,L===`
`?(A.line++,A.column=0):A.column++);A.textNode+=I.substring(de,$-1)}L==="<"&&!(A.sawRoot&&A.closedRoot&&!A.strict)?(A.state=V.OPEN_WAKA,A.startTagPosition=A.position):(!k(L)&&(!A.sawRoot||A.closedRoot)&&ae(A,"Text data outside of root node."),L==="&"?A.state=V.TEXT_ENTITY:A.textNode+=L);continue;case V.SCRIPT:L==="<"?A.state=V.SCRIPT_ENDING:A.script+=L;continue;case V.SCRIPT_ENDING:L==="/"?A.state=V.CLOSE_TAG:(A.script+="<"+L,A.state=V.SCRIPT);continue;case V.OPEN_WAKA:if(L==="!")A.state=V.SGML_DECL,A.sgmlDecl="";else if(!k(L))if(T(v,L))A.state=V.OPEN_TAG,A.tagName=L;else if(L==="/")A.state=V.CLOSE_TAG,A.tagName="";else if(L==="?")A.state=V.PROC_INST,A.procInstName=A.procInstBody="";else{if(ae(A,"Unencoded <"),A.startTagPosition+1<A.position){var Ee=A.position-A.startTagPosition;L=new Array(Ee).join(" ")+L}A.textNode+="<"+L,A.state=V.TEXT}continue;case V.SGML_DECL:if(A.sgmlDecl+L==="--"){A.state=V.COMMENT,A.comment="",A.sgmlDecl="";continue}A.doctype&&A.doctype!==!0&&A.sgmlDecl?(A.state=V.DOCTYPE_DTD,A.doctype+="<!"+A.sgmlDecl+L,A.sgmlDecl=""):(A.sgmlDecl+L).toUpperCase()===f?(D(A,"onopencdata"),A.state=V.CDATA,A.sgmlDecl="",A.cdata=""):(A.sgmlDecl+L).toUpperCase()===m?(A.state=V.DOCTYPE,(A.doctype||A.sawRoot)&&ae(A,"Inappropriately located doctype declaration"),A.doctype="",A.sgmlDecl=""):L===">"?(D(A,"onsgmldeclaration",A.sgmlDecl),A.sgmlDecl="",A.state=V.TEXT):(P(L)&&(A.state=V.SGML_DECL_QUOTED),A.sgmlDecl+=L);continue;case V.SGML_DECL_QUOTED:L===A.q&&(A.state=V.SGML_DECL,A.q=""),A.sgmlDecl+=L;continue;case V.DOCTYPE:L===">"?(A.state=V.TEXT,D(A,"ondoctype",A.doctype),A.doctype=!0):(A.doctype+=L,L==="["?A.state=V.DOCTYPE_DTD:P(L)&&(A.state=V.DOCTYPE_QUOTED,A.q=L));continue;case V.DOCTYPE_QUOTED:A.doctype+=L,L===A.q&&(A.q="",A.state=V.DOCTYPE);continue;case V.DOCTYPE_DTD:L==="]"?(A.doctype+=L,A.state=V.DOCTYPE):L==="<"?(A.state=V.OPEN_WAKA,A.startTagPosition=A.position):P(L)?(A.doctype+=L,A.state=V.DOCTYPE_DTD_QUOTED,A.q=L):A.doctype+=L;continue;case V.DOCTYPE_DTD_QUOTED:A.doctype+=L,L===A.q&&(A.state=V.DOCTYPE_DTD,A.q="");continue;case V.COMMENT:L==="-"?A.state=V.COMMENT_ENDING:A.comment+=L;continue;case V.COMMENT_ENDING:L==="-"?(A.state=V.COMMENT_ENDED,A.comment=ee(A.opt,A.comment),A.comment&&D(A,"oncomment",A.comment),A.comment=""):(A.comment+="-"+L,A.state=V.COMMENT);continue;case V.COMMENT_ENDED:L!==">"?(ae(A,"Malformed comment"),A.comment+="--"+L,A.state=V.COMMENT):A.doctype&&A.doctype!==!0?A.state=V.DOCTYPE_DTD:A.state=V.TEXT;continue;case V.CDATA:L==="]"?A.state=V.CDATA_ENDING:A.cdata+=L;continue;case V.CDATA_ENDING:L==="]"?A.state=V.CDATA_ENDING_2:(A.cdata+="]"+L,A.state=V.CDATA);continue;case V.CDATA_ENDING_2:L===">"?(A.cdata&&D(A,"oncdata",A.cdata),D(A,"onclosecdata"),A.cdata="",A.state=V.TEXT):L==="]"?A.cdata+="]":(A.cdata+="]]"+L,A.state=V.CDATA);continue;case V.PROC_INST:L==="?"?A.state=V.PROC_INST_ENDING:k(L)?A.state=V.PROC_INST_BODY:A.procInstName+=L;continue;case V.PROC_INST_BODY:if(!A.procInstBody&&k(L))continue;L==="?"?A.state=V.PROC_INST_ENDING:A.procInstBody+=L;continue;case V.PROC_INST_ENDING:L===">"?(D(A,"onprocessinginstruction",{name:A.procInstName,body:A.procInstBody}),A.procInstName=A.procInstBody="",A.state=V.TEXT):(A.procInstBody+="?"+L,A.state=V.PROC_INST_BODY);continue;case V.OPEN_TAG:T(C,L)?A.tagName+=L:(pe(A),L===">"?te(A):L==="/"?A.state=V.OPEN_TAG_SLASH:(k(L)||ae(A,"Invalid character in tag name"),A.state=V.ATTRIB));continue;case V.OPEN_TAG_SLASH:L===">"?(te(A,!0),Z(A)):(ae(A,"Forward-slash in opening tag not followed by >"),A.state=V.ATTRIB);continue;case V.ATTRIB:if(k(L))continue;L===">"?te(A):L==="/"?A.state=V.OPEN_TAG_SLASH:T(v,L)?(A.attribName=L,A.attribValue="",A.state=V.ATTRIB_NAME):ae(A,"Invalid attribute name");continue;case V.ATTRIB_NAME:L==="="?A.state=V.ATTRIB_VALUE:L===">"?(ae(A,"Attribute without value"),A.attribValue=A.attribName,se(A),te(A)):k(L)?A.state=V.ATTRIB_NAME_SAW_WHITE:T(C,L)?A.attribName+=L:ae(A,"Invalid attribute name");continue;case V.ATTRIB_NAME_SAW_WHITE:if(L==="=")A.state=V.ATTRIB_VALUE;else{if(k(L))continue;ae(A,"Attribute without value"),A.tag.attributes[A.attribName]="",A.attribValue="",D(A,"onattribute",{name:A.attribName,value:""}),A.attribName="",L===">"?te(A):T(v,L)?(A.attribName=L,A.state=V.ATTRIB_NAME):(ae(A,"Invalid attribute name"),A.state=V.ATTRIB)}continue;case V.ATTRIB_VALUE:if(k(L))continue;P(L)?(A.q=L,A.state=V.ATTRIB_VALUE_QUOTED):(A.opt.unquotedAttributeValues||_(A,"Unquoted attribute value"),A.state=V.ATTRIB_VALUE_UNQUOTED,A.attribValue=L);continue;case V.ATTRIB_VALUE_QUOTED:if(L!==A.q){L==="&"?A.state=V.ATTRIB_VALUE_ENTITY_Q:A.attribValue+=L;continue}se(A),A.q="",A.state=V.ATTRIB_VALUE_CLOSED;continue;case V.ATTRIB_VALUE_CLOSED:k(L)?A.state=V.ATTRIB:L===">"?te(A):L==="/"?A.state=V.OPEN_TAG_SLASH:T(v,L)?(ae(A,"No whitespace between attributes"),A.attribName=L,A.attribValue="",A.state=V.ATTRIB_NAME):ae(A,"Invalid attribute name");continue;case V.ATTRIB_VALUE_UNQUOTED:if(!x(L)){L==="&"?A.state=V.ATTRIB_VALUE_ENTITY_U:A.attribValue+=L;continue}se(A),L===">"?te(A):A.state=V.ATTRIB;continue;case V.CLOSE_TAG:if(A.tagName)L===">"?Z(A):T(C,L)?A.tagName+=L:A.script?(A.script+="</"+A.tagName,A.tagName="",A.state=V.SCRIPT):(k(L)||ae(A,"Invalid tagname in closing tag"),A.state=V.CLOSE_TAG_SAW_WHITE);else{if(k(L))continue;B(v,L)?A.script?(A.script+="</"+L,A.state=V.SCRIPT):ae(A,"Invalid tagname in closing tag."):A.tagName=L}continue;case V.CLOSE_TAG_SAW_WHITE:if(k(L))continue;L===">"?Z(A):ae(A,"Invalid characters in closing tag");continue;case V.TEXT_ENTITY:case V.ATTRIB_VALUE_ENTITY_Q:case V.ATTRIB_VALUE_ENTITY_U:var le,wt;switch(A.state){case V.TEXT_ENTITY:le=V.TEXT,wt="textNode";break;case V.ATTRIB_VALUE_ENTITY_Q:le=V.ATTRIB_VALUE_QUOTED,wt="attribValue";break;case V.ATTRIB_VALUE_ENTITY_U:le=V.ATTRIB_VALUE_UNQUOTED,wt="attribValue";break}if(L===";"){var ft=ce(A);A.opt.unparsedEntities&&!Object.values(e.XML_ENTITIES).includes(ft)?(A.entity="",A.state=le,A.write(ft)):(A[wt]+=ft,A.entity="",A.state=le)}else T(A.entity.length?b:p,L)?A.entity+=L:(ae(A,"Invalid character in entity name"),A[wt]+="&"+A.entity+L,A.entity="",A.state=le);continue;default:throw new Error(A,"Unknown state: "+A.state)}return A.position>=A.bufferCheckPosition&&a(A),A}String.fromCodePoint||function(){var I=String.fromCharCode,A=Math.floor,$=function(){var L=16384,de=[],Ee,le,wt=-1,ft=arguments.length;if(!ft)return"";for(var Is="";++wt<ft;){var rt=Number(arguments[wt]);if(!isFinite(rt)||rt<0||rt>1114111||A(rt)!==rt)throw RangeError("Invalid code point: "+rt);rt<=65535?de.push(rt):(rt-=65536,Ee=(rt>>10)+55296,le=rt%1024+56320,de.push(Ee,le)),(wt+1===ft||de.length>L)&&(Is+=I.apply(null,de),de.length=0)}return Is};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:$,configurable:!0,writable:!0}):String.fromCodePoint=$}()})(r)}(md)),md}S0();const N0='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-arrow-down" viewBox="0 0 24 24"><path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" /></svg>';function E0(r){if((r.permissions&wg.READ)===0)return!1;if(r.attributes["share-attributes"]){const e=JSON.parse(r.attributes["share-attributes"]||"[]").find(({scope:t,key:s})=>t==="permissions"&&s==="download");if(e!==void 0)return e.value===!0}return!0}async function C0(r){const[e]=r,t=await(await fetch(e.encodedSource)).arrayBuffer(),s=new Blob([t],{type:e.mime}),a=document.createElement("a");a.href=window.URL.createObjectURL(s),a.download=e.displayname,a.click()}const k0=new f0({id:"download_unencrypted",default:Yf.DEFAULT,displayName:()=>ya("files","Download unencrypted"),iconSvgInline:()=>N0,enabled(r){return r.length!==1||r.some(e=>e.attributes["e2ee-is-encrypted"]!==1)||r.some(e=>!e.isDavRessource)||r.some(e=>e.type!==gg.File)?!1:r.every(E0)},async exec(r){return C0([r]),null},order:30});function I0(r){return typeof r=="function"?r:Array.isArray(r)?e=>{for(const t of r)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}const V0=`
`;function x0(r,e){let t="";return e.format&&e.indentBy.length>0&&(t=V0),Ng(r,e,"",t)}function Ng(r,e,t,s){let a="",n=!1;for(let i=0;i<r.length;i++){const o=r[i],h=B0(o);if(h===void 0)continue;let u="";if(t.length===0?u=h:u=`${t}.${h}`,h===e.textNodeName){let w=o[h];O0(u,e)||(w=e.tagValueProcessor(h,w),w=Eg(w,e)),n&&(a+=s),a+=w,n=!1;continue}else if(h===e.cdataPropName){n&&(a+=s),a+=`<![CDATA[${o[h][0][e.textNodeName]}]]>`,n=!1;continue}else if(h===e.commentPropName){a+=s+`<!--${o[h][0][e.textNodeName]}-->`,n=!0;continue}else if(h[0]==="?"){const w=pd(o[":@"],e),S=h==="?xml"?"":s;let v=o[h][0][e.textNodeName];v=v.length!==0?" "+v:"",a+=S+`<${h}${v}${w}?>`,n=!0;continue}let c=s;c!==""&&(c+=e.indentBy);const f=pd(o[":@"],e),m=s+`<${h}${f}`,y=Ng(o[h],e,u,c);e.unpairedTags.indexOf(h)!==-1?e.suppressUnpairedNode?a+=m+">":a+=m+"/>":(!y||y.length===0)&&e.suppressEmptyNode?a+=m+"/>":y&&y.endsWith(">")?a+=m+`>${y}${s}</${h}>`:(a+=m+">",y&&s!==""&&(y.includes("/>")||y.includes("</"))?a+=s+e.indentBy+y+s:a+=y,a+=`</${h}>`),n=!0}return a}function B0(r){const e=Object.keys(r);for(let t=0;t<e.length;t++){const s=e[t];if(r.hasOwnProperty(s)&&s!==":@")return s}}function pd(r,e){let t="";if(r&&!e.ignoreAttributes)for(let s in r){if(!r.hasOwnProperty(s))continue;let a=e.attributeValueProcessor(s,r[s]);a=Eg(a,e),a===!0&&e.suppressBooleanAttributes?t+=` ${s.substr(e.attributeNamePrefix.length)}`:t+=` ${s.substr(e.attributeNamePrefix.length)}="${a}"`}return t}function O0(r,e){r=r.substr(0,r.length-e.textNodeName.length-1);let t=r.substr(r.lastIndexOf(".")+1);for(let s in e.stopNodes)if(e.stopNodes[s]===r||e.stopNodes[s]==="*."+t)return!0;return!1}function Eg(r,e){if(r&&r.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const s=e.entities[t];r=r.replace(s.regex,s.val)}return r}const P0={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function ea(r){this.options=Object.assign({},P0,r),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=I0(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=R0),this.processTextOrObjNode=D0,this.options.format?(this.indentate=T0,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}ea.prototype.build=function(r){return this.options.preserveOrder?x0(r,this.options):(Array.isArray(r)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(r={[this.options.arrayNodeName]:r}),this.j2x(r,0,[]).val)},ea.prototype.j2x=function(r,e,t){let s="",a="";const n=t.join(".");for(let i in r)if(Object.prototype.hasOwnProperty.call(r,i))if(typeof r[i]>"u")this.isAttribute(i)&&(a+="");else if(r[i]===null)this.isAttribute(i)||i===this.options.cdataPropName?a+="":i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(r[i]instanceof Date)a+=this.buildTextValNode(r[i],i,"",e);else if(typeof r[i]!="object"){const o=this.isAttribute(i);if(o&&!this.ignoreAttributesFn(o,n))s+=this.buildAttrPairStr(o,""+r[i]);else if(!o)if(i===this.options.textNodeName){let h=this.options.tagValueProcessor(i,""+r[i]);a+=this.replaceEntitiesValue(h)}else a+=this.buildTextValNode(r[i],i,"",e)}else if(Array.isArray(r[i])){const o=r[i].length;let h="",u="";for(let c=0;c<o;c++){const f=r[i][c];if(!(typeof f>"u"))if(f===null)i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(typeof f=="object")if(this.options.oneListGroup){const m=this.j2x(f,e+1,t.concat(i));h+=m.val,this.options.attributesGroupName&&f.hasOwnProperty(this.options.attributesGroupName)&&(u+=m.attrStr)}else h+=this.processTextOrObjNode(f,i,e,t);else if(this.options.oneListGroup){let m=this.options.tagValueProcessor(i,f);m=this.replaceEntitiesValue(m),h+=m}else h+=this.buildTextValNode(f,i,"",e)}this.options.oneListGroup&&(h=this.buildObjectNode(h,i,u,e)),a+=h}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const o=Object.keys(r[i]),h=o.length;for(let u=0;u<h;u++)s+=this.buildAttrPairStr(o[u],""+r[i][o[u]])}else a+=this.processTextOrObjNode(r[i],i,e,t);return{attrStr:s,val:a}},ea.prototype.buildAttrPairStr=function(r,e){return e=this.options.attributeValueProcessor(r,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+r:" "+r+'="'+e+'"'};function D0(r,e,t,s){const a=this.j2x(r,t+1,s.concat(e));return r[this.options.textNodeName]!==void 0&&Object.keys(r).length===1?this.buildTextValNode(r[this.options.textNodeName],e,a.attrStr,t):this.buildObjectNode(a.val,e,a.attrStr,t)}ea.prototype.buildObjectNode=function(r,e,t,s){if(r==="")return e[0]==="?"?this.indentate(s)+"<"+e+t+"?"+this.tagEndChar:this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let a="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",a=""),(t||t==="")&&r.indexOf("<")===-1?this.indentate(s)+"<"+e+t+n+">"+r+a:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(s)+`<!--${r}-->`+this.newLine:this.indentate(s)+"<"+e+t+n+this.tagEndChar+r+this.indentate(s)+a}},ea.prototype.closeTag=function(r){let e="";return this.options.unpairedTags.indexOf(r)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${r}`,e},ea.prototype.buildTextValNode=function(r,e,t,s){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(s)+`<![CDATA[${r}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(s)+`<!--${r}-->`+this.newLine;if(e[0]==="?")return this.indentate(s)+"<"+e+t+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(e,r);return a=this.replaceEntitiesValue(a),a===""?this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(s)+"<"+e+t+">"+a+"</"+e+this.tagEndChar}},ea.prototype.replaceEntitiesValue=function(r){if(r&&r.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];r=r.replace(t.regex,t.val)}return r};function T0(r){return this.options.indentBy.repeat(r)}function R0(r){return r.startsWith(this.options.attributeNamePrefix)&&r!==this.options.textNodeName?r.substr(this.attrPrefixLen):!1}function Gl(r){return r.users!==void 0}function L0(r){return String.fromCharCode(...r)}function Cg(r){return Uint8Array.from(r,e=>e.charCodeAt(0))}function U0(r){return Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")}function Es(r){return Cg(atob(r))}function _f(r){const e=r.replace(/-----BEGIN ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/-----END ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/\n/g,"");return Es(e)}class Re{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let s=0;s<t;s++)this.view[s]=e.charCodeAt(s)}toString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)s+=String.fromCharCode(this.view[a]);return s}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const s=new Map;s.set("0",0),s.set("1",1),s.set("2",2),s.set("3",3),s.set("4",4),s.set("5",5),s.set("6",6),s.set("7",7),s.set("8",8),s.set("9",9),s.set("A",10),s.set("a",10),s.set("B",11),s.set("b",11),s.set("C",12),s.set("c",12),s.set("D",13),s.set("d",13),s.set("E",14),s.set("e",14),s.set("F",15),s.set("f",15);let a=0,n=0;for(let i=0;i<t;i++)i%2?(n|=s.get(e.charAt(i)),this.view[a]=n,a++):n=s.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){const n=this.view[a].toString(16).toUpperCase();s=s+(n.length==1?"0":"")+n}return s}copy(e=0,t=this.length-e){if(!e&&!this.length)return new Re;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new Re({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new Re;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new Re({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),s=new Uint8Array(t);e>this._view.length?s.set(this._view):s.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,s=e.length,a=e._view.subarray();this.realloc(t+s),this._view.set(a,t)}insert(e,t=0,s=this.length-t){return t>this.length-1?!1:(s>this.length-t&&(s=this.length-t),s>e.length&&(s=e.length),s==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,s),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a),h=e.length;if(h>i)return-1;const u=[];for(let c=0;c<h;c++)u.push(e.view[c]);for(let c=0;c<=i-h;c++){let f=!0;const m=o?n-h-c:n+c;for(let y=0;y<h;y++)if(this.view[y+m]!=u[y]){f=!1;break}if(f)return o?n-h-c:n+h+c}return-1}findFirstIn(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a),h={id:-1,position:o?0:n+i,length:0};for(let u=0;u<e.length;u++){const c=this.findPattern(e[u],n,i,o);if(c!=-1){let f=!1;const m=e[u].length;o?c-m>=h.position-h.length&&(f=!0):c-m<=h.position-h.length&&(f=!0),f&&(h.position=c,h.id=u,h.length=m)}}return h}findAllIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={id:-1,position:a};do{const h=o.position;if(o=this.findFirstIn(e,o.position,n),o.id==-1)break;n-=o.position-h,i.push({id:o.id,position:o.position})}while(!0);return i}findAllPatternIn(e,t,s){const{start:a,length:n}=this.prepareFindParameters(t,s),i=[],o=e.length;if(o>n)return-1;const h=Array.from(e.view);for(let u=0;u<=n-o;u++){let c=!0;const f=a+u;for(let m=0;m<o;m++)if(this.view[m+f]!=h[m]){c=!1;break}c&&(i.push(a+o+u),u+=o-1)}return i}findFirstNotIn(e,t,s,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);const h={left:{id:-1,position:n},right:{id:-1,position:0},value:new Re};let u=i;for(;u>0;){if(h.right=this.findFirstIn(e,o?n-i+u:n+i-u,u,o),h.right.id==-1){i=u,o?n-=i:n=h.left.position,h.value=new Re({buffer:this._buffer.slice(n,n+i)});break}if(h.right.position!=(o?h.left.position-e[h.right.id].length:h.left.position+e[h.right.id].length)){o?(n=h.right.position+e[h.right.id].length,i=h.left.position-h.right.position-e[h.right.id].length):(n=h.left.position,i=h.right.position-h.left.position-e[h.right.id].length),h.value=new Re({buffer:this._buffer.slice(n,n+i)});break}h.left=h.right,u-=e[h.right.id].length}if(o){const c=h.right;h.right=h.left,h.left=c}return h}findAllNotIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={left:{id:-1,position:a},right:{id:-1,position:a},value:new Re};do{const h=o.right.position;o=this.findFirstNotIn(e,o.right.position,n),n-=o.right.position-h,i.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(o.right.id!=-1);return i}findFirstSequence(e,t,s,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);const h=this.skipNotPatterns(e,n,i,o);if(h==-1)return{position:-1,value:new Re};const u=this.skipPatterns(e,h,i-(o?n-h:h-n),o);o?(n=u,i=h-u):(n=h,i=u-h);const c=new Re({buffer:this._buffer.slice(n,n+i)});return{position:u,value:c}}findAllSequences(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={position:a,value:new Re};do{const h=o.position;o=this.findFirstSequence(e,o.position,n),o.position!=-1&&(n-=o.position-h,i.push({position:o.position,value:o.value}))}while(o.position!=-1);return i}findPairedPatterns(e,t,s,a){const n=[];if(e.isEqual(t))return n;const{start:i,length:o}=this.prepareFindParameters(s,a);let h=0;const u=this.findAllPatternIn(e,i,o);if(!Array.isArray(u)||u.length==0)return n;const c=this.findAllPatternIn(t,i,o);if(!Array.isArray(c)||c.length==0)return n;for(;h<u.length&&c.length!=0;){if(u[0]==c[0]){n.push({left:u[0],right:c[0]}),u.splice(0,1),c.splice(0,1);continue}if(u[h]>c[0])break;for(;u[h]<c[0]&&(h++,!(h>=u.length)););n.push({left:u[h-1],right:c[0]}),u.splice(h-1,1),c.splice(0,1),h=0}return n.sort((f,m)=>f.left-m.left),n}findPairedArrays(e,t,s,a){const{start:n,length:i}=this.prepareFindParameters(s,a),o=[];let h=0;const u=this.findAllIn(e,n,i);if(u.length==0)return o;const c=this.findAllIn(t,n,i);if(c.length==0)return o;for(;h<u.length&&c.length!=0;){if(u[0].position==c[0].position){o.push({left:u[0],right:c[0]}),u.splice(0,1),c.splice(0,1);continue}if(u[h].position>c[0].position)break;for(;u[h].position<c[0].position&&(h++,!(h>=u.length)););o.push({left:u[h-1],right:c[0]}),u.splice(h-1,1),c.splice(0,1),h=0}return o.sort((f,m)=>f.left.position-m.left.position),o}replacePattern(e,t,s,a,n=null){let i=[],o;const h={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:u,length:c}=this.prepareFindParameters(s,a);if(n==null){if(i=this.findAllIn([e],u,c),i.length==0)return h}else i=n;h.searchPatternPositions.push(...Array.from(i,w=>w.position));const f=e.length-t.length,m=new ArrayBuffer(this.view.length-i.length*f),y=new Uint8Array(m);for(y.set(new Uint8Array(this.buffer,0,u)),o=0;o<i.length;o++){const w=o==0?u:i[o-1].position;y.set(new Uint8Array(this.buffer,w,i[o].position-e.length-w),w-o*f),y.set(t.view,i[o].position-e.length-o*f),h.replacePatternPositions.push(i[o].position-e.length-o*f)}return o--,y.set(new Uint8Array(this.buffer,i[o].position,this.length-i[o].position),i[o].position-e.length+t.length-o*f),this.buffer=m,this.view=new Uint8Array(this.buffer),h.status=1,h}skipPatterns(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);let h=n;for(let u=0;u<e.length;u++){const c=e[u].length,f=o?h-c:h;let m=!0;for(let y=0;y<c;y++)if(this.view[y+f]!=e[u].view[y]){m=!1;break}if(m){if(u=-1,o){if(h-=c,h<=0)return h}else if(h+=c,h>=n+i)return h}}return h}skipNotPatterns(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);let h=-1;for(let u=0;u<i;u++){for(let c=0;c<e.length;c++){const f=e[c].length,m=o?n-u-f:n+u;let y=!0;for(let w=0;w<f;w++)if(this.view[w+m]!=e[c].view[w]){y=!1;break}if(y){h=o?n-u:n+u;break}}if(h!=-1)break}return h}prepareFindParameters(e=null,t=null,s=!1){return e===null&&(e=s?this.length:0),e>this.length&&(e=this.length),s?(t===null&&(t=e),t>e&&(t=e)):(t===null&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:s}}}const j0=16777216;class oa{constructor(e={}){this._stream=new Re,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new Re({view:e.view}):"buffer"in e?this.stream=new Re({buffer:e.buffer}):"string"in e?this.stream=new Re({string:e.string}):"hexstring"in e?this.stream=new Re({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new Re,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findPattern(e,this.start,this.length,this.backward);if(s==-1)return s;if(this.backward){if(s<this.start-e.length-t)return-1}else if(s>this.start+e.length+t)return-1;return this.start=s,s}findFirstIn(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(s.id==-1)return s;if(this.backward){if(s.position<this.start-e[s.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(s.position>this.start+e[s.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=s.position,s}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(t==null||t>this._length)&&(t=this._length);const s=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(s.left.id==-1&&s.right.id==-1)return s;if(this.backward){if(s.right.id!=-1&&s.right.position<this._start-e[s.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Re}}else if(s.left.id!=-1&&s.left.position>this._start+e[s.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Re};return this.backward?s.left.id==-1?this.start=0:this.start=s.left.position:s.right.id==-1?this.start=this._start+this._length:this.start=s.right.position,s}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,s=null){(t==null||t>this._length)&&(t=this._length),(s==null||s>t)&&(s=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(a.value.length==0)return a;if(this.backward){if(a.position<this._start-a.value.length-s)return{position:-1,value:new Re}}else if(a.position>this._start+a.value.length+s)return{position:-1,value:new Re};return this.start=a.position,a}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right<this.start-t.length-s)return[]}else if(n[0].left>this.start+e.length+s)return[]}return n}findPairedArrays(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-s)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+s)return[]}return n}replacePattern(e,t){const s=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,s,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return t==-1?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),s=new Uint8Array(t.buffer);this.stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[2],this._stream.view[this._start+1]=s[1],this._stream.view[this._start+2]=s[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);this._length<e&&(e=this._length);let s;if(this.backward){const a=this._stream.view.subarray(this._length-e,this._length);s=new Uint8Array(e);for(let n=0;n<e;n++)s[e-1-n]=a[n]}else s=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),s}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),s=32768;return t&s?-(s-(t^s)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:t[0]*j0+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),s=2147483648;return t&s?-(s-(t^s)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+oa.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}oa.APPEND_BLOCK=1e3;function $0(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function kg(r,...e){if(!$0(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function dd(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function K0(r,e){kg(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const Im=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),ys=(r,e)=>r<<32-e|r>>>e,Vm=(r,e)=>r<<e|r>>>32-e>>>0;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function M0(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Ig(r){return typeof r=="string"&&(r=M0(r)),kg(r),r}class H0{clone(){return this._cloneInto()}}function zh(r){const e=s=>r().update(Ig(s)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function F0(r,e,t,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,s);const a=BigInt(32),n=BigInt(4294967295),i=Number(t>>a&n),o=Number(t&n),h=s?4:0,u=s?0:4;r.setUint32(e+h,i,s),r.setUint32(e+u,o,s)}const Vg=(r,e,t)=>r&e^~r&t,xg=(r,e,t)=>r&e^r&t^e&t;class Qf extends H0{constructor(e,t,s,a){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Im(this.buffer)}update(e){dd(this);const{view:t,buffer:s,blockLen:a}=this;e=Ig(e);const n=e.length;for(let i=0;i<n;){const o=Math.min(a-this.pos,n-i);if(o===a){const h=Im(e);for(;a<=n-i;i+=a)this.process(h,i);continue}s.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){dd(this),K0(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:a,isLE:n}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>a-i&&(this.process(s,0),i=0);for(let f=i;f<a;f++)t[f]=0;F0(s,a-8,BigInt(this.length*8),n),this.process(s,0);const o=Im(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=h/4,c=this.get();if(u>c.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)o.setUint32(4*f,c[f],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:a,finished:n,destroyed:i,pos:o}=this;return e.length=a,e.pos=o,e.finished=n,e.destroyed=i,a%t&&e.buffer.set(s),e}}const $o=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),rr=new Uint32Array(80);let J0=class extends Qf{constructor(){super(64,20,8,!1),this.A=$o[0]|0,this.B=$o[1]|0,this.C=$o[2]|0,this.D=$o[3]|0,this.E=$o[4]|0}get(){const{A:r,B:e,C:t,D:s,E:a}=this;return[r,e,t,s,a]}set(r,e,t,s,a){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0}process(r,e){for(let o=0;o<16;o++,e+=4)rr[o]=r.getUint32(e,!1);for(let o=16;o<80;o++)rr[o]=Vm(rr[o-3]^rr[o-8]^rr[o-14]^rr[o-16],1);let{A:t,B:s,C:a,D:n,E:i}=this;for(let o=0;o<80;o++){let h,u;o<20?(h=Vg(s,a,n),u=1518500249):o<40?(h=s^a^n,u=1859775393):o<60?(h=xg(s,a,n),u=2400959708):(h=s^a^n,u=3395469782);const c=Vm(t,5)+h+i+u+rr[o]|0;i=n,n=a,a=Vm(s,30),s=t,t=c}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,i=i+this.E|0,this.set(t,s,a,n,i)}roundClean(){rr.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}};const q0=zh(()=>new J0),W0=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ar=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),nr=new Uint32Array(64);let G0=class extends Qf{constructor(){super(64,32,8,!1),this.A=ar[0]|0,this.B=ar[1]|0,this.C=ar[2]|0,this.D=ar[3]|0,this.E=ar[4]|0,this.F=ar[5]|0,this.G=ar[6]|0,this.H=ar[7]|0}get(){const{A:r,B:e,C:t,D:s,E:a,F:n,G:i,H:o}=this;return[r,e,t,s,a,n,i,o]}set(r,e,t,s,a,n,i,o){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0,this.F=n|0,this.G=i|0,this.H=o|0}process(r,e){for(let c=0;c<16;c++,e+=4)nr[c]=r.getUint32(e,!1);for(let c=16;c<64;c++){const f=nr[c-15],m=nr[c-2],y=ys(f,7)^ys(f,18)^f>>>3,w=ys(m,17)^ys(m,19)^m>>>10;nr[c]=w+nr[c-7]+y+nr[c-16]|0}let{A:t,B:s,C:a,D:n,E:i,F:o,G:h,H:u}=this;for(let c=0;c<64;c++){const f=ys(i,6)^ys(i,11)^ys(i,25),m=u+f+Vg(i,o,h)+W0[c]+nr[c]|0,y=(ys(t,2)^ys(t,13)^ys(t,22))+xg(t,s,a)|0;u=h,h=o,o=i,i=n+m|0,n=a,a=s,s=t,t=m+y|0}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,i=i+this.E|0,o=o+this.F|0,h=h+this.G|0,u=u+this.H|0,this.set(t,s,a,n,i,o,h,u)}roundClean(){nr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const X0=zh(()=>new G0),yl=BigInt(2**32-1),wf=BigInt(32);function Bg(r,e=!1){return e?{h:Number(r&yl),l:Number(r>>wf&yl)}:{h:Number(r>>wf&yl)|0,l:Number(r&yl)|0}}function z0(r,e=!1){let t=new Uint32Array(r.length),s=new Uint32Array(r.length);for(let a=0;a<r.length;a++){const{h:n,l:i}=Bg(r[a],e);[t[a],s[a]]=[n,i]}return[t,s]}const Y0=(r,e)=>BigInt(r>>>0)<<wf|BigInt(e>>>0),_0=(r,e,t)=>r>>>t,Q0=(r,e,t)=>r<<32-t|e>>>t,Z0=(r,e,t)=>r>>>t|e<<32-t,e1=(r,e,t)=>r<<32-t|e>>>t,t1=(r,e,t)=>r<<64-t|e>>>t-32,s1=(r,e,t)=>r>>>t-32|e<<64-t,r1=(r,e)=>e,a1=(r,e)=>r,n1=(r,e,t)=>r<<t|e>>>32-t,i1=(r,e,t)=>e<<t|r>>>32-t,o1=(r,e,t)=>e<<t-32|r>>>64-t,u1=(r,e,t)=>r<<t-32|e>>>64-t;function c1(r,e,t,s){const a=(e>>>0)+(s>>>0);return{h:r+t+(a/2**32|0)|0,l:a|0}}const l1=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),h1=(r,e,t,s)=>e+t+s+(r/2**32|0)|0,m1=(r,e,t,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0),f1=(r,e,t,s,a)=>e+t+s+a+(r/2**32|0)|0,p1=(r,e,t,s,a)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0)+(a>>>0),d1=(r,e,t,s,a,n)=>e+t+s+a+n+(r/2**32|0)|0,ge={fromBig:Bg,split:z0,toBig:Y0,shrSH:_0,shrSL:Q0,rotrSH:Z0,rotrSL:e1,rotrBH:t1,rotrBL:s1,rotr32H:r1,rotr32L:a1,rotlSH:n1,rotlSL:i1,rotlBH:o1,rotlBL:u1,add:c1,add3L:l1,add3H:h1,add4L:m1,add4H:f1,add5H:d1,add5L:p1},[g1,w1]=ge.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),ir=new Uint32Array(80),or=new Uint32Array(80);let Og=class extends Qf{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:r,Al:e,Bh:t,Bl:s,Ch:a,Cl:n,Dh:i,Dl:o,Eh:h,El:u,Fh:c,Fl:f,Gh:m,Gl:y,Hh:w,Hl:S}=this;return[r,e,t,s,a,n,i,o,h,u,c,f,m,y,w,S]}set(r,e,t,s,a,n,i,o,h,u,c,f,m,y,w,S){this.Ah=r|0,this.Al=e|0,this.Bh=t|0,this.Bl=s|0,this.Ch=a|0,this.Cl=n|0,this.Dh=i|0,this.Dl=o|0,this.Eh=h|0,this.El=u|0,this.Fh=c|0,this.Fl=f|0,this.Gh=m|0,this.Gl=y|0,this.Hh=w|0,this.Hl=S|0}process(r,e){for(let p=0;p<16;p++,e+=4)ir[p]=r.getUint32(e),or[p]=r.getUint32(e+=4);for(let p=16;p<80;p++){const b=ir[p-15]|0,k=or[p-15]|0,P=ge.rotrSH(b,k,1)^ge.rotrSH(b,k,8)^ge.shrSH(b,k,7),x=ge.rotrSL(b,k,1)^ge.rotrSL(b,k,8)^ge.shrSL(b,k,7),T=ir[p-2]|0,B=or[p-2]|0,V=ge.rotrSH(T,B,19)^ge.rotrBH(T,B,61)^ge.shrSH(T,B,6),J=ge.rotrSL(T,B,19)^ge.rotrBL(T,B,61)^ge.shrSL(T,B,6),F=ge.add4L(x,J,or[p-7],or[p-16]),D=ge.add4H(F,P,V,ir[p-7],ir[p-16]);ir[p]=D|0,or[p]=F|0}let{Ah:t,Al:s,Bh:a,Bl:n,Ch:i,Cl:o,Dh:h,Dl:u,Eh:c,El:f,Fh:m,Fl:y,Gh:w,Gl:S,Hh:v,Hl:C}=this;for(let p=0;p<80;p++){const b=ge.rotrSH(c,f,14)^ge.rotrSH(c,f,18)^ge.rotrBH(c,f,41),k=ge.rotrSL(c,f,14)^ge.rotrSL(c,f,18)^ge.rotrBL(c,f,41),P=c&m^~c&w,x=f&y^~f&S,T=ge.add5L(C,k,x,w1[p],or[p]),B=ge.add5H(T,v,b,P,g1[p],ir[p]),V=T|0,J=ge.rotrSH(t,s,28)^ge.rotrBH(t,s,34)^ge.rotrBH(t,s,39),F=ge.rotrSL(t,s,28)^ge.rotrBL(t,s,34)^ge.rotrBL(t,s,39),D=t&a^t&i^a&i,j=s&n^s&o^n&o;v=w|0,C=S|0,w=m|0,S=y|0,m=c|0,y=f|0,{h:c,l:f}=ge.add(h|0,u|0,B|0,V|0),h=i|0,u=o|0,i=a|0,o=n|0,a=t|0,n=s|0;const ee=ge.add3L(V,F,j);t=ge.add3H(ee,B,J,D),s=ee|0}({h:t,l:s}=ge.add(this.Ah|0,this.Al|0,t|0,s|0)),{h:a,l:n}=ge.add(this.Bh|0,this.Bl|0,a|0,n|0),{h:i,l:o}=ge.add(this.Ch|0,this.Cl|0,i|0,o|0),{h,l:u}=ge.add(this.Dh|0,this.Dl|0,h|0,u|0),{h:c,l:f}=ge.add(this.Eh|0,this.El|0,c|0,f|0),{h:m,l:y}=ge.add(this.Fh|0,this.Fl|0,m|0,y|0),{h:w,l:S}=ge.add(this.Gh|0,this.Gl|0,w|0,S|0),{h:v,l:C}=ge.add(this.Hh|0,this.Hl|0,v|0,C|0),this.set(t,s,a,n,i,o,h,u,c,f,m,y,w,S,v,C)}roundClean(){ir.fill(0),or.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},y1=class extends Og{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}};const v1=zh(()=>new Og),b1=zh(()=>new y1),Xe=new ArrayBuffer(0),E="";class Se extends TypeError{constructor(){super(...arguments),this.name=Se.NAME}static isType(e,t){if(typeof t=="string"){if(t==="Array"&&Array.isArray(e)||t==="ArrayBuffer"&&e instanceof ArrayBuffer||t==="ArrayBufferView"&&ArrayBuffer.isView(e)||typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...s){for(const n of s)if(this.isType(e,n))return;const a=s.map(n=>n instanceof Function&&"name"in n?n.name:`${n}`);throw new Se(`Parameter '${t}' is not of type ${a.length>1?`(${a.join(" or ")})`:a[0]}`)}}Se.NAME="ArgumentError";class ye extends TypeError{static assert(...e){let t=null,s,a;typeof e[0]=="string"?(t=e[0],s=e[1],a=e.slice(2)):(s=e[0],a=e.slice(1)),Se.assert(s,"parameters","object");for(const n of a)if(s[n]==null)throw new ye(n,t)}static assertEmpty(e,t,s){if(e==null)throw new ye(t,s)}constructor(e,t=null,s){super(),this.name=ye.NAME,this.field=e,t&&(this.target=t),s?this.message=s:this.message=`Absent mandatory parameter '${e}' ${t?` in '${t}'`:E}`}}ye.NAME="ParameterError";class q extends Error{static assertSchema(e,t){if(!e.verified)throw new Error(`Object's schema was not verified against input data for ${t}`)}static assert(e,t){if(e.offset===-1)throw new q(`Error during parsing of ASN.1 data. Data is not correct for '${t}'.`)}constructor(e){super(e),this.name="AsnError"}}class G{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=Ge(e);q.assert(t,this.name);try{return new this({schema:t.result})}catch{throw new q(`Cannot create '${this.CLASS_NAME}' from ASN.1 object`)}}static defaultValues(e){throw new Error(`Invalid member name for ${this.CLASS_NAME} class: ${e}`)}static schema(e={}){throw new Error(`Method '${this.CLASS_NAME}.schema' should be overridden`)}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch{t=this.toSchema(!0)}return Ae.ToString(t.toBER(),e)}}G.CLASS_NAME="PkiObject";function zr(r){let e=!1,t=E;const s=r.trim();for(let a=0;a<s.length;a++)s.charCodeAt(a)===32?e===!1&&(e=!0):(e&&(t+=" ",e=!1),t+=s[a]);return t.toLowerCase()}const Ko="type",xm="value";class ta extends G{constructor(e={}){super(),this.type=d(e,Ko,ta.defaultValues(Ko)),this.value=d(e,xm,ta.defaultValues(xm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ko:return E;case xm:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.type||E}),new ue({name:t.value||E})]})}fromSchema(e){X(e,[Ko,"typeValue"]);const t=z(e,e,ta.schema({names:{type:Ko,value:"typeValue"}}));q.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new O({value:[new re({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return Object.keys(this.value).length!==0?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[Ih.blockName(),hf.blockName(),lf.blockName(),ql.blockName(),Js.blockName(),cf.blockName(),Sw.blockName(),Gd.blockName(),Nw.blockName(),Ew.blockName(),Cw.blockName(),kw.blockName()];if(e instanceof ArrayBuffer)return xe.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===ta.blockName()){if(this.type!==e.type)return!1;const s=[!1,!1],a=this.value.constructor.blockName();for(const n of t)a===n&&(s[0]=!0),e.value.constructor.blockName()===n&&(s[1]=!0);if(s[0]!==s[1])return!1;if(s[0]&&s[1]){const n=zr(this.value.valueBlock.value),i=zr(e.value.valueBlock.value);if(n.localeCompare(i)!==0)return!1}else if(!xe.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}ta.CLASS_NAME="AttributeTypeAndValue";const fa="typesAndValues",vl="valueBeforeDecode",gd="RDN";class Ne extends G{constructor(e={}){super(),this.typesAndValues=d(e,fa,Ne.defaultValues(fa)),this.valueBeforeDecode=d(e,vl,Ne.defaultValues(vl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fa:return[];case vl:return Xe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fa:return t.length===0;case vl:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.repeatedSequence||E,value:new tt({value:[new he({name:t.repeatedSet||E,value:ta.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){X(e,[gd,fa]);const t=z(e,e,Ne.schema({names:{blockName:gd,repeatedSet:fa}}));q.assertSchema(t,this.className),fa in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,s=>new ta({schema:s}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(this.valueBeforeDecode.byteLength===0)return new O({value:[new tt({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=Ge(this.valueBeforeDecode);if(q.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof O))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof Ne){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,s]of this.typesAndValues.entries())if(s.isEqual(e.typesAndValues[t])===!1)return!1;return!0}return e instanceof ArrayBuffer?tl(this.valueBeforeDecode,e):!1}}Ne.CLASS_NAME="RelativeDistinguishedNames";const eu="type",tu="value";function A1(r={},e=!1){const t=d(r,"names",{});return new O({optional:e,value:[new U({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:t.country_name||E,value:[new Le({value:[new ql,new Js]})]}),new U({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:t.administration_domain_name||E,value:[new Le({value:[new ql,new Js]})]}),new oe({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:t.network_address||E,isHexOnly:!0}),new oe({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:t.terminal_identifier||E,isHexOnly:!0}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:t.private_domain_name||E,value:[new Le({value:[new ql,new Js]})]}),new oe({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:t.organization_name||E,isHexOnly:!0}),new oe({optional:!0,name:t.numeric_user_identifier||E,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new U({optional:!0,name:t.personal_name||E,idBlock:{tagClass:3,tagNumber:5},value:[new oe({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new oe({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new oe({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new oe({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new U({optional:!0,name:t.organizational_unit_names||E,idBlock:{tagClass:3,tagNumber:6},value:[new he({value:new Js})]})]})}function S1(r=!1){return new O({optional:r,value:[new Js,new Js]})}function N1(r=!1){return new tt({optional:r,value:[new oe({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ue]})]})}class be extends G{constructor(e={}){super(),this.type=d(e,eu,be.defaultValues(eu)),this.value=d(e,tu,be.defaultValues(tu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eu:return 9;case tu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case eu:return t===be.defaultValues(e);case tu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Le({value:[new U({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||E,value:[new re,new U({idBlock:{tagClass:3,tagNumber:0},value:[new ue]})]}),new oe({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:1}}),new oe({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:2}}),new U({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||E,value:[A1(t.builtInStandardAttributes||{},!1),S1(!0),N1(!0)]}),new U({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||E,value:[Ne.schema(t.directoryName||{})]}),new U({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||E,value:[new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Le({value:[new cf,new Js,new lf,new Ih,new hf]})]}),new U({idBlock:{tagClass:3,tagNumber:1},value:[new Le({value:[new cf,new Js,new lf,new Ih,new hf]})]})]}),new oe({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:6}}),new oe({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:7}}),new oe({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){X(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=z(e,e,be.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(q.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=t.result.blockName;break;case 1:case 2:case 6:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=22;const a=s.toBER(!1),n=Ge(a);q.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value}break;case 3:this.value=t.result.blockName;break;case 4:this.value=new Ne({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new Y({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=6;const a=s.toBER(!1),n=Ge(a);q.assert(n,"GeneralName registeredID"),this.value=n.result.valueBlock.toString()}break}}toSchema(){switch(this.type){case 0:case 3:case 5:return new U({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new Gd({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new U({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new re({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return be.schema()}}toJSON(){const e={type:this.type,value:E};if(typeof this.value=="string")e.value=this.value;else try{e.value=this.value.toJSON()}catch{}return e}}be.CLASS_NAME="GeneralName";const su="accessMethod",ru="accessLocation",E1=[su,ru];class Cn extends G{constructor(e={}){super(),this.accessMethod=d(e,su,Cn.defaultValues(su)),this.accessLocation=d(e,ru,Cn.defaultValues(ru)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case su:return E;case ru:return new be;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.accessMethod||E}),be.schema(t.accessLocation||{})]})}fromSchema(e){X(e,E1);const t=z(e,e,Cn.schema({names:{accessMethod:su,accessLocation:{names:{blockName:ru}}}}));q.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new be({schema:t.result.accessLocation})}toSchema(){return new O({value:[new re({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}Cn.CLASS_NAME="AccessDescription";const hr="seconds",mr="millis",fr="micros";class Ft extends G{constructor(e={}){super(),hr in e&&(this.seconds=d(e,hr,Ft.defaultValues(hr))),mr in e&&(this.millis=d(e,mr,Ft.defaultValues(mr))),fr in e&&(this.micros=d(e,fr,Ft.defaultValues(fr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hr:case mr:case fr:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hr:case mr:case fr:return t===Ft.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,optional:!0,value:[new H({optional:!0,name:t.seconds||E}),new oe({name:t.millis||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new oe({name:t.micros||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){X(e,[hr,mr,fr]);const t=z(e,e,Ft.schema({names:{seconds:hr,millis:mr,micros:fr}}));if(q.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const s=new H({valueHex:t.result.millis.valueBlock.valueHex});this.millis=s.valueBlock.valueDec}if("micros"in t.result){const s=new H({valueHex:t.result.micros.valueBlock.valueHex});this.micros=s.valueBlock.valueDec}}toSchema(){const e=[];if(this.seconds!==void 0&&e.push(new H({value:this.seconds})),this.millis!==void 0){const t=new H({value:this.millis});e.push(new oe({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(this.micros!==void 0){const t=new H({value:this.micros});e.push(new oe({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new O({value:e})}toJSON(){const e={};return this.seconds!==void 0&&(e.seconds=this.seconds),this.millis!==void 0&&(e.millis=this.millis),this.micros!==void 0&&(e.micros=this.micros),e}}Ft.CLASS_NAME="Accuracy";const bl="algorithmId",Mo="algorithmParams",Pg="algorithm",yf="params",C1=[Pg,yf];class M extends G{constructor(e={}){super(),this.algorithmId=d(e,bl,M.defaultValues(bl)),Mo in e&&(this.algorithmParams=d(e,Mo,M.defaultValues(Mo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bl:return E;case Mo:return new ue;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bl:return t===E;case Mo:return t instanceof ue;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,optional:t.optional||!1,value:[new re({name:t.algorithmIdentifier||E}),new ue({name:t.algorithmParams||E,optional:!0})]})}fromSchema(e){X(e,C1);const t=z(e,e,M.schema({names:{algorithmIdentifier:Pg,algorithmParams:yf}}));q.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),yf in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new re({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof ue)&&e.push(this.algorithmParams),new O({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof ue)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return!(e instanceof M)||this.algorithmId!==e.algorithmId?!1:this.algorithmParams?e.algorithmParams?JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!1:!e.algorithmParams}}M.CLASS_NAME="AlgorithmIdentifier";const Xn="altNames",k1=[Xn];class Vo extends G{constructor(e={}){super(),this.altNames=d(e,Xn,Vo.defaultValues(Xn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xn:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.altNames||E,value:be.schema()})]})}fromSchema(e){X(e,k1);const t=z(e,e,Vo.schema({names:{altNames:Xn}}));q.assertSchema(t,this.className),Xn in t.result&&(this.altNames=Array.from(t.result.altNames,s=>new be({schema:s})))}toSchema(){return new O({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}Vo.CLASS_NAME="AltName";const zn="type",Yn="values",I1=[zn,Yn];class Be extends G{constructor(e={}){super(),this.type=d(e,zn,Be.defaultValues(zn)),this.values=d(e,Yn,Be.defaultValues(Yn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zn:return E;case Yn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zn:return t===E;case Yn:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.type||E}),new tt({name:t.setName||E,value:[new he({name:t.values||E,value:new ue})]})]})}fromSchema(e){X(e,I1);const t=z(e,e,Be.schema({names:{type:zn,values:Yn}}));q.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new O({value:[new re({value:this.type}),new tt({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}Be.CLASS_NAME="Attribute";const au="notBeforeTime",nu="notAfterTime",V1=[au,nu];class ps extends G{constructor(e={}){super(),this.notBeforeTime=d(e,au,ps.defaultValues(au)),this.notAfterTime=d(e,nu,ps.defaultValues(nu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case au:case nu:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new Ue({name:t.notBeforeTime||E}),new Ue({name:t.notAfterTime||E})]})}fromSchema(e){X(e,V1);const t=z(e,e,ps.schema({names:{notBeforeTime:au,notAfterTime:nu}}));q.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new O({value:[new Ue({valueDate:this.notBeforeTime}),new Ue({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}ps.CLASS_NAME="AttCertValidityPeriod";const Ho="names",wd="generalNames";class st extends G{constructor(e={}){super(),this.names=d(e,Ho,st.defaultValues(Ho)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"names":return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,Ho,{});return new O({optional:t,name:s.blockName||E,value:[new he({name:s.generalNames||E,value:be.schema()})]})}fromSchema(e){X(e,[Ho,wd]);const t=z(e,e,st.schema({names:{blockName:Ho,generalNames:wd}}));q.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,s=>new be({schema:s}))}toSchema(){return new O({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}st.CLASS_NAME="GeneralNames";const x1="2.5.29.9",B1="2.5.29.14",O1="2.5.29.15",P1="2.5.29.16",Dg="2.5.29.17",Tg="2.5.29.18",Zf="2.5.29.19",D1="2.5.29.20",T1="2.5.29.27",R1="2.5.29.21",L1="2.5.29.24",Rg="2.5.29.28",Lg="2.5.29.29",Ug="2.5.29.30",jg="2.5.29.31",ep="2.5.29.46",$g="2.5.29.32",zt="2.5.29.32.0",U1="1.3.6.1.4.1.311.21.10",Kg="2.5.29.33",tp="2.5.29.35",Mg="2.5.29.36",j1="2.5.29.37",$1="2.5.29.54",sp="1.3.6.1.5.5.7.1.1",K1="1.3.6.1.5.5.7.1.11",M1="1.3.6.1.4.1.11129.2.4.2",H1="1.3.6.1.4.1.311.21.7",F1="1.3.6.1.4.1.311.21.1",J1="1.3.6.1.5.5.7.1.3",rp="1.2.840.113549.1.7.1",Hg="1.2.840.113549.1.7.2",Fg="1.2.840.113549.1.7.3",Jg="1.2.840.113549.1.7.6",q1="1.2.840.113549.1.9.16.1.4",yd="1.2.840.113549.1.9.22.1",W1="1.2.840.113549.1.9.22.2",vd="1.2.840.113549.1.9.22.3",bd="1.2.840.113549.1.9.23.1",G1="1.3.6.1.5.5.7",X1=`${G1}.48`,Xl=`${X1}.1.1`,va="keyIdentifier",ba="authorityCertIssuer",Aa="authorityCertSerialNumber",z1=[va,ba,Aa];class sa extends G{constructor(e={}){super(),va in e&&(this.keyIdentifier=d(e,va,sa.defaultValues(va))),ba in e&&(this.authorityCertIssuer=d(e,ba,sa.defaultValues(ba))),Aa in e&&(this.authorityCertSerialNumber=d(e,Aa,sa.defaultValues(Aa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case va:return new Y;case ba:return[];case Aa:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new oe({name:t.keyIdentifier||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new he({name:t.authorityCertIssuer||E,value:be.schema()})]}),new oe({name:t.authorityCertSerialNumber||E,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){X(e,z1);const t=z(e,e,sa.schema({names:{keyIdentifier:va,authorityCertIssuer:ba,authorityCertSerialNumber:Aa}}));q.assertSchema(t,this.className),va in t.result&&(this.keyIdentifier=new Y({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),ba in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,s=>new be({schema:s}))),Aa in t.result&&(this.authorityCertSerialNumber=new H({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new oe({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new U({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new oe({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new O({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}sa.CLASS_NAME="AuthorityKeyIdentifier";const pa="pathLenConstraint",da="cA";class kn extends G{constructor(e={}){super(),this.cA=d(e,da,!1),pa in e&&(this.pathLenConstraint=d(e,pa,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case da:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ha({optional:!0,name:t.cA||E}),new H({optional:!0,name:t.pathLenConstraint||E})]})}fromSchema(e){X(e,[da,pa]);const t=z(e,e,kn.schema({names:{cA:da,pathLenConstraint:pa}}));q.assertSchema(t,this.className),da in t.result&&(this.cA=t.result.cA.valueBlock.value),pa in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==kn.defaultValues(da)&&e.push(new ha({value:this.cA})),pa in this&&(this.pathLenConstraint instanceof H?e.push(this.pathLenConstraint):e.push(new H({value:this.pathLenConstraint}))),new O({value:e})}toJSON(){const e={};return this.cA!==kn.defaultValues(da)&&(e.cA=this.cA),pa in this&&(this.pathLenConstraint instanceof H?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}kn.CLASS_NAME="BasicConstraints";const Bm="certificateIndex",Om="keyIndex";class al extends G{constructor(e={}){super(),this.certificateIndex=d(e,Bm,al.defaultValues(Bm)),this.keyIndex=d(e,Om,al.defaultValues(Om)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bm:case Om:return 0;default:return super.defaultValues(e)}}static schema(){return new H}fromSchema(e){if(e.constructor.blockName()!==H.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const s=new Uint8Array(t);switch(!0){case t.byteLength<4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(s,4-t.byteLength),t=f.slice(0)}break;case t.byteLength>4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(s.slice(0,4)),t=f.slice(0)}break}const a=t.slice(0,2),n=new Uint8Array(a);let i=n[0];n[0]=n[1],n[1]=i;const o=new Uint16Array(a);this.keyIndex=o[0];const h=t.slice(2),u=new Uint8Array(h);i=u[0],u[0]=u[1],u[1]=i;const c=new Uint16Array(h);this.certificateIndex=c[0]}toSchema(){const e=new ArrayBuffer(2),t=new Uint16Array(e);t[0]=this.certificateIndex;const s=new Uint8Array(e);let a=s[0];s[0]=s[1],s[1]=a;const n=new ArrayBuffer(2),i=new Uint16Array(n);i[0]=this.keyIndex;const o=new Uint8Array(n);return a=o[0],o[0]=o[1],o[1]=a,new H({valueHex:vo(n,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}al.CLASS_NAME="CAVersion";const iu="policyQualifierId",ou="qualifier",Y1=[iu,ou];class In extends G{constructor(e={}){super(),this.policyQualifierId=d(e,iu,In.defaultValues(iu)),this.qualifier=d(e,ou,In.defaultValues(ou)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iu:return E;case ou:return new ue;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.policyQualifierId||E}),new ue({name:t.qualifier||E})]})}fromSchema(e){X(e,Y1);const t=z(e,e,In.schema({names:{policyQualifierId:iu,qualifier:ou}}));q.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new O({value:[new re({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}In.CLASS_NAME="PolicyQualifierInfo";const uu="policyIdentifier",Sa="policyQualifiers",_1=[uu,Sa];class Vn extends G{constructor(e={}){super(),this.policyIdentifier=d(e,uu,Vn.defaultValues(uu)),Sa in e&&(this.policyQualifiers=d(e,Sa,Vn.defaultValues(Sa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uu:return E;case Sa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.policyIdentifier||E}),new O({optional:!0,value:[new he({name:t.policyQualifiers||E,value:In.schema()})]})]})}fromSchema(e){X(e,_1);const t=z(e,e,Vn.schema({names:{policyIdentifier:uu,policyQualifiers:Sa}}));q.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),Sa in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,s=>new In({schema:s})))}toSchema(){const e=[];return e.push(new re({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new O({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}Vn.CLASS_NAME="PolicyInformation";const cu="certificatePolicies",Q1=[cu];class xo extends G{constructor(e={}){super(),this.certificatePolicies=d(e,cu,xo.defaultValues(cu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.certificatePolicies||E,value:Vn.schema()})]})}fromSchema(e){X(e,Q1);const t=z(e,e,xo.schema({names:{certificatePolicies:cu}}));q.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,s=>new Vn({schema:s}))}toSchema(){return new O({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}xo.CLASS_NAME="CertificatePolicies";const lu="templateID",Bs="templateMajorVersion",Os="templateMinorVersion",Z1=[lu,Bs,Os];class wo extends G{constructor(e={}){super(),this.templateID=d(e,lu,wo.defaultValues(lu)),Bs in e&&(this.templateMajorVersion=d(e,Bs,wo.defaultValues(Bs))),Os in e&&(this.templateMinorVersion=d(e,Os,wo.defaultValues(Os))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lu:return E;case Bs:case Os:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.templateID||E}),new H({name:t.templateMajorVersion||E,optional:!0}),new H({name:t.templateMinorVersion||E,optional:!0})]})}fromSchema(e){X(e,Z1);const t=z(e,e,wo.schema({names:{templateID:lu,templateMajorVersion:Bs,templateMinorVersion:Os}}));q.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),Bs in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),Os in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new re({value:this.templateID})),Bs in this&&e.push(new H({value:this.templateMajorVersion})),Os in this&&e.push(new H({value:this.templateMinorVersion})),new O({value:e})}toJSON(){const e={templateID:this.templateID};return Bs in this&&(e.templateMajorVersion=this.templateMajorVersion),Os in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}const Na="distributionPoint",qg="distributionPointNames",Ea="reasons",Ca="cRLIssuer",Wg="cRLIssuerNames",ev=[Na,qg,Ea,Ca,Wg];class ra extends G{constructor(e={}){super(),Na in e&&(this.distributionPoint=d(e,Na,ra.defaultValues(Na))),Ea in e&&(this.reasons=d(e,Ea,ra.defaultValues(Ea))),Ca in e&&(this.cRLIssuer=d(e,Ca,ra.defaultValues(Ca))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Na:return[];case Ea:return new we;case Ca:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Le({value:[new U({name:t.distributionPoint||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new he({name:t.distributionPointNames||E,value:be.schema()})]}),new U({name:t.distributionPoint||E,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Ne.schema().valueBlock.value})]})]}),new oe({name:t.reasons||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new U({name:t.cRLIssuer||E,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new he({name:t.cRLIssuerNames||E,value:be.schema()})]})]})}fromSchema(e){X(e,ev);const t=z(e,e,ra.schema({names:{distributionPoint:Na,distributionPointNames:qg,reasons:Ea,cRLIssuer:Ca,cRLIssuerNames:Wg}}));q.assertSchema(t,this.className),Na in t.result&&(t.result.distributionPoint.idBlock.tagNumber===0&&(this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new be({schema:s}))),t.result.distributionPoint.idBlock.tagNumber===1&&(this.distributionPoint=new Ne({schema:new O({value:t.result.distributionPoint.valueBlock.value})}))),Ea in t.result&&(this.reasons=new we({valueHex:t.result.reasons.valueBlock.valueHex})),Ca in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,s=>new be({schema:s})))}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new U({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):t=new U({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new oe({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new U({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}ra.CLASS_NAME="DistributionPoint";const hu="distributionPoints",tv=[hu];class Bo extends G{constructor(e={}){super(),this.distributionPoints=d(e,hu,Bo.defaultValues(hu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.distributionPoints||E,value:ra.schema()})]})}fromSchema(e){X(e,tv);const t=z(e,e,Bo.schema({names:{distributionPoints:hu}}));q.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,s=>new ra({schema:s}))}toSchema(){return new O({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}Bo.CLASS_NAME="CRLDistributionPoints";const mu="keyPurposes",sv=[mu];class nl extends G{constructor(e={}){super(),this.keyPurposes=d(e,mu,nl.defaultValues(mu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.keyPurposes||E,value:new re})]})}fromSchema(e){X(e,sv);const t=z(e,e,nl.schema({names:{keyPurposes:mu}}));q.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,s=>s.valueBlock.toString())}toSchema(){return new O({value:Array.from(this.keyPurposes,e=>new re({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}nl.CLASS_NAME="ExtKeyUsage";const Fo="accessDescriptions";class Oo extends G{constructor(e={}){super(),this.accessDescriptions=d(e,Fo,Oo.defaultValues(Fo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fo:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.accessDescriptions||E,value:Cn.schema()})]})}fromSchema(e){X(e,[Fo]);const t=z(e,e,Oo.schema({names:{accessDescriptions:Fo}}));q.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,s=>new Cn({schema:s}))}toSchema(){return new O({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}Oo.CLASS_NAME="InfoAccess";const ka="distributionPoint",Gg="distributionPointNames",pr="onlyContainsUserCerts",dr="onlyContainsCACerts",gr="onlySomeReasons",wr="indirectCRL",yr="onlyContainsAttributeCerts",rv=[ka,Gg,pr,dr,gr,wr,yr];class ct extends G{constructor(e={}){super(),ka in e&&(this.distributionPoint=d(e,ka,ct.defaultValues(ka))),this.onlyContainsUserCerts=d(e,pr,ct.defaultValues(pr)),this.onlyContainsCACerts=d(e,dr,ct.defaultValues(dr)),gr in e&&(this.onlySomeReasons=d(e,gr,ct.defaultValues(gr))),this.indirectCRL=d(e,wr,ct.defaultValues(wr)),this.onlyContainsAttributeCerts=d(e,yr,ct.defaultValues(yr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ka:return[];case pr:return!1;case dr:return!1;case gr:return 0;case wr:return!1;case yr:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Le({value:[new U({name:t.distributionPoint||E,idBlock:{tagClass:3,tagNumber:0},value:[new he({name:t.distributionPointNames||E,value:be.schema()})]}),new U({name:t.distributionPoint||E,idBlock:{tagClass:3,tagNumber:1},value:Ne.schema().valueBlock.value})]})]}),new oe({name:t.onlyContainsUserCerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new oe({name:t.onlyContainsCACerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new oe({name:t.onlySomeReasons||E,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new oe({name:t.indirectCRL||E,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new oe({name:t.onlyContainsAttributeCerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){X(e,rv);const t=z(e,e,ct.schema({names:{distributionPoint:ka,distributionPointNames:Gg,onlyContainsUserCerts:pr,onlyContainsCACerts:dr,onlySomeReasons:gr,indirectCRL:wr,onlyContainsAttributeCerts:yr}}));if(q.assertSchema(t,this.className),ka in t.result)switch(!0){case t.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new be({schema:s}));break;case t.result.distributionPoint.idBlock.tagNumber===1:this.distributionPoint=new Ne({schema:new O({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(pr in t.result){const s=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=s[0]!==0}if(dr in t.result){const s=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=s[0]!==0}if(gr in t.result){const s=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=s[0]}if(wr in t.result){const s=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=s[0]!==0}if(yr in t.result){const s=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=s[0]!==0}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new U({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==ct.defaultValues(pr)&&e.push(new oe({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==ct.defaultValues(dr)&&e.push(new oe({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),this.onlySomeReasons!==void 0){const t=new ArrayBuffer(1),s=new Uint8Array(t);s[0]=this.onlySomeReasons,e.push(new oe({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==ct.defaultValues(wr)&&e.push(new oe({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==ct.defaultValues(yr)&&e.push(new oe({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new O({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==ct.defaultValues(pr)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==ct.defaultValues(dr)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),gr in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==ct.defaultValues(wr)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==ct.defaultValues(yr)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}ct.CLASS_NAME="IssuingDistributionPoint";const fu="base",_n="minimum",vr="maximum",av=[fu,_n,vr];class Ss extends G{constructor(e={}){super(),this.base=d(e,fu,Ss.defaultValues(fu)),this.minimum=d(e,_n,Ss.defaultValues(_n)),vr in e&&(this.maximum=d(e,vr,Ss.defaultValues(vr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fu:return new be;case _n:return 0;case vr:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[be.schema(t.base||{}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:t.minimum||E})]}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new H({name:t.maximum||E})]})]})}fromSchema(e){X(e,av);const t=z(e,e,Ss.schema({names:{base:{names:{blockName:fu}},minimum:_n,maximum:vr}}));q.assertSchema(t,this.className),this.base=new be({schema:t.result.base}),_n in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),vr in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),this.minimum!==0){let t=0;this.minimum instanceof H?t=this.minimum:t=new H({value:this.minimum}),e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(vr in this){let t=0;this.maximum instanceof H?t=this.maximum:t=new H({value:this.maximum}),e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new O({value:e})}toJSON(){const e={base:this.base.toJSON()};return this.minimum!==0&&(typeof this.minimum=="number"?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),this.maximum!==void 0&&(typeof this.maximum=="number"?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}Ss.CLASS_NAME="GeneralSubtree";const Ia="permittedSubtrees",Va="excludedSubtrees",nv=[Ia,Va];class Ao extends G{constructor(e={}){super(),Ia in e&&(this.permittedSubtrees=d(e,Ia,Ao.defaultValues(Ia))),Va in e&&(this.excludedSubtrees=d(e,Va,Ao.defaultValues(Va))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ia:case Va:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new he({name:t.permittedSubtrees||E,value:Ss.schema()})]}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new he({name:t.excludedSubtrees||E,value:Ss.schema()})]})]})}fromSchema(e){X(e,nv);const t=z(e,e,Ao.schema({names:{permittedSubtrees:Ia,excludedSubtrees:Va}}));q.assertSchema(t,this.className),Ia in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,s=>new Ss({schema:s}))),Va in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,s=>new Ss({schema:s})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new U({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}Ao.CLASS_NAME="NameConstraints";const Ps="requireExplicitPolicy",Ds="inhibitPolicyMapping",iv=[Ps,Ds];class So extends G{constructor(e={}){super(),Ps in e&&(this.requireExplicitPolicy=d(e,Ps,So.defaultValues(Ps))),Ds in e&&(this.inhibitPolicyMapping=d(e,Ds,So.defaultValues(Ds))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ps:return 0;case Ds:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new oe({name:t.requireExplicitPolicy||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new oe({name:t.inhibitPolicyMapping||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){X(e,iv);const t=z(e,e,So.schema({names:{requireExplicitPolicy:Ps,inhibitPolicyMapping:Ds}}));if(q.assertSchema(t,this.className),Ps in t.result){const s=t.result.requireExplicitPolicy;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=Ge(a);q.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(Ds in t.result){const s=t.result.inhibitPolicyMapping;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=Ge(a);q.assert(n,"Integer"),this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if(Ps in this){const t=new H({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(Ds in this){const t=new H({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new O({value:e})}toJSON(){const e={};return Ps in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),Ds in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}So.CLASS_NAME="PolicyConstraints";const pu="issuerDomainPolicy",du="subjectDomainPolicy",ov=[pu,du];class xn extends G{constructor(e={}){super(),this.issuerDomainPolicy=d(e,pu,xn.defaultValues(pu)),this.subjectDomainPolicy=d(e,du,xn.defaultValues(du)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pu:return E;case du:return E;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.issuerDomainPolicy||E}),new re({name:t.subjectDomainPolicy||E})]})}fromSchema(e){X(e,ov);const t=z(e,e,xn.schema({names:{issuerDomainPolicy:pu,subjectDomainPolicy:du}}));q.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new O({value:[new re({value:this.issuerDomainPolicy}),new re({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}xn.CLASS_NAME="PolicyMapping";const gu="mappings",uv=[gu];class il extends G{constructor(e={}){super(),this.mappings=d(e,gu,il.defaultValues(gu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.mappings||E,value:xn.schema()})]})}fromSchema(e){X(e,uv);const t=z(e,e,il.schema({names:{mappings:gu}}));q.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,s=>new xn({schema:s}))}toSchema(){return new O({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}il.CLASS_NAME="PolicyMappings";const br="notBefore",Ar="notAfter",cv=[br,Ar];class No extends G{constructor(e={}){super(),br in e&&(this.notBefore=d(e,br,No.defaultValues(br))),Ar in e&&(this.notAfter=d(e,Ar,No.defaultValues(Ar))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case br:return new Date;case Ar:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new oe({name:t.notBefore||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new oe({name:t.notAfter||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){X(e,cv);const t=z(e,e,No.schema({names:{notBefore:br,notAfter:Ar}}));if(q.assertSchema(t,this.className),br in t.result){const s=new Ue;s.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=s.toDate()}if(Ar in t.result){const s=new Ue({valueHex:t.result.notAfter.valueBlock.valueHex});s.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=s.toDate()}}toSchema(){const e=[];return br in this&&e.push(new oe({idBlock:{tagClass:3,tagNumber:0},valueHex:new Ue({valueDate:this.notBefore}).valueBlock.valueHexView})),Ar in this&&e.push(new oe({idBlock:{tagClass:3,tagNumber:1},valueHex:new Ue({valueDate:this.notAfter}).valueBlock.valueHexView})),new O({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}No.CLASS_NAME="PrivateKeyUsagePeriod";const Qn="id",Ts="type",Zn="values",lv=[Qn,Ts],hv=[Zn];class Bn extends G{constructor(e={}){super(),this.id=d(e,Qn,Bn.defaultValues(Qn)),Ts in e&&(this.type=d(e,Ts,Bn.defaultValues(Ts))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qn:return E;case Ts:return new et;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qn:return t===E;case Ts:return t instanceof et;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.id||E}),new ue({name:t.type||E,optional:!0})]})}fromSchema(e){X(e,lv);const t=z(e,e,Bn.schema({names:{id:Qn,type:Ts}}));q.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),Ts in t.result&&(this.type=t.result.type)}toSchema(){const e=[new re({value:this.id})];return Ts in this&&e.push(this.type),new O({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}Bn.CLASS_NAME="QCStatement";class ol extends G{constructor(e={}){super(),this.values=d(e,Zn,ol.defaultValues(Zn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Zn:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.values||E,value:Bn.schema(t.value||{})})]})}fromSchema(e){X(e,hv);const t=z(e,e,ol.schema({names:{values:Zn}}));q.assertSchema(t,this.className),this.values=Array.from(t.result.values,s=>new Bn({schema:s}))}toSchema(){return new O({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}ol.CLASS_NAME="QCStatements";var ga;class ua{static register(e,t,s){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:s}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}ga=ua,ua.namedCurves={},ga.register("P-256","1.2.840.10045.3.1.7",32),ga.register("P-384","1.3.132.0.34",48),ga.register("P-521","1.3.132.0.35",66),ga.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),ga.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),ga.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const Al="x",Sl="y",Nl="namedCurve";class Pt extends G{constructor(e={}){super(),this.x=d(e,Al,Pt.defaultValues(Al)),this.y=d(e,Sl,Pt.defaultValues(Sl)),this.namedCurve=d(e,Nl,Pt.defaultValues(Nl)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Al:case Sl:return Xe;case Nl:return E;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Al:case Sl:return t instanceof ArrayBuffer&&tl(t,Pt.defaultValues(e));case Nl:return typeof t=="string"&&t===Pt.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new kh}fromSchema(e){const t=xe.toUint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");const s=ua.find(this.namedCurve);if(!s)throw new Error(`Incorrect curve OID: ${this.namedCurve}`);const a=s.size;if(t.byteLength!==a*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=s.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,a*2+1).buffer}toSchema(){return new kh({data:vo(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=ua.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:of(Ch(this.x),!0,!0,!1),y:of(Ch(this.y),!0,!0,!1)}}fromJSON(e){ye.assert("json",e,"crv","x","y");let t=0;const s=ua.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=ko(el(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const i=new Uint8Array(this.x),o=new Uint8Array(a);i.set(o,1)}else this.x=a.slice(0,t);const n=ko(el(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const i=new Uint8Array(this.y),o=new Uint8Array(n);i.set(o,1)}else this.y=n.slice(0,t)}}Pt.CLASS_NAME="ECPublicKey";const wu="modulus",yu="publicExponent",mv=[wu,yu];class On extends G{constructor(e={}){super(),this.modulus=d(e,wu,On.defaultValues(wu)),this.publicExponent=d(e,yu,On.defaultValues(yu)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wu:return new H;case yu:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.modulus||E}),new H({name:t.publicExponent||E})]})}fromSchema(e){X(e,mv);const t=z(e,e,On.schema({names:{modulus:wu,publicExponent:yu}}));q.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new O({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:Ae.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ae.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){ye.assert("json",e,"n","e");const t=ko(el(e.n,!0));this.modulus=new H({valueHex:t.slice(0,Math.pow(2,Aw(t.byteLength)))}),this.publicExponent=new H({valueHex:ko(el(e.e,!0)).slice(0,3)})}}On.CLASS_NAME="RSAPublicKey";const vu="algorithm",bu="subjectPublicKey",fv=[vu,bu];class Rt extends G{get parsedKey(){if(this._parsedKey===void 0){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===re.blockName())try{this._parsedKey=new Pt({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch{}break;case"1.2.840.113549.1.1.1":{const e=Ge(this.subjectPublicKey.valueBlock.valueHexView);if(e.offset!==-1)try{this._parsedKey=new On({schema:e.result})}catch{}}break}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=d(e,vu,Rt.defaultValues(vu)),this.subjectPublicKey=d(e,bu,Rt.defaultValues(bu));const t=d(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vu:return new M;case bu:return new we;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.algorithm||{}),new we({name:t.subjectPublicKey||E})]})}fromSchema(e){X(e,fv);const t=z(e,e,Rt.schema({names:{algorithm:{names:{blockName:vu}},subjectPublicKey:bu}}));q.assertSchema(t,this.className),this.algorithm=new M({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new O({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Pt({json:e}),this.algorithm=new M({algorithmId:"1.2.840.10045.2.1",algorithmParams:new re({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new On({json:e}),this.algorithm=new M({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new et});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new we({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=me(!0)){try{if(!e)throw new Error("Need to provide publicKey input parameter");const s=await t.exportKey("spki",e),a=Ge(s);try{this.fromSchema(a.result)}catch{throw new Error("Error during initializing object from schema")}}catch(s){const a=s instanceof Error?s.message:`${s}`;throw new Error(`Error during exporting public key: ${a}`)}}}Rt.CLASS_NAME="PublicKeyInfo";const ei="version",ti="privateKey",is="namedCurve",Sr="publicKey",pv=[ei,ti,is,Sr];class _t extends G{constructor(e={}){super(),this.version=d(e,ei,_t.defaultValues(ei)),this.privateKey=d(e,ti,_t.defaultValues(ti)),is in e&&(this.namedCurve=d(e,is,_t.defaultValues(is))),Sr in e&&(this.publicKey=d(e,Sr,_t.defaultValues(Sr))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ei:return 1;case ti:return new Y;case is:return E;case Sr:return new Pt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ei:return t===_t.defaultValues(e);case ti:return t.isEqual(_t.defaultValues(e));case is:return t===E;case Sr:return Pt.compareWithDefault(is,t.namedCurve)&&Pt.compareWithDefault("x",t.x)&&Pt.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new Y({name:t.privateKey||E}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new re({name:t.namedCurve||E})]}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new we({name:t.publicKey||E})]})]})}fromSchema(e){X(e,pv);const t=z(e,e,_t.schema({names:{version:ei,privateKey:ti,namedCurve:is,publicKey:Sr}}));if(q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,is in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),Sr in t.result){const s={schema:t.result.publicKey.valueBlock.valueHex};is in this&&(s.namedCurve=this.namedCurve),this.publicKey=new Pt(s)}}toSchema(){const e=[new H({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[new re({value:this.namedCurve})]})),this.publicKey&&e.push(new U({idBlock:{tagClass:3,tagNumber:1},value:[new we({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new O({value:e})}toJSON(){if(!this.namedCurve||_t.compareWithDefault(is,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=ua.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:Ae.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const s=this.publicKey.toJSON();t.x=s.x,t.y=s.y}return t}fromJSON(e){ye.assert("json",e,"crv","d");let t=0;const s=ua.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=Ae.FromBase64Url(e.d);if(a.byteLength<t){const n=new ArrayBuffer(t),i=new Uint8Array(n),o=new Uint8Array(a);i.set(o,1),this.privateKey=new Y({valueHex:n})}else this.privateKey=new Y({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new Pt({json:e}))}}_t.CLASS_NAME="ECPrivateKey";const Au="prime",Su="exponent",Nu="coefficient",dv=[Au,Su,Nu];class qs extends G{constructor(e={}){super(),this.prime=d(e,Au,qs.defaultValues(Au)),this.exponent=d(e,Su,qs.defaultValues(Su)),this.coefficient=d(e,Nu,qs.defaultValues(Nu)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Au:return new H;case Su:return new H;case Nu:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.prime||E}),new H({name:t.exponent||E}),new H({name:t.coefficient||E})]})}fromSchema(e){X(e,dv);const t=z(e,e,qs.schema({names:{prime:Au,exponent:Su,coefficient:Nu}}));q.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new O({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:Ae.ToBase64Url(this.prime.valueBlock.valueHexView),d:Ae.ToBase64Url(this.exponent.valueBlock.valueHexView),t:Ae.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){ye.assert("json",e,"r","d","r"),this.prime=new H({valueHex:Ae.FromBase64Url(e.r)}),this.exponent=new H({valueHex:Ae.FromBase64Url(e.d)}),this.coefficient=new H({valueHex:Ae.FromBase64Url(e.t)})}}qs.CLASS_NAME="OtherPrimeInfo";const Eu="version",Cu="modulus",ku="publicExponent",Iu="privateExponent",Vu="prime1",xu="prime2",Bu="exponent1",Ou="exponent2",Pu="coefficient",xa="otherPrimeInfos",gv=[Eu,Cu,ku,Iu,Vu,xu,Bu,Ou,Pu,xa];class kt extends G{constructor(e={}){super(),this.version=d(e,Eu,kt.defaultValues(Eu)),this.modulus=d(e,Cu,kt.defaultValues(Cu)),this.publicExponent=d(e,ku,kt.defaultValues(ku)),this.privateExponent=d(e,Iu,kt.defaultValues(Iu)),this.prime1=d(e,Vu,kt.defaultValues(Vu)),this.prime2=d(e,xu,kt.defaultValues(xu)),this.exponent1=d(e,Bu,kt.defaultValues(Bu)),this.exponent2=d(e,Ou,kt.defaultValues(Ou)),this.coefficient=d(e,Pu,kt.defaultValues(Pu)),xa in e&&(this.otherPrimeInfos=d(e,xa,kt.defaultValues(xa))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Eu:return 0;case Cu:return new H;case ku:return new H;case Iu:return new H;case Vu:return new H;case xu:return new H;case Bu:return new H;case Ou:return new H;case Pu:return new H;case xa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new H({name:t.modulus||E}),new H({name:t.publicExponent||E}),new H({name:t.privateExponent||E}),new H({name:t.prime1||E}),new H({name:t.prime2||E}),new H({name:t.exponent1||E}),new H({name:t.exponent2||E}),new H({name:t.coefficient||E}),new O({optional:!0,value:[new he({name:t.otherPrimeInfosName||E,value:qs.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){X(e,gv);const t=z(e,e,kt.schema({names:{version:Eu,modulus:Cu,publicExponent:ku,privateExponent:Iu,prime1:Vu,prime2:xu,exponent1:Bu,exponent2:Ou,coefficient:Pu,otherPrimeInfo:{names:{blockName:xa}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),xa in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,s=>new qs({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new O({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={n:Ae.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ae.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:Ae.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:Ae.ToBase64Url(this.prime1.valueBlock.valueHexView),q:Ae.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:Ae.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:Ae.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:Ae.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){ye.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new H({valueHex:Ae.FromBase64Url(e.n)}),this.publicExponent=new H({valueHex:Ae.FromBase64Url(e.e)}),this.privateExponent=new H({valueHex:Ae.FromBase64Url(e.d)}),this.prime1=new H({valueHex:Ae.FromBase64Url(e.p)}),this.prime2=new H({valueHex:Ae.FromBase64Url(e.q)}),this.exponent1=new H({valueHex:Ae.FromBase64Url(e.dp)}),this.exponent2=new H({valueHex:Ae.FromBase64Url(e.dq)}),this.coefficient=new H({valueHex:Ae.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new qs({json:t})))}}kt.CLASS_NAME="RSAPrivateKey";const Du="version",Tu="privateKeyAlgorithm",Ru="privateKey",Ba="attributes",El="parsedKey",wv=[Du,Tu,Ru,Ba];class Zt extends G{constructor(e={}){super(),this.version=d(e,Du,Zt.defaultValues(Du)),this.privateKeyAlgorithm=d(e,Tu,Zt.defaultValues(Tu)),this.privateKey=d(e,Ru,Zt.defaultValues(Ru)),Ba in e&&(this.attributes=d(e,Ba,Zt.defaultValues(Ba))),El in e&&(this.parsedKey=d(e,El,Zt.defaultValues(El))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Du:return 0;case Tu:return new M;case Ru:return new Y;case Ba:return[];case El:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),M.schema(t.privateKeyAlgorithm||{}),new Y({name:t.privateKey||E}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new he({name:t.attributes||E,value:Be.schema()})]})]})}fromSchema(e){X(e,wv);const t=z(e,e,Zt.schema({names:{version:Du,privateKeyAlgorithm:{names:{blockName:Tu}},privateKey:Ru,attributes:Ba}}));switch(q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new M({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,Ba in t.result&&(this.attributes=Array.from(t.result.attributes,s=>new Be({schema:s}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const s=Ge(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new kt({schema:s.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof re){const s=Ge(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new _t({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:s.result}))}break}}toSchema(){const e=[new H({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new O({value:e})}toJSON(){if(!this.parsedKey){const s={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(s.attributes=Array.from(this.attributes,a=>a.toJSON())),s}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new _t({json:e}),this.privateKeyAlgorithm=new M({algorithmId:"1.2.840.10045.2.1",algorithmParams:new re({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new kt({json:e}),this.privateKeyAlgorithm=new M({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new et});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new Y({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}Zt.CLASS_NAME="PrivateKeyInfo";const si="contentType",ri="contentEncryptionAlgorithm",Oa="encryptedContent",yv=[si,ri,Oa],Ad=1024;class Fe extends G{constructor(e={}){if(super(),this.contentType=d(e,si,Fe.defaultValues(si)),this.contentEncryptionAlgorithm=d(e,ri,Fe.defaultValues(ri)),Oa in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4&&this.encryptedContent.idBlock.isConstructed===!1&&!e.disableSplit)){const t=new Y({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,s,s+Ad>a.byteLength?a.byteLength-s:Ad),o=new ArrayBuffer(i.length),h=new Uint8Array(o);for(let u=0;u<h.length;u++)h[u]=i[u];t.valueBlock.value.push(new Y({valueHex:o})),n-=i.length,s+=i.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case si:return E;case ri:return new M;case Oa:return new Y;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case si:return t===E;case ri:return t.algorithmId===E&&!("algorithmParams"in t);case Oa:return t.isEqual(Fe.defaultValues(Oa));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.contentType||E}),M.schema(t.contentEncryptionAlgorithm||{}),new Le({value:[new U({name:t.encryptedContent||E,idBlock:{tagClass:3,tagNumber:0},value:[new he({value:new Y})]}),new oe({name:t.encryptedContent||E,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){X(e,yv);const t=z(e,e,Fe.schema({names:{contentType:si,contentEncryptionAlgorithm:{names:{blockName:ri}},encryptedContent:Oa}}));q.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new M({schema:t.result.contentEncryptionAlgorithm}),Oa in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new re({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const s=this.encryptedContent;s.idBlock.tagClass=3,s.idBlock.tagNumber=0,s.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(s)}return new O({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return Y.prototype.getValue.call(this.encryptedContent)}}Fe.CLASS_NAME="EncryptedContentInfo";const Nr="hashAlgorithm",Er="maskGenAlgorithm",Cr="saltLength",kr="trailerField",vv=[Nr,Er,Cr,kr];class lt extends G{constructor(e={}){super(),this.hashAlgorithm=d(e,Nr,lt.defaultValues(Nr)),this.maskGenAlgorithm=d(e,Er,lt.defaultValues(Er)),this.saltLength=d(e,Cr,lt.defaultValues(Cr)),this.trailerField=d(e,kr,lt.defaultValues(kr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nr:return new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new et});case Er:return new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new et}).toSchema()});case Cr:return 20;case kr:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new U({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[M.schema(t.hashAlgorithm||{})]}),new U({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[M.schema(t.maskGenAlgorithm||{})]}),new U({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new H({name:t.saltLength||E})]}),new U({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new H({name:t.trailerField||E})]})]})}fromSchema(e){X(e,vv);const t=z(e,e,lt.schema({names:{hashAlgorithm:{names:{blockName:Nr}},maskGenAlgorithm:{names:{blockName:Er}},saltLength:Cr,trailerField:kr}}));q.assertSchema(t,this.className),Nr in t.result&&(this.hashAlgorithm=new M({schema:t.result.hashAlgorithm})),Er in t.result&&(this.maskGenAlgorithm=new M({schema:t.result.maskGenAlgorithm})),Cr in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),kr in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(lt.defaultValues(Nr))||e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(lt.defaultValues(Er))||e.push(new U({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==lt.defaultValues(Cr)&&e.push(new U({idBlock:{tagClass:3,tagNumber:2},value:[new H({value:this.saltLength})]})),this.trailerField!==lt.defaultValues(kr)&&e.push(new U({idBlock:{tagClass:3,tagNumber:3},value:[new H({value:this.trailerField})]})),new O({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(lt.defaultValues(Nr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(lt.defaultValues(Er))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==lt.defaultValues(Cr)&&(e.saltLength=this.saltLength),this.trailerField!==lt.defaultValues(kr)&&(e.trailerField=this.trailerField),e}}lt.CLASS_NAME="RSASSAPSSParams";const ai="salt",Lu="iterationCount",os="keyLength",Rs="prf",bv=[ai,Lu,os,Rs];class Nt extends G{constructor(e={}){super(),this.salt=d(e,ai,Nt.defaultValues(ai)),this.iterationCount=d(e,Lu,Nt.defaultValues(Lu)),os in e&&(this.keyLength=d(e,os,Nt.defaultValues(os))),Rs in e&&(this.prf=d(e,Rs,Nt.defaultValues(Rs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ai:return{};case Lu:return-1;case os:return 0;case Rs:return new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new et});default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new Le({value:[new Y({name:t.saltPrimitive||E}),M.schema(t.saltConstructed||{})]}),new H({name:t.iterationCount||E}),new H({name:t.keyLength||E,optional:!0}),M.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){X(e,bv);const t=z(e,e,Nt.schema({names:{saltPrimitive:ai,saltConstructed:{names:{blockName:ai}},iterationCount:Lu,keyLength:os,prf:{names:{blockName:Rs,optional:!0}}}}));q.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,os in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),Rs in t.result&&(this.prf=new M({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new H({value:this.iterationCount})),os in this&&Nt.defaultValues(os)!==this.keyLength&&e.push(new H({value:this.keyLength})),this.prf&&Nt.defaultValues(Rs).isEqual(this.prf)===!1&&e.push(this.prf.toSchema()),new O({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return os in this&&Nt.defaultValues(os)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&Nt.defaultValues(Rs).isEqual(this.prf)===!1&&(e.prf=this.prf.toJSON()),e}}Nt.CLASS_NAME="PBKDF2Params";const Uu="keyDerivationFunc",ju="encryptionScheme",Av=[Uu,ju];class Pn extends G{constructor(e={}){super(),this.keyDerivationFunc=d(e,Uu,Pn.defaultValues(Uu)),this.encryptionScheme=d(e,ju,Pn.defaultValues(ju)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uu:return new M;case ju:return new M;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.keyDerivationFunc||{}),M.schema(t.encryptionScheme||{})]})}fromSchema(e){X(e,Av);const t=z(e,e,Pn.schema({names:{keyDerivationFunc:{names:{blockName:Uu}},encryptionScheme:{names:{blockName:ju}}}}));q.assertSchema(t,this.className),this.keyDerivationFunc=new M({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new M({schema:t.result.encryptionScheme})}toSchema(){return new O({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}Pn.CLASS_NAME="PBES2Params";class Sv{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=d(e,"name",E)}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){if(e===null)throw new Error('Argument "array" must not be null');return this.crypto.getRandomValues(e)}}async function Sd(r,e,t,s,a){let n,i,o;switch(r.toUpperCase()){case"SHA-1":n=20,i=64,o=q0;break;case"SHA-256":n=32,i=64,o=X0;break;case"SHA-384":n=48,i=128,o=b1;break;case"SHA-512":n=64,i=128,o=v1;break;default:throw new Error("Unsupported hashing algorithm")}const h=new Uint8Array(t);let u=new TextDecoder().decode(t);new TextEncoder().encode(u).some((b,k)=>b!==h[k])&&(u=String.fromCharCode(...h));const c=new Uint8Array(u.length*2+2),f=new DataView(c.buffer);for(let b=0;b<u.length;b++)f.setUint16(b*2,u.charCodeAt(b),!1);f.setUint16(u.length*2,0,!1);const m=new Uint8Array(i).fill(3),y=new Uint8Array(s),w=new Uint8Array(i*Math.ceil(y.length/i)).map((b,k)=>y[k%y.length]),S=new Uint8Array(i*Math.ceil(c.length/i)).map((b,k)=>c[k%c.length]);let v=new Uint8Array(w.length+S.length);v.set(w),v.set(S,w.length);const C=Math.ceil((e>>3)/n),p=[];for(let b=0;b<C;b++){let k=new Uint8Array(m.length+v.length);k.set(m),k.set(v,m.length);for(let B=0;B<a;B++)k=o(k);const P=new Uint8Array(i).map((B,V)=>k[V%k.length]),x=Math.ceil(y.length/i)+Math.ceil(c.length/i),T=[];for(let B=0;B<x;B++){const V=Array.from(v.slice(B*i,(B+1)*i));let J=511;for(let F=P.length-1;F>=0;F--)J>>=8,J+=P[F]+(V[F]||0),V[F]=J&255;T.push(...V)}v=new Uint8Array(T),p.push(...k)}return new Uint8Array(p.slice(0,e>>3)).buffer}function Xg(r){const e=typeof r=="string"?{name:r}:r;return"hash"in e?{...e,hash:Xg(e.hash)}:e}class ul extends Sv{async importKey(e,t,s,a,n){var i,o,h,u,c,f;let m={};const y=Xg(s);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,s,a,n);case"spki":{const w=Ge(xe.toArrayBuffer(t));q.assert(w,"keyData");const S=new Rt;try{S.fromSchema(w.result)}catch{throw new Se("Incorrect keyData")}switch(y.name.toUpperCase()){case"RSA-PSS":{if(!y.hash)throw new ye("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(y.hash.name.toUpperCase()){case"SHA-1":m.alg="PS1";break;case"SHA-256":m.alg="PS256";break;case"SHA-384":m.alg="PS384";break;case"SHA-512":m.alg="PS512";break;default:throw new Error(`Incorrect hash algorithm: ${y.hash.name.toUpperCase()}`)}}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],m.kty="RSA",m.ext=a,m.key_ops=n,S.algorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error(`Incorrect public key algorithm: ${S.algorithm.algorithmId}`);if(!m.alg){if(!y.hash)throw new ye("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(y.hash.name.toUpperCase()){case"SHA-1":m.alg="RS1";break;case"SHA-256":m.alg="RS256";break;case"SHA-384":m.alg="RS384";break;case"SHA-512":m.alg="RS512";break;default:throw new Error(`Incorrect hash algorithm: ${y.hash.name.toUpperCase()}`)}}const v=S.toJSON();Object.assign(m,v)}break;case"ECDSA":n=["verify"];case"ECDH":{if(m={kty:"EC",ext:a,key_ops:n},S.algorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error(`Incorrect public key algorithm: ${S.algorithm.algorithmId}`);const v=S.toJSON();Object.assign(m,v)}break;case"RSA-OAEP":{if(m.kty="RSA",m.ext=a,m.key_ops=n,this.name.toLowerCase()==="safari")m.alg="RSA-OAEP";else{if(!y.hash)throw new ye("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(y.hash.name.toUpperCase()){case"SHA-1":m.alg="RSA-OAEP";break;case"SHA-256":m.alg="RSA-OAEP-256";break;case"SHA-384":m.alg="RSA-OAEP-384";break;case"SHA-512":m.alg="RSA-OAEP-512";break;default:throw new Error(`Incorrect hash algorithm: ${y.hash.name.toUpperCase()}`)}}const v=S.toJSON();Object.assign(m,v)}break;case"RSAES-PKCS1-V1_5":{m.kty="RSA",m.ext=a,m.key_ops=n,m.alg="PS1";const v=S.toJSON();Object.assign(m,v)}break;default:throw new Error(`Incorrect algorithm name: ${y.name.toUpperCase()}`)}}break;case"pkcs8":{const w=new Zt,S=Ge(xe.toArrayBuffer(t));q.assert(S,"keyData");try{w.fromSchema(S.result)}catch{throw new Error("Incorrect keyData")}if(!w.parsedKey)throw new Error("Incorrect keyData");switch(y.name.toUpperCase()){case"RSA-PSS":switch((i=y.hash)===null||i===void 0?void 0:i.name.toUpperCase()){case"SHA-1":m.alg="PS1";break;case"SHA-256":m.alg="PS256";break;case"SHA-384":m.alg="PS384";break;case"SHA-512":m.alg="PS512";break;default:throw new Error(`Incorrect hash algorithm: ${(o=y.hash)===null||o===void 0?void 0:o.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],m.kty="RSA",m.ext=a,m.key_ops=n,w.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error(`Incorrect private key algorithm: ${w.privateKeyAlgorithm.algorithmId}`);if(!("alg"in m))switch((h=y.hash)===null||h===void 0?void 0:h.name.toUpperCase()){case"SHA-1":m.alg="RS1";break;case"SHA-256":m.alg="RS256";break;case"SHA-384":m.alg="RS384";break;case"SHA-512":m.alg="RS512";break;default:throw new Error(`Incorrect hash algorithm: ${(u=y.hash)===null||u===void 0?void 0:u.name.toUpperCase()}`)}const v=w.toJSON();Object.assign(m,v)}break;case"ECDSA":n=["sign"];case"ECDH":{if(m={kty:"EC",ext:a,key_ops:n},w.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error(`Incorrect algorithm: ${w.privateKeyAlgorithm.algorithmId}`);const v=w.toJSON();Object.assign(m,v)}break;case"RSA-OAEP":{if(m.kty="RSA",m.ext=a,m.key_ops=n,this.name.toLowerCase()==="safari")m.alg="RSA-OAEP";else switch((c=y.hash)===null||c===void 0?void 0:c.name.toUpperCase()){case"SHA-1":m.alg="RSA-OAEP";break;case"SHA-256":m.alg="RSA-OAEP-256";break;case"SHA-384":m.alg="RSA-OAEP-384";break;case"SHA-512":m.alg="RSA-OAEP-512";break;default:throw new Error(`Incorrect hash algorithm: ${(f=y.hash)===null||f===void 0?void 0:f.name.toUpperCase()}`)}const v=w.toJSON();Object.assign(m,v)}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],m.kty="RSA",m.ext=a,m.key_ops=n,m.alg="PS1";const v=w.toJSON();Object.assign(m,v)}break;default:throw new Error(`Incorrect algorithm name: ${y.name.toUpperCase()}`)}}break;case"jwk":m=t;break;default:throw new Error(`Incorrect format: ${e}`)}if(this.name.toLowerCase()==="safari")try{return this.subtle.importKey("jwk",ko(JSON.stringify(m)),s,a,n)}catch{return this.subtle.importKey("jwk",m,s,a,n)}return this.subtle.importKey("jwk",m,s,a,n)}async exportKey(e,t){let s=await this.subtle.exportKey("jwk",t);switch(this.name.toLowerCase()==="safari"&&s instanceof ArrayBuffer&&(s=JSON.parse(Ch(s))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{const a=new Rt;try{a.fromJSON(s)}catch{throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new Zt;try{a.fromJSON(s)}catch{throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return s;default:throw new Error(`Incorrect format: ${e}`)}}async convert(e,t,s,a,n,i){if(e.toLowerCase()===t.toLowerCase())return s;const o=await this.importKey(e,s,a,n,i);return this.exportKey(t,o)}getAlgorithmByOID(e,t=!1,s){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error(`Unsupported algorithm identifier ${s?`for ${s} `:E}: ${e}`);return{}}getOIDByAlgorithm(e,t=!1,s){let a=E;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11";break}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35";break}if(!a&&t)throw new Error(`Unsupported algorithm ${s?`for ${s} `:E}: ${e.name}`);return a}getAlgorithmParameters(e,t){let s={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":s={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":s={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":s={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":s={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":s={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":s={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":s={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":s={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return s}getHashAlgorithm(e){let t=E;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const s=new lt({schema:e.algorithmParams});if(s.hashAlgorithm){const a=this.getAlgorithmByOID(s.hashAlgorithm.algorithmId);if("name"in a)t=a.name;else return E}else t="SHA-1"}catch{}break}return t}async encryptEncryptedContentInfo(e){ye.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),s=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),n=new ArrayBuffer(16),i=new Uint8Array(n);this.getRandomValues(i);const o=new ArrayBuffer(64),h=new Uint8Array(o);this.getRandomValues(h);const u=new Uint8Array(e.contentToEncrypt),c=new Nt({salt:new Y({valueHex:o}),iterationCount:e.iterationCount,prf:new M({algorithmId:a,algorithmParams:new et})}),f=new Uint8Array(e.password),m=await this.importKey("raw",f,"PBKDF2",!1,["deriveKey"]),y=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:h,iterations:e.iterationCount},m,e.contentEncryptionAlgorithm,!1,["encrypt"]),w=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:i},y,u),S=new Pn({keyDerivationFunc:new M({algorithmId:s,algorithmParams:c.toSchema()}),encryptionScheme:new M({algorithmId:t,algorithmParams:new Y({valueHex:n})})});return new Fe({contentType:e.contentType,contentEncryptionAlgorithm:new M({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:S.toSchema()}),encryptedContent:new Y({valueHex:w})})}async decryptEncryptedContentInfo(e){if(ye.assert(e,"password","encryptedContentInfo"),e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")throw new Error(`Unknown "contentEncryptionAlgorithm": ${e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);let t;try{t=new Pn({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "pbes2Parameters"')}let s;try{s=new Nt({schema:t.keyDerivationFunc.algorithmParams})}catch{throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),n=t.encryptionScheme.algorithmParams.valueBlock.valueHex,i=new Uint8Array(n),o=s.salt.valueBlock.valueHex,h=new Uint8Array(o),u=s.iterationCount;let c="SHA-1";s.prf&&(c=this.getAlgorithmByOID(s.prf.algorithmId,!0).hash.name);const f=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),m=await this.deriveKey({name:"PBKDF2",hash:{name:c},salt:h,iterations:u},f,a,!1,["decrypt"]),y=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:i},m,y)}async stampDataWithPassword(e){if(!(e instanceof Object))throw new Error('Parameters must have type "Object"');ye.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp");let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Sd(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["sign"]);return this.sign(s,n,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){ye.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Sd(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["verify"]);return this.verify(s,n,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");const s=new M,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const n=a.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?n.hash.name=e.algorithm.hash.name:n.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":s.algorithmId=this.getOIDByAlgorithm(n,!0);break;case"RSA-PSS":{switch(n.hash.name.toUpperCase()){case"SHA-256":n.saltLength=32;break;case"SHA-384":n.saltLength=48;break;case"SHA-512":n.saltLength=64;break}const i={};if(n.hash.name.toUpperCase()!=="SHA-1"){const h=this.getOIDByAlgorithm({name:n.hash.name},!0,"hashAlgorithm");i.hashAlgorithm=new M({algorithmId:h,algorithmParams:new et}),i.maskGenAlgorithm=new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:i.hashAlgorithm.toSchema()})}n.saltLength!==20&&(i.saltLength=n.saltLength);const o=new lt(i);s.algorithmId="1.2.840.113549.1.1.10",s.algorithmParams=o.toSchema()}break;default:throw new Error(`Unsupported signature algorithm: ${e.algorithm.name}`)}return{signatureAlgorithm:s,parameters:a}}async signWithPrivateKey(e,t,s){const a=await this.sign(s.algorithm,t,e);return s.algorithm.name==="ECDSA"?Ev(a):a}fillPublicKeyParameters(e,t){const s={},a=this.getHashAlgorithm(t);if(a===E)throw new Error(`Unsupported signature algorithm: ${t.algorithmId}`);let n;t.algorithmId==="1.2.840.113549.1.1.10"?n=t.algorithmId:n=e.algorithm.algorithmId;const i=this.getAlgorithmByOID(n,!0);if(s.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in s.algorithm.algorithm&&(s.algorithm.algorithm.hash.name=a),i.name==="ECDSA"){const o=e.algorithm;if(!o.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const h=o.algorithmParams;if("idBlock"in o.algorithmParams&&!(h.idBlock.tagClass===1&&h.idBlock.tagNumber===6))throw new Error("Incorrect type for ECDSA public key parameters");const u=this.getAlgorithmByOID(h.valueBlock.toString(),!0);s.algorithm.algorithm.namedCurve=u.name}return s}async getPublicKey(e,t,s){s||(s=this.fillPublicKeyParameters(e,t));const a=e.toSchema().toBER(!1);return this.importKey("spki",a,s.algorithm.algorithm,!0,s.algorithm.usages)}async verifyWithPublicKey(e,t,s,a,n){let i;if(n){const u={};let c;a.algorithmId==="1.2.840.113549.1.1.10"?c=a.algorithmId:c=s.algorithm.algorithmId;const f=this.getAlgorithmByOID(c,!0);if(u.algorithm=this.getAlgorithmParameters(f.name,"importKey"),"hash"in u.algorithm.algorithm&&(u.algorithm.algorithm.hash.name=n),f.name==="ECDSA"){let m=!1;if("algorithmParams"in s.algorithm&&"idBlock"in s.algorithm.algorithmParams&&s.algorithm.algorithmParams.idBlock.tagClass===1&&s.algorithm.algorithmParams.idBlock.tagNumber===6&&(m=!0),m===!1)throw new Error("Incorrect type for ECDSA public key parameters");const y=this.getAlgorithmByOID(s.algorithm.algorithmParams.valueBlock.toString(),!0);u.algorithm.algorithm.namedCurve=y.name}i=await this.getPublicKey(s,null,u)}else{if(n=this.getHashAlgorithm(a),!n)throw new Error(`Unsupported signature algorithm: ${a.algorithmId}`);i=await this.getPublicKey(s,a)}const o=this.getAlgorithmParameters(i.algorithm.name,"verify");"hash"in o.algorithm&&(o.algorithm.hash.name=n);let h=t.valueBlock.valueHexView;if(i.algorithm.name==="ECDSA"){const u=ua.find(i.algorithm.namedCurve);if(!u)throw new Error("Unsupported named curve in use");const c=Ge(h);q.assert(c,"Signature value"),h=Cv(c.result,u.size)}if(i.algorithm.name==="RSA-PSS"){const u=new lt({schema:a.algorithmParams});"saltLength"in u?o.algorithm.saltLength=u.saltLength:o.algorithm.saltLength=20;let c="SHA-1";"hashAlgorithm"in u&&(c=this.getAlgorithmByOID(u.hashAlgorithm.algorithmId,!0).name),o.algorithm.hash.name=c}return this.verify(o.algorithm,i,h,e)}}let zg={name:"none",crypto:null};function Nd(r){return!!(r&&typeof r=="object"&&"crypto"in r)}function Ed(r,...e){let t=null;if(e.length<2)e.length?t=e[0]:t=typeof self<"u"&&self.crypto?new ul({name:"browser",crypto:self.crypto}):null;else{const s=e[0],a=e[1];Nd(a)?t=a:Nd(s)?t=s:"subtle"in s&&"getRandomValues"in s&&(t=new ul({crypto:s}))}if(typeof at<"u"&&"pid"in at&&typeof jt<"u"&&typeof window>"u"){if(typeof jt[at.pid]>"u")jt[at.pid]={};else if(typeof jt[at.pid]!="object")throw new Error(`Name global.${at.pid} already exists and it is not an object`);if(typeof jt[at.pid].pkijs>"u")jt[at.pid].pkijs={};else if(typeof jt[at.pid].pkijs!="object")throw new Error(`Name global.${at.pid}.pkijs already exists and it is not an object`);jt[at.pid].pkijs.engine={name:r,crypto:t}}else zg={name:r,crypto:t}}function Nv(){if(typeof at<"u"&&"pid"in at&&typeof jt<"u"&&typeof window>"u"){let r;try{r=jt[at.pid].pkijs.engine}catch{throw new Error("Please call 'setEngine' before call to 'getEngine'")}return r}return zg}function me(r=!1){const e=Nv();if(!e.crypto&&r)throw new Error("Unable to create WebCrypto object");return e.crypto}function Ev(r){if(r.byteLength%2!==0)return Xe;const e=r.byteLength/2,t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(r,0,e));const s=new H({valueHex:t}),a=new ArrayBuffer(e);new Uint8Array(a).set(new Uint8Array(r,e,e));const n=new H({valueHex:a});return new O({value:[s.convertToDER(),n.convertToDER()]}).toBER(!1)}function Cv(r,e){if(!(r instanceof O&&r.valueBlock.value.length===2&&r.valueBlock.value[0]instanceof H&&r.valueBlock.value[1]instanceof H))return Xe;const t=r.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,s=r.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,a=new Uint8Array(e*2);return a.set(t,e-t.byteLength),a.set(s,2*e-s.byteLength),a.buffer}async function kv(r,e,t,s,a){switch(r.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new Se(`Unknown hash function: ${r}`)}if(Se.assert(e,"zBuffer","ArrayBuffer"),e.byteLength===0)throw new Se("'zBuffer' has zero length, error");if(Se.assert(s,"SharedInfo","ArrayBuffer"),t>255)throw new Se("Please set 'Counter' argument to value less or equal to 255");const n=new ArrayBuffer(4),i=new Uint8Array(n);i[0]=0,i[1]=0,i[2]=0,i[3]=t;let o=Xe;o=vo(o,e),o=vo(o,n),o=vo(o,s);const h=await a.digest({name:r},o);return{counter:t,result:h}}async function Cd(r,e,t,s,a=me(!0)){let n=0,i=1;switch(r.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:throw new Se(`Unknown hash function: ${r}`)}if(Se.assert(e,"Zbuffer","ArrayBuffer"),e.byteLength===0)throw new Se("'Zbuffer' has zero length, error");Se.assert(s,"SharedInfo","ArrayBuffer");const o=t/n;Math.floor(o)>0&&(i=Math.floor(o),o-i>0&&i++);const h=[];for(let m=1;m<=i;m++)h.push(await kv(r,e,m,s,a));let u=Xe,c=1,f=!0;for(;f;){f=!1;for(const m of h)if(m.counter===c){u=vo(u,m.result),f=!0;break}c++}if(t>>=3,u.byteLength>t){const m=new ArrayBuffer(t),y=new Uint8Array(m),w=new Uint8Array(u);for(let S=0;S<t;S++)y[S]=w[S];return m}return u}const Pm="version",Dm="logID",Tm="extensions",Rm="timestamp",Lm="hashAlgorithm",Um="signatureAlgorithm",jm="signature",kd="none",Id="md5",Vd="sha1",xd="sha224",Bd="sha256",Od="sha384",Pd="sha512",Dd="anonymous",Td="rsa",Rd="dsa",Ld="ecdsa";class bs extends G{constructor(e={}){super(),this.version=d(e,Pm,bs.defaultValues(Pm)),this.logID=d(e,Dm,bs.defaultValues(Dm)),this.timestamp=d(e,Rm,bs.defaultValues(Rm)),this.extensions=d(e,Tm,bs.defaultValues(Tm)),this.hashAlgorithm=d(e,Lm,bs.defaultValues(Lm)),this.signatureAlgorithm=d(e,Um,bs.defaultValues(Um)),this.signature=d(e,jm,bs.defaultValues(jm)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pm:return 0;case Dm:case Tm:return Xe;case Rm:return new Date(0);case Lm:case Um:return E;case jm:return new ue;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof kh))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new oa({stream:new Re({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(Iw(new Uint8Array(e.getBlock(8)),8));const s=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(s)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=kd;break;case 1:this.hashAlgorithm=Id;break;case 2:this.hashAlgorithm=Vd;break;case 3:this.hashAlgorithm=xd;break;case 4:this.hashAlgorithm=Bd;break;case 5:this.hashAlgorithm=Od;break;case 6:this.hashAlgorithm=Pd;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=Dd;break;case 1:this.signatureAlgorithm=Td;break;case 2:this.signatureAlgorithm=Rd;break;case 3:this.signatureAlgorithm=Ld;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16(),n=new Uint8Array(e.getBlock(a)).buffer.slice(0),i=Ge(n);if(q.assert(i,"SignedCertificateTimestamp"),this.signature=i.result,t!==47+s+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new kh({data:e.stream.buffer})}toStream(){const e=new oa;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),s=new Uint8Array(t),a=Ip(this.timestamp.valueOf(),8);s.set(new Uint8Array(a),8-a.byteLength),e.appendView(s),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions));let n;switch(this.hashAlgorithm.toLowerCase()){case kd:n=0;break;case Id:n=1;break;case Vd:n=2;break;case xd:n=3;break;case Bd:n=4;break;case Od:n=5;break;case Pd:n=6;break;default:throw new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}e.appendChar(n);let i;switch(this.signatureAlgorithm.toLowerCase()){case Dd:i=0;break;case Td:i=1;break;case Rd:i=2;break;case Ld:i=3;break;default:throw new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}e.appendChar(i);const o=this.signature.toBER(!1);return e.appendUint16(o.byteLength),e.appendView(new Uint8Array(o)),e}toJSON(){return{version:this.version,logID:Vp(this.logID),timestamp:this.timestamp,extensions:Vp(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,s=0,a=me(!0)){const n=of(Ch(this.logID));let i=null;const o=new oa;for(const y of e)if(y.log_id===n){i=y.key;break}if(!i)throw new Error(`Public key not found for CT with logId: ${n}`);const h=ko(el(i)),u=Rt.fromBER(h);o.appendChar(0),o.appendChar(0);const c=new ArrayBuffer(8),f=new Uint8Array(c),m=Ip(this.timestamp.valueOf(),8);return f.set(new Uint8Array(m),8-m.byteLength),o.appendView(f),o.appendUint16(s),s===0&&o.appendUint24(t.byteLength),o.appendView(new Uint8Array(t)),o.appendUint16(this.extensions.byteLength),this.extensions.byteLength!==0&&o.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(o.buffer.slice(0,o.length),new Y({valueHex:this.signature.toBER(!1)}),u,{algorithmId:E},"SHA-256")}}bs.CLASS_NAME="SignedCertificateTimestamp";const Cl="timestamps";class Yh extends G{constructor(e={}){super(),this.timestamps=d(e,Cl,Yh.defaultValues(Cl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cl:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Cl:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){var t;const s=d(e,"names",{});return(t=s.optional)!==null&&t!==void 0||(s.optional=!1),new Y({name:s.blockName||"SignedCertificateTimestampList",optional:s.optional})}fromSchema(e){if(!(e instanceof Y))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new oa({stream:new Re({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new bs({stream:t}))}toSchema(){const e=new oa;let t=0;const s=[];for(const a of this.timestamps){const n=a.toStream();s.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const a of s)e.appendView(a.stream.view);return new Y({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}Yh.CLASS_NAME="SignedCertificateTimestampList";const $u="attributes",Iv=[$u];class cl extends G{constructor(e={}){super(),this.attributes=d(e,$u,cl.defaultValues($u)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $u:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.attributes||E,value:Be.schema()})]})}fromSchema(e){X(e,Iv);const t=z(e,e,cl.schema({names:{attributes:$u}}));q.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,s=>new Be({schema:s}))}toSchema(){return new O({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}cl.CLASS_NAME="SubjectDirectoryAttributes";class De{static getItems(){return this.types||(this.types={},De.register(Dg,"SubjectAltName",Vo),De.register(Tg,"IssuerAltName",Vo),De.register(tp,"AuthorityKeyIdentifier",sa),De.register(Zf,"BasicConstraints",kn),De.register(F1,"MicrosoftCaVersion",al),De.register($g,"CertificatePolicies",xo),De.register(U1,"CertificatePoliciesMicrosoft",xo),De.register(H1,"MicrosoftCertTemplateV2",wo),De.register(jg,"CRLDistributionPoints",Bo),De.register(ep,"FreshestCRL",Bo),De.register(j1,"ExtKeyUsage",nl),De.register(Lg,"CertificateIssuer",st),De.register(sp,"AuthorityInfoAccess",Oo),De.register(K1,"SubjectInfoAccess",Oo),De.register(Rg,"IssuingDistributionPoint",ct),De.register(Ug,"NameConstraints",Ao),De.register(Mg,"PolicyConstraints",So),De.register(Kg,"PolicyMappings",il),De.register(P1,"PrivateKeyUsagePeriod",No),De.register(J1,"QCStatements",ol),De.register(M1,"SignedCertificateTimestampList",Yh),De.register(x1,"SubjectDirectoryAttributes",cl)),this.types}static fromBER(e,t){const s=Ge(t);if(s.offset===-1)return null;const a=this.find(e);if(a)try{return new a.type({schema:s.result})}catch{const n=new a.type;return n.parsingError=`Incorrectly formatted value of extension ${a.name} (${e})`,n}return s.result}static find(e){return this.getItems()[e]||null}static register(e,t,s){this.getItems()[e]={name:t,type:s}}}const Ku="extnID",Ir="critical",Mu="extnValue",kl="parsedValue",Vv=[Ku,Ir,Mu];class Je extends G{get parsedValue(){if(this._parsedValue===void 0){const e=De.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=d(e,Ku,Je.defaultValues(Ku)),this.critical=d(e,Ir,Je.defaultValues(Ir)),Mu in e?this.extnValue=new Y({valueHex:e.extnValue}):this.extnValue=Je.defaultValues(Mu),kl in e&&(this.parsedValue=d(e,kl,Je.defaultValues(kl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ku:return E;case Ir:return!1;case Mu:return new Y;case kl:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.extnID||E}),new ha({name:t.critical||E,optional:!0}),new Y({name:t.extnValue||E})]})}fromSchema(e){X(e,Vv);const t=z(e,e,Je.schema({names:{extnID:Ku,critical:Ir,extnValue:Mu}}));q.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),Ir in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new re({value:this.extnID})),this.critical!==Je.defaultValues(Ir)&&e.push(new ha({value:this.critical})),e.push(this.extnValue),new O({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Je.defaultValues(Ir)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}Je.CLASS_NAME="Extension";const Hu="extensions",xv=[Hu];class ze extends G{constructor(e={}){super(),this.extensions=d(e,Hu,ze.defaultValues(Hu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hu:return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,"names",{});return new O({optional:t,name:s.blockName||E,value:[new he({name:s.extensions||E,value:Je.schema(s.extension||{})})]})}fromSchema(e){X(e,xv);const t=z(e,e,ze.schema({names:{extensions:Hu}}));q.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,s=>new Je({schema:s}))}toSchema(){return new O({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}ze.CLASS_NAME="Extensions";const Fu="issuer",Ju="serialNumber",Pa="issuerUID",Bv=[Fu,Ju,Pa];class Tt extends G{constructor(e={}){super(),this.issuer=d(e,Fu,Tt.defaultValues(Fu)),this.serialNumber=d(e,Ju,Tt.defaultValues(Ju)),Pa in e&&(this.issuerUID=d(e,Pa,Tt.defaultValues(Pa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fu:return new st;case Ju:return new H;case Pa:return new we;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[st.schema(t.issuer||{}),new H({name:t.serialNumber||E}),new we({optional:!0,name:t.issuerUID||E})]})}fromSchema(e){X(e,Bv);const t=z(e,e,Tt.schema({names:{issuer:{names:{blockName:Fu}},serialNumber:Ju,issuerUID:Pa}}));q.assertSchema(t,this.className),this.issuer=new st({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,Pa in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new O({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}Tt.CLASS_NAME="IssuerSerial";const qu="version",Da="baseCertificateID",Ta="subjectName",Wu="issuer",Gu="signature",Xu="serialNumber",zu="attrCertValidityPeriod",Yu="attributes",Ra="issuerUniqueID",La="extensions",Ov=[qu,Da,Ta,Wu,Gu,Xu,zu,Yu,Ra,La];class At extends G{constructor(e={}){super(),this.version=d(e,qu,At.defaultValues(qu)),Da in e&&(this.baseCertificateID=d(e,Da,At.defaultValues(Da))),Ta in e&&(this.subjectName=d(e,Ta,At.defaultValues(Ta))),this.issuer=d(e,Wu,At.defaultValues(Wu)),this.signature=d(e,Gu,At.defaultValues(Gu)),this.serialNumber=d(e,Xu,At.defaultValues(Xu)),this.attrCertValidityPeriod=d(e,zu,At.defaultValues(zu)),this.attributes=d(e,Yu,At.defaultValues(Yu)),Ra in e&&(this.issuerUniqueID=d(e,Ra,At.defaultValues(Ra))),La in e&&(this.extensions=d(e,La,At.defaultValues(La))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qu:return 0;case Da:return new Tt;case Ta:return new st;case Wu:return new st;case Gu:return new M;case Xu:return new H;case zu:return new ps;case Yu:return[];case Ra:return new we;case La:return new ze;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new Le({value:[new U({name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Tt.schema().valueBlock.value}),new U({name:t.subjectName||E,idBlock:{tagClass:3,tagNumber:1},value:st.schema().valueBlock.value})]}),st.schema({names:{blockName:t.issuer||E}}),M.schema(t.signature||{}),new H({name:t.serialNumber||E}),ps.schema(t.attrCertValidityPeriod||{}),new O({name:t.attributes||E,value:[new he({value:Be.schema()})]}),new we({optional:!0,name:t.issuerUniqueID||E}),ze.schema(t.extensions||{},!0)]})}fromSchema(e){X(e,Ov);const t=z(e,e,At.schema({names:{version:qu,baseCertificateID:Da,subjectName:Ta,issuer:Wu,signature:{names:{blockName:Gu}},serialNumber:Xu,attrCertValidityPeriod:{names:{blockName:zu}},attributes:Yu,issuerUniqueID:Ra,extensions:{names:{blockName:La}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Da in t.result&&(this.baseCertificateID=new Tt({schema:new O({value:t.result.baseCertificateID.valueBlock.value})})),Ta in t.result&&(this.subjectName=new st({schema:new O({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new M({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ps({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new Be({schema:s})),Ra in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),La in t.result&&(this.extensions=new ze({schema:t.result.extensions}))}toSchema(){const e=new O({value:[new H({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new U({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new U({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new O({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}At.CLASS_NAME="AttributeCertificateInfoV1";const _u="acinfo",Qu="signatureAlgorithm",Zu="signatureValue",Pv=[_u,Zu,Qu];class Ws extends G{constructor(e={}){super(),this.acinfo=d(e,_u,Ws.defaultValues(_u)),this.signatureAlgorithm=d(e,Qu,Ws.defaultValues(Qu)),this.signatureValue=d(e,Zu,Ws.defaultValues(Zu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _u:return new At;case Qu:return new M;case Zu:return new we;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[At.schema(t.acinfo||{}),M.schema(t.signatureAlgorithm||{}),new we({name:t.signatureValue||E})]})}fromSchema(e){X(e,Pv);const t=z(e,e,Ws.schema({names:{acinfo:{names:{blockName:_u}},signatureAlgorithm:{names:{blockName:Qu}},signatureValue:Zu}}));q.assertSchema(t,this.className),this.acinfo=new At({schema:t.result.acinfo}),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new O({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}Ws.CLASS_NAME="AttributeCertificateV1";const ec="digestedObjectType",Ua="otherObjectTypeID",tc="digestAlgorithm",sc="objectDigest",Dv=[ec,Ua,tc,sc];class qt extends G{constructor(e={}){super(),this.digestedObjectType=d(e,ec,qt.defaultValues(ec)),Ua in e&&(this.otherObjectTypeID=d(e,Ua,qt.defaultValues(Ua))),this.digestAlgorithm=d(e,tc,qt.defaultValues(tc)),this.objectDigest=d(e,sc,qt.defaultValues(sc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ec:return new sl;case Ua:return new re;case tc:return new M;case sc:return new we;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new sl({name:t.digestedObjectType||E}),new re({optional:!0,name:t.otherObjectTypeID||E}),M.schema(t.digestAlgorithm||{}),new we({name:t.objectDigest||E})]})}fromSchema(e){X(e,Dv);const t=z(e,e,qt.schema({names:{digestedObjectType:ec,otherObjectTypeID:Ua,digestAlgorithm:{names:{blockName:tc}},objectDigest:sc}}));q.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,Ua in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new M({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new O({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}qt.CLASS_NAME="ObjectDigestInfo";const ja="issuerName",$a="baseCertificateID",Ka="objectDigestInfo",Tv=[ja,$a,Ka];class aa extends G{constructor(e={}){super(),ja in e&&(this.issuerName=d(e,ja,aa.defaultValues(ja))),$a in e&&(this.baseCertificateID=d(e,$a,aa.defaultValues($a))),Ka in e&&(this.objectDigestInfo=d(e,Ka,aa.defaultValues(Ka))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ja:return new st;case $a:return new Tt;case Ka:return new qt;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[st.schema({names:{blockName:t.issuerName}},!0),new U({optional:!0,name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Tt.schema().valueBlock.value}),new U({optional:!0,name:t.objectDigestInfo||E,idBlock:{tagClass:3,tagNumber:1},value:qt.schema().valueBlock.value})]})}fromSchema(e){X(e,Tv);const t=z(e,e,aa.schema({names:{issuerName:ja,baseCertificateID:$a,objectDigestInfo:Ka}}));q.assertSchema(t,this.className),ja in t.result&&(this.issuerName=new st({schema:t.result.issuerName})),$a in t.result&&(this.baseCertificateID=new Tt({schema:new O({value:t.result.baseCertificateID.valueBlock.value})})),Ka in t.result&&(this.objectDigestInfo=new qt({schema:new O({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new O;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new U({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new U({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}aa.CLASS_NAME="V2Form";const Ma="baseCertificateID",Ha="entityName",Fa="objectDigestInfo",Rv=[Ma,Ha,Fa];class Gs extends G{constructor(e={}){super(),Ma in e&&(this.baseCertificateID=d(e,Ma,Gs.defaultValues(Ma))),Ha in e&&(this.entityName=d(e,Ha,Gs.defaultValues(Ha))),Fa in e&&(this.objectDigestInfo=d(e,Fa,Gs.defaultValues(Fa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ma:return new Tt;case Ha:return new st;case Fa:return new qt;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new U({optional:!0,name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Tt.schema().valueBlock.value}),new U({optional:!0,name:t.entityName||E,idBlock:{tagClass:3,tagNumber:1},value:st.schema().valueBlock.value}),new U({optional:!0,name:t.objectDigestInfo||E,idBlock:{tagClass:3,tagNumber:2},value:qt.schema().valueBlock.value})]})}fromSchema(e){X(e,Rv);const t=z(e,e,Gs.schema({names:{baseCertificateID:Ma,entityName:Ha,objectDigestInfo:Fa}}));q.assertSchema(t,this.className),Ma in t.result&&(this.baseCertificateID=new Tt({schema:new O({value:t.result.baseCertificateID.valueBlock.value})})),Ha in t.result&&(this.entityName=new st({schema:new O({value:t.result.entityName.valueBlock.value})})),Fa in t.result&&(this.objectDigestInfo=new qt({schema:new O({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new O;return this.baseCertificateID&&e.valueBlock.value.push(new U({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new U({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new U({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}Gs.CLASS_NAME="Holder";const rc="version",ac="holder",nc="issuer",ic="signature",oc="serialNumber",uc="attrCertValidityPeriod",cc="attributes",Ja="issuerUniqueID",qa="extensions",Lv=[rc,ac,nc,ic,oc,uc,cc,Ja,qa];class It extends G{constructor(e={}){super(),this.version=d(e,rc,It.defaultValues(rc)),this.holder=d(e,ac,It.defaultValues(ac)),this.issuer=d(e,nc,It.defaultValues(nc)),this.signature=d(e,ic,It.defaultValues(ic)),this.serialNumber=d(e,oc,It.defaultValues(oc)),this.attrCertValidityPeriod=d(e,uc,It.defaultValues(uc)),this.attributes=d(e,cc,It.defaultValues(cc)),Ja in e&&(this.issuerUniqueID=d(e,Ja,It.defaultValues(Ja))),qa in e&&(this.extensions=d(e,qa,It.defaultValues(qa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rc:return 1;case ac:return new Gs;case nc:return{};case ic:return new M;case oc:return new H;case uc:return new ps;case cc:return[];case Ja:return new we;case qa:return new ze;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),Gs.schema(t.holder||{}),new Le({value:[st.schema({names:{blockName:t.issuer||E}}),new U({name:t.issuer||E,idBlock:{tagClass:3,tagNumber:0},value:aa.schema().valueBlock.value})]}),M.schema(t.signature||{}),new H({name:t.serialNumber||E}),ps.schema(t.attrCertValidityPeriod||{}),new O({name:t.attributes||E,value:[new he({value:Be.schema()})]}),new we({optional:!0,name:t.issuerUniqueID||E}),ze.schema(t.extensions||{},!0)]})}fromSchema(e){X(e,Lv);const t=z(e,e,It.schema({names:{version:rc,holder:{names:{blockName:ac}},issuer:nc,signature:{names:{blockName:ic}},serialNumber:oc,attrCertValidityPeriod:{names:{blockName:uc}},attributes:cc,issuerUniqueID:Ja,extensions:{names:{blockName:qa}}}}));switch(q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new Gs({schema:t.result.holder}),t.result.issuer.idBlock.tagClass){case 3:this.issuer=new aa({schema:new O({value:t.result.issuer.valueBlock.value})});break;case 1:default:throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2")}this.signature=new M({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ps({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new Be({schema:s})),Ja in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),qa in t.result&&(this.extensions=new ze({schema:t.result.extensions}))}toSchema(){const e=new O({value:[new H({value:this.version}),this.holder.toSchema(),new U({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new O({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}It.CLASS_NAME="AttributeCertificateInfoV2";const lc="acinfo",hc="signatureAlgorithm",mc="signatureValue",Uv=[lc,hc,mc];class Wt extends G{constructor(e={}){super(),this.acinfo=d(e,lc,Wt.defaultValues(lc)),this.signatureAlgorithm=d(e,hc,Wt.defaultValues(hc)),this.signatureValue=d(e,mc,Wt.defaultValues(mc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lc:return new It;case hc:return new M;case mc:return new we;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[It.schema(t.acinfo||{}),M.schema(t.signatureAlgorithm||{}),new we({name:t.signatureValue||E})]})}fromSchema(e){X(e,Uv);const t=z(e,e,Wt.schema({names:{acinfo:{names:{blockName:lc}},signatureAlgorithm:{names:{blockName:hc}},signatureValue:mc}}));q.assertSchema(t,this.className),this.acinfo=new It({schema:t.result.acinfo}),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new O({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}Wt.CLASS_NAME="AttributeCertificateV2";const Wa="contentType",ni="content",jv=[Wa,ni];class Ce extends G{constructor(e={}){super(),this.contentType=d(e,Wa,Ce.defaultValues(Wa)),this.content=d(e,ni,Ce.defaultValues(ni)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wa:return E;case ni:return new ue;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wa:return typeof t=="string"&&t===this.defaultValues(Wa);case ni:return t instanceof ue;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return"optional"in t||(t.optional=!1),new O({name:t.blockName||"ContentInfo",optional:t.optional,value:[new re({name:t.contentType||Wa}),new U({idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.content||ni})]})]})}fromSchema(e){X(e,jv);const t=z(e,e,Ce.schema());q.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new O({value:[new re({value:this.contentType}),new U({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof ue||(e.content=this.content.toJSON()),e}}Ce.CLASS_NAME="ContentInfo",Ce.DATA=rp,Ce.SIGNED_DATA=Hg,Ce.ENVELOPED_DATA=Fg,Ce.ENCRYPTED_DATA=Jg;const $m="type",Km="value",vf="utcTimeName",bf="generalTimeName",$v=[vf,bf];var Ud;(function(r){r[r.UTCTime=0]="UTCTime",r[r.GeneralizedTime=1]="GeneralizedTime",r[r.empty=2]="empty"})(Ud||(Ud={}));class We extends G{constructor(e={}){super(),this.type=d(e,$m,We.defaultValues($m)),this.value=d(e,Km,We.defaultValues(Km)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $m:return 0;case Km:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,"names",{});return new Le({optional:t,value:[new uf({name:s.utcTimeName||E}),new Ue({name:s.generalTimeName||E})]})}fromSchema(e){X(e,$v);const t=z(e,e,We.schema({names:{utcTimeName:vf,generalTimeName:bf}}));q.assertSchema(t,this.className),vf in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),bf in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return this.type===0?new uf({valueDate:this.value}):this.type===1?new Ue({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}We.CLASS_NAME="Time";const Mm="tbs",Vr="version",zl="serialNumber",Yl="signature",_l="issuer",Ql="notBefore",Zl="notAfter",eh="subject",th="subjectPublicKeyInfo",fc="issuerUniqueID",pc="subjectUniqueID",dc="extensions",gc="signatureAlgorithm",wc="signatureValue",Gt="tbsCertificate",Rh=`${Gt}.${Vr}`,ap=`${Gt}.${zl}`,np=`${Gt}.${Yl}`,ip=`${Gt}.${_l}`,Lh=`${Gt}.${Ql}`,Uh=`${Gt}.${Zl}`,op=`${Gt}.${eh}`,up=`${Gt}.${th}`,jh=`${Gt}.${fc}`,$h=`${Gt}.${pc}`,_c=`${Gt}.${dc}`,Kv=[Gt,Rh,ap,np,ip,Lh,Uh,op,up,jh,$h,_c,gc,wc];function Mv(r={}){const e=d(r,"names",{});return new O({name:e.blockName||Gt,value:[new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:e.tbsCertificateVersion||Rh})]}),new H({name:e.tbsCertificateSerialNumber||ap}),M.schema(e.signature||{names:{blockName:np}}),Ne.schema(e.issuer||{names:{blockName:ip}}),new O({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[We.schema(e.notBefore||{names:{utcTimeName:Lh,generalTimeName:Lh}}),We.schema(e.notAfter||{names:{utcTimeName:Uh,generalTimeName:Uh}})]}),Ne.schema(e.subject||{names:{blockName:op}}),Rt.schema(e.subjectPublicKeyInfo||{names:{blockName:up}}),new oe({name:e.tbsCertificateIssuerUniqueID||jh,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new oe({name:e.tbsCertificateSubjectUniqueID||$h,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[ze.schema(e.extensions||{names:{blockName:_c}})]})]})}class ve extends G{get tbs(){return xe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,Mm,ve.defaultValues(Mm))),this.version=d(e,Vr,ve.defaultValues(Vr)),this.serialNumber=d(e,zl,ve.defaultValues(zl)),this.signature=d(e,Yl,ve.defaultValues(Yl)),this.issuer=d(e,_l,ve.defaultValues(_l)),this.notBefore=d(e,Ql,ve.defaultValues(Ql)),this.notAfter=d(e,Zl,ve.defaultValues(Zl)),this.subject=d(e,eh,ve.defaultValues(eh)),this.subjectPublicKeyInfo=d(e,th,ve.defaultValues(th)),fc in e&&(this.issuerUniqueID=d(e,fc,ve.defaultValues(fc))),pc in e&&(this.subjectUniqueID=d(e,pc,ve.defaultValues(pc))),dc in e&&(this.extensions=d(e,dc,ve.defaultValues(dc))),this.signatureAlgorithm=d(e,gc,ve.defaultValues(gc)),this.signatureValue=d(e,wc,ve.defaultValues(wc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mm:return Xe;case Vr:return 0;case zl:return new H;case Yl:return new M;case _l:return new Ne;case Ql:return new We;case Zl:return new We;case eh:return new Ne;case th:return new Rt;case fc:return Xe;case pc:return Xe;case dc:return[];case gc:return new M;case wc:return new we;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Mv(t.tbsCertificate),M.schema(t.signatureAlgorithm||{names:{blockName:gc}}),new we({name:t.signatureValue||wc})]})}fromSchema(e){X(e,Kv);const t=z(e,e,ve.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:_c}}}}}}));q.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,Rh in t.result&&(this.version=t.result[Rh].valueBlock.valueDec),this.serialNumber=t.result[ap],this.signature=new M({schema:t.result[np]}),this.issuer=new Ne({schema:t.result[ip]}),this.notBefore=new We({schema:t.result[Lh]}),this.notAfter=new We({schema:t.result[Uh]}),this.subject=new Ne({schema:t.result[op]}),this.subjectPublicKeyInfo=new Rt({schema:t.result[up]}),jh in t.result&&(this.issuerUniqueID=t.result[jh].valueBlock.valueHex),$h in t.result&&(this.subjectUniqueID=t.result[$h].valueBlock.valueHex),_c in t.result&&(this.extensions=Array.from(t.result[_c],s=>new Je({schema:s}))),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return Vr in this&&this.version!==ve.defaultValues(Vr)&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new O({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new oe({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new oe({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new O({value:Array.from(this.extensions,t=>t.toSchema())})]})),new O({value:e})}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return ve.schema().value[0];const s=Ge(this.tbsView);q.assert(s,"TBS Certificate"),t=s.result}else t=this.encodeTBS();return new O({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Vr in this&&this.version!==ve.defaultValues(Vr)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=Ae.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=Ae.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async getPublicKey(e,t=me(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=me(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",s=me(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new we({valueHex:i})}async verify(e,t=me(!0)){let s;if(e?s=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(s=this.subjectPublicKeyInfo),!(s instanceof Rt))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}ve.CLASS_NAME="Certificate";function Yg(r,e=null){if(e&&r.issuer.isEqual(e.issuer)&&r.serialNumber.isEqual(e.serialNumber))return null;let t=!1;if(r.extensions){for(const s of r.extensions)if(s.extnID===Zf&&s.parsedValue instanceof kn&&s.parsedValue.cA){t=!0;break}}return t?r:null}const ii="certId",oi="certValue",Mn="parsedValue",Hv=[ii,oi];class Sn extends G{constructor(e={}){super(),this.certId=d(e,ii,Sn.defaultValues(ii)),this.certValue=d(e,oi,Sn.defaultValues(oi)),Mn in e&&(this.parsedValue=d(e,Mn,Sn.defaultValues(Mn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ii:return E;case oi:return new ue;case Mn:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ii:return t===E;case oi:return t instanceof ue;case Mn:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.id||"id"}),new U({idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.value||"value"})]})]})}fromSchema(e){X(e,Hv);const t=z(e,e,Sn.schema({names:{id:ii,value:oi}}));q.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const s=this.certValue.valueBlock.valueHexView;switch(this.certId){case yd:try{this.parsedValue=ve.fromBER(s)}catch{Wt.fromBER(s)}break;case vd:this.parsedValue=Wt.fromBER(s);break;case W1:default:throw new Error(`Incorrect CERT_ID value in CertBag: ${this.certId}`)}}toSchema(){return Mn in this&&("acinfo"in this.parsedValue?this.certId=vd:this.certId=yd,this.certValue=new Y({valueHex:this.parsedValue.toSchema().toBER(!1)})),new O({value:[new re({value:this.certId}),new U({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}Sn.CLASS_NAME="CertBag";const yc="userCertificate",ui="revocationDate",Ga="crlEntryExtensions",Fv=[yc,ui,Ga];class Nn extends G{constructor(e={}){super(),this.userCertificate=d(e,yc,Nn.defaultValues(yc)),this.revocationDate=d(e,ui,Nn.defaultValues(ui)),Ga in e&&(this.crlEntryExtensions=d(e,Ga,Nn.defaultValues(Ga))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yc:return new H;case ui:return new We;case Ga:return new ze;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.userCertificate||yc}),We.schema({names:{utcTimeName:t.revocationDate||ui,generalTimeName:t.revocationDate||ui}}),ze.schema({names:{blockName:t.crlEntryExtensions||Ga}},!0)]})}fromSchema(e){X(e,Fv);const t=z(e,e,Nn.schema());q.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new We({schema:t.result.revocationDate}),Ga in t.result&&(this.crlEntryExtensions=new ze({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new O({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}Nn.CLASS_NAME="RevokedCertificate";const Hm="tbs",Jo="version",Fm="signature",Jm="issuer",qm="thisUpdate",Il="nextUpdate",Vl="revokedCertificates",xl="crlExtensions",vc="signatureAlgorithm",bc="signatureValue",tr="tbsCertList",Kh=`${tr}.version`,cp=`${tr}.signature`,lp=`${tr}.issuer`,Mh=`${tr}.thisUpdate`,ll=`${tr}.nextUpdate`,Hh=`${tr}.revokedCertificates`,Fh=`${tr}.extensions`,Jv=[tr,Kh,cp,lp,Mh,ll,Hh,Fh,vc,bc];function qv(r={}){const e=d(r,"names",{});return new O({name:e.blockName||tr,value:[new H({optional:!0,name:e.tbsCertListVersion||Kh,value:2}),M.schema(e.signature||{names:{blockName:cp}}),Ne.schema(e.issuer||{names:{blockName:lp}}),We.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:Mh,generalTimeName:Mh}}),We.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:ll,generalTimeName:ll}},!0),new O({optional:!0,value:[new he({name:e.tbsCertListRevokedCertificates||Hh,value:new O({value:[new H,We.schema(),ze.schema({},!0)]})})]}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ze.schema(e.crlExtensions||{names:{blockName:Fh}})]})]})}const Wv=[tp,Tg,D1,T1,Rg,ep,sp,R1,L1,Lg];class Qe extends G{get tbs(){return xe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,Hm,Qe.defaultValues(Hm))),this.version=d(e,Jo,Qe.defaultValues(Jo)),this.signature=d(e,Fm,Qe.defaultValues(Fm)),this.issuer=d(e,Jm,Qe.defaultValues(Jm)),this.thisUpdate=d(e,qm,Qe.defaultValues(qm)),Il in e&&(this.nextUpdate=d(e,Il,Qe.defaultValues(Il))),Vl in e&&(this.revokedCertificates=d(e,Vl,Qe.defaultValues(Vl))),xl in e&&(this.crlExtensions=d(e,xl,Qe.defaultValues(xl))),this.signatureAlgorithm=d(e,vc,Qe.defaultValues(vc)),this.signatureValue=d(e,bc,Qe.defaultValues(bc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hm:return Xe;case Jo:return 0;case Fm:return new M;case Jm:return new Ne;case qm:return new We;case Il:return new We;case Vl:return[];case xl:return new ze;case vc:return new M;case bc:return new we;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||"CertificateList",value:[qv(e),M.schema(t.signatureAlgorithm||{names:{blockName:vc}}),new we({name:t.signatureValue||bc})]})}fromSchema(e){X(e,Jv);const t=z(e,e,Qe.schema());q.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,Kh in t.result&&(this.version=t.result[Kh].valueBlock.valueDec),this.signature=new M({schema:t.result[cp]}),this.issuer=new Ne({schema:t.result[lp]}),this.thisUpdate=new We({schema:t.result[Mh]}),ll in t.result&&(this.nextUpdate=new We({schema:t.result[ll]})),Hh in t.result&&(this.revokedCertificates=Array.from(t.result[Hh],s=>new Nn({schema:s}))),Fh in t.result&&(this.crlExtensions=new ze({schema:t.result[Fh]})),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==Qe.defaultValues(Jo)&&e.push(new H({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new O({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new O({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return Qe.schema();const s=Ge(this.tbsView);q.assert(s,"TBS Certificate Revocation List"),t=s.result}return new O({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==Qe.defaultValues(Jo)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",s=me(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),{parameters:n}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new we({valueHex:i})}async verify(e={},t=me(!0)){let s;if(e.issuerCertificate&&(s=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(s=e.publicKeyInfo),!s)throw new Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(const a of this.crlExtensions.extensions)if(a.critical&&!Wv.includes(a.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}Qe.CLASS_NAME="CertificateRevocationList";const ci="crlId",li="crlValue",qo="parsedValue",Gv=[ci,li];class En extends G{constructor(e={}){super(),this.crlId=d(e,ci,En.defaultValues(ci)),this.crlValue=d(e,li,En.defaultValues(li)),qo in e&&(this.parsedValue=d(e,qo,En.defaultValues(qo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ci:return E;case li:return new ue;case qo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ci:return t===E;case li:return t instanceof ue;case qo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.id||"id"}),new U({idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.value||"value"})]})]})}fromSchema(e){X(e,Gv);const t=z(e,e,En.schema({names:{id:ci,value:li}}));switch(q.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId){case bd:this.parsedValue=Qe.fromBER(this.certValue.valueBlock.valueHex);break;default:throw new Error(`Incorrect CRL_ID value in CRLBag: ${this.crlId}`)}}toSchema(){return this.parsedValue&&(this.crlId=bd,this.crlValue=new Y({valueHex:this.parsedValue.toSchema().toBER(!1)})),new O({value:[new re({value:this.crlId}),new U({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}En.CLASS_NAME="CRLBag";const hi="version",mi="encryptedContentInfo",xr="unprotectedAttrs",Xv=[hi,mi,xr];class Ns extends G{constructor(e={}){super(),this.version=d(e,hi,Ns.defaultValues(hi)),this.encryptedContentInfo=d(e,mi,Ns.defaultValues(mi)),xr in e&&(this.unprotectedAttrs=d(e,xr,Ns.defaultValues(xr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hi:return 0;case mi:return new Fe;case xr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hi:return t===0;case mi:return Fe.compareWithDefault("contentType",t.contentType)&&Fe.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Fe.compareWithDefault("encryptedContent",t.encryptedContent);case xr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),Fe.schema(t.encryptedContentInfo||{}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new he({name:t.unprotectedAttrs||E,value:Be.schema()})]})]})}fromSchema(e){X(e,Xv);const t=z(e,e,Ns.schema({names:{version:hi,encryptedContentInfo:{names:{blockName:mi}},unprotectedAttrs:xr}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new Fe({schema:t.result.encryptedContentInfo}),xr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new Be({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}async encrypt(e,t=me(!0)){Se.assert(e,"parameters","object");const s={...e,contentType:"1.2.840.113549.1.7.1"};this.encryptedContentInfo=await t.encryptEncryptedContentInfo(s)}async decrypt(e,t=me(!0)){Se.assert(e,"parameters","object");const s={...e,encryptedContentInfo:this.encryptedContentInfo};return t.decryptEncryptedContentInfo(s)}}Ns.CLASS_NAME="EncryptedData";const Xa="encryptionAlgorithm",Br="encryptedData",Wo="parsedValue",zv=[Xa,Br];class Qr extends G{constructor(e={}){super(),this.encryptionAlgorithm=d(e,Xa,Qr.defaultValues(Xa)),this.encryptedData=d(e,Br,Qr.defaultValues(Br)),Wo in e&&(this.parsedValue=d(e,Wo,Qr.defaultValues(Wo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xa:return new M;case Br:return new Y;case Wo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Xa:return M.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Br:return t.isEqual(Qr.defaultValues(e));case Wo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.encryptionAlgorithm||{names:{blockName:Xa}}),new Le({value:[new Y({name:t.encryptedData||Br}),new Y({idBlock:{isConstructed:!0},name:t.encryptedData||Br})]})]})}fromSchema(e){X(e,zv);const t=z(e,e,Qr.schema({names:{encryptionAlgorithm:{names:{blockName:Xa}},encryptedData:Br}}));q.assertSchema(t,this.className),this.encryptionAlgorithm=new M({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new O({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=me(!0)){const s=await new Ns({encryptedContentInfo:new Fe({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}).decrypt(e,t);this.parsedValue=Zt.fromBER(s)}async makeInternalValues(e,t=me(!0)){if(!this.parsedValue)throw new Error('Please initialize "parsedValue" first');const s=new Ns,a={...e,contentToEncrypt:this.parsedValue.toSchema().toBER(!1)};if(await s.encrypt(a,t),!s.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=s.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=s.encryptedContentInfo.encryptedContent}}Qr.CLASS_NAME="PKCS8ShroudedKeyBag";const fi="secretTypeId",pi="secretValue",Yv=[fi,pi];class Eo extends G{constructor(e={}){super(),this.secretTypeId=d(e,fi,Eo.defaultValues(fi)),this.secretValue=d(e,pi,Eo.defaultValues(pi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fi:return E;case pi:return new ue;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fi:return t===E;case pi:return t instanceof ue;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.id||"id"}),new U({idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.value||"value"})]})]})}fromSchema(e){X(e,Yv);const t=z(e,e,Eo.schema({names:{id:fi,value:pi}}));q.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new O({value:[new re({value:this.secretTypeId}),new U({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}Eo.CLASS_NAME="SecretBag";class Yr{static getItems(){return this.items||(this.items={},Yr.register("1.2.840.113549.1.12.10.1.1",Zt),Yr.register("1.2.840.113549.1.12.10.1.2",Qr),Yr.register("1.2.840.113549.1.12.10.1.3",Sn),Yr.register("1.2.840.113549.1.12.10.1.4",En),Yr.register("1.2.840.113549.1.12.10.1.5",Eo),Yr.register("1.2.840.113549.1.12.10.1.6",Xs)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}const za="bagId",Ya="bagValue",Ls="bagAttributes",_v=[za,Ya,Ls];class na extends G{constructor(e={}){super(),this.bagId=d(e,za,na.defaultValues(za)),this.bagValue=d(e,Ya,na.defaultValues(Ya)),Ls in e&&(this.bagAttributes=d(e,Ls,na.defaultValues(Ls))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case za:return E;case Ya:return new ue;case Ls:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case za:return t===E;case Ya:return t instanceof ue;case Ls:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.bagId||za}),new U({idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.bagValue||Ya})]}),new tt({optional:!0,value:[new he({name:t.bagAttributes||Ls,value:Be.schema()})]})]})}fromSchema(e){X(e,_v);const t=z(e,e,na.schema({names:{bagId:za,bagValue:Ya,bagAttributes:Ls}}));q.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const s=Yr.find(this.bagId);if(!s)throw new Error(`Invalid BAG_ID for SafeBag: ${this.bagId}`);this.bagValue=new s({schema:t.result.bagValue}),Ls in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new Be({schema:a})))}toSchema(){const e=[new re({value:this.bagId}),new U({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new tt({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}na.CLASS_NAME="SafeBag";const Hn="safeBags";class Xs extends G{constructor(e={}){super(),this.safeBags=d(e,Hn,Xs.defaultValues(Hn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Hn:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.safeBags||E,value:na.schema()})]})}fromSchema(e){X(e,[Hn]);const t=z(e,e,Xs.schema({names:{safeBags:Hn}}));q.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,s=>new na({schema:s}))}toSchema(){return new O({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}Xs.CLASS_NAME="SafeContents";const Ac="otherCertFormat",Sc="otherCert",Qv=[Ac,Sc];class ca extends G{constructor(e={}){super(),this.otherCertFormat=d(e,Ac,ca.defaultValues(Ac)),this.otherCert=d(e,Sc,ca.defaultValues(Sc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ac:return E;case Sc:return new ue;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.otherCertFormat||Ac}),new ue({name:t.otherCert||Sc})]})}fromSchema(e){X(e,Qv);const t=z(e,e,ca.schema());q.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new O({value:[new re({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof ue||(e.otherCert=this.otherCert.toJSON()),e}}const Nc="certificates",Zv=[Nc];class Cs extends G{constructor(e={}){super(),this.certificates=d(e,Nc,Cs.defaultValues(Nc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nc:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new tt({name:t.blockName||E,value:[new he({name:t.certificates||Nc,value:new Le({value:[ve.schema(),new U({idBlock:{tagClass:3,tagNumber:0},value:[new ue]}),new U({idBlock:{tagClass:3,tagNumber:1},value:[new O]}),new U({idBlock:{tagClass:3,tagNumber:2},value:Wt.schema().valueBlock.value}),new U({idBlock:{tagClass:3,tagNumber:3},value:ca.schema().valueBlock.value})]})})]})}fromSchema(e){X(e,Zv);const t=z(e,e,Cs.schema());q.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],s=>{const a=s.idBlock.tagNumber;if(s.idBlock.tagClass===1)return new ve({schema:s});const n=new O({value:s.valueBlock.value});switch(a){case 1:return n.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec===1?new Wt({schema:n}):new Ws({schema:n});case 2:return new Wt({schema:n});case 3:return new ca({schema:n})}return s})}toSchema(){return new tt({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof ve:return e.toSchema();case e instanceof Ws:return new U({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof Wt:return new U({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof ca:return new U({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}Cs.CLASS_NAME="CertificateSet";const Ec="otherRevInfoFormat",Cc="otherRevInfo",eb=[Ec,Cc];class _s extends G{constructor(e={}){super(),this.otherRevInfoFormat=d(e,Ec,_s.defaultValues(Ec)),this.otherRevInfo=d(e,Cc,_s.defaultValues(Cc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ec:return E;case Cc:return new ue;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.otherRevInfoFormat||Ec}),new ue({name:t.otherRevInfo||Cc})]})}fromSchema(e){X(e,eb);const t=z(e,e,_s.schema());q.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new O({value:[new re({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof ue||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}_s.CLASS_NAME="OtherRevocationInfoFormat";const kc="crls",Wm="otherRevocationInfos",tb=[kc];class Qs extends G{constructor(e={}){super(),this.crls=d(e,kc,Qs.defaultValues(kc)),this.otherRevocationInfos=d(e,Wm,Qs.defaultValues(Wm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kc:return[];case Wm:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new tt({name:t.blockName||E,value:[new he({name:t.crls||E,value:new Le({value:[Qe.schema(),new U({idBlock:{tagClass:3,tagNumber:1},value:[new re,new ue]})]})})]})}fromSchema(e){X(e,tb);const t=z(e,e,Qs.schema({names:{crls:kc}}));if(q.assertSchema(t,this.className),t.result.crls)for(const s of t.result.crls)s.idBlock.tagClass===1?this.crls.push(new Qe({schema:s})):this.otherRevocationInfos.push(new _s({schema:s}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const s=t.toSchema();return s.idBlock.tagClass=3,s.idBlock.tagNumber=1,s})),new tt({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}Qs.CLASS_NAME="RevocationInfoChoices";const Ic="certs",_a="crls",sb=[Ic,_a];class Dn extends G{constructor(e={}){super(),this.crls=d(e,_a,Dn.defaultValues(_a)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ic:return new Cs;case _a:return new Qs;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ic:return t.certificates.length===0;case _a:return t.crls.length===0&&t.otherRevocationInfos.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new U({name:t.certs||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Cs.schema().valueBlock.value}),new U({name:t.crls||E,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Qs.schema().valueBlock.value})]})}fromSchema(e){X(e,sb);const t=z(e,e,Dn.schema({names:{certs:Ic,crls:_a}}));q.assertSchema(t,this.className),Ic in t.result&&(this.certs=new Cs({schema:new tt({value:t.result.certs.valueBlock.value})})),_a in t.result&&(this.crls=new Qs({schema:new tt({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new U({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new O({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}Dn.CLASS_NAME="OriginatorInfo";const Vc="issuer",xc="serialNumber",rb=[Vc,xc];class Ye extends G{constructor(e={}){super(),this.issuer=d(e,Vc,Ye.defaultValues(Vc)),this.serialNumber=d(e,xc,Ye.defaultValues(xc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vc:return new Ne;case xc:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Ne.schema(t.issuer||{}),new H({name:t.serialNumber||E})]})}fromSchema(e){X(e,rb);const t=z(e,e,Ye.schema({names:{issuer:{names:{blockName:Vc}},serialNumber:xc}}));q.assertSchema(t,this.className),this.issuer=new Ne({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new O({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}Ye.CLASS_NAME="IssuerAndSerialNumber";const Bl="variant",Go="value",ab=["blockName"];class Co extends G{constructor(e={}){super(),this.variant=d(e,Bl,Co.defaultValues(Bl)),Go in e&&(this.value=d(e,Go,Co.defaultValues(Go))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bl:return-1;case Go:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bl:return t===-1;case Go:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Le({value:[Ye.schema({names:{blockName:t.blockName||E}}),new oe({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){X(e,ab);const t=z(e,e,Co.schema({names:{blockName:"blockName"}}));q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ye({schema:t.result.blockName})):(this.variant=2,this.value=new Y({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof Ye))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof Y))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new oe({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new ue}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&this.value&&(e.value=this.value.toJSON()),e}}Co.CLASS_NAME="RecipientIdentifier";const Qa="version",di="rid",gi="keyEncryptionAlgorithm",wi="encryptedKey",Ol="recipientCertificate",nb=[Qa,di,gi,wi];class Mt extends G{constructor(e={}){super(),this.version=d(e,Qa,Mt.defaultValues(Qa)),this.rid=d(e,di,Mt.defaultValues(di)),this.keyEncryptionAlgorithm=d(e,gi,Mt.defaultValues(gi)),this.encryptedKey=d(e,wi,Mt.defaultValues(wi)),this.recipientCertificate=d(e,Ol,Mt.defaultValues(Ol)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qa:return-1;case di:return{};case gi:return new M;case wi:return new Y;case Ol:return new ve;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qa:return t===Mt.defaultValues(Qa);case di:return Object.keys(t).length===0;case gi:case wi:return t.isEqual(Mt.defaultValues(e));case Ol:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),Co.schema(t.rid||{}),M.schema(t.keyEncryptionAlgorithm||{}),new Y({name:t.encryptedKey||E})]})}fromSchema(e){X(e,nb);const t=z(e,e,Mt.schema({names:{version:Qa,rid:{names:{blockName:di}},keyEncryptionAlgorithm:{names:{blockName:gi}},encryptedKey:wi}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,t.result.rid.idBlock.tagClass===3?this.rid=new Y({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new Ye({schema:t.result.rid}),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof Ye?(this.version=0,e.push(new H({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new H({value:this.version})),e.push(new oe({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new O({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Mt.CLASS_NAME="KeyTransRecipientInfo";const yi="algorithm",vi="publicKey",ib=[yi,vi];class zs extends G{constructor(e={}){super(),this.algorithm=d(e,yi,zs.defaultValues(yi)),this.publicKey=d(e,vi,zs.defaultValues(vi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yi:return new M;case vi:return new we;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case yi:case vi:return t.isEqual(zs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.algorithm||{}),new we({name:t.publicKey||E})]})}fromSchema(e){X(e,ib);const t=z(e,e,zs.schema({names:{algorithm:{names:{blockName:yi}},publicKey:vi}}));q.assertSchema(t,this.className),this.algorithm=new M({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new O({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}zs.CLASS_NAME="OriginatorPublicKey";const Pl="variant",Xo="value",ob=["blockName"];class Zs extends G{constructor(e={}){super(),this.variant=d(e,Pl,Zs.defaultValues(Pl)),Xo in e&&(this.value=d(e,Xo,Zs.defaultValues(Xo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pl:return-1;case Xo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pl:return t===-1;case Xo:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Le({value:[Ye.schema({names:{blockName:t.blockName||E}}),new oe({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||E}),new U({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||E,value:zs.schema().valueBlock.value})]})}fromSchema(e){X(e,ob);const t=z(e,e,Zs.schema({names:{blockName:"blockName"}}));q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ye({schema:t.result.blockName})):t.result.blockName.idBlock.tagNumber===0?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new zs({schema:new O({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new ue}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2||this.variant===3)&&(e.value=this.value.toJSON()),e}}Zs.CLASS_NAME="OriginatorIdentifierOrKey";const bi="keyAttrId",vs="keyAttr",ub=[bi,vs];class ds extends G{constructor(e={}){super(),this.keyAttrId=d(e,bi,ds.defaultValues(bi)),vs in e&&(this.keyAttr=d(e,vs,ds.defaultValues(vs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bi:return E;case vs:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bi:return typeof t=="string"&&t===E;case vs:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({optional:t.optional||!0,name:t.blockName||E,value:[new re({name:t.keyAttrId||E}),new ue({optional:!0,name:t.keyAttr||E})]})}fromSchema(e){X(e,ub);const t=z(e,e,ds.schema({names:{keyAttrId:bi,keyAttr:vs}}));q.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),vs in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new re({value:this.keyAttrId})),vs in this&&e.push(this.keyAttr),new O({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return vs in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}ds.CLASS_NAME="OtherKeyAttribute";const Za="subjectKeyIdentifier",Or="date",Pr="other",cb=[Za,Or,Pr];class As extends G{constructor(e={}){super(),this.subjectKeyIdentifier=d(e,Za,As.defaultValues(Za)),Or in e&&(this.date=d(e,Or,As.defaultValues(Or))),Pr in e&&(this.other=d(e,Pr,As.defaultValues(Pr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Za:return new Y;case Or:return new Ue;case Pr:return new ds;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Za:return t.isEqual(As.defaultValues(Za));case Or:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Pr:return t.keyAttrId===E&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new Y({name:t.subjectKeyIdentifier||E}),new Ue({optional:!0,name:t.date||E}),ds.schema(t.other||{})]})}fromSchema(e){X(e,cb);const t=z(e,e,As.schema({names:{subjectKeyIdentifier:Za,date:Or,other:{names:{blockName:Pr}}}}));q.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,Or in t.result&&(this.date=t.result.date),Pr in t.result&&(this.other=new ds({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new O({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}As.CLASS_NAME="RecipientKeyIdentifier";const Dl="variant",Tl="value",lb=["blockName"];class ks extends G{constructor(e={}){super(),this.variant=d(e,Dl,ks.defaultValues(Dl)),this.value=d(e,Tl,ks.defaultValues(Tl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Dl:return-1;case Tl:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Dl:return t===-1;case Tl:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Le({value:[Ye.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||E}}),new U({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:0},value:As.schema(t.rKeyId||{names:{blockName:t.blockName||E}}).valueBlock.value})]})}fromSchema(e){X(e,lb);const t=z(e,e,ks.schema({names:{blockName:"blockName"}}));q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ye({schema:t.result.blockName})):(this.variant=2,this.value=new As({schema:new O({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new U({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new ue}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&(e.value=this.value.toJSON()),e}}ks.CLASS_NAME="KeyAgreeRecipientIdentifier";const Ai="rid",en="encryptedKey",hb=[Ai,en];class Ys extends G{constructor(e={}){super(),this.rid=d(e,Ai,Ys.defaultValues(Ai)),this.encryptedKey=d(e,en,Ys.defaultValues(en)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ai:return new ks;case en:return new Y;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ai:return t.variant===-1&&!("value"in t);case en:return t.isEqual(Ys.defaultValues(en));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[ks.schema(t.rid||{}),new Y({name:t.encryptedKey||E})]})}fromSchema(e){X(e,hb);const t=z(e,e,Ys.schema({names:{rid:{names:{blockName:Ai}},encryptedKey:en}}));q.assertSchema(t,this.className),this.rid=new ks({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new O({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Ys.CLASS_NAME="RecipientEncryptedKey";const Rl="encryptedKeys",_g="RecipientEncryptedKeys",mb=[_g];class la extends G{constructor(e={}){super(),this.encryptedKeys=d(e,Rl,la.defaultValues(Rl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rl:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Rl:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.RecipientEncryptedKeys||E,value:Ys.schema()})]})}fromSchema(e){X(e,mb);const t=z(e,e,la.schema({names:{RecipientEncryptedKeys:_g}}));q.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,s=>new Ys({schema:s}))}toSchema(){return new O({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}la.CLASS_NAME="RecipientEncryptedKeys";const Si="version",Ni="originator",Us="ukm",Ei="keyEncryptionAlgorithm",Ci="recipientEncryptedKeys",Ll="recipientCertificate",Ul="recipientPublicKey",fb=[Si,Ni,Us,Ei,Ci];class Ut extends G{constructor(e={}){super(),this.version=d(e,Si,Ut.defaultValues(Si)),this.originator=d(e,Ni,Ut.defaultValues(Ni)),Us in e&&(this.ukm=d(e,Us,Ut.defaultValues(Us))),this.keyEncryptionAlgorithm=d(e,Ei,Ut.defaultValues(Ei)),this.recipientEncryptedKeys=d(e,Ci,Ut.defaultValues(Ci)),this.recipientCertificate=d(e,Ll,Ut.defaultValues(Ll)),this.recipientPublicKey=d(e,Ul,Ut.defaultValues(Ul)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Si:return 0;case Ni:return new Zs;case Us:return new Y;case Ei:return new M;case Ci:return new la;case Ll:return new ve;case Ul:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Si:return t===0;case Ni:return t.variant===-1&&!("value"in t);case Us:return t.isEqual(Ut.defaultValues(Us));case Ei:return t.algorithmId===E&&!("algorithmParams"in t);case Ci:return t.encryptedKeys.length===0;case Ll:return!1;case Ul:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new U({idBlock:{tagClass:3,tagNumber:0},value:[Zs.schema(t.originator||{})]}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Y({name:t.ukm||E})]}),M.schema(t.keyEncryptionAlgorithm||{}),la.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){X(e,fb);const t=z(e,e,Ut.schema({names:{version:Si,originator:{names:{blockName:Ni}},ukm:Us,keyEncryptionAlgorithm:{names:{blockName:Ei}},recipientEncryptedKeys:{names:{blockName:Ci}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new Zs({schema:t.result.originator}),Us in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new la({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new O({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}Ut.CLASS_NAME="KeyAgreeRecipientInfo";const tn="keyIdentifier",Dr="date",Tr="other",pb=[tn,Dr,Tr];class ms extends G{constructor(e={}){super(),this.keyIdentifier=d(e,tn,ms.defaultValues(tn)),Dr in e&&(this.date=d(e,Dr,ms.defaultValues(Dr))),Tr in e&&(this.other=d(e,Tr,ms.defaultValues(Tr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tn:return new Y;case Dr:return new Ue;case Tr:return new ds;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case tn:return t.isEqual(ms.defaultValues(tn));case Dr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Tr:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new Y({name:t.keyIdentifier||E}),new Ue({optional:!0,name:t.date||E}),ds.schema(t.other||{})]})}fromSchema(e){X(e,pb);const t=z(e,e,ms.schema({names:{keyIdentifier:tn,date:Dr,other:{names:{blockName:Tr}}}}));q.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,Dr in t.result&&(this.date=t.result.date),Tr in t.result&&(this.other=new ds({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new O({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}ms.CLASS_NAME="KEKIdentifier";const ki="version",Ii="kekid",Vi="keyEncryptionAlgorithm",sn="encryptedKey",jl="preDefinedKEK",db=[ki,Ii,Vi,sn];class Ht extends G{constructor(e={}){super(),this.version=d(e,ki,Ht.defaultValues(ki)),this.kekid=d(e,Ii,Ht.defaultValues(Ii)),this.keyEncryptionAlgorithm=d(e,Vi,Ht.defaultValues(Vi)),this.encryptedKey=d(e,sn,Ht.defaultValues(sn)),this.preDefinedKEK=d(e,jl,Ht.defaultValues(jl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ki:return 0;case Ii:return new ms;case Vi:return new M;case sn:return new Y;case jl:return Xe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===Ht.defaultValues(ki);case Ii:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case Vi:return t.algorithmId===E&&!("algorithmParams"in t);case sn:return t.isEqual(Ht.defaultValues(sn));case jl:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),ms.schema(t.kekid||{}),M.schema(t.keyEncryptionAlgorithm||{}),new Y({name:t.encryptedKey||E})]})}fromSchema(e){X(e,db);const t=z(e,e,Ht.schema({names:{version:ki,kekid:{names:{blockName:Ii}},keyEncryptionAlgorithm:{names:{blockName:Vi}},encryptedKey:sn}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new ms({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new O({value:[new H({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Ht.CLASS_NAME="KEKRecipientInfo";const xi="version",Rr="keyDerivationAlgorithm",Bi="keyEncryptionAlgorithm",rn="encryptedKey",$l="password",gb=[xi,Rr,Bi,rn];class Qt extends G{constructor(e={}){super(),this.version=d(e,xi,Qt.defaultValues(xi)),Rr in e&&(this.keyDerivationAlgorithm=d(e,Rr,Qt.defaultValues(Rr))),this.keyEncryptionAlgorithm=d(e,Bi,Qt.defaultValues(Bi)),this.encryptedKey=d(e,rn,Qt.defaultValues(rn)),this.password=d(e,$l,Qt.defaultValues($l)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xi:return-1;case Rr:return new M;case Bi:return new M;case rn:return new Y;case $l:return Xe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case xi:return t===-1;case Rr:case Bi:return t.algorithmId===E&&!("algorithmParams"in t);case rn:return t.isEqual(Qt.defaultValues(rn));case $l:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new U({name:t.keyDerivationAlgorithm||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:M.schema().valueBlock.value}),M.schema(t.keyEncryptionAlgorithm||{}),new Y({name:t.encryptedKey||E})]})}fromSchema(e){X(e,gb);const t=z(e,e,Qt.schema({names:{version:xi,keyDerivationAlgorithm:Rr,keyEncryptionAlgorithm:{names:{blockName:Bi}},encryptedKey:rn}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Rr in t.result&&(this.keyDerivationAlgorithm=new M({schema:new O({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new H({value:this.version})),this.keyDerivationAlgorithm&&e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new O({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}Qt.CLASS_NAME="PasswordRecipientInfo";const Oi="oriType",an="oriValue",wb=[Oi,an];class ia extends G{constructor(e={}){super(),this.oriType=d(e,Oi,ia.defaultValues(Oi)),this.oriValue=d(e,an,ia.defaultValues(an)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oi:return E;case an:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Oi:return t===E;case an:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.oriType||E}),new ue({name:t.oriValue||E})]})}fromSchema(e){X(e,wb);const t=z(e,e,ia.schema({names:{oriType:Oi,oriValue:an}}));q.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new O({value:[new re({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return ia.compareWithDefault(an,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}ia.CLASS_NAME="OtherRecipientInfo";const Kl="variant",zo="value",yb=["blockName"];class es extends G{constructor(e={}){super(),this.variant=d(e,Kl,es.defaultValues(Kl)),zo in e&&(this.value=d(e,zo,es.defaultValues(zo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Kl:return-1;case zo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Kl:return t===es.defaultValues(e);case zo:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Le({value:[Mt.schema({names:{blockName:t.blockName||E}}),new U({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:1},value:Ut.schema().valueBlock.value}),new U({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:2},value:Ht.schema().valueBlock.value}),new U({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:3},value:Qt.schema().valueBlock.value}),new U({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:4},value:ia.schema().valueBlock.value})]})}fromSchema(e){X(e,yb);const t=z(e,e,es.schema({names:{blockName:"blockName"}}));if(q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1)this.variant=1,this.value=new Mt({schema:t.result.blockName});else{const s=new O({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new Ut({schema:s});break;case 2:this.variant=3,this.value=new Ht({schema:s});break;case 3:this.variant=4,this.value=new Qt({schema:s});break;case 4:this.variant=5,this.value=new ia({schema:s});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){ye.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new ue}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}es.CLASS_NAME="RecipientInfo";const Lr="hashAlgorithm",Ur="maskGenAlgorithm",jr="pSourceAlgorithm",vb=[Lr,Ur,jr];class Vt extends G{constructor(e={}){super(),this.hashAlgorithm=d(e,Lr,Vt.defaultValues(Lr)),this.maskGenAlgorithm=d(e,Ur,Vt.defaultValues(Ur)),this.pSourceAlgorithm=d(e,jr,Vt.defaultValues(jr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Lr:return new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new et});case Ur:return new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new et}).toSchema()});case jr:return new M({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new Y({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new U({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[M.schema(t.hashAlgorithm||{})]}),new U({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[M.schema(t.maskGenAlgorithm||{})]}),new U({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[M.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){X(e,vb);const t=z(e,e,Vt.schema({names:{hashAlgorithm:{names:{blockName:Lr}},maskGenAlgorithm:{names:{blockName:Ur}},pSourceAlgorithm:{names:{blockName:jr}}}}));q.assertSchema(t,this.className),Lr in t.result&&(this.hashAlgorithm=new M({schema:t.result.hashAlgorithm})),Ur in t.result&&(this.maskGenAlgorithm=new M({schema:t.result.maskGenAlgorithm})),jr in t.result&&(this.pSourceAlgorithm=new M({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Vt.defaultValues(Lr))||e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Vt.defaultValues(Ur))||e.push(new U({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(Vt.defaultValues(jr))||e.push(new U({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new O({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Vt.defaultValues(Lr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Vt.defaultValues(Ur))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(Vt.defaultValues(jr))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}Vt.CLASS_NAME="RSAESOAEPParams";const Pi="keyInfo",$r="entityUInfo",Di="suppPubInfo",bb=[Pi,$r,Di];class Fs extends G{constructor(e={}){super(),this.keyInfo=d(e,Pi,Fs.defaultValues(Pi)),$r in e&&(this.entityUInfo=d(e,$r,Fs.defaultValues($r))),this.suppPubInfo=d(e,Di,Fs.defaultValues(Di)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pi:return new M;case $r:return new Y;case Di:return new Y;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pi:case $r:case Di:return t.isEqual(Fs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.keyInfo||{}),new U({name:t.entityUInfo||E,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new Y]}),new U({name:t.suppPubInfo||E,idBlock:{tagClass:3,tagNumber:2},value:[new Y]})]})}fromSchema(e){X(e,bb);const t=z(e,e,Fs.schema({names:{keyInfo:{names:{blockName:Pi}},entityUInfo:$r,suppPubInfo:Di}}));q.assertSchema(t,this.className),this.keyInfo=new M({schema:t.result.keyInfo}),$r in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new U({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new O({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}Fs.CLASS_NAME="ECCCMSSharedInfo";const Ti="version",Kr="originatorInfo",Ri="recipientInfos",Li="encryptedContentInfo",Mr="unprotectedAttrs",Ab=[Ti,Kr,Ri,Li,Mr],jd={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},Sb={"P-256":256,"P-384":384,"P-521":528};class ls extends G{constructor(e={}){super(),this.version=d(e,Ti,ls.defaultValues(Ti)),Kr in e&&(this.originatorInfo=d(e,Kr,ls.defaultValues(Kr))),this.recipientInfos=d(e,Ri,ls.defaultValues(Ri)),this.encryptedContentInfo=d(e,Li,ls.defaultValues(Li)),Mr in e&&(this.unprotectedAttrs=d(e,Mr,ls.defaultValues(Mr))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ti:return 0;case Kr:return new Dn;case Ri:return[];case Li:return new Fe;case Mr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ti:return t===ls.defaultValues(e);case Kr:return t.certs.certificates.length===0&&t.crls.crls.length===0;case Ri:case Mr:return t.length===0;case Li:return Fe.compareWithDefault("contentType",t.contentType)&&Fe.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Fe.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new U({name:t.originatorInfo||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Dn.schema().valueBlock.value}),new tt({value:[new he({name:t.recipientInfos||E,value:es.schema()})]}),Fe.schema(t.encryptedContentInfo||{}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new he({name:t.unprotectedAttrs||E,value:Be.schema()})]})]})}fromSchema(e){X(e,Ab);const t=z(e,e,ls.schema({names:{version:Ti,originatorInfo:Kr,recipientInfos:Ri,encryptedContentInfo:{names:{blockName:Li}},unprotectedAttrs:Mr}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Kr in t.result&&(this.originatorInfo=new Dn({schema:new O({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,s=>new es({schema:s})),this.encryptedContentInfo=new Fe({schema:t.result.encryptedContentInfo}),Mr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new Be({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),this.originatorInfo&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new tt({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,s,a=me(!0)){const n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},jd,t||{});if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549")!==-1)s=1;else if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045")!==-1)s=2;else throw new Error(`Unknown type of certificate's public key: ${e.subjectPublicKeyInfo.algorithm.algorithmId}`);switch(s){case 1:{let i,o;if(n.useOAEP===!0){i=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const u=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),c=new M({algorithmId:u,algorithmParams:new et});o=new Vt({hashAlgorithm:c,maskGenAlgorithm:new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:c.toSchema()})}).toSchema()}else{if(i=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),i===E)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");o=new et}const h=new Mt({version:0,rid:new Ye({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new M({algorithmId:i,algorithmParams:o}),recipientCertificate:e});this.recipientInfos.push(new es({variant:1,value:h}))}break;case 2:{const i=new ks({variant:1,value:new Ye({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(i,n,{recipientCertificate:e},a)}break;default:throw new Error(`Unknown "variant" value: ${s}`)}return!0}addRecipientByPreDefinedData(e,t={},s,a=me(!0)){if(Se.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const n=new ArrayBuffer(16),i=new Uint8Array(n);a.getRandomValues(i),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),t.iterationCount===void 0&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new et),s){case 1:{const n=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),i=new Ht({version:4,kekid:new ms({keyIdentifier:new Y({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new M({algorithmId:n,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new es({variant:3,value:i}))}break;case 2:{const n=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),i=new ArrayBuffer(64),o=new Uint8Array(i);a.getRandomValues(o);const h=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),u=new Nt({salt:new Y({valueHex:i}),iterationCount:t.iterationCount,prf:new M({algorithmId:h,algorithmParams:new et})}),c=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),f=new Qt({version:0,keyDerivationAlgorithm:new M({algorithmId:n,algorithmParams:u.toSchema()}),keyEncryptionAlgorithm:new M({algorithmId:c,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new es({variant:4,value:f}))}break;default:throw new Error(`Unknown value for "variant": ${s}`)}}addRecipientByKeyIdentifier(e,t,s,a=me(!0)){const n=Object.assign({},jd,s||{}),i=new ks({variant:2,value:new As({subjectKeyIdentifier:new Y({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,n,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,s,a=me(!0)){const n=new Ys({rid:e}),i=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),o=new M({algorithmId:i}),h=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),u=new ArrayBuffer(64),c=new Uint8Array(u);a.getRandomValues(c);const f={version:3,ukm:new Y({valueHex:u}),keyEncryptionAlgorithm:new M({algorithmId:h,algorithmParams:o.toSchema()}),recipientEncryptedKeys:new la({encryptedKeys:[n]})},m=new Ut(Object.assign(f,s));this.recipientInfos.push(new es({variant:2,value:m}))}async encrypt(e,t,s=me(!0)){const a=new ArrayBuffer(16),n=new Uint8Array(a);s.getRandomValues(n);const i=new Uint8Array(t),o=s.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),h=await s.generateKey(e,!0,["encrypt"]),u=await s.encrypt({name:e.name,iv:n},h,i),c=await s.exportKey("raw",h);this.version=2,this.encryptedContentInfo=new Fe({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new M({algorithmId:o,algorithmParams:new Y({valueHex:a})}),encryptedContent:new Y({valueHex:u})});const f=async v=>{const C=this.recipientInfos[v].value;let p,b;if(C.recipientPublicKey)p=C.recipientPublicKey.algorithm.namedCurve,b=C.recipientPublicKey;else if(C.recipientCertificate){const ne=C.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(ne.constructor.blockName()!==re.blockName())throw new Error(`Incorrect "recipientCertificate" for index ${v}`);switch(ne.valueBlock.toString()){case"1.2.840.10045.3.1.7":p="P-256";break;case"1.3.132.0.34":p="P-384";break;case"1.3.132.0.35":p="P-521";break;default:throw new Error(`Incorrect curve OID for index ${v}`)}b=await C.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:p},usages:[]}},s)}else throw new Error("Unsupported RecipientInfo");const k=Sb[p],P=await s.generateKey({name:"ECDH",namedCurve:p},!0,["deriveBits"]),x=await s.exportKey("spki",P.publicKey),T=await s.deriveBits({name:"ECDH",public:b},P.privateKey,k),B=new M({schema:C.keyEncryptionAlgorithm.algorithmParams}),V=s.getAlgorithmByOID(B.algorithmId,!0,"aesKWAlgorithm");let J=V.length;const F=new ArrayBuffer(4),D=new Uint8Array(F);for(let ne=3;ne>=0;ne--)D[ne]=J,J>>=8;const j=new Fs({keyInfo:new M({algorithmId:B.algorithmId}),entityUInfo:C.ukm,suppPubInfo:new Y({valueHex:F})}).toSchema().toBER(!1),ee=s.getAlgorithmByOID(C.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),_=await Cd(ee.kdf,T,V.length,j,s),ie=await s.importKey("raw",_,{name:"AES-KW"},!0,["wrapKey"]),ae=await s.wrapKey("raw",h,ie,{name:"AES-KW"}),pe=new Zs;return pe.variant=3,pe.value=zs.fromBER(x),C.originator=pe,C.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new Y({valueHex:ae}),{ecdhPrivateKey:P.privateKey}},m=async v=>{const C=this.recipientInfos[v].value,p=s.getAlgorithmByOID(C.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(p.name==="RSA-OAEP"){const b=C.keyEncryptionAlgorithm.algorithmParams,k=new Vt({schema:b});if(p.hash=s.getAlgorithmByOID(k.hashAlgorithm.algorithmId),!("name"in p.hash))throw new Error(`Incorrect OID for hash algorithm: ${k.hashAlgorithm.algorithmId}`)}try{const b=await C.recipientCertificate.getPublicKey({algorithm:{algorithm:p,usages:["encrypt","wrapKey"]}},s),k=await s.encrypt(b.algorithm,b,c);C.encryptedKey=new Y({valueHex:k})}catch{}},y=async v=>{const C=this.recipientInfos[v].value,p=s.getAlgorithmByOID(C.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),b=await s.importKey("raw",new Uint8Array(C.preDefinedKEK),p,!0,["wrapKey"]),k=await s.wrapKey("raw",h,b,p);C.encryptedKey=new Y({valueHex:k})},w=async v=>{const C=this.recipientInfos[v].value;let p;if(!C.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!C.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{p=new Nt({schema:C.keyDerivationAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const b=new Uint8Array(C.password),k=await s.importKey("raw",b,"PBKDF2",!1,["deriveKey"]),P=s.getAlgorithmByOID(C.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let x="SHA-1";p.prf&&(x=s.getAlgorithmByOID(p.prf.algorithmId,!0,"prfAlgorithm").hash.name);const T=new Uint8Array(p.salt.valueBlock.valueHex),B=p.iterationCount,V=await s.deriveKey({name:"PBKDF2",hash:{name:x},salt:T,iterations:B},k,P,!0,["wrapKey"]),J=await s.wrapKey("raw",h,V,P);C.encryptedKey=new Y({valueHex:J})},S=[];for(let v=0;v<this.recipientInfos.length;v++)switch(this.recipientInfos[v].variant){case 1:S.push(await m(v));break;case 2:S.push(await f(v));break;case 3:S.push(await y(v));break;case 4:S.push(await w(v));break;default:throw new Error(`Unknown recipient type in array with index ${v}`)}return S}async decrypt(e,t,s=me(!0)){const a=t||{};if(e+1>this.recipientInfos.length)throw new Error(`Maximum value for "index" is: ${this.recipientInfos.length-1}`);const n=async S=>{const v=this.recipientInfos[S].value;let C,p,b;const k=v.originator;if(a.recipientCertificate){const _=a.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(_.constructor.blockName()!==re.blockName())throw new Error(`Incorrect "recipientCertificate" for index ${S}`);C=_.valueBlock.toString()}else if(k.value.algorithm.algorithmParams){const _=k.value.algorithm.algorithmParams;if(_.constructor.blockName()!==re.blockName())throw new Error(`Incorrect originator for index ${S}`);C=_.valueBlock.toString()}else throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(C){case"1.2.840.10045.3.1.7":p="P-256",b=256;break;case"1.3.132.0.34":p="P-384",b=384;break;case"1.3.132.0.35":p="P-521",b=528;break;default:throw new Error(`Incorrect curve OID for index ${S}`)}let P,x=s;xe.isBufferSource(a.recipientPrivateKey)?P=await s.importKey("pkcs8",a.recipientPrivateKey,{name:"ECDH",namedCurve:p},!0,["deriveBits"]):(P=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(x=a.crypto.subtle)),"algorithmParams"in k.value.algorithm||(k.value.algorithm.algorithmParams=new re({value:C}));const T=k.value.toSchema().toBER(!1),B=await s.importKey("spki",T,{name:"ECDH",namedCurve:p},!0,[]),V=await x.deriveBits({name:"ECDH",public:B},P,b);async function J(_){_=_||!1;const ie=new M({schema:v.keyEncryptionAlgorithm.algorithmParams}),ae=s.getAlgorithmByOID(ie.algorithmId,!0,"kwAlgorithm");let pe=ae.length;const ne=new ArrayBuffer(4),se=new Uint8Array(ne);for(let fe=3;fe>=0;fe--)se[fe]=pe,pe>>=8;const te={algorithmId:ie.algorithmId};_&&(te.algorithmParams=new et);const Z=new Fs({keyInfo:new M(te),entityUInfo:v.ukm,suppPubInfo:new Y({valueHex:ne})}).toSchema().toBER(!1),ce=s.getAlgorithmByOID(v.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!ce.name)throw new Error(`Incorrect OID for key encryption algorithm: ${v.keyEncryptionAlgorithm.algorithmId}`);return Cd(ce.kdf,V,ae.length,Z,s)}const F=await J(),D=async _=>s.importKey("raw",_,{name:"AES-KW"},!0,["unwrapKey"]),j=await D(F),ee=async _=>{const ie=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,ae=s.getAlgorithmByOID(ie,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",v.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,_,{name:"AES-KW"},ae,!0,["decrypt"])};try{return await ee(j)}catch{const _=await J(!0),ie=await D(_);return ee(ie)}},i=async S=>{const v=this.recipientInfos[S].value;if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const C=s.getAlgorithmByOID(v.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(C.name==="RSA-OAEP"){const T=v.keyEncryptionAlgorithm.algorithmParams,B=new Vt({schema:T});if(C.hash=s.getAlgorithmByOID(B.hashAlgorithm.algorithmId),!("name"in C.hash))throw new Error(`Incorrect OID for hash algorithm: ${B.hashAlgorithm.algorithmId}`)}let p,b=s;xe.isBufferSource(a.recipientPrivateKey)?p=await s.importKey("pkcs8",a.recipientPrivateKey,C,!0,["decrypt"]):(p=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(b=a.crypto.subtle));const k=await b.decrypt(p.algorithm,p,v.encryptedKey.valueBlock.valueHexView),P=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,x=s.getAlgorithmByOID(P,!0,"contentEncryptionAlgorithm");if(!("name"in x))throw new Error(`Incorrect "contentEncryptionAlgorithm": ${P}`);return s.importKey("raw",k,x,!0,["decrypt"])},o=async S=>{const v=this.recipientInfos[S].value;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const C=s.getAlgorithmByOID(v.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),p=await s.importKey("raw",a.preDefinedData,C,!0,["unwrapKey"]),b=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,k=s.getAlgorithmByOID(b,!0,"contentEncryptionAlgorithm");if(!k.name)throw new Error(`Incorrect "contentEncryptionAlgorithm": ${b}`);return s.unwrapKey("raw",v.encryptedKey.valueBlock.valueHexView,p,C,k,!0,["decrypt"])},h=async S=>{const v=this.recipientInfos[S].value;let C;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!v.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!v.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{C=new Nt({schema:v.keyDerivationAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const p=await s.importKey("raw",a.preDefinedData,"PBKDF2",!1,["deriveKey"]),b=s.getAlgorithmByOID(v.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),k=C.prf?s.getAlgorithmByOID(C.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",P=new Uint8Array(C.salt.valueBlock.valueHex),x=C.iterationCount,T=await s.deriveKey({name:"PBKDF2",hash:{name:k},salt:P,iterations:x},p,b,!0,["unwrapKey"]),B=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,V=s.getAlgorithmByOID(B,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",v.encryptedKey.valueBlock.valueHexView,T,b,V,!0,["decrypt"])};let u;switch(this.recipientInfos[e].variant){case 1:u=await i(e);break;case 2:u=await n(e);break;case 3:u=await o(e);break;case 4:u=await h(e);break;default:throw new Error(`Unknown recipient type in array with index ${e}`)}const c=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,f=s.getAlgorithmByOID(c,!0,"contentEncryptionAlgorithm"),m=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,y=new Uint8Array(m);if(!this.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const w=this.encryptedContentInfo.getEncryptedContent();return s.decrypt({name:f.name,iv:y},u,w)}}ls.CLASS_NAME="EnvelopedData";const Fn="safeContents",Yo="parsedValue",$d="contentInfos";class Tn extends G{constructor(e={}){super(),this.safeContents=d(e,Fn,Tn.defaultValues(Fn)),Yo in e&&(this.parsedValue=d(e,Yo,Tn.defaultValues(Yo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fn:return[];case Yo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Fn:return t.length===0;case Yo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new he({name:t.contentInfos||E,value:Ce.schema()})]})}fromSchema(e){X(e,[$d]);const t=z(e,e,Tn.schema({names:{contentInfos:$d}}));q.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,s=>new Ce({schema:s}))}toSchema(){return new O({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=me(!0)){if(ye.assert(e,Fn),Se.assert(e.safeContents,Fn,"Array"),e.safeContents.length!==this.safeContents.length)throw new Se('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');this.parsedValue={safeContents:[]};for(const[s,a]of this.safeContents.entries()){const n=e.safeContents[s],i=`parameters.safeContents[${s}]`;switch(a.contentType){case rp:{Se.assert(a.content,"this.safeContents[j].content",Y);const o=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:Xs.fromBER(o)})}break;case Fg:{const o=new ls({schema:a.content});ye.assert(i,n,"recipientCertificate","recipientKey");const h=n,u=h.recipientCertificate,c=h.recipientKey,f=await o.decrypt(0,{recipientCertificate:u,recipientPrivateKey:c},t);this.parsedValue.safeContents.push({privacyMode:2,value:Xs.fromBER(f)})}break;case Jg:{const o=new Ns({schema:a.content});ye.assert(i,n,"password");const h=n.password,u=await o.decrypt({password:h},t);this.parsedValue.safeContents.push({privacyMode:1,value:Xs.fromBER(u)})}break;default:throw new Error(`Unknown "contentType" for AuthenticatedSafe: " ${a.contentType}`)}}}async makeInternalValues(e,t=me(!0)){if(!this.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(Se.assert(this.parsedValue,"this.parsedValue","object"),Se.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),Se.assert(e,"parameters","object"),ye.assert(e,"safeContents"),Se.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new Se('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');this.safeContents=[];for(const[s,a]of this.parsedValue.safeContents.entries())switch(ye.assert("content",a,"privacyMode","value"),Se.assert(a.value,"content.value",Xs),a.privacyMode){case 0:{const n=a.value.toSchema().toBER(!1);this.safeContents.push(new Ce({contentType:"1.2.840.113549.1.7.1",content:new Y({valueHex:n})}))}break;case 1:{const n=new Ns,i=e.safeContents[s];i.contentToEncrypt=a.value.toSchema().toBER(!1),await n.encrypt(i,t),this.safeContents.push(new Ce({contentType:"1.2.840.113549.1.7.6",content:n.toSchema()}))}break;case 2:{const n=new ls,i=a.value.toSchema().toBER(!1),o=e.safeContents[s];switch(ye.assert(`parameters.safeContents[${s}]`,o,"encryptingCertificate","encryptionAlgorithm"),!0){case o.encryptionAlgorithm.name.toLowerCase()==="aes-cbc":case o.encryptionAlgorithm.name.toLowerCase()==="aes-gcm":break;default:throw new Error(`Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": ${o.encryptionAlgorithm}`)}switch(!0){case o.encryptionAlgorithm.length===128:case o.encryptionAlgorithm.length===192:case o.encryptionAlgorithm.length===256:break;default:throw new Error(`Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": ${o.encryptionAlgorithm.length}`)}const h=o.encryptionAlgorithm;n.addRecipientByCertificate(o.encryptingCertificate,{},void 0,t),await n.encrypt(h,i,t),this.safeContents.push(new Ce({contentType:"1.2.840.113549.1.7.3",content:n.toSchema()}))}break;default:throw new Error(`Incorrect value for "content.privacyMode": ${a.privacyMode}`)}return this}}Tn.CLASS_NAME="AuthenticatedSafe";const nn="hashAlgorithm",Ui="issuerNameHash",ji="issuerKeyHash",on="serialNumber",Nb=[nn,Ui,ji,on];class qe extends G{static async create(e,t,s=me(!0)){const a=new qe;return await a.createForCertificate(e,t,s),a}constructor(e={}){super(),this.hashAlgorithm=d(e,nn,qe.defaultValues(nn)),this.issuerNameHash=d(e,Ui,qe.defaultValues(Ui)),this.issuerKeyHash=d(e,ji,qe.defaultValues(ji)),this.serialNumber=d(e,on,qe.defaultValues(on)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nn:return new M;case Ui:case ji:return new Y;case on:return new H;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nn:return t.algorithmId===E&&!("algorithmParams"in t);case Ui:case ji:case on:return t.isEqual(qe.defaultValues(on));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||E}}),new Y({name:t.issuerNameHash||E}),new Y({name:t.issuerKeyHash||E}),new H({name:t.serialNumber||E})]})}fromSchema(e){X(e,Nb);const t=z(e,e,qe.schema({names:{hashAlgorithm:nn,issuerNameHash:Ui,issuerKeyHash:ji,serialNumber:on}}));q.assertSchema(t,this.className),this.hashAlgorithm=new M({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new O({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!xe.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!xe.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,s=me(!0)){ye.assert(t,nn,"issuerCertificate");const a=s.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new M({algorithmId:a,algorithmParams:new et});const n=t.issuerCertificate;this.serialNumber=e.serialNumber;const i=await s.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1));this.issuerNameHash=new Y({valueHex:i});const o=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,h=await s.digest({name:t.hashAlgorithm},o);this.issuerKeyHash=new Y({valueHex:h})}}qe.CLASS_NAME="CertID";const $i="certID",Ki="certStatus",Mi="thisUpdate",Hr="nextUpdate",un="singleExtensions",Eb=[$i,Ki,Mi,Hr,un];class hs extends G{constructor(e={}){super(),this.certID=d(e,$i,hs.defaultValues($i)),this.certStatus=d(e,Ki,hs.defaultValues(Ki)),this.thisUpdate=d(e,Mi,hs.defaultValues(Mi)),Hr in e&&(this.nextUpdate=d(e,Hr,hs.defaultValues(Hr))),un in e&&(this.singleExtensions=d(e,un,hs.defaultValues(un))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $i:return new qe;case Ki:return{};case Mi:case Hr:return new Date(0,0,0);case un:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $i:return qe.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&qe.compareWithDefault("issuerNameHash",t.issuerNameHash)&&qe.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&qe.compareWithDefault("serialNumber",t.serialNumber);case Ki:return Object.keys(t).length===0;case Mi:case Hr:return t===hs.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[qe.schema(t.certID||{}),new Le({value:[new oe({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:0}}),new U({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:1},value:[new Ue,new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sl]})]}),new oe({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new Ue({name:t.thisUpdate||E}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ue({name:t.nextUpdate||E})]}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[ze.schema(t.singleExtensions||{})]})]})}fromSchema(e){X(e,Eb);const t=z(e,e,hs.schema({names:{certID:{names:{blockName:$i}},certStatus:Ki,thisUpdate:Mi,nextUpdate:Hr,singleExtensions:{names:{blockName:un}}}}));q.assertSchema(t,this.className),this.certID=new qe({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),Hr in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),un in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,s=>new Je({schema:s})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new Ue({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[new Ue({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new O({value:Array.from(this.singleExtensions,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}hs.CLASS_NAME="SingleResponse";const Ml="tbs",cn="version",Bc="responderID",Oc="producedAt",Pc="responses",Hi="responseExtensions",Ln="ResponseData",sh=`${Ln}.${cn}`,Fi=`${Ln}.${Bc}`,Af=`${Ln}.${Oc}`,Sf=`${Ln}.${Pc}`,rh=`${Ln}.${Hi}`,Cb=[Ln,sh,Fi,Af,Sf,rh];class nt extends G{get tbs(){return xe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,Ml,nt.defaultValues(Ml))),cn in e&&(this.version=d(e,cn,nt.defaultValues(cn))),this.responderID=d(e,Bc,nt.defaultValues(Bc)),this.producedAt=d(e,Oc,nt.defaultValues(Oc)),this.responses=d(e,Pc,nt.defaultValues(Pc)),Hi in e&&(this.responseExtensions=d(e,Hi,nt.defaultValues(Hi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cn:return 0;case Ml:return Xe;case Bc:return{};case Oc:return new Date(0,0,0);case Pc:case Hi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ml:return t.byteLength===0;case Bc:return Object.keys(t).length===0;case Oc:return t===nt.defaultValues(e);case Pc:case Hi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||Ln,value:[new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:t.version||sh})]}),new Le({value:[new U({name:t.responderID||Fi,idBlock:{tagClass:3,tagNumber:1},value:[Ne.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new U({name:t.responderID||Fi,idBlock:{tagClass:3,tagNumber:2},value:[new Y({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new Ue({name:t.producedAt||Af}),new O({value:[new he({name:Sf,value:hs.schema(t.response||{})})]}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[ze.schema(t.extensions||{names:{blockName:rh}})]})]})}fromSchema(e){X(e,Cb);const t=z(e,e,nt.schema());q.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,sh in t.result&&(this.version=t.result[sh].valueBlock.valueDec),t.result[Fi].idBlock.tagNumber===1?this.responderID=new Ne({schema:t.result[Fi].valueBlock.value[0]}):this.responderID=t.result[Fi].valueBlock.value[0],this.producedAt=t.result[Af].toDate(),this.responses=Array.from(t.result[Sf],s=>new hs({schema:s})),rh in t.result&&(this.responseExtensions=Array.from(t.result[rh].valueBlock.value,s=>new Je({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return nt.schema();const s=Ge(this.tbsView);q.assert(s,"TBS Response Data"),t=s.result}else{const s=[];cn in this&&s.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[new H({value:this.version})]})),this.responderID instanceof Ne?s.push(new U({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):s.push(new U({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),s.push(new Ue({valueDate:this.producedAt})),s.push(new O({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&s.push(new U({idBlock:{tagClass:3,tagNumber:1},value:[new O({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new O({value:s})}return t}toJSON(){const e={};return cn in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}nt.CLASS_NAME="ResponseData";const Gm="trustedCerts",Xm="certs",zm="crls",Ym="ocsps",_m="checkDate",Qm="findOrigin",Zm="findIssuer";var vn;(function(r){r[r.unknown=-1]="unknown",r[r.success=0]="success",r[r.noRevocation=11]="noRevocation",r[r.noPath=60]="noPath",r[r.noValidPath=97]="noValidPath"})(vn||(vn={}));class Zr extends Error{constructor(e,t){super(t),this.name=Zr.NAME,this.code=e,this.message=t}}Zr.NAME="ChainValidationError";function kb(r,e){for(let t=0;t<e.length;t++)if(xe.isEqual(r.tbsView,e[t].tbsView))return!0;return!1}class _h{constructor(e={}){this.trustedCerts=d(e,Gm,this.defaultValues(Gm)),this.certs=d(e,Xm,this.defaultValues(Xm)),this.crls=d(e,zm,this.defaultValues(zm)),this.ocsps=d(e,Ym,this.defaultValues(Ym)),this.checkDate=d(e,_m,this.defaultValues(_m)),this.findOrigin=d(e,Qm,this.defaultValues(Qm)),this.findIssuer=d(e,Zm,this.defaultValues(Zm))}static defaultFindOrigin(e,t){e.tbsView.byteLength===0&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));for(const s of t.certs)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),xe.isEqual(e.tbsView,s.tbsView))return"Intermediate Certificates";for(const s of t.trustedCerts)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),xe.isEqual(e.tbsView,s.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,s=me(!0)){const a=[];let n=null,i=null,o=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,s))return[e]}catch{}if(e.extensions){for(const u of e.extensions)if(u.extnID===tp&&u.parsedValue instanceof sa){u.parsedValue.keyIdentifier?n=u.parsedValue.keyIdentifier:(u.parsedValue.authorityCertIssuer&&(i=u.parsedValue.authorityCertIssuer),u.parsedValue.authorityCertSerialNumber&&(o=u.parsedValue.authorityCertSerialNumber));break}}function h(u){if(n!==null&&u.extensions){let f=!1;for(const m of u.extensions)if(m.extnID===B1&&m.parsedValue){f=!0,xe.isEqual(m.parsedValue.valueBlock.valueHex,n.valueBlock.valueHexView)&&a.push(u);break}if(f)return}let c=!1;o!==null&&(c=u.serialNumber.isEqual(o)),i!==null?u.subject.isEqual(i)&&c&&a.push(u):e.issuer.isEqual(u.subject)&&a.push(u)}for(const u of t.trustedCerts)h(u);for(const u of t.certs)h(u);for(let u=a.length-1;u>=0;u--)try{await e.verify(a[u],s)===!1&&a.splice(u,1)}catch{a.splice(u,1)}return a}defaultValues(e){switch(e){case Gm:return[];case Xm:return[];case zm:return[];case Ym:return[];case _m:return new Date;case Qm:return _h.defaultFindOrigin;case Zm:return this.defaultFindIssuer;default:throw new Error(`Invalid member name for CertificateChainValidationEngine class: ${e}`)}}async sort(e=!1,t=me(!0)){const s=[],a=async(w,S)=>{const v=[];function C(b){let k=!0;for(let P=0;P<b.length;P++){for(let x=0;x<b.length;x++)if(x!==P&&b[P]===b[x]){k=!1;break}if(!k)break}return k}if(kb(w,this.trustedCerts))return[[w]];const p=await this.findIssuer(w,this,S);if(p.length===0)throw new Error("No valid certificate paths found");for(let b=0;b<p.length;b++){if(xe.isEqual(p[b].tbsView,w.tbsView)){v.push([p[b]]);continue}const k=await a(p[b],S);for(let P=0;P<k.length;P++){const x=k[P].slice();x.splice(0,0,p[b]),C(x)?v.push(x):v.push(k[P])}}return v},n=async w=>{const S=[],v=[],C=[];if(S.push(...s.filter(p=>w.issuer.isEqual(p.subject))),S.length===0)return{status:1,statusMessage:"No certificate's issuers"};if(v.push(...this.crls.filter(p=>p.issuer.isEqual(w.issuer))),v.length===0)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let p=0;p<v.length;p++){const b=v[p];if(!(b.nextUpdate&&b.nextUpdate.value<this.checkDate))for(let k=0;k<S.length;k++)try{if(await v[p].verify({issuerCertificate:S[k]},t)){C.push({crl:v[p],certificate:S[k]});break}}catch{}}return C.length?{status:0,statusMessage:E,result:C}:{status:3,statusMessage:"No valid CRLs found"}},i=async(w,S)=>{const v=t.getAlgorithmByOID(w.signatureAlgorithm.algorithmId);if(!v.name||!v.hash)return 1;for(let C=0;C<this.ocsps.length;C++){const p=await this.ocsps[C].getCertificateStatus(w,S,t);if(p.isForCertificate)return p.status===0?0:1}return 2};async function o(w,S=!1){let v=!1,C=!1,p=!1,b=!1;if(w.extensions){for(let k=0;k<w.extensions.length;k++){const P=w.extensions[k];if(P.critical&&!P.parsedValue)return{result:!1,resultCode:6,resultMessage:`Unable to parse critical certificate extension: ${P.extnID}`};if(P.extnID===O1){p=!0;const x=new Uint8Array(P.parsedValue.valueBlock.valueHex);(x[0]&4)===4&&(C=!0),(x[0]&2)===2&&(b=!0)}P.extnID===Zf&&"cA"in P.parsedValue&&P.parsedValue.cA===!0&&(v=!0)}if(C===!0&&v===!1)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(p===!0&&v===!0&&C===!1)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(v===!0&&p===!0&&S&&b===!1)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return v===!1?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:E}}const h=async(w,S)=>{for(let v=0;v<w.length;v++)if(w[v].notBefore.value>S||w[v].notAfter.value<S)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(w.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let v=w.length-2;v>=0;v--)if(w[v].issuer.isEqual(w[v].subject)===!1&&w[v].issuer.isEqual(w[v+1].subject)===!1)return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(this.crls.length!==0||this.ocsps.length!==0)for(let v=0;v<w.length-1;v++){let C=2,p={status:0,statusMessage:E};if(this.ocsps.length!==0)switch(C=await i(w[v],w[v+1]),C){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(this.crls.length!==0){if(p=await n(w[v]),p.status===0&&p.result)for(let b=0;b<p.result.length;b++){if(p.result[b].crl.isCertificateRevoked(w[v]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if((await o(p.result[b].certificate,!0)).result===!1)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(e===!1)throw new Zr(vn.noRevocation,`No revocation values found for one of certificates: ${p.statusMessage}`)}else if(C===2)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(C===2&&p.status===2&&e){const b=w[v+1];let k=!1;if(b.extensions)for(const P of b.extensions)switch(P.extnID){case jg:case ep:case sp:k=!0;break}if(k)throw new Zr(vn.noRevocation,`No revocation values found for one of certificates: ${p.statusMessage}`)}}for(const[v,C]of w.entries())if(v&&!(await o(C)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}};s.push(...this.trustedCerts),s.push(...this.certs);for(let w=0;w<s.length;w++)for(let S=0;S<s.length;S++)if(w!==S&&xe.isEqual(s[w].tbsView,s[S].tbsView)){s.splice(S,1),w=0;break}const u=s[s.length-1];let c;const f=[u];if(c=await a(u,t),c.length===0)throw new Zr(vn.noPath,"Unable to find certificate path");for(let w=c.length-1;w>=0;w--){let S=!1;for(let v=0;v<c[w].length;v++){const C=c[w][v];for(let p=0;p<this.trustedCerts.length;p++)if(xe.isEqual(C.tbsView,this.trustedCerts[p].tbsView)){S=!0;break}if(S)break}S||c.splice(w,1)}if(c.length===0)throw new Zr(vn.noValidPath,"No valid certificate paths found");let m=c[0].length,y=0;for(let w=0;w<c.length;w++)c[w].length<m&&(m=c[w].length,y=w);for(let w=0;w<c[y].length;w++)f.push(c[y][w]);if(c=await h(f,this.checkDate),c.result===!1)throw c;return f}async verify(e={},t=me(!0)){function s(h,u){const c=zr(h),f=zr(u),m=c.split("."),y=f.split("."),w=m.length,S=y.length;if(w===0||S===0||w<S)return!1;for(let v=0;v<w;v++)if(m[v].length===0)return!1;for(let v=0;v<S;v++)if(y[v].length===0){if(v===0){if(S===1)return!1;continue}return!1}for(let v=0;v<S;v++)if(y[S-1-v].length!==0&&m[w-1-v].localeCompare(y[S-1-v])!==0)return!1;return!0}function a(h,u){const c=zr(h),f=zr(u),m=c.split("@"),y=f.split("@");if(m.length===0||y.length===0||m.length<y.length)return!1;if(y.length===1){if(s(m[1],y[0])){const w=m[1].split("."),S=y[0].split(".");return S[0].length===0?!0:w.length===S.length}return!1}return c.localeCompare(f)===0}function n(h,u){let c=zr(h);const f=zr(u),m=c.split("/");if(f.split("/").length>1)return!1;if(m.length>1){for(let y=0;y<m.length;y++)if(m[y].length>0&&m[y].charAt(m[y].length-1)!==":"){c=m[y].split(":")[0];break}}if(s(c,f)){const y=c.split("."),w=f.split(".");return w[0].length===0?!0:y.length===w.length}return!1}function i(h,u){const c=h.valueBlock.valueHexView,f=u.valueBlock.valueHexView;if(c.length===4&&f.length===8){for(let m=0;m<4;m++)if((c[m]^f[m])&f[m+4])return!1;return!0}if(c.length===16&&f.length===32){for(let m=0;m<16;m++)if((c[m]^f[m])&f[m+16])return!1;return!0}return!1}function o(h,u){if(h.typesAndValues.length===0||u.typesAndValues.length===0)return!0;if(h.typesAndValues.length<u.typesAndValues.length)return!1;let c=!0,f=0;for(let m=0;m<u.typesAndValues.length;m++){let y=!1;for(let w=f;w<h.typesAndValues.length;w++)if(y=h.typesAndValues[w].isEqual(u.typesAndValues[m]),h.typesAndValues[w].type===u.typesAndValues[m].type&&(c=c&&y),y===!0)if(f===0||f===w){f=w+1;break}else return!1;if(y===!1)return!1}return f===0?!1:c}try{if(this.certs.length===0)throw new Error("Empty certificate array");const h=e.passedWhenNotRevValues||!1,u=e.initialPolicySet||[zt],c=e.initialExplicitPolicy||!1,f=e.initialPolicyMappingInhibit||!1,m=e.initialInhibitPolicy||!1,y=e.initialPermittedSubtreesSet||[],w=e.initialExcludedSubtreesSet||[],S=e.initialRequiredNameForms||[];let v=c,C=f,p=m;const b=[!1,!1,!1];let k=0,P=0,x=0,T=y,B=w;const V=S;let J=1;this.certs=await this.sort(h,t);const F=[];F.push(zt);const D=[],j=new Array(this.certs.length-1);for(let se=0;se<this.certs.length-1;se++)j[se]=!0;D.push(j);const ee=new Array(this.certs.length-1),_=new Array(this.certs.length-1);let ie=v?this.certs.length-1:-1;for(let se=this.certs.length-2;se>=0;se--,J++){const te=this.certs[se];if(te.extensions){for(let Z=0;Z<te.extensions.length;Z++){const ce=te.extensions[Z];if(ce.extnID===$g){_[se]=ce.parsedValue;for(let fe=0;fe<F.length;fe++)if(F[fe]===zt){delete D[fe][se];break}for(let fe=0;fe<ce.parsedValue.certificatePolicies.length;fe++){let ke=-1;const Me=ce.parsedValue.certificatePolicies[fe].policyIdentifier;for(let I=0;I<F.length;I++)if(Me===F[I]){ke=I;break}if(ke===-1){F.push(Me);const I=new Array(this.certs.length-1);I[se]=!0,D.push(I)}else D[ke][se]=!0}}if(ce.extnID===Kg){if(C)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};ee[se]=ce.parsedValue}ce.extnID===Mg&&v===!1&&(ce.parsedValue.requireExplicitPolicy===0?(v=!0,ie=se):b[0]===!1?(b[0]=!0,k=ce.parsedValue.requireExplicitPolicy):k=k>ce.parsedValue.requireExplicitPolicy?ce.parsedValue.requireExplicitPolicy:k,ce.parsedValue.inhibitPolicyMapping===0?C=!0:b[1]===!1?(b[1]=!0,P=ce.parsedValue.inhibitPolicyMapping+1):P=P>ce.parsedValue.inhibitPolicyMapping+1?ce.parsedValue.inhibitPolicyMapping+1:P),ce.extnID===$1&&p===!1&&(ce.parsedValue.valueBlock.valueDec===0?p=!0:b[2]===!1?(b[2]=!0,x=ce.parsedValue.valueBlock.valueDec):x=x>ce.parsedValue.valueBlock.valueDec?ce.parsedValue.valueBlock.valueDec:x)}if(p===!0){let Z=-1;for(let ce=0;ce<F.length;ce++)if(F[ce]===zt){Z=ce;break}Z!==-1&&delete D[0][se]}v===!1&&b[0]===!0&&(k--,k===0&&(v=!0,ie=se,b[0]=!1)),C===!1&&b[1]===!0&&(P--,P===0&&(C=!0,b[1]=!1)),p===!1&&b[2]===!0&&(x--,x===0&&(p=!0,b[2]=!1))}}for(let se=0;se<this.certs.length-1;se++)if(se<this.certs.length-2&&typeof ee[se+1]<"u")for(let te=0;te<ee[se+1].mappings.length;te++){if(ee[se+1].mappings[te].issuerDomainPolicy===zt||ee[se+1].mappings[te].subjectDomainPolicy===zt)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let Z=-1,ce=-1;for(let fe=0;fe<F.length;fe++)F[fe]===ee[se+1].mappings[te].issuerDomainPolicy&&(Z=fe),F[fe]===ee[se+1].mappings[te].subjectDomainPolicy&&(ce=fe);typeof D[Z][se]<"u"&&delete D[Z][se];for(let fe=0;fe<_[se].certificatePolicies.length;fe++)if(ee[se+1].mappings[te].subjectDomainPolicy===_[se].certificatePolicies[fe].policyIdentifier&&Z!==-1&&ce!==-1)for(let ke=0;ke<=se;ke++)typeof D[ce][ke]<"u"&&(D[Z][ke]=!0,delete D[ce][ke])}for(let se=0;se<F.length;se++)if(F[se]===zt)for(let te=0;te<ie;te++)delete D[se][te];const ae=[];for(let se=0;se<D.length;se++){let te=!0;for(let Z=0;Z<this.certs.length-1;Z++){let ce=!1;if(Z<ie&&F[se]===zt&&F.length>1){te=!1;break}if(typeof D[se][Z]>"u"){if(Z>=ie){for(let fe=0;fe<F.length;fe++)if(F[fe]===zt){D[fe][Z]===!0&&(ce=!0);break}}if(!ce){te=!1;break}}}te===!0&&ae.push(F[se])}let pe=[];if(u.length===1&&u[0]===zt&&v===!1)pe=u;else if(ae.length===1&&ae[0]===zt)pe=u;else for(let se=0;se<ae.length;se++)for(let te=0;te<u.length;te++)if(u[te]===ae[se]||u[te]===zt){pe.push(ae[se]);break}const ne={result:pe.length>0,resultCode:0,resultMessage:pe.length>0?E:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:ae,userConstrPolicies:pe,explicitPolicyIndicator:v,policyMappings:ee,certificatePath:this.certs};if(pe.length===0||ne.result===!1)return ne;J=1;for(let se=this.certs.length-2;se>=0;se--,J++){const te=this.certs[se];let Z=[],ce=[],fe=[];if(te.extensions)for(let A=0;A<te.extensions.length;A++){const $=te.extensions[A];$.extnID===Ug&&("permittedSubtrees"in $.parsedValue&&(ce=ce.concat($.parsedValue.permittedSubtrees)),"excludedSubtrees"in $.parsedValue&&(fe=fe.concat($.parsedValue.excludedSubtrees))),$.extnID===Dg&&(Z=Z.concat($.parsedValue.altNames))}let ke=V.length<=0;for(let A=0;A<V.length;A++)switch(V[A].base.type){case 4:{if(V[A].base.value.typesAndValues.length!==te.subject.typesAndValues.length)continue;ke=!0;for(let $=0;$<te.subject.typesAndValues.length;$++)if(te.subject.typesAndValues[$].type!==V[A].base.value.typesAndValues[$].type){ke=!1;break}if(ke===!0)break}break;default:}if(ke===!1)throw ne.result=!1,ne.resultCode=21,ne.resultMessage="No necessary name form found",ne;const Me=[[],[],[],[],[]];for(let A=0;A<T.length;A++)switch(T[A].base.type){case 1:Me[0].push(T[A]);break;case 2:Me[1].push(T[A]);break;case 4:Me[2].push(T[A]);break;case 6:Me[3].push(T[A]);break;case 7:Me[4].push(T[A]);break;default:}for(let A=0;A<5;A++){let $=!1,L=!1;const de=Me[A];for(let Ee=0;Ee<de.length;Ee++){switch(A){case 0:if(Z.length>0)for(let le=0;le<Z.length;le++)Z[le].type===1&&(L=!0,$=$||a(Z[le].value,de[Ee].base.value));else for(let le=0;le<te.subject.typesAndValues.length;le++)(te.subject.typesAndValues[le].type==="1.2.840.113549.1.9.1"||te.subject.typesAndValues[le].type==="0.9.2342.19200300.100.1.3")&&(L=!0,$=$||a(te.subject.typesAndValues[le].value.valueBlock.value,de[Ee].base.value));break;case 1:if(Z.length>0)for(let le=0;le<Z.length;le++)Z[le].type===2&&(L=!0,$=$||s(Z[le].value,de[Ee].base.value));break;case 2:L=!0,$=o(te.subject,de[Ee].base.value);break;case 3:if(Z.length>0)for(let le=0;le<Z.length;le++)Z[le].type===6&&(L=!0,$=$||n(Z[le].value,de[Ee].base.value));break;case 4:if(Z.length>0)for(let le=0;le<Z.length;le++)Z[le].type===7&&(L=!0,$=$||i(Z[le].value,de[Ee].base.value));break;default:}if($)break}if($===!1&&de.length>0&&L)throw ne.result=!1,ne.resultCode=41,ne.resultMessage='Failed to meet "permitted sub-trees" name constraint',ne}let I=!1;for(let A=0;A<B.length;A++){switch(B[A].base.type){case 1:if(Z.length>=0)for(let $=0;$<Z.length;$++)Z[$].type===1&&(I=I||a(Z[$].value,B[A].base.value));else for(let $=0;$<te.subject.typesAndValues.length;$++)(te.subject.typesAndValues[$].type==="1.2.840.113549.1.9.1"||te.subject.typesAndValues[$].type==="0.9.2342.19200300.100.1.3")&&(I=I||a(te.subject.typesAndValues[$].value.valueBlock.value,B[A].base.value));break;case 2:if(Z.length>0)for(let $=0;$<Z.length;$++)Z[$].type===2&&(I=I||s(Z[$].value,B[A].base.value));break;case 4:I=I||o(te.subject,B[A].base.value);break;case 6:if(Z.length>0)for(let $=0;$<Z.length;$++)Z[$].type===6&&(I=I||n(Z[$].value,B[A].base.value));break;case 7:if(Z.length>0)for(let $=0;$<Z.length;$++)Z[$].type===7&&(I=I||i(Z[$].value,B[A].base.value));break;default:}if(I)break}if(I===!0)throw ne.result=!1,ne.resultCode=42,ne.resultMessage='Failed to meet "excluded sub-trees" name constraint',ne;T=T.concat(ce),B=B.concat(fe)}return ne}catch(h){return h instanceof Error?h instanceof Zr?{result:!1,resultCode:h.code,resultMessage:h.message,error:h}:{result:!1,resultCode:vn.unknown,resultMessage:h.message,error:h}:h&&typeof h=="object"&&"resultMessage"in h?h:{result:!1,resultCode:-1,resultMessage:`${h}`}}}}const ah="tbsResponseData",Dc="signatureAlgorithm",Tc="signature",Ji="certs",ml="BasicOCSPResponse",Nf=`${ml}.${ah}`,Ef=`${ml}.${Dc}`,Cf=`${ml}.${Tc}`,nh=`${ml}.${Ji}`,Ib=[Nf,Ef,Cf,nh];class ts extends G{constructor(e={}){super(),this.tbsResponseData=d(e,ah,ts.defaultValues(ah)),this.signatureAlgorithm=d(e,Dc,ts.defaultValues(Dc)),this.signature=d(e,Tc,ts.defaultValues(Tc)),Ji in e&&(this.certs=d(e,Ji,ts.defaultValues(Ji))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ah:return new nt;case Dc:return new M;case Tc:return new we;case Ji:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let s=nt.compareWithDefault("tbs",t.tbs)&&nt.compareWithDefault("responderID",t.responderID)&&nt.compareWithDefault("producedAt",t.producedAt)&&nt.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(s=s&&nt.compareWithDefault("responseExtensions",t.responseExtensions)),s}case Dc:return t.algorithmId===E&&!("algorithmParams"in t);case Tc:return t.isEqual(ts.defaultValues(e));case Ji:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||ml,value:[nt.schema(t.tbsResponseData||{names:{blockName:Nf}}),M.schema(t.signatureAlgorithm||{names:{blockName:Ef}}),new we({name:t.signature||Cf}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:[new he({name:nh,value:ve.schema(t.certs||{})})]})]})]})}fromSchema(e){X(e,Ib);const t=z(e,e,ts.schema());q.assertSchema(t,this.className),this.tbsResponseData=new nt({schema:t.result[Nf]}),this.signatureAlgorithm=new M({schema:t.result[Ef]}),this.signature=t.result[Cf],nh in t.result&&(this.certs=Array.from(t.result[nh],s=>new ve({schema:s})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[new O({value:Array.from(this.certs,t=>t.toSchema())})]})),new O({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}async getCertificateStatus(e,t,s=me(!0)){const a={isForCertificate:!1,status:2},n={},i=[];for(const o of this.tbsResponseData.responses){const h=s.getAlgorithmByOID(o.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!n[h.name]){n[h.name]=1;const u=new qe;i.push(u),await u.createForCertificate(e,{hashAlgorithm:h.name,issuerCertificate:t},s)}}for(const o of this.tbsResponseData.responses)for(const h of i)if(o.certID.isEqual(h)){a.isForCertificate=!0;try{switch(o.certStatus.idBlock.isConstructed){case!0:o.certStatus.idBlock.tagNumber===1&&(a.status=1);break;case!1:switch(o.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2;break;default:}break;default:}}catch{}return a}return a}async sign(e,t="SHA-1",s=me(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters.algorithm;if(!("name"in n))throw new Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());const i=await s.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:n});this.signature=new we({valueHex:i})}async verify(e={},t=me(!0)){let s=null,a=-1;const n=e.trustedCerts||[];if(!this.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof Ne:for(const[o,h]of this.certs.entries())if(h.subject.isEqual(this.tbsResponseData.responderID)){a=o;break}break;case this.tbsResponseData.responderID instanceof Y:for(const[o,h]of this.certs.entries()){const u=await t.digest({name:"sha-1"},h.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(tl(u,this.tbsResponseData.responderID.valueBlock.valueHex)){a=o;break}}break;default:throw new Error("Wrong value for responderID")}if(a===-1)throw new Error("Correct certificate was not found in OCSP response");s=this.certs[a];const i=[s];for(const o of this.certs){const h=await Yg(o,s);h&&i.push(h)}if(!(await new _h({certs:i,trustedCerts:n}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}ts.CLASS_NAME="BasicOCSPResponse";const ef="tbs",tf="version",sf="subject",rf="subjectPublicKeyInfo",Jn="attributes",Rc="signatureAlgorithm",Lc="signatureValue",Po="CertificationRequestInfo",hp=`${Po}.version`,mp=`${Po}.subject`,fp=`${Po}.subjectPublicKeyInfo`,Jh=`${Po}.attributes`,Vb=[Po,hp,mp,fp,Jh,Rc,Lc];function xb(r={}){const e=d(r,"names",{});return new O({name:e.CertificationRequestInfo||Po,value:[new H({name:e.CertificationRequestInfoVersion||hp}),Ne.schema(e.subject||{names:{blockName:mp}}),Rt.schema({names:{blockName:fp}}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new he({optional:!0,name:e.CertificationRequestInfoAttributes||Jh,value:Be.schema(e.attributes||{})})]})]})}class cs extends G{get tbs(){return xe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,ef,cs.defaultValues(ef))),this.version=d(e,tf,cs.defaultValues(tf)),this.subject=d(e,sf,cs.defaultValues(sf)),this.subjectPublicKeyInfo=d(e,rf,cs.defaultValues(rf)),Jn in e&&(this.attributes=d(e,Jn,cs.defaultValues(Jn))),this.signatureAlgorithm=d(e,Rc,cs.defaultValues(Rc)),this.signatureValue=d(e,Lc,cs.defaultValues(Lc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ef:return Xe;case tf:return 0;case sf:return new Ne;case rf:return new Rt;case Jn:return[];case Rc:return new M;case Lc:return new we;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({value:[xb(t.certificationRequestInfo||{}),new O({name:t.signatureAlgorithm||Rc,value:[new re,new ue({optional:!0})]}),new we({name:t.signatureValue||Lc})]})}fromSchema(e){X(e,Vb);const t=z(e,e,cs.schema());q.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[hp].valueBlock.valueDec,this.subject=new Ne({schema:t.result[mp]}),this.subjectPublicKeyInfo=new Rt({schema:t.result[fp]}),Jh in t.result&&(this.attributes=Array.from(t.result[Jh],s=>new Be({schema:s}))),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new H({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return Jn in this&&e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new O({value:e})}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return cs.schema();const s=Ge(this.tbsView);q.assert(s,"PKCS#10 Certificate Request"),t=s.result}else t=this.encodeTBS();return new O({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Jn in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}async sign(e,t="SHA-1",s=me(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new we({valueHex:i})}async verify(e=me(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=me(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}cs.CLASS_NAME="CertificationRequest";const ln="digestAlgorithm",hn="digest",Bb=[ln,hn];class rs extends G{constructor(e={}){super(),this.digestAlgorithm=d(e,ln,rs.defaultValues(ln)),this.digest=d(e,hn,rs.defaultValues(hn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ln:return new M;case hn:return new Y;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ln:return M.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case hn:return t.isEqual(rs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.digestAlgorithm||{names:{blockName:ln}}),new Y({name:t.digest||hn})]})}fromSchema(e){X(e,Bb);const t=z(e,e,rs.schema({names:{digestAlgorithm:{names:{blockName:ln}},digest:hn}}));q.assertSchema(t,this.className),this.digestAlgorithm=new M({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new O({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}rs.CLASS_NAME="DigestInfo";const qi="eContentType",us="eContent",Ob=[qi,us];class $t extends G{constructor(e={}){if(super(),this.eContentType=d(e,qi,$t.defaultValues(qi)),us in e&&(this.eContent=d(e,us,$t.defaultValues(us)),this.eContent.idBlock.tagClass===1&&this.eContent.idBlock.tagNumber===4&&this.eContent.idBlock.isConstructed===!1)){const t=new Y({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,s,s+65536>a.byteLength?a.byteLength-s:65536),o=new ArrayBuffer(i.length),h=new Uint8Array(o);for(let u=0;u<h.length;u++)h[u]=i[u];t.valueBlock.value.push(new Y({valueHex:o})),n-=i.length,s+=i.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qi:return E;case us:return new Y;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case qi:return t===E;case us:return t.idBlock.tagClass===1&&t.idBlock.tagNumber===4?t.isEqual($t.defaultValues(us)):!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.eContentType||E}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.eContent||E})]})]})}fromSchema(e){X(e,Ob);const t=z(e,e,$t.schema({names:{eContentType:qi,eContent:us}}));q.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),us in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new re({value:this.eContentType})),this.eContent&&$t.compareWithDefault(us,this.eContent)===!1&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new O({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&$t.compareWithDefault(us,this.eContent)===!1&&(e.eContent=this.eContent.toJSON()),e}}$t.CLASS_NAME="EncapsulatedContentInfo";const mn="mac",fn="macSalt",js="iterations",Pb=[mn,fn,js];class xt extends G{constructor(e={}){super(),this.mac=d(e,mn,xt.defaultValues(mn)),this.macSalt=d(e,fn,xt.defaultValues(fn)),js in e&&(this.iterations=d(e,js,xt.defaultValues(js))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mn:return new rs;case fn:return new Y;case js:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mn:return rs.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&rs.compareWithDefault("digest",t.digest);case fn:return t.isEqual(xt.defaultValues(e));case js:return t===xt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,optional:t.optional||!0,value:[rs.schema(t.mac||{names:{blockName:mn}}),new Y({name:t.macSalt||fn}),new H({optional:!0,name:t.iterations||js})]})}fromSchema(e){X(e,Pb);const t=z(e,e,xt.schema({names:{mac:{names:{blockName:mn}},macSalt:fn,iterations:js}}));q.assertSchema(t,this.className),this.mac=new rs({schema:t.result.mac}),this.macSalt=t.result.macSalt,js in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return this.iterations!==void 0&&e.push(new H({value:this.iterations})),new O({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return this.iterations!==void 0&&(e.iterations=this.iterations),e}}xt.CLASS_NAME="MacData";const bn="hashAlgorithm",An="hashedMessage",Db=[bn,An];class gt extends G{static async create(e,t,s=me(!0)){const a=s.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),n=await s.digest(e,t);return new gt({hashAlgorithm:new M({algorithmId:a,algorithmParams:new et}),hashedMessage:new Y({valueHex:n})})}constructor(e={}){super(),this.hashAlgorithm=d(e,bn,gt.defaultValues(bn)),this.hashedMessage=d(e,An,gt.defaultValues(An)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bn:return new M;case An:return new Y;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bn:return t.algorithmId===E&&!("algorithmParams"in t);case An:return t.isEqual(gt.defaultValues(e))===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.hashAlgorithm||{}),new Y({name:t.hashedMessage||E})]})}fromSchema(e){X(e,Db);const t=z(e,e,gt.schema({names:{hashAlgorithm:{names:{blockName:bn}},hashedMessage:An}}));q.assertSchema(t,this.className),this.hashAlgorithm=new M({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new O({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}gt.CLASS_NAME="MessageImprint";const Wi="reqCert",Fr="singleRequestExtensions",Tb=[Wi,Fr];let qh=class Uc extends G{constructor(e={}){super(),this.reqCert=d(e,Wi,Uc.defaultValues(Wi)),Fr in e&&(this.singleRequestExtensions=d(e,Fr,Uc.defaultValues(Fr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wi:return new qe;case Fr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wi:return t.isEqual(Uc.defaultValues(e));case Fr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[qe.schema(t.reqCert||{}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Je.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||E}})]})]})}fromSchema(e){X(e,Tb);const t=z(e,e,Uc.schema({names:{reqCert:{names:{blockName:Wi}},extensions:{names:{blockName:Fr}}}}));q.assertSchema(t,this.className),this.reqCert=new qe({schema:t.result.reqCert}),Fr in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,s=>new Je({schema:s})))}toSchema(){const e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:Array.from(this.singleRequestExtensions,t=>t.toSchema())})]})),new O({value:e})}toJSON(){const e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,t=>t.toJSON())),e}};qh.CLASS_NAME="Request";const Hl="tbs",Gi="version",Xi="requestorName",Fl="requestList",zi="requestExtensions",Do="TBSRequest",ih=`${Do}.${Gi}`,oh=`${Do}.${Xi}`,kf=`${Do}.requests`,uh=`${Do}.${zi}`,Rb=[Do,ih,oh,kf,uh];class mt extends G{get tbs(){return xe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,Hl,mt.defaultValues(Hl))),Gi in e&&(this.version=d(e,Gi,mt.defaultValues(Gi))),Xi in e&&(this.requestorName=d(e,Xi,mt.defaultValues(Xi))),this.requestList=d(e,Fl,mt.defaultValues(Fl)),zi in e&&(this.requestExtensions=d(e,zi,mt.defaultValues(zi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hl:return Xe;case Gi:return 0;case Xi:return new be;case Fl:case zi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Hl:return t.byteLength===0;case Gi:return t===mt.defaultValues(e);case Xi:return t.type===be.defaultValues("type")&&Object.keys(t.value).length===0;case Fl:case zi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||Do,value:[new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:t.TBSRequestVersion||ih})]}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[be.schema(t.requestorName||{names:{blockName:oh}})]}),new O({name:t.requestList||"TBSRequest.requestList",value:[new he({name:t.requests||kf,value:qh.schema(t.requestNames||{})})]}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[ze.schema(t.extensions||{names:{blockName:t.requestExtensions||uh}})]})]})}fromSchema(e){X(e,Rb);const t=z(e,e,mt.schema());q.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,ih in t.result&&(this.version=t.result[ih].valueBlock.valueDec),oh in t.result&&(this.requestorName=new be({schema:t.result[oh]})),this.requestList=Array.from(t.result[kf],s=>new qh({schema:s})),uh in t.result&&(this.requestExtensions=Array.from(t.result[uh].valueBlock.value,s=>new Je({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return mt.schema();const s=Ge(this.tbsView);if(q.assert(s,"TBS Request"),!(s.result instanceof O))throw new Error("ASN.1 result should be SEQUENCE");t=s.result}else{const s=[];this.version!==void 0&&s.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[new H({value:this.version})]})),this.requestorName&&s.push(new U({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),s.push(new O({value:Array.from(this.requestList,a=>a.toSchema())})),this.requestExtensions&&s.push(new U({idBlock:{tagClass:3,tagNumber:2},value:[new O({value:Array.from(this.requestExtensions,a=>a.toSchema())})]})),t=new O({value:s})}return t}toJSON(){const e={};return this.version!=null&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,t=>t.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,t=>t.toJSON())),e}}mt.CLASS_NAME="TBSRequest";const qn="signatureAlgorithm",Wn="signature",ur="certs";class Jt extends G{constructor(e={}){super(),this.signatureAlgorithm=d(e,qn,Jt.defaultValues(qn)),this.signature=d(e,Wn,Jt.defaultValues(Wn)),ur in e&&(this.certs=d(e,ur,Jt.defaultValues(ur))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qn:return new M;case Wn:return new we;case ur:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case qn:return t.algorithmId===E&&!("algorithmParams"in t);case Wn:return t.isEqual(Jt.defaultValues(e));case ur:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.signatureAlgorithm||{}),new we({name:t.signature||E}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:[new he({name:t.certs||E,value:ve.schema({})})]})]})]})}fromSchema(e){X(e,[qn,Wn,ur]);const t=z(e,e,Jt.schema({names:{signatureAlgorithm:{names:{blockName:qn}},signature:Wn,certs:ur}}));q.assertSchema(t,this.className),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,ur in t.result&&(this.certs=Array.from(t.result.certs,s=>new ve({schema:s})))}toSchema(){const e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:Array.from(this.certs,t=>t.toSchema())})]})),new O({value:e})}toJSON(){const e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}}Jt.CLASS_NAME="Signature";const Yi="tbsRequest",Jr="optionalSignature",Lb=[Yi,Jr];class Qc extends G{constructor(e={}){super(),this.tbsRequest=d(e,Yi,Qc.defaultValues(Yi)),Jr in e&&(this.optionalSignature=d(e,Jr,Qc.defaultValues(Jr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yi:return new mt;case Jr:return new Jt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yi:return mt.compareWithDefault("tbs",t.tbs)&&mt.compareWithDefault("version",t.version)&&mt.compareWithDefault("requestorName",t.requestorName)&&mt.compareWithDefault("requestList",t.requestList)&&mt.compareWithDefault("requestExtensions",t.requestExtensions);case Jr:return Jt.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&Jt.compareWithDefault("signature",t.signature)&&Jt.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||"OCSPRequest",value:[mt.schema(t.tbsRequest||{names:{blockName:Yi}}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Jt.schema(t.optionalSignature||{names:{blockName:Jr}})]})]})}fromSchema(e){X(e,Lb);const t=z(e,e,Qc.schema());q.assertSchema(t,this.className),this.tbsRequest=new mt({schema:t.result.tbsRequest}),Jr in t.result&&(this.optionalSignature=new Jt({schema:t.result.optionalSignature}))}toSchema(e=!1){const t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new O({value:t})}toJSON(){const e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,s=me(!0)){const a=new qe;await a.createForCertificate(e,t,s),this.tbsRequest.requestList.push(new qh({reqCert:a}))}async sign(e,t="SHA-1",s=me(!0)){if(ye.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw new Error('Need to create "optionalSignature" field before signing');const a=await s.getSignatureParameters(e,t),n=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;const i=this.tbsRequest.toSchema(!0).toBER(!1),o=await s.signWithPrivateKey(i,e,n);this.optionalSignature.signature=new we({valueHex:o})}verify(){}}Qc.CLASS_NAME="OCSPRequest";const _i="responseType",Qi="response",Ub=[_i,Qi];class fs extends G{constructor(e={}){super(),this.responseType=d(e,_i,fs.defaultValues(_i)),this.response=d(e,Qi,fs.defaultValues(Qi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _i:return E;case Qi:return new Y;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case _i:return t===E;case Qi:return t.isEqual(fs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new re({name:t.responseType||E}),new Y({name:t.response||E})]})}fromSchema(e){X(e,Ub);const t=z(e,e,fs.schema({names:{responseType:_i,response:Qi}}));q.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new O({value:[new re({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}fs.CLASS_NAME="ResponseBytes";const Gn="responseStatus",xs="responseBytes";class yo extends G{constructor(e={}){super(),this.responseStatus=d(e,Gn,yo.defaultValues(Gn)),xs in e&&(this.responseBytes=d(e,xs,yo.defaultValues(xs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gn:return new sl;case xs:return new fs;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Gn:return t.isEqual(yo.defaultValues(e));case xs:return fs.compareWithDefault("responseType",t.responseType)&&fs.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||"OCSPResponse",value:[new sl({name:t.responseStatus||Gn}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[fs.schema(t.responseBytes||{names:{blockName:xs}})]})]})}fromSchema(e){X(e,[Gn,xs]);const t=z(e,e,yo.schema());q.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,xs in t.result&&(this.responseBytes=new fs({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new O({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,s=me(!0)){let a;const n={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==Xl)return n;try{const i=Ge(this.responseBytes.response.valueBlock.valueHexView);q.assert(i,"Basic OCSP response"),a=new ts({schema:i.result})}catch{return n}return a.getCertificateStatus(e,t,s)}async sign(e,t,s=me(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===Xl)return ts.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,s);throw new Error(`Unknown ResponseBytes type: ${((a=this.responseBytes)===null||a===void 0?void 0:a.responseType)||"Unknown"}`)}async verify(e=null,t=me(!0)){var s;if(!(xs in this))throw new Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===Xl){const a=ts.fromBER(this.responseBytes.response.valueBlock.valueHexView);return e!==null&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw new Error(`Unknown ResponseBytes type: ${((s=this.responseBytes)===null||s===void 0?void 0:s.responseType)||"Unknown"}`)}}yo.CLASS_NAME="OCSPResponse";const wa="type",$s="attributes",Jl="encodedValue",jb=[$s];class Te extends G{constructor(e={}){super(),this.type=d(e,wa,Te.defaultValues(wa)),this.attributes=d(e,$s,Te.defaultValues($s)),this.encodedValue=d(e,Jl,Te.defaultValues(Jl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wa:return-1;case $s:return[];case Jl:return Xe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wa:return t===Te.defaultValues(wa);case $s:return t.length===0;case Jl:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new U({name:t.blockName||E,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new he({name:t.attributes||E,value:Be.schema()})]})}fromSchema(e){X(e,jb);const t=z(e,e,Te.schema({names:{tagNumber:this.type,attributes:$s}}));q.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=xe.toArrayBuffer(t.result.valueBeforeDecodeView);const s=new Uint8Array(this.encodedValue);if(s[0]=49,!($s in t.result)){if(this.type===0)throw new Error("Wrong structure of SignedUnsignedAttributes");return}this.attributes=Array.from(t.result.attributes,a=>new Be({schema:a}))}toSchema(){if(Te.compareWithDefault(wa,this.type)||Te.compareWithDefault($s,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new U({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(Te.compareWithDefault(wa,this.type)||Te.compareWithDefault($s,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}Te.CLASS_NAME="SignedAndUnsignedAttributes";const Zi="version",pn="sid",eo="digestAlgorithm",qr="signedAttrs",to="signatureAlgorithm",jc="signature",Wr="unsignedAttrs",ma="SignerInfo",If=`${ma}.${Zi}`,$c=`${ma}.${pn}`,Vf=`${ma}.${eo}`,ch=`${ma}.${qr}`,xf=`${ma}.${to}`,Bf=`${ma}.${jc}`,lh=`${ma}.${Wr}`,$b=[If,$c,Vf,ch,xf,Bf,lh];class Ke extends G{constructor(e={}){super(),this.version=d(e,Zi,Ke.defaultValues(Zi)),this.sid=d(e,pn,Ke.defaultValues(pn)),this.digestAlgorithm=d(e,eo,Ke.defaultValues(eo)),qr in e&&(this.signedAttrs=d(e,qr,Ke.defaultValues(qr))),this.signatureAlgorithm=d(e,to,Ke.defaultValues(to)),this.signature=d(e,jc,Ke.defaultValues(jc)),Wr in e&&(this.unsignedAttrs=d(e,Wr,Ke.defaultValues(Wr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zi:return 0;case pn:return new ue;case eo:return new M;case qr:return new Te({type:0});case to:return new M;case jc:return new Y;case Wr:return new Te({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Zi:return Ke.defaultValues(Zi)===t;case pn:return t instanceof ue;case eo:return t instanceof M?t.isEqual(Ke.defaultValues(eo)):!1;case qr:return Te.compareWithDefault("type",t.type)&&Te.compareWithDefault("attributes",t.attributes)&&Te.compareWithDefault("encodedValue",t.encodedValue);case to:return t instanceof M?t.isEqual(Ke.defaultValues(to)):!1;case jc:case Wr:return Te.compareWithDefault("type",t.type)&&Te.compareWithDefault("attributes",t.attributes)&&Te.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:ma,value:[new H({name:t.version||If}),new Le({value:[Ye.schema(t.sidSchema||{names:{blockName:$c}}),new Le({value:[new U({optional:!0,name:t.sid||$c,idBlock:{tagClass:3,tagNumber:0},value:[new Y]}),new oe({optional:!0,name:t.sid||$c,idBlock:{tagClass:3,tagNumber:0}})]})]}),M.schema(t.digestAlgorithm||{names:{blockName:Vf}}),Te.schema(t.signedAttrs||{names:{blockName:ch,tagNumber:0}}),M.schema(t.signatureAlgorithm||{names:{blockName:xf}}),new Y({name:t.signature||Bf}),Te.schema(t.unsignedAttrs||{names:{blockName:lh,tagNumber:1}})]})}fromSchema(e){X(e,$b);const t=z(e,e,Ke.schema());q.assertSchema(t,this.className),this.version=t.result[If].valueBlock.valueDec;const s=t.result[$c];s.idBlock.tagClass===1?this.sid=new Ye({schema:s}):this.sid=s,this.digestAlgorithm=new M({schema:t.result[Vf]}),ch in t.result&&(this.signedAttrs=new Te({type:0,schema:t.result[ch]})),this.signatureAlgorithm=new M({schema:t.result[xf]}),this.signature=t.result[Bf],lh in t.result&&(this.unsignedAttrs=new Te({type:1,schema:t.result[lh]}))}toSchema(){if(Ke.compareWithDefault(pn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new H({value:this.version})),this.sid instanceof Ye?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&Ke.compareWithDefault(qr,this.signedAttrs)===!1&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&Ke.compareWithDefault(Wr,this.unsignedAttrs)===!1&&e.push(this.unsignedAttrs.toSchema()),new O({value:e})}toJSON(){if(Ke.compareWithDefault(pn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof ue||(e.sid=this.sid.toJSON()),this.signedAttrs&&Ke.compareWithDefault(qr,this.signedAttrs)===!1&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&Ke.compareWithDefault(Wr,this.unsignedAttrs)===!1&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}Ke.CLASS_NAME="SignerInfo";const Kc="version",Mc="policy",Hc="messageImprint",Fc="serialNumber",Jc="genTime",dn="ordering",gn="nonce",so="accuracy",ro="tsa",ao="extensions",gs="TSTInfo",Of=`${gs}.${Kc}`,Pf=`${gs}.${Mc}`,Df=`${gs}.${Hc}`,Tf=`${gs}.${Fc}`,Rf=`${gs}.${Jc}`,hh=`${gs}.${so}`,mh=`${gs}.${dn}`,fh=`${gs}.${gn}`,ph=`${gs}.${ro}`,dh=`${gs}.${ao}`,Kb=[Of,Pf,Df,Tf,Rf,hh,mh,fh,ph,dh];class bt extends G{constructor(e={}){super(),this.version=d(e,Kc,bt.defaultValues(Kc)),this.policy=d(e,Mc,bt.defaultValues(Mc)),this.messageImprint=d(e,Hc,bt.defaultValues(Hc)),this.serialNumber=d(e,Fc,bt.defaultValues(Fc)),this.genTime=d(e,Jc,bt.defaultValues(Jc)),so in e&&(this.accuracy=d(e,so,bt.defaultValues(so))),dn in e&&(this.ordering=d(e,dn,bt.defaultValues(dn))),gn in e&&(this.nonce=d(e,gn,bt.defaultValues(gn))),ro in e&&(this.tsa=d(e,ro,bt.defaultValues(ro))),ao in e&&(this.extensions=d(e,ao,bt.defaultValues(ao))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Kc:return 0;case Mc:return E;case Hc:return new gt;case Fc:return new H;case Jc:return new Date(0,0,0);case so:return new Ft;case dn:return!1;case gn:return new H;case ro:return new be;case ao:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Kc:case Mc:case Jc:case dn:return t===bt.defaultValues(dn);case Hc:return gt.compareWithDefault(bn,t.hashAlgorithm)&&gt.compareWithDefault(An,t.hashedMessage);case Fc:case gn:return t.isEqual(bt.defaultValues(gn));case so:return Ft.compareWithDefault(hr,t.seconds)&&Ft.compareWithDefault(mr,t.millis)&&Ft.compareWithDefault(fr,t.micros);case ro:return be.compareWithDefault(eu,t.type)&&be.compareWithDefault(tu,t.value);case ao:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||gs,value:[new H({name:t.version||Of}),new re({name:t.policy||Pf}),gt.schema(t.messageImprint||{names:{blockName:Df}}),new H({name:t.serialNumber||Tf}),new Ue({name:t.genTime||Rf}),Ft.schema(t.accuracy||{names:{blockName:hh}}),new ha({name:t.ordering||mh,optional:!0}),new H({name:t.nonce||fh,optional:!0}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[be.schema(t.tsa||{names:{blockName:ph}})]}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new he({name:t.extensions||dh,value:Je.schema(t.extension||{})})]})]})}fromSchema(e){X(e,Kb);const t=z(e,e,bt.schema());q.assertSchema(t,this.className),this.version=t.result[Of].valueBlock.valueDec,this.policy=t.result[Pf].valueBlock.toString(),this.messageImprint=new gt({schema:t.result[Df]}),this.serialNumber=t.result[Tf],this.genTime=t.result[Rf].toDate(),hh in t.result&&(this.accuracy=new Ft({schema:t.result[hh]})),mh in t.result&&(this.ordering=t.result[mh].valueBlock.value),fh in t.result&&(this.nonce=t.result[fh]),ph in t.result&&(this.tsa=new be({schema:t.result[ph]})),dh in t.result&&(this.extensions=Array.from(t.result[dh],s=>new Je({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(new re({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new Ue({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),this.ordering!==void 0&&e.push(new ha({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),this.ordering!==void 0&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async verify(e,t=me(!0)){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const s=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),n=await t.digest(a.name,new Uint8Array(s));return xe.isEqual(n,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}bt.CLASS_NAME="TSTInfo";const no="version",qc="digestAlgorithms",Wc="encapContentInfo",io="certificates",oo="crls",Gc="signerInfos",_o="ocsps",Un="SignedData",Lf=`${Un}.${no}`,gh=`${Un}.${qc}`,Uf=`${Un}.${Wc}`,wh=`${Un}.${io}`,yh=`${Un}.${oo}`,vh=`${Un}.${Gc}`,Mb=[Lf,gh,Uf,wh,yh,vh];class vt extends Error{constructor({message:e,code:t=0,date:s=new Date,signatureVerified:a=null,signerCertificate:n=null,signerCertificateVerified:i=null,timestampSerial:o=null,certificatePath:h=[]}){super(e),this.name="SignedDataVerifyError",this.date=s,this.code=t,this.timestampSerial=o,this.signatureVerified=a,this.signerCertificate=n,this.signerCertificateVerified=i,this.certificatePath=h}}class ht extends G{constructor(e={}){super(),this.version=d(e,no,ht.defaultValues(no)),this.digestAlgorithms=d(e,qc,ht.defaultValues(qc)),this.encapContentInfo=d(e,Wc,ht.defaultValues(Wc)),io in e&&(this.certificates=d(e,io,ht.defaultValues(io))),oo in e&&(this.crls=d(e,oo,ht.defaultValues(oo))),_o in e&&(this.ocsps=d(e,_o,ht.defaultValues(_o))),this.signerInfos=d(e,Gc,ht.defaultValues(Gc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case no:return 0;case qc:return[];case Wc:return new $t;case io:return[];case oo:return[];case _o:return[];case Gc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case no:return t===ht.defaultValues(no);case Wc:return $t.compareWithDefault("eContentType",t.eContentType)&&$t.compareWithDefault("eContent",t.eContent);case qc:case io:case oo:case _o:case Gc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return t.optional===void 0&&(t.optional=!1),new O({name:t.blockName||Un,optional:t.optional,value:[new H({name:t.version||Lf}),new tt({value:[new he({name:t.digestAlgorithms||gh,value:M.schema()})]}),$t.schema(t.encapContentInfo||{names:{blockName:Uf}}),new U({name:t.certificates||wh,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Cs.schema().valueBlock.value}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Qs.schema(t.crls||{names:{crls:yh}}).valueBlock.value}),new tt({value:[new he({name:t.signerInfos||vh,value:Ke.schema()})]})]})}fromSchema(e){X(e,Mb);const t=z(e,e,ht.schema());if(q.assertSchema(t,this.className),this.version=t.result[Lf].valueBlock.valueDec,gh in t.result&&(this.digestAlgorithms=Array.from(t.result[gh],s=>new M({schema:s}))),this.encapContentInfo=new $t({schema:t.result[Uf]}),wh in t.result){const s=new Cs({schema:new tt({value:t.result[wh].valueBlock.value})});this.certificates=s.certificates.slice(0)}yh in t.result&&(this.crls=Array.from(t.result[yh],s=>s.idBlock.tagClass===1?new Qe({schema:s}):(s.idBlock.tagClass=1,s.idBlock.tagNumber=16,new _s({schema:s})))),vh in t.result&&(this.signerInfos=Array.from(t.result[vh],s=>new Ke({schema:s})))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof ca)||this.crls&&this.crls.length&&this.crls.some(s=>s instanceof _s)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof Wt)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof Ws)||this.signerInfos.some(s=>s.version===3)||this.encapContentInfo.eContentType!==ht.ID_DATA?this.version=3:this.version=1,t.push(new H({value:this.version})),t.push(new tt({value:Array.from(this.digestAlgorithms,s=>s.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const s=new Cs({certificates:this.certificates}).toSchema();t.push(new U({idBlock:{tagClass:3,tagNumber:0},value:s.valueBlock.value}))}return this.crls&&t.push(new U({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,s=>{if(s instanceof _s){const a=s.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return s.toSchema(e)})})),t.push(new tt({value:Array.from(this.signerInfos,s=>s.toSchema())})),new O({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}async verify({signer:e=-1,data:t=Xe,trustedCerts:s=[],checkDate:a=new Date,checkChain:n=!1,passedWhenNotRevValues:i=!1,extendedMode:o=!1,findOrigin:h=null,findIssuer:u=null}={},c=me(!0)){let f=null,m=null;try{let y=Xe,w=E,S=[];const v=this.signerInfos[e];if(!v)throw new vt({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new vt({date:a,code:2,message:"No certificates attached to this signed data"});if(v.sid instanceof Ye){for(const k of this.certificates)if(k instanceof ve&&k.issuer.isEqual(v.sid.issuer)&&k.serialNumber.isEqual(v.sid.serialNumber)){f=k;break}}else{const k=v.sid,P=k.idBlock.isConstructed?k.valueBlock.value[0].valueBlock.valueHex:k.valueBlock.valueHex;for(const x of this.certificates){if(!(x instanceof ve))continue;const T=await c.digest({name:"sha-1"},x.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(tl(T,P)){f=x;break}}}if(!f)throw new vt({date:a,code:3,message:"Unable to find signer certificate"});if(this.encapContentInfo.eContentType===q1){if(!this.encapContentInfo.eContent)throw new vt({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0});let k;try{k=bt.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch{throw new vt({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0})}if(a=k.genTime,m=k.serialNumber.valueBlock.valueHexView.slice().buffer,t.byteLength===0)throw new vt({date:a,code:4,message:"Missed detached data input array"});if(!await k.verify({data:t},c))throw new vt({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0})}if(n){const k=this.certificates.filter(B=>B instanceof ve&&!!Yg(B,f)),P={checkDate:a,certs:k,trustedCerts:s};u&&(P.findIssuer=u),h&&(P.findOrigin=h);const x=new _h(P);if(x.certs.push(f),this.crls)for(const B of this.crls)"thisUpdate"in B?x.crls.push(B):B.otherRevInfoFormat===Xl&&x.ocsps.push(new ts({schema:B.otherRevInfo}));this.ocsps&&x.ocsps.push(...this.ocsps);const T=await x.verify({passedWhenNotRevValues:i},c).catch(B=>{throw new vt({date:a,code:5,message:`Validation of signer's certificate failed with error: ${B instanceof Object?B.resultMessage:B}`,signerCertificate:f,signerCertificateVerified:!1})});if(T.certificatePath&&(S=T.certificatePath),!T.result)throw new vt({date:a,code:5,message:`Validation of signer's certificate failed: ${T.resultMessage}`,signerCertificate:f,signerCertificateVerified:!1})}const C=c.getAlgorithmByOID(v.digestAlgorithm.algorithmId);if(!("name"in C))throw new vt({date:a,code:7,message:`Unsupported signature algorithm: ${v.digestAlgorithm.algorithmId}`,signerCertificate:f,signerCertificateVerified:!0});w=C.name;const p=this.encapContentInfo.eContent;if(p)p.idBlock.tagClass===1&&p.idBlock.tagNumber===4?t=p.getValue():t=p.valueBlock.valueBeforeDecodeView.slice().buffer;else if(t.byteLength===0)throw new vt({date:a,code:8,message:"Missed detached data input array",signerCertificate:f,signerCertificateVerified:!0});if(v.signedAttrs){let k=!1,P=!1;for(const x of v.signedAttrs.attributes)if(x.type==="1.2.840.113549.1.9.3"&&(k=!0),x.type==="1.2.840.113549.1.9.4"&&(P=!0,y=x.values[0].valueBlock.valueHex),k&&P)break;if(k===!1)throw new vt({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:f,signerCertificateVerified:!0});if(P===!1)throw new vt({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:f,signerCertificateVerified:!0})}if(v.signedAttrs){const k=await c.digest(w,new Uint8Array(t));if(!tl(k,y))throw new vt({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0});t=v.signedAttrs.encodedValue}const b=v.signatureAlgorithm.algorithmId==="1.2.840.113549.1.1.1"?await c.verifyWithPublicKey(t,v.signature,f.subjectPublicKeyInfo,v.signatureAlgorithm,w):await c.verifyWithPublicKey(t,v.signature,f.subjectPublicKeyInfo,v.signatureAlgorithm);return o?{date:a,code:14,message:E,signatureVerified:b,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0,certificatePath:S}:b}catch(y){throw y instanceof vt?y:new vt({date:a,code:15,message:`Error during verification: ${y instanceof Error?y.message:y}`,signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0})}}async sign(e,t,s="SHA-1",a=Xe,n=me(!0)){var i;if(!e)throw new Error("Need to provide a private key for signing");const o=this.signerInfos[t];if(!o)throw new RangeError("SignerInfo index is out of range");!(!((i=o.signedAttrs)===null||i===void 0)&&i.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(s=e.algorithm.hash.name);const h=n.getOIDByAlgorithm({name:s},!0,"hashAlgorithm");this.digestAlgorithms.filter(m=>m.algorithmId===h).length===0&&this.digestAlgorithms.push(new M({algorithmId:h,algorithmParams:new et})),o.digestAlgorithm=new M({algorithmId:h,algorithmParams:new et});const u=await n.getSignatureParameters(e,s),c=u.parameters;if(o.signatureAlgorithm=u.signatureAlgorithm,o.signedAttrs)if(o.signedAttrs.encodedValue.byteLength!==0)a=o.signedAttrs.encodedValue;else{a=o.signedAttrs.toSchema().toBER();const m=xe.toUint8Array(a);m[0]=49}else{const m=this.encapContentInfo.eContent;if(m)m.idBlock.tagClass===1&&m.idBlock.tagNumber===4?a=m.getValue():a=m.valueBlock.valueBeforeDecodeView.slice().buffer;else if(a.byteLength===0)throw new Error("Missed detached data input array")}const f=await n.signWithPrivateKey(a,e,c);o.signature=new Y({valueHex:f})}}ht.CLASS_NAME="SignedData",ht.ID_DATA=rp;const wn="version",yn="authSafe",Ks="macData",Qo="parsedValue",Hb=[wn,yn,Ks];class _r extends G{constructor(e={}){super(),this.version=d(e,wn,_r.defaultValues(wn)),this.authSafe=d(e,yn,_r.defaultValues(yn)),Ks in e&&(this.macData=d(e,Ks,_r.defaultValues(Ks))),Qo in e&&(this.parsedValue=d(e,Qo,_r.defaultValues(Qo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wn:return 3;case yn:return new Ce;case Ks:return new xt;case Qo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wn:return t===_r.defaultValues(e);case yn:return Ce.compareWithDefault("contentType",t.contentType)&&Ce.compareWithDefault("content",t.content);case Ks:return xt.compareWithDefault("mac",t.mac)&&xt.compareWithDefault("macSalt",t.macSalt)&&xt.compareWithDefault("iterations",t.iterations);case Qo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||wn}),Ce.schema(t.authSafe||{names:{blockName:yn}}),xt.schema(t.macData||{names:{blockName:Ks,optional:!0}})]})}fromSchema(e){X(e,Hb);const t=z(e,e,_r.schema({names:{version:wn,authSafe:{names:{blockName:yn}},macData:{names:{blockName:Ks}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new Ce({schema:t.result.authSafe}),Ks in t.result&&(this.macData=new xt({schema:t.result.macData}))}toSchema(){const e=[new H({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new O({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=me(!0)){if(Se.assert(e,"parameters","object"),!this.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(ye.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),ye.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new ye("iterations");ye.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),ye.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),ye.assertEmpty(e.password,"password");const s=new ArrayBuffer(64),a=new Uint8Array(s);t.getRandomValues(a);const n=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new Ce({contentType:Ce.DATA,content:new Y({valueHex:n})});const i=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:s,iterationCount:e.iterations,contentToStamp:n});this.macData=new xt({mac:new rs({digestAlgorithm:new M({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new Y({valueHex:i})}),macSalt:new Y({valueHex:s}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new ye("signingCertificate");ye.assertEmpty(e.privateKey,"privateKey"),ye.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const s=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new ht({version:1,encapContentInfo:new $t({eContentType:"1.2.840.113549.1.7.1",eContent:new Y({valueHex:s})}),certificates:[e.signingCertificate]}),n=await t.digest({name:e.hashAlgorithm},new Uint8Array(s)),i=[];i.push(new Be({type:"1.2.840.113549.1.9.3",values:[new re({value:"1.2.840.113549.1.7.1"})]})),i.push(new Be({type:"1.2.840.113549.1.9.5",values:[new uf({valueDate:new Date})]})),i.push(new Be({type:"1.2.840.113549.1.9.4",values:[new Y({valueHex:n})]})),a.signerInfos.push(new Ke({version:1,sid:new Ye({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new Te({type:0,attributes:i})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new Ce({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw new Error(`Parameter "integrityMode" has unknown value: ${this.parsedValue.integrityMode}`)}}async parseInternalValues(e,t=me(!0)){switch(Se.assert(e,"parameters","object"),e.checkIntegrity===void 0&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case Ce.DATA:{ye.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,Se.assert(this.authSafe.content,"authSafe.content",Y);const s=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=Tn.fromBER(s),e.checkIntegrity){if(!this.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:xe.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:s,signatureToVerify:xe.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case Ce.SIGNED_DATA:{this.parsedValue.integrityMode=1;const s=new ht({schema:this.authSafe.content}),a=s.encapContentInfo.eContent;ye.assert(a,"eContent","cmsSigned.encapContentInfo"),Se.assert(a,"eContent",Y);const n=a.getValue();if(this.parsedValue.authenticatedSafe=Tn.fromBER(n),!await s.verify({signer:0,checkChain:!1},t))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error(`Incorrect value for "this.authSafe.contentType": ${this.authSafe.contentType}`)}}}_r.CLASS_NAME="PFX";const uo="status",Gr="statusStrings",Xr="failInfo",Fb=[uo,Gr,Xr];var Kd;(function(r){r[r.granted=0]="granted",r[r.grantedWithMods=1]="grantedWithMods",r[r.rejection=2]="rejection",r[r.waiting=3]="waiting",r[r.revocationWarning=4]="revocationWarning",r[r.revocationNotification=5]="revocationNotification"})(Kd||(Kd={}));class ss extends G{constructor(e={}){super(),this.status=d(e,uo,ss.defaultValues(uo)),Gr in e&&(this.statusStrings=d(e,Gr,ss.defaultValues(Gr))),Xr in e&&(this.failInfo=d(e,Xr,ss.defaultValues(Xr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uo:return 2;case Gr:return[];case Xr:return new we;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uo:return t===ss.defaultValues(e);case Gr:return t.length===0;case Xr:return t.isEqual(ss.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.status||E}),new O({optional:!0,value:[new he({name:t.statusStrings||E,value:new Ih})]}),new we({name:t.failInfo||E,optional:!0})]})}fromSchema(e){X(e,Fb);const t=z(e,e,ss.schema({names:{status:uo,statusStrings:Gr,failInfo:Xr}}));q.assertSchema(t,this.className);const s=t.result.status;if(s.valueBlock.isHexOnly===!0||s.valueBlock.valueDec<0||s.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=s.valueBlock.valueDec,Gr in t.result&&(this.statusStrings=t.result.statusStrings),Xr in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){const e=[];return e.push(new H({value:this.status})),this.statusStrings&&e.push(new O({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new O({value:e})}toJSON(){const e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,t=>t.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}ss.CLASS_NAME="PKIStatusInfo";const Xc="version",zc="messageImprint",co="reqPolicy",lo="nonce",Ms="certReq",ho="extensions",jn="TimeStampReq",jf=`${jn}.${Xc}`,$f=`${jn}.${zc}`,bh=`${jn}.${co}`,Ah=`${jn}.${lo}`,Sh=`${jn}.${Ms}`,Nh=`${jn}.${ho}`,Jb=[jf,$f,bh,Ah,Sh,Nh];class Kt extends G{constructor(e={}){super(),this.version=d(e,Xc,Kt.defaultValues(Xc)),this.messageImprint=d(e,zc,Kt.defaultValues(zc)),co in e&&(this.reqPolicy=d(e,co,Kt.defaultValues(co))),lo in e&&(this.nonce=d(e,lo,Kt.defaultValues(lo))),Ms in e&&(this.certReq=d(e,Ms,Kt.defaultValues(Ms))),ho in e&&(this.extensions=d(e,ho,Kt.defaultValues(ho))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xc:return 0;case zc:return new gt;case co:return E;case lo:return new H;case Ms:return!1;case ho:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Xc:case co:case Ms:return t===Kt.defaultValues(e);case zc:return gt.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&gt.compareWithDefault("hashedMessage",t.hashedMessage);case lo:return t.isEqual(Kt.defaultValues(e));case ho:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||jn,value:[new H({name:t.version||jf}),gt.schema(t.messageImprint||{names:{blockName:$f}}),new re({name:t.reqPolicy||bh,optional:!0}),new H({name:t.nonce||Ah,optional:!0}),new ha({name:t.certReq||Sh,optional:!0}),new U({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new he({name:t.extensions||Nh,value:Je.schema()})]})]})}fromSchema(e){X(e,Jb);const t=z(e,e,Kt.schema());q.assertSchema(t,this.className),this.version=t.result[jf].valueBlock.valueDec,this.messageImprint=new gt({schema:t.result[$f]}),bh in t.result&&(this.reqPolicy=t.result[bh].valueBlock.toString()),Ah in t.result&&(this.nonce=t.result[Ah]),Sh in t.result&&(this.certReq=t.result[Sh].valueBlock.value),Nh in t.result&&(this.extensions=Array.from(t.result[Nh],s=>new Je({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new re({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),Ms in this&&Kt.compareWithDefault(Ms,this.certReq)===!1&&e.push(new ha({value:this.certReq})),this.extensions&&e.push(new U({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,messageImprint:this.messageImprint.toJSON()};return this.reqPolicy!==void 0&&(e.reqPolicy=this.reqPolicy),this.nonce!==void 0&&(e.nonce=this.nonce.toJSON()),this.certReq!==void 0&&Kt.compareWithDefault(Ms,this.certReq)===!1&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}}Kt.CLASS_NAME="TimeStampReq";const mo="status",fo="timeStampToken",pp="TimeStampResp",Kf=`${pp}.${mo}`,Eh=`${pp}.${fo}`,qb=[Kf,Eh];class Zc extends G{constructor(e={}){super(),this.status=d(e,mo,Zc.defaultValues(mo)),fo in e&&(this.timeStampToken=d(e,fo,Zc.defaultValues(fo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mo:return new ss;case fo:return new Ce;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mo:return ss.compareWithDefault(mo,t.status)&&!("statusStrings"in t)&&!("failInfo"in t);case fo:return t.contentType===E&&t.content instanceof ue;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||pp,value:[ss.schema(t.status||{names:{blockName:Kf}}),Ce.schema(t.timeStampToken||{names:{blockName:Eh,optional:!0}})]})}fromSchema(e){X(e,qb);const t=z(e,e,Zc.schema());q.assertSchema(t,this.className),this.status=new ss({schema:t.result[Kf]}),Eh in t.result&&(this.timeStampToken=new Ce({schema:t.result[Eh]}))}toSchema(){const e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new O({value:e})}toJSON(){const e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,s=me(!0)){return this.assertContentType(),new ht({schema:this.timeStampToken.content}).sign(e,0,t,void 0,s)}async verify(e={signer:0,trustedCerts:[],data:Xe},t=me(!0)){return this.assertContentType(),new ht({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==Hg)throw new Error(`Wrong format of timeStampToken: ${this.timeStampToken.contentType}`)}}Zc.CLASS_NAME="TimeStampResp";function Wb(){if(typeof globalThis<"u"&&"crypto"in globalThis){let r="webcrypto";"webkitSubtle"in globalThis.crypto&&(r="safari"),Ed(r,new ul({name:r,crypto:globalThis.crypto}))}else if(typeof crypto<"u"&&"webcrypto"in crypto){const r="NodeJS ^15",e=crypto.webcrypto;Ed(r,new ul({name:r,crypto:e}))}}Wb();async function dp(r,e,t={}){return await self.crypto.subtle.decrypt({name:"AES-GCM",...t},e,r)}async function Gb(r,e){return await self.crypto.subtle.decrypt({name:"RSA-OAEP"},e,r)}async function Qg(r){return await self.crypto.subtle.importKey("raw",r,{name:"AES-GCM",length:128},!0,["decrypt","encrypt"])}async function Xb(r,e){return await self.crypto.subtle.importKey("spki",r,{name:"RSASSA-PKCS1-v1_5",hash:e},!0,["verify"])}async function zb(r){return await self.crypto.subtle.importKey("pkcs8",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])}async function Yb(r){return new Uint8Array(await self.crypto.subtle.exportKey("raw",r))}async function _b(r){const e=await self.crypto.subtle.digest("SHA-256",r);return U0(new Uint8Array(e))}async function Qb(r,e){const t=new Vw(r),s=await Xb(_f(e),t.signatureAlgorithm.hash.name);return t.verify({publicKey:s},Zb())}function Zb(){return{...self.crypto,subtle:{...self.crypto.subtle,async verify(r,e,t,s){return self.crypto.subtle.verify(r,e,new Uint8Array(t),new Uint8Array(s))}}}}async function eA(r,e,t){const s=Ce.fromBER(e),a=new ht({schema:s.content}),n=a.signerInfos[0].sid.issuer.typesAndValues.find(({type:h})=>h==="2.5.4.3").value.valueBlock.value,i=t.find(({userId:h})=>h===n);if(i===void 0)throw new Error("Signer not found in the users array");const o=ve.fromBER(_f(i.certificate));return await a.verify({signer:0,trustedCerts:[o],data:r,checkChain:!0},sA())}class tA extends ul{verify(e,t,s,a){return super.verify(e,t,s,new Uint8Array(a))}}function sA(){return new tA({crypto:self.crypto})}const Md="apps/end_to_end_encryption/api/v2",Zg={PrivateKey:Md+"/private-key",ServerKey:Md+"/server-key"};async function rA(){const r=(await qd.get(Wd(Zg.PrivateKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["private-key"],[e,t,s]=r.split("|");return{encryptedPrivateKey:Es(e),iv:Es(t),salt:Es(s)}}async function aA(){return await(await qd.get(Wd(Zg.ServerKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["public-key"]}async function nA(r,e){Ze.debug("Decrypting metadata info",{metadata:r});const[t,s]=r.metadata.ciphertext.split("|"),a=await dp(Es(t),e,{iv:Es(s)}),n=JSON.parse(await uA(a));return iA(n,r),await oA(n,e),n}function iA(r,e){if(r.keyChecksums?.length!==e.users?.length)throw new Error("Key checksums length does not match users length")}async function oA(r,e){if(r.keyChecksums===void 0)return;const t=await Yb(e),s=await _b(t);if(!r.keyChecksums.includes(s))throw new Error("Key checksum is not in keyChecksums")}async function uA(r){const e=new ReadableStream({start(t){t.enqueue(new Uint8Array(r)),t.close()}}).pipeThrough(new DecompressionStream("gzip"));return await new Response(e).text()}async function cA(r,e,t){Ze.debug("Getting metadata private key",{metadata:r,userId:e});const s=r.users?.find(i=>i.userId===e);if(!s)throw new Error("User not found in metadata");const a=Es(s.encryptedMetadataKey),n=await Gb(a,t);return await Qg(new Uint8Array(n))}const lA=mw({__name:"MnemonicPromptDialog",emits:["close"],setup(r,{emit:e}){const t=e,s=rm(),a=rm(""),n=rm(!1),i=Ep(()=>n.value===!0&&a.value.trim().split(/\s+/g).length===12);function o(){t("close",a.value)}const h=Ep(()=>[{label:ya("end_to_en_encryption","Submit"),type:"submit",variant:"primary",disabled:!i.value,callback:o}]);return(u,c)=>(pw(),fw(Vs(yw),{ref_key:"dialogRef",ref:s,name:Vs(ya)("end_to_end_encryption","Enter your 12 words mnemonic"),buttons:h.value,"is-form":!0,onSubmit:o},{default:am(()=>[nm(Vs(dw),{"show-alert":"",type:"warning",heading:Vs(ya)("end_to_end_encryption","Decrypting your files in the browser can weaken security")},{default:am(()=>[Cp(kp(Vs(ya)("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" ",1),nm(Vs(gw),{modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=f=>n.value=f),required:!0,"data-cy-e2ee-mnemonic-prompt":"i_understand_the_risks",type:"switch"},{default:am(()=>[Cp(kp(Vs(ya)("end_to_end_encryption","I understand the risks")),1)]),_:1},8,["modelValue"])]),_:1},8,["heading"]),nm(Vs(ww),{modelValue:a.value,"onUpdate:modelValue":c[1]||(c[1]=f=>a.value=f),autofocus:"",required:"",pattern:"^(\\w+\\s+){11}\\w+$",label:Vs(ya)("end_to_end_encryption","Mnemonic")},null,8,["modelValue","label"])]),_:1},8,["name","buttons"]))}});async function hA(){return await vw(lA)}async function mA(r,e){Ze.debug("Decrypting private key",{privateKeyInfo:r,mnemonic:e});const t=await Promise.all([await af(e,r.salt,{hash:"SHA-256",iterations:6e5}),await af(e,r.salt,{hash:"SHA-1",iterations:1024}),await af(e,r.salt,{hash:"SHA-1",iterations:6e5})]);for(const s of t)try{const a=await dp(r.encryptedPrivateKey,s,{iv:r.iv,tagLength:128}),n=atob(L0(new Uint8Array(a)));return zb(_f(n))}catch(a){Ze.debug("Failed to decrypt private key with mnemonic",{error:a})}throw new Error("Failed to decrypt private key")}async function af(r,e,t){const s=await crypto.subtle.importKey("raw",new TextEncoder().encode(r.replaceAll(" ","")),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:e,...t},s,{name:"AES-GCM",length:256},!0,["decrypt","encrypt"])}async function Hd(r,e,t){const s=JSON.stringify(r,(n,i)=>{if(n!=="filedrop")return i}),a=await eA(Cg(btoa(s)),Es(e),t.users);if(!a)throw new Error("Metadata signature verification failed");return a}async function fA(r,e){const t=r.users.map(async({userId:s,certificate:a})=>{const n=await Qb(a,e);if(!n)throw new Error(`Certificate verification failed for user ${s}`);return n});return await Promise.all(t)}const pA=o0(),St={_userPrivateKey:void 0,_serverPublicKey:void 0,_metadataCache:{},async getUserPrivateKey(){return this._userPrivateKey??=await mA(await rA(),await hA()),this._userPrivateKey},async getServerPublicKeyPEM(){return this._serverPublicKey??=await aA(),this._serverPublicKey},async getMetadata(r){if(this._metadataCache[r])return Ze.debug("Found metadata in cache",{path:r,state:St}),this._metadataCache[r];if(Ze.debug("Fetching PROPFIND for metadata",{path:r,state:St}),await pA.stat(decodeURI(r).replace("remote.php/dav/",""),{details:!0,data:r0()}),this._metadataCache[r])return Ze.debug("Found metadata in cache after PROPFIND",{path:r,state:St}),this._metadataCache[r];throw new Error(`Could not find metadata for ${r}`)},async setMetadata(r,e,t){const s=JSON.parse(e);Gl(s)?(await Hd(s,t,s),await fA(s,await this.getServerPublicKeyPEM())):await Hd(s,t,await this.getRootMetadata(Io.dirname(r))),this._metadataCache[r]=s,Ze.debug("Added metadata in cache",{path:r,state:St})},async getMetadataInfo(r){const e=await this.getMetadata(r),t=await this.getRootMetadata(r),s=Jd();if(s===null)throw new Error("No user logged in");return nA(e,await cA(t,s.uid,await St.getUserPrivateKey()))},async getRootMetadata(r){const e=Object.entries(St._metadataCache).filter(([t])=>r.startsWith(t)).map(([,t])=>t).find(t=>Gl(t));if(e)return Ze.debug("Found root metadata in cache",{path:r,state:St}),e;for(Ze.debug("Looking for root metadata",{path:r,state:St});r!=="/";){const t=await St.getMetadata(r);if(Gl(t))return Ze.debug("Fetched root metadata",{path:r,state:St}),t;r=Io.dirname(r)}throw new Error(`Found no root metadata for ${r}`)}};let Wh;function dA(){Wh=window.fetch,Ze.debug("Setting up WebDAV decryption proxy"),window.fetch=async(r,e={})=>{let t=new Request(r,e);if(!(t.url.includes("/remote.php/dav/files/")&&(t.method==="GET"||t.method==="PROPFIND")))return Wh(t);Ze.debug(`Proxying ${t.method} ${t.url}`,{request:t});const s=new Headers(t.headers);switch(s.set("X-E2EE-SUPPORTED","true"),t=new Request(t,{headers:s}),t.method){case"PROPFIND":return wA(t);case"GET":default:return gA(t)}}}async function gA(r){const e=new URL(r.url).pathname,t=Wh(r);try{const s=await St.getMetadataInfo(Io.dirname(e)),a=s.files[Io.basename(r.url)];if(a===void 0)throw Ze.debug("Could not find file in metadata",{path:e,metadataInfo:s}),new Error("Could not find file in metadata");return await yA(await t,a)}catch{return await t}}async function wA(r){Ze.debug("Fetching raw PROPFIND",{request:r});const e=await Wh(r),t=new URL(r.url).pathname,s=await e.text(),a=await e0(s),n=Zy(a,t,!0);if(n.props?.["e2ee-is-encrypted"]!==1)return Ze.debug("Node is not e2ee",{xml:a}),new Response(s,e);if(n.type==="directory"){const i=n.props["e2ee-metadata"],o=n.props["e2ee-metadata-signature"];i!==void 0&&o!==void 0&&await St.setMetadata(t,i,o);const h=await St.getMetadata(t),u=await St.getMetadataInfo(t);if(Gl(h))nf(a,t,u);else{const c=await St.getMetadataInfo(Io.dirname(t));nf(a,t,u,c)}}else if(n.type==="file"){const i=await St.getMetadataInfo(Io.dirname(t));if(i===void 0)return Ze.debug("Cannot find metadata for parent folder",{path:t}),new Response(s,e);nf(a,t,void 0,i)}return new Response(new ea().build(a),e)}function nf(r,e,t,s){Ze.debug("Updating PROPFIND info",{path:e,decryptedMetadata:t,decryptedParentMetadata:s,xml:r}),r.multistatus.response.forEach(a=>{if(a.propstat===void 0)return;const n=a.href===e?s:t,i=a.propstat.prop.displayname;let o=i;n!==void 0&&(n.files[i]?(o=n.files[i].filename,a.propstat.prop.getcontenttype=n.files[i].mimetype):n.folders[i]&&(o=n.folders[i],a.propstat.prop.getcontenttype="httpd/unix-directory")),a.propstat.prop.displayname=o,a.propstat.prop.permissions=a.propstat.prop.permissions.replace(/(R)|(D)|(N)|(V)|(W)|(CK)/g,"")})}async function yA(r,e){Ze.debug("Decrypting encrypted file",{response:r,fileEncryptionInfo:e});const t=await dp(new Uint8Array(await r.arrayBuffer()),await Qg(Es(e.key)),{iv:Es(e.nonce)}),s=new Headers(r.headers);return s.set("Content-Type",e.mimetype),new Response(t,{...r,headers:s})}const vA=bw("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1});vA.e2eeInBrowserEnabled&&(dA(),dm("nc:e2ee-is-encrypted",{nc:"http://nextcloud.org/ns"}),dm("nc:e2ee-metadata",{nc:"http://nextcloud.org/ns"}),dm("nc:e2ee-metadata-signature",{nc:"http://nextcloud.org/ns"}),p0(k0),Fd("download"),Fd("move-copy"));function Fd(r){Ze.debug(`Inhibiting ${r} actions for e2ee files`);const e=d0().find(s=>s.id===r),t=e._action.enabled;e._action.enabled=(s,a)=>s.some(n=>n.attributes["e2ee-is-encrypted"]===1)?!1:t(s,a)}
//# sourceMappingURL=end_to_end_encryption-files.mjs.map
