(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode("/*!\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */.toastify.dialogs{min-width:200px;background:none;background-color:var(--color-main-background);color:var(--color-main-text);box-shadow:0 0 6px 0 var(--color-box-shadow);padding:0 12px;margin-top:45px;position:fixed;z-index:10100;border-radius:var(--border-radius);display:flex;align-items:center;min-height:50px}.toastify.dialogs .toast-loader-container,.toastify.dialogs .toast-undo-container{display:flex;align-items:center;width:100%}.toastify.dialogs .toast-undo-button,.toastify.dialogs .toast-close{position:static;overflow:hidden;box-sizing:border-box;min-width:44px;height:100%;padding:12px;white-space:nowrap;background-repeat:no-repeat;background-position:center;background-color:transparent;min-height:0}.toastify.dialogs .toast-undo-button.toast-close,.toastify.dialogs .toast-close.toast-close{text-indent:0;opacity:.4;border:none;min-height:44px;margin-left:10px;font-size:0}.toastify.dialogs .toast-undo-button.toast-close:before,.toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\");content:\" \";filter:var(--background-invert-if-dark);display:inline-block;width:16px;height:16px}.toastify.dialogs .toast-undo-button.toast-undo-button,.toastify.dialogs .toast-close.toast-undo-button{height:calc(100% - 6px);margin:3px 3px 3px 12px}.toastify.dialogs .toast-undo-button:hover,.toastify.dialogs .toast-undo-button:focus,.toastify.dialogs .toast-undo-button:active,.toastify.dialogs .toast-close:hover,.toastify.dialogs .toast-close:focus,.toastify.dialogs .toast-close:active{cursor:pointer;opacity:1}.toastify.dialogs.toastify-top{right:10px}.toastify.dialogs.toast-with-click{cursor:pointer}.toastify.dialogs.toast-error{border-left:3px solid var(--color-element-error, var(--color-error))}.toastify.dialogs.toast-info{border-left:3px solid var(--color-element-info, var(--color-primary))}.toastify.dialogs.toast-warning{border-left:3px solid var(--color-element-warning, var(--color-warning))}.toastify.dialogs.toast-success,.toastify.dialogs.toast-undo{border-left:3px solid var(--color-element-success, var(--color-success))}.toastify.dialogs.toast-loading{border-left:3px solid var(--color-element-info, var(--color-primary))}.toastify.dialogs.toast-loading .toast-loader{display:inline-block;width:20px;height:20px;animation:rotate var(--animation-duration, .8s) linear infinite;margin-left:auto}.theme--dark .toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill:%23fff;fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\")}.nc-generic-dialog .dialog__actions{justify-content:space-between;min-width:calc(100% - 12px)}/*!\n * SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */._file-picker__file-icon_3v9zx_9{position:relative;width:32px;height:32px;min-width:32px;min-height:32px;background-repeat:no-repeat;background-size:contain;display:flex;justify-content:center}._file-picker__file-icon--primary_3v9zx_21{color:var(--color-primary-element)}._file-picker__file-icon-overlay_3v9zx_25{color:var(--color-primary-element-text);position:absolute;inset-block-start:10px}tr.file-picker__row[data-v-15187afc]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-15187afc]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-15187afc]{padding:0 2px}tr.file-picker__row td[data-v-15187afc]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-15187afc]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-15187afc]{padding-inline:2px 0}@keyframes gradient-15187afc{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}.loading-row .row-checkbox[data-v-15187afc]{text-align:center!important}.loading-row span[data-v-15187afc]{display:inline-block;height:24px;background:linear-gradient(to right,var(--color-background-darker),var(--color-text-maxcontrast),var(--color-background-darker));background-size:600px 100%;border-radius:var(--border-radius);animation:gradient-15187afc 12s ease infinite}.loading-row .row-wrapper[data-v-15187afc]{display:inline-flex;align-items:center}.loading-row .row-checkbox span[data-v-15187afc]{width:24px}.loading-row .row-name span[data-v-15187afc]:last-of-type{margin-inline-start:6px;width:130px}.loading-row .row-size span[data-v-15187afc]{width:80px}.loading-row .row-modified span[data-v-15187afc]{width:90px}/*!\n* SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n* SPDX-License-Identifier: AGPL-3.0-or-later\n*/tr.file-picker__row[data-v-82f380c9]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-82f380c9]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-82f380c9]{padding:0 2px}tr.file-picker__row td[data-v-82f380c9]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-82f380c9]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-82f380c9]{padding-inline:2px 0}.file-picker__row *[data-v-82f380c9]{cursor:pointer}.file-picker__row--selected[data-v-82f380c9]{background-color:var(--color-background-dark)}.file-picker__row--not-navigatable[data-v-82f380c9]{filter:saturate(.7);opacity:.7}.file-picker__row--not-navigatable *[data-v-82f380c9],.file-picker__row--not-pickable *[data-v-82f380c9]{cursor:default!important}.file-picker__row[data-v-82f380c9]:hover{background-color:var(--color-background-hover)}.file-picker__name-container[data-v-82f380c9]{display:flex;justify-content:start;align-items:center;height:100%}.file-picker__file-name[data-v-82f380c9]{padding-inline-start:6px;min-width:0;overflow:hidden;text-overflow:ellipsis}.file-picker__file-extension[data-v-82f380c9]{color:var(--color-text-maxcontrast);min-width:fit-content}.file-picker__header-preview[data-v-6503afab]{width:22px;height:32px;flex:0 0 auto}.file-picker__files[data-v-6503afab]{margin:2px;margin-inline-start:12px;overflow:scroll auto}.file-picker__files table[data-v-6503afab]{width:100%;max-height:100%;table-layout:fixed}.file-picker__files th[data-v-6503afab]{position:-webkit-sticky;position:sticky;z-index:1;top:0;background-color:var(--color-main-background);padding:2px}.file-picker__files th .header-wrapper[data-v-6503afab]{display:flex}.file-picker__files th.row-checkbox[data-v-6503afab]{width:44px}.file-picker__files th.row-name[data-v-6503afab]{width:230px}.file-picker__files th.row-size[data-v-6503afab]{width:100px}.file-picker__files th.row-modified[data-v-6503afab]{width:120px}.file-picker__files th[data-v-6503afab]:not(.row-size) .button-vue__wrapper{justify-content:start;flex-direction:row-reverse}.file-picker__files th[data-v-6503afab]:not(.row-size) .button-vue{padding-inline:16px 4px}.file-picker__files th.row-size[data-v-6503afab] .button-vue__wrapper{justify-content:end}.file-picker__files th[data-v-6503afab] .button-vue__wrapper{color:var(--color-text-maxcontrast)}.file-picker__files th[data-v-6503afab] .button-vue__wrapper .button-vue__text{font-weight:400}.file-picker__breadcrumbs[data-v-1a8cb0b2]{flex-grow:0!important}.file-picker__side[data-v-f5975252]{display:flex;flex-direction:column;align-items:stretch;gap:.5rem;min-width:200px;padding:2px;margin-block-start:7px;overflow:auto}.file-picker__side[data-v-f5975252] .button-vue__wrapper{justify-content:start}.file-picker__filter-input[data-v-f5975252]{margin-block:7px;max-width:260px}@media (max-width: 736px){.file-picker__side[data-v-f5975252]{flex-direction:row;min-width:unset}}@media (max-width: 512px){.file-picker__side[data-v-f5975252]{flex-direction:row;min-width:unset}.file-picker__filter-input[data-v-f5975252]{max-width:unset}}.file-picker__navigation{padding-inline:8px 2px}.file-picker__navigation,.file-picker__navigation *{box-sizing:border-box}.file-picker__navigation .v-select.select{min-width:220px}@media (min-width: 513px) and (max-width: 736px){.file-picker__navigation{gap:11px}}@media (max-width: 512px){.file-picker__navigation{flex-direction:column-reverse!important}}.file-picker__view[data-v-dda9b42b]{height:50px;display:flex;justify-content:start;align-items:center}.file-picker__view h3[data-v-dda9b42b]{font-weight:700;height:fit-content;margin:0}.file-picker__main[data-v-dda9b42b]{box-sizing:border-box;width:100%;display:flex;flex-direction:column;min-height:0;flex:1;padding-inline:2px}.file-picker__main *[data-v-dda9b42b]{box-sizing:border-box}[data-v-dda9b42b] .file-picker{height:min(80vh,800px)!important}@media (max-width: 512px){[data-v-dda9b42b] .file-picker{height:calc(100% - 16px - var(--default-clickable-area))!important}}[data-v-dda9b42b] .file-picker__content{display:flex;flex-direction:column;overflow:hidden}.public-auth-prompt__text[data-v-a2f36bdb]{font-size:1.25em;margin-block:0 calc(3 * var(--default-grid-baseline))}.public-auth-prompt__header[data-v-a2f36bdb]{margin-block:0 calc(3 * var(--default-grid-baseline))}.public-auth-prompt__header[data-v-a2f36bdb]:first-child{margin-top:0}.public-auth-prompt__input[data-v-a2f36bdb]{margin-block:calc(4 * var(--default-grid-baseline)) calc(2 * var(--default-grid-baseline))}.material-design-icon[data-v-a3ad91bd]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}/*!\n * SPDX-FileCopyrightText: 2025 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */.input-field[data-v-a3ad91bd]{--input-border-color: var(--color-border-maxcontrast);--input-border-radius: var(--border-radius-element);--input-padding-start: var(--border-radius-large);--input-padding-end: var(--border-radius-large);position:relative;width:100%;margin-block-start:6px}.input-field--disabled[data-v-a3ad91bd]{opacity:.4;filter:saturate(.4)}.input-field--label-outside[data-v-a3ad91bd]{margin-block-start:0}.input-field--leading-icon[data-v-a3ad91bd]{--input-padding-start: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--trailing-icon[data-v-a3ad91bd]{--input-padding-end: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--pill[data-v-a3ad91bd]{--input-border-radius: var(--border-radius-pill)}.input-field__main-wrapper[data-v-a3ad91bd]{height:var(--default-clickable-area);padding:var(--border-width-input-focused, 2px);position:relative}.input-field__input[data-v-a3ad91bd]{--input-border-box-shadow-light: 0 -1px var(--input-border-color), 0 0 0 1px color-mix(in srgb, var(--input-border-color), 65% transparent);--input-border-box-shadow-dark: 0 1px var(--input-border-color), 0 0 0 1px color-mix(in srgb, var(--input-border-color), 65% transparent);--input-border-box-shadow: var(--input-border-box-shadow-light);border:none;border-radius:var(--border-radius-element);box-shadow:var(--input-border-box-shadow)}.input-field__input[data-v-a3ad91bd]:hover:not([disabled]){box-shadow:0 0 0 1px var(--input-border-color)}@media (prefers-color-scheme: dark){.input-field__input .input-field__input[data-v-a3ad91bd]{--input-border-box-shadow: var(--input-border-box-shadow-dark)}}[data-theme-dark] .input-field__input[data-v-a3ad91bd]{--input-border-box-shadow: var(--input-border-box-shadow-dark)}[data-theme-light] .input-field__input[data-v-a3ad91bd]{--input-border-box-shadow: var(--input-border-box-shadow-light)}.input-field--legacy .input-field__input[data-v-a3ad91bd]{box-shadow:0 0 0 1px var(--input-border-color)}.input-field--legacy .input-field__input[data-v-a3ad91bd]:hover:not([disabled]){box-shadow:0 0 0 2px var(--input-border-color)}.input-field__input[data-v-a3ad91bd]:focus-within:not([disabled]),.input-field__input[data-v-a3ad91bd]:active:not([disabled]){box-shadow:0 0 0 2px var(--input-border-color),0 0 0 4px var(--color-main-background)!important}.input-field__input[data-v-a3ad91bd]{background-color:var(--color-main-background);color:var(--color-main-text);border-radius:var(--input-border-radius);cursor:pointer;-webkit-appearance:textfield!important;-moz-appearance:textfield!important;appearance:textfield!important;font-size:var(--default-font-size);text-overflow:ellipsis;padding-block:0;padding-inline:var(--input-padding-start) var(--input-padding-end);height:100%!important;min-height:unset;width:100%}.input-field__input[data-v-a3ad91bd]::placeholder{color:var(--color-text-maxcontrast)}.input-field__input[data-v-a3ad91bd]::-webkit-search-cancel-button{display:none}.input-field__input[data-v-a3ad91bd]::-webkit-search-decoration,.input-field__input[data-v-a3ad91bd]::-webkit-search-results-button,.input-field__input[data-v-a3ad91bd]::-webkit-search-results-decoration,.input-field__input[data-v-a3ad91bd]::-ms-clear{display:none}.input-field__input[data-v-a3ad91bd]:active:not([disabled]),.input-field__input[data-v-a3ad91bd]:focus:not([disabled]){--input-border-color: var(--color-main-text)}.input-field__input:focus+.input-field__label[data-v-a3ad91bd],.input-field__input:hover:not(:placeholder-shown)+.input-field__label[data-v-a3ad91bd]{color:var(--color-main-text)}.input-field__input[data-v-a3ad91bd]:focus{cursor:text}.input-field__input[data-v-a3ad91bd]:disabled{cursor:default}.input-field__input[data-v-a3ad91bd]:focus-visible{box-shadow:unset!important}.input-field__input--success[data-v-a3ad91bd]{border-color:var(--color-border-success, var(--color-success))!important}.input-field__input--success[data-v-a3ad91bd]:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field__input--error[data-v-a3ad91bd],.input-field__input[data-v-a3ad91bd]:user-invalid{border-color:var(--color-border-error, var(--color-error))!important}.input-field__input--error[data-v-a3ad91bd]:focus-visible,.input-field__input[data-v-a3ad91bd]:user-invalid:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field:not(.input-field--label-outside) .input-field__input[data-v-a3ad91bd]:not(:focus)::placeholder{opacity:0}.input-field__label[data-v-a3ad91bd]{--input-label-font-size: var(--default-font-size);position:absolute;margin-inline:var(--input-padding-start) var(--input-padding-end);max-width:fit-content;font-size:var(--input-label-font-size);inset-block-start:calc((var(--default-clickable-area) - 1lh) / 2);inset-inline:var(--border-width-input-focused, 2px);color:var(--color-text-maxcontrast);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;pointer-events:none;transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick),background-color var(--animation-quick) var(--animation-slow)}.input-field__input:focus+.input-field__label[data-v-a3ad91bd],.input-field__input:not(:placeholder-shown)+.input-field__label[data-v-a3ad91bd]{--input-label-font-size: 13px;line-height:1.5;inset-block-start:calc(-1.5 * var(--input-label-font-size) / 2);font-weight:500;border-radius:var(--default-grid-baseline) var(--default-grid-baseline) 0 0;background-color:var(--color-main-background);padding-inline:var(--default-grid-baseline);margin-inline:calc(var(--input-padding-start) - var(--default-grid-baseline)) calc(var(--input-padding-end) - var(--default-grid-baseline));transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick)}.input-field__icon[data-v-a3ad91bd]{position:absolute;height:var(--default-clickable-area);width:var(--default-clickable-area);display:flex;align-items:center;justify-content:center;opacity:.7;inset-block-end:0}.input-field__icon--leading[data-v-a3ad91bd]{inset-inline-start:0px}.input-field__icon--trailing[data-v-a3ad91bd]{inset-inline-end:0px}.input-field__trailing-button[data-v-a3ad91bd]{--button-size: calc(var(--default-clickable-area) - 2 * var(--border-width-input-focused, 2px)) !important;--button-radius: calc(var(--input-border-radius) - var(--border-width-input-focused, 2px))}.input-field__trailing-button.button-vue[data-v-a3ad91bd]{position:absolute;top:var(--border-width-input-focused, 2px);inset-inline-end:var(--border-width-input-focused, 2px)}.input-field__trailing-button.button-vue[data-v-a3ad91bd]:focus-visible{box-shadow:none!important}.input-field__helper-text-message[data-v-a3ad91bd]{padding-block:4px;padding-inline:var(--border-radius-large);display:flex;align-items:center;color:var(--color-text-maxcontrast);word-break:break-all}.input-field__helper-text-message__icon[data-v-a3ad91bd]{margin-inline-end:8px}.input-field__helper-text-message--error[data-v-a3ad91bd]{color:var(--color-text-error, var(--color-error))}.input-field--error .input-field__input[data-v-a3ad91bd],.input-field__input[data-v-a3ad91bd]:user-invalid{--input-border-color: var(--color-border-error, var(--color-error)) !important}.input-field--error .input-field__input[data-v-a3ad91bd]:focus-visible,.input-field__input[data-v-a3ad91bd]:user-invalid:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field--success .input-field__input[data-v-a3ad91bd]{--input-border-color: var(--color-border-success, var(--color-success)) !important}.input-field--success .input-field__input[data-v-a3ad91bd]:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}")),document.head.appendChild(a)}}catch(i){console.error("vite-plugin-css-injected-by-js",i)}})();
var gy=Object.defineProperty,wy=Object.defineProperties;var yy=Object.getOwnPropertyDescriptors;var ud=Object.getOwnPropertySymbols;var vy=Object.prototype.hasOwnProperty,by=Object.prototype.propertyIsEnumerable;var ld=r=>{throw TypeError(r)};var Pm=(r,e,t)=>e in r?gy(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,It=(r,e)=>{for(var t in e||(e={}))vy.call(e,t)&&Pm(r,t,e[t]);if(ud)for(var t of ud(e))by.call(e,t)&&Pm(r,t,e[t]);return r},xs=(r,e)=>wy(r,yy(e));var st=(r,e,t)=>Pm(r,typeof e!="symbol"?e+"":e,t),Om=(r,e,t)=>e.has(r)||ld("Cannot "+t);var X=(r,e,t)=>(Om(r,e,"read from private field"),t?t.call(r):e.get(r)),_t=(r,e,t)=>e.has(r)?ld("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),qe=(r,e,t,s)=>(Om(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),dr=(r,e,t)=>(Om(r,e,"access private method"),t);import{p as ct,g as zt,a as Uf,b as Ep,c as Ay,d as Sy,o as Ny,e as Ey,B as Dm,f as Jg,h as qg,n as Am,N as ky,l as Iy,i as cd,G as Cy,r as By,t as xy,j as Vy,k as Py,m as Kc,q as Oy,s as Dy,u as Ty,v as Ry,w as Tm,x as hd,y as jf,z as Ly,A as Uy}from"./_plugin-vue2_normalizer-DKrpQda6.chunk.mjs";import{f as Ye,B as xe,s as Go,a as Zh,O as W,N as nt,g as f,S as B,I as $,C as T,R as ue,c as q,b as _,d as Z,e as pe,h as je,A as ne,P as ae,i as Ae,j as it,k as kc,n as jy,l as Ic,m as em,u as Ko,t as $f,G as $e,o as Ba,U as Mf,T as Kf,p as rr,q as Hf,r as tm,v as Ff,w as _g,x as yh,V as $y,y as My,z as Ky,D as Hy,E as Fy,F as Cc,H as Jy,J as md,K as fd,X as qy,L as zo}from"./x509.es-CPXDVI1b.chunk.mjs";import{N as _y,a as Wy,b as Gy,s as zy}from"./NcCheckboxRadioSwitch-Di43R9CE-BgI65G5A.chunk.mjs";import{u as Wg}from"./useModelMigration-EhAWvqDD-BAt25w2u.chunk.mjs";function Gg(r,e,t){var n;const s="#initial-state-".concat(r,"-").concat(e);if((n=window._nc_initial_state)!=null&&n.has(s))return window._nc_initial_state.get(s);window._nc_initial_state||(window._nc_initial_state=new Map);const a=document.querySelector(s);if(a===null)return t;try{const i=JSON.parse(atob(a.value));return window._nc_initial_state.set(s,i),i}catch(i){return console.error("[@nextcloud/initial-state] Could not parse initial state",{key:e,app:r,error:i}),t}}function zg(){var r;return(r=Gg("files_sharing","isPublic",null))!=null?r:document.querySelector('input#isPublic[type="hidden"][name="isPublic"][value="1"]')!==null}function Xy(){var r,e,t;return(t=(e=Gg("files_sharing","sharingToken",null))!=null?e:(r=document.querySelector('input#sharingToken[type="hidden"]'))==null?void 0:r.value)!=null?t:null}function Sr(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function pd(r,e,t){Yy(r,e),e.set(r,t)}function Yy(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Nt(r,e){var t=Xg(r,e,"get");return Qy(r,t)}function Qy(r,e){return e.get?e.get.call(r):e.value}function dd(r,e,t){var s=Xg(r,e,"set");return Zy(r,s,t),t}function Xg(r,e,t){if(!e.has(r))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(r)}function Zy(r,e,t){if(e.set)e.set.call(r,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}var e0=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",Ct=new WeakMap,nu=new WeakMap;class Sm{constructor(e){var{executor:t=()=>{},internals:s=Ip(),promise:a=new Promise((n,i)=>t(n,i,o=>{s.onCancelList.push(o)}))}=e;pd(this,Ct,{writable:!0,value:void 0}),pd(this,nu,{writable:!0,value:void 0}),Sr(this,e0,"CancelablePromise"),this.cancel=this.cancel.bind(this),dd(this,Ct,s),dd(this,nu,a||new Promise((n,i)=>t(n,i,o=>{s.onCancelList.push(o)})))}then(e,t){return vh(Nt(this,nu).then(Hc(e,Nt(this,Ct)),Hc(t,Nt(this,Ct))),Nt(this,Ct))}catch(e){return vh(Nt(this,nu).catch(Hc(e,Nt(this,Ct))),Nt(this,Ct))}finally(e,t){return t&&Nt(this,Ct).onCancelList.push(e),vh(Nt(this,nu).finally(Hc(()=>{if(e)return t&&(Nt(this,Ct).onCancelList=Nt(this,Ct).onCancelList.filter(s=>s!==e)),e()},Nt(this,Ct))),Nt(this,Ct))}cancel(){Nt(this,Ct).isCanceled=!0;var e=Nt(this,Ct).onCancelList;Nt(this,Ct).onCancelList=[];for(var t of e)if(typeof t=="function")try{t()}catch(s){console.error(s)}}isCanceled(){return Nt(this,Ct).isCanceled===!0}}class Nr extends Sm{constructor(e){super({executor:e})}}Sr(Nr,"all",function(r){return Fc(r,Promise.all(r))}),Sr(Nr,"allSettled",function(r){return Fc(r,Promise.allSettled(r))}),Sr(Nr,"any",function(r){return Fc(r,Promise.any(r))}),Sr(Nr,"race",function(r){return Fc(r,Promise.race(r))}),Sr(Nr,"resolve",function(r){return gd(Promise.resolve(r))}),Sr(Nr,"reject",function(r){return gd(Promise.reject(r))}),Sr(Nr,"isCancelable",kp);function gd(r){return vh(r,Ip())}function kp(r){return r instanceof Nr||r instanceof Sm}function Hc(r,e){if(r)return t=>{if(!e.isCanceled){var s=r(t);return kp(s)&&e.onCancelList.push(s.cancel),s}return t}}function vh(r,e){return new Sm({internals:e,promise:r})}function Fc(r,e){var t=Ip();return t.onCancelList.push(()=>{for(var s of r)kp(s)&&s.cancel()}),new Sm({internals:t,promise:e})}function Ip(){return{isCanceled:!1,onCancelList:[]}}var Rm={},t0={2:r=>{function e(a,n,i){a instanceof RegExp&&(a=t(a,i)),n instanceof RegExp&&(n=t(n,i));var o=s(a,n,i);return o&&{start:o[0],end:o[1],pre:i.slice(0,o[0]),body:i.slice(o[0]+a.length,o[1]),post:i.slice(o[1]+n.length)}}function t(a,n){var i=n.match(a);return i?i[0]:null}function s(a,n,i){var o,u,h,l,d,m=i.indexOf(a),N=i.indexOf(n,m+1),y=m;if(m>=0&&N>0){for(o=[],h=i.length;y>=0&&!d;)y==m?(o.push(y),m=i.indexOf(a,y+1)):o.length==1?d=[o.pop(),N]:((u=o.pop())<h&&(h=u,l=N),N=i.indexOf(n,y+1)),y=m<N&&m>=0?m:N;o.length&&(d=[h,l])}return d}r.exports=e,e.range=s},47:(r,e,t)=>{var s=t(410),a=function(h){return typeof h=="string"};function n(h,l){for(var d=[],m=0;m<h.length;m++){var N=h[m];N&&N!=="."&&(N===".."?d.length&&d[d.length-1]!==".."?d.pop():l&&d.push(".."):d.push(N))}return d}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o={};function u(h){return i.exec(h).slice(1)}o.resolve=function(){for(var h="",l=!1,d=arguments.length-1;d>=-1&&!l;d--){var m=d>=0?arguments[d]:ct.cwd();if(!a(m))throw new TypeError("Arguments to path.resolve must be strings");m&&(h=m+"/"+h,l=m.charAt(0)==="/")}return(l?"/":"")+(h=n(h.split("/"),!l).join("/"))||"."},o.normalize=function(h){var l=o.isAbsolute(h),d=h.substr(-1)==="/";return(h=n(h.split("/"),!l).join("/"))||l||(h="."),h&&d&&(h+="/"),(l?"/":"")+h},o.isAbsolute=function(h){return h.charAt(0)==="/"},o.join=function(){for(var h="",l=0;l<arguments.length;l++){var d=arguments[l];if(!a(d))throw new TypeError("Arguments to path.join must be strings");d&&(h+=h?"/"+d:d)}return o.normalize(h)},o.relative=function(h,l){function d(A){for(var k=0;k<A.length&&A[k]==="";k++);for(var C=A.length-1;C>=0&&A[C]==="";C--);return k>C?[]:A.slice(k,C+1)}h=o.resolve(h).substr(1),l=o.resolve(l).substr(1);for(var m=d(h.split("/")),N=d(l.split("/")),y=Math.min(m.length,N.length),w=y,g=0;g<y;g++)if(m[g]!==N[g]){w=g;break}var S=[];for(g=w;g<m.length;g++)S.push("..");return(S=S.concat(N.slice(w))).join("/")},o._makeLong=function(h){return h},o.dirname=function(h){var l=u(h),d=l[0],m=l[1];return d||m?(m&&(m=m.substr(0,m.length-1)),d+m):"."},o.basename=function(h,l){var d=u(h)[2];return l&&d.substr(-1*l.length)===l&&(d=d.substr(0,d.length-l.length)),d},o.extname=function(h){return u(h)[3]},o.format=function(h){if(!s.isObject(h))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof h);var l=h.root||"";if(!a(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof h.root);return(h.dir?h.dir+o.sep:"")+(h.base||"")},o.parse=function(h){if(!a(h))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof h);var l=u(h);if(!l||l.length!==4)throw new TypeError("Invalid path '"+h+"'");return l[1]=l[1]||"",l[2]=l[2]||"",l[3]=l[3]||"",{root:l[0],dir:l[0]+l[1].slice(0,l[1].length-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},o.sep="/",o.delimiter=":",r.exports=o},101:function(r,e,t){var s;r=t.nmd(r),function(){var a=(r&&r.exports,typeof zt=="object"&&zt);a.global!==a&&a.window;var n=function(l){this.message=l};(n.prototype=new Error).name="InvalidCharacterError";var i=function(l){throw new n(l)},o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=/[\t\n\f\r ]/g,h={encode:function(l){l=String(l),/[^\0-\xFF]/.test(l)&&i("The string to be encoded contains characters outside of the Latin1 range.");for(var d,m,N,y,w=l.length%3,g="",S=-1,A=l.length-w;++S<A;)d=l.charCodeAt(S)<<16,m=l.charCodeAt(++S)<<8,N=l.charCodeAt(++S),g+=o.charAt((y=d+m+N)>>18&63)+o.charAt(y>>12&63)+o.charAt(y>>6&63)+o.charAt(63&y);return w==2?(d=l.charCodeAt(S)<<8,m=l.charCodeAt(++S),g+=o.charAt((y=d+m)>>10)+o.charAt(y>>4&63)+o.charAt(y<<2&63)+"="):w==1&&(y=l.charCodeAt(S),g+=o.charAt(y>>2)+o.charAt(y<<4&63)+"=="),g},decode:function(l){var d=(l=String(l).replace(u,"")).length;d%4==0&&(d=(l=l.replace(/==?$/,"")).length),(d%4==1||/[^+a-zA-Z0-9/]/.test(l))&&i("Invalid character: the string to be decoded is not correctly encoded.");for(var m,N,y=0,w="",g=-1;++g<d;)N=o.indexOf(l.charAt(g)),m=y%4?64*m+N:N,y++%4&&(w+=String.fromCharCode(255&m>>(-2*y&6)));return w},version:"1.0.0"};(s=function(){return h}.call(e,t,e,r))===void 0||(r.exports=s)}()},135:r=>{function e(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}r.exports=function(t){return t!=null&&(e(t)||function(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&e(s.slice(0,0))}(t)||!!t._isBuffer)}},172:(r,e)=>{e.d=function(t){if(!t)return 0;for(var s=(t=t.toString()).length,a=t.length;a--;){var n=t.charCodeAt(a);56320<=n&&n<=57343&&a--,127<n&&n<=2047?s++:2047<n&&n<=65535&&(s+=2)}return s}},285:(r,e,t)=>{var s=t(2);r.exports=function(S){return S?(S.substr(0,2)==="{}"&&(S="\\{\\}"+S.substr(2)),g(function(A){return A.split("\\\\").join(a).split("\\{").join(n).split("\\}").join(i).split("\\,").join(o).split("\\.").join(u)}(S),!0).map(l)):[]};var a="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",i="\0CLOSE"+Math.random()+"\0",o="\0COMMA"+Math.random()+"\0",u="\0PERIOD"+Math.random()+"\0";function h(S){return parseInt(S,10)==S?parseInt(S,10):S.charCodeAt(0)}function l(S){return S.split(a).join("\\").split(n).join("{").split(i).join("}").split(o).join(",").split(u).join(".")}function d(S){if(!S)return[""];var A=[],k=s("{","}",S);if(!k)return S.split(",");var C=k.pre,V=k.body,M=k.post,U=C.split(",");U[U.length-1]+="{"+V+"}";var H=d(M);return M.length&&(U[U.length-1]+=H.shift(),U.push.apply(U,H)),A.push.apply(A,U),A}function m(S){return"{"+S+"}"}function N(S){return/^-?0\d/.test(S)}function y(S,A){return S<=A}function w(S,A){return S>=A}function g(S,A){var k=[],C=s("{","}",S);if(!C)return[S];var V=C.pre,M=C.post.length?g(C.post,!1):[""];if(/\$$/.test(C.pre))for(var U=0;U<M.length;U++){var H=V+"{"+C.body+"}"+M[U];k.push(H)}else{var x,Y,ee=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(C.body),O=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(C.body),G=ee||O,we=C.body.indexOf(",")>=0;if(!G&&!we)return C.post.match(/,(?!,).*\}/)?g(S=C.pre+"{"+C.body+i+C.post):[S];if(G)x=C.body.split(/\.\./);else if((x=d(C.body)).length===1&&(x=g(x[0],!1).map(m)).length===1)return M.map(function(Fe){return C.pre+x[0]+Fe});if(G){var le=h(x[0]),Se=h(x[1]),re=Math.max(x[0].length,x[1].length),be=x.length==3?Math.abs(h(x[2])):1,de=y;Se<le&&(be*=-1,de=w);var te=x.some(N);Y=[];for(var se=le;de(se,Se);se+=be){var Q;if(O)(Q=String.fromCharCode(se))==="\\"&&(Q="");else if(Q=String(se),te){var ie=re-Q.length;if(ie>0){var he=new Array(ie+1).join("0");Q=se<0?"-"+he+Q.slice(1):he+Q}}Y.push(Q)}}else{Y=[];for(var Ce=0;Ce<x.length;Ce++)Y.push.apply(Y,g(x[Ce],!1))}for(Ce=0;Ce<Y.length;Ce++)for(U=0;U<M.length;U++)H=V+Y[Ce]+M[U],(!A||G||H)&&k.push(H)}return k}},298:r=>{var e,t;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(s,a){return s<<a|s>>>32-a},rotr:function(s,a){return s<<32-a|s>>>a},endian:function(s){if(s.constructor==Number)return 16711935&t.rotl(s,8)|4278255360&t.rotl(s,24);for(var a=0;a<s.length;a++)s[a]=t.endian(s[a]);return s},randomBytes:function(s){for(var a=[];s>0;s--)a.push(Math.floor(256*Math.random()));return a},bytesToWords:function(s){for(var a=[],n=0,i=0;n<s.length;n++,i+=8)a[i>>>5]|=s[n]<<24-i%32;return a},wordsToBytes:function(s){for(var a=[],n=0;n<32*s.length;n+=8)a.push(s[n>>>5]>>>24-n%32&255);return a},bytesToHex:function(s){for(var a=[],n=0;n<s.length;n++)a.push((s[n]>>>4).toString(16)),a.push((15&s[n]).toString(16));return a.join("")},hexToBytes:function(s){for(var a=[],n=0;n<s.length;n+=2)a.push(parseInt(s.substr(n,2),16));return a},bytesToBase64:function(s){for(var a=[],n=0;n<s.length;n+=3)for(var i=s[n]<<16|s[n+1]<<8|s[n+2],o=0;o<4;o++)8*n+6*o<=8*s.length?a.push(e.charAt(i>>>6*(3-o)&63)):a.push("=");return a.join("")},base64ToBytes:function(s){s=s.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],n=0,i=0;n<s.length;i=++n%4)i!=0&&a.push((e.indexOf(s.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|e.indexOf(s.charAt(n))>>>6-2*i);return a}},r.exports=t},345:()=>{},388:()=>{},410:()=>{},526:r=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var s=[],a=0;a<t.length;a++)s.push(255&t.charCodeAt(a));return s},bytesToString:function(t){for(var s=[],a=0;a<t.length;a++)s.push(String.fromCharCode(t[a]));return s.join("")}}};r.exports=e},542:(r,e,t)=>{(function(){var s=t(298),a=t(526).utf8,n=t(135),i=t(526).bin,o=function(u,h){u.constructor==String?u=h&&h.encoding==="binary"?i.stringToBytes(u):a.stringToBytes(u):n(u)?u=Array.prototype.slice.call(u,0):Array.isArray(u)||u.constructor===Uint8Array||(u=u.toString());for(var l=s.bytesToWords(u),d=8*u.length,m=1732584193,N=-271733879,y=-1732584194,w=271733878,g=0;g<l.length;g++)l[g]=16711935&(l[g]<<8|l[g]>>>24)|4278255360&(l[g]<<24|l[g]>>>8);l[d>>>5]|=128<<d%32,l[14+(d+64>>>9<<4)]=d;var S=o._ff,A=o._gg,k=o._hh,C=o._ii;for(g=0;g<l.length;g+=16){var V=m,M=N,U=y,H=w;m=S(m,N,y,w,l[g+0],7,-680876936),w=S(w,m,N,y,l[g+1],12,-389564586),y=S(y,w,m,N,l[g+2],17,606105819),N=S(N,y,w,m,l[g+3],22,-1044525330),m=S(m,N,y,w,l[g+4],7,-176418897),w=S(w,m,N,y,l[g+5],12,1200080426),y=S(y,w,m,N,l[g+6],17,-1473231341),N=S(N,y,w,m,l[g+7],22,-45705983),m=S(m,N,y,w,l[g+8],7,1770035416),w=S(w,m,N,y,l[g+9],12,-1958414417),y=S(y,w,m,N,l[g+10],17,-42063),N=S(N,y,w,m,l[g+11],22,-1990404162),m=S(m,N,y,w,l[g+12],7,1804603682),w=S(w,m,N,y,l[g+13],12,-40341101),y=S(y,w,m,N,l[g+14],17,-1502002290),m=A(m,N=S(N,y,w,m,l[g+15],22,1236535329),y,w,l[g+1],5,-165796510),w=A(w,m,N,y,l[g+6],9,-1069501632),y=A(y,w,m,N,l[g+11],14,643717713),N=A(N,y,w,m,l[g+0],20,-373897302),m=A(m,N,y,w,l[g+5],5,-701558691),w=A(w,m,N,y,l[g+10],9,38016083),y=A(y,w,m,N,l[g+15],14,-660478335),N=A(N,y,w,m,l[g+4],20,-405537848),m=A(m,N,y,w,l[g+9],5,568446438),w=A(w,m,N,y,l[g+14],9,-1019803690),y=A(y,w,m,N,l[g+3],14,-187363961),N=A(N,y,w,m,l[g+8],20,1163531501),m=A(m,N,y,w,l[g+13],5,-1444681467),w=A(w,m,N,y,l[g+2],9,-51403784),y=A(y,w,m,N,l[g+7],14,1735328473),m=k(m,N=A(N,y,w,m,l[g+12],20,-1926607734),y,w,l[g+5],4,-378558),w=k(w,m,N,y,l[g+8],11,-2022574463),y=k(y,w,m,N,l[g+11],16,1839030562),N=k(N,y,w,m,l[g+14],23,-35309556),m=k(m,N,y,w,l[g+1],4,-1530992060),w=k(w,m,N,y,l[g+4],11,1272893353),y=k(y,w,m,N,l[g+7],16,-155497632),N=k(N,y,w,m,l[g+10],23,-1094730640),m=k(m,N,y,w,l[g+13],4,681279174),w=k(w,m,N,y,l[g+0],11,-358537222),y=k(y,w,m,N,l[g+3],16,-722521979),N=k(N,y,w,m,l[g+6],23,76029189),m=k(m,N,y,w,l[g+9],4,-640364487),w=k(w,m,N,y,l[g+12],11,-421815835),y=k(y,w,m,N,l[g+15],16,530742520),m=C(m,N=k(N,y,w,m,l[g+2],23,-995338651),y,w,l[g+0],6,-198630844),w=C(w,m,N,y,l[g+7],10,1126891415),y=C(y,w,m,N,l[g+14],15,-1416354905),N=C(N,y,w,m,l[g+5],21,-57434055),m=C(m,N,y,w,l[g+12],6,1700485571),w=C(w,m,N,y,l[g+3],10,-1894986606),y=C(y,w,m,N,l[g+10],15,-1051523),N=C(N,y,w,m,l[g+1],21,-2054922799),m=C(m,N,y,w,l[g+8],6,1873313359),w=C(w,m,N,y,l[g+15],10,-30611744),y=C(y,w,m,N,l[g+6],15,-1560198380),N=C(N,y,w,m,l[g+13],21,1309151649),m=C(m,N,y,w,l[g+4],6,-145523070),w=C(w,m,N,y,l[g+11],10,-1120210379),y=C(y,w,m,N,l[g+2],15,718787259),N=C(N,y,w,m,l[g+9],21,-343485551),m=m+V>>>0,N=N+M>>>0,y=y+U>>>0,w=w+H>>>0}return s.endian([m,N,y,w])};o._ff=function(u,h,l,d,m,N,y){var w=u+(h&l|~h&d)+(m>>>0)+y;return(w<<N|w>>>32-N)+h},o._gg=function(u,h,l,d,m,N,y){var w=u+(h&d|l&~d)+(m>>>0)+y;return(w<<N|w>>>32-N)+h},o._hh=function(u,h,l,d,m,N,y){var w=u+(h^l^d)+(m>>>0)+y;return(w<<N|w>>>32-N)+h},o._ii=function(u,h,l,d,m,N,y){var w=u+(l^(h|~d))+(m>>>0)+y;return(w<<N|w>>>32-N)+h},o._blocksize=16,o._digestsize=16,r.exports=function(u,h){if(u==null)throw new Error("Illegal argument "+u);var l=s.wordsToBytes(o(u,h));return h&&h.asBytes?l:h&&h.asString?i.bytesToString(l):s.bytesToHex(l)}})()},647:(r,e)=>{var t=Object.prototype.hasOwnProperty;function s(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch(i){return null}}function a(n){try{return encodeURIComponent(n)}catch(i){return null}}e.stringify=function(n,i){i=i||"";var o,u,h=[];for(u in typeof i!="string"&&(i="?"),n)if(t.call(n,u)){if((o=n[u])||o!=null&&!isNaN(o)||(o=""),u=a(u),o=a(o),u===null||o===null)continue;h.push(u+"="+o)}return h.length?i+h.join("&"):""},e.parse=function(n){for(var i,o=/([^=?#&]+)=?([^&]*)/g,u={};i=o.exec(n);){var h=s(i[1]),l=s(i[2]);h===null||l===null||h in u||(u[h]=l)}return u}},670:r=>{r.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}},737:(r,e,t)=>{var s=t(670),a=t(647),n=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,i=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,u=/:\d+$/,h=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,l=/^[a-zA-Z]:/;function d(A){return(A||"").toString().replace(n,"")}var m=[["#","hash"],["?","query"],function(A,k){return w(k.protocol)?A.replace(/\\/g,"/"):A},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],N={hash:1,query:1};function y(A){var k,C=(typeof window<"u"?window:typeof zt<"u"?zt:typeof self<"u"?self:{}).location||{},V={},M=typeof(A=A||C);if(A.protocol==="blob:")V=new S(unescape(A.pathname),{});else if(M==="string")for(k in V=new S(A,{}),N)delete V[k];else if(M==="object"){for(k in A)k in N||(V[k]=A[k]);V.slashes===void 0&&(V.slashes=o.test(A.href))}return V}function w(A){return A==="file:"||A==="ftp:"||A==="http:"||A==="https:"||A==="ws:"||A==="wss:"}function g(A,k){A=(A=d(A)).replace(i,""),k=k||{};var C,V=h.exec(A),M=V[1]?V[1].toLowerCase():"",U=!!V[2],H=!!V[3],x=0;return U?H?(C=V[2]+V[3]+V[4],x=V[2].length+V[3].length):(C=V[2]+V[4],x=V[2].length):H?(C=V[3]+V[4],x=V[3].length):C=V[4],M==="file:"?x>=2&&(C=C.slice(2)):w(M)?C=V[4]:M?U&&(C=C.slice(2)):x>=2&&w(k.protocol)&&(C=V[4]),{protocol:M,slashes:U||w(M),slashesCount:x,rest:C}}function S(A,k,C){if(A=(A=d(A)).replace(i,""),!(this instanceof S))return new S(A,k,C);var V,M,U,H,x,Y,ee=m.slice(),O=typeof k,G=this,we=0;for(O!=="object"&&O!=="string"&&(C=k,k=null),C&&typeof C!="function"&&(C=a.parse),V=!(M=g(A||"",k=y(k))).protocol&&!M.slashes,G.slashes=M.slashes||V&&k.slashes,G.protocol=M.protocol||k.protocol||"",A=M.rest,(M.protocol==="file:"&&(M.slashesCount!==2||l.test(A))||!M.slashes&&(M.protocol||M.slashesCount<2||!w(G.protocol)))&&(ee[3]=[/(.*)/,"pathname"]);we<ee.length;we++)typeof(H=ee[we])!="function"?(U=H[0],Y=H[1],U!=U?G[Y]=A:typeof U=="string"?~(x=U==="@"?A.lastIndexOf(U):A.indexOf(U))&&(typeof H[2]=="number"?(G[Y]=A.slice(0,x),A=A.slice(x+H[2])):(G[Y]=A.slice(x),A=A.slice(0,x))):(x=U.exec(A))&&(G[Y]=x[1],A=A.slice(0,x.index)),G[Y]=G[Y]||V&&H[3]&&k[Y]||"",H[4]&&(G[Y]=G[Y].toLowerCase())):A=H(A,G);C&&(G.query=C(G.query)),V&&k.slashes&&G.pathname.charAt(0)!=="/"&&(G.pathname!==""||k.pathname!=="")&&(G.pathname=function(le,Se){if(le==="")return Se;for(var re=(Se||"/").split("/").slice(0,-1).concat(le.split("/")),be=re.length,de=re[be-1],te=!1,se=0;be--;)re[be]==="."?re.splice(be,1):re[be]===".."?(re.splice(be,1),se++):se&&(be===0&&(te=!0),re.splice(be,1),se--);return te&&re.unshift(""),de!=="."&&de!==".."||re.push(""),re.join("/")}(G.pathname,k.pathname)),G.pathname.charAt(0)!=="/"&&w(G.protocol)&&(G.pathname="/"+G.pathname),s(G.port,G.protocol)||(G.host=G.hostname,G.port=""),G.username=G.password="",G.auth&&(~(x=G.auth.indexOf(":"))?(G.username=G.auth.slice(0,x),G.username=encodeURIComponent(decodeURIComponent(G.username)),G.password=G.auth.slice(x+1),G.password=encodeURIComponent(decodeURIComponent(G.password))):G.username=encodeURIComponent(decodeURIComponent(G.auth)),G.auth=G.password?G.username+":"+G.password:G.username),G.origin=G.protocol!=="file:"&&w(G.protocol)&&G.host?G.protocol+"//"+G.host:"null",G.href=G.toString()}S.prototype={set:function(A,k,C){var V=this;switch(A){case"query":typeof k=="string"&&k.length&&(k=(C||a.parse)(k)),V[A]=k;break;case"port":V[A]=k,s(k,V.protocol)?k&&(V.host=V.hostname+":"+k):(V.host=V.hostname,V[A]="");break;case"hostname":V[A]=k,V.port&&(k+=":"+V.port),V.host=k;break;case"host":V[A]=k,u.test(k)?(k=k.split(":"),V.port=k.pop(),V.hostname=k.join(":")):(V.hostname=k,V.port="");break;case"protocol":V.protocol=k.toLowerCase(),V.slashes=!C;break;case"pathname":case"hash":if(k){var M=A==="pathname"?"/":"#";V[A]=k.charAt(0)!==M?M+k:k}else V[A]=k;break;case"username":case"password":V[A]=encodeURIComponent(k);break;case"auth":var U=k.indexOf(":");~U?(V.username=k.slice(0,U),V.username=encodeURIComponent(decodeURIComponent(V.username)),V.password=k.slice(U+1),V.password=encodeURIComponent(decodeURIComponent(V.password))):V.username=encodeURIComponent(decodeURIComponent(k))}for(var H=0;H<m.length;H++){var x=m[H];x[4]&&(V[x[1]]=V[x[1]].toLowerCase())}return V.auth=V.password?V.username+":"+V.password:V.username,V.origin=V.protocol!=="file:"&&w(V.protocol)&&V.host?V.protocol+"//"+V.host:"null",V.href=V.toString(),V},toString:function(A){A&&typeof A=="function"||(A=a.stringify);var k,C=this,V=C.host,M=C.protocol;M&&M.charAt(M.length-1)!==":"&&(M+=":");var U=M+(C.protocol&&C.slashes||w(C.protocol)?"//":"");return C.username?(U+=C.username,C.password&&(U+=":"+C.password),U+="@"):C.password?(U+=":"+C.password,U+="@"):C.protocol!=="file:"&&w(C.protocol)&&!V&&C.pathname!=="/"&&(U+="@"),(V[V.length-1]===":"||u.test(C.hostname)&&!C.port)&&(V+=":"),U+=V+C.pathname,(k=typeof C.query=="object"?A(C.query):C.query)&&(U+=k.charAt(0)!=="?"?"?"+k:k),C.hash&&(U+=C.hash),U}},S.extractProtocol=g,S.location=y,S.trimLeft=d,S.qs=a,r.exports=S},800:()=>{},805:()=>{},829:r=>{function e(h){return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},e(h)}function t(h){var l=typeof Map=="function"?new Map:void 0;return t=function(d){if(d===null||(m=d,Function.toString.call(m).indexOf("[native code]")===-1))return d;var m;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(d))return l.get(d);l.set(d,N)}function N(){return s(d,arguments,n(this).constructor)}return N.prototype=Object.create(d.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),a(N,d)},t(h)}function s(h,l,d){return s=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}()?Reflect.construct:function(m,N,y){var w=[null];w.push.apply(w,N);var g=new(Function.bind.apply(m,w));return y&&a(g,y.prototype),g},s.apply(null,arguments)}function a(h,l){return a=Object.setPrototypeOf||function(d,m){return d.__proto__=m,d},a(h,l)}function n(h){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(l){return l.__proto__||Object.getPrototypeOf(l)},n(h)}var i=function(h){function l(d){var m;return function(N,y){if(!(N instanceof y))throw new TypeError("Cannot call a class as a function")}(this,l),(m=function(N,y){return!y||e(y)!=="object"&&typeof y!="function"?function(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}(N):y}(this,n(l).call(this,d))).name="ObjectPrototypeMutationError",m}return function(d,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");d.prototype=Object.create(m&&m.prototype,{constructor:{value:d,writable:!0,configurable:!0}}),m&&a(d,m)}(l,h),l}(t(Error));function o(h,l){for(var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},m=l.split("."),N=m.length,y=function(S){var A=m[S];if(!h)return{v:void 0};if(A==="+"){if(Array.isArray(h))return{v:h.map(function(C,V){var M=m.slice(S+1);return M.length>0?o(C,M.join("."),d):d(h,V,m,S)})};var k=m.slice(0,S).join(".");throw new Error("Object at wildcard (".concat(k,") is not an array"))}h=d(h,A,m,S)},w=0;w<N;w++){var g=y(w);if(e(g)==="object")return g.v}return h}function u(h,l){return h.length===l+1}r.exports={set:function(h,l,d){if(e(h)!="object"||h===null||l===void 0)return h;if(typeof l=="number")return h[l]=d,h[l];try{return o(h,l,function(m,N,y,w){if(m===Reflect.getPrototypeOf({}))throw new i("Attempting to mutate Object.prototype");if(!m[N]){var g=Number.isInteger(Number(y[w+1])),S=y[w+1]==="+";m[N]=g||S?[]:{}}return u(y,w)&&(m[N]=d),m[N]})}catch(m){if(m instanceof i)throw m;return h}},get:function(h,l){if(e(h)!="object"||h===null||l===void 0)return h;if(typeof l=="number")return h[l];try{return o(h,l,function(d,m){return d[m]})}catch(d){return h}},has:function(h,l){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e(h)!="object"||h===null||l===void 0)return!1;if(typeof l=="number")return l in h;try{var m=!1;return o(h,l,function(N,y,w,g){if(!u(w,g))return N&&N[y];m=d.own?N.hasOwnProperty(y):y in N}),m}catch(N){return!1}},hasOwn:function(h,l,d){return this.has(h,l,d||{own:!0})},isIn:function(h,l,d){var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(e(h)!="object"||h===null||l===void 0)return!1;try{var N=!1,y=!1;return o(h,l,function(w,g,S,A){return N=N||w===d||!!w&&w[g]===d,y=u(S,A)&&e(w)==="object"&&g in w,w&&w[g]}),m.validPath?N&&y:N}catch(w){return!1}},ObjectPrototypeMutationError:i}}},wd={};function Oe(r){var e=wd[r];if(e!==void 0)return e.exports;var t=wd[r]={id:r,loaded:!1,exports:{}};return t0[r].call(t.exports,t,t.exports,Oe),t.loaded=!0,t.exports}Oe.n=r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return Oe.d(e,{a:e}),e},Oe.d=(r,e)=>{for(var t in e)Oe.o(e,t)&&!Oe.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},Oe.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),Oe.nmd=r=>(r.paths=[],r.children||(r.children=[]),r);var s0=Oe(737),r0=Oe.n(s0);function Lm(r){if(!Jf(r))throw new Error("Parameter was not an error")}function Jf(r){return!!r&&typeof r=="object"&&(e=r,Object.prototype.toString.call(e)==="[object Error]")||r instanceof Error;var e}class Ht extends Error{constructor(e,t){const s=[...arguments],{options:a,shortMessage:n}=function(o){let u,h="";if(o.length===0)u={};else if(Jf(o[0]))u={cause:o[0]},h=o.slice(1).join(" ")||"";else if(o[0]&&typeof o[0]=="object")u=Object.assign({},o[0]),h=o.slice(1).join(" ")||"";else{if(typeof o[0]!="string")throw new Error("Invalid arguments passed to Layerr");u={},h=h=o.join(" ")||""}return{options:u,shortMessage:h}}(s);let i=n;if(a.cause&&(i="".concat(i,": ").concat(a.cause.message)),super(i),this.message=i,a.name&&typeof a.name=="string"?this.name=a.name:this.name="Layerr",a.cause&&Object.defineProperty(this,"_cause",{value:a.cause}),Object.defineProperty(this,"_info",{value:{}}),a.info&&typeof a.info=="object"&&Object.assign(this._info,a.info),Error.captureStackTrace){const o=a.constructorOpt||this.constructor;Error.captureStackTrace(this,o)}}static cause(e){return Lm(e),e._cause&&Jf(e._cause)?e._cause:null}static fullStack(e){var s;Lm(e);const t=Ht.cause(e);return t?"".concat(e.stack,"\ncaused by: ").concat(Ht.fullStack(t)):(s=e.stack)!=null?s:""}static info(e){Lm(e);const t={},s=Ht.cause(e);return s&&Object.assign(t,Ht.info(s)),e._info&&Object.assign(t,e._info),t}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e="".concat(e,": ").concat(this.message)),e}}var a0=Oe(47),sm=Oe.n(a0);const yd="__PATH_SEPARATOR_POSIX__",vd="__PATH_SEPARATOR_WINDOWS__";function Me(r){try{const e=r.replace(/\//g,yd).replace(/\\\\/g,vd);return encodeURIComponent(e).split(vd).join("\\\\").split(yd).join("/")}catch(e){throw new Ht(e,"Failed encoding path")}}function bd(r){return r.startsWith("/")?r:"/"+r}function Bc(r){let e=r;return e[0]!=="/"&&(e="/"+e),/^.+\/$/.test(e)&&(e=e.substr(0,e.length-1)),e}function n0(r){let e=new(r0())(r).pathname;return e.length<=0&&(e="/"),Bc(e)}function Ke(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return function(){return function(s){var a=[];if(s.length===0)return"";if(typeof s[0]!="string")throw new TypeError("Url must be a string. Received "+s[0]);if(s[0].match(/^[^/:]+:\/*$/)&&s.length>1){var n=s.shift();s[0]=n+s[0]}s[0].match(/^file:\/\/\//)?s[0]=s[0].replace(/^([^/:]+):\/*/,"$1:///"):s[0]=s[0].replace(/^([^/:]+):\/*/,"$1://");for(var i=0;i<s.length;i++){var o=s[i];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(i>0&&(o=o.replace(/^[\/]+/,"")),o=i<s.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),a.push(o))}var u=a.join("/"),h=(u=u.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return h.shift()+(h.length>0?"?":"")+h.join("&")}(typeof arguments[0]=="object"?arguments[0]:[].slice.call(arguments))}(e.reduce((s,a,n)=>((n===0||a!=="/"||a==="/"&&s[s.length-1]!=="/")&&s.push(a),s),[]))}var i0=Oe(542),iu=Oe.n(i0);function Ad(r,e){const t=r.url.replace("//",""),s=t.indexOf("/")==-1?"/":t.slice(t.indexOf("/")),a=r.method?r.method.toUpperCase():"GET",n=!!/(^|,)\s*auth\s*($|,)/.test(e.qop)&&"auth",i="00000000".concat(e.nc).slice(-8),o=function(m,N,y,w,g,S,A){const k=A||iu()("".concat(N,":").concat(y,":").concat(w));return m&&m.toLowerCase()==="md5-sess"?iu()("".concat(k,":").concat(g,":").concat(S)):k}(e.algorithm,e.username,e.realm,e.password,e.nonce,e.cnonce,e.ha1),u=iu()("".concat(a,":").concat(s)),h=n?iu()("".concat(o,":").concat(e.nonce,":").concat(i,":").concat(e.cnonce,":").concat(n,":").concat(u)):iu()("".concat(o,":").concat(e.nonce,":").concat(u)),l={username:e.username,realm:e.realm,nonce:e.nonce,uri:s,qop:n,response:h,nc:i,cnonce:e.cnonce,algorithm:e.algorithm,opaque:e.opaque},d=[];for(const m in l)l[m]&&(m==="qop"||m==="nc"||m==="algorithm"?d.push("".concat(m,"=").concat(l[m])):d.push("".concat(m,'="').concat(l[m],'"')));return"Digest ".concat(d.join(", "))}function Yg(r){return(r.headers&&r.headers.get("www-authenticate")||"").split(/\s/)[0].toLowerCase()==="digest"}var o0=Oe(101),Qg=Oe.n(o0);function Sd(r){return Qg().decode(r)}function Nd(r,e){var t;return"Basic ".concat((t="".concat(r,":").concat(e),Qg().encode(t)))}const Ed=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:typeof window<"u"?window:globalThis,u0=Ed.fetch.bind(Ed);let Xt=function(r){return r.Auto="auto",r.Digest="digest",r.None="none",r.Password="password",r.Token="token",r}({}),xa=function(r){return r.DataTypeNoLength="data-type-no-length",r.InvalidAuthType="invalid-auth-type",r.InvalidOutputFormat="invalid-output-format",r.LinkUnsupportedAuthType="link-unsupported-auth",r.InvalidUpdateRange="invalid-update-range",r.NotSupported="not-supported",r}({});function Zg(r,e,t,s,a){switch(r.authType){case Xt.Auto:e&&t&&(r.headers.Authorization=Nd(e,t));break;case Xt.Digest:r.digest=function(i,o,u){return{username:i,password:o,ha1:u,nc:0,algorithm:"md5",hasDigestAuth:!1}}(e,t,a);break;case Xt.None:break;case Xt.Password:r.headers.Authorization=Nd(e,t);break;case Xt.Token:r.headers.Authorization="".concat((n=s).token_type," ").concat(n.access_token);break;default:throw new Ht({info:{code:xa.InvalidAuthType}},"Invalid auth type: ".concat(r.authType))}var n}Oe(345),Oe(800);const kd="@@HOTPATCHER",l0=()=>{};function Um(r){return{original:r,methods:[r],final:!1}}class c0{constructor(){this._configuration={registry:{},getEmptyAction:"null"},this.__type__=kd}get configuration(){return this._configuration}get getEmptyAction(){return this.configuration.getEmptyAction}set getEmptyAction(e){this.configuration.getEmptyAction=e}control(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e||e.__type__!==kd)throw new Error("Failed taking control of target HotPatcher instance: Invalid type or object");return Object.keys(e.configuration.registry).forEach(s=>{this.configuration.registry.hasOwnProperty(s)?t&&(this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])):this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])}),e._configuration=this.configuration,this}execute(e){const t=this.get(e)||l0;for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];return t(...a)}get(e){const t=this.configuration.registry[e];if(!t)switch(this.getEmptyAction){case"null":return null;case"throw":throw new Error("Failed handling method request: No method provided for override: ".concat(e));default:throw new Error("Failed handling request which resulted in an empty method: Invalid empty-action specified: ".concat(this.getEmptyAction))}return function(){for(var s=arguments.length,a=new Array(s),n=0;n<s;n++)a[n]=arguments[n];if(a.length===0)throw new Error("Failed creating sequence: No functions provided");return function(){for(var i=arguments.length,o=new Array(i),u=0;u<i;u++)o[u]=arguments[u];let h=o;const l=this;for(;a.length>0;)h=[a.shift().apply(l,h)];return h[0]}}(...t.methods)}isPatched(e){return!!this.configuration.registry[e]}patch(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{chain:a=!1}=s;if(this.configuration.registry[e]&&this.configuration.registry[e].final)throw new Error("Failed patching '".concat(e,"': Method marked as being final"));if(typeof t!="function")throw new Error("Failed patching '".concat(e,"': Provided method is not a function"));if(a)this.configuration.registry[e]?this.configuration.registry[e].methods.push(t):this.configuration.registry[e]=Um(t);else if(this.isPatched(e)){const{original:n}=this.configuration.registry[e];this.configuration.registry[e]=Object.assign(Um(t),{original:n})}else this.configuration.registry[e]=Um(t);return this}patchInline(e,t){this.isPatched(e)||this.patch(e,t);for(var s=arguments.length,a=new Array(s>2?s-2:0),n=2;n<s;n++)a[n-2]=arguments[n];return this.execute(e,...a)}plugin(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return s.forEach(n=>{this.patch(e,n,{chain:!0})}),this}restore(e){if(!this.isPatched(e))throw new Error("Failed restoring method: No method present for key: ".concat(e));if(typeof this.configuration.registry[e].original!="function")throw new Error("Failed restoring method: Original method not found or of invalid type for key: ".concat(e));return this.configuration.registry[e].methods=[this.configuration.registry[e].original],this}setFinal(e){if(!this.configuration.registry.hasOwnProperty(e))throw new Error("Failed marking '".concat(e,"' as final: No method found for key"));return this.configuration.registry[e].final=!0,this}}let jm=null;function ew(){return jm||(jm=new c0),jm}function rm(r){return function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(r)?Object.assign({},r):Object.setPrototypeOf(Object.assign({},r),Object.getPrototypeOf(r))}function Id(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let s=null,a=[...e];for(;a.length>0;){const n=a.shift();s=s?tw(s,n):rm(n)}return s}function tw(r,e){const t=rm(r);return Object.keys(e).forEach(s=>{t.hasOwnProperty(s)?Array.isArray(e[s])?t[s]=Array.isArray(t[s])?[...t[s],...e[s]]:[...e[s]]:typeof e[s]=="object"&&e[s]?t[s]=typeof t[s]=="object"&&t[s]?tw(t[s],e[s]):rm(e[s]):t[s]=e[s]:t[s]=e[s]}),t}function h0(r){const e={};for(const t of r.keys())e[t]=r.get(t);return e}function qf(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(e.length===0)return{};const s={};return e.reduce((a,n)=>(Object.keys(n).forEach(i=>{const o=i.toLowerCase();s.hasOwnProperty(o)?a[s[o]]=n[i]:(s[o]=i,a[i]=n[i])}),a),{})}Oe(805);const m0=typeof ArrayBuffer=="function",{toString:f0}=Object.prototype;function sw(r){return m0&&(r instanceof ArrayBuffer||f0.call(r)==="[object ArrayBuffer]")}function rw(r){return r!=null&&r.constructor!=null&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function Cp(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function _f(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const aw=Cp(function(r){const e=r._digest;return delete r._digest,e.hasDigestAuth&&(r=Id(r,{headers:{Authorization:Ad(r,e)}})),_f(am(r),function(t){let s=!1;return a=function(i){return s?i:t},(n=function(){if(t.status==401)return e.hasDigestAuth=function(i,o){if(!Yg(i))return!1;const u=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;for(;;){const h=i.headers&&i.headers.get("www-authenticate")||"",l=u.exec(h);if(!l)break;o[l[1]]=l[2]||l[3]}return o.nc+=1,o.cnonce=function(){let h="";for(let l=0;l<32;++l)h="".concat(h).concat("abcdef0123456789"[Math.floor(16*Math.random())]);return h}(),!0}(t,e),function(){if(e.hasDigestAuth)return _f(am(r=Id(r,{headers:{Authorization:Ad(r,e)}})),function(i){return i.status==401?e.hasDigestAuth=!1:e.nc++,s=!0,i})}();e.nc++}())&&n.then?n.then(a):a(n);var a,n})}),p0=Cp(function(r,e){return _f(am(r),function(t){return t.ok?(e.authType=Xt.Password,t):t.status==401&&Yg(t)?(e.authType=Xt.Digest,Zg(e,e.username,e.password,void 0,void 0),r._digest=e.digest,aw(r)):t})}),ft=Cp(function(r,e){return e.authType===Xt.Auto?p0(r,e):r._digest?aw(r):am(r)});function pt(r,e,t){const s=rm(r);return s.headers=qf(e.headers,s.headers||{},t.headers||{}),t.data!==void 0&&(s.data=t.data),t.signal&&(s.signal=t.signal),e.httpAgent&&(s.httpAgent=e.httpAgent),e.httpsAgent&&(s.httpsAgent=e.httpsAgent),e.digest&&(s._digest=e.digest),typeof e.withCredentials=="boolean"&&(s.withCredentials=e.withCredentials),s}function am(r){const e=ew();return e.patchInline("request",t=>e.patchInline("fetch",u0,t.url,function(s){let a={};const n={method:s.method};if(s.headers&&(a=qf(a,s.headers)),s.data!==void 0){const[i,o]=function(u){if(typeof u=="string")return[u,{}];if(rw(u))return[u,{}];if(sw(u))return[u,{}];if(u&&typeof u=="object")return[JSON.stringify(u),{"content-type":"application/json"}];throw new Error("Unable to convert request body: Unexpected body type: "+typeof u)}(s.data);n.body=i,a=qf(a,o)}return s.signal&&(n.signal=s.signal),s.withCredentials&&(n.credentials="include"),n.headers=a,n}(t)),r)}var d0=Oe(285);const nm=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>65536)throw new TypeError("pattern is too long")},g0={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},ou=r=>r.replace(/[[\]\\-]/g,"\\$&"),Cd=r=>r.join(""),w0=(r,e)=>{const t=e;if(r.charAt(t)!=="[")throw new Error("not in a brace expression");const s=[],a=[];let n=t+1,i=!1,o=!1,u=!1,h=!1,l=t,d="";e:for(;n<r.length;){const w=r.charAt(n);if(w!=="!"&&w!=="^"||n!==t+1){if(w==="]"&&i&&!u){l=n+1;break}if(i=!0,w!=="\\"||u){if(w==="["&&!u){for(const[g,[S,A,k]]of Object.entries(g0))if(r.startsWith(g,n)){if(d)return["$.",!1,r.length-t,!0];n+=g.length,k?a.push(S):s.push(S),o=o||A;continue e}}u=!1,d?(w>d?s.push(ou(d)+"-"+ou(w)):w===d&&s.push(ou(w)),d="",n++):r.startsWith("-]",n+1)?(s.push(ou(w+"-")),n+=2):r.startsWith("-",n+1)?(d=w,n+=2):(s.push(ou(w)),n++)}else u=!0,n++}else h=!0,n++}if(l<n)return["",!1,0,!1];if(!s.length&&!a.length)return["$.",!1,r.length-t,!0];if(a.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!h)return[(m=s[0].length===2?s[0].slice(-1):s[0],m.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,l-t,!1];var m;const N="["+(h?"^":"")+Cd(s)+"]",y="["+(h?"":"^")+Cd(a)+"]";return[s.length&&a.length?"("+N+"|"+y+")":s.length?N:y,o,l-t,!0]},Eu=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/\[([^\/\\])\]/g,"$1"):r.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1")},y0=new Set(["!","?","+","*","@"]),Bd=r=>y0.has(r),$m="(?!\\.)",v0=new Set(["[","."]),b0=new Set(["..","."]),A0=new Set("().*{}+?[]^$\\!"),Bp="[^/]",xd=Bp+"*?",Vd=Bp+"+?";var lt,wt,tr,Re,rt,pa,qn,da,Ds,_n,Lc,ri,nw,Ca,bh,Wf,iw;const Rt=class Rt{constructor(e,t){_t(this,ri);st(this,"type");_t(this,lt);_t(this,wt);_t(this,tr,!1);_t(this,Re,[]);_t(this,rt);_t(this,pa);_t(this,qn);_t(this,da,!1);_t(this,Ds);_t(this,_n);_t(this,Lc,!1);let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.type=e,e&&qe(this,wt,!0),qe(this,rt,t),qe(this,lt,X(this,rt)?X(X(this,rt),lt):this),qe(this,Ds,X(this,lt)===this?s:X(X(this,lt),Ds)),qe(this,qn,X(this,lt)===this?[]:X(X(this,lt),qn)),e!=="!"||X(X(this,lt),da)||X(this,qn).push(this),qe(this,pa,X(this,rt)?X(X(this,rt),Re).length:0)}get hasMagic(){if(X(this,wt)!==void 0)return X(this,wt);for(const e of X(this,Re))if(typeof e!="string"&&(e.type||e.hasMagic))return qe(this,wt,!0);return X(this,wt)}toString(){return X(this,_n)!==void 0?X(this,_n):this.type?qe(this,_n,this.type+"("+X(this,Re).map(e=>String(e)).join("|")+")"):qe(this,_n,X(this,Re).map(e=>String(e)).join(""))}push(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];for(const a of t)if(a!==""){if(typeof a!="string"&&!(a instanceof Rt&&X(a,rt)===this))throw new Error("invalid part: "+a);X(this,Re).push(a)}}toJSON(){var t;const e=this.type===null?X(this,Re).slice().map(s=>typeof s=="string"?s:s.toJSON()):[this.type,...X(this,Re).map(s=>s.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===X(this,lt)||X(X(this,lt),da)&&((t=X(this,rt))==null?void 0:t.type)==="!")&&e.push({}),e}isStart(){var t;if(X(this,lt)===this)return!0;if(!((t=X(this,rt))!=null&&t.isStart()))return!1;if(X(this,pa)===0)return!0;const e=X(this,rt);for(let s=0;s<X(this,pa);s++){const a=X(e,Re)[s];if(!(a instanceof Rt&&a.type==="!"))return!1}return!0}isEnd(){var t,s,a;if(X(this,lt)===this||((t=X(this,rt))==null?void 0:t.type)==="!")return!0;if(!((s=X(this,rt))!=null&&s.isEnd()))return!1;if(!this.type)return(a=X(this,rt))==null?void 0:a.isEnd();const e=X(this,rt)?X(X(this,rt),Re).length:0;return X(this,pa)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new Rt(this.type,e);for(const s of X(this,Re))t.copyIn(s);return t}static fromGlob(e){var a;let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new Rt(null,void 0,t);return dr(a=Rt,Ca,bh).call(a,e,s,0,t),s}toMMPattern(){if(this!==X(this,lt))return X(this,lt).toMMPattern();const e=this.toString(),[t,s,a,n]=this.toRegExpSource();if(!(a||X(this,wt)||X(this,Ds).nocase&&!X(this,Ds).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;const i=(X(this,Ds).nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp("^".concat(t,"$"),i),{_src:t,_glob:e})}get options(){return X(this,Ds)}toRegExpSource(e){var u;const t=e!=null?e:!!X(this,Ds).dot;if(X(this,lt)===this&&dr(this,ri,nw).call(this),!this.type){const h=this.isStart()&&this.isEnd(),l=X(this,Re).map(N=>{var A;const[y,w,g,S]=typeof N=="string"?dr(A=Rt,Ca,iw).call(A,N,X(this,wt),h):N.toRegExpSource(e);return qe(this,wt,X(this,wt)||g),qe(this,tr,X(this,tr)||S),y}).join("");let d="";if(this.isStart()&&typeof X(this,Re)[0]=="string"&&(X(this,Re).length!==1||!b0.has(X(this,Re)[0]))){const N=v0,y=t&&N.has(l.charAt(0))||l.startsWith("\\.")&&N.has(l.charAt(2))||l.startsWith("\\.\\.")&&N.has(l.charAt(4)),w=!t&&!e&&N.has(l.charAt(0));d=y?"(?!(?:^|/)\\.\\.?(?:$|/))":w?$m:""}let m="";return this.isEnd()&&X(X(this,lt),da)&&((u=X(this,rt))==null?void 0:u.type)==="!"&&(m="(?:$|\\/)"),[d+l+m,Eu(l),qe(this,wt,!!X(this,wt)),X(this,tr)]}const s=this.type==="*"||this.type==="+",a=this.type==="!"?"(?:(?!(?:":"(?:";let n=dr(this,ri,Wf).call(this,t);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){const h=this.toString();return qe(this,Re,[h]),this.type=null,qe(this,wt,void 0),[h,Eu(this.toString()),!1,!1]}let i=!s||e||t?"":dr(this,ri,Wf).call(this,!0);i===n&&(i=""),i&&(n="(?:".concat(n,")(?:").concat(i,")*?"));let o="";return o=this.type==="!"&&X(this,Lc)?(this.isStart()&&!t?$m:"")+Vd:a+n+(this.type==="!"?"))"+(!this.isStart()||t||e?"":$m)+xd+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":")".concat(this.type)),[o,Eu(n),qe(this,wt,!!X(this,wt)),X(this,tr)]}};lt=new WeakMap,wt=new WeakMap,tr=new WeakMap,Re=new WeakMap,rt=new WeakMap,pa=new WeakMap,qn=new WeakMap,da=new WeakMap,Ds=new WeakMap,_n=new WeakMap,Lc=new WeakMap,ri=new WeakSet,nw=function(){if(this!==X(this,lt))throw new Error("should only call on root");if(X(this,da))return this;let e;for(this.toString(),qe(this,da,!0);e=X(this,qn).pop();){if(e.type!=="!")continue;let t=e,s=X(t,rt);for(;s;){for(let a=X(t,pa)+1;!s.type&&a<X(s,Re).length;a++)for(const n of X(e,Re)){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(X(s,Re)[a])}t=s,s=X(t,rt)}}return this},Ca=new WeakSet,bh=function(e,t,s,a){var N,y;let n=!1,i=!1,o=-1,u=!1;if(t.type===null){let w=s,g="";for(;w<e.length;){const S=e.charAt(w++);if(n||S==="\\")n=!n,g+=S;else if(i)w===o+1?S!=="^"&&S!=="!"||(u=!0):S!=="]"||w===o+2&&u||(i=!1),g+=S;else if(S!=="[")if(a.noext||!Bd(S)||e.charAt(w)!=="(")g+=S;else{t.push(g),g="";const A=new Rt(S,t);w=dr(N=Rt,Ca,bh).call(N,e,A,w,a),t.push(A)}else i=!0,o=w,u=!1,g+=S}return t.push(g),w}let h=s+1,l=new Rt(null,t);const d=[];let m="";for(;h<e.length;){const w=e.charAt(h++);if(n||w==="\\")n=!n,m+=w;else if(i)h===o+1?w!=="^"&&w!=="!"||(u=!0):w!=="]"||h===o+2&&u||(i=!1),m+=w;else if(w!=="[")if(Bd(w)&&e.charAt(h)==="("){l.push(m),m="";const g=new Rt(w,l);l.push(g),h=dr(y=Rt,Ca,bh).call(y,e,g,h,a)}else if(w!=="|"){if(w===")")return m===""&&X(t,Re).length===0&&qe(t,Lc,!0),l.push(m),m="",t.push(...d,l),h;m+=w}else l.push(m),m="",d.push(l),l=new Rt(null,t);else i=!0,o=h,u=!1,m+=w}return t.type=null,qe(t,wt,void 0),qe(t,Re,[e.substring(s-1)]),h},Wf=function(e){return X(this,Re).map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[s,a,n,i]=t.toRegExpSource(e);return qe(this,tr,X(this,tr)||i),s}).filter(t=>!(this.isStart()&&this.isEnd()&&!t)).join("|")},iw=function(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=!1,n="",i=!1;for(let o=0;o<e.length;o++){const u=e.charAt(o);if(a)a=!1,n+=(A0.has(u)?"\\":"")+u;else if(u!=="\\"){if(u==="["){const[h,l,d,m]=w0(e,o);if(d){n+=h,i=i||l,o+=d-1,t=t||m;continue}}u!=="*"?u!=="?"?n+=u.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(n+=Bp,t=!0):(n+=s&&e==="*"?Vd:xd,t=!0)}else o===e.length-1?n+="\\\\":a=!0}return[n,Eu(e),!!t,i]},_t(Rt,Ca);let im=Rt;const Dt=function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return nm(e),!(!t.nocomment&&e.charAt(0)==="#")&&new om(e,t).match(r)},S0=/^\*+([^+@!?\*\[\(]*)$/,N0=r=>e=>!e.startsWith(".")&&e.endsWith(r),E0=r=>e=>e.endsWith(r),k0=r=>(r=r.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(r)),I0=r=>(r=r.toLowerCase(),e=>e.toLowerCase().endsWith(r)),C0=/^\*+\.\*+$/,B0=r=>!r.startsWith(".")&&r.includes("."),x0=r=>r!=="."&&r!==".."&&r.includes("."),V0=/^\.\*+$/,P0=r=>r!=="."&&r!==".."&&r.startsWith("."),O0=/^\*+$/,D0=r=>r.length!==0&&!r.startsWith("."),T0=r=>r.length!==0&&r!=="."&&r!=="..",R0=/^\?+([^+@!?\*\[\(]*)?$/,L0=r=>{let[e,t=""]=r;const s=ow([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},U0=r=>{let[e,t=""]=r;const s=uw([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},j0=r=>{let[e,t=""]=r;const s=uw([e]);return t?a=>s(a)&&a.endsWith(t):s},$0=r=>{let[e,t=""]=r;const s=ow([e]);return t?a=>s(a)&&a.endsWith(t):s},ow=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&!s.startsWith(".")},uw=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&s!=="."&&s!==".."},lw=typeof ct=="object"&&ct?typeof Rm=="object"&&Rm&&Rm.__MINIMATCH_TESTING_PLATFORM__||ct.platform:"posix";Dt.sep=lw==="win32"?"\\":"/";const us=Symbol("globstar **");Dt.GLOBSTAR=us,Dt.filter=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return t=>Dt(t,r,e)};const is=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.assign({},r,e)};Dt.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return Dt;const e=Dt;return Object.assign(function(t,s){return e(t,s,is(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))},{Minimatch:class extends e.Minimatch{constructor(t){super(t,is(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}))}static defaults(t){return e.defaults(is(r,t)).Minimatch}},AST:class extends e.AST{constructor(t,s){super(t,s,is(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))}static fromGlob(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.AST.fromGlob(t,is(r,s))}},unescape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.unescape(t,is(r,s))},escape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.escape(t,is(r,s))},filter:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.filter(t,is(r,s))},defaults:t=>e.defaults(is(r,t)),makeRe:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.makeRe(t,is(r,s))},braceExpand:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.braceExpand(t,is(r,s))},match:function(t,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e.match(t,s,is(r,a))},sep:e.sep,GLOBSTAR:us})};const cw=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return nm(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:d0(r)};Dt.braceExpand=cw,Dt.makeRe=function(r){return new om(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).makeRe()},Dt.match=function(r,e){const t=new om(e,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{});return r=r.filter(s=>t.match(s)),t.options.nonull&&!r.length&&r.push(e),r};const Pd=/[?*]|[+@!]\(.*?\)|\[|\]/;class om{constructor(e){st(this,"options");st(this,"set");st(this,"pattern");st(this,"windowsPathsNoEscape");st(this,"nonegate");st(this,"negate");st(this,"comment");st(this,"empty");st(this,"preserveMultipleSlashes");st(this,"partial");st(this,"globSet");st(this,"globParts");st(this,"nocase");st(this,"isWindows");st(this,"platform");st(this,"windowsNoMagicRoot");st(this,"regexp");let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};nm(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||lw,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#")return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=function(){return console.error(...arguments)}),this.debug(this.pattern,this.globSet);const s=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let a=this.globParts.map((n,i,o)=>{if(this.isWindows&&this.windowsNoMagicRoot){const u=!(n[0]!==""||n[1]!==""||n[2]!=="?"&&Pd.test(n[2])||Pd.test(n[3])),h=/^[a-z]:/i.test(n[0]);if(u)return[...n.slice(0,4),...n.slice(4).map(l=>this.parse(l))];if(h)return[n[0],...n.slice(1).map(l=>this.parse(l))]}return n.map(u=>this.parse(u))});if(this.debug(this.pattern,a),this.set=a.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){const i=this.set[n];i[0]===""&&i[1]===""&&this.globParts[n][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)e[s][a]==="**"&&(e[s][a]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let a=s;for(;t[a+1]==="**";)a++;a!==s&&t.splice(s,a-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,a)=>{const n=s[s.length-1];return a==="**"&&n==="**"?s:a===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(s.pop(),s):(s.push(a),s)},[])).length===0?[""]:t)}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let a=1;a<e.length-1;a++){const n=e[a];a===1&&n===""&&e[0]===""||n!=="."&&n!==""||(t=!0,e.splice(a,1),a--)}e[0]!=="."||e.length!==2||e[1]!=="."&&e[1]!==""||(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){const a=e[s-1];a&&a!=="."&&a!==".."&&a!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let a=-1;for(;(a=s.indexOf("**",a+1))!==-1;){let i=a;for(;s[i+1]==="**";)i++;i>a&&s.splice(a+1,i-a);let o=s[a+1];const u=s[a+2],h=s[a+3];if(o!==".."||!u||u==="."||u===".."||!h||h==="."||h==="..")continue;t=!0,s.splice(a,1);const l=s.slice(0);l[a]="**",e.push(l),a--}if(!this.preserveMultipleSlashes){for(let i=1;i<s.length-1;i++){const o=s[i];i===1&&o===""&&s[0]===""||o!=="."&&o!==""||(t=!0,s.splice(i,1),i--)}s[0]!=="."||s.length!==2||s[1]!=="."&&s[1]!==""||(t=!0,s.pop())}let n=0;for(;(n=s.indexOf("..",n+1))!==-1;){const i=s[n-1];if(i&&i!=="."&&i!==".."&&i!=="**"){t=!0;const o=n===1&&s[n+1]==="**"?["."]:[];s.splice(n-1,2,...o),s.length===0&&s.push(""),n-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){const a=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(a){e[t]=[],e[s]=a;break}}return e.filter(t=>t.length)}partsMatch(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=0,n=0,i=[],o="";for(;a<e.length&&n<t.length;)if(e[a]===t[n])i.push(o==="b"?t[n]:e[a]),a++,n++;else if(s&&e[a]==="**"&&t[n]===e[a+1])i.push(e[a]),a++;else if(s&&t[n]==="**"&&e[a]===t[n+1])i.push(t[n]),n++;else if(e[a]!=="*"||!t[n]||!this.options.dot&&t[n].startsWith(".")||t[n]==="**"){if(t[n]!=="*"||!e[a]||!this.options.dot&&e[a].startsWith(".")||e[a]==="**"||o==="a")return!1;o="b",i.push(t[n]),a++,n++}else{if(o==="b")return!1;o="a",i.push(e[a]),a++,n++}return e.length===t.length&&i}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let a=0;a<e.length&&e.charAt(a)==="!";a++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const a=this.options;if(this.isWindows){const w=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),g=!w&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),S=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),A=g?3:w?0:void 0,k=!S&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3])?3:S?0:void 0;if(typeof A=="number"&&typeof k=="number"){const[C,V]=[e[A],t[k]];C.toLowerCase()===V.toLowerCase()&&(t[k]=C,k>A?t=t.slice(k):A>k&&(e=e.slice(A)))}}const{optimizationLevel:n=1}=this.options;n>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,o=0,u=e.length,h=t.length;i<u&&o<h;i++,o++){this.debug("matchOne loop");var l=t[o],d=e[i];if(this.debug(t,l,d),l===!1)return!1;if(l===us){this.debug("GLOBSTAR",[t,l,d]);var m=i,N=o+1;if(N===h){for(this.debug("** at the end");i<u;i++)if(e[i]==="."||e[i]===".."||!a.dot&&e[i].charAt(0)===".")return!1;return!0}for(;m<u;){var y=e[m];if(this.debug("\nglobstar while",e,m,t,N,y),this.matchOne(e.slice(m),t.slice(N),s))return this.debug("globstar found match!",m,u,y),!0;if(y==="."||y===".."||!a.dot&&y.charAt(0)==="."){this.debug("dot detected!",e,m,t,N);break}this.debug("globstar swallow a segment, and continue"),m++}return!(!s||(this.debug("\n>>> no match, partial?",e,m,t,N),m!==u))}let w;if(typeof l=="string"?(w=d===l,this.debug("string match",l,d,w)):(w=l.test(d),this.debug("pattern match",l,d,w)),!w)return!1}if(i===u&&o===h)return!0;if(i===u)return s;if(o===h)return i===u-1&&e[i]==="";throw new Error("wtf?")}braceExpand(){return cw(this.pattern,this.options)}parse(e){nm(e);const t=this.options;if(e==="**")return us;if(e==="")return"";let s,a=null;(s=e.match(O0))?a=t.dot?T0:D0:(s=e.match(S0))?a=(t.nocase?t.dot?I0:k0:t.dot?E0:N0)(s[1]):(s=e.match(R0))?a=(t.nocase?t.dot?U0:L0:t.dot?j0:$0)(s):(s=e.match(C0))?a=t.dot?x0:B0:(s=e.match(V0))&&(a=P0);const n=im.fromGlob(e,this.options).toMMPattern();return a&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:a}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",a=new Set(t.nocase?["i"]:[]);let n=e.map(u=>{const h=u.map(l=>{if(l instanceof RegExp)for(const d of l.flags.split(""))a.add(d);return typeof l=="string"?l.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):l===us?us:l._src});return h.forEach((l,d)=>{const m=h[d+1],N=h[d-1];l===us&&N!==us&&(N===void 0?m!==void 0&&m!==us?h[d+1]="(?:\\/|"+s+"\\/)?"+m:h[d]=s:m===void 0?h[d-1]=N+"(?:\\/|"+s+")?":m!==us&&(h[d-1]=N+"(?:\\/|\\/"+s+"\\/)"+m,h[d+1]=us))}),h.filter(l=>l!==us).join("/")}).join("|");const[i,o]=e.length>1?["(?:",")"]:["",""];n="^"+i+n+o+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...a].join(""))}catch(u){this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.partial;if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const s=this.options;this.isWindows&&(e=e.split("\\").join("/"));const a=this.slashSplit(e);this.debug(this.pattern,"split",a);const n=this.set;this.debug(this.pattern,"set",n);let i=a[a.length-1];if(!i)for(let o=a.length-2;!i&&o>=0;o--)i=a[o];for(let o=0;o<n.length;o++){const u=n[o];let h=a;if(s.matchBase&&u.length===1&&(h=[i]),this.matchOne(h,u,t))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(e){return Dt.defaults(e).Minimatch}}function xp(r){const e=new Error("".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"","Invalid response: ").concat(r.status," ").concat(r.statusText));return e.status=r.status,e.response=r,e}function dt(r,e){const{status:t}=e;if(t===401&&r.digest)return e;if(t>=400)throw xp(e);return e}function eu(r,e){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?{data:e,headers:r.headers?h0(r.headers):{},status:r.status,statusText:r.statusText}:e}Dt.AST=im,Dt.Minimatch=om,Dt.escape=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/[?*()[\]]/g,"[$&]"):r.replace(/[?*()[\]\\]/g,"\\$&")},Dt.unescape=Eu;const M0=(Od=function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=pt({url:Ke(r.remoteURL,Me(e)),method:"COPY",headers:{Destination:Ke(r.remoteURL,Me(t)),Overwrite:s.overwrite===!1?"F":"T",Depth:s.shallow?"0":"infinity"}},r,s);return i=function(o){dt(r,o)},(n=ft(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i},function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];try{return Promise.resolve(Od.apply(this,r))}catch(t){return Promise.reject(t)}});var Od;const K0={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(r,e,t){return r},captureMetaData:!1},Dd=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",H0=new RegExp("^["+Dd+"]["+Dd+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$");function hw(r,e){const t=[];let s=e.exec(r);for(;s;){const a=[];a.startIndex=e.lastIndex-s[0].length;const n=s.length;for(let i=0;i<n;i++)a.push(s[i]);t.push(a),s=e.exec(r)}return t}const Nm=function(r){return H0.exec(r)!=null};let Gf;Gf=typeof Symbol!="function"?"@@xmlMetadata":Symbol("XML Node Metadata");class Un{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e,t){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child}),t!==void 0&&(this.child[this.child.length-1][Gf]={startIndex:t})}static getMetaDataSymbol(){return Gf}}class F0{constructor(e){this.suppressValidationErr=!e}readDocType(e,t){const s={};if(e[t+3]!=="O"||e[t+4]!=="C"||e[t+5]!=="T"||e[t+6]!=="Y"||e[t+7]!=="P"||e[t+8]!=="E")throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let a=1,n=!1,i=!1,o="";for(;t<e.length;t++)if(e[t]!=="<"||i)if(e[t]===">"){if(i?e[t-1]==="-"&&e[t-2]==="-"&&(i=!1,a--):a--,a===0)break}else e[t]==="["?n=!0:o+=e[t];else{if(n&&Pa(e,"!ENTITY",t)){let u,h;t+=7,[u,h,t]=this.readEntityExp(e,t+1,this.suppressValidationErr),h.indexOf("&")===-1&&(s[u]={regx:RegExp("&".concat(u,";"),"g"),val:h})}else if(n&&Pa(e,"!ELEMENT",t)){t+=8;const{index:u}=this.readElementExp(e,t+1);t=u}else if(n&&Pa(e,"!ATTLIST",t))t+=8;else if(n&&Pa(e,"!NOTATION",t)){t+=9;const{index:u}=this.readNotationExp(e,t+1,this.suppressValidationErr);t=u}else{if(!Pa(e,"!--",t))throw new Error("Invalid DOCTYPE");i=!0}a++,o=""}if(a!==0)throw new Error("Unclosed DOCTYPE")}return{entities:s,i:t}}readEntityExp(e,t){t=Wt(e,t);let s="";for(;t<e.length&&!/\s/.test(e[t])&&e[t]!=='"'&&e[t]!=="'";)s+=e[t],t++;if(uu(s),t=Wt(e,t),!this.suppressValidationErr){if(e.substring(t,t+6).toUpperCase()==="SYSTEM")throw new Error("External entities are not supported");if(e[t]==="%")throw new Error("Parameter entities are not supported")}let a="";return[t,a]=this.readIdentifierVal(e,t,"entity"),[s,a,--t]}readNotationExp(e,t){t=Wt(e,t);let s="";for(;t<e.length&&!/\s/.test(e[t]);)s+=e[t],t++;!this.suppressValidationErr&&uu(s),t=Wt(e,t);const a=e.substring(t,t+6).toUpperCase();if(!this.suppressValidationErr&&a!=="SYSTEM"&&a!=="PUBLIC")throw new Error('Expected SYSTEM or PUBLIC, found "'.concat(a,'"'));t+=a.length,t=Wt(e,t);let n=null,i=null;if(a==="PUBLIC")[t,n]=this.readIdentifierVal(e,t,"publicIdentifier"),e[t=Wt(e,t)]!=='"'&&e[t]!=="'"||([t,i]=this.readIdentifierVal(e,t,"systemIdentifier"));else if(a==="SYSTEM"&&([t,i]=this.readIdentifierVal(e,t,"systemIdentifier"),!this.suppressValidationErr&&!i))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:s,publicIdentifier:n,systemIdentifier:i,index:--t}}readIdentifierVal(e,t,s){let a="";const n=e[t];if(n!=='"'&&n!=="'")throw new Error('Expected quoted string, found "'.concat(n,'"'));for(t++;t<e.length&&e[t]!==n;)a+=e[t],t++;if(e[t]!==n)throw new Error("Unterminated ".concat(s," value"));return[++t,a]}readElementExp(e,t){t=Wt(e,t);let s="";for(;t<e.length&&!/\s/.test(e[t]);)s+=e[t],t++;if(!this.suppressValidationErr&&!Nm(s))throw new Error('Invalid element name: "'.concat(s,'"'));let a="";if(e[t=Wt(e,t)]==="E"&&Pa(e,"MPTY",t))t+=4;else if(e[t]==="A"&&Pa(e,"NY",t))t+=2;else if(e[t]==="("){for(t++;t<e.length&&e[t]!==")";)a+=e[t],t++;if(e[t]!==")")throw new Error("Unterminated content model")}else if(!this.suppressValidationErr)throw new Error('Invalid Element Expression, found "'.concat(e[t],'"'));return{elementName:s,contentModel:a.trim(),index:t}}readAttlistExp(e,t){t=Wt(e,t);let s="";for(;t<e.length&&!/\s/.test(e[t]);)s+=e[t],t++;uu(s),t=Wt(e,t);let a="";for(;t<e.length&&!/\s/.test(e[t]);)a+=e[t],t++;if(!uu(a))throw new Error('Invalid attribute name: "'.concat(a,'"'));t=Wt(e,t);let n="";if(e.substring(t,t+8).toUpperCase()==="NOTATION"){if(n="NOTATION",e[t=Wt(e,t+=8)]!=="(")throw new Error("Expected '(', found \"".concat(e[t],'"'));t++;let o=[];for(;t<e.length&&e[t]!==")";){let u="";for(;t<e.length&&e[t]!=="|"&&e[t]!==")";)u+=e[t],t++;if(u=u.trim(),!uu(u))throw new Error('Invalid notation name: "'.concat(u,'"'));o.push(u),e[t]==="|"&&(t++,t=Wt(e,t))}if(e[t]!==")")throw new Error("Unterminated list of notations");t++,n+=" ("+o.join("|")+")"}else{for(;t<e.length&&!/\s/.test(e[t]);)n+=e[t],t++;const o=["CDATA","ID","IDREF","IDREFS","ENTITY","ENTITIES","NMTOKEN","NMTOKENS"];if(!this.suppressValidationErr&&!o.includes(n.toUpperCase()))throw new Error('Invalid attribute type: "'.concat(n,'"'))}t=Wt(e,t);let i="";return e.substring(t,t+8).toUpperCase()==="#REQUIRED"?(i="#REQUIRED",t+=8):e.substring(t,t+7).toUpperCase()==="#IMPLIED"?(i="#IMPLIED",t+=7):[t,i]=this.readIdentifierVal(e,t,"ATTLIST"),{elementName:s,attributeName:a,attributeType:n,defaultValue:i,index:t}}}const Wt=(r,e)=>{for(;e<r.length&&/\s/.test(r[e]);)e++;return e};function Pa(r,e,t){for(let s=0;s<e.length;s++)if(e[s]!==r[t+s+1])return!1;return!0}function uu(r){if(Nm(r))return r;throw new Error("Invalid entity name ".concat(r))}const J0=/^[-+]?0x[a-fA-F0-9]+$/,q0=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,_0={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0},W0=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;function mw(r){return typeof r=="function"?r:Array.isArray(r)?e=>{for(const t of r)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}class G0{constructor(e){if(this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,s)=>Td(s,10,"&#")},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,s)=>Td(s,16,"&#x")}},this.addExternalEntities=z0,this.parseXml=e1,this.parseTextData=X0,this.resolveNameSpace=Y0,this.buildAttributesMap=Z0,this.isItStopNode=a1,this.replaceEntitiesValue=s1,this.readStopNodeData=n1,this.saveTextToParentTag=r1,this.addChild=t1,this.ignoreAttributesFn=mw(this.options.ignoreAttributes),this.options.stopNodes&&this.options.stopNodes.length>0){this.stopNodesExact=new Set,this.stopNodesWildcard=new Set;for(let t=0;t<this.options.stopNodes.length;t++){const s=this.options.stopNodes[t];typeof s=="string"&&(s.startsWith("*.")?this.stopNodesWildcard.add(s.substring(2)):this.stopNodesExact.add(s))}}}}function z0(r){const e=Object.keys(r);for(let t=0;t<e.length;t++){const s=e[t];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:r[s]}}}function X0(r,e,t,s,a,n,i){if(r!==void 0&&(this.options.trimValues&&!s&&(r=r.trim()),r.length>0)){i||(r=this.replaceEntitiesValue(r));const o=this.options.tagValueProcessor(e,r,t,a,n);return o==null?r:typeof o!=typeof r||o!==r?o:this.options.trimValues||r.trim()===r?fw(r,this.options.parseTagValue,this.options.numberParseOptions):r}}function Y0(r){if(this.options.removeNSPrefix){const e=r.split(":"),t=r.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(r=t+e[1])}return r}const Q0=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function Z0(r,e){if(this.options.ignoreAttributes!==!0&&typeof r=="string"){const t=hw(r,Q0),s=t.length,a={};for(let n=0;n<s;n++){const i=this.resolveNameSpace(t[n][1]);if(this.ignoreAttributesFn(i,e))continue;let o=t[n][4],u=this.options.attributeNamePrefix+i;if(i.length)if(this.options.transformAttributeName&&(u=this.options.transformAttributeName(u)),u==="__proto__"&&(u="#__proto__"),o!==void 0){this.options.trimValues&&(o=o.trim()),o=this.replaceEntitiesValue(o);const h=this.options.attributeValueProcessor(i,o,e);a[u]=h==null?o:typeof h!=typeof o||h!==o?h:fw(o,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(a[u]=!0)}if(!Object.keys(a).length)return;if(this.options.attributesGroupName){const n={};return n[this.options.attributesGroupName]=a,n}return a}}const e1=function(r){r=r.replace(/\r\n?/g,"\n");const e=new Un("!xml");let t=e,s="",a="";const n=new F0(this.options.processEntities);for(let i=0;i<r.length;i++)if(r[i]==="<")if(r[i+1]==="/"){const o=Kn(r,">",i,"Closing Tag is not closed.");let u=r.substring(i+2,o).trim();if(this.options.removeNSPrefix){const d=u.indexOf(":");d!==-1&&(u=u.substr(d+1))}this.options.transformTagName&&(u=this.options.transformTagName(u)),t&&(s=this.saveTextToParentTag(s,t,a));const h=a.substring(a.lastIndexOf(".")+1);if(u&&this.options.unpairedTags.indexOf(u)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(u,">"));let l=0;h&&this.options.unpairedTags.indexOf(h)!==-1?(l=a.lastIndexOf(".",a.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=a.lastIndexOf("."),a=a.substring(0,l),t=this.tagsNodeStack.pop(),s="",i=o}else if(r[i+1]==="?"){let o=zf(r,i,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,t,a),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const u=new Un(o.tagName);u.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(u[":@"]=this.buildAttributesMap(o.tagExp,a)),this.addChild(t,u,a,i)}i=o.closeIndex+1}else if(r.substr(i+1,3)==="!--"){const o=Kn(r,"-->",i+4,"Comment is not closed.");if(this.options.commentPropName){const u=r.substring(i+4,o-2);s=this.saveTextToParentTag(s,t,a),t.add(this.options.commentPropName,[{[this.options.textNodeName]:u}])}i=o}else if(r.substr(i+1,2)==="!D"){const o=n.readDocType(r,i);this.docTypeEntities=o.entities,i=o.i}else if(r.substr(i+1,2)==="!["){const o=Kn(r,"]]>",i,"CDATA is not closed.")-2,u=r.substring(i+9,o);s=this.saveTextToParentTag(s,t,a);let h=this.parseTextData(u,t.tagname,a,!0,!1,!0,!0);h==null&&(h=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:u}]):t.add(this.options.textNodeName,h),i=o+2}else{let o=zf(r,i,this.options.removeNSPrefix),u=o.tagName;const h=o.rawTagName;let l=o.tagExp,d=o.attrExpPresent,m=o.closeIndex;if(this.options.transformTagName){const w=this.options.transformTagName(u);l===u&&(l=w),u=w}t&&s&&t.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,t,a,!1));const N=t;N&&this.options.unpairedTags.indexOf(N.tagname)!==-1&&(t=this.tagsNodeStack.pop(),a=a.substring(0,a.lastIndexOf("."))),u!==e.tagname&&(a+=a?"."+u:u);const y=i;if(this.isItStopNode(this.stopNodesExact,this.stopNodesWildcard,a,u)){let w="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)u[u.length-1]==="/"?(u=u.substr(0,u.length-1),a=a.substr(0,a.length-1),l=u):l=l.substr(0,l.length-1),i=o.closeIndex;else if(this.options.unpairedTags.indexOf(u)!==-1)i=o.closeIndex;else{const S=this.readStopNodeData(r,h,m+1);if(!S)throw new Error("Unexpected end of ".concat(h));i=S.i,w=S.tagContent}const g=new Un(u);u!==l&&d&&(g[":@"]=this.buildAttributesMap(l,a)),w&&(w=this.parseTextData(w,u,a,!0,d,!0,!0)),a=a.substr(0,a.lastIndexOf(".")),g.add(this.options.textNodeName,w),this.addChild(t,g,a,y)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){if(u[u.length-1]==="/"?(u=u.substr(0,u.length-1),a=a.substr(0,a.length-1),l=u):l=l.substr(0,l.length-1),this.options.transformTagName){const g=this.options.transformTagName(u);l===u&&(l=g),u=g}const w=new Un(u);u!==l&&d&&(w[":@"]=this.buildAttributesMap(l,a)),this.addChild(t,w,a,y),a=a.substr(0,a.lastIndexOf("."))}else{const w=new Un(u);this.tagsNodeStack.push(t),u!==l&&d&&(w[":@"]=this.buildAttributesMap(l,a)),this.addChild(t,w,a,y),t=w}s="",i=m}}else s+=r[i];return e.child};function t1(r,e,t,s){this.options.captureMetaData||(s=void 0);const a=this.options.updateTag(e.tagname,t,e[":@"]);a===!1||(typeof a=="string"&&(e.tagname=a),r.addChild(e,s))}const s1=function(r){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];r=r.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];r=r.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];r=r.replace(t.regex,t.val)}r=r.replace(this.ampEntity.regex,this.ampEntity.val)}return r};function r1(r,e,t,s){return r&&(s===void 0&&(s=e.child.length===0),(r=this.parseTextData(r,e.tagname,t,!1,!!e[":@"]&&Object.keys(e[":@"]).length!==0,s))!==void 0&&r!==""&&e.add(this.options.textNodeName,r),r=""),r}function a1(r,e,t,s){return!(!e||!e.has(s))||!(!r||!r.has(t))}function Kn(r,e,t,s){const a=r.indexOf(e,t);if(a===-1)throw new Error(s);return a+e.length-1}function zf(r,e,t){const s=function(l,d){let m,N=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",y="";for(let w=d;w<l.length;w++){let g=l[w];if(m)g===m&&(m="");else if(g==='"'||g==="'")m=g;else if(g===N[0]){if(!N[1])return{data:y,index:w};if(l[w+1]===N[1])return{data:y,index:w}}else g==="	"&&(g=" ");y+=g}}(r,e+1,arguments.length>3&&arguments[3]!==void 0?arguments[3]:">");if(!s)return;let a=s.data;const n=s.index,i=a.search(/\s/);let o=a,u=!0;i!==-1&&(o=a.substring(0,i),a=a.substring(i+1).trimStart());const h=o;if(t){const l=o.indexOf(":");l!==-1&&(o=o.substr(l+1),u=o!==s.data.substr(l+1))}return{tagName:o,tagExp:a,closeIndex:n,attrExpPresent:u,rawTagName:h}}function n1(r,e,t){const s=t;let a=1;for(;t<r.length;t++)if(r[t]==="<")if(r[t+1]==="/"){const n=Kn(r,">",t,"".concat(e," is not closed"));if(r.substring(t+2,n).trim()===e&&(a--,a===0))return{tagContent:r.substring(s,t),i:n};t=n}else if(r[t+1]==="?")t=Kn(r,"?>",t+1,"StopNode is not closed.");else if(r.substr(t+1,3)==="!--")t=Kn(r,"-->",t+3,"StopNode is not closed.");else if(r.substr(t+1,2)==="![")t=Kn(r,"]]>",t,"StopNode is not closed.")-2;else{const n=zf(r,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&a++,t=n.closeIndex)}}function fw(r,e,t){if(e&&typeof r=="string"){const s=r.trim();return s==="true"||s!=="false"&&function(a){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n=Object.assign({},_0,n),!a||typeof a!="string")return a;let i=a.trim();if(n.skipLike!==void 0&&n.skipLike.test(i))return a;if(a==="0")return 0;if(n.hex&&J0.test(i))return function(u){if(parseInt)return parseInt(u,16);if(Number.parseInt)return Number.parseInt(u,16);if(window&&window.parseInt)return window.parseInt(u,16);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}(i);if(i.includes("e")||i.includes("E"))return function(u,h,l){if(!l.eNotation)return u;const d=h.match(W0);if(d){let m=d[1]||"";const N=d[3].indexOf("e")===-1?"E":"e",y=d[2],w=m?u[y.length+1]===N:u[y.length]===N;return y.length>1&&w?u:y.length!==1||!d[3].startsWith(".".concat(N))&&d[3][0]!==N?l.leadingZeros&&!w?(h=(d[1]||"")+d[3],Number(h)):u:Number(h)}return u}(a,i,n);{const u=q0.exec(i);if(u){const h=u[1]||"",l=u[2];let d=((o=u[3])&&o.indexOf(".")!==-1&&((o=o.replace(/0+$/,""))==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substring(0,o.length-1))),o);const m=h?a[l.length+1]===".":a[l.length]===".";if(!n.leadingZeros&&(l.length>1||l.length===1&&!m))return a;{const N=Number(i),y=String(N);if(N===0)return N;if(y.search(/[eE]/)!==-1)return n.eNotation?N:a;if(i.indexOf(".")!==-1)return y==="0"||y===d||y==="".concat(h).concat(d)?N:a;let w=l?d:i;return l?w===y||h+w===y?N:a:w===y||w===h+y?N:a}}return a}var o}(r,t)}return r!==void 0?r:""}function Td(r,e,t){const s=Number.parseInt(r,e);return s>=0&&s<=1114111?String.fromCodePoint(s):t+r+";"}const Mm=Un.getMetaDataSymbol();function i1(r,e){return pw(r,e)}function pw(r,e,t){let s;const a={};for(let n=0;n<r.length;n++){const i=r[n],o=o1(i);let u="";if(u=t===void 0?o:t+"."+o,o===e.textNodeName)s===void 0?s=i[o]:s+=""+i[o];else{if(o===void 0)continue;if(i[o]){let h=pw(i[o],e,u);const l=l1(h,e);i[Mm]!==void 0&&(h[Mm]=i[Mm]),i[":@"]?u1(h,i[":@"],u,e):Object.keys(h).length!==1||h[e.textNodeName]===void 0||e.alwaysCreateTextNode?Object.keys(h).length===0&&(e.alwaysCreateTextNode?h[e.textNodeName]="":h=""):h=h[e.textNodeName],a[o]!==void 0&&a.hasOwnProperty(o)?(Array.isArray(a[o])||(a[o]=[a[o]]),a[o].push(h)):e.isArray(o,u,l)?a[o]=[h]:a[o]=h}}}return typeof s=="string"?s.length>0&&(a[e.textNodeName]=s):s!==void 0&&(a[e.textNodeName]=s),a}function o1(r){const e=Object.keys(r);for(let t=0;t<e.length;t++){const s=e[t];if(s!==":@")return s}}function u1(r,e,t,s){if(e){const a=Object.keys(e),n=a.length;for(let i=0;i<n;i++){const o=a[i];s.isArray(o,t+"."+o,!0,!0)?r[o]=[e[o]]:r[o]=e[o]}}}function l1(r,e){const{textNodeName:t}=e,s=Object.keys(r).length;return s===0||!(s!==1||!r[t]&&typeof r[t]!="boolean"&&r[t]!==0)}const c1={allowBooleanAttributes:!1,unpairedTags:[]};function Rd(r){return r===" "||r==="	"||r==="\n"||r==="\r"}function Ld(r,e){const t=e;for(;e<r.length;e++)if(!(r[e]!="?"&&r[e]!=" ")){const s=r.substr(t,e-t);if(e>5&&s==="xml")return _e("InvalidXml","XML declaration allowed only at the start of the document.",Tt(r,e));if(r[e]=="?"&&r[e+1]==">"){e++;break}}return e}function Ud(r,e){if(r.length>e+5&&r[e+1]==="-"&&r[e+2]==="-"){for(e+=3;e<r.length;e++)if(r[e]==="-"&&r[e+1]==="-"&&r[e+2]===">"){e+=2;break}}else if(r.length>e+8&&r[e+1]==="D"&&r[e+2]==="O"&&r[e+3]==="C"&&r[e+4]==="T"&&r[e+5]==="Y"&&r[e+6]==="P"&&r[e+7]==="E"){let t=1;for(e+=8;e<r.length;e++)if(r[e]==="<")t++;else if(r[e]===">"&&(t--,t===0))break}else if(r.length>e+9&&r[e+1]==="["&&r[e+2]==="C"&&r[e+3]==="D"&&r[e+4]==="A"&&r[e+5]==="T"&&r[e+6]==="A"&&r[e+7]==="["){for(e+=8;e<r.length;e++)if(r[e]==="]"&&r[e+1]==="]"&&r[e+2]===">"){e+=2;break}}return e}function h1(r,e){let t="",s="",a=!1;for(;e<r.length;e++){if(r[e]==='"'||r[e]==="'")s===""?s=r[e]:s!==r[e]||(s="");else if(r[e]===">"&&s===""){a=!0;break}t+=r[e]}return s===""&&{value:t,index:e,tagClosed:a}}const m1=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function jd(r,e){const t=hw(r,m1),s={};for(let a=0;a<t.length;a++){if(t[a][1].length===0)return _e("InvalidAttr","Attribute '"+t[a][2]+"' has no space in starting.",lu(t[a]));if(t[a][3]!==void 0&&t[a][4]===void 0)return _e("InvalidAttr","Attribute '"+t[a][2]+"' is without value.",lu(t[a]));if(t[a][3]===void 0&&!e.allowBooleanAttributes)return _e("InvalidAttr","boolean attribute '"+t[a][2]+"' is not allowed.",lu(t[a]));const n=t[a][2];if(!p1(n))return _e("InvalidAttr","Attribute '"+n+"' is an invalid name.",lu(t[a]));if(s.hasOwnProperty(n))return _e("InvalidAttr","Attribute '"+n+"' is repeated.",lu(t[a]));s[n]=1}return!0}function f1(r,e){if(r[++e]===";")return-1;if(r[e]==="#")return function(s,a){let n=/\d/;for(s[a]==="x"&&(a++,n=/[\da-fA-F]/);a<s.length;a++){if(s[a]===";")return a;if(!s[a].match(n))break}return-1}(r,++e);let t=0;for(;e<r.length;e++,t++)if(!(r[e].match(/\w/)&&t<20)){if(r[e]===";")break;return-1}return e}function _e(r,e,t){return{err:{code:r,msg:e,line:t.line||t,col:t.col}}}function p1(r){return Nm(r)}function Tt(r,e){const t=r.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function lu(r){return r.startIndex+r[1].length}class dw{constructor(e){this.externalEntities={},this.options=function(t){return Object.assign({},K0,t)}(e)}parse(e,t){if(typeof e!="string"&&e.toString)e=e.toString();else if(typeof e!="string")throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});const n=function(i,o){o=Object.assign({},c1,o);const u=[];let h=!1,l=!1;i[0]==="\uFEFF"&&(i=i.substr(1));for(let d=0;d<i.length;d++)if(i[d]==="<"&&i[d+1]==="?"){if(d+=2,d=Ld(i,d),d.err)return d}else{if(i[d]!=="<"){if(Rd(i[d]))continue;return _e("InvalidChar","char '"+i[d]+"' is not expected.",Tt(i,d))}{let m=d;if(d++,i[d]==="!"){d=Ud(i,d);continue}{let N=!1;i[d]==="/"&&(N=!0,d++);let y="";for(;d<i.length&&i[d]!==">"&&i[d]!==" "&&i[d]!=="	"&&i[d]!=="\n"&&i[d]!=="\r";d++)y+=i[d];if(y=y.trim(),y[y.length-1]==="/"&&(y=y.substring(0,y.length-1),d--),!Nm(y)){let S;return S=y.trim().length===0?"Invalid space after '<'.":"Tag '"+y+"' is an invalid name.",_e("InvalidTag",S,Tt(i,d))}const w=h1(i,d);if(w===!1)return _e("InvalidAttr","Attributes for '"+y+"' have open quote.",Tt(i,d));let g=w.value;if(d=w.index,g[g.length-1]==="/"){const S=d-g.length;g=g.substring(0,g.length-1);const A=jd(g,o);if(A!==!0)return _e(A.err.code,A.err.msg,Tt(i,S+A.err.line));h=!0}else if(N){if(!w.tagClosed)return _e("InvalidTag","Closing tag '"+y+"' doesn't have proper closing.",Tt(i,d));if(g.trim().length>0)return _e("InvalidTag","Closing tag '"+y+"' can't have attributes or invalid starting.",Tt(i,m));if(u.length===0)return _e("InvalidTag","Closing tag '"+y+"' has not been opened.",Tt(i,m));{const S=u.pop();if(y!==S.tagName){let A=Tt(i,S.tagStartPos);return _e("InvalidTag","Expected closing tag '"+S.tagName+"' (opened in line "+A.line+", col "+A.col+") instead of closing tag '"+y+"'.",Tt(i,m))}u.length==0&&(l=!0)}}else{const S=jd(g,o);if(S!==!0)return _e(S.err.code,S.err.msg,Tt(i,d-g.length+S.err.line));if(l===!0)return _e("InvalidXml","Multiple possible root nodes found.",Tt(i,d));o.unpairedTags.indexOf(y)!==-1||u.push({tagName:y,tagStartPos:m}),h=!0}for(d++;d<i.length;d++)if(i[d]==="<"){if(i[d+1]==="!"){d++,d=Ud(i,d);continue}if(i[d+1]!=="?")break;if(d=Ld(i,++d),d.err)return d}else if(i[d]==="&"){const S=f1(i,d);if(S==-1)return _e("InvalidChar","char '&' is not expected.",Tt(i,d));d=S}else if(l===!0&&!Rd(i[d]))return _e("InvalidXml","Extra text at the end",Tt(i,d));i[d]==="<"&&d--}}}return h?u.length==1?_e("InvalidTag","Unclosed tag '"+u[0].tagName+"'.",Tt(i,u[0].tagStartPos)):!(u.length>0)||_e("InvalidXml","Invalid '"+JSON.stringify(u.map(d=>d.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):_e("InvalidXml","Start tag expected.",1)}(e,t);if(n!==!0)throw Error("".concat(n.err.msg,":").concat(n.err.line,":").concat(n.err.col))}const s=new G0(this.options);s.addExternalEntities(this.externalEntities);const a=s.parseXml(e);return this.options.preserveOrder||a===void 0?a:i1(a,this.options)}addEntity(e,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}static getMetaDataSymbol(){return Un.getMetaDataSymbol()}}var d1=Oe(829),er=Oe.n(d1),Uo=function(r){return r.Array="array",r.Object="object",r.Original="original",r}(Uo||{});function gw(r,e){if(!r.endsWith("propstat.prop.displayname"))return e}function Jc(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Uo.Original;const s=er().get(r,e);return t==="array"&&Array.isArray(s)===!1?[s]:t==="object"&&Array.isArray(s)?s[0]:s}function Uc(r,e){return e=e!=null?e:{attributeNamePrefix:"@",attributeParsers:[],tagParsers:[gw]},new Promise(t=>{t(function(s){const{multistatus:a}=s;if(a==="")return{multistatus:{response:[]}};if(!a)throw new Error("Invalid response: No root multistatus found");const n={multistatus:Array.isArray(a)?a[0]:a};return er().set(n,"multistatus.response",Jc(n,"multistatus.response",Uo.Array)),er().set(n,"multistatus.response",er().get(n,"multistatus.response").map(i=>function(o){const u=Object.assign({},o);return u.status?er().set(u,"status",Jc(u,"status",Uo.Object)):(er().set(u,"propstat",Jc(u,"propstat",Uo.Object)),er().set(u,"propstat.prop",Jc(u,"propstat.prop",Uo.Object))),u}(i))),n}(function(s){let{attributeNamePrefix:a,attributeParsers:n,tagParsers:i}=s;return new dw({allowBooleanAttributes:!0,attributeNamePrefix:a,textNodeName:"text",ignoreAttributes:!1,removeNSPrefix:!0,numberParseOptions:{hex:!0,leadingZeros:!1},attributeValueProcessor(o,u,h){for(const l of n)try{const d=l(h,u);if(d!==u)return d}catch(d){}return u},tagValueProcessor(o,u,h){for(const l of i)try{const d=l(h,u);if(d!==u)return d}catch(d){}return u}})}(e).parse(r)))})}function Vp(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const{getlastmodified:s=null,getcontentlength:a="0",resourcetype:n=null,getcontenttype:i=null,getetag:o=null}=r,u=n&&typeof n=="object"&&n.collection!==void 0?"directory":"file",h={filename:e,basename:sm().basename(e),lastmod:s,size:parseInt(a,10),type:u,etag:typeof o=="string"?o.replace(/"/g,""):null};return u==="file"&&(h.mime=i&&typeof i=="string"?i.split(";")[0]:""),t&&(r.displayname!==void 0&&(r.displayname=String(r.displayname)),h.props=r),h}function ww(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=null;try{r.multistatus.response[0].propstat&&(s=r.multistatus.response[0])}catch(l){}if(!s)throw new Error("Failed getting item stat: bad response");const{propstat:{prop:a,status:n}}=s,[i,o,u]=n.split(" ",3),h=parseInt(o,10);if(h>=400){const l=new Error("Invalid response: ".concat(h," ").concat(u));throw l.status=h,l}return Vp(a,Bc(e),t)}function g1(r){switch(String(r)){case"-3":return"unlimited";case"-2":case"-1":return"unknown";default:return parseInt(String(r),10)}}function Km(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Pp=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=pt({url:Ke(r.remoteURL,Me(e)),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,t);return Km(ft(a,r),function(n){return dt(r,n),Km(n.text(),function(i){return Km(Uc(i,r.parsing),function(o){const u=ww(o,e,s);return eu(n,u,s)})})})});function yw(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const w1=vw(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=function(n){if(!n||n==="/")return[];let i=n;const o=[];do o.push(i),i=sm().dirname(i);while(i&&i!=="/");return o}(Bc(e));s.sort((n,i)=>n.length>i.length?1:i.length>n.length?-1:0);let a=!1;return function(n,i,o){if(typeof n[Md]=="function"){let w=function(g){try{for(;!(u=d.next()).done;)if((g=i(u.value))&&g.then){if(!Kd(g))return void g.then(w,l||(l=Mt.bind(null,h=new jo,2)));g=g.v}h?Mt(h,1,g):h=g}catch(S){Mt(h||(h=new jo),2,S)}};var u,h,l,d=n[Md]();if(w(),d.return){var m=function(g){try{u.done||d.return()}catch(S){}return g};if(h&&h.then)return h.then(m,function(g){throw m(g)});m()}return h}if(!("length"in n))throw new TypeError("Object is not iterable");for(var N=[],y=0;y<n.length;y++)N.push(n[y]);return function(w,g,S){var A,k,C=-1;return function V(M){try{for(;++C<w.length&&(!S||!S());)if((M=g(C))&&M.then){if(!Kd(M))return void M.then(V,k||(k=Mt.bind(null,A=new jo,2)));M=M.v}A?Mt(A,1,M):A=M}catch(U){Mt(A||(A=new jo),2,U)}}(),A}(N,function(w){return i(N[w])},o)}(s,function(n){return i=function(){return function(u,h){try{var l=yw(Pp(r,n),function(d){if(d.type!=="directory")throw new Error("Path includes a file: ".concat(e))})}catch(d){return h(d)}return l&&l.then?l.then(void 0,h):l}(0,function(u){const h=u;return function(){if(h.status===404)return a=!0,$d(Xf(r,n,xs(It({},t),{recursive:!1})));throw u}()})},(o=function(){if(a)return $d(Xf(r,n,xs(It({},t),{recursive:!1})))}())&&o.then?o.then(i):i();var i,o},function(){return!1})});function vw(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function y1(){}function $d(r,e){return r&&r.then?r.then(y1):Promise.resolve()}const Md=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function Mt(r,e,t){if(!r.s){if(t instanceof jo){if(!t.s)return void(t.o=Mt.bind(null,r,e));1&e&&(e=t.s),t=t.v}if(t&&t.then)return void t.then(Mt.bind(null,r,e),Mt.bind(null,r,2));r.s=e,r.v=t;const s=r.o;s&&s(r)}}const jo=function(){function r(){}return r.prototype.then=function(e,t){const s=new r,a=this.s;if(a){const n=1&a?e:t;if(n){try{Mt(s,1,n(this.v))}catch(i){Mt(s,2,i)}return s}return this}return this.o=function(n){try{const i=n.v;1&n.s?Mt(s,1,e?e(i):i):t?Mt(s,1,t(i)):Mt(s,2,i)}catch(i){Mt(s,2,i)}},s},r}();function Kd(r){return r instanceof jo&&1&r.s}const Xf=vw(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.recursive===!0)return w1(r,e,t);const s=pt({url:Ke(r.remoteURL,(a=Me(e),a.endsWith("/")?a:a+"/")),method:"MKCOL"},r,t);var a;return yw(ft(s,r),function(n){dt(r,n)})});var v1=Oe(388),Hd=Oe.n(v1);const b1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s={};if(typeof t.range=="object"&&typeof t.range.start=="number"){let o="bytes=".concat(t.range.start,"-");typeof t.range.end=="number"&&(o="".concat(o).concat(t.range.end)),s.Range=o}const a=pt({url:Ke(r.remoteURL,Me(e)),method:"GET",headers:s},r,t);return i=function(o){if(dt(r,o),s.Range&&o.status!==206){const u=new Error("Invalid response code for partial request: ".concat(o.status));throw u.status=o.status,u}return t.callback&&setTimeout(()=>{t.callback(o)},0),o.body},(n=ft(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i}),A1=()=>{},S1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){t.url||(t.url=Ke(r.remoteURL,Me(e)));const s=pt(t,r,{});return n=function(i){return dt(r,i),i},(a=ft(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),N1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=pt({url:Ke(r.remoteURL,Me(e)),method:"DELETE"},r,t);return n=function(i){dt(r,i)},(a=ft(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),E1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function(s,a){try{var n=(i=Pp(r,e,t),o=function(){return!0},u?o?o(i):i:(i&&i.then||(i=Promise.resolve(i)),o?i.then(o):i))}catch(h){return a(h)}var i,o,u;return n&&n.then?n.then(void 0,a):n}(0,function(s){if(s.status===404)return!1;throw s})});function Hm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const k1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=pt({url:Ke(r.remoteURL,Me(e),"/"),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:t.deep?"infinity":"1"}},r,t);return Hm(ft(s,r),function(a){return dt(r,a),Hm(a.text(),function(n){if(!n)throw new Error("Failed parsing directory contents: Empty response");return Hm(Uc(n,r.parsing),function(i){const o=bd(e);let u=function(h,l,d){let m=arguments.length>3&&arguments[3]!==void 0&&arguments[3],N=arguments.length>4&&arguments[4]!==void 0&&arguments[4];const y=sm().join(l,"/"),{multistatus:{response:w}}=h,g=w.map(S=>{const A=function(C){try{return C.replace(/^https?:\/\/[^\/]+/,"")}catch(V){throw new Ht(V,"Failed normalising HREF")}}(S.href),{propstat:{prop:k}}=S;return Vp(k,y==="/"?decodeURIComponent(Bc(A)):Bc(sm().relative(decodeURIComponent(y),decodeURIComponent(A))),m)});return N?g:g.filter(S=>S.basename&&(S.type==="file"||S.filename!==d.replace(/\/$/,"")))}(i,bd(r.remoteBasePath||r.remotePath),o,t.details,t.includeSelf);return t.glob&&(u=function(h,l){return h.filter(d=>Dt(d.filename,l,{matchBase:!0}))}(u,t.glob)),eu(a,u,t.details)})})})});function Op(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const I1=Op(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=pt({url:Ke(r.remoteURL,Me(e)),method:"GET",headers:{Accept:"text/plain"},transformResponse:[x1]},r,t);return um(ft(s,r),function(a){return dt(r,a),um(a.text(),function(n){return eu(a,n,t.details)})})});function um(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const C1=Op(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=pt({url:Ke(r.remoteURL,Me(e)),method:"GET"},r,t);return um(ft(s,r),function(a){let n;return dt(r,a),function(i,o){var u=i();return u&&u.then?u.then(o):o()}(function(){return um(a.arrayBuffer(),function(i){n=i})},function(){return eu(a,n,t.details)})})}),B1=Op(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{format:s="binary"}=t;if(s!=="binary"&&s!=="text")throw new Ht({info:{code:xa.InvalidOutputFormat}},"Invalid output format: ".concat(s));return s==="text"?I1(r,e,t):C1(r,e,t)}),x1=r=>r;function V1(r,e){let t="";return e.format&&e.indentBy.length>0&&(t="\n"),bw(r,e,"",t)}function bw(r,e,t,s){let a="",n=!1;for(let i=0;i<r.length;i++){const o=r[i],u=P1(o);if(u===void 0)continue;let h="";if(h=t.length===0?u:"".concat(t,".").concat(u),u===e.textNodeName){let N=o[u];O1(h,e)||(N=e.tagValueProcessor(u,N),N=Aw(N,e)),n&&(a+=s),a+=N,n=!1;continue}if(u===e.cdataPropName){n&&(a+=s),a+="<![CDATA[".concat(o[u][0][e.textNodeName],"]]>"),n=!1;continue}if(u===e.commentPropName){a+=s+"<!--".concat(o[u][0][e.textNodeName],"-->"),n=!0;continue}if(u[0]==="?"){const N=Fd(o[":@"],e),y=u==="?xml"?"":s;let w=o[u][0][e.textNodeName];w=w.length!==0?" "+w:"",a+=y+"<".concat(u).concat(w).concat(N,"?>"),n=!0;continue}let l=s;l!==""&&(l+=e.indentBy);const d=s+"<".concat(u).concat(Fd(o[":@"],e)),m=bw(o[u],e,h,l);e.unpairedTags.indexOf(u)!==-1?e.suppressUnpairedNode?a+=d+">":a+=d+"/>":m&&m.length!==0||!e.suppressEmptyNode?m&&m.endsWith(">")?a+=d+">".concat(m).concat(s,"</").concat(u,">"):(a+=d+">",m&&s!==""&&(m.includes("/>")||m.includes("</"))?a+=s+e.indentBy+m+s:a+=m,a+="</".concat(u,">")):a+=d+"/>",n=!0}return a}function P1(r){const e=Object.keys(r);for(let t=0;t<e.length;t++){const s=e[t];if(r.hasOwnProperty(s)&&s!==":@")return s}}function Fd(r,e){let t="";if(r&&!e.ignoreAttributes)for(let s in r){if(!r.hasOwnProperty(s))continue;let a=e.attributeValueProcessor(s,r[s]);a=Aw(a,e),a===!0&&e.suppressBooleanAttributes?t+=" ".concat(s.substr(e.attributeNamePrefix.length)):t+=" ".concat(s.substr(e.attributeNamePrefix.length),'="').concat(a,'"')}return t}function O1(r,e){let t=(r=r.substr(0,r.length-e.textNodeName.length-1)).substr(r.lastIndexOf(".")+1);for(let s in e.stopNodes)if(e.stopNodes[s]===r||e.stopNodes[s]==="*."+t)return!0;return!1}function Aw(r,e){if(r&&r.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const s=e.entities[t];r=r.replace(s.regex,s.val)}return r}const D1={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Er(r){this.options=Object.assign({},D1,r),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=mw(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=L1),this.processTextOrObjNode=T1,this.options.format?(this.indentate=R1,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function T1(r,e,t,s){const a=this.j2x(r,t+1,s.concat(e));return r[this.options.textNodeName]!==void 0&&Object.keys(r).length===1?this.buildTextValNode(r[this.options.textNodeName],e,a.attrStr,t):this.buildObjectNode(a.val,e,a.attrStr,t)}function R1(r){return this.options.indentBy.repeat(r)}function L1(r){return!(!r.startsWith(this.options.attributeNamePrefix)||r===this.options.textNodeName)&&r.substr(this.attrPrefixLen)}function U1(r){return new Er({attributeNamePrefix:"@_",format:!0,ignoreAttributes:!1,suppressEmptyNode:!0}).build(Sw({lockinfo:{"@_xmlns:d":"DAV:",lockscope:{exclusive:{}},locktype:{write:{}},owner:{href:r}}},"d"))}function Sw(r,e){const t=It({},r);for(const s in t)t.hasOwnProperty(s)&&(t[s]&&typeof t[s]=="object"&&s.indexOf(":")===-1?(t["".concat(e,":").concat(s)]=Sw(t[s],e),delete t[s]):/^@_/.test(s)===!1&&(t["".concat(e,":").concat(s)]=t[s],delete t[s]));return t}function Yf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}function Nw(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}Er.prototype.build=function(r){return this.options.preserveOrder?V1(r,this.options):(Array.isArray(r)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(r={[this.options.arrayNodeName]:r}),this.j2x(r,0,[]).val)},Er.prototype.j2x=function(r,e,t){let s="",a="";const n=t.join(".");for(let i in r)if(Object.prototype.hasOwnProperty.call(r,i))if(r[i]===void 0)this.isAttribute(i)&&(a+="");else if(r[i]===null)this.isAttribute(i)||i===this.options.cdataPropName?a+="":i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(r[i]instanceof Date)a+=this.buildTextValNode(r[i],i,"",e);else if(typeof r[i]!="object"){const o=this.isAttribute(i);if(o&&!this.ignoreAttributesFn(o,n))s+=this.buildAttrPairStr(o,""+r[i]);else if(!o)if(i===this.options.textNodeName){let u=this.options.tagValueProcessor(i,""+r[i]);a+=this.replaceEntitiesValue(u)}else a+=this.buildTextValNode(r[i],i,"",e)}else if(Array.isArray(r[i])){const o=r[i].length;let u="",h="";for(let l=0;l<o;l++){const d=r[i][l];if(d!==void 0)if(d===null)i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(typeof d=="object")if(this.options.oneListGroup){const m=this.j2x(d,e+1,t.concat(i));u+=m.val,this.options.attributesGroupName&&d.hasOwnProperty(this.options.attributesGroupName)&&(h+=m.attrStr)}else u+=this.processTextOrObjNode(d,i,e,t);else if(this.options.oneListGroup){let m=this.options.tagValueProcessor(i,d);m=this.replaceEntitiesValue(m),u+=m}else u+=this.buildTextValNode(d,i,"",e)}this.options.oneListGroup&&(u=this.buildObjectNode(u,i,h,e)),a+=u}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const o=Object.keys(r[i]),u=o.length;for(let h=0;h<u;h++)s+=this.buildAttrPairStr(o[h],""+r[i][o[h]])}else a+=this.processTextOrObjNode(r[i],i,e,t);return{attrStr:s,val:a}},Er.prototype.buildAttrPairStr=function(r,e){return e=this.options.attributeValueProcessor(r,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+r:" "+r+'="'+e+'"'},Er.prototype.buildObjectNode=function(r,e,t,s){if(r==="")return e[0]==="?"?this.indentate(s)+"<"+e+t+"?"+this.tagEndChar:this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let a="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",a=""),!t&&t!==""||r.indexOf("<")!==-1?this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(s)+"<!--".concat(r,"-->")+this.newLine:this.indentate(s)+"<"+e+t+n+this.tagEndChar+r+this.indentate(s)+a:this.indentate(s)+"<"+e+t+n+">"+r+a}},Er.prototype.closeTag=function(r){let e="";return this.options.unpairedTags.indexOf(r)!==-1?this.options.suppressUnpairedNode||(e="/"):e=this.options.suppressEmptyNode?"/":"></".concat(r),e},Er.prototype.buildTextValNode=function(r,e,t,s){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(s)+"<![CDATA[".concat(r,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(s)+"<!--".concat(r,"-->")+this.newLine;if(e[0]==="?")return this.indentate(s)+"<"+e+t+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(e,r);return a=this.replaceEntitiesValue(a),a===""?this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(s)+"<"+e+t+">"+a+"</"+e+this.tagEndChar}},Er.prototype.replaceEntitiesValue=function(r){if(r&&r.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];r=r.replace(t.regex,t.val)}return r};const j1=Nw(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=pt({url:Ke(r.remoteURL,Me(e)),method:"UNLOCK",headers:{"Lock-Token":t}},r,s);return Yf(ft(a,r),function(n){if(dt(r,n),n.status!==204&&n.status!==200)throw xp(n)})}),$1=Nw(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{refreshToken:s,timeout:a=M1}=t,n={Accept:"text/plain,application/xml",Timeout:a};s&&(n.If=s);const i=pt({url:Ke(r.remoteURL,Me(e)),method:"LOCK",headers:n,data:U1(r.contactHref)},r,t);return Yf(ft(i,r),function(o){return dt(r,o),Yf(o.text(),function(u){const h=(m=u,new dw({removeNSPrefix:!0,parseAttributeValue:!0,parseTagValue:!0}).parse(m)),l=er().get(h,"prop.lockdiscovery.activelock.locktoken.href"),d=er().get(h,"prop.lockdiscovery.activelock.timeout");var m;if(!l)throw xp(o,"No lock token received: ");return{token:l,serverTimeout:d}})})}),M1="Infinite, Second-4100000000";function Fm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const K1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.path||"/",s=pt({url:Ke(r.remoteURL,t),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,e);return Fm(ft(s,r),function(a){return dt(r,a),Fm(a.text(),function(n){return Fm(Uc(n,r.parsing),function(i){const o=function(u){try{const[h]=u.multistatus.response,{propstat:{prop:{"quota-used-bytes":l,"quota-available-bytes":d}}}=h;return l!==void 0&&d!==void 0?{used:parseInt(String(l),10),available:g1(d)}:null}catch(h){}return null}(i);return eu(a,o,e.details)})})})});function Jm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const H1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=pt({url:Ke(r.remoteURL,Me(e)),method:"SEARCH",headers:{Accept:"text/plain,application/xml","Content-Type":r.headers["Content-Type"]||"application/xml; charset=utf-8"}},r,t);return Jm(ft(a,r),function(n){return dt(r,n),Jm(n.text(),function(i){return Jm(Uc(i,r.parsing),function(o){const u=function(h,l,d){const m={truncated:!1,results:[]};return m.truncated=h.multistatus.response.some(N=>{var y,w;return((w=(N.status||((y=N.propstat)==null?void 0:y.status)).split(" ",3))==null?void 0:w[1])==="507"&&N.href.replace(/\/$/,"").endsWith(Me(l).replace(/\/$/,""))}),h.multistatus.response.forEach(N=>{if(N.propstat===void 0)return;const y=N.href.split("/").map(decodeURIComponent).join("/");m.results.push(Vp(N.propstat.prop,y,d))}),m}(o,e,s);return eu(n,u,s)})})})}),F1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=pt({url:Ke(r.remoteURL,Me(e)),method:"MOVE",headers:{Destination:Ke(r.remoteURL,Me(t)),Overwrite:s.overwrite===!1?"F":"T"}},r,s);return i=function(o){dt(r,o)},(n=ft(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i});var J1=Oe(172);function q1(r){if(sw(r))return r.byteLength;if(rw(r))return r.length;if(typeof r=="string")return(0,J1.d)(r);throw new Ht({info:{code:xa.DataTypeNoLength}},"Cannot calculate data length: Invalid type")}const _1=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const{contentLength:a=!0,overwrite:n=!0}=s,i={"Content-Type":"application/octet-stream"};a===!1||(i["Content-Length"]=typeof a=="number"?"".concat(a):"".concat(q1(t))),n||(i["If-None-Match"]="*");const o=pt({url:Ke(r.remoteURL,Me(e)),method:"PUT",headers:i,data:t},r,s);return h=function(l){try{dt(r,l)}catch(d){const m=d;if(m.status!==412||n)throw m;return!1}return!0},(u=ft(o,r))&&u.then||(u=Promise.resolve(u)),h?u.then(h):u;var u,h}),Ew=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=pt({url:Ke(r.remoteURL,Me(e)),method:"OPTIONS"},r,t);return n=function(i){var o,u;try{dt(r,i)}catch(h){throw h}return{compliance:((o=i.headers.get("DAV"))!=null?o:"").split(",").map(h=>h.trim()),server:(u=i.headers.get("Server"))!=null?u:""}},(a=ft(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n});function Ac(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const W1=Dp(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new Ht({info:{code:xa.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const i={"Content-Type":"application/octet-stream","Content-Length":""+(s-t+1),"Content-Range":"bytes ".concat(t,"-").concat(s,"/*")},o=pt({url:Ke(r.remoteURL,Me(e)),method:"PUT",headers:i,data:a},r,n);return Ac(ft(o,r),function(u){dt(r,u)})});function Jd(r,e){var t=r();return t&&t.then?t.then(e):e(t)}const G1=Dp(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new Ht({info:{code:xa.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const i={"Content-Type":"application/x-sabredav-partialupdate","Content-Length":""+(s-t+1),"X-Update-Range":"bytes=".concat(t,"-").concat(s)},o=pt({url:Ke(r.remoteURL,Me(e)),method:"PATCH",headers:i,data:a},r,n);return Ac(ft(o,r),function(u){dt(r,u)})});function Dp(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const z1=Dp(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};return Ac(Ew(r,e,n),function(i){let o=!1;return Jd(function(){if(i.compliance.includes("sabredav-partialupdate"))return Ac(G1(r,e,t,s,a,n),function(u){return o=!0,u})},function(u){let h=!1;return o?u:Jd(function(){if(i.server.includes("Apache")&&i.compliance.includes("<http://apache.org/dav/propset/fs/1>"))return Ac(W1(r,e,t,s,a,n),function(l){return h=!0,l})},function(l){if(h)return l;throw new Ht({info:{code:xa.NotSupported}},"Not supported")})})})}),X1="https://github.com/perry-mitchell/webdav-client/blob/master/LOCK_CONTACT.md";function Y1(r){var w;let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{authType:t=null,remoteBasePath:s,contactHref:a=X1,ha1:n,headers:i={},httpAgent:o,httpsAgent:u,password:h,token:l,username:d,withCredentials:m}=e;let N=t;N||(N=d||h?Xt.Password:Xt.None);const y={authType:N,remoteBasePath:s,contactHref:a,ha1:n,headers:Object.assign({},i),httpAgent:o,httpsAgent:u,password:h,parsing:{attributeNamePrefix:(w=e.attributeNamePrefix)!=null?w:"@",attributeParsers:[],tagParsers:[gw]},remotePath:n0(r),remoteURL:r,token:l,username:d,withCredentials:m};return Zg(y,d,h,l,n),{copyFile:(g,S,A)=>M0(y,g,S,A),createDirectory:(g,S)=>Xf(y,g,S),createReadStream:(g,S)=>function(A,k){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const V=new(Hd()).PassThrough;return b1(A,k,C).then(M=>{M.pipe(V)}).catch(M=>{V.emit("error",M)}),V}(y,g,S),createWriteStream:(g,S,A)=>function(k,C){let V=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},M=arguments.length>3&&arguments[3]!==void 0?arguments[3]:A1;const U=new(Hd()).PassThrough,H={};V.overwrite===!1&&(H["If-None-Match"]="*");const x=pt({url:Ke(k.remoteURL,Me(C)),method:"PUT",headers:H,data:U,maxRedirects:0},k,V);return ft(x,k).then(Y=>dt(k,Y)).then(Y=>{setTimeout(()=>{M(Y)},0)}).catch(Y=>{U.emit("error",Y)}),U}(y,g,S,A),customRequest:(g,S)=>S1(y,g,S),deleteFile:(g,S)=>N1(y,g,S),exists:(g,S)=>E1(y,g,S),getDirectoryContents:(g,S)=>k1(y,g,S),getFileContents:(g,S)=>B1(y,g,S),getFileDownloadLink:g=>function(S,A){let k=Ke(S.remoteURL,Me(A));const C=/^https:/i.test(k)?"https":"http";switch(S.authType){case Xt.None:break;case Xt.Password:{const V=Sd(S.headers.Authorization.replace(/^Basic /i,"").trim());k=k.replace(/^https?:\/\//,"".concat(C,"://").concat(V,"@"));break}default:throw new Ht({info:{code:xa.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(S.authType))}return k}(y,g),getFileUploadLink:g=>function(S,A){let k="".concat(Ke(S.remoteURL,Me(A)),"?Content-Type=application/octet-stream");const C=/^https:/i.test(k)?"https":"http";switch(S.authType){case Xt.None:break;case Xt.Password:{const V=Sd(S.headers.Authorization.replace(/^Basic /i,"").trim());k=k.replace(/^https?:\/\//,"".concat(C,"://").concat(V,"@"));break}default:throw new Ht({info:{code:xa.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(S.authType))}return k}(y,g),getHeaders:()=>Object.assign({},y.headers),getQuota:g=>K1(y,g),lock:(g,S)=>$1(y,g,S),moveFile:(g,S,A)=>F1(y,g,S,A),putFileContents:(g,S,A)=>_1(y,g,S,A),partialUpdateFileContents:(g,S,A,k,C)=>z1(y,g,S,A,k,C),getDAVCompliance:g=>Ew(y,g),search:(g,S)=>H1(y,g,S),setHeaders:g=>{y.headers=Object.assign({},g)},stat:(g,S)=>Pp(y,g,S),unlock:(g,S,A)=>j1(y,g,S,A),registerAttributeParser:g=>{y.parsing.attributeParsers.push(g)},registerTagParser:g=>{y.parsing.tagParsers.push(g)}}}const Ho=Uf().setApp("@nextcloud/files").detectUser().build();var kw=(r=>(r.Folder="folder",r.File="file",r))(kw||{}),Iw=(r=>(r[r.NONE=0]="NONE",r[r.CREATE=4]="CREATE",r[r.READ=1]="READ",r[r.UPDATE=2]="UPDATE",r[r.DELETE=8]="DELETE",r[r.SHARE=16]="SHARE",r[r.ALL=31]="ALL",r))(Iw||{});const Cw=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],Bw={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},qm=function(r,e={nc:"http://nextcloud.org/ns"}){typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...Cw],window._nc_dav_namespaces=It({},Bw));const t=It(It({},window._nc_dav_namespaces),e);if(window._nc_dav_properties.find(a=>a===r))return Ho.warn("".concat(r," already registered"),{prop:r}),!1;if(r.startsWith("<")||r.split(":").length!==2)return Ho.error("".concat(r," is not valid. See example: 'oc:fileid'"),{prop:r}),!1;const s=r.split(":")[0];return t[s]?(window._nc_dav_properties.push(r),window._nc_dav_namespaces=t,!0):(Ho.error("".concat(r," namespace unknown"),{prop:r,namespaces:t}),!1)},Q1=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...Cw]),window._nc_dav_properties.map(r=>"<".concat(r," />")).join(" ")},Z1=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces=It({},Bw)),Object.keys(window._nc_dav_namespaces).map(r=>{var e;return"xmlns:".concat(r,'="').concat((e=window._nc_dav_namespaces)==null?void 0:e[r],'"')}).join(" ")},ev=function(){return'<?xml version="1.0"?>\n		<d:propfind '.concat(Z1(),">\n			<d:prop>\n				").concat(Q1(),"\n			</d:prop>\n		</d:propfind>")};function tv(){var r;return zg()?"/files/".concat(Xy()):"/files/".concat((r=Ep())==null?void 0:r.uid)}tv();function sv(){const r=Ay("dav");return zg()?r.replace("remote.php","public.php"):r}const rv=sv(),av=function(r=rv,e={}){const t=Y1(r,{headers:e});function s(a){t.setHeaders(xs(It({},e),{"X-Requested-With":"XMLHttpRequest",requesttoken:a!=null?a:""}))}return Ny(s),s(Sy()),ew().patch("fetch",(a,n)=>{const i=n.headers;return i!=null&&i.method&&(n.method=i.method,delete i.method),fetch(a,n)}),t};var _m={},Wm={exports:{}},qd={},_d;function nv(){return _d||(_d=1,function(r){Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},t={};t.byteLength=l,t.toByteArray=m,t.fromByteArray=w;for(var s=[],a=[],n=typeof Uint8Array<"u"?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,u=i.length;o<u;++o)s[o]=i[o],a[i.charCodeAt(o)]=o;a[45]=62,a[95]=63;function h(A){var k=A.length;if(k%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var C=A.indexOf("=");C===-1&&(C=k);var V=C===k?0:4-C%4;return[C,V]}function l(A){var k=h(A),C=k[0],V=k[1];return(C+V)*3/4-V}function d(A,k,C){return(k+C)*3/4-C}function m(A){var k,C=h(A),V=C[0],M=C[1],U=new n(d(A,V,M)),H=0,x=M>0?V-4:V,Y;for(Y=0;Y<x;Y+=4)k=a[A.charCodeAt(Y)]<<18|a[A.charCodeAt(Y+1)]<<12|a[A.charCodeAt(Y+2)]<<6|a[A.charCodeAt(Y+3)],U[H++]=k>>16&255,U[H++]=k>>8&255,U[H++]=k&255;return M===2&&(k=a[A.charCodeAt(Y)]<<2|a[A.charCodeAt(Y+1)]>>4,U[H++]=k&255),M===1&&(k=a[A.charCodeAt(Y)]<<10|a[A.charCodeAt(Y+1)]<<4|a[A.charCodeAt(Y+2)]>>2,U[H++]=k>>8&255,U[H++]=k&255),U}function N(A){return s[A>>18&63]+s[A>>12&63]+s[A>>6&63]+s[A&63]}function y(A,k,C){for(var V,M=[],U=k;U<C;U+=3)V=(A[U]<<16&16711680)+(A[U+1]<<8&65280)+(A[U+2]&255),M.push(N(V));return M.join("")}function w(A){for(var k,C=A.length,V=C%3,M=[],U=16383,H=0,x=C-V;H<x;H+=U)M.push(y(A,H,H+U>x?x:H+U));return V===1?(k=A[C-1],M.push(s[k>>2]+s[k<<4&63]+"==")):V===2&&(k=(A[C-2]<<8)+A[C-1],M.push(s[k>>10]+s[k>>4&63]+s[k<<2&63]+"=")),M.join("")}var g={};g.read=function(A,k,C,V,M){var U,H,x=M*8-V-1,Y=(1<<x)-1,ee=Y>>1,O=-7,G=C?M-1:0,we=C?-1:1,le=A[k+G];for(G+=we,U=le&(1<<-O)-1,le>>=-O,O+=x;O>0;U=U*256+A[k+G],G+=we,O-=8);for(H=U&(1<<-O)-1,U>>=-O,O+=V;O>0;H=H*256+A[k+G],G+=we,O-=8);if(U===0)U=1-ee;else{if(U===Y)return H?NaN:(le?-1:1)*(1/0);H=H+Math.pow(2,V),U=U-ee}return(le?-1:1)*H*Math.pow(2,U-V)},g.write=function(A,k,C,V,M,U){var H,x,Y,ee=U*8-M-1,O=(1<<ee)-1,G=O>>1,we=M===23?Math.pow(2,-24)-Math.pow(2,-77):0,le=V?0:U-1,Se=V?1:-1,re=k<0||k===0&&1/k<0?1:0;for(k=Math.abs(k),isNaN(k)||k===1/0?(x=isNaN(k)?1:0,H=O):(H=Math.floor(Math.log(k)/Math.LN2),k*(Y=Math.pow(2,-H))<1&&(H--,Y*=2),H+G>=1?k+=we/Y:k+=we*Math.pow(2,1-G),k*Y>=2&&(H++,Y/=2),H+G>=O?(x=0,H=O):H+G>=1?(x=(k*Y-1)*Math.pow(2,M),H=H+G):(x=k*Math.pow(2,G-1)*Math.pow(2,M),H=0));M>=8;A[C+le]=x&255,le+=Se,x/=256,M-=8);for(H=H<<M|x,ee+=M;ee>0;A[C+le]=H&255,le+=Se,H/=256,ee-=8);A[C+le-Se]|=re*128},function(A){const k=t,C=g,V=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;A.Buffer=O,A.SlowBuffer=ie,A.INSPECT_MAX_BYTES=50;const M=2147483647;A.kMaxLength=M;const{Uint8Array:U,ArrayBuffer:H,SharedArrayBuffer:x}=globalThis;O.TYPED_ARRAY_SUPPORT=Y(),!O.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function Y(){try{const c=new U(1),p={foo:function(){return 42}};return Object.setPrototypeOf(p,U.prototype),Object.setPrototypeOf(c,p),c.foo()===42}catch(c){return!1}}Object.defineProperty(O.prototype,"parent",{enumerable:!0,get:function(){if(O.isBuffer(this))return this.buffer}}),Object.defineProperty(O.prototype,"offset",{enumerable:!0,get:function(){if(O.isBuffer(this))return this.byteOffset}});function ee(c){if(c>M)throw new RangeError('The value "'+c+'" is invalid for option "size"');const p=new U(c);return Object.setPrototypeOf(p,O.prototype),p}function O(c,p,b){if(typeof c=="number"){if(typeof p=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Se(c)}return G(c,p,b)}O.poolSize=8192;function G(c,p,b){if(typeof c=="string")return re(c,p);if(H.isView(c))return de(c);if(c==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof c);if(Bs(c,H)||c&&Bs(c.buffer,H)||typeof x<"u"&&(Bs(c,x)||c&&Bs(c.buffer,x)))return te(c,p,b);if(typeof c=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const P=c.valueOf&&c.valueOf();if(P!=null&&P!==c)return O.from(P,p,b);const L=se(c);if(L)return L;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof c[Symbol.toPrimitive]=="function")return O.from(c[Symbol.toPrimitive]("string"),p,b);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof c)}O.from=function(c,p,b){return G(c,p,b)},Object.setPrototypeOf(O.prototype,U.prototype),Object.setPrototypeOf(O,U);function we(c){if(typeof c!="number")throw new TypeError('"size" argument must be of type number');if(c<0)throw new RangeError('The value "'+c+'" is invalid for option "size"')}function le(c,p,b){return we(c),c<=0?ee(c):p!==void 0?typeof b=="string"?ee(c).fill(p,b):ee(c).fill(p):ee(c)}O.alloc=function(c,p,b){return le(c,p,b)};function Se(c){return we(c),ee(c<0?0:Q(c)|0)}O.allocUnsafe=function(c){return Se(c)},O.allocUnsafeSlow=function(c){return Se(c)};function re(c,p){if((typeof p!="string"||p==="")&&(p="utf8"),!O.isEncoding(p))throw new TypeError("Unknown encoding: "+p);const b=he(c,p)|0;let P=ee(b);const L=P.write(c,p);return L!==b&&(P=P.slice(0,L)),P}function be(c){const p=c.length<0?0:Q(c.length)|0,b=ee(p);for(let P=0;P<p;P+=1)b[P]=c[P]&255;return b}function de(c){if(Bs(c,U)){const p=new U(c);return te(p.buffer,p.byteOffset,p.byteLength)}return be(c)}function te(c,p,b){if(p<0||c.byteLength<p)throw new RangeError('"offset" is outside of buffer bounds');if(c.byteLength<p+(b||0))throw new RangeError('"length" is outside of buffer bounds');let P;return p===void 0&&b===void 0?P=new U(c):b===void 0?P=new U(c,p):P=new U(c,p,b),Object.setPrototypeOf(P,O.prototype),P}function se(c){if(O.isBuffer(c)){const p=Q(c.length)|0,b=ee(p);return b.length===0||c.copy(b,0,0,p),b}if(c.length!==void 0)return typeof c.length!="number"||Vm(c.length)?ee(0):be(c);if(c.type==="Buffer"&&Array.isArray(c.data))return be(c.data)}function Q(c){if(c>=M)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+M.toString(16)+" bytes");return c|0}function ie(c){return+c!=c&&(c=0),O.alloc(+c)}O.isBuffer=function(c){return c!=null&&c._isBuffer===!0&&c!==O.prototype},O.compare=function(c,p){if(Bs(c,U)&&(c=O.from(c,c.offset,c.byteLength)),Bs(p,U)&&(p=O.from(p,p.offset,p.byteLength)),!O.isBuffer(c)||!O.isBuffer(p))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(c===p)return 0;let b=c.length,P=p.length;for(let L=0,F=Math.min(b,P);L<F;++L)if(c[L]!==p[L]){b=c[L],P=p[L];break}return b<P?-1:P<b?1:0},O.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},O.concat=function(c,p){if(!Array.isArray(c))throw new TypeError('"list" argument must be an Array of Buffers');if(c.length===0)return O.alloc(0);let b;if(p===void 0)for(p=0,b=0;b<c.length;++b)p+=c[b].length;const P=O.allocUnsafe(p);let L=0;for(b=0;b<c.length;++b){let F=c[b];if(Bs(F,U))L+F.length>P.length?(O.isBuffer(F)||(F=O.from(F)),F.copy(P,L)):U.prototype.set.call(P,F,L);else if(O.isBuffer(F))F.copy(P,L);else throw new TypeError('"list" argument must be an Array of Buffers');L+=F.length}return P};function he(c,p){if(O.isBuffer(c))return c.length;if(H.isView(c)||Bs(c,H))return c.byteLength;if(typeof c!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof c);const b=c.length,P=arguments.length>2&&arguments[2]===!0;if(!P&&b===0)return 0;let L=!1;for(;;)switch(p){case"ascii":case"latin1":case"binary":return b;case"utf8":case"utf-8":return xm(c).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b*2;case"hex":return b>>>1;case"base64":return od(c).length;default:if(L)return P?-1:xm(c).length;p=(""+p).toLowerCase(),L=!0}}O.byteLength=he;function Ce(c,p,b){let P=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((b===void 0||b>this.length)&&(b=this.length),b<=0)||(b>>>=0,p>>>=0,b<=p))return"";for(c||(c="utf8");;)switch(c){case"hex":return $c(this,p,b);case"utf8":case"utf-8":return At(this,p,b);case"ascii":return gs(this,p,b);case"latin1":case"binary":return Cm(this,p,b);case"base64":return kt(this,p,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ru(this,p,b);default:if(P)throw new TypeError("Unknown encoding: "+c);c=(c+"").toLowerCase(),P=!0}}O.prototype._isBuffer=!0;function Fe(c,p,b){const P=c[p];c[p]=c[b],c[b]=P}O.prototype.swap16=function(){const c=this.length;if(c%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let p=0;p<c;p+=2)Fe(this,p,p+1);return this},O.prototype.swap32=function(){const c=this.length;if(c%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let p=0;p<c;p+=4)Fe(this,p,p+3),Fe(this,p+1,p+2);return this},O.prototype.swap64=function(){const c=this.length;if(c%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let p=0;p<c;p+=8)Fe(this,p,p+7),Fe(this,p+1,p+6),Fe(this,p+2,p+5),Fe(this,p+3,p+4);return this},O.prototype.toString=function(){const c=this.length;return c===0?"":arguments.length===0?At(this,0,c):Ce.apply(this,arguments)},O.prototype.toLocaleString=O.prototype.toString,O.prototype.equals=function(c){if(!O.isBuffer(c))throw new TypeError("Argument must be a Buffer");return this===c?!0:O.compare(this,c)===0},O.prototype.inspect=function(){let c="";const p=A.INSPECT_MAX_BYTES;return c=this.toString("hex",0,p).replace(/(.{2})/g,"$1 ").trim(),this.length>p&&(c+=" ... "),"<Buffer "+c+">"},V&&(O.prototype[V]=O.prototype.inspect),O.prototype.compare=function(c,p,b,P,L){if(Bs(c,U)&&(c=O.from(c,c.offset,c.byteLength)),!O.isBuffer(c))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof c);if(p===void 0&&(p=0),b===void 0&&(b=c?c.length:0),P===void 0&&(P=0),L===void 0&&(L=this.length),p<0||b>c.length||P<0||L>this.length)throw new RangeError("out of range index");if(P>=L&&p>=b)return 0;if(P>=L)return-1;if(p>=b)return 1;if(p>>>=0,b>>>=0,P>>>=0,L>>>=0,this===c)return 0;let F=L-P,z=b-p;const Pe=Math.min(F,z),St=this.slice(P,L),De=c.slice(p,b);for(let Be=0;Be<Pe;++Be)if(St[Be]!==De[Be]){F=St[Be],z=De[Be];break}return F<z?-1:z<F?1:0};function I(c,p,b,P,L){if(c.length===0)return-1;if(typeof b=="string"?(P=b,b=0):b>2147483647?b=2147483647:b<-2147483648&&(b=-2147483648),b=+b,Vm(b)&&(b=L?0:c.length-1),b<0&&(b=c.length+b),b>=c.length){if(L)return-1;b=c.length-1}else if(b<0)if(L)b=0;else return-1;if(typeof p=="string"&&(p=O.from(p,P)),O.isBuffer(p))return p.length===0?-1:v(c,p,b,P,L);if(typeof p=="number")return p=p&255,typeof U.prototype.indexOf=="function"?L?U.prototype.indexOf.call(c,p,b):U.prototype.lastIndexOf.call(c,p,b):v(c,[p],b,P,L);throw new TypeError("val must be string, number or Buffer")}function v(c,p,b,P,L){let F=1,z=c.length,Pe=p.length;if(P!==void 0&&(P=String(P).toLowerCase(),P==="ucs2"||P==="ucs-2"||P==="utf16le"||P==="utf-16le")){if(c.length<2||p.length<2)return-1;F=2,z/=2,Pe/=2,b/=2}function St(Be,tt){return F===1?Be[tt]:Be.readUInt16BE(tt*F)}let De;if(L){let Be=-1;for(De=b;De<z;De++)if(St(c,De)===St(p,Be===-1?0:De-Be)){if(Be===-1&&(Be=De),De-Be+1===Pe)return Be*F}else Be!==-1&&(De-=De-Be),Be=-1}else for(b+Pe>z&&(b=z-Pe),De=b;De>=0;De--){let Be=!0;for(let tt=0;tt<Pe;tt++)if(St(c,De+tt)!==St(p,tt)){Be=!1;break}if(Be)return De}return-1}O.prototype.includes=function(c,p,b){return this.indexOf(c,p,b)!==-1},O.prototype.indexOf=function(c,p,b){return I(this,c,p,b,!0)},O.prototype.lastIndexOf=function(c,p,b){return I(this,c,p,b,!1)};function R(c,p,b,P){b=Number(b)||0;const L=c.length-b;P?(P=Number(P),P>L&&(P=L)):P=L;const F=p.length;P>F/2&&(P=F/2);let z;for(z=0;z<P;++z){const Pe=parseInt(p.substr(z*2,2),16);if(Vm(Pe))return z;c[b+z]=Pe}return z}function D(c,p,b,P){return Mc(xm(p,c.length-b),c,b,P)}function me(c,p,b,P){return Mc(my(p),c,b,P)}function ke(c,p,b,P){return Mc(od(p),c,b,P)}function oe(c,p,b,P){return Mc(fy(p,c.length-b),c,b,P)}O.prototype.write=function(c,p,b,P){if(p===void 0)P="utf8",b=this.length,p=0;else if(b===void 0&&typeof p=="string")P=p,b=this.length,p=0;else if(isFinite(p))p=p>>>0,isFinite(b)?(b=b>>>0,P===void 0&&(P="utf8")):(P=b,b=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const L=this.length-p;if((b===void 0||b>L)&&(b=L),c.length>0&&(b<0||p<0)||p>this.length)throw new RangeError("Attempt to write outside buffer bounds");P||(P="utf8");let F=!1;for(;;)switch(P){case"hex":return R(this,c,p,b);case"utf8":case"utf-8":return D(this,c,p,b);case"ascii":case"latin1":case"binary":return me(this,c,p,b);case"base64":return ke(this,c,p,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return oe(this,c,p,b);default:if(F)throw new TypeError("Unknown encoding: "+P);P=(""+P).toLowerCase(),F=!0}},O.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function kt(c,p,b){return p===0&&b===c.length?k.fromByteArray(c):k.fromByteArray(c.slice(p,b))}function At(c,p,b){b=Math.min(c.length,b);const P=[];let L=p;for(;L<b;){const F=c[L];let z=null,Pe=F>239?4:F>223?3:F>191?2:1;if(L+Pe<=b){let St,De,Be,tt;switch(Pe){case 1:F<128&&(z=F);break;case 2:St=c[L+1],(St&192)===128&&(tt=(F&31)<<6|St&63,tt>127&&(z=tt));break;case 3:St=c[L+1],De=c[L+2],(St&192)===128&&(De&192)===128&&(tt=(F&15)<<12|(St&63)<<6|De&63,tt>2047&&(tt<55296||tt>57343)&&(z=tt));break;case 4:St=c[L+1],De=c[L+2],Be=c[L+3],(St&192)===128&&(De&192)===128&&(Be&192)===128&&(tt=(F&15)<<18|(St&63)<<12|(De&63)<<6|Be&63,tt>65535&&tt<1114112&&(z=tt))}}z===null?(z=65533,Pe=1):z>65535&&(z-=65536,P.push(z>>>10&1023|55296),z=56320|z&1023),P.push(z),L+=Pe}return ut(P)}const Ms=4096;function ut(c){const p=c.length;if(p<=Ms)return String.fromCharCode.apply(String,c);let b="",P=0;for(;P<p;)b+=String.fromCharCode.apply(String,c.slice(P,P+=Ms));return b}function gs(c,p,b){let P="";b=Math.min(c.length,b);for(let L=p;L<b;++L)P+=String.fromCharCode(c[L]&127);return P}function Cm(c,p,b){let P="";b=Math.min(c.length,b);for(let L=p;L<b;++L)P+=String.fromCharCode(c[L]);return P}function $c(c,p,b){const P=c.length;(!p||p<0)&&(p=0),(!b||b<0||b>P)&&(b=P);let L="";for(let F=p;F<b;++F)L+=py[c[F]];return L}function ru(c,p,b){const P=c.slice(p,b);let L="";for(let F=0;F<P.length-1;F+=2)L+=String.fromCharCode(P[F]+P[F+1]*256);return L}O.prototype.slice=function(c,p){const b=this.length;c=~~c,p=p===void 0?b:~~p,c<0?(c+=b,c<0&&(c=0)):c>b&&(c=b),p<0?(p+=b,p<0&&(p=0)):p>b&&(p=b),p<c&&(p=c);const P=this.subarray(c,p);return Object.setPrototypeOf(P,O.prototype),P};function Je(c,p,b){if(c%1!==0||c<0)throw new RangeError("offset is not uint");if(c+p>b)throw new RangeError("Trying to access beyond buffer length")}O.prototype.readUintLE=O.prototype.readUIntLE=function(c,p,b){c=c>>>0,p=p>>>0,b||Je(c,p,this.length);let P=this[c],L=1,F=0;for(;++F<p&&(L*=256);)P+=this[c+F]*L;return P},O.prototype.readUintBE=O.prototype.readUIntBE=function(c,p,b){c=c>>>0,p=p>>>0,b||Je(c,p,this.length);let P=this[c+--p],L=1;for(;p>0&&(L*=256);)P+=this[c+--p]*L;return P},O.prototype.readUint8=O.prototype.readUInt8=function(c,p){return c=c>>>0,p||Je(c,1,this.length),this[c]},O.prototype.readUint16LE=O.prototype.readUInt16LE=function(c,p){return c=c>>>0,p||Je(c,2,this.length),this[c]|this[c+1]<<8},O.prototype.readUint16BE=O.prototype.readUInt16BE=function(c,p){return c=c>>>0,p||Je(c,2,this.length),this[c]<<8|this[c+1]},O.prototype.readUint32LE=O.prototype.readUInt32LE=function(c,p){return c=c>>>0,p||Je(c,4,this.length),(this[c]|this[c+1]<<8|this[c+2]<<16)+this[c+3]*16777216},O.prototype.readUint32BE=O.prototype.readUInt32BE=function(c,p){return c=c>>>0,p||Je(c,4,this.length),this[c]*16777216+(this[c+1]<<16|this[c+2]<<8|this[c+3])},O.prototype.readBigUInt64LE=pr(function(c){c=c>>>0,ui(c,"offset");const p=this[c],b=this[c+7];(p===void 0||b===void 0)&&au(c,this.length-8);const P=p+this[++c]*2**8+this[++c]*2**16+this[++c]*2**24,L=this[++c]+this[++c]*2**8+this[++c]*2**16+b*2**24;return BigInt(P)+(BigInt(L)<<BigInt(32))}),O.prototype.readBigUInt64BE=pr(function(c){c=c>>>0,ui(c,"offset");const p=this[c],b=this[c+7];(p===void 0||b===void 0)&&au(c,this.length-8);const P=p*2**24+this[++c]*2**16+this[++c]*2**8+this[++c],L=this[++c]*2**24+this[++c]*2**16+this[++c]*2**8+b;return(BigInt(P)<<BigInt(32))+BigInt(L)}),O.prototype.readIntLE=function(c,p,b){c=c>>>0,p=p>>>0,b||Je(c,p,this.length);let P=this[c],L=1,F=0;for(;++F<p&&(L*=256);)P+=this[c+F]*L;return L*=128,P>=L&&(P-=Math.pow(2,8*p)),P},O.prototype.readIntBE=function(c,p,b){c=c>>>0,p=p>>>0,b||Je(c,p,this.length);let P=p,L=1,F=this[c+--P];for(;P>0&&(L*=256);)F+=this[c+--P]*L;return L*=128,F>=L&&(F-=Math.pow(2,8*p)),F},O.prototype.readInt8=function(c,p){return c=c>>>0,p||Je(c,1,this.length),this[c]&128?(255-this[c]+1)*-1:this[c]},O.prototype.readInt16LE=function(c,p){c=c>>>0,p||Je(c,2,this.length);const b=this[c]|this[c+1]<<8;return b&32768?b|4294901760:b},O.prototype.readInt16BE=function(c,p){c=c>>>0,p||Je(c,2,this.length);const b=this[c+1]|this[c]<<8;return b&32768?b|4294901760:b},O.prototype.readInt32LE=function(c,p){return c=c>>>0,p||Je(c,4,this.length),this[c]|this[c+1]<<8|this[c+2]<<16|this[c+3]<<24},O.prototype.readInt32BE=function(c,p){return c=c>>>0,p||Je(c,4,this.length),this[c]<<24|this[c+1]<<16|this[c+2]<<8|this[c+3]},O.prototype.readBigInt64LE=pr(function(c){c=c>>>0,ui(c,"offset");const p=this[c],b=this[c+7];(p===void 0||b===void 0)&&au(c,this.length-8);const P=this[c+4]+this[c+5]*2**8+this[c+6]*2**16+(b<<24);return(BigInt(P)<<BigInt(32))+BigInt(p+this[++c]*2**8+this[++c]*2**16+this[++c]*2**24)}),O.prototype.readBigInt64BE=pr(function(c){c=c>>>0,ui(c,"offset");const p=this[c],b=this[c+7];(p===void 0||b===void 0)&&au(c,this.length-8);const P=(p<<24)+this[++c]*2**16+this[++c]*2**8+this[++c];return(BigInt(P)<<BigInt(32))+BigInt(this[++c]*2**24+this[++c]*2**16+this[++c]*2**8+b)}),O.prototype.readFloatLE=function(c,p){return c=c>>>0,p||Je(c,4,this.length),C.read(this,c,!0,23,4)},O.prototype.readFloatBE=function(c,p){return c=c>>>0,p||Je(c,4,this.length),C.read(this,c,!1,23,4)},O.prototype.readDoubleLE=function(c,p){return c=c>>>0,p||Je(c,8,this.length),C.read(this,c,!0,52,8)},O.prototype.readDoubleBE=function(c,p){return c=c>>>0,p||Je(c,8,this.length),C.read(this,c,!1,52,8)};function qt(c,p,b,P,L,F){if(!O.isBuffer(c))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>L||p<F)throw new RangeError('"value" argument is out of bounds');if(b+P>c.length)throw new RangeError("Index out of range")}O.prototype.writeUintLE=O.prototype.writeUIntLE=function(c,p,b,P){if(c=+c,p=p>>>0,b=b>>>0,!P){const z=Math.pow(2,8*b)-1;qt(this,c,p,b,z,0)}let L=1,F=0;for(this[p]=c&255;++F<b&&(L*=256);)this[p+F]=c/L&255;return p+b},O.prototype.writeUintBE=O.prototype.writeUIntBE=function(c,p,b,P){if(c=+c,p=p>>>0,b=b>>>0,!P){const z=Math.pow(2,8*b)-1;qt(this,c,p,b,z,0)}let L=b-1,F=1;for(this[p+L]=c&255;--L>=0&&(F*=256);)this[p+L]=c/F&255;return p+b},O.prototype.writeUint8=O.prototype.writeUInt8=function(c,p,b){return c=+c,p=p>>>0,b||qt(this,c,p,1,255,0),this[p]=c&255,p+1},O.prototype.writeUint16LE=O.prototype.writeUInt16LE=function(c,p,b){return c=+c,p=p>>>0,b||qt(this,c,p,2,65535,0),this[p]=c&255,this[p+1]=c>>>8,p+2},O.prototype.writeUint16BE=O.prototype.writeUInt16BE=function(c,p,b){return c=+c,p=p>>>0,b||qt(this,c,p,2,65535,0),this[p]=c>>>8,this[p+1]=c&255,p+2},O.prototype.writeUint32LE=O.prototype.writeUInt32LE=function(c,p,b){return c=+c,p=p>>>0,b||qt(this,c,p,4,4294967295,0),this[p+3]=c>>>24,this[p+2]=c>>>16,this[p+1]=c>>>8,this[p]=c&255,p+4},O.prototype.writeUint32BE=O.prototype.writeUInt32BE=function(c,p,b){return c=+c,p=p>>>0,b||qt(this,c,p,4,4294967295,0),this[p]=c>>>24,this[p+1]=c>>>16,this[p+2]=c>>>8,this[p+3]=c&255,p+4};function ed(c,p,b,P,L){id(p,P,L,c,b,7);let F=Number(p&BigInt(4294967295));c[b++]=F,F=F>>8,c[b++]=F,F=F>>8,c[b++]=F,F=F>>8,c[b++]=F;let z=Number(p>>BigInt(32)&BigInt(4294967295));return c[b++]=z,z=z>>8,c[b++]=z,z=z>>8,c[b++]=z,z=z>>8,c[b++]=z,b}function td(c,p,b,P,L){id(p,P,L,c,b,7);let F=Number(p&BigInt(4294967295));c[b+7]=F,F=F>>8,c[b+6]=F,F=F>>8,c[b+5]=F,F=F>>8,c[b+4]=F;let z=Number(p>>BigInt(32)&BigInt(4294967295));return c[b+3]=z,z=z>>8,c[b+2]=z,z=z>>8,c[b+1]=z,z=z>>8,c[b]=z,b+8}O.prototype.writeBigUInt64LE=pr(function(c,p=0){return ed(this,c,p,BigInt(0),BigInt("0xffffffffffffffff"))}),O.prototype.writeBigUInt64BE=pr(function(c,p=0){return td(this,c,p,BigInt(0),BigInt("0xffffffffffffffff"))}),O.prototype.writeIntLE=function(c,p,b,P){if(c=+c,p=p>>>0,!P){const Pe=Math.pow(2,8*b-1);qt(this,c,p,b,Pe-1,-Pe)}let L=0,F=1,z=0;for(this[p]=c&255;++L<b&&(F*=256);)c<0&&z===0&&this[p+L-1]!==0&&(z=1),this[p+L]=(c/F>>0)-z&255;return p+b},O.prototype.writeIntBE=function(c,p,b,P){if(c=+c,p=p>>>0,!P){const Pe=Math.pow(2,8*b-1);qt(this,c,p,b,Pe-1,-Pe)}let L=b-1,F=1,z=0;for(this[p+L]=c&255;--L>=0&&(F*=256);)c<0&&z===0&&this[p+L+1]!==0&&(z=1),this[p+L]=(c/F>>0)-z&255;return p+b},O.prototype.writeInt8=function(c,p,b){return c=+c,p=p>>>0,b||qt(this,c,p,1,127,-128),c<0&&(c=255+c+1),this[p]=c&255,p+1},O.prototype.writeInt16LE=function(c,p,b){return c=+c,p=p>>>0,b||qt(this,c,p,2,32767,-32768),this[p]=c&255,this[p+1]=c>>>8,p+2},O.prototype.writeInt16BE=function(c,p,b){return c=+c,p=p>>>0,b||qt(this,c,p,2,32767,-32768),this[p]=c>>>8,this[p+1]=c&255,p+2},O.prototype.writeInt32LE=function(c,p,b){return c=+c,p=p>>>0,b||qt(this,c,p,4,2147483647,-2147483648),this[p]=c&255,this[p+1]=c>>>8,this[p+2]=c>>>16,this[p+3]=c>>>24,p+4},O.prototype.writeInt32BE=function(c,p,b){return c=+c,p=p>>>0,b||qt(this,c,p,4,2147483647,-2147483648),c<0&&(c=4294967295+c+1),this[p]=c>>>24,this[p+1]=c>>>16,this[p+2]=c>>>8,this[p+3]=c&255,p+4},O.prototype.writeBigInt64LE=pr(function(c,p=0){return ed(this,c,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),O.prototype.writeBigInt64BE=pr(function(c,p=0){return td(this,c,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function sd(c,p,b,P,L,F){if(b+P>c.length)throw new RangeError("Index out of range");if(b<0)throw new RangeError("Index out of range")}function rd(c,p,b,P,L){return p=+p,b=b>>>0,L||sd(c,p,b,4),C.write(c,p,b,P,23,4),b+4}O.prototype.writeFloatLE=function(c,p,b){return rd(this,c,p,!0,b)},O.prototype.writeFloatBE=function(c,p,b){return rd(this,c,p,!1,b)};function ad(c,p,b,P,L){return p=+p,b=b>>>0,L||sd(c,p,b,8),C.write(c,p,b,P,52,8),b+8}O.prototype.writeDoubleLE=function(c,p,b){return ad(this,c,p,!0,b)},O.prototype.writeDoubleBE=function(c,p,b){return ad(this,c,p,!1,b)},O.prototype.copy=function(c,p,b,P){if(!O.isBuffer(c))throw new TypeError("argument should be a Buffer");if(b||(b=0),!P&&P!==0&&(P=this.length),p>=c.length&&(p=c.length),p||(p=0),P>0&&P<b&&(P=b),P===b||c.length===0||this.length===0)return 0;if(p<0)throw new RangeError("targetStart out of bounds");if(b<0||b>=this.length)throw new RangeError("Index out of range");if(P<0)throw new RangeError("sourceEnd out of bounds");P>this.length&&(P=this.length),c.length-p<P-b&&(P=c.length-p+b);const L=P-b;return this===c&&typeof U.prototype.copyWithin=="function"?this.copyWithin(p,b,P):U.prototype.set.call(c,this.subarray(b,P),p),L},O.prototype.fill=function(c,p,b,P){if(typeof c=="string"){if(typeof p=="string"?(P=p,p=0,b=this.length):typeof b=="string"&&(P=b,b=this.length),P!==void 0&&typeof P!="string")throw new TypeError("encoding must be a string");if(typeof P=="string"&&!O.isEncoding(P))throw new TypeError("Unknown encoding: "+P);if(c.length===1){const F=c.charCodeAt(0);(P==="utf8"&&F<128||P==="latin1")&&(c=F)}}else typeof c=="number"?c=c&255:typeof c=="boolean"&&(c=Number(c));if(p<0||this.length<p||this.length<b)throw new RangeError("Out of range index");if(b<=p)return this;p=p>>>0,b=b===void 0?this.length:b>>>0,c||(c=0);let L;if(typeof c=="number")for(L=p;L<b;++L)this[L]=c;else{const F=O.isBuffer(c)?c:O.from(c,P),z=F.length;if(z===0)throw new TypeError('The value "'+c+'" is invalid for argument "value"');for(L=0;L<b-p;++L)this[L+p]=F[L%z]}return this};const oi={};function Bm(c,p,b){oi[c]=class extends b{constructor(){super(),Object.defineProperty(this,"message",{value:p.apply(this,arguments),writable:!0,configurable:!0}),this.name="".concat(this.name," [").concat(c,"]"),this.stack,delete this.name}get code(){return c}set code(P){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:P,writable:!0})}toString(){return"".concat(this.name," [").concat(c,"]: ").concat(this.message)}}}Bm("ERR_BUFFER_OUT_OF_BOUNDS",function(c){return c?"".concat(c," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"},RangeError),Bm("ERR_INVALID_ARG_TYPE",function(c,p){return'The "'.concat(c,'" argument must be of type number. Received type ').concat(typeof p)},TypeError),Bm("ERR_OUT_OF_RANGE",function(c,p,b){let P='The value of "'.concat(c,'" is out of range.'),L=b;return Number.isInteger(b)&&Math.abs(b)>2**32?L=nd(String(b)):typeof b=="bigint"&&(L=String(b),(b>BigInt(2)**BigInt(32)||b<-(BigInt(2)**BigInt(32)))&&(L=nd(L)),L+="n"),P+=" It must be ".concat(p,". Received ").concat(L),P},RangeError);function nd(c){let p="",b=c.length;const P=c[0]==="-"?1:0;for(;b>=P+4;b-=3)p="_".concat(c.slice(b-3,b)).concat(p);return"".concat(c.slice(0,b)).concat(p)}function ly(c,p,b){ui(p,"offset"),(c[p]===void 0||c[p+b]===void 0)&&au(p,c.length-(b+1))}function id(c,p,b,P,L,F){if(c>b||c<p){const z=typeof p=="bigint"?"n":"";let Pe;throw p===0||p===BigInt(0)?Pe=">= 0".concat(z," and < 2").concat(z," ** ").concat((F+1)*8).concat(z):Pe=">= -(2".concat(z," ** ").concat((F+1)*8-1).concat(z,") and < 2 ** ").concat((F+1)*8-1).concat(z),new oi.ERR_OUT_OF_RANGE("value",Pe,c)}ly(P,L,F)}function ui(c,p){if(typeof c!="number")throw new oi.ERR_INVALID_ARG_TYPE(p,"number",c)}function au(c,p,b){throw Math.floor(c)!==c?(ui(c,b),new oi.ERR_OUT_OF_RANGE("offset","an integer",c)):p<0?new oi.ERR_BUFFER_OUT_OF_BOUNDS:new oi.ERR_OUT_OF_RANGE("offset",">= 0 and <= ".concat(p),c)}const cy=/[^+/0-9A-Za-z-_]/g;function hy(c){if(c=c.split("=")[0],c=c.trim().replace(cy,""),c.length<2)return"";for(;c.length%4!==0;)c=c+"=";return c}function xm(c,p){p=p||1/0;let b;const P=c.length;let L=null;const F=[];for(let z=0;z<P;++z){if(b=c.charCodeAt(z),b>55295&&b<57344){if(!L){if(b>56319){(p-=3)>-1&&F.push(239,191,189);continue}else if(z+1===P){(p-=3)>-1&&F.push(239,191,189);continue}L=b;continue}if(b<56320){(p-=3)>-1&&F.push(239,191,189),L=b;continue}b=(L-55296<<10|b-56320)+65536}else L&&(p-=3)>-1&&F.push(239,191,189);if(L=null,b<128){if((p-=1)<0)break;F.push(b)}else if(b<2048){if((p-=2)<0)break;F.push(b>>6|192,b&63|128)}else if(b<65536){if((p-=3)<0)break;F.push(b>>12|224,b>>6&63|128,b&63|128)}else if(b<1114112){if((p-=4)<0)break;F.push(b>>18|240,b>>12&63|128,b>>6&63|128,b&63|128)}else throw new Error("Invalid code point")}return F}function my(c){const p=[];for(let b=0;b<c.length;++b)p.push(c.charCodeAt(b)&255);return p}function fy(c,p){let b,P,L;const F=[];for(let z=0;z<c.length&&!((p-=2)<0);++z)b=c.charCodeAt(z),P=b>>8,L=b%256,F.push(L),F.push(P);return F}function od(c){return k.toByteArray(hy(c))}function Mc(c,p,b,P){let L;for(L=0;L<P&&!(L+b>=p.length||L>=c.length);++L)p[L+b]=c[L];return L}function Bs(c,p){return c instanceof p||c!=null&&c.constructor!=null&&c.constructor.name!=null&&c.constructor.name===p.name}function Vm(c){return c!==c}const py=function(){const c="0123456789abcdef",p=new Array(256);for(let b=0;b<16;++b){const P=b*16;for(let L=0;L<16;++L)p[P+L]=c[b]+c[L]}return p}();function pr(c){return typeof BigInt>"u"?dy:c}function dy(){throw new Error("BigInt not supported")}}(e);const S=e.Buffer;r.Blob=e.Blob,r.BlobOptions=e.BlobOptions,r.Buffer=e.Buffer,r.File=e.File,r.FileOptions=e.FileOptions,r.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,r.SlowBuffer=e.SlowBuffer,r.TranscodeEncoding=e.TranscodeEncoding,r.atob=e.atob,r.btoa=e.btoa,r.constants=e.constants,r.default=S,r.isAscii=e.isAscii,r.isUtf8=e.isUtf8,r.kMaxLength=e.kMaxLength,r.kStringMaxLength=e.kStringMaxLength,r.resolveObjectURL=e.resolveObjectURL,r.transcode=e.transcode}(qd)),qd}var Wd;function iv(){return Wd||(Wd=1,function(r,e){var t=nv(),s=t.Buffer;function a(i,o){for(var u in i)o[u]=i[u]}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?r.exports=t:(a(t,e),e.Buffer=n);function n(i,o,u){return s(i,o,u)}n.prototype=Object.create(s.prototype),a(s,n),n.from=function(i,o,u){if(typeof i=="number")throw new TypeError("Argument must not be a number");return s(i,o,u)},n.alloc=function(i,o,u){if(typeof i!="number")throw new TypeError("Argument must be a number");var h=s(i);return o!==void 0?typeof u=="string"?h.fill(o,u):h.fill(o):h.fill(0),h},n.allocUnsafe=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return s(i)},n.allocUnsafeSlow=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(i)}}(Wm,Wm.exports)),Wm.exports}var Gd;function ov(){if(Gd)return _m;Gd=1;var r=iv().Buffer,e=r.isEncoding||function(S){switch(S=""+S,S&&S.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(S){if(!S)return"utf8";for(var A;;)switch(S){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return S;default:if(A)return;S=(""+S).toLowerCase(),A=!0}}function s(S){var A=t(S);if(typeof A!="string"&&(r.isEncoding===e||!e(S)))throw new Error("Unknown encoding: "+S);return A||S}_m.StringDecoder=a;function a(S){this.encoding=s(S);var A;switch(this.encoding){case"utf16le":this.text=d,this.end=m,A=4;break;case"utf8":this.fillLast=u,A=4;break;case"base64":this.text=N,this.end=y,A=3;break;default:this.write=w,this.end=g;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(A)}a.prototype.write=function(S){if(S.length===0)return"";var A,k;if(this.lastNeed){if(A=this.fillLast(S),A===void 0)return"";k=this.lastNeed,this.lastNeed=0}else k=0;return k<S.length?A?A+this.text(S,k):this.text(S,k):A||""},a.prototype.end=l,a.prototype.text=h,a.prototype.fillLast=function(S){if(this.lastNeed<=S.length)return S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,S.length),this.lastNeed-=S.length};function n(S){return S<=127?0:S>>5===6?2:S>>4===14?3:S>>3===30?4:S>>6===2?-1:-2}function i(S,A,k){var C=A.length-1;if(C<k)return 0;var V=n(A[C]);return V>=0?(V>0&&(S.lastNeed=V-1),V):--C<k||V===-2?0:(V=n(A[C]),V>=0?(V>0&&(S.lastNeed=V-2),V):--C<k||V===-2?0:(V=n(A[C]),V>=0?(V>0&&(V===2?V=0:S.lastNeed=V-3),V):0))}function o(S,A,k){if((A[0]&192)!==128)return S.lastNeed=0,"";if(S.lastNeed>1&&A.length>1){if((A[1]&192)!==128)return S.lastNeed=1,"";if(S.lastNeed>2&&A.length>2&&(A[2]&192)!==128)return S.lastNeed=2,""}}function u(S){var A=this.lastTotal-this.lastNeed,k=o(this,S);if(k!==void 0)return k;if(this.lastNeed<=S.length)return S.copy(this.lastChar,A,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);S.copy(this.lastChar,A,0,S.length),this.lastNeed-=S.length}function h(S,A){var k=i(this,S,A);if(!this.lastNeed)return S.toString("utf8",A);this.lastTotal=k;var C=S.length-(k-this.lastNeed);return S.copy(this.lastChar,0,C),S.toString("utf8",A,C)}function l(S){var A=S&&S.length?this.write(S):"";return this.lastNeed?A+"":A}function d(S,A){if((S.length-A)%2===0){var k=S.toString("utf16le",A);if(k){var C=k.charCodeAt(k.length-1);if(C>=55296&&C<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1],k.slice(0,-1)}return k}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=S[S.length-1],S.toString("utf16le",A,S.length-1)}function m(S){var A=S&&S.length?this.write(S):"";if(this.lastNeed){var k=this.lastTotal-this.lastNeed;return A+this.lastChar.toString("utf16le",0,k)}return A}function N(S,A){var k=(S.length-A)%3;return k===0?S.toString("base64",A):(this.lastNeed=3-k,this.lastTotal=3,k===1?this.lastChar[0]=S[S.length-1]:(this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1]),S.toString("base64",A,S.length-k))}function y(S){var A=S&&S.length?this.write(S):"";return this.lastNeed?A+this.lastChar.toString("base64",0,3-this.lastNeed):A}function w(S){return S.toString(this.encoding)}function g(S){return S&&S.length?this.write(S):""}return _m}var uv=ov();const lv=Ey(uv);var Gm={},Tp=(r=>(r.DEFAULT="default",r.HIDDEN="hidden",r))(Tp||{});class cv{constructor(e){st(this,"_action");this.validateAction(e),this._action=e}get id(){return this._action.id}get displayName(){return this._action.displayName}get title(){return this._action.title}get iconSvgInline(){return this._action.iconSvgInline}get enabled(){return this._action.enabled}get exec(){return this._action.exec}get execBatch(){return this._action.execBatch}get hotkey(){return this._action.hotkey}get order(){return this._action.order}get parent(){return this._action.parent}get default(){return this._action.default}get destructive(){return this._action.destructive}get inline(){return this._action.inline}get renderInline(){return this._action.renderInline}validateAction(e){if(!e.id||typeof e.id!="string")throw new Error("Invalid id");if(!e.displayName||typeof e.displayName!="function")throw new Error("Invalid displayName function");if("title"in e&&typeof e.title!="function")throw new Error("Invalid title function");if(!e.iconSvgInline||typeof e.iconSvgInline!="function")throw new Error("Invalid iconSvgInline function");if(!e.exec||typeof e.exec!="function")throw new Error("Invalid exec function");if("enabled"in e&&typeof e.enabled!="function")throw new Error("Invalid enabled function");if("execBatch"in e&&typeof e.execBatch!="function")throw new Error("Invalid execBatch function");if("order"in e&&typeof e.order!="number")throw new Error("Invalid order");if(e.destructive!==void 0&&typeof e.destructive!="boolean")throw new Error("Invalid destructive flag");if("parent"in e&&typeof e.parent!="string")throw new Error("Invalid parent");if(e.default&&!Object.values(Tp).includes(e.default))throw new Error("Invalid default");if("inline"in e&&typeof e.inline!="function")throw new Error("Invalid inline function");if("renderInline"in e&&typeof e.renderInline!="function")throw new Error("Invalid renderInline function");if("hotkey"in e&&e.hotkey!==void 0){if(typeof e.hotkey!="object")throw new Error("Invalid hotkey configuration");if(typeof e.hotkey.key!="string"||!e.hotkey.key)throw new Error("Missing or invalid hotkey key");if(typeof e.hotkey.description!="string"||!e.hotkey.description)throw new Error("Missing or invalid hotkey description")}}}const hv=function(r){if(typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],Ho.debug("FileActions initialized")),window._nc_fileactions.find(e=>e.id===r.id)){Ho.error("FileAction ".concat(r.id," already registered"),{action:r});return}window._nc_fileactions.push(r)},mv=function(){return typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],Ho.debug("FileActions initialized")),window._nc_fileactions};var zd,Xd;function xw(){return Xd||(Xd=1,zd=typeof ct=="object"&&Gm&&Gm.NODE_DEBUG&&/\bsemver\b/i.test(Gm.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{}),zd}var zm,Yd;function Vw(){if(Yd)return zm;Yd=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,s=16,a=e-6;return zm={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},zm}var Xm={exports:{}},Qd;function fv(){return Qd||(Qd=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:a}=Vw(),n=xw();e=r.exports={};const i=e.re=[],o=e.safeRe=[],u=e.src=[],h=e.safeSrc=[],l=e.t={};let d=0;const m="[a-zA-Z0-9-]",N=[["\\s",1],["\\d",a],[m,s]],y=g=>{for(const[S,A]of N)g=g.split("".concat(S,"*")).join("".concat(S,"{0,").concat(A,"}")).split("".concat(S,"+")).join("".concat(S,"{1,").concat(A,"}"));return g},w=(g,S,A)=>{const k=y(S),C=d++;n(g,C,S),l[g]=C,u[C]=S,h[C]=k,i[C]=new RegExp(S,A?"g":void 0),o[C]=new RegExp(k,A?"g":void 0)};w("NUMERICIDENTIFIER","0|[1-9]\\d*"),w("NUMERICIDENTIFIERLOOSE","\\d+"),w("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-]".concat(m,"*")),w("MAINVERSION","(".concat(u[l.NUMERICIDENTIFIER],")\\.(").concat(u[l.NUMERICIDENTIFIER],")\\.(").concat(u[l.NUMERICIDENTIFIER],")")),w("MAINVERSIONLOOSE","(".concat(u[l.NUMERICIDENTIFIERLOOSE],")\\.(").concat(u[l.NUMERICIDENTIFIERLOOSE],")\\.(").concat(u[l.NUMERICIDENTIFIERLOOSE],")")),w("PRERELEASEIDENTIFIER","(?:".concat(u[l.NONNUMERICIDENTIFIER],"|").concat(u[l.NUMERICIDENTIFIER],")")),w("PRERELEASEIDENTIFIERLOOSE","(?:".concat(u[l.NONNUMERICIDENTIFIER],"|").concat(u[l.NUMERICIDENTIFIERLOOSE],")")),w("PRERELEASE","(?:-(".concat(u[l.PRERELEASEIDENTIFIER],"(?:\\.").concat(u[l.PRERELEASEIDENTIFIER],")*))")),w("PRERELEASELOOSE","(?:-?(".concat(u[l.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(u[l.PRERELEASEIDENTIFIERLOOSE],")*))")),w("BUILDIDENTIFIER","".concat(m,"+")),w("BUILD","(?:\\+(".concat(u[l.BUILDIDENTIFIER],"(?:\\.").concat(u[l.BUILDIDENTIFIER],")*))")),w("FULLPLAIN","v?".concat(u[l.MAINVERSION]).concat(u[l.PRERELEASE],"?").concat(u[l.BUILD],"?")),w("FULL","^".concat(u[l.FULLPLAIN],"$")),w("LOOSEPLAIN","[v=\\s]*".concat(u[l.MAINVERSIONLOOSE]).concat(u[l.PRERELEASELOOSE],"?").concat(u[l.BUILD],"?")),w("LOOSE","^".concat(u[l.LOOSEPLAIN],"$")),w("GTLT","((?:<|>)?=?)"),w("XRANGEIDENTIFIERLOOSE","".concat(u[l.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),w("XRANGEIDENTIFIER","".concat(u[l.NUMERICIDENTIFIER],"|x|X|\\*")),w("XRANGEPLAIN","[v=\\s]*(".concat(u[l.XRANGEIDENTIFIER],")(?:\\.(").concat(u[l.XRANGEIDENTIFIER],")(?:\\.(").concat(u[l.XRANGEIDENTIFIER],")(?:").concat(u[l.PRERELEASE],")?").concat(u[l.BUILD],"?)?)?")),w("XRANGEPLAINLOOSE","[v=\\s]*(".concat(u[l.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(u[l.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(u[l.XRANGEIDENTIFIERLOOSE],")(?:").concat(u[l.PRERELEASELOOSE],")?").concat(u[l.BUILD],"?)?)?")),w("XRANGE","^".concat(u[l.GTLT],"\\s*").concat(u[l.XRANGEPLAIN],"$")),w("XRANGELOOSE","^".concat(u[l.GTLT],"\\s*").concat(u[l.XRANGEPLAINLOOSE],"$")),w("COERCEPLAIN","(^|[^\\d])(\\d{1,".concat(t,"})(?:\\.(\\d{1,").concat(t,"}))?(?:\\.(\\d{1,").concat(t,"}))?")),w("COERCE","".concat(u[l.COERCEPLAIN],"(?:$|[^\\d])")),w("COERCEFULL",u[l.COERCEPLAIN]+"(?:".concat(u[l.PRERELEASE],")?(?:").concat(u[l.BUILD],")?(?:$|[^\\d])")),w("COERCERTL",u[l.COERCE],!0),w("COERCERTLFULL",u[l.COERCEFULL],!0),w("LONETILDE","(?:~>?)"),w("TILDETRIM","(\\s*)".concat(u[l.LONETILDE],"\\s+"),!0),e.tildeTrimReplace="$1~",w("TILDE","^".concat(u[l.LONETILDE]).concat(u[l.XRANGEPLAIN],"$")),w("TILDELOOSE","^".concat(u[l.LONETILDE]).concat(u[l.XRANGEPLAINLOOSE],"$")),w("LONECARET","(?:\\^)"),w("CARETTRIM","(\\s*)".concat(u[l.LONECARET],"\\s+"),!0),e.caretTrimReplace="$1^",w("CARET","^".concat(u[l.LONECARET]).concat(u[l.XRANGEPLAIN],"$")),w("CARETLOOSE","^".concat(u[l.LONECARET]).concat(u[l.XRANGEPLAINLOOSE],"$")),w("COMPARATORLOOSE","^".concat(u[l.GTLT],"\\s*(").concat(u[l.LOOSEPLAIN],")$|^$")),w("COMPARATOR","^".concat(u[l.GTLT],"\\s*(").concat(u[l.FULLPLAIN],")$|^$")),w("COMPARATORTRIM","(\\s*)".concat(u[l.GTLT],"\\s*(").concat(u[l.LOOSEPLAIN],"|").concat(u[l.XRANGEPLAIN],")"),!0),e.comparatorTrimReplace="$1$2$3",w("HYPHENRANGE","^\\s*(".concat(u[l.XRANGEPLAIN],")\\s+-\\s+(").concat(u[l.XRANGEPLAIN],")\\s*$")),w("HYPHENRANGELOOSE","^\\s*(".concat(u[l.XRANGEPLAINLOOSE],")\\s+-\\s+(").concat(u[l.XRANGEPLAINLOOSE],")\\s*$")),w("STAR","(<|>)?=?\\s*\\*"),w("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),w("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Xm,Xm.exports)),Xm.exports}var Ym,Zd;function pv(){if(Zd)return Ym;Zd=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return Ym=t=>t?typeof t!="object"?r:t:e,Ym}var Qm,eg;function dv(){if(eg)return Qm;eg=1;const r=/^[0-9]+$/,e=(t,s)=>{if(typeof t=="number"&&typeof s=="number")return t===s?0:t<s?-1:1;const a=r.test(t),n=r.test(s);return a&&n&&(t=+t,s=+s),t===s?0:a&&!n?-1:n&&!a?1:t<s?-1:1};return Qm={compareIdentifiers:e,rcompareIdentifiers:(t,s)=>e(s,t)},Qm}var Zm,tg;function Pw(){if(tg)return Zm;tg=1;const r=xw(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Vw(),{safeRe:s,t:a}=fv(),n=pv(),{compareIdentifiers:i}=dv();class o{constructor(h,l){if(l=n(l),h instanceof o){if(h.loose===!!l.loose&&h.includePrerelease===!!l.includePrerelease)return h;h=h.version}else if(typeof h!="string")throw new TypeError('Invalid version. Must be a string. Got type "'.concat(typeof h,'".'));if(h.length>e)throw new TypeError("version is longer than ".concat(e," characters"));r("SemVer",h,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const d=h.trim().match(l.loose?s[a.LOOSE]:s[a.FULL]);if(!d)throw new TypeError("Invalid Version: ".concat(h));if(this.raw=h,this.major=+d[1],this.minor=+d[2],this.patch=+d[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");d[4]?this.prerelease=d[4].split(".").map(m=>{if(/^[0-9]+$/.test(m)){const N=+m;if(N>=0&&N<t)return N}return m}):this.prerelease=[],this.build=d[5]?d[5].split("."):[],this.format()}format(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}toString(){return this.version}compare(h){if(r("SemVer.compare",this.version,this.options,h),!(h instanceof o)){if(typeof h=="string"&&h===this.version)return 0;h=new o(h,this.options)}return h.version===this.version?0:this.compareMain(h)||this.comparePre(h)}compareMain(h){return h instanceof o||(h=new o(h,this.options)),this.major<h.major?-1:this.major>h.major?1:this.minor<h.minor?-1:this.minor>h.minor?1:this.patch<h.patch?-1:this.patch>h.patch?1:0}comparePre(h){if(h instanceof o||(h=new o(h,this.options)),this.prerelease.length&&!h.prerelease.length)return-1;if(!this.prerelease.length&&h.prerelease.length)return 1;if(!this.prerelease.length&&!h.prerelease.length)return 0;let l=0;do{const d=this.prerelease[l],m=h.prerelease[l];if(r("prerelease compare",l,d,m),d===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(d===void 0)return-1;if(d!==m)return i(d,m)}while(++l)}compareBuild(h){h instanceof o||(h=new o(h,this.options));let l=0;do{const d=this.build[l],m=h.build[l];if(r("build compare",l,d,m),d===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(d===void 0)return-1;if(d!==m)return i(d,m)}while(++l)}inc(h,l,d){if(h.startsWith("pre")){if(!l&&d===!1)throw new Error("invalid increment argument: identifier is empty");if(l){const m="-".concat(l).match(this.options.loose?s[a.PRERELEASELOOSE]:s[a.PRERELEASE]);if(!m||m[1]!==l)throw new Error("invalid identifier: ".concat(l))}}switch(h){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",l,d);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",l,d);break;case"prepatch":this.prerelease.length=0,this.inc("patch",l,d),this.inc("pre",l,d);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",l,d),this.inc("pre",l,d);break;case"release":if(this.prerelease.length===0)throw new Error("version ".concat(this.raw," is not a prerelease"));this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const m=Number(d)?1:0;if(this.prerelease.length===0)this.prerelease=[m];else{let N=this.prerelease.length;for(;--N>=0;)typeof this.prerelease[N]=="number"&&(this.prerelease[N]++,N=-2);if(N===-1){if(l===this.prerelease.join(".")&&d===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(m)}}if(l){let N=[l,m];d===!1&&(N=[l]),i(this.prerelease[0],l)===0?isNaN(this.prerelease[1])&&(this.prerelease=N):this.prerelease=N}break}default:throw new Error("invalid increment argument: ".concat(h))}return this.raw=this.format(),this.build.length&&(this.raw+="+".concat(this.build.join("."))),this}}return Zm=o,Zm}var ef,sg;function gv(){if(sg)return ef;sg=1;const r=Pw();return ef=(e,t)=>new r(e,t).major,ef}gv();var tf,rg;function wv(){if(rg)return tf;rg=1;const r=Pw();return tf=(e,t,s=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(a){if(!s)return null;throw a}},tf}var sf,ag;function yv(){if(ag)return sf;ag=1;const r=wv();return sf=(e,t)=>{const s=r(e,t);return s?s.version:null},sf}yv();var ng={},ig;function vv(){return ig||(ig=1,function(r){(function(e){e.parser=function(I,v){return new s(I,v)},e.SAXParser=s,e.SAXStream=l,e.createStream=h,e.MAX_BUFFER_LENGTH=64*1024;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function s(I,v){if(!(this instanceof s))return new s(I,v);var R=this;n(R),R.q=R.c="",R.bufferCheckPosition=e.MAX_BUFFER_LENGTH,R.opt=v||{},R.opt.lowercase=R.opt.lowercase||R.opt.lowercasetags,R.looseCase=R.opt.lowercase?"toLowerCase":"toUpperCase",R.tags=[],R.closed=R.closedRoot=R.sawRoot=!1,R.tag=R.error=null,R.strict=!!I,R.noscript=!!(I||R.opt.noscript),R.state=x.BEGIN,R.strictEntities=R.opt.strictEntities,R.ENTITIES=R.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),R.attribList=[],R.opt.xmlns&&(R.ns=Object.create(w)),R.opt.unquotedAttributeValues===void 0&&(R.opt.unquotedAttributeValues=!I),R.trackPosition=R.opt.position!==!1,R.trackPosition&&(R.position=R.line=R.column=0),ee(R,"onready")}Object.create||(Object.create=function(I){function v(){}v.prototype=I;var R=new v;return R}),Object.keys||(Object.keys=function(I){var v=[];for(var R in I)I.hasOwnProperty(R)&&v.push(R);return v});function a(I){for(var v=Math.max(e.MAX_BUFFER_LENGTH,10),R=0,D=0,me=t.length;D<me;D++){var ke=I[t[D]].length;if(ke>v)switch(t[D]){case"textNode":G(I);break;case"cdata":O(I,"oncdata",I.cdata),I.cdata="";break;case"script":O(I,"onscript",I.script),I.script="";break;default:le(I,"Max buffer length exceeded: "+t[D])}R=Math.max(R,ke)}var oe=e.MAX_BUFFER_LENGTH-R;I.bufferCheckPosition=oe+I.position}function n(I){for(var v=0,R=t.length;v<R;v++)I[t[v]]=""}function i(I){G(I),I.cdata!==""&&(O(I,"oncdata",I.cdata),I.cdata=""),I.script!==""&&(O(I,"onscript",I.script),I.script="")}s.prototype={end:function(){Se(this)},write:Fe,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){i(this)}};var o;try{o=require("stream").Stream}catch(I){o=function(){}}o||(o=function(){});var u=e.EVENTS.filter(function(I){return I!=="error"&&I!=="end"});function h(I,v){return new l(I,v)}function l(I,v){if(!(this instanceof l))return new l(I,v);o.apply(this),this._parser=new s(I,v),this.writable=!0,this.readable=!0;var R=this;this._parser.onend=function(){R.emit("end")},this._parser.onerror=function(D){R.emit("error",D),R._parser.error=null},this._decoder=null,u.forEach(function(D){Object.defineProperty(R,"on"+D,{get:function(){return R._parser["on"+D]},set:function(me){if(!me)return R.removeAllListeners(D),R._parser["on"+D]=me,me;R.on(D,me)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(o.prototype,{constructor:{value:l}}),l.prototype.write=function(I){if(typeof Dm=="function"&&typeof Dm.isBuffer=="function"&&Dm.isBuffer(I)){if(!this._decoder){var v=lv.StringDecoder;this._decoder=new v("utf8")}I=this._decoder.write(I)}return this._parser.write(I.toString()),this.emit("data",I),!0},l.prototype.end=function(I){return I&&I.length&&this.write(I),this._parser.end(),!0},l.prototype.on=function(I,v){var R=this;return!R._parser["on"+I]&&u.indexOf(I)!==-1&&(R._parser["on"+I]=function(){var D=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);D.splice(0,0,I),R.emit.apply(R,D)}),o.prototype.on.call(R,I,v)};var d="[CDATA[",m="DOCTYPE",N="http://www.w3.org/XML/1998/namespace",y="http://www.w3.org/2000/xmlns/",w={xml:N,xmlns:y},g=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,S=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,A=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,k=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function C(I){return I===" "||I==="\n"||I==="\r"||I==="	"}function V(I){return I==='"'||I==="'"}function M(I){return I===">"||C(I)}function U(I,v){return I.test(v)}function H(I,v){return!U(I,v)}var x=0;e.STATE={BEGIN:x++,BEGIN_WHITESPACE:x++,TEXT:x++,TEXT_ENTITY:x++,OPEN_WAKA:x++,SGML_DECL:x++,SGML_DECL_QUOTED:x++,DOCTYPE:x++,DOCTYPE_QUOTED:x++,DOCTYPE_DTD:x++,DOCTYPE_DTD_QUOTED:x++,COMMENT_STARTING:x++,COMMENT:x++,COMMENT_ENDING:x++,COMMENT_ENDED:x++,CDATA:x++,CDATA_ENDING:x++,CDATA_ENDING_2:x++,PROC_INST:x++,PROC_INST_BODY:x++,PROC_INST_ENDING:x++,OPEN_TAG:x++,OPEN_TAG_SLASH:x++,ATTRIB:x++,ATTRIB_NAME:x++,ATTRIB_NAME_SAW_WHITE:x++,ATTRIB_VALUE:x++,ATTRIB_VALUE_QUOTED:x++,ATTRIB_VALUE_CLOSED:x++,ATTRIB_VALUE_UNQUOTED:x++,ATTRIB_VALUE_ENTITY_Q:x++,ATTRIB_VALUE_ENTITY_U:x++,CLOSE_TAG:x++,CLOSE_TAG_SAW_WHITE:x++,SCRIPT:x++,SCRIPT_ENDING:x++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(I){var v=e.ENTITIES[I],R=typeof v=="number"?String.fromCharCode(v):v;e.ENTITIES[I]=R});for(var Y in e.STATE)e.STATE[e.STATE[Y]]=Y;x=e.STATE;function ee(I,v,R){I[v]&&I[v](R)}function O(I,v,R){I.textNode&&G(I),ee(I,v,R)}function G(I){I.textNode=we(I.opt,I.textNode),I.textNode&&ee(I,"ontext",I.textNode),I.textNode=""}function we(I,v){return I.trim&&(v=v.trim()),I.normalize&&(v=v.replace(/\s+/g," ")),v}function le(I,v){return G(I),I.trackPosition&&(v+="\nLine: "+I.line+"\nColumn: "+I.column+"\nChar: "+I.c),v=new Error(v),I.error=v,ee(I,"onerror",v),I}function Se(I){return I.sawRoot&&!I.closedRoot&&re(I,"Unclosed root tag"),I.state!==x.BEGIN&&I.state!==x.BEGIN_WHITESPACE&&I.state!==x.TEXT&&le(I,"Unexpected end"),G(I),I.c="",I.closed=!0,ee(I,"onend"),s.call(I,I.strict,I.opt),I}function re(I,v){if(typeof I!="object"||!(I instanceof s))throw new Error("bad call to strictFail");I.strict&&le(I,v)}function be(I){I.strict||(I.tagName=I.tagName[I.looseCase]());var v=I.tags[I.tags.length-1]||I,R=I.tag={name:I.tagName,attributes:{}};I.opt.xmlns&&(R.ns=v.ns),I.attribList.length=0,O(I,"onopentagstart",R)}function de(I,v){var R=I.indexOf(":"),D=R<0?["",I]:I.split(":"),me=D[0],ke=D[1];return v&&I==="xmlns"&&(me="xmlns",ke=""),{prefix:me,local:ke}}function te(I){if(I.strict||(I.attribName=I.attribName[I.looseCase]()),I.attribList.indexOf(I.attribName)!==-1||I.tag.attributes.hasOwnProperty(I.attribName)){I.attribName=I.attribValue="";return}if(I.opt.xmlns){var v=de(I.attribName,!0),R=v.prefix,D=v.local;if(R==="xmlns")if(D==="xml"&&I.attribValue!==N)re(I,"xml: prefix must be bound to "+N+"\nActual: "+I.attribValue);else if(D==="xmlns"&&I.attribValue!==y)re(I,"xmlns: prefix must be bound to "+y+"\nActual: "+I.attribValue);else{var me=I.tag,ke=I.tags[I.tags.length-1]||I;me.ns===ke.ns&&(me.ns=Object.create(ke.ns)),me.ns[D]=I.attribValue}I.attribList.push([I.attribName,I.attribValue])}else I.tag.attributes[I.attribName]=I.attribValue,O(I,"onattribute",{name:I.attribName,value:I.attribValue});I.attribName=I.attribValue=""}function se(I,v){if(I.opt.xmlns){var R=I.tag,D=de(I.tagName);R.prefix=D.prefix,R.local=D.local,R.uri=R.ns[D.prefix]||"",R.prefix&&!R.uri&&(re(I,"Unbound namespace prefix: "+JSON.stringify(I.tagName)),R.uri=D.prefix);var me=I.tags[I.tags.length-1]||I;R.ns&&me.ns!==R.ns&&Object.keys(R.ns).forEach(function(Je){O(I,"onopennamespace",{prefix:Je,uri:R.ns[Je]})});for(var ke=0,oe=I.attribList.length;ke<oe;ke++){var kt=I.attribList[ke],At=kt[0],Ms=kt[1],ut=de(At,!0),gs=ut.prefix,Cm=ut.local,$c=gs===""?"":R.ns[gs]||"",ru={name:At,value:Ms,prefix:gs,local:Cm,uri:$c};gs&&gs!=="xmlns"&&!$c&&(re(I,"Unbound namespace prefix: "+JSON.stringify(gs)),ru.uri=gs),I.tag.attributes[At]=ru,O(I,"onattribute",ru)}I.attribList.length=0}I.tag.isSelfClosing=!!v,I.sawRoot=!0,I.tags.push(I.tag),O(I,"onopentag",I.tag),v||(!I.noscript&&I.tagName.toLowerCase()==="script"?I.state=x.SCRIPT:I.state=x.TEXT,I.tag=null,I.tagName=""),I.attribName=I.attribValue="",I.attribList.length=0}function Q(I){if(!I.tagName){re(I,"Weird empty close tag."),I.textNode+="</>",I.state=x.TEXT;return}if(I.script){if(I.tagName!=="script"){I.script+="</"+I.tagName+">",I.tagName="",I.state=x.SCRIPT;return}O(I,"onscript",I.script),I.script=""}var v=I.tags.length,R=I.tagName;I.strict||(R=R[I.looseCase]());for(var D=R;v--;){var me=I.tags[v];if(me.name!==D)re(I,"Unexpected close tag");else break}if(v<0){re(I,"Unmatched closing tag: "+I.tagName),I.textNode+="</"+I.tagName+">",I.state=x.TEXT;return}I.tagName=R;for(var ke=I.tags.length;ke-- >v;){var oe=I.tag=I.tags.pop();I.tagName=I.tag.name,O(I,"onclosetag",I.tagName);var kt={};for(var At in oe.ns)kt[At]=oe.ns[At];var Ms=I.tags[I.tags.length-1]||I;I.opt.xmlns&&oe.ns!==Ms.ns&&Object.keys(oe.ns).forEach(function(ut){var gs=oe.ns[ut];O(I,"onclosenamespace",{prefix:ut,uri:gs})})}v===0&&(I.closedRoot=!0),I.tagName=I.attribValue=I.attribName="",I.attribList.length=0,I.state=x.TEXT}function ie(I){var v=I.entity,R=v.toLowerCase(),D,me="";return I.ENTITIES[v]?I.ENTITIES[v]:I.ENTITIES[R]?I.ENTITIES[R]:(v=R,v.charAt(0)==="#"&&(v.charAt(1)==="x"?(v=v.slice(2),D=parseInt(v,16),me=D.toString(16)):(v=v.slice(1),D=parseInt(v,10),me=D.toString(10))),v=v.replace(/^0+/,""),isNaN(D)||me.toLowerCase()!==v?(re(I,"Invalid character entity"),"&"+I.entity+";"):String.fromCodePoint(D))}function he(I,v){v==="<"?(I.state=x.OPEN_WAKA,I.startTagPosition=I.position):C(v)||(re(I,"Non-whitespace before first tag."),I.textNode=v,I.state=x.TEXT)}function Ce(I,v){var R="";return v<I.length&&(R=I.charAt(v)),R}function Fe(I){var v=this;if(this.error)throw this.error;if(v.closed)return le(v,"Cannot write after close. Assign an onready handler.");if(I===null)return Se(v);typeof I=="object"&&(I=I.toString());for(var R=0,D="";D=Ce(I,R++),v.c=D,!!D;)switch(v.trackPosition&&(v.position++,D==="\n"?(v.line++,v.column=0):v.column++),v.state){case x.BEGIN:if(v.state=x.BEGIN_WHITESPACE,D==="\uFEFF")continue;he(v,D);continue;case x.BEGIN_WHITESPACE:he(v,D);continue;case x.TEXT:if(v.sawRoot&&!v.closedRoot){for(var me=R-1;D&&D!=="<"&&D!=="&";)D=Ce(I,R++),D&&v.trackPosition&&(v.position++,D==="\n"?(v.line++,v.column=0):v.column++);v.textNode+=I.substring(me,R-1)}D==="<"&&!(v.sawRoot&&v.closedRoot&&!v.strict)?(v.state=x.OPEN_WAKA,v.startTagPosition=v.position):(!C(D)&&(!v.sawRoot||v.closedRoot)&&re(v,"Text data outside of root node."),D==="&"?v.state=x.TEXT_ENTITY:v.textNode+=D);continue;case x.SCRIPT:D==="<"?v.state=x.SCRIPT_ENDING:v.script+=D;continue;case x.SCRIPT_ENDING:D==="/"?v.state=x.CLOSE_TAG:(v.script+="<"+D,v.state=x.SCRIPT);continue;case x.OPEN_WAKA:if(D==="!")v.state=x.SGML_DECL,v.sgmlDecl="";else if(!C(D))if(U(g,D))v.state=x.OPEN_TAG,v.tagName=D;else if(D==="/")v.state=x.CLOSE_TAG,v.tagName="";else if(D==="?")v.state=x.PROC_INST,v.procInstName=v.procInstBody="";else{if(re(v,"Unencoded <"),v.startTagPosition+1<v.position){var ke=v.position-v.startTagPosition;D=new Array(ke).join(" ")+D}v.textNode+="<"+D,v.state=x.TEXT}continue;case x.SGML_DECL:if(v.sgmlDecl+D==="--"){v.state=x.COMMENT,v.comment="",v.sgmlDecl="";continue}v.doctype&&v.doctype!==!0&&v.sgmlDecl?(v.state=x.DOCTYPE_DTD,v.doctype+="<!"+v.sgmlDecl+D,v.sgmlDecl=""):(v.sgmlDecl+D).toUpperCase()===d?(O(v,"onopencdata"),v.state=x.CDATA,v.sgmlDecl="",v.cdata=""):(v.sgmlDecl+D).toUpperCase()===m?(v.state=x.DOCTYPE,(v.doctype||v.sawRoot)&&re(v,"Inappropriately located doctype declaration"),v.doctype="",v.sgmlDecl=""):D===">"?(O(v,"onsgmldeclaration",v.sgmlDecl),v.sgmlDecl="",v.state=x.TEXT):(V(D)&&(v.state=x.SGML_DECL_QUOTED),v.sgmlDecl+=D);continue;case x.SGML_DECL_QUOTED:D===v.q&&(v.state=x.SGML_DECL,v.q=""),v.sgmlDecl+=D;continue;case x.DOCTYPE:D===">"?(v.state=x.TEXT,O(v,"ondoctype",v.doctype),v.doctype=!0):(v.doctype+=D,D==="["?v.state=x.DOCTYPE_DTD:V(D)&&(v.state=x.DOCTYPE_QUOTED,v.q=D));continue;case x.DOCTYPE_QUOTED:v.doctype+=D,D===v.q&&(v.q="",v.state=x.DOCTYPE);continue;case x.DOCTYPE_DTD:D==="]"?(v.doctype+=D,v.state=x.DOCTYPE):D==="<"?(v.state=x.OPEN_WAKA,v.startTagPosition=v.position):V(D)?(v.doctype+=D,v.state=x.DOCTYPE_DTD_QUOTED,v.q=D):v.doctype+=D;continue;case x.DOCTYPE_DTD_QUOTED:v.doctype+=D,D===v.q&&(v.state=x.DOCTYPE_DTD,v.q="");continue;case x.COMMENT:D==="-"?v.state=x.COMMENT_ENDING:v.comment+=D;continue;case x.COMMENT_ENDING:D==="-"?(v.state=x.COMMENT_ENDED,v.comment=we(v.opt,v.comment),v.comment&&O(v,"oncomment",v.comment),v.comment=""):(v.comment+="-"+D,v.state=x.COMMENT);continue;case x.COMMENT_ENDED:D!==">"?(re(v,"Malformed comment"),v.comment+="--"+D,v.state=x.COMMENT):v.doctype&&v.doctype!==!0?v.state=x.DOCTYPE_DTD:v.state=x.TEXT;continue;case x.CDATA:D==="]"?v.state=x.CDATA_ENDING:v.cdata+=D;continue;case x.CDATA_ENDING:D==="]"?v.state=x.CDATA_ENDING_2:(v.cdata+="]"+D,v.state=x.CDATA);continue;case x.CDATA_ENDING_2:D===">"?(v.cdata&&O(v,"oncdata",v.cdata),O(v,"onclosecdata"),v.cdata="",v.state=x.TEXT):D==="]"?v.cdata+="]":(v.cdata+="]]"+D,v.state=x.CDATA);continue;case x.PROC_INST:D==="?"?v.state=x.PROC_INST_ENDING:C(D)?v.state=x.PROC_INST_BODY:v.procInstName+=D;continue;case x.PROC_INST_BODY:if(!v.procInstBody&&C(D))continue;D==="?"?v.state=x.PROC_INST_ENDING:v.procInstBody+=D;continue;case x.PROC_INST_ENDING:D===">"?(O(v,"onprocessinginstruction",{name:v.procInstName,body:v.procInstBody}),v.procInstName=v.procInstBody="",v.state=x.TEXT):(v.procInstBody+="?"+D,v.state=x.PROC_INST_BODY);continue;case x.OPEN_TAG:U(S,D)?v.tagName+=D:(be(v),D===">"?se(v):D==="/"?v.state=x.OPEN_TAG_SLASH:(C(D)||re(v,"Invalid character in tag name"),v.state=x.ATTRIB));continue;case x.OPEN_TAG_SLASH:D===">"?(se(v,!0),Q(v)):(re(v,"Forward-slash in opening tag not followed by >"),v.state=x.ATTRIB);continue;case x.ATTRIB:if(C(D))continue;D===">"?se(v):D==="/"?v.state=x.OPEN_TAG_SLASH:U(g,D)?(v.attribName=D,v.attribValue="",v.state=x.ATTRIB_NAME):re(v,"Invalid attribute name");continue;case x.ATTRIB_NAME:D==="="?v.state=x.ATTRIB_VALUE:D===">"?(re(v,"Attribute without value"),v.attribValue=v.attribName,te(v),se(v)):C(D)?v.state=x.ATTRIB_NAME_SAW_WHITE:U(S,D)?v.attribName+=D:re(v,"Invalid attribute name");continue;case x.ATTRIB_NAME_SAW_WHITE:if(D==="=")v.state=x.ATTRIB_VALUE;else{if(C(D))continue;re(v,"Attribute without value"),v.tag.attributes[v.attribName]="",v.attribValue="",O(v,"onattribute",{name:v.attribName,value:""}),v.attribName="",D===">"?se(v):U(g,D)?(v.attribName=D,v.state=x.ATTRIB_NAME):(re(v,"Invalid attribute name"),v.state=x.ATTRIB)}continue;case x.ATTRIB_VALUE:if(C(D))continue;V(D)?(v.q=D,v.state=x.ATTRIB_VALUE_QUOTED):(v.opt.unquotedAttributeValues||le(v,"Unquoted attribute value"),v.state=x.ATTRIB_VALUE_UNQUOTED,v.attribValue=D);continue;case x.ATTRIB_VALUE_QUOTED:if(D!==v.q){D==="&"?v.state=x.ATTRIB_VALUE_ENTITY_Q:v.attribValue+=D;continue}te(v),v.q="",v.state=x.ATTRIB_VALUE_CLOSED;continue;case x.ATTRIB_VALUE_CLOSED:C(D)?v.state=x.ATTRIB:D===">"?se(v):D==="/"?v.state=x.OPEN_TAG_SLASH:U(g,D)?(re(v,"No whitespace between attributes"),v.attribName=D,v.attribValue="",v.state=x.ATTRIB_NAME):re(v,"Invalid attribute name");continue;case x.ATTRIB_VALUE_UNQUOTED:if(!M(D)){D==="&"?v.state=x.ATTRIB_VALUE_ENTITY_U:v.attribValue+=D;continue}te(v),D===">"?se(v):v.state=x.ATTRIB;continue;case x.CLOSE_TAG:if(v.tagName)D===">"?Q(v):U(S,D)?v.tagName+=D:v.script?(v.script+="</"+v.tagName,v.tagName="",v.state=x.SCRIPT):(C(D)||re(v,"Invalid tagname in closing tag"),v.state=x.CLOSE_TAG_SAW_WHITE);else{if(C(D))continue;H(g,D)?v.script?(v.script+="</"+D,v.state=x.SCRIPT):re(v,"Invalid tagname in closing tag."):v.tagName=D}continue;case x.CLOSE_TAG_SAW_WHITE:if(C(D))continue;D===">"?Q(v):re(v,"Invalid characters in closing tag");continue;case x.TEXT_ENTITY:case x.ATTRIB_VALUE_ENTITY_Q:case x.ATTRIB_VALUE_ENTITY_U:var oe,kt;switch(v.state){case x.TEXT_ENTITY:oe=x.TEXT,kt="textNode";break;case x.ATTRIB_VALUE_ENTITY_Q:oe=x.ATTRIB_VALUE_QUOTED,kt="attribValue";break;case x.ATTRIB_VALUE_ENTITY_U:oe=x.ATTRIB_VALUE_UNQUOTED,kt="attribValue";break}if(D===";"){var At=ie(v);v.opt.unparsedEntities&&!Object.values(e.XML_ENTITIES).includes(At)?(v.entity="",v.state=oe,v.write(At)):(v[kt]+=At,v.entity="",v.state=oe)}else U(v.entity.length?k:A,D)?v.entity+=D:(re(v,"Invalid character in entity name"),v[kt]+="&"+v.entity+D,v.entity="",v.state=oe);continue;default:throw new Error(v,"Unknown state: "+v.state)}return v.position>=v.bufferCheckPosition&&a(v),v}String.fromCodePoint||function(){var I=String.fromCharCode,v=Math.floor,R=function(){var D=16384,me=[],ke,oe,kt=-1,At=arguments.length;if(!At)return"";for(var Ms="";++kt<At;){var ut=Number(arguments[kt]);if(!isFinite(ut)||ut<0||ut>1114111||v(ut)!==ut)throw RangeError("Invalid code point: "+ut);ut<=65535?me.push(ut):(ut-=65536,ke=(ut>>10)+55296,oe=ut%1024+56320,me.push(ke,oe)),(kt+1===At||me.length>D)&&(Ms+=I.apply(null,me),me.length=0)}return Ms};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:R,configurable:!0,writable:!0}):String.fromCodePoint=R}()})(r)}(ng)),ng}vv();function bv(r){return typeof r=="function"?r:Array.isArray(r)?e=>{for(const t of r)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}const Av="\n";function Sv(r,e){let t="";return e.format&&e.indentBy.length>0&&(t=Av),Ow(r,e,"",t)}function Ow(r,e,t,s){let a="",n=!1;for(let i=0;i<r.length;i++){const o=r[i],u=Nv(o);if(u===void 0)continue;let h="";if(t.length===0?h=u:h="".concat(t,".").concat(u),u===e.textNodeName){let y=o[u];Ev(h,e)||(y=e.tagValueProcessor(u,y),y=Dw(y,e)),n&&(a+=s),a+=y,n=!1;continue}else if(u===e.cdataPropName){n&&(a+=s),a+="<![CDATA[".concat(o[u][0][e.textNodeName],"]]>"),n=!1;continue}else if(u===e.commentPropName){a+=s+"<!--".concat(o[u][0][e.textNodeName],"-->"),n=!0;continue}else if(u[0]==="?"){const y=og(o[":@"],e),w=u==="?xml"?"":s;let g=o[u][0][e.textNodeName];g=g.length!==0?" "+g:"",a+=w+"<".concat(u).concat(g).concat(y,"?>"),n=!0;continue}let l=s;l!==""&&(l+=e.indentBy);const d=og(o[":@"],e),m=s+"<".concat(u).concat(d),N=Ow(o[u],e,h,l);e.unpairedTags.indexOf(u)!==-1?e.suppressUnpairedNode?a+=m+">":a+=m+"/>":(!N||N.length===0)&&e.suppressEmptyNode?a+=m+"/>":N&&N.endsWith(">")?a+=m+">".concat(N).concat(s,"</").concat(u,">"):(a+=m+">",N&&s!==""&&(N.includes("/>")||N.includes("</"))?a+=s+e.indentBy+N+s:a+=N,a+="</".concat(u,">")),n=!0}return a}function Nv(r){const e=Object.keys(r);for(let t=0;t<e.length;t++){const s=e[t];if(r.hasOwnProperty(s)&&s!==":@")return s}}function og(r,e){let t="";if(r&&!e.ignoreAttributes)for(let s in r){if(!r.hasOwnProperty(s))continue;let a=e.attributeValueProcessor(s,r[s]);a=Dw(a,e),a===!0&&e.suppressBooleanAttributes?t+=" ".concat(s.substr(e.attributeNamePrefix.length)):t+=" ".concat(s.substr(e.attributeNamePrefix.length),'="').concat(a,'"')}return t}function Ev(r,e){r=r.substr(0,r.length-e.textNodeName.length-1);let t=r.substr(r.lastIndexOf(".")+1);for(let s in e.stopNodes)if(e.stopNodes[s]===r||e.stopNodes[s]==="*."+t)return!0;return!1}function Dw(r,e){if(r&&r.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const s=e.entities[t];r=r.replace(s.regex,s.val)}return r}const kv={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function ga(r){this.options=Object.assign({},kv,r),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=bv(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Bv),this.processTextOrObjNode=Iv,this.options.format?(this.indentate=Cv,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}ga.prototype.build=function(r){return this.options.preserveOrder?Sv(r,this.options):(Array.isArray(r)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(r={[this.options.arrayNodeName]:r}),this.j2x(r,0,[]).val)},ga.prototype.j2x=function(r,e,t){let s="",a="";const n=t.join(".");for(let i in r)if(Object.prototype.hasOwnProperty.call(r,i))if(typeof r[i]>"u")this.isAttribute(i)&&(a+="");else if(r[i]===null)this.isAttribute(i)||i===this.options.cdataPropName?a+="":i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(r[i]instanceof Date)a+=this.buildTextValNode(r[i],i,"",e);else if(typeof r[i]!="object"){const o=this.isAttribute(i);if(o&&!this.ignoreAttributesFn(o,n))s+=this.buildAttrPairStr(o,""+r[i]);else if(!o)if(i===this.options.textNodeName){let u=this.options.tagValueProcessor(i,""+r[i]);a+=this.replaceEntitiesValue(u)}else a+=this.buildTextValNode(r[i],i,"",e)}else if(Array.isArray(r[i])){const o=r[i].length;let u="",h="";for(let l=0;l<o;l++){const d=r[i][l];if(!(typeof d>"u"))if(d===null)i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(typeof d=="object")if(this.options.oneListGroup){const m=this.j2x(d,e+1,t.concat(i));u+=m.val,this.options.attributesGroupName&&d.hasOwnProperty(this.options.attributesGroupName)&&(h+=m.attrStr)}else u+=this.processTextOrObjNode(d,i,e,t);else if(this.options.oneListGroup){let m=this.options.tagValueProcessor(i,d);m=this.replaceEntitiesValue(m),u+=m}else u+=this.buildTextValNode(d,i,"",e)}this.options.oneListGroup&&(u=this.buildObjectNode(u,i,h,e)),a+=u}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const o=Object.keys(r[i]),u=o.length;for(let h=0;h<u;h++)s+=this.buildAttrPairStr(o[h],""+r[i][o[h]])}else a+=this.processTextOrObjNode(r[i],i,e,t);return{attrStr:s,val:a}},ga.prototype.buildAttrPairStr=function(r,e){return e=this.options.attributeValueProcessor(r,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+r:" "+r+'="'+e+'"'};function Iv(r,e,t,s){const a=this.j2x(r,t+1,s.concat(e));return r[this.options.textNodeName]!==void 0&&Object.keys(r).length===1?this.buildTextValNode(r[this.options.textNodeName],e,a.attrStr,t):this.buildObjectNode(a.val,e,a.attrStr,t)}ga.prototype.buildObjectNode=function(r,e,t,s){if(r==="")return e[0]==="?"?this.indentate(s)+"<"+e+t+"?"+this.tagEndChar:this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let a="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",a=""),(t||t==="")&&r.indexOf("<")===-1?this.indentate(s)+"<"+e+t+n+">"+r+a:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(s)+"<!--".concat(r,"-->")+this.newLine:this.indentate(s)+"<"+e+t+n+this.tagEndChar+r+this.indentate(s)+a}},ga.prototype.closeTag=function(r){let e="";return this.options.unpairedTags.indexOf(r)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e="></".concat(r),e},ga.prototype.buildTextValNode=function(r,e,t,s){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(s)+"<![CDATA[".concat(r,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(s)+"<!--".concat(r,"-->")+this.newLine;if(e[0]==="?")return this.indentate(s)+"<"+e+t+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(e,r);return a=this.replaceEntitiesValue(a),a===""?this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(s)+"<"+e+t+">"+a+"</"+e+this.tagEndChar}},ga.prototype.replaceEntitiesValue=function(r){if(r&&r.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];r=r.replace(t.regex,t.val)}return r};function Cv(r){return this.options.indentBy.repeat(r)}function Bv(r){return r.startsWith(this.options.attributeNamePrefix)&&r!==this.options.textNodeName?r.substr(this.attrPrefixLen):!1}function Ah(r){return r.users!==void 0}const xv=r=>r===null?Uf().setApp("end_to_end_encryption").build():Uf().setApp("end_to_end_encryption").setUid(r.uid).build(),mt=xv(Ep());class Ue{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let s=0;s<t;s++)this.view[s]=e.charCodeAt(s)}toString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)s+=String.fromCharCode(this.view[a]);return s}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const s=new Map;s.set("0",0),s.set("1",1),s.set("2",2),s.set("3",3),s.set("4",4),s.set("5",5),s.set("6",6),s.set("7",7),s.set("8",8),s.set("9",9),s.set("A",10),s.set("a",10),s.set("B",11),s.set("b",11),s.set("C",12),s.set("c",12),s.set("D",13),s.set("d",13),s.set("E",14),s.set("e",14),s.set("F",15),s.set("f",15);let a=0,n=0;for(let i=0;i<t;i++)i%2?(n|=s.get(e.charAt(i)),this.view[a]=n,a++):n=s.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){const n=this.view[a].toString(16).toUpperCase();s=s+(n.length==1?"0":"")+n}return s}copy(e=0,t=this.length-e){if(!e&&!this.length)return new Ue;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Ue({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new Ue;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Ue({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),s=new Uint8Array(t);e>this._view.length?s.set(this._view):s.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,s=e.length,a=e._view.subarray();this.realloc(t+s),this._view.set(a,t)}insert(e,t=0,s=this.length-t){return t>this.length-1?!1:(s>this.length-t&&(s=this.length-t),s>e.length&&(s=e.length),s==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,s),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a),u=e.length;if(u>i)return-1;const h=[];for(let l=0;l<u;l++)h.push(e.view[l]);for(let l=0;l<=i-u;l++){let d=!0;const m=o?n-u-l:n+l;for(let N=0;N<u;N++)if(this.view[N+m]!=h[N]){d=!1;break}if(d)return o?n-u-l:n+u+l}return-1}findFirstIn(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a),u={id:-1,position:o?0:n+i,length:0};for(let h=0;h<e.length;h++){const l=this.findPattern(e[h],n,i,o);if(l!=-1){let d=!1;const m=e[h].length;o?l-m>=u.position-u.length&&(d=!0):l-m<=u.position-u.length&&(d=!0),d&&(u.position=l,u.id=h,u.length=m)}}return u}findAllIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={id:-1,position:a};do{const u=o.position;if(o=this.findFirstIn(e,o.position,n),o.id==-1)break;n-=o.position-u,i.push({id:o.id,position:o.position})}while(!0);return i}findAllPatternIn(e,t,s){const{start:a,length:n}=this.prepareFindParameters(t,s),i=[],o=e.length;if(o>n)return-1;const u=Array.from(e.view);for(let h=0;h<=n-o;h++){let l=!0;const d=a+h;for(let m=0;m<o;m++)if(this.view[m+d]!=u[m]){l=!1;break}l&&(i.push(a+o+h),h+=o-1)}return i}findFirstNotIn(e,t,s,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);const u={left:{id:-1,position:n},right:{id:-1,position:0},value:new Ue};let h=i;for(;h>0;){if(u.right=this.findFirstIn(e,o?n-i+h:n+i-h,h,o),u.right.id==-1){i=h,o?n-=i:n=u.left.position,u.value=new Ue({buffer:this._buffer.slice(n,n+i)});break}if(u.right.position!=(o?u.left.position-e[u.right.id].length:u.left.position+e[u.right.id].length)){o?(n=u.right.position+e[u.right.id].length,i=u.left.position-u.right.position-e[u.right.id].length):(n=u.left.position,i=u.right.position-u.left.position-e[u.right.id].length),u.value=new Ue({buffer:this._buffer.slice(n,n+i)});break}u.left=u.right,h-=e[u.right.id].length}if(o){const l=u.right;u.right=u.left,u.left=l}return u}findAllNotIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={left:{id:-1,position:a},right:{id:-1,position:a},value:new Ue};do{const u=o.right.position;o=this.findFirstNotIn(e,o.right.position,n),n-=o.right.position-u,i.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(o.right.id!=-1);return i}findFirstSequence(e,t,s,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);const u=this.skipNotPatterns(e,n,i,o);if(u==-1)return{position:-1,value:new Ue};const h=this.skipPatterns(e,u,i-(o?n-u:u-n),o);o?(n=h,i=u-h):(n=u,i=h-u);const l=new Ue({buffer:this._buffer.slice(n,n+i)});return{position:h,value:l}}findAllSequences(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={position:a,value:new Ue};do{const u=o.position;o=this.findFirstSequence(e,o.position,n),o.position!=-1&&(n-=o.position-u,i.push({position:o.position,value:o.value}))}while(o.position!=-1);return i}findPairedPatterns(e,t,s,a){const n=[];if(e.isEqual(t))return n;const{start:i,length:o}=this.prepareFindParameters(s,a);let u=0;const h=this.findAllPatternIn(e,i,o);if(!Array.isArray(h)||h.length==0)return n;const l=this.findAllPatternIn(t,i,o);if(!Array.isArray(l)||l.length==0)return n;for(;u<h.length&&l.length!=0;){if(h[0]==l[0]){n.push({left:h[0],right:l[0]}),h.splice(0,1),l.splice(0,1);continue}if(h[u]>l[0])break;for(;h[u]<l[0]&&(u++,!(u>=h.length)););n.push({left:h[u-1],right:l[0]}),h.splice(u-1,1),l.splice(0,1),u=0}return n.sort((d,m)=>d.left-m.left),n}findPairedArrays(e,t,s,a){const{start:n,length:i}=this.prepareFindParameters(s,a),o=[];let u=0;const h=this.findAllIn(e,n,i);if(h.length==0)return o;const l=this.findAllIn(t,n,i);if(l.length==0)return o;for(;u<h.length&&l.length!=0;){if(h[0].position==l[0].position){o.push({left:h[0],right:l[0]}),h.splice(0,1),l.splice(0,1);continue}if(h[u].position>l[0].position)break;for(;h[u].position<l[0].position&&(u++,!(u>=h.length)););o.push({left:h[u-1],right:l[0]}),h.splice(u-1,1),l.splice(0,1),u=0}return o.sort((d,m)=>d.left.position-m.left.position),o}replacePattern(e,t,s,a,n=null){let i=[],o;const u={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:h,length:l}=this.prepareFindParameters(s,a);if(n==null){if(i=this.findAllIn([e],h,l),i.length==0)return u}else i=n;u.searchPatternPositions.push(...Array.from(i,y=>y.position));const d=e.length-t.length,m=new ArrayBuffer(this.view.length-i.length*d),N=new Uint8Array(m);for(N.set(new Uint8Array(this.buffer,0,h)),o=0;o<i.length;o++){const y=o==0?h:i[o-1].position;N.set(new Uint8Array(this.buffer,y,i[o].position-e.length-y),y-o*d),N.set(t.view,i[o].position-e.length-o*d),u.replacePatternPositions.push(i[o].position-e.length-o*d)}return o--,N.set(new Uint8Array(this.buffer,i[o].position,this.length-i[o].position),i[o].position-e.length+t.length-o*d),this.buffer=m,this.view=new Uint8Array(this.buffer),u.status=1,u}skipPatterns(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);let u=n;for(let h=0;h<e.length;h++){const l=e[h].length,d=o?u-l:u;let m=!0;for(let N=0;N<l;N++)if(this.view[N+d]!=e[h].view[N]){m=!1;break}if(m){if(h=-1,o){if(u-=l,u<=0)return u}else if(u+=l,u>=n+i)return u}}return u}skipNotPatterns(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);let u=-1;for(let h=0;h<i;h++){for(let l=0;l<e.length;l++){const d=e[l].length,m=o?n-h-d:n+h;let N=!0;for(let y=0;y<d;y++)if(this.view[y+m]!=e[l].view[y]){N=!1;break}if(N){u=o?n-h:n+h;break}}if(u!=-1)break}return u}prepareFindParameters(e=null,t=null,s=!1){return e===null&&(e=s?this.length:0),e>this.length&&(e=this.length),s?(t===null&&(t=e),t>e&&(t=e)):(t===null&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:s}}}const Vv=16777216;class Na{constructor(e={}){this._stream=new Ue,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new Ue({view:e.view}):"buffer"in e?this.stream=new Ue({buffer:e.buffer}):"string"in e?this.stream=new Ue({string:e.string}):"hexstring"in e?this.stream=new Ue({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new Ue,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findPattern(e,this.start,this.length,this.backward);if(s==-1)return s;if(this.backward){if(s<this.start-e.length-t)return-1}else if(s>this.start+e.length+t)return-1;return this.start=s,s}findFirstIn(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(s.id==-1)return s;if(this.backward){if(s.position<this.start-e[s.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(s.position>this.start+e[s.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=s.position,s}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(t==null||t>this._length)&&(t=this._length);const s=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(s.left.id==-1&&s.right.id==-1)return s;if(this.backward){if(s.right.id!=-1&&s.right.position<this._start-e[s.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Ue}}else if(s.left.id!=-1&&s.left.position>this._start+e[s.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Ue};return this.backward?s.left.id==-1?this.start=0:this.start=s.left.position:s.right.id==-1?this.start=this._start+this._length:this.start=s.right.position,s}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,s=null){(t==null||t>this._length)&&(t=this._length),(s==null||s>t)&&(s=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(a.value.length==0)return a;if(this.backward){if(a.position<this._start-a.value.length-s)return{position:-1,value:new Ue}}else if(a.position>this._start+a.value.length+s)return{position:-1,value:new Ue};return this.start=a.position,a}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right<this.start-t.length-s)return[]}else if(n[0].left>this.start+e.length+s)return[]}return n}findPairedArrays(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-s)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+s)return[]}return n}replacePattern(e,t){const s=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,s,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return t==-1?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),s=new Uint8Array(t.buffer);this.stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[2],this._stream.view[this._start+1]=s[1],this._stream.view[this._start+2]=s[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);this._length<e&&(e=this._length);let s;if(this.backward){const a=this._stream.view.subarray(this._length-e,this._length);s=new Uint8Array(e);for(let n=0;n<e;n++)s[e-1-n]=a[n]}else s=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),s}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),s=32768;return t&s?-(s-(t^s)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:t[0]*Vv+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),s=2147483648;return t&s?-(s-(t^s)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+Na.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}Na.APPEND_BLOCK=1e3;function Pv(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Tw(r,...e){if(!Pv(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function ug(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Ov(r,e){Tw(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const rf=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Vs=(r,e)=>r<<32-e|r>>>e,af=(r,e)=>r<<e|r>>>32-e>>>0;function Dv(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Rw(r){return typeof r=="string"&&(r=Dv(r)),Tw(r),r}class Tv{clone(){return this._cloneInto()}}function Em(r){const e=s=>r().update(Rw(s)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Rv(r,e,t,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,s);const a=BigInt(32),n=BigInt(4294967295),i=Number(t>>a&n),o=Number(t&n),u=s?4:0,h=s?0:4;r.setUint32(e+u,i,s),r.setUint32(e+h,o,s)}const Lw=(r,e,t)=>r&e^~r&t,Uw=(r,e,t)=>r&e^r&t^e&t;class Rp extends Tv{constructor(e,t,s,a){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=rf(this.buffer)}update(e){ug(this);const{view:t,buffer:s,blockLen:a}=this;e=Rw(e);const n=e.length;for(let i=0;i<n;){const o=Math.min(a-this.pos,n-i);if(o===a){const u=rf(e);for(;a<=n-i;i+=a)this.process(u,i);continue}s.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ug(this),Ov(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:a,isLE:n}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>a-i&&(this.process(s,0),i=0);for(let d=i;d<a;d++)t[d]=0;Rv(s,a-8,BigInt(this.length*8),n),this.process(s,0);const o=rf(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=u/4,l=this.get();if(h>l.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<h;d++)o.setUint32(4*d,l[d],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:a,finished:n,destroyed:i,pos:o}=this;return e.length=a,e.pos=o,e.finished=n,e.destroyed=i,a%t&&e.buffer.set(s),e}}const cu=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),gr=new Uint32Array(80);let Lv=class extends Rp{constructor(){super(64,20,8,!1),this.A=cu[0]|0,this.B=cu[1]|0,this.C=cu[2]|0,this.D=cu[3]|0,this.E=cu[4]|0}get(){const{A:r,B:e,C:t,D:s,E:a}=this;return[r,e,t,s,a]}set(r,e,t,s,a){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0}process(r,e){for(let o=0;o<16;o++,e+=4)gr[o]=r.getUint32(e,!1);for(let o=16;o<80;o++)gr[o]=af(gr[o-3]^gr[o-8]^gr[o-14]^gr[o-16],1);let{A:t,B:s,C:a,D:n,E:i}=this;for(let o=0;o<80;o++){let u,h;o<20?(u=Lw(s,a,n),h=1518500249):o<40?(u=s^a^n,h=1859775393):o<60?(u=Uw(s,a,n),h=2400959708):(u=s^a^n,h=3395469782);const l=af(t,5)+u+i+h+gr[o]|0;i=n,n=a,a=af(s,30),s=t,t=l}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,i=i+this.E|0,this.set(t,s,a,n,i)}roundClean(){gr.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}};const Uv=Em(()=>new Lv),jv=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),wr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),yr=new Uint32Array(64);let $v=class extends Rp{constructor(){super(64,32,8,!1),this.A=wr[0]|0,this.B=wr[1]|0,this.C=wr[2]|0,this.D=wr[3]|0,this.E=wr[4]|0,this.F=wr[5]|0,this.G=wr[6]|0,this.H=wr[7]|0}get(){const{A:r,B:e,C:t,D:s,E:a,F:n,G:i,H:o}=this;return[r,e,t,s,a,n,i,o]}set(r,e,t,s,a,n,i,o){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0,this.F=n|0,this.G=i|0,this.H=o|0}process(r,e){for(let l=0;l<16;l++,e+=4)yr[l]=r.getUint32(e,!1);for(let l=16;l<64;l++){const d=yr[l-15],m=yr[l-2],N=Vs(d,7)^Vs(d,18)^d>>>3,y=Vs(m,17)^Vs(m,19)^m>>>10;yr[l]=y+yr[l-7]+N+yr[l-16]|0}let{A:t,B:s,C:a,D:n,E:i,F:o,G:u,H:h}=this;for(let l=0;l<64;l++){const d=Vs(i,6)^Vs(i,11)^Vs(i,25),m=h+d+Lw(i,o,u)+jv[l]+yr[l]|0,N=(Vs(t,2)^Vs(t,13)^Vs(t,22))+Uw(t,s,a)|0;h=u,u=o,o=i,i=n+m|0,n=a,a=s,s=t,t=m+N|0}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,i=i+this.E|0,o=o+this.F|0,u=u+this.G|0,h=h+this.H|0,this.set(t,s,a,n,i,o,u,h)}roundClean(){yr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Mv=Em(()=>new $v),qc=BigInt(2**32-1),Qf=BigInt(32);function jw(r,e=!1){return e?{h:Number(r&qc),l:Number(r>>Qf&qc)}:{h:Number(r>>Qf&qc)|0,l:Number(r&qc)|0}}function Kv(r,e=!1){let t=new Uint32Array(r.length),s=new Uint32Array(r.length);for(let a=0;a<r.length;a++){const{h:n,l:i}=jw(r[a],e);[t[a],s[a]]=[n,i]}return[t,s]}const Hv=(r,e)=>BigInt(r>>>0)<<Qf|BigInt(e>>>0),Fv=(r,e,t)=>r>>>t,Jv=(r,e,t)=>r<<32-t|e>>>t,qv=(r,e,t)=>r>>>t|e<<32-t,_v=(r,e,t)=>r<<32-t|e>>>t,Wv=(r,e,t)=>r<<64-t|e>>>t-32,Gv=(r,e,t)=>r>>>t-32|e<<64-t,zv=(r,e)=>e,Xv=(r,e)=>r,Yv=(r,e,t)=>r<<t|e>>>32-t,Qv=(r,e,t)=>e<<t|r>>>32-t,Zv=(r,e,t)=>e<<t-32|r>>>64-t,eb=(r,e,t)=>r<<t-32|e>>>64-t;function tb(r,e,t,s){const a=(e>>>0)+(s>>>0);return{h:r+t+(a/2**32|0)|0,l:a|0}}const sb=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),rb=(r,e,t,s)=>e+t+s+(r/2**32|0)|0,ab=(r,e,t,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0),nb=(r,e,t,s,a)=>e+t+s+a+(r/2**32|0)|0,ib=(r,e,t,s,a)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0)+(a>>>0),ob=(r,e,t,s,a,n)=>e+t+s+a+n+(r/2**32|0)|0,fe={fromBig:jw,split:Kv,toBig:Hv,shrSH:Fv,shrSL:Jv,rotrSH:qv,rotrSL:_v,rotrBH:Wv,rotrBL:Gv,rotr32H:zv,rotr32L:Xv,rotlSH:Yv,rotlSL:Qv,rotlBH:Zv,rotlBL:eb,add:tb,add3L:sb,add3H:rb,add4L:ab,add4H:nb,add5H:ob,add5L:ib},[ub,lb]=fe.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),vr=new Uint32Array(80),br=new Uint32Array(80);let $w=class extends Rp{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:r,Al:e,Bh:t,Bl:s,Ch:a,Cl:n,Dh:i,Dl:o,Eh:u,El:h,Fh:l,Fl:d,Gh:m,Gl:N,Hh:y,Hl:w}=this;return[r,e,t,s,a,n,i,o,u,h,l,d,m,N,y,w]}set(r,e,t,s,a,n,i,o,u,h,l,d,m,N,y,w){this.Ah=r|0,this.Al=e|0,this.Bh=t|0,this.Bl=s|0,this.Ch=a|0,this.Cl=n|0,this.Dh=i|0,this.Dl=o|0,this.Eh=u|0,this.El=h|0,this.Fh=l|0,this.Fl=d|0,this.Gh=m|0,this.Gl=N|0,this.Hh=y|0,this.Hl=w|0}process(r,e){for(let A=0;A<16;A++,e+=4)vr[A]=r.getUint32(e),br[A]=r.getUint32(e+=4);for(let A=16;A<80;A++){const k=vr[A-15]|0,C=br[A-15]|0,V=fe.rotrSH(k,C,1)^fe.rotrSH(k,C,8)^fe.shrSH(k,C,7),M=fe.rotrSL(k,C,1)^fe.rotrSL(k,C,8)^fe.shrSL(k,C,7),U=vr[A-2]|0,H=br[A-2]|0,x=fe.rotrSH(U,H,19)^fe.rotrBH(U,H,61)^fe.shrSH(U,H,6),Y=fe.rotrSL(U,H,19)^fe.rotrBL(U,H,61)^fe.shrSL(U,H,6),ee=fe.add4L(M,Y,br[A-7],br[A-16]),O=fe.add4H(ee,V,x,vr[A-7],vr[A-16]);vr[A]=O|0,br[A]=ee|0}let{Ah:t,Al:s,Bh:a,Bl:n,Ch:i,Cl:o,Dh:u,Dl:h,Eh:l,El:d,Fh:m,Fl:N,Gh:y,Gl:w,Hh:g,Hl:S}=this;for(let A=0;A<80;A++){const k=fe.rotrSH(l,d,14)^fe.rotrSH(l,d,18)^fe.rotrBH(l,d,41),C=fe.rotrSL(l,d,14)^fe.rotrSL(l,d,18)^fe.rotrBL(l,d,41),V=l&m^~l&y,M=d&N^~d&w,U=fe.add5L(S,C,M,lb[A],br[A]),H=fe.add5H(U,g,k,V,ub[A],vr[A]),x=U|0,Y=fe.rotrSH(t,s,28)^fe.rotrBH(t,s,34)^fe.rotrBH(t,s,39),ee=fe.rotrSL(t,s,28)^fe.rotrBL(t,s,34)^fe.rotrBL(t,s,39),O=t&a^t&i^a&i,G=s&n^s&o^n&o;g=y|0,S=w|0,y=m|0,w=N|0,m=l|0,N=d|0,{h:l,l:d}=fe.add(u|0,h|0,H|0,x|0),u=i|0,h=o|0,i=a|0,o=n|0,a=t|0,n=s|0;const we=fe.add3L(x,ee,G);t=fe.add3H(we,H,Y,O),s=we|0}({h:t,l:s}=fe.add(this.Ah|0,this.Al|0,t|0,s|0)),{h:a,l:n}=fe.add(this.Bh|0,this.Bl|0,a|0,n|0),{h:i,l:o}=fe.add(this.Ch|0,this.Cl|0,i|0,o|0),{h:u,l:h}=fe.add(this.Dh|0,this.Dl|0,u|0,h|0),{h:l,l:d}=fe.add(this.Eh|0,this.El|0,l|0,d|0),{h:m,l:N}=fe.add(this.Fh|0,this.Fl|0,m|0,N|0),{h:y,l:w}=fe.add(this.Gh|0,this.Gl|0,y|0,w|0),{h:g,l:S}=fe.add(this.Hh|0,this.Hl|0,g|0,S|0),this.set(t,s,a,n,i,o,u,h,l,d,m,N,y,w,g,S)}roundClean(){vr.fill(0),br.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},cb=class extends $w{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}};const hb=Em(()=>new $w),mb=Em(()=>new cb),Qe=new ArrayBuffer(0),E="";class Ne extends TypeError{constructor(){super(...arguments),this.name=Ne.NAME}static isType(e,t){if(typeof t=="string"){if(t==="Array"&&Array.isArray(e)||t==="ArrayBuffer"&&e instanceof ArrayBuffer||t==="ArrayBufferView"&&ArrayBuffer.isView(e)||typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...s){for(const n of s)if(this.isType(e,n))return;const a=s.map(n=>n instanceof Function&&"name"in n?n.name:"".concat(n));throw new Ne("Parameter '".concat(t,"' is not of type ").concat(a.length>1?"(".concat(a.join(" or "),")"):a[0]))}}Ne.NAME="ArgumentError";class ge extends TypeError{static assert(...e){let t=null,s,a;typeof e[0]=="string"?(t=e[0],s=e[1],a=e.slice(2)):(s=e[0],a=e.slice(1)),Ne.assert(s,"parameters","object");for(const n of a)if(s[n]==null)throw new ge(n,t)}static assertEmpty(e,t,s){if(e==null)throw new ge(t,s)}constructor(e,t=null,s){super(),this.name=ge.NAME,this.field=e,t&&(this.target=t),s?this.message=s:this.message="Absent mandatory parameter '".concat(e,"' ").concat(t?" in '".concat(t,"'"):E)}}ge.NAME="ParameterError";class K extends Error{static assertSchema(e,t){if(!e.verified)throw new Error("Object's schema was not verified against input data for ".concat(t))}static assert(e,t){if(e.offset===-1)throw new K("Error during parsing of ASN.1 data. Data is not correct for '".concat(t,"'."))}constructor(e){super(e),this.name="AsnError"}}class J{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=Ye(e);K.assert(t,this.name);try{return new this({schema:t.result})}catch(s){throw new K("Cannot create '".concat(this.CLASS_NAME,"' from ASN.1 object"))}}static defaultValues(e){throw new Error("Invalid member name for ".concat(this.CLASS_NAME," class: ").concat(e))}static schema(e={}){throw new Error("Method '".concat(this.CLASS_NAME,".schema' should be overridden"))}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch(s){t=this.toSchema(!0)}return Ae.ToString(t.toBER(),e)}}J.CLASS_NAME="PkiObject";function la(r){let e=!1,t=E;const s=r.trim();for(let a=0;a<s.length;a++)s.charCodeAt(a)===32?e===!1&&(e=!0):(e&&(t+=" ",e=!1),t+=s[a]);return t.toLowerCase()}const hu="type",nf="value";class wa extends J{constructor(e={}){super(),this.type=f(e,hu,wa.defaultValues(hu)),this.value=f(e,nf,wa.defaultValues(nf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hu:return E;case nf:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.type||E}),new ne({name:t.value||E})]})}fromSchema(e){q(e,[hu,"typeValue"]);const t=_(e,e,wa.schema({names:{type:hu,value:"typeValue"}}));K.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new B({value:[new Z({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return Object.keys(this.value).length!==0?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[tm.blockName(),Ff.blockName(),Hf.blockName(),yh.blockName(),rr.blockName(),Kf.blockName(),$y.blockName(),_g.blockName(),My.blockName(),Ky.blockName(),Hy.blockName(),Fy.blockName()];if(e instanceof ArrayBuffer)return xe.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===wa.blockName()){if(this.type!==e.type)return!1;const s=[!1,!1],a=this.value.constructor.blockName();for(const n of t)a===n&&(s[0]=!0),e.value.constructor.blockName()===n&&(s[1]=!0);if(s[0]!==s[1])return!1;if(s[0]&&s[1]){const n=la(this.value.valueBlock.value),i=la(e.value.valueBlock.value);if(n.localeCompare(i)!==0)return!1}else if(!xe.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}wa.CLASS_NAME="AttributeTypeAndValue";const Oa="typesAndValues",_c="valueBeforeDecode",lg="RDN";class Ee extends J{constructor(e={}){super(),this.typesAndValues=f(e,Oa,Ee.defaultValues(Oa)),this.valueBeforeDecode=f(e,_c,Ee.defaultValues(_c)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oa:return[];case _c:return Qe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Oa:return t.length===0;case _c:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.repeatedSequence||E,value:new it({value:[new ue({name:t.repeatedSet||E,value:wa.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){q(e,[lg,Oa]);const t=_(e,e,Ee.schema({names:{blockName:lg,repeatedSet:Oa}}));K.assertSchema(t,this.className),Oa in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,s=>new wa({schema:s}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(this.valueBeforeDecode.byteLength===0)return new B({value:[new it({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=Ye(this.valueBeforeDecode);if(K.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof B))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof Ee){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,s]of this.typesAndValues.entries())if(s.isEqual(e.typesAndValues[t])===!1)return!1;return!0}return e instanceof ArrayBuffer?Ic(this.valueBeforeDecode,e):!1}}Ee.CLASS_NAME="RelativeDistinguishedNames";const ku="type",Iu="value";function fb(r={},e=!1){const t=f(r,"names",{});return new B({optional:e,value:[new T({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:t.country_name||E,value:[new je({value:[new yh,new rr]})]}),new T({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:t.administration_domain_name||E,value:[new je({value:[new yh,new rr]})]}),new ae({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:t.network_address||E,isHexOnly:!0}),new ae({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:t.terminal_identifier||E,isHexOnly:!0}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:t.private_domain_name||E,value:[new je({value:[new yh,new rr]})]}),new ae({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:t.organization_name||E,isHexOnly:!0}),new ae({optional:!0,name:t.numeric_user_identifier||E,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new T({optional:!0,name:t.personal_name||E,idBlock:{tagClass:3,tagNumber:5},value:[new ae({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new ae({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new ae({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new ae({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new T({optional:!0,name:t.organizational_unit_names||E,idBlock:{tagClass:3,tagNumber:6},value:[new ue({value:new rr})]})]})}function pb(r=!1){return new B({optional:r,value:[new rr,new rr]})}function db(r=!1){return new it({optional:r,value:[new ae({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ne]})]})}class ve extends J{constructor(e={}){super(),this.type=f(e,ku,ve.defaultValues(ku)),this.value=f(e,Iu,ve.defaultValues(Iu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ku:return 9;case Iu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ku:return t===ve.defaultValues(e);case Iu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new je({value:[new T({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||E,value:[new Z,new T({idBlock:{tagClass:3,tagNumber:0},value:[new ne]})]}),new ae({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:1}}),new ae({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:2}}),new T({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||E,value:[fb(t.builtInStandardAttributes||{},!1),pb(!0),db(!0)]}),new T({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||E,value:[Ee.schema(t.directoryName||{})]}),new T({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||E,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new je({value:[new Kf,new rr,new Hf,new tm,new Ff]})]}),new T({idBlock:{tagClass:3,tagNumber:1},value:[new je({value:[new Kf,new rr,new Hf,new tm,new Ff]})]})]}),new ae({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:6}}),new ae({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:7}}),new ae({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){q(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=_(e,e,ve.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(K.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=t.result.blockName;break;case 1:case 2:case 6:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=22;const a=s.toBER(!1),n=Ye(a);K.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value}break;case 3:this.value=t.result.blockName;break;case 4:this.value=new Ee({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new W({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=6;const a=s.toBER(!1),n=Ye(a);K.assert(n,"GeneralName registeredID"),this.value=n.result.valueBlock.toString()}break}}toSchema(){switch(this.type){case 0:case 3:case 5:return new T({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new _g({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new T({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new Z({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return ve.schema()}}toJSON(){const e={type:this.type,value:E};if(typeof this.value=="string")e.value=this.value;else try{e.value=this.value.toJSON()}catch(t){}return e}}ve.CLASS_NAME="GeneralName";const Cu="accessMethod",Bu="accessLocation",gb=[Cu,Bu];class Wn extends J{constructor(e={}){super(),this.accessMethod=f(e,Cu,Wn.defaultValues(Cu)),this.accessLocation=f(e,Bu,Wn.defaultValues(Bu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cu:return E;case Bu:return new ve;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.accessMethod||E}),ve.schema(t.accessLocation||{})]})}fromSchema(e){q(e,gb);const t=_(e,e,Wn.schema({names:{accessMethod:Cu,accessLocation:{names:{blockName:Bu}}}}));K.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new ve({schema:t.result.accessLocation})}toSchema(){return new B({value:[new Z({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}Wn.CLASS_NAME="AccessDescription";const kr="seconds",Ir="millis",Cr="micros";class ts extends J{constructor(e={}){super(),kr in e&&(this.seconds=f(e,kr,ts.defaultValues(kr))),Ir in e&&(this.millis=f(e,Ir,ts.defaultValues(Ir))),Cr in e&&(this.micros=f(e,Cr,ts.defaultValues(Cr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kr:case Ir:case Cr:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case kr:case Ir:case Cr:return t===ts.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,optional:!0,value:[new $({optional:!0,name:t.seconds||E}),new ae({name:t.millis||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new ae({name:t.micros||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){q(e,[kr,Ir,Cr]);const t=_(e,e,ts.schema({names:{seconds:kr,millis:Ir,micros:Cr}}));if(K.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const s=new $({valueHex:t.result.millis.valueBlock.valueHex});this.millis=s.valueBlock.valueDec}if("micros"in t.result){const s=new $({valueHex:t.result.micros.valueBlock.valueHex});this.micros=s.valueBlock.valueDec}}toSchema(){const e=[];if(this.seconds!==void 0&&e.push(new $({value:this.seconds})),this.millis!==void 0){const t=new $({value:this.millis});e.push(new ae({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(this.micros!==void 0){const t=new $({value:this.micros});e.push(new ae({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new B({value:e})}toJSON(){const e={};return this.seconds!==void 0&&(e.seconds=this.seconds),this.millis!==void 0&&(e.millis=this.millis),this.micros!==void 0&&(e.micros=this.micros),e}}ts.CLASS_NAME="Accuracy";const Wc="algorithmId",mu="algorithmParams",Mw="algorithm",Zf="params",wb=[Mw,Zf];class j extends J{constructor(e={}){super(),this.algorithmId=f(e,Wc,j.defaultValues(Wc)),mu in e&&(this.algorithmParams=f(e,mu,j.defaultValues(mu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wc:return E;case mu:return new ne;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wc:return t===E;case mu:return t instanceof ne;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,optional:t.optional||!1,value:[new Z({name:t.algorithmIdentifier||E}),new ne({name:t.algorithmParams||E,optional:!0})]})}fromSchema(e){q(e,wb);const t=_(e,e,j.schema({names:{algorithmIdentifier:Mw,algorithmParams:Zf}}));K.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),Zf in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new Z({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof ne)&&e.push(this.algorithmParams),new B({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof ne)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return!(e instanceof j)||this.algorithmId!==e.algorithmId?!1:this.algorithmParams?e.algorithmParams?JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!1:!e.algorithmParams}}j.CLASS_NAME="AlgorithmIdentifier";const gi="altNames",yb=[gi];class Xo extends J{constructor(e={}){super(),this.altNames=f(e,gi,Xo.defaultValues(gi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gi:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.altNames||E,value:ve.schema()})]})}fromSchema(e){q(e,yb);const t=_(e,e,Xo.schema({names:{altNames:gi}}));K.assertSchema(t,this.className),gi in t.result&&(this.altNames=Array.from(t.result.altNames,s=>new ve({schema:s})))}toSchema(){return new B({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}Xo.CLASS_NAME="AltName";const wi="type",yi="values",vb=[wi,yi];class Ve extends J{constructor(e={}){super(),this.type=f(e,wi,Ve.defaultValues(wi)),this.values=f(e,yi,Ve.defaultValues(yi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wi:return E;case yi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wi:return t===E;case yi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.type||E}),new it({name:t.setName||E,value:[new ue({name:t.values||E,value:new ne})]})]})}fromSchema(e){q(e,vb);const t=_(e,e,Ve.schema({names:{type:wi,values:yi}}));K.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new B({value:[new Z({value:this.type}),new it({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}Ve.CLASS_NAME="Attribute";const xu="notBeforeTime",Vu="notAfterTime",bb=[xu,Vu];class ks extends J{constructor(e={}){super(),this.notBeforeTime=f(e,xu,ks.defaultValues(xu)),this.notAfterTime=f(e,Vu,ks.defaultValues(Vu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xu:case Vu:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $e({name:t.notBeforeTime||E}),new $e({name:t.notAfterTime||E})]})}fromSchema(e){q(e,bb);const t=_(e,e,ks.schema({names:{notBeforeTime:xu,notAfterTime:Vu}}));K.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new B({value:[new $e({valueDate:this.notBeforeTime}),new $e({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}ks.CLASS_NAME="AttCertValidityPeriod";const fu="names",cg="generalNames";class ot extends J{constructor(e={}){super(),this.names=f(e,fu,ot.defaultValues(fu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"names":return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=f(e,fu,{});return new B({optional:t,name:s.blockName||E,value:[new ue({name:s.generalNames||E,value:ve.schema()})]})}fromSchema(e){q(e,[fu,cg]);const t=_(e,e,ot.schema({names:{blockName:fu,generalNames:cg}}));K.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,s=>new ve({schema:s}))}toSchema(){return new B({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}ot.CLASS_NAME="GeneralNames";const Ab="2.5.29.9",Sb="2.5.29.14",Nb="2.5.29.15",Eb="2.5.29.16",Kw="2.5.29.17",Hw="2.5.29.18",Lp="2.5.29.19",kb="2.5.29.20",Ib="2.5.29.27",Cb="2.5.29.21",Bb="2.5.29.24",Fw="2.5.29.28",Jw="2.5.29.29",qw="2.5.29.30",_w="2.5.29.31",Up="2.5.29.46",Ww="2.5.29.32",os="2.5.29.32.0",xb="1.3.6.1.4.1.311.21.10",Gw="2.5.29.33",jp="2.5.29.35",zw="2.5.29.36",Vb="2.5.29.37",Pb="2.5.29.54",$p="1.3.6.1.5.5.7.1.1",Ob="1.3.6.1.5.5.7.1.11",Db="1.3.6.1.4.1.11129.2.4.2",Tb="1.3.6.1.4.1.311.21.7",Rb="1.3.6.1.4.1.311.21.1",Lb="1.3.6.1.5.5.7.1.3",Mp="1.2.840.113549.1.7.1",Xw="1.2.840.113549.1.7.2",Yw="1.2.840.113549.1.7.3",Qw="1.2.840.113549.1.7.6",Ub="1.2.840.113549.1.9.16.1.4",hg="1.2.840.113549.1.9.22.1",jb="1.2.840.113549.1.9.22.2",mg="1.2.840.113549.1.9.22.3",fg="1.2.840.113549.1.9.23.1",$b="1.3.6.1.5.5.7",Mb="".concat($b,".48"),Sh="".concat(Mb,".1.1"),Ua="keyIdentifier",ja="authorityCertIssuer",$a="authorityCertSerialNumber",Kb=[Ua,ja,$a];class ya extends J{constructor(e={}){super(),Ua in e&&(this.keyIdentifier=f(e,Ua,ya.defaultValues(Ua))),ja in e&&(this.authorityCertIssuer=f(e,ja,ya.defaultValues(ja))),$a in e&&(this.authorityCertSerialNumber=f(e,$a,ya.defaultValues($a))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ua:return new W;case ja:return[];case $a:return new $;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ae({name:t.keyIdentifier||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ue({name:t.authorityCertIssuer||E,value:ve.schema()})]}),new ae({name:t.authorityCertSerialNumber||E,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){q(e,Kb);const t=_(e,e,ya.schema({names:{keyIdentifier:Ua,authorityCertIssuer:ja,authorityCertSerialNumber:$a}}));K.assertSchema(t,this.className),Ua in t.result&&(this.keyIdentifier=new W({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),ja in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,s=>new ve({schema:s}))),$a in t.result&&(this.authorityCertSerialNumber=new $({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new ae({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new ae({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new B({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}ya.CLASS_NAME="AuthorityKeyIdentifier";const Da="pathLenConstraint",Ta="cA";class Gn extends J{constructor(e={}){super(),this.cA=f(e,Ta,!1),Da in e&&(this.pathLenConstraint=f(e,Da,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ta:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Ba({optional:!0,name:t.cA||E}),new $({optional:!0,name:t.pathLenConstraint||E})]})}fromSchema(e){q(e,[Ta,Da]);const t=_(e,e,Gn.schema({names:{cA:Ta,pathLenConstraint:Da}}));K.assertSchema(t,this.className),Ta in t.result&&(this.cA=t.result.cA.valueBlock.value),Da in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==Gn.defaultValues(Ta)&&e.push(new Ba({value:this.cA})),Da in this&&(this.pathLenConstraint instanceof $?e.push(this.pathLenConstraint):e.push(new $({value:this.pathLenConstraint}))),new B({value:e})}toJSON(){const e={};return this.cA!==Gn.defaultValues(Ta)&&(e.cA=this.cA),Da in this&&(this.pathLenConstraint instanceof $?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}Gn.CLASS_NAME="BasicConstraints";const of="certificateIndex",uf="keyIndex";class xc extends J{constructor(e={}){super(),this.certificateIndex=f(e,of,xc.defaultValues(of)),this.keyIndex=f(e,uf,xc.defaultValues(uf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case of:case uf:return 0;default:return super.defaultValues(e)}}static schema(){return new $}fromSchema(e){if(e.constructor.blockName()!==$.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const s=new Uint8Array(t);switch(!0){case t.byteLength<4:{const d=new ArrayBuffer(4);new Uint8Array(d).set(s,4-t.byteLength),t=d.slice(0)}break;case t.byteLength>4:{const d=new ArrayBuffer(4);new Uint8Array(d).set(s.slice(0,4)),t=d.slice(0)}break}const a=t.slice(0,2),n=new Uint8Array(a);let i=n[0];n[0]=n[1],n[1]=i;const o=new Uint16Array(a);this.keyIndex=o[0];const u=t.slice(2),h=new Uint8Array(u);i=h[0],h[0]=h[1],h[1]=i;const l=new Uint16Array(u);this.certificateIndex=l[0]}toSchema(){const e=new ArrayBuffer(2),t=new Uint16Array(e);t[0]=this.certificateIndex;const s=new Uint8Array(e);let a=s[0];s[0]=s[1],s[1]=a;const n=new ArrayBuffer(2),i=new Uint16Array(n);i[0]=this.keyIndex;const o=new Uint8Array(n);return a=o[0],o[0]=o[1],o[1]=a,new $({valueHex:Ko(n,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}xc.CLASS_NAME="CAVersion";const Pu="policyQualifierId",Ou="qualifier",Hb=[Pu,Ou];class zn extends J{constructor(e={}){super(),this.policyQualifierId=f(e,Pu,zn.defaultValues(Pu)),this.qualifier=f(e,Ou,zn.defaultValues(Ou)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pu:return E;case Ou:return new ne;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.policyQualifierId||E}),new ne({name:t.qualifier||E})]})}fromSchema(e){q(e,Hb);const t=_(e,e,zn.schema({names:{policyQualifierId:Pu,qualifier:Ou}}));K.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new B({value:[new Z({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}zn.CLASS_NAME="PolicyQualifierInfo";const Du="policyIdentifier",Ma="policyQualifiers",Fb=[Du,Ma];class Xn extends J{constructor(e={}){super(),this.policyIdentifier=f(e,Du,Xn.defaultValues(Du)),Ma in e&&(this.policyQualifiers=f(e,Ma,Xn.defaultValues(Ma))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Du:return E;case Ma:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.policyIdentifier||E}),new B({optional:!0,value:[new ue({name:t.policyQualifiers||E,value:zn.schema()})]})]})}fromSchema(e){q(e,Fb);const t=_(e,e,Xn.schema({names:{policyIdentifier:Du,policyQualifiers:Ma}}));K.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),Ma in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,s=>new zn({schema:s})))}toSchema(){const e=[];return e.push(new Z({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new B({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new B({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}Xn.CLASS_NAME="PolicyInformation";const Tu="certificatePolicies",Jb=[Tu];class Yo extends J{constructor(e={}){super(),this.certificatePolicies=f(e,Tu,Yo.defaultValues(Tu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.certificatePolicies||E,value:Xn.schema()})]})}fromSchema(e){q(e,Jb);const t=_(e,e,Yo.schema({names:{certificatePolicies:Tu}}));K.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,s=>new Xn({schema:s}))}toSchema(){return new B({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}Yo.CLASS_NAME="CertificatePolicies";const Ru="templateID",Hs="templateMajorVersion",Fs="templateMinorVersion",qb=[Ru,Hs,Fs];class $o extends J{constructor(e={}){super(),this.templateID=f(e,Ru,$o.defaultValues(Ru)),Hs in e&&(this.templateMajorVersion=f(e,Hs,$o.defaultValues(Hs))),Fs in e&&(this.templateMinorVersion=f(e,Fs,$o.defaultValues(Fs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ru:return E;case Hs:case Fs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.templateID||E}),new $({name:t.templateMajorVersion||E,optional:!0}),new $({name:t.templateMinorVersion||E,optional:!0})]})}fromSchema(e){q(e,qb);const t=_(e,e,$o.schema({names:{templateID:Ru,templateMajorVersion:Hs,templateMinorVersion:Fs}}));K.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),Hs in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),Fs in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new Z({value:this.templateID})),Hs in this&&e.push(new $({value:this.templateMajorVersion})),Fs in this&&e.push(new $({value:this.templateMinorVersion})),new B({value:e})}toJSON(){const e={templateID:this.templateID};return Hs in this&&(e.templateMajorVersion=this.templateMajorVersion),Fs in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}const Ka="distributionPoint",Zw="distributionPointNames",Ha="reasons",Fa="cRLIssuer",ey="cRLIssuerNames",_b=[Ka,Zw,Ha,Fa,ey];class va extends J{constructor(e={}){super(),Ka in e&&(this.distributionPoint=f(e,Ka,va.defaultValues(Ka))),Ha in e&&(this.reasons=f(e,Ha,va.defaultValues(Ha))),Fa in e&&(this.cRLIssuer=f(e,Fa,va.defaultValues(Fa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ka:return[];case Ha:return new pe;case Fa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new je({value:[new T({name:t.distributionPoint||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.distributionPointNames||E,value:ve.schema()})]}),new T({name:t.distributionPoint||E,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Ee.schema().valueBlock.value})]})]}),new ae({name:t.reasons||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new T({name:t.cRLIssuer||E,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new ue({name:t.cRLIssuerNames||E,value:ve.schema()})]})]})}fromSchema(e){q(e,_b);const t=_(e,e,va.schema({names:{distributionPoint:Ka,distributionPointNames:Zw,reasons:Ha,cRLIssuer:Fa,cRLIssuerNames:ey}}));K.assertSchema(t,this.className),Ka in t.result&&(t.result.distributionPoint.idBlock.tagNumber===0&&(this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new ve({schema:s}))),t.result.distributionPoint.idBlock.tagNumber===1&&(this.distributionPoint=new Ee({schema:new B({value:t.result.distributionPoint.valueBlock.value})}))),Ha in t.result&&(this.reasons=new pe({valueHex:t.result.reasons.valueBlock.valueHex})),Fa in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,s=>new ve({schema:s})))}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new T({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):t=new T({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new ae({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new T({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new B({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}va.CLASS_NAME="DistributionPoint";const Lu="distributionPoints",Wb=[Lu];class Qo extends J{constructor(e={}){super(),this.distributionPoints=f(e,Lu,Qo.defaultValues(Lu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Lu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.distributionPoints||E,value:va.schema()})]})}fromSchema(e){q(e,Wb);const t=_(e,e,Qo.schema({names:{distributionPoints:Lu}}));K.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,s=>new va({schema:s}))}toSchema(){return new B({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}Qo.CLASS_NAME="CRLDistributionPoints";const Uu="keyPurposes",Gb=[Uu];class Vc extends J{constructor(e={}){super(),this.keyPurposes=f(e,Uu,Vc.defaultValues(Uu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.keyPurposes||E,value:new Z})]})}fromSchema(e){q(e,Gb);const t=_(e,e,Vc.schema({names:{keyPurposes:Uu}}));K.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,s=>s.valueBlock.toString())}toSchema(){return new B({value:Array.from(this.keyPurposes,e=>new Z({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}Vc.CLASS_NAME="ExtKeyUsage";const pu="accessDescriptions";class Zo extends J{constructor(e={}){super(),this.accessDescriptions=f(e,pu,Zo.defaultValues(pu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.accessDescriptions||E,value:Wn.schema()})]})}fromSchema(e){q(e,[pu]);const t=_(e,e,Zo.schema({names:{accessDescriptions:pu}}));K.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,s=>new Wn({schema:s}))}toSchema(){return new B({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}Zo.CLASS_NAME="InfoAccess";const Ja="distributionPoint",ty="distributionPointNames",Br="onlyContainsUserCerts",xr="onlyContainsCACerts",Vr="onlySomeReasons",Pr="indirectCRL",Or="onlyContainsAttributeCerts",zb=[Ja,ty,Br,xr,Vr,Pr,Or];class gt extends J{constructor(e={}){super(),Ja in e&&(this.distributionPoint=f(e,Ja,gt.defaultValues(Ja))),this.onlyContainsUserCerts=f(e,Br,gt.defaultValues(Br)),this.onlyContainsCACerts=f(e,xr,gt.defaultValues(xr)),Vr in e&&(this.onlySomeReasons=f(e,Vr,gt.defaultValues(Vr))),this.indirectCRL=f(e,Pr,gt.defaultValues(Pr)),this.onlyContainsAttributeCerts=f(e,Or,gt.defaultValues(Or)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ja:return[];case Br:return!1;case xr:return!1;case Vr:return 0;case Pr:return!1;case Or:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new je({value:[new T({name:t.distributionPoint||E,idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.distributionPointNames||E,value:ve.schema()})]}),new T({name:t.distributionPoint||E,idBlock:{tagClass:3,tagNumber:1},value:Ee.schema().valueBlock.value})]})]}),new ae({name:t.onlyContainsUserCerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new ae({name:t.onlyContainsCACerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new ae({name:t.onlySomeReasons||E,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new ae({name:t.indirectCRL||E,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new ae({name:t.onlyContainsAttributeCerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){q(e,zb);const t=_(e,e,gt.schema({names:{distributionPoint:Ja,distributionPointNames:ty,onlyContainsUserCerts:Br,onlyContainsCACerts:xr,onlySomeReasons:Vr,indirectCRL:Pr,onlyContainsAttributeCerts:Or}}));if(K.assertSchema(t,this.className),Ja in t.result)switch(!0){case t.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new ve({schema:s}));break;case t.result.distributionPoint.idBlock.tagNumber===1:this.distributionPoint=new Ee({schema:new B({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(Br in t.result){const s=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=s[0]!==0}if(xr in t.result){const s=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=s[0]!==0}if(Vr in t.result){const s=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=s[0]}if(Pr in t.result){const s=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=s[0]!==0}if(Or in t.result){const s=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=s[0]!==0}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new T({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==gt.defaultValues(Br)&&e.push(new ae({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==gt.defaultValues(xr)&&e.push(new ae({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),this.onlySomeReasons!==void 0){const t=new ArrayBuffer(1),s=new Uint8Array(t);s[0]=this.onlySomeReasons,e.push(new ae({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==gt.defaultValues(Pr)&&e.push(new ae({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==gt.defaultValues(Or)&&e.push(new ae({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new B({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==gt.defaultValues(Br)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==gt.defaultValues(xr)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),Vr in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==gt.defaultValues(Pr)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==gt.defaultValues(Or)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}gt.CLASS_NAME="IssuingDistributionPoint";const ju="base",vi="minimum",Dr="maximum",Xb=[ju,vi,Dr];class Rs extends J{constructor(e={}){super(),this.base=f(e,ju,Rs.defaultValues(ju)),this.minimum=f(e,vi,Rs.defaultValues(vi)),Dr in e&&(this.maximum=f(e,Dr,Rs.defaultValues(Dr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ju:return new ve;case vi:return 0;case Dr:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[ve.schema(t.base||{}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $({name:t.minimum||E})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new $({name:t.maximum||E})]})]})}fromSchema(e){q(e,Xb);const t=_(e,e,Rs.schema({names:{base:{names:{blockName:ju}},minimum:vi,maximum:Dr}}));K.assertSchema(t,this.className),this.base=new ve({schema:t.result.base}),vi in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),Dr in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),this.minimum!==0){let t=0;this.minimum instanceof $?t=this.minimum:t=new $({value:this.minimum}),e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(Dr in this){let t=0;this.maximum instanceof $?t=this.maximum:t=new $({value:this.maximum}),e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new B({value:e})}toJSON(){const e={base:this.base.toJSON()};return this.minimum!==0&&(typeof this.minimum=="number"?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),this.maximum!==void 0&&(typeof this.maximum=="number"?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}Rs.CLASS_NAME="GeneralSubtree";const qa="permittedSubtrees",_a="excludedSubtrees",Yb=[qa,_a];class Fo extends J{constructor(e={}){super(),qa in e&&(this.permittedSubtrees=f(e,qa,Fo.defaultValues(qa))),_a in e&&(this.excludedSubtrees=f(e,_a,Fo.defaultValues(_a))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qa:case _a:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.permittedSubtrees||E,value:Rs.schema()})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ue({name:t.excludedSubtrees||E,value:Rs.schema()})]})]})}fromSchema(e){q(e,Yb);const t=_(e,e,Fo.schema({names:{permittedSubtrees:qa,excludedSubtrees:_a}}));K.assertSchema(t,this.className),qa in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,s=>new Rs({schema:s}))),_a in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,s=>new Rs({schema:s})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new B({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}Fo.CLASS_NAME="NameConstraints";const Js="requireExplicitPolicy",qs="inhibitPolicyMapping",Qb=[Js,qs];class Jo extends J{constructor(e={}){super(),Js in e&&(this.requireExplicitPolicy=f(e,Js,Jo.defaultValues(Js))),qs in e&&(this.inhibitPolicyMapping=f(e,qs,Jo.defaultValues(qs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Js:return 0;case qs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ae({name:t.requireExplicitPolicy||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new ae({name:t.inhibitPolicyMapping||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){q(e,Qb);const t=_(e,e,Jo.schema({names:{requireExplicitPolicy:Js,inhibitPolicyMapping:qs}}));if(K.assertSchema(t,this.className),Js in t.result){const s=t.result.requireExplicitPolicy;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=Ye(a);K.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(qs in t.result){const s=t.result.inhibitPolicyMapping;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=Ye(a);K.assert(n,"Integer"),this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if(Js in this){const t=new $({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(qs in this){const t=new $({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new B({value:e})}toJSON(){const e={};return Js in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),qs in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}Jo.CLASS_NAME="PolicyConstraints";const $u="issuerDomainPolicy",Mu="subjectDomainPolicy",Zb=[$u,Mu];class Yn extends J{constructor(e={}){super(),this.issuerDomainPolicy=f(e,$u,Yn.defaultValues($u)),this.subjectDomainPolicy=f(e,Mu,Yn.defaultValues(Mu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $u:return E;case Mu:return E;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.issuerDomainPolicy||E}),new Z({name:t.subjectDomainPolicy||E})]})}fromSchema(e){q(e,Zb);const t=_(e,e,Yn.schema({names:{issuerDomainPolicy:$u,subjectDomainPolicy:Mu}}));K.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new B({value:[new Z({value:this.issuerDomainPolicy}),new Z({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}Yn.CLASS_NAME="PolicyMapping";const Ku="mappings",eA=[Ku];class Pc extends J{constructor(e={}){super(),this.mappings=f(e,Ku,Pc.defaultValues(Ku)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ku:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.mappings||E,value:Yn.schema()})]})}fromSchema(e){q(e,eA);const t=_(e,e,Pc.schema({names:{mappings:Ku}}));K.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,s=>new Yn({schema:s}))}toSchema(){return new B({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}Pc.CLASS_NAME="PolicyMappings";const Tr="notBefore",Rr="notAfter",tA=[Tr,Rr];class qo extends J{constructor(e={}){super(),Tr in e&&(this.notBefore=f(e,Tr,qo.defaultValues(Tr))),Rr in e&&(this.notAfter=f(e,Rr,qo.defaultValues(Rr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tr:return new Date;case Rr:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ae({name:t.notBefore||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new ae({name:t.notAfter||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){q(e,tA);const t=_(e,e,qo.schema({names:{notBefore:Tr,notAfter:Rr}}));if(K.assertSchema(t,this.className),Tr in t.result){const s=new $e;s.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=s.toDate()}if(Rr in t.result){const s=new $e({valueHex:t.result.notAfter.valueBlock.valueHex});s.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=s.toDate()}}toSchema(){const e=[];return Tr in this&&e.push(new ae({idBlock:{tagClass:3,tagNumber:0},valueHex:new $e({valueDate:this.notBefore}).valueBlock.valueHexView})),Rr in this&&e.push(new ae({idBlock:{tagClass:3,tagNumber:1},valueHex:new $e({valueDate:this.notAfter}).valueBlock.valueHexView})),new B({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}qo.CLASS_NAME="PrivateKeyUsagePeriod";const bi="id",_s="type",Ai="values",sA=[bi,_s],rA=[Ai];class Qn extends J{constructor(e={}){super(),this.id=f(e,bi,Qn.defaultValues(bi)),_s in e&&(this.type=f(e,_s,Qn.defaultValues(_s))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bi:return E;case _s:return new nt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bi:return t===E;case _s:return t instanceof nt;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.id||E}),new ne({name:t.type||E,optional:!0})]})}fromSchema(e){q(e,sA);const t=_(e,e,Qn.schema({names:{id:bi,type:_s}}));K.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),_s in t.result&&(this.type=t.result.type)}toSchema(){const e=[new Z({value:this.id})];return _s in this&&e.push(this.type),new B({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}Qn.CLASS_NAME="QCStatement";class Oc extends J{constructor(e={}){super(),this.values=f(e,Ai,Oc.defaultValues(Ai)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ai:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ai:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.values||E,value:Qn.schema(t.value||{})})]})}fromSchema(e){q(e,rA);const t=_(e,e,Oc.schema({names:{values:Ai}}));K.assertSchema(t,this.className),this.values=Array.from(t.result.values,s=>new Qn({schema:s}))}toSchema(){return new B({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}Oc.CLASS_NAME="QCStatements";var Ra;class Ea{static register(e,t,s){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:s}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}Ra=Ea,Ea.namedCurves={},Ra.register("P-256","1.2.840.10045.3.1.7",32),Ra.register("P-384","1.3.132.0.34",48),Ra.register("P-521","1.3.132.0.35",66),Ra.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),Ra.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),Ra.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const Gc="x",zc="y",Xc="namedCurve";class Kt extends J{constructor(e={}){super(),this.x=f(e,Gc,Kt.defaultValues(Gc)),this.y=f(e,zc,Kt.defaultValues(zc)),this.namedCurve=f(e,Xc,Kt.defaultValues(Xc)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gc:case zc:return Qe;case Xc:return E;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Gc:case zc:return t instanceof ArrayBuffer&&Ic(t,Kt.defaultValues(e));case Xc:return typeof t=="string"&&t===Kt.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new em}fromSchema(e){const t=xe.toUint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");const s=Ea.find(this.namedCurve);if(!s)throw new Error("Incorrect curve OID: ".concat(this.namedCurve));const a=s.size;if(t.byteLength!==a*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=s.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,a*2+1).buffer}toSchema(){return new em({data:Ko(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=Ea.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:$f(Zh(this.x),!0,!0,!1),y:$f(Zh(this.y),!0,!0,!1)}}fromJSON(e){ge.assert("json",e,"crv","x","y");let t=0;const s=Ea.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=Go(kc(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const i=new Uint8Array(this.x),o=new Uint8Array(a);i.set(o,1)}else this.x=a.slice(0,t);const n=Go(kc(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const i=new Uint8Array(this.y),o=new Uint8Array(n);i.set(o,1)}else this.y=n.slice(0,t)}}Kt.CLASS_NAME="ECPublicKey";const Hu="modulus",Fu="publicExponent",aA=[Hu,Fu];class Zn extends J{constructor(e={}){super(),this.modulus=f(e,Hu,Zn.defaultValues(Hu)),this.publicExponent=f(e,Fu,Zn.defaultValues(Fu)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hu:return new $;case Fu:return new $;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.modulus||E}),new $({name:t.publicExponent||E})]})}fromSchema(e){q(e,aA);const t=_(e,e,Zn.schema({names:{modulus:Hu,publicExponent:Fu}}));K.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new B({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:Ae.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ae.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){ge.assert("json",e,"n","e");const t=Go(kc(e.n,!0));this.modulus=new $({valueHex:t.slice(0,Math.pow(2,jy(t.byteLength)))}),this.publicExponent=new $({valueHex:Go(kc(e.e,!0)).slice(0,3)})}}Zn.CLASS_NAME="RSAPublicKey";const Ju="algorithm",qu="subjectPublicKey",nA=[Ju,qu];class Jt extends J{get parsedKey(){if(this._parsedKey===void 0){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===Z.blockName())try{this._parsedKey=new Kt({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":{const e=Ye(this.subjectPublicKey.valueBlock.valueHexView);if(e.offset!==-1)try{this._parsedKey=new Zn({schema:e.result})}catch(t){}}break}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=f(e,Ju,Jt.defaultValues(Ju)),this.subjectPublicKey=f(e,qu,Jt.defaultValues(qu));const t=f(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ju:return new j;case qu:return new pe;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[j.schema(t.algorithm||{}),new pe({name:t.subjectPublicKey||E})]})}fromSchema(e){q(e,nA);const t=_(e,e,Jt.schema({names:{algorithm:{names:{blockName:Ju}},subjectPublicKey:qu}}));K.assertSchema(t,this.className),this.algorithm=new j({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new B({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Kt({json:e}),this.algorithm=new j({algorithmId:"1.2.840.10045.2.1",algorithmParams:new Z({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Zn({json:e}),this.algorithm=new j({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new nt});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.subjectPublicKey=new pe({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=ce(!0)){try{if(!e)throw new Error("Need to provide publicKey input parameter");const s=await t.exportKey("spki",e),a=Ye(s);try{this.fromSchema(a.result)}catch(n){throw new Error("Error during initializing object from schema")}}catch(s){const a=s instanceof Error?s.message:"".concat(s);throw new Error("Error during exporting public key: ".concat(a))}}}Jt.CLASS_NAME="PublicKeyInfo";const Si="version",Ni="privateKey",ws="namedCurve",Lr="publicKey",iA=[Si,Ni,ws,Lr];class ls extends J{constructor(e={}){super(),this.version=f(e,Si,ls.defaultValues(Si)),this.privateKey=f(e,Ni,ls.defaultValues(Ni)),ws in e&&(this.namedCurve=f(e,ws,ls.defaultValues(ws))),Lr in e&&(this.publicKey=f(e,Lr,ls.defaultValues(Lr))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Si:return 1;case Ni:return new W;case ws:return E;case Lr:return new Kt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Si:return t===ls.defaultValues(e);case Ni:return t.isEqual(ls.defaultValues(e));case ws:return t===E;case Lr:return Kt.compareWithDefault(ws,t.namedCurve)&&Kt.compareWithDefault("x",t.x)&&Kt.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),new W({name:t.privateKey||E}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.namedCurve||E})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new pe({name:t.publicKey||E})]})]})}fromSchema(e){q(e,iA);const t=_(e,e,ls.schema({names:{version:Si,privateKey:Ni,namedCurve:ws,publicKey:Lr}}));if(K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,ws in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),Lr in t.result){const s={schema:t.result.publicKey.valueBlock.valueHex};ws in this&&(s.namedCurve=this.namedCurve),this.publicKey=new Kt(s)}}toSchema(){const e=[new $({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[new Z({value:this.namedCurve})]})),this.publicKey&&e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[new pe({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new B({value:e})}toJSON(){if(!this.namedCurve||ls.compareWithDefault(ws,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=Ea.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:Ae.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const s=this.publicKey.toJSON();t.x=s.x,t.y=s.y}return t}fromJSON(e){ge.assert("json",e,"crv","d");let t=0;const s=Ea.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=Ae.FromBase64Url(e.d);if(a.byteLength<t){const n=new ArrayBuffer(t),i=new Uint8Array(n),o=new Uint8Array(a);i.set(o,1),this.privateKey=new W({valueHex:n})}else this.privateKey=new W({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new Kt({json:e}))}}ls.CLASS_NAME="ECPrivateKey";const _u="prime",Wu="exponent",Gu="coefficient",oA=[_u,Wu,Gu];class ar extends J{constructor(e={}){super(),this.prime=f(e,_u,ar.defaultValues(_u)),this.exponent=f(e,Wu,ar.defaultValues(Wu)),this.coefficient=f(e,Gu,ar.defaultValues(Gu)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _u:return new $;case Wu:return new $;case Gu:return new $;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.prime||E}),new $({name:t.exponent||E}),new $({name:t.coefficient||E})]})}fromSchema(e){q(e,oA);const t=_(e,e,ar.schema({names:{prime:_u,exponent:Wu,coefficient:Gu}}));K.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new B({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:Ae.ToBase64Url(this.prime.valueBlock.valueHexView),d:Ae.ToBase64Url(this.exponent.valueBlock.valueHexView),t:Ae.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){ge.assert("json",e,"r","d","r"),this.prime=new $({valueHex:Ae.FromBase64Url(e.r)}),this.exponent=new $({valueHex:Ae.FromBase64Url(e.d)}),this.coefficient=new $({valueHex:Ae.FromBase64Url(e.t)})}}ar.CLASS_NAME="OtherPrimeInfo";const zu="version",Xu="modulus",Yu="publicExponent",Qu="privateExponent",Zu="prime1",el="prime2",tl="exponent1",sl="exponent2",rl="coefficient",Wa="otherPrimeInfos",uA=[zu,Xu,Yu,Qu,Zu,el,tl,sl,rl,Wa];class Lt extends J{constructor(e={}){super(),this.version=f(e,zu,Lt.defaultValues(zu)),this.modulus=f(e,Xu,Lt.defaultValues(Xu)),this.publicExponent=f(e,Yu,Lt.defaultValues(Yu)),this.privateExponent=f(e,Qu,Lt.defaultValues(Qu)),this.prime1=f(e,Zu,Lt.defaultValues(Zu)),this.prime2=f(e,el,Lt.defaultValues(el)),this.exponent1=f(e,tl,Lt.defaultValues(tl)),this.exponent2=f(e,sl,Lt.defaultValues(sl)),this.coefficient=f(e,rl,Lt.defaultValues(rl)),Wa in e&&(this.otherPrimeInfos=f(e,Wa,Lt.defaultValues(Wa))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zu:return 0;case Xu:return new $;case Yu:return new $;case Qu:return new $;case Zu:return new $;case el:return new $;case tl:return new $;case sl:return new $;case rl:return new $;case Wa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),new $({name:t.modulus||E}),new $({name:t.publicExponent||E}),new $({name:t.privateExponent||E}),new $({name:t.prime1||E}),new $({name:t.prime2||E}),new $({name:t.exponent1||E}),new $({name:t.exponent2||E}),new $({name:t.coefficient||E}),new B({optional:!0,value:[new ue({name:t.otherPrimeInfosName||E,value:ar.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){q(e,uA);const t=_(e,e,Lt.schema({names:{version:zu,modulus:Xu,publicExponent:Yu,privateExponent:Qu,prime1:Zu,prime2:el,exponent1:tl,exponent2:sl,coefficient:rl,otherPrimeInfo:{names:{blockName:Wa}}}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),Wa in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,s=>new ar({schema:s})))}toSchema(){const e=[];return e.push(new $({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new B({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new B({value:e})}toJSON(){const e={n:Ae.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ae.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:Ae.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:Ae.ToBase64Url(this.prime1.valueBlock.valueHexView),q:Ae.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:Ae.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:Ae.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:Ae.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){ge.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new $({valueHex:Ae.FromBase64Url(e.n)}),this.publicExponent=new $({valueHex:Ae.FromBase64Url(e.e)}),this.privateExponent=new $({valueHex:Ae.FromBase64Url(e.d)}),this.prime1=new $({valueHex:Ae.FromBase64Url(e.p)}),this.prime2=new $({valueHex:Ae.FromBase64Url(e.q)}),this.exponent1=new $({valueHex:Ae.FromBase64Url(e.dp)}),this.exponent2=new $({valueHex:Ae.FromBase64Url(e.dq)}),this.coefficient=new $({valueHex:Ae.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new ar({json:t})))}}Lt.CLASS_NAME="RSAPrivateKey";const al="version",nl="privateKeyAlgorithm",il="privateKey",Ga="attributes",Yc="parsedKey",lA=[al,nl,il,Ga];class hs extends J{constructor(e={}){super(),this.version=f(e,al,hs.defaultValues(al)),this.privateKeyAlgorithm=f(e,nl,hs.defaultValues(nl)),this.privateKey=f(e,il,hs.defaultValues(il)),Ga in e&&(this.attributes=f(e,Ga,hs.defaultValues(Ga))),Yc in e&&(this.parsedKey=f(e,Yc,hs.defaultValues(Yc))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case al:return 0;case nl:return new j;case il:return new W;case Ga:return[];case Yc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),j.schema(t.privateKeyAlgorithm||{}),new W({name:t.privateKey||E}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.attributes||E,value:Ve.schema()})]})]})}fromSchema(e){q(e,lA);const t=_(e,e,hs.schema({names:{version:al,privateKeyAlgorithm:{names:{blockName:nl}},privateKey:il,attributes:Ga}}));switch(K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new j({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,Ga in t.result&&(this.attributes=Array.from(t.result.attributes,s=>new Ve({schema:s}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const s=Ye(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new Lt({schema:s.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof Z){const s=Ye(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new ls({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:s.result}))}break}}toSchema(){const e=[new $({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new B({value:e})}toJSON(){if(!this.parsedKey){const s={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(s.attributes=Array.from(this.attributes,a=>a.toJSON())),s}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new ls({json:e}),this.privateKeyAlgorithm=new j({algorithmId:"1.2.840.10045.2.1",algorithmParams:new Z({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Lt({json:e}),this.privateKeyAlgorithm=new j({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new nt});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.privateKey=new W({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}hs.CLASS_NAME="PrivateKeyInfo";const Ei="contentType",ki="contentEncryptionAlgorithm",za="encryptedContent",cA=[Ei,ki,za],pg=1024;class We extends J{constructor(e={}){if(super(),this.contentType=f(e,Ei,We.defaultValues(Ei)),this.contentEncryptionAlgorithm=f(e,ki,We.defaultValues(ki)),za in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4&&this.encryptedContent.idBlock.isConstructed===!1&&!e.disableSplit)){const t=new W({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,s,s+pg>a.byteLength?a.byteLength-s:pg),o=new ArrayBuffer(i.length),u=new Uint8Array(o);for(let h=0;h<u.length;h++)u[h]=i[h];t.valueBlock.value.push(new W({valueHex:o})),n-=i.length,s+=i.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ei:return E;case ki:return new j;case za:return new W;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ei:return t===E;case ki:return t.algorithmId===E&&!("algorithmParams"in t);case za:return t.isEqual(We.defaultValues(za));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.contentType||E}),j.schema(t.contentEncryptionAlgorithm||{}),new je({value:[new T({name:t.encryptedContent||E,idBlock:{tagClass:3,tagNumber:0},value:[new ue({value:new W})]}),new ae({name:t.encryptedContent||E,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){q(e,cA);const t=_(e,e,We.schema({names:{contentType:Ei,contentEncryptionAlgorithm:{names:{blockName:ki}},encryptedContent:za}}));K.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new j({schema:t.result.contentEncryptionAlgorithm}),za in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new Z({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const s=this.encryptedContent;s.idBlock.tagClass=3,s.idBlock.tagNumber=0,s.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(s)}return new B({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return W.prototype.getValue.call(this.encryptedContent)}}We.CLASS_NAME="EncryptedContentInfo";const Ur="hashAlgorithm",jr="maskGenAlgorithm",$r="saltLength",Mr="trailerField",hA=[Ur,jr,$r,Mr];class yt extends J{constructor(e={}){super(),this.hashAlgorithm=f(e,Ur,yt.defaultValues(Ur)),this.maskGenAlgorithm=f(e,jr,yt.defaultValues(jr)),this.saltLength=f(e,$r,yt.defaultValues($r)),this.trailerField=f(e,Mr,yt.defaultValues(Mr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ur:return new j({algorithmId:"1.3.14.3.2.26",algorithmParams:new nt});case jr:return new j({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new j({algorithmId:"1.3.14.3.2.26",algorithmParams:new nt}).toSchema()});case $r:return 20;case Mr:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new T({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[j.schema(t.hashAlgorithm||{})]}),new T({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[j.schema(t.maskGenAlgorithm||{})]}),new T({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new $({name:t.saltLength||E})]}),new T({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new $({name:t.trailerField||E})]})]})}fromSchema(e){q(e,hA);const t=_(e,e,yt.schema({names:{hashAlgorithm:{names:{blockName:Ur}},maskGenAlgorithm:{names:{blockName:jr}},saltLength:$r,trailerField:Mr}}));K.assertSchema(t,this.className),Ur in t.result&&(this.hashAlgorithm=new j({schema:t.result.hashAlgorithm})),jr in t.result&&(this.maskGenAlgorithm=new j({schema:t.result.maskGenAlgorithm})),$r in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),Mr in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(yt.defaultValues(Ur))||e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(yt.defaultValues(jr))||e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==yt.defaultValues($r)&&e.push(new T({idBlock:{tagClass:3,tagNumber:2},value:[new $({value:this.saltLength})]})),this.trailerField!==yt.defaultValues(Mr)&&e.push(new T({idBlock:{tagClass:3,tagNumber:3},value:[new $({value:this.trailerField})]})),new B({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(yt.defaultValues(Ur))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(yt.defaultValues(jr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==yt.defaultValues($r)&&(e.saltLength=this.saltLength),this.trailerField!==yt.defaultValues(Mr)&&(e.trailerField=this.trailerField),e}}yt.CLASS_NAME="RSASSAPSSParams";const Ii="salt",ol="iterationCount",ys="keyLength",Ws="prf",mA=[Ii,ol,ys,Ws];class Ot extends J{constructor(e={}){super(),this.salt=f(e,Ii,Ot.defaultValues(Ii)),this.iterationCount=f(e,ol,Ot.defaultValues(ol)),ys in e&&(this.keyLength=f(e,ys,Ot.defaultValues(ys))),Ws in e&&(this.prf=f(e,Ws,Ot.defaultValues(Ws))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ii:return{};case ol:return-1;case ys:return 0;case Ws:return new j({algorithmId:"1.3.14.3.2.26",algorithmParams:new nt});default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new je({value:[new W({name:t.saltPrimitive||E}),j.schema(t.saltConstructed||{})]}),new $({name:t.iterationCount||E}),new $({name:t.keyLength||E,optional:!0}),j.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){q(e,mA);const t=_(e,e,Ot.schema({names:{saltPrimitive:Ii,saltConstructed:{names:{blockName:Ii}},iterationCount:ol,keyLength:ys,prf:{names:{blockName:Ws,optional:!0}}}}));K.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,ys in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),Ws in t.result&&(this.prf=new j({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new $({value:this.iterationCount})),ys in this&&Ot.defaultValues(ys)!==this.keyLength&&e.push(new $({value:this.keyLength})),this.prf&&Ot.defaultValues(Ws).isEqual(this.prf)===!1&&e.push(this.prf.toSchema()),new B({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return ys in this&&Ot.defaultValues(ys)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&Ot.defaultValues(Ws).isEqual(this.prf)===!1&&(e.prf=this.prf.toJSON()),e}}Ot.CLASS_NAME="PBKDF2Params";const ul="keyDerivationFunc",ll="encryptionScheme",fA=[ul,ll];class ei extends J{constructor(e={}){super(),this.keyDerivationFunc=f(e,ul,ei.defaultValues(ul)),this.encryptionScheme=f(e,ll,ei.defaultValues(ll)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ul:return new j;case ll:return new j;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[j.schema(t.keyDerivationFunc||{}),j.schema(t.encryptionScheme||{})]})}fromSchema(e){q(e,fA);const t=_(e,e,ei.schema({names:{keyDerivationFunc:{names:{blockName:ul}},encryptionScheme:{names:{blockName:ll}}}}));K.assertSchema(t,this.className),this.keyDerivationFunc=new j({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new j({schema:t.result.encryptionScheme})}toSchema(){return new B({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}ei.CLASS_NAME="PBES2Params";class pA{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=f(e,"name",E)}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){return this.crypto.getRandomValues(e)}}async function dg(r,e,t,s,a){let n,i,o;switch(r.toUpperCase()){case"SHA-1":n=20,i=64,o=Uv;break;case"SHA-256":n=32,i=64,o=Mv;break;case"SHA-384":n=48,i=128,o=mb;break;case"SHA-512":n=64,i=128,o=hb;break;default:throw new Error("Unsupported hashing algorithm")}const u=new Uint8Array(t);let h=new TextDecoder().decode(t);new TextEncoder().encode(h).some((k,C)=>k!==u[C])&&(h=String.fromCharCode(...u));const l=new Uint8Array(h.length*2+2),d=new DataView(l.buffer);for(let k=0;k<h.length;k++)d.setUint16(k*2,h.charCodeAt(k),!1);d.setUint16(h.length*2,0,!1);const m=new Uint8Array(i).fill(3),N=new Uint8Array(s),y=new Uint8Array(i*Math.ceil(N.length/i)).map((k,C)=>N[C%N.length]),w=new Uint8Array(i*Math.ceil(l.length/i)).map((k,C)=>l[C%l.length]);let g=new Uint8Array(y.length+w.length);g.set(y),g.set(w,y.length);const S=Math.ceil((e>>3)/n),A=[];for(let k=0;k<S;k++){let C=new Uint8Array(m.length+g.length);C.set(m),C.set(g,m.length);for(let H=0;H<a;H++)C=o(C);const V=new Uint8Array(i).map((H,x)=>C[x%C.length]),M=Math.ceil(N.length/i)+Math.ceil(l.length/i),U=[];for(let H=0;H<M;H++){const x=Array.from(g.slice(H*i,(H+1)*i));let Y=511;for(let ee=V.length-1;ee>=0;ee--)Y>>=8,Y+=V[ee]+(x[ee]||0),x[ee]=Y&255;U.push(...x)}g=new Uint8Array(U),A.push(...C)}return new Uint8Array(A.slice(0,e>>3)).buffer}function sy(r){const e=typeof r=="string"?{name:r}:r;return"hash"in e?xs(It({},e),{hash:sy(e.hash)}):e}class Dc extends pA{async importKey(e,t,s,a,n){var i,o,u,h,l,d;let m={};const N=sy(s);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,s,a,n);case"spki":{const y=Ye(xe.toArrayBuffer(t));K.assert(y,"keyData");const w=new Jt;try{w.fromSchema(y.result)}catch(g){throw new Ne("Incorrect keyData")}switch(N.name.toUpperCase()){case"RSA-PSS":{if(!N.hash)throw new ge("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(N.hash.name.toUpperCase()){case"SHA-1":m.alg="PS1";break;case"SHA-256":m.alg="PS256";break;case"SHA-384":m.alg="PS384";break;case"SHA-512":m.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(N.hash.name.toUpperCase()))}}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],m.kty="RSA",m.ext=a,m.key_ops=n,w.algorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect public key algorithm: ".concat(w.algorithm.algorithmId));if(!m.alg){if(!N.hash)throw new ge("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(N.hash.name.toUpperCase()){case"SHA-1":m.alg="RS1";break;case"SHA-256":m.alg="RS256";break;case"SHA-384":m.alg="RS384";break;case"SHA-512":m.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(N.hash.name.toUpperCase()))}}const g=w.toJSON();Object.assign(m,g)}break;case"ECDSA":n=["verify"];case"ECDH":{if(m={kty:"EC",ext:a,key_ops:n},w.algorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect public key algorithm: ".concat(w.algorithm.algorithmId));const g=w.toJSON();Object.assign(m,g)}break;case"RSA-OAEP":{if(m.kty="RSA",m.ext=a,m.key_ops=n,this.name.toLowerCase()==="safari")m.alg="RSA-OAEP";else{if(!N.hash)throw new ge("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(N.hash.name.toUpperCase()){case"SHA-1":m.alg="RSA-OAEP";break;case"SHA-256":m.alg="RSA-OAEP-256";break;case"SHA-384":m.alg="RSA-OAEP-384";break;case"SHA-512":m.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat(N.hash.name.toUpperCase()))}}const g=w.toJSON();Object.assign(m,g)}break;case"RSAES-PKCS1-V1_5":{m.kty="RSA",m.ext=a,m.key_ops=n,m.alg="PS1";const g=w.toJSON();Object.assign(m,g)}break;default:throw new Error("Incorrect algorithm name: ".concat(N.name.toUpperCase()))}}break;case"pkcs8":{const y=new hs,w=Ye(xe.toArrayBuffer(t));K.assert(w,"keyData");try{y.fromSchema(w.result)}catch(g){throw new Error("Incorrect keyData")}if(!y.parsedKey)throw new Error("Incorrect keyData");switch(N.name.toUpperCase()){case"RSA-PSS":switch((i=N.hash)===null||i===void 0?void 0:i.name.toUpperCase()){case"SHA-1":m.alg="PS1";break;case"SHA-256":m.alg="PS256";break;case"SHA-384":m.alg="PS384";break;case"SHA-512":m.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((o=N.hash)===null||o===void 0?void 0:o.name.toUpperCase()))}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],m.kty="RSA",m.ext=a,m.key_ops=n,y.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect private key algorithm: ".concat(y.privateKeyAlgorithm.algorithmId));if(!("alg"in m))switch((u=N.hash)===null||u===void 0?void 0:u.name.toUpperCase()){case"SHA-1":m.alg="RS1";break;case"SHA-256":m.alg="RS256";break;case"SHA-384":m.alg="RS384";break;case"SHA-512":m.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((h=N.hash)===null||h===void 0?void 0:h.name.toUpperCase()))}const g=y.toJSON();Object.assign(m,g)}break;case"ECDSA":n=["sign"];case"ECDH":{if(m={kty:"EC",ext:a,key_ops:n},y.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect algorithm: ".concat(y.privateKeyAlgorithm.algorithmId));const g=y.toJSON();Object.assign(m,g)}break;case"RSA-OAEP":{if(m.kty="RSA",m.ext=a,m.key_ops=n,this.name.toLowerCase()==="safari")m.alg="RSA-OAEP";else switch((l=N.hash)===null||l===void 0?void 0:l.name.toUpperCase()){case"SHA-1":m.alg="RSA-OAEP";break;case"SHA-256":m.alg="RSA-OAEP-256";break;case"SHA-384":m.alg="RSA-OAEP-384";break;case"SHA-512":m.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat((d=N.hash)===null||d===void 0?void 0:d.name.toUpperCase()))}const g=y.toJSON();Object.assign(m,g)}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],m.kty="RSA",m.ext=a,m.key_ops=n,m.alg="PS1";const g=y.toJSON();Object.assign(m,g)}break;default:throw new Error("Incorrect algorithm name: ".concat(N.name.toUpperCase()))}}break;case"jwk":m=t;break;default:throw new Error("Incorrect format: ".concat(e))}if(this.name.toLowerCase()==="safari")try{return this.subtle.importKey("jwk",Go(JSON.stringify(m)),s,a,n)}catch(y){return this.subtle.importKey("jwk",m,s,a,n)}return this.subtle.importKey("jwk",m,s,a,n)}async exportKey(e,t){let s=await this.subtle.exportKey("jwk",t);switch(this.name.toLowerCase()==="safari"&&s instanceof ArrayBuffer&&(s=JSON.parse(Zh(s))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{const a=new Jt;try{a.fromJSON(s)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new hs;try{a.fromJSON(s)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return s;default:throw new Error("Incorrect format: ".concat(e))}}async convert(e,t,s,a,n,i){if(e.toLowerCase()===t.toLowerCase())return s;const o=await this.importKey(e,s,a,n,i);return this.exportKey(t,o)}getAlgorithmByOID(e,t=!1,s){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error("Unsupported algorithm identifier ".concat(s?"for ".concat(s," "):E,": ").concat(e));return{}}getOIDByAlgorithm(e,t=!1,s){let a=E;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11";break}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35";break}if(!a&&t)throw new Error("Unsupported algorithm ".concat(s?"for ".concat(s," "):E,": ").concat(e.name));return a}getAlgorithmParameters(e,t){let s={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":s={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":s={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":s={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":s={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":s={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":s={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":s={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":s={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return s}getHashAlgorithm(e){let t=E;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const s=new yt({schema:e.algorithmParams});if(s.hashAlgorithm){const a=this.getAlgorithmByOID(s.hashAlgorithm.algorithmId);if("name"in a)t=a.name;else return E}else t="SHA-1"}catch(s){}break}return t}async encryptEncryptedContentInfo(e){ge.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),s=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),n=new ArrayBuffer(16),i=new Uint8Array(n);this.getRandomValues(i);const o=new ArrayBuffer(64),u=new Uint8Array(o);this.getRandomValues(u);const h=new Uint8Array(e.contentToEncrypt),l=new Ot({salt:new W({valueHex:o}),iterationCount:e.iterationCount,prf:new j({algorithmId:a,algorithmParams:new nt})}),d=new Uint8Array(e.password),m=await this.importKey("raw",d,"PBKDF2",!1,["deriveKey"]),N=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:u,iterations:e.iterationCount},m,e.contentEncryptionAlgorithm,!1,["encrypt"]),y=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:i},N,h),w=new ei({keyDerivationFunc:new j({algorithmId:s,algorithmParams:l.toSchema()}),encryptionScheme:new j({algorithmId:t,algorithmParams:new W({valueHex:n})})});return new We({contentType:e.contentType,contentEncryptionAlgorithm:new j({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:w.toSchema()}),encryptedContent:new W({valueHex:y})})}async decryptEncryptedContentInfo(e){if(ge.assert(e,"password","encryptedContentInfo"),e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")throw new Error('Unknown "contentEncryptionAlgorithm": '.concat(e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId));let t;try{t=new ei({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(y){throw new Error('Incorrectly encoded "pbes2Parameters"')}let s;try{s=new Ot({schema:t.keyDerivationFunc.algorithmParams})}catch(y){throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),n=t.encryptionScheme.algorithmParams.valueBlock.valueHex,i=new Uint8Array(n),o=s.salt.valueBlock.valueHex,u=new Uint8Array(o),h=s.iterationCount;let l="SHA-1";s.prf&&(l=this.getAlgorithmByOID(s.prf.algorithmId,!0).hash.name);const d=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),m=await this.deriveKey({name:"PBKDF2",hash:{name:l},salt:u,iterations:h},d,a,!1,["decrypt"]),N=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:i},m,N)}async stampDataWithPassword(e){if(!(e instanceof Object))throw new Error('Parameters must have type "Object"');ge.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp");let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await dg(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["sign"]);return this.sign(s,n,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){ge.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await dg(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["verify"]);return this.verify(s,n,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");const s=new j,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const n=a.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?n.hash.name=e.algorithm.hash.name:n.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":s.algorithmId=this.getOIDByAlgorithm(n,!0);break;case"RSA-PSS":{switch(n.hash.name.toUpperCase()){case"SHA-256":n.saltLength=32;break;case"SHA-384":n.saltLength=48;break;case"SHA-512":n.saltLength=64;break}const i={};if(n.hash.name.toUpperCase()!=="SHA-1"){const u=this.getOIDByAlgorithm({name:n.hash.name},!0,"hashAlgorithm");i.hashAlgorithm=new j({algorithmId:u,algorithmParams:new nt}),i.maskGenAlgorithm=new j({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:i.hashAlgorithm.toSchema()})}n.saltLength!==20&&(i.saltLength=n.saltLength);const o=new yt(i);s.algorithmId="1.2.840.113549.1.1.10",s.algorithmParams=o.toSchema()}break;default:throw new Error("Unsupported signature algorithm: ".concat(e.algorithm.name))}return{signatureAlgorithm:s,parameters:a}}async signWithPrivateKey(e,t,s){const a=await this.sign(s.algorithm,t,e);return s.algorithm.name==="ECDSA"?gA(a):a}fillPublicKeyParameters(e,t){const s={},a=this.getHashAlgorithm(t);if(a===E)throw new Error("Unsupported signature algorithm: ".concat(t.algorithmId));let n;t.algorithmId==="1.2.840.113549.1.1.10"?n=t.algorithmId:n=e.algorithm.algorithmId;const i=this.getAlgorithmByOID(n,!0);if(s.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in s.algorithm.algorithm&&(s.algorithm.algorithm.hash.name=a),i.name==="ECDSA"){const o=e.algorithm;if(!o.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const u=o.algorithmParams;if("idBlock"in o.algorithmParams&&!(u.idBlock.tagClass===1&&u.idBlock.tagNumber===6))throw new Error("Incorrect type for ECDSA public key parameters");const h=this.getAlgorithmByOID(u.valueBlock.toString(),!0);s.algorithm.algorithm.namedCurve=h.name}return s}async getPublicKey(e,t,s){s||(s=this.fillPublicKeyParameters(e,t));const a=e.toSchema().toBER(!1);return this.importKey("spki",a,s.algorithm.algorithm,!0,s.algorithm.usages)}async verifyWithPublicKey(e,t,s,a,n){let i;if(n){const h={};let l;a.algorithmId==="1.2.840.113549.1.1.10"?l=a.algorithmId:l=s.algorithm.algorithmId;const d=this.getAlgorithmByOID(l,!0);if(h.algorithm=this.getAlgorithmParameters(d.name,"importKey"),"hash"in h.algorithm.algorithm&&(h.algorithm.algorithm.hash.name=n),d.name==="ECDSA"){let m=!1;if("algorithmParams"in s.algorithm&&"idBlock"in s.algorithm.algorithmParams&&s.algorithm.algorithmParams.idBlock.tagClass===1&&s.algorithm.algorithmParams.idBlock.tagNumber===6&&(m=!0),m===!1)throw new Error("Incorrect type for ECDSA public key parameters");const N=this.getAlgorithmByOID(s.algorithm.algorithmParams.valueBlock.toString(),!0);h.algorithm.algorithm.namedCurve=N.name}i=await this.getPublicKey(s,null,h)}else{if(n=this.getHashAlgorithm(a),!n)throw new Error("Unsupported signature algorithm: ".concat(a.algorithmId));i=await this.getPublicKey(s,a)}const o=this.getAlgorithmParameters(i.algorithm.name,"verify");"hash"in o.algorithm&&(o.algorithm.hash.name=n);let u=t.valueBlock.valueHexView;if(i.algorithm.name==="ECDSA"){const h=Ea.find(i.algorithm.namedCurve);if(!h)throw new Error("Unsupported named curve in use");const l=Ye(u);K.assert(l,"Signature value"),u=wA(l.result,h.size)}if(i.algorithm.name==="RSA-PSS"){const h=new yt({schema:a.algorithmParams});"saltLength"in h?o.algorithm.saltLength=h.saltLength:o.algorithm.saltLength=20;let l="SHA-1";"hashAlgorithm"in h&&(l=this.getAlgorithmByOID(h.hashAlgorithm.algorithmId,!0).name),o.algorithm.hash.name=l}return this.verify(o.algorithm,i,u,e)}}let ry={name:"none",crypto:null};function gg(r){return!!(r&&typeof r=="object"&&"crypto"in r)}function wg(r,...e){let t=null;if(e.length<2)e.length?t=e[0]:t=typeof self<"u"&&self.crypto?new Dc({name:"browser",crypto:self.crypto}):null;else{const s=e[0],a=e[1];gg(a)?t=a:gg(s)?t=s:"subtle"in s&&"getRandomValues"in s&&(t=new Dc({crypto:s}))}if(typeof ct<"u"&&"pid"in ct&&typeof zt<"u"&&typeof window>"u"){if(typeof zt[ct.pid]>"u")zt[ct.pid]={};else if(typeof zt[ct.pid]!="object")throw new Error("Name global.".concat(ct.pid," already exists and it is not an object"));if(typeof zt[ct.pid].pkijs>"u")zt[ct.pid].pkijs={};else if(typeof zt[ct.pid].pkijs!="object")throw new Error("Name global.".concat(ct.pid,".pkijs already exists and it is not an object"));zt[ct.pid].pkijs.engine={name:r,crypto:t}}else ry={name:r,crypto:t}}function dA(){if(typeof ct<"u"&&"pid"in ct&&typeof zt<"u"&&typeof window>"u"){let r;try{r=zt[ct.pid].pkijs.engine}catch(e){throw new Error("Please call 'setEngine' before call to 'getEngine'")}return r}return ry}function ce(r=!1){const e=dA();if(!e.crypto&&r)throw new Error("Unable to create WebCrypto object");return e.crypto}function gA(r){if(r.byteLength%2!==0)return Qe;const e=r.byteLength/2,t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(r,0,e));const s=new $({valueHex:t}),a=new ArrayBuffer(e);new Uint8Array(a).set(new Uint8Array(r,e,e));const n=new $({valueHex:a});return new B({value:[s.convertToDER(),n.convertToDER()]}).toBER(!1)}function wA(r,e){if(!(r instanceof B&&r.valueBlock.value.length===2&&r.valueBlock.value[0]instanceof $&&r.valueBlock.value[1]instanceof $))return Qe;const t=r.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,s=r.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,a=new Uint8Array(e*2);return a.set(t,e-t.byteLength),a.set(s,2*e-s.byteLength),a.buffer}async function yA(r,e,t,s,a){switch(r.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new Ne("Unknown hash function: ".concat(r))}if(Ne.assert(e,"zBuffer","ArrayBuffer"),e.byteLength===0)throw new Ne("'zBuffer' has zero length, error");if(Ne.assert(s,"SharedInfo","ArrayBuffer"),t>255)throw new Ne("Please set 'Counter' argument to value less or equal to 255");const n=new ArrayBuffer(4),i=new Uint8Array(n);i[0]=0,i[1]=0,i[2]=0,i[3]=t;let o=Qe;o=Ko(o,e),o=Ko(o,n),o=Ko(o,s);const u=await a.digest({name:r},o);return{counter:t,result:u}}async function yg(r,e,t,s,a=ce(!0)){let n=0,i=1;switch(r.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:throw new Ne("Unknown hash function: ".concat(r))}if(Ne.assert(e,"Zbuffer","ArrayBuffer"),e.byteLength===0)throw new Ne("'Zbuffer' has zero length, error");Ne.assert(s,"SharedInfo","ArrayBuffer");const o=t/n;Math.floor(o)>0&&(i=Math.floor(o),o-i>0&&i++);const u=[];for(let m=1;m<=i;m++)u.push(await yA(r,e,m,s,a));let h=Qe,l=1,d=!0;for(;d;){d=!1;for(const m of u)if(m.counter===l){h=Ko(h,m.result),d=!0;break}l++}if(t>>=3,h.byteLength>t){const m=new ArrayBuffer(t),N=new Uint8Array(m),y=new Uint8Array(h);for(let w=0;w<t;w++)N[w]=y[w];return m}return h}const lf="version",cf="logID",hf="extensions",mf="timestamp",ff="hashAlgorithm",pf="signatureAlgorithm",df="signature",vg="none",bg="md5",Ag="sha1",Sg="sha224",Ng="sha256",Eg="sha384",kg="sha512",Ig="anonymous",Cg="rsa",Bg="dsa",xg="ecdsa";class Os extends J{constructor(e={}){super(),this.version=f(e,lf,Os.defaultValues(lf)),this.logID=f(e,cf,Os.defaultValues(cf)),this.timestamp=f(e,mf,Os.defaultValues(mf)),this.extensions=f(e,hf,Os.defaultValues(hf)),this.hashAlgorithm=f(e,ff,Os.defaultValues(ff)),this.signatureAlgorithm=f(e,pf,Os.defaultValues(pf)),this.signature=f(e,df,Os.defaultValues(df)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lf:return 0;case cf:case hf:return Qe;case mf:return new Date(0);case ff:case pf:return E;case df:return new ne;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof em))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new Na({stream:new Ue({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(Jy(new Uint8Array(e.getBlock(8)),8));const s=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(s)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=vg;break;case 1:this.hashAlgorithm=bg;break;case 2:this.hashAlgorithm=Ag;break;case 3:this.hashAlgorithm=Sg;break;case 4:this.hashAlgorithm=Ng;break;case 5:this.hashAlgorithm=Eg;break;case 6:this.hashAlgorithm=kg;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=Ig;break;case 1:this.signatureAlgorithm=Cg;break;case 2:this.signatureAlgorithm=Bg;break;case 3:this.signatureAlgorithm=xg;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16(),n=new Uint8Array(e.getBlock(a)).buffer.slice(0),i=Ye(n);if(K.assert(i,"SignedCertificateTimestamp"),this.signature=i.result,t!==47+s+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new em({data:e.stream.buffer})}toStream(){const e=new Na;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),s=new Uint8Array(t),a=md(this.timestamp.valueOf(),8);s.set(new Uint8Array(a),8-a.byteLength),e.appendView(s),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions));let n;switch(this.hashAlgorithm.toLowerCase()){case vg:n=0;break;case bg:n=1;break;case Ag:n=2;break;case Sg:n=3;break;case Ng:n=4;break;case Eg:n=5;break;case kg:n=6;break;default:throw new Error("Incorrect data for hashAlgorithm: ".concat(this.hashAlgorithm))}e.appendChar(n);let i;switch(this.signatureAlgorithm.toLowerCase()){case Ig:i=0;break;case Cg:i=1;break;case Bg:i=2;break;case xg:i=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: ".concat(this.signatureAlgorithm))}e.appendChar(i);const o=this.signature.toBER(!1);return e.appendUint16(o.byteLength),e.appendView(new Uint8Array(o)),e}toJSON(){return{version:this.version,logID:fd(this.logID),timestamp:this.timestamp,extensions:fd(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,s=0,a=ce(!0)){const n=$f(Zh(this.logID));let i=null;const o=new Na;for(const N of e)if(N.log_id===n){i=N.key;break}if(!i)throw new Error("Public key not found for CT with logId: ".concat(n));const u=Go(kc(i)),h=Jt.fromBER(u);o.appendChar(0),o.appendChar(0);const l=new ArrayBuffer(8),d=new Uint8Array(l),m=md(this.timestamp.valueOf(),8);return d.set(new Uint8Array(m),8-m.byteLength),o.appendView(d),o.appendUint16(s),s===0&&o.appendUint24(t.byteLength),o.appendView(new Uint8Array(t)),o.appendUint16(this.extensions.byteLength),this.extensions.byteLength!==0&&o.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(o.buffer.slice(0,o.length),new W({valueHex:this.signature.toBER(!1)}),h,{algorithmId:E},"SHA-256")}}Os.CLASS_NAME="SignedCertificateTimestamp";const Qc="timestamps";class km extends J{constructor(e={}){super(),this.timestamps=f(e,Qc,km.defaultValues(Qc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){var t;const s=f(e,"names",{});return(t=s.optional)!==null&&t!==void 0||(s.optional=!1),new W({name:s.blockName||"SignedCertificateTimestampList",optional:s.optional})}fromSchema(e){if(!(e instanceof W))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new Na({stream:new Ue({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new Os({stream:t}))}toSchema(){const e=new Na;let t=0;const s=[];for(const a of this.timestamps){const n=a.toStream();s.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const a of s)e.appendView(a.stream.view);return new W({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}km.CLASS_NAME="SignedCertificateTimestampList";const cl="attributes",vA=[cl];class Tc extends J{constructor(e={}){super(),this.attributes=f(e,cl,Tc.defaultValues(cl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.attributes||E,value:Ve.schema()})]})}fromSchema(e){q(e,vA);const t=_(e,e,Tc.schema({names:{attributes:cl}}));K.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,s=>new Ve({schema:s}))}toSchema(){return new B({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}Tc.CLASS_NAME="SubjectDirectoryAttributes";class Te{static getItems(){return this.types||(this.types={},Te.register(Kw,"SubjectAltName",Xo),Te.register(Hw,"IssuerAltName",Xo),Te.register(jp,"AuthorityKeyIdentifier",ya),Te.register(Lp,"BasicConstraints",Gn),Te.register(Rb,"MicrosoftCaVersion",xc),Te.register(Ww,"CertificatePolicies",Yo),Te.register(xb,"CertificatePoliciesMicrosoft",Yo),Te.register(Tb,"MicrosoftCertTemplateV2",$o),Te.register(_w,"CRLDistributionPoints",Qo),Te.register(Up,"FreshestCRL",Qo),Te.register(Vb,"ExtKeyUsage",Vc),Te.register(Jw,"CertificateIssuer",ot),Te.register($p,"AuthorityInfoAccess",Zo),Te.register(Ob,"SubjectInfoAccess",Zo),Te.register(Fw,"IssuingDistributionPoint",gt),Te.register(qw,"NameConstraints",Fo),Te.register(zw,"PolicyConstraints",Jo),Te.register(Gw,"PolicyMappings",Pc),Te.register(Eb,"PrivateKeyUsagePeriod",qo),Te.register(Lb,"QCStatements",Oc),Te.register(Db,"SignedCertificateTimestampList",km),Te.register(Ab,"SubjectDirectoryAttributes",Tc)),this.types}static fromBER(e,t){const s=Ye(t);if(s.offset===-1)return null;const a=this.find(e);if(a)try{return new a.type({schema:s.result})}catch(n){const i=new a.type;return i.parsingError="Incorrectly formatted value of extension ".concat(a.name," (").concat(e,")"),i}return s.result}static find(e){return this.getItems()[e]||null}static register(e,t,s){this.getItems()[e]={name:t,type:s}}}const hl="extnID",Kr="critical",ml="extnValue",Zc="parsedValue",bA=[hl,Kr,ml];class Ge extends J{get parsedValue(){if(this._parsedValue===void 0){const e=Te.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=f(e,hl,Ge.defaultValues(hl)),this.critical=f(e,Kr,Ge.defaultValues(Kr)),ml in e?this.extnValue=new W({valueHex:e.extnValue}):this.extnValue=Ge.defaultValues(ml),Zc in e&&(this.parsedValue=f(e,Zc,Ge.defaultValues(Zc))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hl:return E;case Kr:return!1;case ml:return new W;case Zc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.extnID||E}),new Ba({name:t.critical||E,optional:!0}),new W({name:t.extnValue||E})]})}fromSchema(e){q(e,bA);const t=_(e,e,Ge.schema({names:{extnID:hl,critical:Kr,extnValue:ml}}));K.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),Kr in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new Z({value:this.extnID})),this.critical!==Ge.defaultValues(Kr)&&e.push(new Ba({value:this.critical})),e.push(this.extnValue),new B({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Ge.defaultValues(Kr)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}Ge.CLASS_NAME="Extension";const fl="extensions",AA=[fl];class Ze extends J{constructor(e={}){super(),this.extensions=f(e,fl,Ze.defaultValues(fl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fl:return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=f(e,"names",{});return new B({optional:t,name:s.blockName||E,value:[new ue({name:s.extensions||E,value:Ge.schema(s.extension||{})})]})}fromSchema(e){q(e,AA);const t=_(e,e,Ze.schema({names:{extensions:fl}}));K.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,s=>new Ge({schema:s}))}toSchema(){return new B({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}Ze.CLASS_NAME="Extensions";const pl="issuer",dl="serialNumber",Xa="issuerUID",SA=[pl,dl,Xa];class Ft extends J{constructor(e={}){super(),this.issuer=f(e,pl,Ft.defaultValues(pl)),this.serialNumber=f(e,dl,Ft.defaultValues(dl)),Xa in e&&(this.issuerUID=f(e,Xa,Ft.defaultValues(Xa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pl:return new ot;case dl:return new $;case Xa:return new pe;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[ot.schema(t.issuer||{}),new $({name:t.serialNumber||E}),new pe({optional:!0,name:t.issuerUID||E})]})}fromSchema(e){q(e,SA);const t=_(e,e,Ft.schema({names:{issuer:{names:{blockName:pl}},serialNumber:dl,issuerUID:Xa}}));K.assertSchema(t,this.className),this.issuer=new ot({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,Xa in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new B({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}Ft.CLASS_NAME="IssuerSerial";const gl="version",Ya="baseCertificateID",Qa="subjectName",wl="issuer",yl="signature",vl="serialNumber",bl="attrCertValidityPeriod",Al="attributes",Za="issuerUniqueID",en="extensions",NA=[gl,Ya,Qa,wl,yl,vl,bl,Al,Za,en];class Vt extends J{constructor(e={}){super(),this.version=f(e,gl,Vt.defaultValues(gl)),Ya in e&&(this.baseCertificateID=f(e,Ya,Vt.defaultValues(Ya))),Qa in e&&(this.subjectName=f(e,Qa,Vt.defaultValues(Qa))),this.issuer=f(e,wl,Vt.defaultValues(wl)),this.signature=f(e,yl,Vt.defaultValues(yl)),this.serialNumber=f(e,vl,Vt.defaultValues(vl)),this.attrCertValidityPeriod=f(e,bl,Vt.defaultValues(bl)),this.attributes=f(e,Al,Vt.defaultValues(Al)),Za in e&&(this.issuerUniqueID=f(e,Za,Vt.defaultValues(Za))),en in e&&(this.extensions=f(e,en,Vt.defaultValues(en))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gl:return 0;case Ya:return new Ft;case Qa:return new ot;case wl:return new ot;case yl:return new j;case vl:return new $;case bl:return new ks;case Al:return[];case Za:return new pe;case en:return new Ze;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),new je({value:[new T({name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Ft.schema().valueBlock.value}),new T({name:t.subjectName||E,idBlock:{tagClass:3,tagNumber:1},value:ot.schema().valueBlock.value})]}),ot.schema({names:{blockName:t.issuer||E}}),j.schema(t.signature||{}),new $({name:t.serialNumber||E}),ks.schema(t.attrCertValidityPeriod||{}),new B({name:t.attributes||E,value:[new ue({value:Ve.schema()})]}),new pe({optional:!0,name:t.issuerUniqueID||E}),Ze.schema(t.extensions||{},!0)]})}fromSchema(e){q(e,NA);const t=_(e,e,Vt.schema({names:{version:gl,baseCertificateID:Ya,subjectName:Qa,issuer:wl,signature:{names:{blockName:yl}},serialNumber:vl,attrCertValidityPeriod:{names:{blockName:bl}},attributes:Al,issuerUniqueID:Za,extensions:{names:{blockName:en}}}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Ya in t.result&&(this.baseCertificateID=new Ft({schema:new B({value:t.result.baseCertificateID.valueBlock.value})})),Qa in t.result&&(this.subjectName=new ot({schema:new B({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new j({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ks({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new Ve({schema:s})),Za in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),en in t.result&&(this.extensions=new Ze({schema:t.result.extensions}))}toSchema(){const e=new B({value:[new $({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new B({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}Vt.CLASS_NAME="AttributeCertificateInfoV1";const Sl="acinfo",Nl="signatureAlgorithm",El="signatureValue",EA=[Sl,El,Nl];class nr extends J{constructor(e={}){super(),this.acinfo=f(e,Sl,nr.defaultValues(Sl)),this.signatureAlgorithm=f(e,Nl,nr.defaultValues(Nl)),this.signatureValue=f(e,El,nr.defaultValues(El)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Sl:return new Vt;case Nl:return new j;case El:return new pe;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[Vt.schema(t.acinfo||{}),j.schema(t.signatureAlgorithm||{}),new pe({name:t.signatureValue||E})]})}fromSchema(e){q(e,EA);const t=_(e,e,nr.schema({names:{acinfo:{names:{blockName:Sl}},signatureAlgorithm:{names:{blockName:Nl}},signatureValue:El}}));K.assertSchema(t,this.className),this.acinfo=new Vt({schema:t.result.acinfo}),this.signatureAlgorithm=new j({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new B({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}nr.CLASS_NAME="AttributeCertificateV1";const kl="digestedObjectType",tn="otherObjectTypeID",Il="digestAlgorithm",Cl="objectDigest",kA=[kl,tn,Il,Cl];class rs extends J{constructor(e={}){super(),this.digestedObjectType=f(e,kl,rs.defaultValues(kl)),tn in e&&(this.otherObjectTypeID=f(e,tn,rs.defaultValues(tn))),this.digestAlgorithm=f(e,Il,rs.defaultValues(Il)),this.objectDigest=f(e,Cl,rs.defaultValues(Cl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kl:return new Cc;case tn:return new Z;case Il:return new j;case Cl:return new pe;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Cc({name:t.digestedObjectType||E}),new Z({optional:!0,name:t.otherObjectTypeID||E}),j.schema(t.digestAlgorithm||{}),new pe({name:t.objectDigest||E})]})}fromSchema(e){q(e,kA);const t=_(e,e,rs.schema({names:{digestedObjectType:kl,otherObjectTypeID:tn,digestAlgorithm:{names:{blockName:Il}},objectDigest:Cl}}));K.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,tn in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new j({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new B({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}rs.CLASS_NAME="ObjectDigestInfo";const sn="issuerName",rn="baseCertificateID",an="objectDigestInfo",IA=[sn,rn,an];class ba extends J{constructor(e={}){super(),sn in e&&(this.issuerName=f(e,sn,ba.defaultValues(sn))),rn in e&&(this.baseCertificateID=f(e,rn,ba.defaultValues(rn))),an in e&&(this.objectDigestInfo=f(e,an,ba.defaultValues(an))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sn:return new ot;case rn:return new Ft;case an:return new rs;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[ot.schema({names:{blockName:t.issuerName}},!0),new T({optional:!0,name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Ft.schema().valueBlock.value}),new T({optional:!0,name:t.objectDigestInfo||E,idBlock:{tagClass:3,tagNumber:1},value:rs.schema().valueBlock.value})]})}fromSchema(e){q(e,IA);const t=_(e,e,ba.schema({names:{issuerName:sn,baseCertificateID:rn,objectDigestInfo:an}}));K.assertSchema(t,this.className),sn in t.result&&(this.issuerName=new ot({schema:t.result.issuerName})),rn in t.result&&(this.baseCertificateID=new Ft({schema:new B({value:t.result.baseCertificateID.valueBlock.value})})),an in t.result&&(this.objectDigestInfo=new rs({schema:new B({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new B;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}ba.CLASS_NAME="V2Form";const nn="baseCertificateID",on="entityName",un="objectDigestInfo",CA=[nn,on,un];class ir extends J{constructor(e={}){super(),nn in e&&(this.baseCertificateID=f(e,nn,ir.defaultValues(nn))),on in e&&(this.entityName=f(e,on,ir.defaultValues(on))),un in e&&(this.objectDigestInfo=f(e,un,ir.defaultValues(un))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nn:return new Ft;case on:return new ot;case un:return new rs;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new T({optional:!0,name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Ft.schema().valueBlock.value}),new T({optional:!0,name:t.entityName||E,idBlock:{tagClass:3,tagNumber:1},value:ot.schema().valueBlock.value}),new T({optional:!0,name:t.objectDigestInfo||E,idBlock:{tagClass:3,tagNumber:2},value:rs.schema().valueBlock.value})]})}fromSchema(e){q(e,CA);const t=_(e,e,ir.schema({names:{baseCertificateID:nn,entityName:on,objectDigestInfo:un}}));K.assertSchema(t,this.className),nn in t.result&&(this.baseCertificateID=new Ft({schema:new B({value:t.result.baseCertificateID.valueBlock.value})})),on in t.result&&(this.entityName=new ot({schema:new B({value:t.result.entityName.valueBlock.value})})),un in t.result&&(this.objectDigestInfo=new rs({schema:new B({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new B;return this.baseCertificateID&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}ir.CLASS_NAME="Holder";const Bl="version",xl="holder",Vl="issuer",Pl="signature",Ol="serialNumber",Dl="attrCertValidityPeriod",Tl="attributes",ln="issuerUniqueID",cn="extensions",BA=[Bl,xl,Vl,Pl,Ol,Dl,Tl,ln,cn];class Ut extends J{constructor(e={}){super(),this.version=f(e,Bl,Ut.defaultValues(Bl)),this.holder=f(e,xl,Ut.defaultValues(xl)),this.issuer=f(e,Vl,Ut.defaultValues(Vl)),this.signature=f(e,Pl,Ut.defaultValues(Pl)),this.serialNumber=f(e,Ol,Ut.defaultValues(Ol)),this.attrCertValidityPeriod=f(e,Dl,Ut.defaultValues(Dl)),this.attributes=f(e,Tl,Ut.defaultValues(Tl)),ln in e&&(this.issuerUniqueID=f(e,ln,Ut.defaultValues(ln))),cn in e&&(this.extensions=f(e,cn,Ut.defaultValues(cn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bl:return 1;case xl:return new ir;case Vl:return{};case Pl:return new j;case Ol:return new $;case Dl:return new ks;case Tl:return[];case ln:return new pe;case cn:return new Ze;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),ir.schema(t.holder||{}),new je({value:[ot.schema({names:{blockName:t.issuer||E}}),new T({name:t.issuer||E,idBlock:{tagClass:3,tagNumber:0},value:ba.schema().valueBlock.value})]}),j.schema(t.signature||{}),new $({name:t.serialNumber||E}),ks.schema(t.attrCertValidityPeriod||{}),new B({name:t.attributes||E,value:[new ue({value:Ve.schema()})]}),new pe({optional:!0,name:t.issuerUniqueID||E}),Ze.schema(t.extensions||{},!0)]})}fromSchema(e){q(e,BA);const t=_(e,e,Ut.schema({names:{version:Bl,holder:{names:{blockName:xl}},issuer:Vl,signature:{names:{blockName:Pl}},serialNumber:Ol,attrCertValidityPeriod:{names:{blockName:Dl}},attributes:Tl,issuerUniqueID:ln,extensions:{names:{blockName:cn}}}}));switch(K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new ir({schema:t.result.holder}),t.result.issuer.idBlock.tagClass){case 3:this.issuer=new ba({schema:new B({value:t.result.issuer.valueBlock.value})});break;case 1:default:throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2")}this.signature=new j({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ks({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new Ve({schema:s})),ln in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),cn in t.result&&(this.extensions=new Ze({schema:t.result.extensions}))}toSchema(){const e=new B({value:[new $({value:this.version}),this.holder.toSchema(),new T({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new B({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}Ut.CLASS_NAME="AttributeCertificateInfoV2";const Rl="acinfo",Ll="signatureAlgorithm",Ul="signatureValue",xA=[Rl,Ll,Ul];class as extends J{constructor(e={}){super(),this.acinfo=f(e,Rl,as.defaultValues(Rl)),this.signatureAlgorithm=f(e,Ll,as.defaultValues(Ll)),this.signatureValue=f(e,Ul,as.defaultValues(Ul)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rl:return new Ut;case Ll:return new j;case Ul:return new pe;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[Ut.schema(t.acinfo||{}),j.schema(t.signatureAlgorithm||{}),new pe({name:t.signatureValue||E})]})}fromSchema(e){q(e,xA);const t=_(e,e,as.schema({names:{acinfo:{names:{blockName:Rl}},signatureAlgorithm:{names:{blockName:Ll}},signatureValue:Ul}}));K.assertSchema(t,this.className),this.acinfo=new Ut({schema:t.result.acinfo}),this.signatureAlgorithm=new j({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new B({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}as.CLASS_NAME="AttributeCertificateV2";const hn="contentType",Ci="content",VA=[hn,Ci];class Ie extends J{constructor(e={}){super(),this.contentType=f(e,hn,Ie.defaultValues(hn)),this.content=f(e,Ci,Ie.defaultValues(Ci)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hn:return E;case Ci:return new ne;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hn:return typeof t=="string"&&t===this.defaultValues(hn);case Ci:return t instanceof ne;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return"optional"in t||(t.optional=!1),new B({name:t.blockName||"ContentInfo",optional:t.optional,value:[new Z({name:t.contentType||hn}),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ne({name:t.content||Ci})]})]})}fromSchema(e){q(e,VA);const t=_(e,e,Ie.schema());K.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new B({value:[new Z({value:this.contentType}),new T({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof ne||(e.content=this.content.toJSON()),e}}Ie.CLASS_NAME="ContentInfo",Ie.DATA=Mp,Ie.SIGNED_DATA=Xw,Ie.ENVELOPED_DATA=Yw,Ie.ENCRYPTED_DATA=Qw;const gf="type",wf="value",ep="utcTimeName",tp="generalTimeName",PA=[ep,tp];var Vg;(function(r){r[r.UTCTime=0]="UTCTime",r[r.GeneralizedTime=1]="GeneralizedTime",r[r.empty=2]="empty"})(Vg||(Vg={}));class Xe extends J{constructor(e={}){super(),this.type=f(e,gf,Xe.defaultValues(gf)),this.value=f(e,wf,Xe.defaultValues(wf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gf:return 0;case wf:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=f(e,"names",{});return new je({optional:t,value:[new Mf({name:s.utcTimeName||E}),new $e({name:s.generalTimeName||E})]})}fromSchema(e){q(e,PA);const t=_(e,e,Xe.schema({names:{utcTimeName:ep,generalTimeName:tp}}));K.assertSchema(t,this.className),ep in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),tp in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return this.type===0?new Mf({valueDate:this.value}):this.type===1?new $e({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}Xe.CLASS_NAME="Time";const yf="tbs",Hr="version",Nh="serialNumber",Eh="signature",kh="issuer",Ih="notBefore",Ch="notAfter",Bh="subject",xh="subjectPublicKeyInfo",jl="issuerUniqueID",$l="subjectUniqueID",Ml="extensions",Kl="signatureAlgorithm",Hl="signatureValue",ns="tbsCertificate",lm="".concat(ns,".").concat(Hr),Kp="".concat(ns,".").concat(Nh),Hp="".concat(ns,".").concat(Eh),Fp="".concat(ns,".").concat(kh),cm="".concat(ns,".").concat(Ih),hm="".concat(ns,".").concat(Ch),Jp="".concat(ns,".").concat(Bh),qp="".concat(ns,".").concat(xh),mm="".concat(ns,".").concat(jl),fm="".concat(ns,".").concat($l),Sc="".concat(ns,".").concat(Ml),OA=[ns,lm,Kp,Hp,Fp,cm,hm,Jp,qp,mm,fm,Sc,Kl,Hl];function DA(r={}){const e=f(r,"names",{});return new B({name:e.blockName||ns,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $({name:e.tbsCertificateVersion||lm})]}),new $({name:e.tbsCertificateSerialNumber||Kp}),j.schema(e.signature||{names:{blockName:Hp}}),Ee.schema(e.issuer||{names:{blockName:Fp}}),new B({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[Xe.schema(e.notBefore||{names:{utcTimeName:cm,generalTimeName:cm}}),Xe.schema(e.notAfter||{names:{utcTimeName:hm,generalTimeName:hm}})]}),Ee.schema(e.subject||{names:{blockName:Jp}}),Jt.schema(e.subjectPublicKeyInfo||{names:{blockName:qp}}),new ae({name:e.tbsCertificateIssuerUniqueID||mm,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new ae({name:e.tbsCertificateSubjectUniqueID||fm,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Ze.schema(e.extensions||{names:{blockName:Sc}})]})]})}class ye extends J{get tbs(){return xe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,yf,ye.defaultValues(yf))),this.version=f(e,Hr,ye.defaultValues(Hr)),this.serialNumber=f(e,Nh,ye.defaultValues(Nh)),this.signature=f(e,Eh,ye.defaultValues(Eh)),this.issuer=f(e,kh,ye.defaultValues(kh)),this.notBefore=f(e,Ih,ye.defaultValues(Ih)),this.notAfter=f(e,Ch,ye.defaultValues(Ch)),this.subject=f(e,Bh,ye.defaultValues(Bh)),this.subjectPublicKeyInfo=f(e,xh,ye.defaultValues(xh)),jl in e&&(this.issuerUniqueID=f(e,jl,ye.defaultValues(jl))),$l in e&&(this.subjectUniqueID=f(e,$l,ye.defaultValues($l))),Ml in e&&(this.extensions=f(e,Ml,ye.defaultValues(Ml))),this.signatureAlgorithm=f(e,Kl,ye.defaultValues(Kl)),this.signatureValue=f(e,Hl,ye.defaultValues(Hl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yf:return Qe;case Hr:return 0;case Nh:return new $;case Eh:return new j;case kh:return new Ee;case Ih:return new Xe;case Ch:return new Xe;case Bh:return new Ee;case xh:return new Jt;case jl:return Qe;case $l:return Qe;case Ml:return[];case Kl:return new j;case Hl:return new pe;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[DA(t.tbsCertificate),j.schema(t.signatureAlgorithm||{names:{blockName:Kl}}),new pe({name:t.signatureValue||Hl})]})}fromSchema(e){q(e,OA);const t=_(e,e,ye.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:Sc}}}}}}));K.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,lm in t.result&&(this.version=t.result[lm].valueBlock.valueDec),this.serialNumber=t.result[Kp],this.signature=new j({schema:t.result[Hp]}),this.issuer=new Ee({schema:t.result[Fp]}),this.notBefore=new Xe({schema:t.result[cm]}),this.notAfter=new Xe({schema:t.result[hm]}),this.subject=new Ee({schema:t.result[Jp]}),this.subjectPublicKeyInfo=new Jt({schema:t.result[qp]}),mm in t.result&&(this.issuerUniqueID=t.result[mm].valueBlock.valueHex),fm in t.result&&(this.subjectUniqueID=t.result[fm].valueBlock.valueHex),Sc in t.result&&(this.extensions=Array.from(t.result[Sc],s=>new Ge({schema:s}))),this.signatureAlgorithm=new j({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return Hr in this&&this.version!==ye.defaultValues(Hr)&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new B({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new ae({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new ae({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new B({value:Array.from(this.extensions,t=>t.toSchema())})]})),new B({value:e})}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return ye.schema().value[0];const s=Ye(this.tbsView);K.assert(s,"TBS Certificate"),t=s.result}else t=this.encodeTBS();return new B({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Hr in this&&this.version!==ye.defaultValues(Hr)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=Ae.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=Ae.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async getPublicKey(e,t=ce(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=ce(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",s=ce(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new pe({valueHex:i})}async verify(e,t=ce(!0)){let s;if(e?s=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(s=this.subjectPublicKeyInfo),!(s instanceof Jt))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}ye.CLASS_NAME="Certificate";function ay(r,e=null){if(e&&r.issuer.isEqual(e.issuer)&&r.serialNumber.isEqual(e.serialNumber))return null;let t=!1;if(r.extensions){for(const s of r.extensions)if(s.extnID===Lp&&s.parsedValue instanceof Gn&&s.parsedValue.cA){t=!0;break}}return t?r:null}const Bi="certId",xi="certValue",li="parsedValue",TA=[Bi,xi];class Hn extends J{constructor(e={}){super(),this.certId=f(e,Bi,Hn.defaultValues(Bi)),this.certValue=f(e,xi,Hn.defaultValues(xi)),li in e&&(this.parsedValue=f(e,li,Hn.defaultValues(li))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bi:return E;case xi:return new ne;case li:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bi:return t===E;case xi:return t instanceof ne;case li:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.id||"id"}),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ne({name:t.value||"value"})]})]})}fromSchema(e){q(e,TA);const t=_(e,e,Hn.schema({names:{id:Bi,value:xi}}));K.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const s=this.certValue.valueBlock.valueHexView;switch(this.certId){case hg:try{this.parsedValue=ye.fromBER(s)}catch(a){as.fromBER(s)}break;case mg:this.parsedValue=as.fromBER(s);break;case jb:default:throw new Error("Incorrect CERT_ID value in CertBag: ".concat(this.certId))}}toSchema(){return li in this&&("acinfo"in this.parsedValue?this.certId=mg:this.certId=hg,this.certValue=new W({valueHex:this.parsedValue.toSchema().toBER(!1)})),new B({value:[new Z({value:this.certId}),new T({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}Hn.CLASS_NAME="CertBag";const Fl="userCertificate",Vi="revocationDate",mn="crlEntryExtensions",RA=[Fl,Vi,mn];class Fn extends J{constructor(e={}){super(),this.userCertificate=f(e,Fl,Fn.defaultValues(Fl)),this.revocationDate=f(e,Vi,Fn.defaultValues(Vi)),mn in e&&(this.crlEntryExtensions=f(e,mn,Fn.defaultValues(mn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fl:return new $;case Vi:return new Xe;case mn:return new Ze;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.userCertificate||Fl}),Xe.schema({names:{utcTimeName:t.revocationDate||Vi,generalTimeName:t.revocationDate||Vi}}),Ze.schema({names:{blockName:t.crlEntryExtensions||mn}},!0)]})}fromSchema(e){q(e,RA);const t=_(e,e,Fn.schema());K.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new Xe({schema:t.result.revocationDate}),mn in t.result&&(this.crlEntryExtensions=new Ze({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new B({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}Fn.CLASS_NAME="RevokedCertificate";const vf="tbs",du="version",bf="signature",Af="issuer",Sf="thisUpdate",eh="nextUpdate",th="revokedCertificates",sh="crlExtensions",Jl="signatureAlgorithm",ql="signatureValue",fr="tbsCertList",pm="".concat(fr,".version"),_p="".concat(fr,".signature"),Wp="".concat(fr,".issuer"),dm="".concat(fr,".thisUpdate"),Rc="".concat(fr,".nextUpdate"),gm="".concat(fr,".revokedCertificates"),wm="".concat(fr,".extensions"),LA=[fr,pm,_p,Wp,dm,Rc,gm,wm,Jl,ql];function UA(r={}){const e=f(r,"names",{});return new B({name:e.blockName||fr,value:[new $({optional:!0,name:e.tbsCertListVersion||pm,value:2}),j.schema(e.signature||{names:{blockName:_p}}),Ee.schema(e.issuer||{names:{blockName:Wp}}),Xe.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:dm,generalTimeName:dm}}),Xe.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:Rc,generalTimeName:Rc}},!0),new B({optional:!0,value:[new ue({name:e.tbsCertListRevokedCertificates||gm,value:new B({value:[new $,Xe.schema(),Ze.schema({},!0)]})})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Ze.schema(e.crlExtensions||{names:{blockName:wm}})]})]})}const jA=[jp,Hw,kb,Ib,Fw,Up,$p,Cb,Bb,Jw];class at extends J{get tbs(){return xe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,vf,at.defaultValues(vf))),this.version=f(e,du,at.defaultValues(du)),this.signature=f(e,bf,at.defaultValues(bf)),this.issuer=f(e,Af,at.defaultValues(Af)),this.thisUpdate=f(e,Sf,at.defaultValues(Sf)),eh in e&&(this.nextUpdate=f(e,eh,at.defaultValues(eh))),th in e&&(this.revokedCertificates=f(e,th,at.defaultValues(th))),sh in e&&(this.crlExtensions=f(e,sh,at.defaultValues(sh))),this.signatureAlgorithm=f(e,Jl,at.defaultValues(Jl)),this.signatureValue=f(e,ql,at.defaultValues(ql)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vf:return Qe;case du:return 0;case bf:return new j;case Af:return new Ee;case Sf:return new Xe;case eh:return new Xe;case th:return[];case sh:return new Ze;case Jl:return new j;case ql:return new pe;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||"CertificateList",value:[UA(e),j.schema(t.signatureAlgorithm||{names:{blockName:Jl}}),new pe({name:t.signatureValue||ql})]})}fromSchema(e){q(e,LA);const t=_(e,e,at.schema());K.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,pm in t.result&&(this.version=t.result[pm].valueBlock.valueDec),this.signature=new j({schema:t.result[_p]}),this.issuer=new Ee({schema:t.result[Wp]}),this.thisUpdate=new Xe({schema:t.result[dm]}),Rc in t.result&&(this.nextUpdate=new Xe({schema:t.result[Rc]})),gm in t.result&&(this.revokedCertificates=Array.from(t.result[gm],s=>new Fn({schema:s}))),wm in t.result&&(this.crlExtensions=new Ze({schema:t.result[wm]})),this.signatureAlgorithm=new j({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==at.defaultValues(du)&&e.push(new $({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new B({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new B({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return at.schema();const s=Ye(this.tbsView);K.assert(s,"TBS Certificate Revocation List"),t=s.result}return new B({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==at.defaultValues(du)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",s=ce(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),{parameters:n}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new pe({valueHex:i})}async verify(e={},t=ce(!0)){let s;if(e.issuerCertificate&&(s=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(s=e.publicKeyInfo),!s)throw new Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(const a of this.crlExtensions.extensions)if(a.critical&&!jA.includes(a.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}at.CLASS_NAME="CertificateRevocationList";const Pi="crlId",Oi="crlValue",gu="parsedValue",$A=[Pi,Oi];class Jn extends J{constructor(e={}){super(),this.crlId=f(e,Pi,Jn.defaultValues(Pi)),this.crlValue=f(e,Oi,Jn.defaultValues(Oi)),gu in e&&(this.parsedValue=f(e,gu,Jn.defaultValues(gu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pi:return E;case Oi:return new ne;case gu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pi:return t===E;case Oi:return t instanceof ne;case gu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.id||"id"}),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ne({name:t.value||"value"})]})]})}fromSchema(e){q(e,$A);const t=_(e,e,Jn.schema({names:{id:Pi,value:Oi}}));switch(K.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId){case fg:this.parsedValue=at.fromBER(this.certValue.valueBlock.valueHex);break;default:throw new Error("Incorrect CRL_ID value in CRLBag: ".concat(this.crlId))}}toSchema(){return this.parsedValue&&(this.crlId=fg,this.crlValue=new W({valueHex:this.parsedValue.toSchema().toBER(!1)})),new B({value:[new Z({value:this.crlId}),new T({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}Jn.CLASS_NAME="CRLBag";const Di="version",Ti="encryptedContentInfo",Fr="unprotectedAttrs",MA=[Di,Ti,Fr];class Ls extends J{constructor(e={}){super(),this.version=f(e,Di,Ls.defaultValues(Di)),this.encryptedContentInfo=f(e,Ti,Ls.defaultValues(Ti)),Fr in e&&(this.unprotectedAttrs=f(e,Fr,Ls.defaultValues(Fr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Di:return 0;case Ti:return new We;case Fr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Di:return t===0;case Ti:return We.compareWithDefault("contentType",t.contentType)&&We.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&We.compareWithDefault("encryptedContent",t.encryptedContent);case Fr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),We.schema(t.encryptedContentInfo||{}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ue({name:t.unprotectedAttrs||E,value:Ve.schema()})]})]})}fromSchema(e){q(e,MA);const t=_(e,e,Ls.schema({names:{version:Di,encryptedContentInfo:{names:{blockName:Ti}},unprotectedAttrs:Fr}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new We({schema:t.result.encryptedContentInfo}),Fr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new Ve({schema:s})))}toSchema(){const e=[];return e.push(new $({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new B({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}async encrypt(e,t=ce(!0)){Ne.assert(e,"parameters","object");const s=xs(It({},e),{contentType:"1.2.840.113549.1.7.1"});this.encryptedContentInfo=await t.encryptEncryptedContentInfo(s)}async decrypt(e,t=ce(!0)){Ne.assert(e,"parameters","object");const s=xs(It({},e),{encryptedContentInfo:this.encryptedContentInfo});return t.decryptEncryptedContentInfo(s)}}Ls.CLASS_NAME="EncryptedData";const fn="encryptionAlgorithm",Jr="encryptedData",wu="parsedValue",KA=[fn,Jr];class ma extends J{constructor(e={}){super(),this.encryptionAlgorithm=f(e,fn,ma.defaultValues(fn)),this.encryptedData=f(e,Jr,ma.defaultValues(Jr)),wu in e&&(this.parsedValue=f(e,wu,ma.defaultValues(wu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fn:return new j;case Jr:return new W;case wu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fn:return j.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Jr:return t.isEqual(ma.defaultValues(e));case wu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[j.schema(t.encryptionAlgorithm||{names:{blockName:fn}}),new je({value:[new W({name:t.encryptedData||Jr}),new W({idBlock:{isConstructed:!0},name:t.encryptedData||Jr})]})]})}fromSchema(e){q(e,KA);const t=_(e,e,ma.schema({names:{encryptionAlgorithm:{names:{blockName:fn}},encryptedData:Jr}}));K.assertSchema(t,this.className),this.encryptionAlgorithm=new j({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new B({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=ce(!0)){const s=await new Ls({encryptedContentInfo:new We({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}).decrypt(e,t);this.parsedValue=hs.fromBER(s)}async makeInternalValues(e,t=ce(!0)){if(!this.parsedValue)throw new Error('Please initialize "parsedValue" first');const s=new Ls,a=xs(It({},e),{contentToEncrypt:this.parsedValue.toSchema().toBER(!1)});if(await s.encrypt(a,t),!s.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=s.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=s.encryptedContentInfo.encryptedContent}}ma.CLASS_NAME="PKCS8ShroudedKeyBag";const Ri="secretTypeId",Li="secretValue",HA=[Ri,Li];class _o extends J{constructor(e={}){super(),this.secretTypeId=f(e,Ri,_o.defaultValues(Ri)),this.secretValue=f(e,Li,_o.defaultValues(Li)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ri:return E;case Li:return new ne;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ri:return t===E;case Li:return t instanceof ne;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.id||"id"}),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ne({name:t.value||"value"})]})]})}fromSchema(e){q(e,HA);const t=_(e,e,_o.schema({names:{id:Ri,value:Li}}));K.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new B({value:[new Z({value:this.secretTypeId}),new T({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}_o.CLASS_NAME="SecretBag";class ca{static getItems(){return this.items||(this.items={},ca.register("1.2.840.113549.1.12.10.1.1",hs),ca.register("1.2.840.113549.1.12.10.1.2",ma),ca.register("1.2.840.113549.1.12.10.1.3",Hn),ca.register("1.2.840.113549.1.12.10.1.4",Jn),ca.register("1.2.840.113549.1.12.10.1.5",_o),ca.register("1.2.840.113549.1.12.10.1.6",or)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}const pn="bagId",dn="bagValue",Gs="bagAttributes",FA=[pn,dn,Gs];class Aa extends J{constructor(e={}){super(),this.bagId=f(e,pn,Aa.defaultValues(pn)),this.bagValue=f(e,dn,Aa.defaultValues(dn)),Gs in e&&(this.bagAttributes=f(e,Gs,Aa.defaultValues(Gs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pn:return E;case dn:return new ne;case Gs:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case pn:return t===E;case dn:return t instanceof ne;case Gs:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.bagId||pn}),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ne({name:t.bagValue||dn})]}),new it({optional:!0,value:[new ue({name:t.bagAttributes||Gs,value:Ve.schema()})]})]})}fromSchema(e){q(e,FA);const t=_(e,e,Aa.schema({names:{bagId:pn,bagValue:dn,bagAttributes:Gs}}));K.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const s=ca.find(this.bagId);if(!s)throw new Error("Invalid BAG_ID for SafeBag: ".concat(this.bagId));this.bagValue=new s({schema:t.result.bagValue}),Gs in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new Ve({schema:a})))}toSchema(){const e=[new Z({value:this.bagId}),new T({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new it({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new B({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}Aa.CLASS_NAME="SafeBag";const ci="safeBags";class or extends J{constructor(e={}){super(),this.safeBags=f(e,ci,or.defaultValues(ci)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ci:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ci:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.safeBags||E,value:Aa.schema()})]})}fromSchema(e){q(e,[ci]);const t=_(e,e,or.schema({names:{safeBags:ci}}));K.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,s=>new Aa({schema:s}))}toSchema(){return new B({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}or.CLASS_NAME="SafeContents";const _l="otherCertFormat",Wl="otherCert",JA=[_l,Wl];class ka extends J{constructor(e={}){super(),this.otherCertFormat=f(e,_l,ka.defaultValues(_l)),this.otherCert=f(e,Wl,ka.defaultValues(Wl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _l:return E;case Wl:return new ne;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.otherCertFormat||_l}),new ne({name:t.otherCert||Wl})]})}fromSchema(e){q(e,JA);const t=_(e,e,ka.schema());K.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new B({value:[new Z({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof ne||(e.otherCert=this.otherCert.toJSON()),e}}const Gl="certificates",qA=[Gl];class Us extends J{constructor(e={}){super(),this.certificates=f(e,Gl,Us.defaultValues(Gl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new it({name:t.blockName||E,value:[new ue({name:t.certificates||Gl,value:new je({value:[ye.schema(),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ne]}),new T({idBlock:{tagClass:3,tagNumber:1},value:[new B]}),new T({idBlock:{tagClass:3,tagNumber:2},value:as.schema().valueBlock.value}),new T({idBlock:{tagClass:3,tagNumber:3},value:ka.schema().valueBlock.value})]})})]})}fromSchema(e){q(e,qA);const t=_(e,e,Us.schema());K.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],s=>{const a=s.idBlock.tagNumber;if(s.idBlock.tagClass===1)return new ye({schema:s});const n=new B({value:s.valueBlock.value});switch(a){case 1:return n.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec===1?new as({schema:n}):new nr({schema:n});case 2:return new as({schema:n});case 3:return new ka({schema:n})}return s})}toSchema(){return new it({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof ye:return e.toSchema();case e instanceof nr:return new T({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof as:return new T({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof ka:return new T({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}Us.CLASS_NAME="CertificateSet";const zl="otherRevInfoFormat",Xl="otherRevInfo",_A=[zl,Xl];class cr extends J{constructor(e={}){super(),this.otherRevInfoFormat=f(e,zl,cr.defaultValues(zl)),this.otherRevInfo=f(e,Xl,cr.defaultValues(Xl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zl:return E;case Xl:return new ne;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.otherRevInfoFormat||zl}),new ne({name:t.otherRevInfo||Xl})]})}fromSchema(e){q(e,_A);const t=_(e,e,cr.schema());K.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new B({value:[new Z({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof ne||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}cr.CLASS_NAME="OtherRevocationInfoFormat";const Yl="crls",Nf="otherRevocationInfos",WA=[Yl];class hr extends J{constructor(e={}){super(),this.crls=f(e,Yl,hr.defaultValues(Yl)),this.otherRevocationInfos=f(e,Nf,hr.defaultValues(Nf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yl:return[];case Nf:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new it({name:t.blockName||E,value:[new ue({name:t.crls||E,value:new je({value:[at.schema(),new T({idBlock:{tagClass:3,tagNumber:1},value:[new Z,new ne]})]})})]})}fromSchema(e){q(e,WA);const t=_(e,e,hr.schema({names:{crls:Yl}}));if(K.assertSchema(t,this.className),t.result.crls)for(const s of t.result.crls)s.idBlock.tagClass===1?this.crls.push(new at({schema:s})):this.otherRevocationInfos.push(new cr({schema:s}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const s=t.toSchema();return s.idBlock.tagClass=3,s.idBlock.tagNumber=1,s})),new it({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}hr.CLASS_NAME="RevocationInfoChoices";const Ql="certs",gn="crls",GA=[Ql,gn];class ti extends J{constructor(e={}){super(),this.crls=f(e,gn,ti.defaultValues(gn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ql:return new Us;case gn:return new hr;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ql:return t.certificates.length===0;case gn:return t.crls.length===0&&t.otherRevocationInfos.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new T({name:t.certs||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Us.schema().valueBlock.value}),new T({name:t.crls||E,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:hr.schema().valueBlock.value})]})}fromSchema(e){q(e,GA);const t=_(e,e,ti.schema({names:{certs:Ql,crls:gn}}));K.assertSchema(t,this.className),Ql in t.result&&(this.certs=new Us({schema:new it({value:t.result.certs.valueBlock.value})})),gn in t.result&&(this.crls=new hr({schema:new it({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new B({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}ti.CLASS_NAME="OriginatorInfo";const Zl="issuer",ec="serialNumber",zA=[Zl,ec];class et extends J{constructor(e={}){super(),this.issuer=f(e,Zl,et.defaultValues(Zl)),this.serialNumber=f(e,ec,et.defaultValues(ec)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zl:return new Ee;case ec:return new $;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[Ee.schema(t.issuer||{}),new $({name:t.serialNumber||E})]})}fromSchema(e){q(e,zA);const t=_(e,e,et.schema({names:{issuer:{names:{blockName:Zl}},serialNumber:ec}}));K.assertSchema(t,this.className),this.issuer=new Ee({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new B({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}et.CLASS_NAME="IssuerAndSerialNumber";const rh="variant",yu="value",XA=["blockName"];class Wo extends J{constructor(e={}){super(),this.variant=f(e,rh,Wo.defaultValues(rh)),yu in e&&(this.value=f(e,yu,Wo.defaultValues(yu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rh:return-1;case yu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case rh:return t===-1;case yu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new je({value:[et.schema({names:{blockName:t.blockName||E}}),new ae({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){q(e,XA);const t=_(e,e,Wo.schema({names:{blockName:"blockName"}}));K.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new et({schema:t.result.blockName})):(this.variant=2,this.value=new W({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof et))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof W))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new ae({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new ne}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&this.value&&(e.value=this.value.toJSON()),e}}Wo.CLASS_NAME="RecipientIdentifier";const wn="version",Ui="rid",ji="keyEncryptionAlgorithm",$i="encryptedKey",ah="recipientCertificate",YA=[wn,Ui,ji,$i];class Zt extends J{constructor(e={}){super(),this.version=f(e,wn,Zt.defaultValues(wn)),this.rid=f(e,Ui,Zt.defaultValues(Ui)),this.keyEncryptionAlgorithm=f(e,ji,Zt.defaultValues(ji)),this.encryptedKey=f(e,$i,Zt.defaultValues($i)),this.recipientCertificate=f(e,ah,Zt.defaultValues(ah)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wn:return-1;case Ui:return{};case ji:return new j;case $i:return new W;case ah:return new ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wn:return t===Zt.defaultValues(wn);case Ui:return Object.keys(t).length===0;case ji:case $i:return t.isEqual(Zt.defaultValues(e));case ah:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),Wo.schema(t.rid||{}),j.schema(t.keyEncryptionAlgorithm||{}),new W({name:t.encryptedKey||E})]})}fromSchema(e){q(e,YA);const t=_(e,e,Zt.schema({names:{version:wn,rid:{names:{blockName:Ui}},keyEncryptionAlgorithm:{names:{blockName:ji}},encryptedKey:$i}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,t.result.rid.idBlock.tagClass===3?this.rid=new W({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new et({schema:t.result.rid}),this.keyEncryptionAlgorithm=new j({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof et?(this.version=0,e.push(new $({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new $({value:this.version})),e.push(new ae({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new B({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Zt.CLASS_NAME="KeyTransRecipientInfo";const Mi="algorithm",Ki="publicKey",QA=[Mi,Ki];class ur extends J{constructor(e={}){super(),this.algorithm=f(e,Mi,ur.defaultValues(Mi)),this.publicKey=f(e,Ki,ur.defaultValues(Ki)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mi:return new j;case Ki:return new pe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mi:case Ki:return t.isEqual(ur.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[j.schema(t.algorithm||{}),new pe({name:t.publicKey||E})]})}fromSchema(e){q(e,QA);const t=_(e,e,ur.schema({names:{algorithm:{names:{blockName:Mi}},publicKey:Ki}}));K.assertSchema(t,this.className),this.algorithm=new j({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new B({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}ur.CLASS_NAME="OriginatorPublicKey";const nh="variant",vu="value",ZA=["blockName"];class mr extends J{constructor(e={}){super(),this.variant=f(e,nh,mr.defaultValues(nh)),vu in e&&(this.value=f(e,vu,mr.defaultValues(vu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nh:return-1;case vu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nh:return t===-1;case vu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new je({value:[et.schema({names:{blockName:t.blockName||E}}),new ae({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||E}),new T({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||E,value:ur.schema().valueBlock.value})]})}fromSchema(e){q(e,ZA);const t=_(e,e,mr.schema({names:{blockName:"blockName"}}));K.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new et({schema:t.result.blockName})):t.result.blockName.idBlock.tagNumber===0?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new ur({schema:new B({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new ne}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2||this.variant===3)&&(e.value=this.value.toJSON()),e}}mr.CLASS_NAME="OriginatorIdentifierOrKey";const Hi="keyAttrId",Ps="keyAttr",eS=[Hi,Ps];class Is extends J{constructor(e={}){super(),this.keyAttrId=f(e,Hi,Is.defaultValues(Hi)),Ps in e&&(this.keyAttr=f(e,Ps,Is.defaultValues(Ps))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hi:return E;case Ps:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Hi:return typeof t=="string"&&t===E;case Ps:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({optional:t.optional||!0,name:t.blockName||E,value:[new Z({name:t.keyAttrId||E}),new ne({optional:!0,name:t.keyAttr||E})]})}fromSchema(e){q(e,eS);const t=_(e,e,Is.schema({names:{keyAttrId:Hi,keyAttr:Ps}}));K.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),Ps in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new Z({value:this.keyAttrId})),Ps in this&&e.push(this.keyAttr),new B({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return Ps in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}Is.CLASS_NAME="OtherKeyAttribute";const yn="subjectKeyIdentifier",qr="date",_r="other",tS=[yn,qr,_r];class Ts extends J{constructor(e={}){super(),this.subjectKeyIdentifier=f(e,yn,Ts.defaultValues(yn)),qr in e&&(this.date=f(e,qr,Ts.defaultValues(qr))),_r in e&&(this.other=f(e,_r,Ts.defaultValues(_r))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yn:return new W;case qr:return new $e;case _r:return new Is;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case yn:return t.isEqual(Ts.defaultValues(yn));case qr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case _r:return t.keyAttrId===E&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new W({name:t.subjectKeyIdentifier||E}),new $e({optional:!0,name:t.date||E}),Is.schema(t.other||{})]})}fromSchema(e){q(e,tS);const t=_(e,e,Ts.schema({names:{subjectKeyIdentifier:yn,date:qr,other:{names:{blockName:_r}}}}));K.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,qr in t.result&&(this.date=t.result.date),_r in t.result&&(this.other=new Is({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new B({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}Ts.CLASS_NAME="RecipientKeyIdentifier";const ih="variant",oh="value",sS=["blockName"];class js extends J{constructor(e={}){super(),this.variant=f(e,ih,js.defaultValues(ih)),this.value=f(e,oh,js.defaultValues(oh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ih:return-1;case oh:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ih:return t===-1;case oh:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new je({value:[et.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||E}}),new T({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:0},value:Ts.schema(t.rKeyId||{names:{blockName:t.blockName||E}}).valueBlock.value})]})}fromSchema(e){q(e,sS);const t=_(e,e,js.schema({names:{blockName:"blockName"}}));K.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new et({schema:t.result.blockName})):(this.variant=2,this.value=new Ts({schema:new B({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new T({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new ne}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&(e.value=this.value.toJSON()),e}}js.CLASS_NAME="KeyAgreeRecipientIdentifier";const Fi="rid",vn="encryptedKey",rS=[Fi,vn];class lr extends J{constructor(e={}){super(),this.rid=f(e,Fi,lr.defaultValues(Fi)),this.encryptedKey=f(e,vn,lr.defaultValues(vn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fi:return new js;case vn:return new W;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Fi:return t.variant===-1&&!("value"in t);case vn:return t.isEqual(lr.defaultValues(vn));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[js.schema(t.rid||{}),new W({name:t.encryptedKey||E})]})}fromSchema(e){q(e,rS);const t=_(e,e,lr.schema({names:{rid:{names:{blockName:Fi}},encryptedKey:vn}}));K.assertSchema(t,this.className),this.rid=new js({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new B({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}lr.CLASS_NAME="RecipientEncryptedKey";const uh="encryptedKeys",ny="RecipientEncryptedKeys",aS=[ny];class Ia extends J{constructor(e={}){super(),this.encryptedKeys=f(e,uh,Ia.defaultValues(uh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uh:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uh:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.RecipientEncryptedKeys||E,value:lr.schema()})]})}fromSchema(e){q(e,aS);const t=_(e,e,Ia.schema({names:{RecipientEncryptedKeys:ny}}));K.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,s=>new lr({schema:s}))}toSchema(){return new B({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}Ia.CLASS_NAME="RecipientEncryptedKeys";const Ji="version",qi="originator",zs="ukm",_i="keyEncryptionAlgorithm",Wi="recipientEncryptedKeys",lh="recipientCertificate",ch="recipientPublicKey",nS=[Ji,qi,zs,_i,Wi];class Gt extends J{constructor(e={}){super(),this.version=f(e,Ji,Gt.defaultValues(Ji)),this.originator=f(e,qi,Gt.defaultValues(qi)),zs in e&&(this.ukm=f(e,zs,Gt.defaultValues(zs))),this.keyEncryptionAlgorithm=f(e,_i,Gt.defaultValues(_i)),this.recipientEncryptedKeys=f(e,Wi,Gt.defaultValues(Wi)),this.recipientCertificate=f(e,lh,Gt.defaultValues(lh)),this.recipientPublicKey=f(e,ch,Gt.defaultValues(ch)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ji:return 0;case qi:return new mr;case zs:return new W;case _i:return new j;case Wi:return new Ia;case lh:return new ye;case ch:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ji:return t===0;case qi:return t.variant===-1&&!("value"in t);case zs:return t.isEqual(Gt.defaultValues(zs));case _i:return t.algorithmId===E&&!("algorithmParams"in t);case Wi:return t.encryptedKeys.length===0;case lh:return!1;case ch:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),new T({idBlock:{tagClass:3,tagNumber:0},value:[mr.schema(t.originator||{})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new W({name:t.ukm||E})]}),j.schema(t.keyEncryptionAlgorithm||{}),Ia.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){q(e,nS);const t=_(e,e,Gt.schema({names:{version:Ji,originator:{names:{blockName:qi}},ukm:zs,keyEncryptionAlgorithm:{names:{blockName:_i}},recipientEncryptedKeys:{names:{blockName:Wi}}}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new mr({schema:t.result.originator}),zs in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new j({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new Ia({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new $({value:this.version})),e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new B({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}Gt.CLASS_NAME="KeyAgreeRecipientInfo";const bn="keyIdentifier",Wr="date",Gr="other",iS=[bn,Wr,Gr];class Ns extends J{constructor(e={}){super(),this.keyIdentifier=f(e,bn,Ns.defaultValues(bn)),Wr in e&&(this.date=f(e,Wr,Ns.defaultValues(Wr))),Gr in e&&(this.other=f(e,Gr,Ns.defaultValues(Gr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bn:return new W;case Wr:return new $e;case Gr:return new Is;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bn:return t.isEqual(Ns.defaultValues(bn));case Wr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Gr:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new W({name:t.keyIdentifier||E}),new $e({optional:!0,name:t.date||E}),Is.schema(t.other||{})]})}fromSchema(e){q(e,iS);const t=_(e,e,Ns.schema({names:{keyIdentifier:bn,date:Wr,other:{names:{blockName:Gr}}}}));K.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,Wr in t.result&&(this.date=t.result.date),Gr in t.result&&(this.other=new Is({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new B({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}Ns.CLASS_NAME="KEKIdentifier";const Gi="version",zi="kekid",Xi="keyEncryptionAlgorithm",An="encryptedKey",hh="preDefinedKEK",oS=[Gi,zi,Xi,An];class es extends J{constructor(e={}){super(),this.version=f(e,Gi,es.defaultValues(Gi)),this.kekid=f(e,zi,es.defaultValues(zi)),this.keyEncryptionAlgorithm=f(e,Xi,es.defaultValues(Xi)),this.encryptedKey=f(e,An,es.defaultValues(An)),this.preDefinedKEK=f(e,hh,es.defaultValues(hh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gi:return 0;case zi:return new Ns;case Xi:return new j;case An:return new W;case hh:return Qe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===es.defaultValues(Gi);case zi:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case Xi:return t.algorithmId===E&&!("algorithmParams"in t);case An:return t.isEqual(es.defaultValues(An));case hh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),Ns.schema(t.kekid||{}),j.schema(t.keyEncryptionAlgorithm||{}),new W({name:t.encryptedKey||E})]})}fromSchema(e){q(e,oS);const t=_(e,e,es.schema({names:{version:Gi,kekid:{names:{blockName:zi}},keyEncryptionAlgorithm:{names:{blockName:Xi}},encryptedKey:An}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new Ns({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new j({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new B({value:[new $({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}es.CLASS_NAME="KEKRecipientInfo";const Yi="version",zr="keyDerivationAlgorithm",Qi="keyEncryptionAlgorithm",Sn="encryptedKey",mh="password",uS=[Yi,zr,Qi,Sn];class cs extends J{constructor(e={}){super(),this.version=f(e,Yi,cs.defaultValues(Yi)),zr in e&&(this.keyDerivationAlgorithm=f(e,zr,cs.defaultValues(zr))),this.keyEncryptionAlgorithm=f(e,Qi,cs.defaultValues(Qi)),this.encryptedKey=f(e,Sn,cs.defaultValues(Sn)),this.password=f(e,mh,cs.defaultValues(mh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yi:return-1;case zr:return new j;case Qi:return new j;case Sn:return new W;case mh:return Qe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yi:return t===-1;case zr:case Qi:return t.algorithmId===E&&!("algorithmParams"in t);case Sn:return t.isEqual(cs.defaultValues(Sn));case mh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),new T({name:t.keyDerivationAlgorithm||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:j.schema().valueBlock.value}),j.schema(t.keyEncryptionAlgorithm||{}),new W({name:t.encryptedKey||E})]})}fromSchema(e){q(e,uS);const t=_(e,e,cs.schema({names:{version:Yi,keyDerivationAlgorithm:zr,keyEncryptionAlgorithm:{names:{blockName:Qi}},encryptedKey:Sn}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,zr in t.result&&(this.keyDerivationAlgorithm=new j({schema:new B({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new j({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new $({value:this.version})),this.keyDerivationAlgorithm&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new B({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}cs.CLASS_NAME="PasswordRecipientInfo";const Zi="oriType",Nn="oriValue",lS=[Zi,Nn];class Sa extends J{constructor(e={}){super(),this.oriType=f(e,Zi,Sa.defaultValues(Zi)),this.oriValue=f(e,Nn,Sa.defaultValues(Nn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zi:return E;case Nn:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Zi:return t===E;case Nn:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.oriType||E}),new ne({name:t.oriValue||E})]})}fromSchema(e){q(e,lS);const t=_(e,e,Sa.schema({names:{oriType:Zi,oriValue:Nn}}));K.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new B({value:[new Z({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return Sa.compareWithDefault(Nn,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}Sa.CLASS_NAME="OtherRecipientInfo";const fh="variant",bu="value",cS=["blockName"];class ms extends J{constructor(e={}){super(),this.variant=f(e,fh,ms.defaultValues(fh)),bu in e&&(this.value=f(e,bu,ms.defaultValues(bu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fh:return-1;case bu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fh:return t===ms.defaultValues(e);case bu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new je({value:[Zt.schema({names:{blockName:t.blockName||E}}),new T({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:1},value:Gt.schema().valueBlock.value}),new T({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:2},value:es.schema().valueBlock.value}),new T({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:3},value:cs.schema().valueBlock.value}),new T({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:4},value:Sa.schema().valueBlock.value})]})}fromSchema(e){q(e,cS);const t=_(e,e,ms.schema({names:{blockName:"blockName"}}));if(K.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1)this.variant=1,this.value=new Zt({schema:t.result.blockName});else{const s=new B({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new Gt({schema:s});break;case 2:this.variant=3,this.value=new es({schema:s});break;case 3:this.variant=4,this.value=new cs({schema:s});break;case 4:this.variant=5,this.value=new Sa({schema:s});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){ge.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new ne}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}ms.CLASS_NAME="RecipientInfo";const Xr="hashAlgorithm",Yr="maskGenAlgorithm",Qr="pSourceAlgorithm",hS=[Xr,Yr,Qr];class jt extends J{constructor(e={}){super(),this.hashAlgorithm=f(e,Xr,jt.defaultValues(Xr)),this.maskGenAlgorithm=f(e,Yr,jt.defaultValues(Yr)),this.pSourceAlgorithm=f(e,Qr,jt.defaultValues(Qr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xr:return new j({algorithmId:"1.3.14.3.2.26",algorithmParams:new nt});case Yr:return new j({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new j({algorithmId:"1.3.14.3.2.26",algorithmParams:new nt}).toSchema()});case Qr:return new j({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new W({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new T({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[j.schema(t.hashAlgorithm||{})]}),new T({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[j.schema(t.maskGenAlgorithm||{})]}),new T({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[j.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){q(e,hS);const t=_(e,e,jt.schema({names:{hashAlgorithm:{names:{blockName:Xr}},maskGenAlgorithm:{names:{blockName:Yr}},pSourceAlgorithm:{names:{blockName:Qr}}}}));K.assertSchema(t,this.className),Xr in t.result&&(this.hashAlgorithm=new j({schema:t.result.hashAlgorithm})),Yr in t.result&&(this.maskGenAlgorithm=new j({schema:t.result.maskGenAlgorithm})),Qr in t.result&&(this.pSourceAlgorithm=new j({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(jt.defaultValues(Xr))||e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(jt.defaultValues(Yr))||e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(jt.defaultValues(Qr))||e.push(new T({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new B({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(jt.defaultValues(Xr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(jt.defaultValues(Yr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(jt.defaultValues(Qr))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}jt.CLASS_NAME="RSAESOAEPParams";const eo="keyInfo",Zr="entityUInfo",to="suppPubInfo",mS=[eo,Zr,to];class sr extends J{constructor(e={}){super(),this.keyInfo=f(e,eo,sr.defaultValues(eo)),Zr in e&&(this.entityUInfo=f(e,Zr,sr.defaultValues(Zr))),this.suppPubInfo=f(e,to,sr.defaultValues(to)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eo:return new j;case Zr:return new W;case to:return new W;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case eo:case Zr:case to:return t.isEqual(sr.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[j.schema(t.keyInfo||{}),new T({name:t.entityUInfo||E,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new W]}),new T({name:t.suppPubInfo||E,idBlock:{tagClass:3,tagNumber:2},value:[new W]})]})}fromSchema(e){q(e,mS);const t=_(e,e,sr.schema({names:{keyInfo:{names:{blockName:eo}},entityUInfo:Zr,suppPubInfo:to}}));K.assertSchema(t,this.className),this.keyInfo=new j({schema:t.result.keyInfo}),Zr in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new T({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new B({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}sr.CLASS_NAME="ECCCMSSharedInfo";const so="version",ea="originatorInfo",ro="recipientInfos",ao="encryptedContentInfo",ta="unprotectedAttrs",fS=[so,ea,ro,ao,ta],Pg={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},pS={"P-256":256,"P-384":384,"P-521":528};class As extends J{constructor(e={}){super(),this.version=f(e,so,As.defaultValues(so)),ea in e&&(this.originatorInfo=f(e,ea,As.defaultValues(ea))),this.recipientInfos=f(e,ro,As.defaultValues(ro)),this.encryptedContentInfo=f(e,ao,As.defaultValues(ao)),ta in e&&(this.unprotectedAttrs=f(e,ta,As.defaultValues(ta))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case so:return 0;case ea:return new ti;case ro:return[];case ao:return new We;case ta:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case so:return t===As.defaultValues(e);case ea:return t.certs.certificates.length===0&&t.crls.crls.length===0;case ro:case ta:return t.length===0;case ao:return We.compareWithDefault("contentType",t.contentType)&&We.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&We.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||E}),new T({name:t.originatorInfo||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:ti.schema().valueBlock.value}),new it({value:[new ue({name:t.recipientInfos||E,value:ms.schema()})]}),We.schema(t.encryptedContentInfo||{}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ue({name:t.unprotectedAttrs||E,value:Ve.schema()})]})]})}fromSchema(e){q(e,fS);const t=_(e,e,As.schema({names:{version:so,originatorInfo:ea,recipientInfos:ro,encryptedContentInfo:{names:{blockName:ao}},unprotectedAttrs:ta}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,ea in t.result&&(this.originatorInfo=new ti({schema:new B({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,s=>new ms({schema:s})),this.encryptedContentInfo=new We({schema:t.result.encryptedContentInfo}),ta in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new Ve({schema:s})))}toSchema(){const e=[];return e.push(new $({value:this.version})),this.originatorInfo&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new it({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new B({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,s,a=ce(!0)){const n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},Pg,t||{});if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549")!==-1)s=1;else if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045")!==-1)s=2;else throw new Error("Unknown type of certificate's public key: ".concat(e.subjectPublicKeyInfo.algorithm.algorithmId));switch(s){case 1:{let i,o;if(n.useOAEP===!0){i=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const h=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),l=new j({algorithmId:h,algorithmParams:new nt});o=new jt({hashAlgorithm:l,maskGenAlgorithm:new j({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:l.toSchema()})}).toSchema()}else{if(i=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),i===E)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");o=new nt}const u=new Zt({version:0,rid:new et({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new j({algorithmId:i,algorithmParams:o}),recipientCertificate:e});this.recipientInfos.push(new ms({variant:1,value:u}))}break;case 2:{const i=new js({variant:1,value:new et({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(i,n,{recipientCertificate:e},a)}break;default:throw new Error('Unknown "variant" value: '.concat(s))}return!0}addRecipientByPreDefinedData(e,t={},s,a=ce(!0)){if(Ne.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const n=new ArrayBuffer(16),i=new Uint8Array(n);a.getRandomValues(i),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),t.iterationCount===void 0&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new nt),s){case 1:{const n=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),i=new es({version:4,kekid:new Ns({keyIdentifier:new W({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new j({algorithmId:n,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new ms({variant:3,value:i}))}break;case 2:{const n=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),i=new ArrayBuffer(64),o=new Uint8Array(i);a.getRandomValues(o);const u=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),h=new Ot({salt:new W({valueHex:i}),iterationCount:t.iterationCount,prf:new j({algorithmId:u,algorithmParams:new nt})}),l=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),d=new cs({version:0,keyDerivationAlgorithm:new j({algorithmId:n,algorithmParams:h.toSchema()}),keyEncryptionAlgorithm:new j({algorithmId:l,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new ms({variant:4,value:d}))}break;default:throw new Error('Unknown value for "variant": '.concat(s))}}addRecipientByKeyIdentifier(e,t,s,a=ce(!0)){const n=Object.assign({},Pg,s||{}),i=new js({variant:2,value:new Ts({subjectKeyIdentifier:new W({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,n,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,s,a=ce(!0)){const n=new lr({rid:e}),i=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),o=new j({algorithmId:i}),u=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),h=new ArrayBuffer(64),l=new Uint8Array(h);a.getRandomValues(l);const d={version:3,ukm:new W({valueHex:h}),keyEncryptionAlgorithm:new j({algorithmId:u,algorithmParams:o.toSchema()}),recipientEncryptedKeys:new Ia({encryptedKeys:[n]})},m=new Gt(Object.assign(d,s));this.recipientInfos.push(new ms({variant:2,value:m}))}async encrypt(e,t,s=ce(!0)){const a=new ArrayBuffer(16),n=new Uint8Array(a);s.getRandomValues(n);const i=new Uint8Array(t),o=s.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),u=await s.generateKey(e,!0,["encrypt"]),h=await s.encrypt({name:e.name,iv:n},u,i),l=await s.exportKey("raw",u);this.version=2,this.encryptedContentInfo=new We({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new j({algorithmId:o,algorithmParams:new W({valueHex:a})}),encryptedContent:new W({valueHex:h})});const d=async g=>{const S=this.recipientInfos[g].value;let A,k;if(S.recipientPublicKey)A=S.recipientPublicKey.algorithm.namedCurve,k=S.recipientPublicKey;else if(S.recipientCertificate){const de=S.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(de.constructor.blockName()!==Z.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(g));switch(de.valueBlock.toString()){case"1.2.840.10045.3.1.7":A="P-256";break;case"1.3.132.0.34":A="P-384";break;case"1.3.132.0.35":A="P-521";break;default:throw new Error("Incorrect curve OID for index ".concat(g))}k=await S.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:A},usages:[]}},s)}else throw new Error("Unsupported RecipientInfo");const C=pS[A],V=await s.generateKey({name:"ECDH",namedCurve:A},!0,["deriveBits"]),M=await s.exportKey("spki",V.publicKey),U=await s.deriveBits({name:"ECDH",public:k},V.privateKey,C),H=new j({schema:S.keyEncryptionAlgorithm.algorithmParams}),x=s.getAlgorithmByOID(H.algorithmId,!0,"aesKWAlgorithm");let Y=x.length;const ee=new ArrayBuffer(4),O=new Uint8Array(ee);for(let de=3;de>=0;de--)O[de]=Y,Y>>=8;const G=new sr({keyInfo:new j({algorithmId:H.algorithmId}),entityUInfo:S.ukm,suppPubInfo:new W({valueHex:ee})}).toSchema().toBER(!1),we=s.getAlgorithmByOID(S.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),le=await yg(we.kdf,U,x.length,G,s),Se=await s.importKey("raw",le,{name:"AES-KW"},!0,["wrapKey"]),re=await s.wrapKey("raw",u,Se,{name:"AES-KW"}),be=new mr;return be.variant=3,be.value=ur.fromBER(M),S.originator=be,S.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new W({valueHex:re}),{ecdhPrivateKey:V.privateKey}},m=async g=>{const S=this.recipientInfos[g].value,A=s.getAlgorithmByOID(S.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(A.name==="RSA-OAEP"){const k=S.keyEncryptionAlgorithm.algorithmParams,C=new jt({schema:k});if(A.hash=s.getAlgorithmByOID(C.hashAlgorithm.algorithmId),!("name"in A.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(C.hashAlgorithm.algorithmId))}try{const k=await S.recipientCertificate.getPublicKey({algorithm:{algorithm:A,usages:["encrypt","wrapKey"]}},s),C=await s.encrypt(k.algorithm,k,l);S.encryptedKey=new W({valueHex:C})}catch(k){}},N=async g=>{const S=this.recipientInfos[g].value,A=s.getAlgorithmByOID(S.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),k=await s.importKey("raw",new Uint8Array(S.preDefinedKEK),A,!0,["wrapKey"]),C=await s.wrapKey("raw",u,k,A);S.encryptedKey=new W({valueHex:C})},y=async g=>{const S=this.recipientInfos[g].value;let A;if(!S.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!S.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{A=new Ot({schema:S.keyDerivationAlgorithm.algorithmParams})}catch(ee){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const k=new Uint8Array(S.password),C=await s.importKey("raw",k,"PBKDF2",!1,["deriveKey"]),V=s.getAlgorithmByOID(S.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let M="SHA-1";A.prf&&(M=s.getAlgorithmByOID(A.prf.algorithmId,!0,"prfAlgorithm").hash.name);const U=new Uint8Array(A.salt.valueBlock.valueHex),H=A.iterationCount,x=await s.deriveKey({name:"PBKDF2",hash:{name:M},salt:U,iterations:H},C,V,!0,["wrapKey"]),Y=await s.wrapKey("raw",u,x,V);S.encryptedKey=new W({valueHex:Y})},w=[];for(let g=0;g<this.recipientInfos.length;g++)switch(this.recipientInfos[g].variant){case 1:w.push(await m(g));break;case 2:w.push(await d(g));break;case 3:w.push(await N(g));break;case 4:w.push(await y(g));break;default:throw new Error("Unknown recipient type in array with index ".concat(g))}return w}async decrypt(e,t,s=ce(!0)){const a=t||{};if(e+1>this.recipientInfos.length)throw new Error('Maximum value for "index" is: '.concat(this.recipientInfos.length-1));const n=async w=>{const g=this.recipientInfos[w].value;let S,A,k;const C=g.originator;if(a.recipientCertificate){const le=a.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(le.constructor.blockName()!==Z.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(w));S=le.valueBlock.toString()}else if(C.value.algorithm.algorithmParams){const le=C.value.algorithm.algorithmParams;if(le.constructor.blockName()!==Z.blockName())throw new Error("Incorrect originator for index ".concat(w));S=le.valueBlock.toString()}else throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(S){case"1.2.840.10045.3.1.7":A="P-256",k=256;break;case"1.3.132.0.34":A="P-384",k=384;break;case"1.3.132.0.35":A="P-521",k=528;break;default:throw new Error("Incorrect curve OID for index ".concat(w))}let V,M=s;xe.isBufferSource(a.recipientPrivateKey)?V=await s.importKey("pkcs8",a.recipientPrivateKey,{name:"ECDH",namedCurve:A},!0,["deriveBits"]):(V=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(M=a.crypto.subtle)),"algorithmParams"in C.value.algorithm||(C.value.algorithm.algorithmParams=new Z({value:S}));const U=C.value.toSchema().toBER(!1),H=await s.importKey("spki",U,{name:"ECDH",namedCurve:A},!0,[]),x=await M.deriveBits({name:"ECDH",public:H},V,k);async function Y(le){le=le||!1;const Se=new j({schema:g.keyEncryptionAlgorithm.algorithmParams}),re=s.getAlgorithmByOID(Se.algorithmId,!0,"kwAlgorithm");let be=re.length;const de=new ArrayBuffer(4),te=new Uint8Array(de);for(let he=3;he>=0;he--)te[he]=be,be>>=8;const se={algorithmId:Se.algorithmId};le&&(se.algorithmParams=new nt);const Q=new sr({keyInfo:new j(se),entityUInfo:g.ukm,suppPubInfo:new W({valueHex:de})}).toSchema().toBER(!1),ie=s.getAlgorithmByOID(g.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!ie.name)throw new Error("Incorrect OID for key encryption algorithm: ".concat(g.keyEncryptionAlgorithm.algorithmId));return yg(ie.kdf,x,re.length,Q,s)}const ee=await Y(),O=async le=>s.importKey("raw",le,{name:"AES-KW"},!0,["unwrapKey"]),G=await O(ee),we=async le=>{const Se=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,re=s.getAlgorithmByOID(Se,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",g.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,le,{name:"AES-KW"},re,!0,["decrypt"])};try{return await we(G)}catch(le){const Se=await Y(!0),re=await O(Se);return we(re)}},i=async w=>{const g=this.recipientInfos[w].value;if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const S=s.getAlgorithmByOID(g.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(S.name==="RSA-OAEP"){const U=g.keyEncryptionAlgorithm.algorithmParams,H=new jt({schema:U});if(S.hash=s.getAlgorithmByOID(H.hashAlgorithm.algorithmId),!("name"in S.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(H.hashAlgorithm.algorithmId))}let A,k=s;xe.isBufferSource(a.recipientPrivateKey)?A=await s.importKey("pkcs8",a.recipientPrivateKey,S,!0,["decrypt"]):(A=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(k=a.crypto.subtle));const C=await k.decrypt(A.algorithm,A,g.encryptedKey.valueBlock.valueHexView),V=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,M=s.getAlgorithmByOID(V,!0,"contentEncryptionAlgorithm");if(!("name"in M))throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(V));return s.importKey("raw",C,M,!0,["decrypt"])},o=async w=>{const g=this.recipientInfos[w].value;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const S=s.getAlgorithmByOID(g.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),A=await s.importKey("raw",a.preDefinedData,S,!0,["unwrapKey"]),k=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,C=s.getAlgorithmByOID(k,!0,"contentEncryptionAlgorithm");if(!C.name)throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(k));return s.unwrapKey("raw",g.encryptedKey.valueBlock.valueHexView,A,S,C,!0,["decrypt"])},u=async w=>{const g=this.recipientInfos[w].value;let S;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!g.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!g.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{S=new Ot({schema:g.keyDerivationAlgorithm.algorithmParams})}catch(Y){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const A=await s.importKey("raw",a.preDefinedData,"PBKDF2",!1,["deriveKey"]),k=s.getAlgorithmByOID(g.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),C=S.prf?s.getAlgorithmByOID(S.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",V=new Uint8Array(S.salt.valueBlock.valueHex),M=S.iterationCount,U=await s.deriveKey({name:"PBKDF2",hash:{name:C},salt:V,iterations:M},A,k,!0,["unwrapKey"]),H=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,x=s.getAlgorithmByOID(H,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",g.encryptedKey.valueBlock.valueHexView,U,k,x,!0,["decrypt"])};let h;switch(this.recipientInfos[e].variant){case 1:h=await i(e);break;case 2:h=await n(e);break;case 3:h=await o(e);break;case 4:h=await u(e);break;default:throw new Error("Unknown recipient type in array with index ".concat(e))}const l=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,d=s.getAlgorithmByOID(l,!0,"contentEncryptionAlgorithm"),m=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,N=new Uint8Array(m);if(!this.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const y=this.encryptedContentInfo.getEncryptedContent();return s.decrypt({name:d.name,iv:N},h,y)}}As.CLASS_NAME="EnvelopedData";const hi="safeContents",Au="parsedValue",Og="contentInfos";class si extends J{constructor(e={}){super(),this.safeContents=f(e,hi,si.defaultValues(hi)),Au in e&&(this.parsedValue=f(e,Au,si.defaultValues(Au))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hi:return[];case Au:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hi:return t.length===0;case Au:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new ue({name:t.contentInfos||E,value:Ie.schema()})]})}fromSchema(e){q(e,[Og]);const t=_(e,e,si.schema({names:{contentInfos:Og}}));K.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,s=>new Ie({schema:s}))}toSchema(){return new B({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=ce(!0)){if(ge.assert(e,hi),Ne.assert(e.safeContents,hi,"Array"),e.safeContents.length!==this.safeContents.length)throw new Ne('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');this.parsedValue={safeContents:[]};for(const[s,a]of this.safeContents.entries()){const n=e.safeContents[s],i="parameters.safeContents[".concat(s,"]");switch(a.contentType){case Mp:{Ne.assert(a.content,"this.safeContents[j].content",W);const o=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:or.fromBER(o)})}break;case Yw:{const o=new As({schema:a.content});ge.assert(i,n,"recipientCertificate","recipientKey");const u=n,h=u.recipientCertificate,l=u.recipientKey,d=await o.decrypt(0,{recipientCertificate:h,recipientPrivateKey:l},t);this.parsedValue.safeContents.push({privacyMode:2,value:or.fromBER(d)})}break;case Qw:{const o=new Ls({schema:a.content});ge.assert(i,n,"password");const u=n.password,h=await o.decrypt({password:u},t);this.parsedValue.safeContents.push({privacyMode:1,value:or.fromBER(h)})}break;default:throw new Error('Unknown "contentType" for AuthenticatedSafe: " '.concat(a.contentType))}}}async makeInternalValues(e,t=ce(!0)){if(!this.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(Ne.assert(this.parsedValue,"this.parsedValue","object"),Ne.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),Ne.assert(e,"parameters","object"),ge.assert(e,"safeContents"),Ne.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new Ne('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');this.safeContents=[];for(const[s,a]of this.parsedValue.safeContents.entries())switch(ge.assert("content",a,"privacyMode","value"),Ne.assert(a.value,"content.value",or),a.privacyMode){case 0:{const n=a.value.toSchema().toBER(!1);this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.1",content:new W({valueHex:n})}))}break;case 1:{const n=new Ls,i=e.safeContents[s];i.contentToEncrypt=a.value.toSchema().toBER(!1),await n.encrypt(i,t),this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.6",content:n.toSchema()}))}break;case 2:{const n=new As,i=a.value.toSchema().toBER(!1),o=e.safeContents[s];switch(ge.assert("parameters.safeContents[".concat(s,"]"),o,"encryptingCertificate","encryptionAlgorithm"),!0){case o.encryptionAlgorithm.name.toLowerCase()==="aes-cbc":case o.encryptionAlgorithm.name.toLowerCase()==="aes-gcm":break;default:throw new Error('Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": '.concat(o.encryptionAlgorithm))}switch(!0){case o.encryptionAlgorithm.length===128:case o.encryptionAlgorithm.length===192:case o.encryptionAlgorithm.length===256:break;default:throw new Error('Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": '.concat(o.encryptionAlgorithm.length))}const u=o.encryptionAlgorithm;n.addRecipientByCertificate(o.encryptingCertificate,{},void 0,t),await n.encrypt(u,i,t),this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.3",content:n.toSchema()}))}break;default:throw new Error('Incorrect value for "content.privacyMode": '.concat(a.privacyMode))}return this}}si.CLASS_NAME="AuthenticatedSafe";const En="hashAlgorithm",no="issuerNameHash",io="issuerKeyHash",kn="serialNumber",dS=[En,no,io,kn];class ze extends J{static async create(e,t,s=ce(!0)){const a=new ze;return await a.createForCertificate(e,t,s),a}constructor(e={}){super(),this.hashAlgorithm=f(e,En,ze.defaultValues(En)),this.issuerNameHash=f(e,no,ze.defaultValues(no)),this.issuerKeyHash=f(e,io,ze.defaultValues(io)),this.serialNumber=f(e,kn,ze.defaultValues(kn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case En:return new j;case no:case io:return new W;case kn:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case En:return t.algorithmId===E&&!("algorithmParams"in t);case no:case io:case kn:return t.isEqual(ze.defaultValues(kn));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[j.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||E}}),new W({name:t.issuerNameHash||E}),new W({name:t.issuerKeyHash||E}),new $({name:t.serialNumber||E})]})}fromSchema(e){q(e,dS);const t=_(e,e,ze.schema({names:{hashAlgorithm:En,issuerNameHash:no,issuerKeyHash:io,serialNumber:kn}}));K.assertSchema(t,this.className),this.hashAlgorithm=new j({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new B({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!xe.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!xe.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,s=ce(!0)){ge.assert(t,En,"issuerCertificate");const a=s.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new j({algorithmId:a,algorithmParams:new nt});const n=t.issuerCertificate;this.serialNumber=e.serialNumber;const i=await s.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1));this.issuerNameHash=new W({valueHex:i});const o=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,u=await s.digest({name:t.hashAlgorithm},o);this.issuerKeyHash=new W({valueHex:u})}}ze.CLASS_NAME="CertID";const oo="certID",uo="certStatus",lo="thisUpdate",sa="nextUpdate",In="singleExtensions",gS=[oo,uo,lo,sa,In];class Ss extends J{constructor(e={}){super(),this.certID=f(e,oo,Ss.defaultValues(oo)),this.certStatus=f(e,uo,Ss.defaultValues(uo)),this.thisUpdate=f(e,lo,Ss.defaultValues(lo)),sa in e&&(this.nextUpdate=f(e,sa,Ss.defaultValues(sa))),In in e&&(this.singleExtensions=f(e,In,Ss.defaultValues(In))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oo:return new ze;case uo:return{};case lo:case sa:return new Date(0,0,0);case In:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oo:return ze.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&ze.compareWithDefault("issuerNameHash",t.issuerNameHash)&&ze.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&ze.compareWithDefault("serialNumber",t.serialNumber);case uo:return Object.keys(t).length===0;case lo:case sa:return t===Ss.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[ze.schema(t.certID||{}),new je({value:[new ae({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:0}}),new T({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:1},value:[new $e,new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Cc]})]}),new ae({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new $e({name:t.thisUpdate||E}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $e({name:t.nextUpdate||E})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Ze.schema(t.singleExtensions||{})]})]})}fromSchema(e){q(e,gS);const t=_(e,e,Ss.schema({names:{certID:{names:{blockName:oo}},certStatus:uo,thisUpdate:lo,nextUpdate:sa,singleExtensions:{names:{blockName:In}}}}));K.assertSchema(t,this.className),this.certID=new ze({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),sa in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),In in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,s=>new Ge({schema:s})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new $e({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[new $e({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new B({value:Array.from(this.singleExtensions,t=>t.toSchema())})),new B({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}Ss.CLASS_NAME="SingleResponse";const ph="tbs",Cn="version",tc="responderID",sc="producedAt",rc="responses",co="responseExtensions",ai="ResponseData",Vh="".concat(ai,".").concat(Cn),ho="".concat(ai,".").concat(tc),sp="".concat(ai,".").concat(sc),rp="".concat(ai,".").concat(rc),Ph="".concat(ai,".").concat(co),wS=[ai,Vh,ho,sp,rp,Ph];class ht extends J{get tbs(){return xe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,ph,ht.defaultValues(ph))),Cn in e&&(this.version=f(e,Cn,ht.defaultValues(Cn))),this.responderID=f(e,tc,ht.defaultValues(tc)),this.producedAt=f(e,sc,ht.defaultValues(sc)),this.responses=f(e,rc,ht.defaultValues(rc)),co in e&&(this.responseExtensions=f(e,co,ht.defaultValues(co))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cn:return 0;case ph:return Qe;case tc:return{};case sc:return new Date(0,0,0);case rc:case co:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ph:return t.byteLength===0;case tc:return Object.keys(t).length===0;case sc:return t===ht.defaultValues(e);case rc:case co:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||ai,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $({name:t.version||Vh})]}),new je({value:[new T({name:t.responderID||ho,idBlock:{tagClass:3,tagNumber:1},value:[Ee.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new T({name:t.responderID||ho,idBlock:{tagClass:3,tagNumber:2},value:[new W({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new $e({name:t.producedAt||sp}),new B({value:[new ue({name:rp,value:Ss.schema(t.response||{})})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Ze.schema(t.extensions||{names:{blockName:Ph}})]})]})}fromSchema(e){q(e,wS);const t=_(e,e,ht.schema());K.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,Vh in t.result&&(this.version=t.result[Vh].valueBlock.valueDec),t.result[ho].idBlock.tagNumber===1?this.responderID=new Ee({schema:t.result[ho].valueBlock.value[0]}):this.responderID=t.result[ho].valueBlock.value[0],this.producedAt=t.result[sp].toDate(),this.responses=Array.from(t.result[rp],s=>new Ss({schema:s})),Ph in t.result&&(this.responseExtensions=Array.from(t.result[Ph].valueBlock.value,s=>new Ge({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return ht.schema();const s=Ye(this.tbsView);K.assert(s,"TBS Response Data"),t=s.result}else{const s=[];Cn in this&&s.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[new $({value:this.version})]})),this.responderID instanceof Ee?s.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):s.push(new T({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),s.push(new $e({valueDate:this.producedAt})),s.push(new B({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&s.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[new B({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new B({value:s})}return t}toJSON(){const e={};return Cn in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}ht.CLASS_NAME="ResponseData";const Ef="trustedCerts",kf="certs",If="crls",Cf="ocsps",Bf="checkDate",xf="findOrigin",Vf="findIssuer";var jn;(function(r){r[r.unknown=-1]="unknown",r[r.success=0]="success",r[r.noRevocation=11]="noRevocation",r[r.noPath=60]="noPath",r[r.noValidPath=97]="noValidPath"})(jn||(jn={}));class fa extends Error{constructor(e,t){super(t),this.name=fa.NAME,this.code=e,this.message=t}}fa.NAME="ChainValidationError";function yS(r,e){for(let t=0;t<e.length;t++)if(xe.isEqual(r.tbsView,e[t].tbsView))return!0;return!1}class Im{constructor(e={}){this.trustedCerts=f(e,Ef,this.defaultValues(Ef)),this.certs=f(e,kf,this.defaultValues(kf)),this.crls=f(e,If,this.defaultValues(If)),this.ocsps=f(e,Cf,this.defaultValues(Cf)),this.checkDate=f(e,Bf,this.defaultValues(Bf)),this.findOrigin=f(e,xf,this.defaultValues(xf)),this.findIssuer=f(e,Vf,this.defaultValues(Vf))}static defaultFindOrigin(e,t){e.tbsView.byteLength===0&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));for(const s of t.certs)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),xe.isEqual(e.tbsView,s.tbsView))return"Intermediate Certificates";for(const s of t.trustedCerts)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),xe.isEqual(e.tbsView,s.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,s=ce(!0)){const a=[];let n=null,i=null,o=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,s))return[e]}catch(h){}if(e.extensions){for(const h of e.extensions)if(h.extnID===jp&&h.parsedValue instanceof ya){h.parsedValue.keyIdentifier?n=h.parsedValue.keyIdentifier:(h.parsedValue.authorityCertIssuer&&(i=h.parsedValue.authorityCertIssuer),h.parsedValue.authorityCertSerialNumber&&(o=h.parsedValue.authorityCertSerialNumber));break}}function u(h){if(n!==null&&h.extensions){let d=!1;for(const m of h.extensions)if(m.extnID===Sb&&m.parsedValue){d=!0,xe.isEqual(m.parsedValue.valueBlock.valueHex,n.valueBlock.valueHexView)&&a.push(h);break}if(d)return}let l=!1;o!==null&&(l=h.serialNumber.isEqual(o)),i!==null?h.subject.isEqual(i)&&l&&a.push(h):e.issuer.isEqual(h.subject)&&a.push(h)}for(const h of t.trustedCerts)u(h);for(const h of t.certs)u(h);for(let h=a.length-1;h>=0;h--)try{await e.verify(a[h],s)===!1&&a.splice(h,1)}catch(l){a.splice(h,1)}return a}defaultValues(e){switch(e){case Ef:return[];case kf:return[];case If:return[];case Cf:return[];case Bf:return new Date;case xf:return Im.defaultFindOrigin;case Vf:return this.defaultFindIssuer;default:throw new Error("Invalid member name for CertificateChainValidationEngine class: ".concat(e))}}async sort(e=!1,t=ce(!0)){const s=[],a=async(y,w)=>{const g=[];function S(k){let C=!0;for(let V=0;V<k.length;V++){for(let M=0;M<k.length;M++)if(M!==V&&k[V]===k[M]){C=!1;break}if(!C)break}return C}if(yS(y,this.trustedCerts))return[[y]];const A=await this.findIssuer(y,this,w);if(A.length===0)throw new Error("No valid certificate paths found");for(let k=0;k<A.length;k++){if(xe.isEqual(A[k].tbsView,y.tbsView)){g.push([A[k]]);continue}const C=await a(A[k],w);for(let V=0;V<C.length;V++){const M=C[V].slice();M.splice(0,0,A[k]),S(M)?g.push(M):g.push(C[V])}}return g},n=async y=>{const w=[],g=[],S=[];if(w.push(...s.filter(A=>y.issuer.isEqual(A.subject))),w.length===0)return{status:1,statusMessage:"No certificate's issuers"};if(g.push(...this.crls.filter(A=>A.issuer.isEqual(y.issuer))),g.length===0)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let A=0;A<g.length;A++){const k=g[A];if(!(k.nextUpdate&&k.nextUpdate.value<this.checkDate))for(let C=0;C<w.length;C++)try{if(await g[A].verify({issuerCertificate:w[C]},t)){S.push({crl:g[A],certificate:w[C]});break}}catch(V){}}return S.length?{status:0,statusMessage:E,result:S}:{status:3,statusMessage:"No valid CRLs found"}},i=async(y,w)=>{const g=t.getAlgorithmByOID(y.signatureAlgorithm.algorithmId);if(!g.name||!g.hash)return 1;for(let S=0;S<this.ocsps.length;S++){const A=await this.ocsps[S].getCertificateStatus(y,w,t);if(A.isForCertificate)return A.status===0?0:1}return 2};async function o(y,w=!1){let g=!1,S=!1,A=!1,k=!1;if(y.extensions){for(let C=0;C<y.extensions.length;C++){const V=y.extensions[C];if(V.critical&&!V.parsedValue)return{result:!1,resultCode:6,resultMessage:"Unable to parse critical certificate extension: ".concat(V.extnID)};if(V.extnID===Nb){A=!0;const M=new Uint8Array(V.parsedValue.valueBlock.valueHex);(M[0]&4)===4&&(S=!0),(M[0]&2)===2&&(k=!0)}V.extnID===Lp&&"cA"in V.parsedValue&&V.parsedValue.cA===!0&&(g=!0)}if(S===!0&&g===!1)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(A===!0&&g===!0&&S===!1)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(g===!0&&A===!0&&w&&k===!1)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return g===!1?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:E}}const u=async(y,w)=>{for(let g=0;g<y.length;g++)if(y[g].notBefore.value>w||y[g].notAfter.value<w)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(y.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let g=y.length-2;g>=0;g--)if(y[g].issuer.isEqual(y[g].subject)===!1&&y[g].issuer.isEqual(y[g+1].subject)===!1)return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(this.crls.length!==0||this.ocsps.length!==0)for(let g=0;g<y.length-1;g++){let S=2,A={status:0,statusMessage:E};if(this.ocsps.length!==0)switch(S=await i(y[g],y[g+1]),S){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(this.crls.length!==0){if(A=await n(y[g]),A.status===0&&A.result)for(let k=0;k<A.result.length;k++){if(A.result[k].crl.isCertificateRevoked(y[g]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if((await o(A.result[k].certificate,!0)).result===!1)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(e===!1)throw new fa(jn.noRevocation,"No revocation values found for one of certificates: ".concat(A.statusMessage))}else if(S===2)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(S===2&&A.status===2&&e){const k=y[g+1];let C=!1;if(k.extensions)for(const V of k.extensions)switch(V.extnID){case _w:case Up:case $p:C=!0;break}if(C)throw new fa(jn.noRevocation,"No revocation values found for one of certificates: ".concat(A.statusMessage))}}for(const[g,S]of y.entries())if(g&&!(await o(S)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}};s.push(...this.trustedCerts),s.push(...this.certs);for(let y=0;y<s.length;y++)for(let w=0;w<s.length;w++)if(y!==w&&xe.isEqual(s[y].tbsView,s[w].tbsView)){s.splice(w,1),y=0;break}const h=s[s.length-1];let l;const d=[h];if(l=await a(h,t),l.length===0)throw new fa(jn.noPath,"Unable to find certificate path");for(let y=l.length-1;y>=0;y--){let w=!1;for(let g=0;g<l[y].length;g++){const S=l[y][g];for(let A=0;A<this.trustedCerts.length;A++)if(xe.isEqual(S.tbsView,this.trustedCerts[A].tbsView)){w=!0;break}if(w)break}w||l.splice(y,1)}if(l.length===0)throw new fa(jn.noValidPath,"No valid certificate paths found");let m=l[0].length,N=0;for(let y=0;y<l.length;y++)l[y].length<m&&(m=l[y].length,N=y);for(let y=0;y<l[N].length;y++)d.push(l[N][y]);if(l=await u(d,this.checkDate),l.result===!1)throw l;return d}async verify(e={},t=ce(!0)){function s(u,h){const l=la(u),d=la(h),m=l.split("."),N=d.split("."),y=m.length,w=N.length;if(y===0||w===0||y<w)return!1;for(let g=0;g<y;g++)if(m[g].length===0)return!1;for(let g=0;g<w;g++)if(N[g].length===0){if(g===0){if(w===1)return!1;continue}return!1}for(let g=0;g<w;g++)if(N[w-1-g].length!==0&&m[y-1-g].localeCompare(N[w-1-g])!==0)return!1;return!0}function a(u,h){const l=la(u),d=la(h),m=l.split("@"),N=d.split("@");if(m.length===0||N.length===0||m.length<N.length)return!1;if(N.length===1){if(s(m[1],N[0])){const y=m[1].split("."),w=N[0].split(".");return w[0].length===0?!0:y.length===w.length}return!1}return l.localeCompare(d)===0}function n(u,h){let l=la(u);const d=la(h),m=l.split("/");if(d.split("/").length>1)return!1;if(m.length>1){for(let N=0;N<m.length;N++)if(m[N].length>0&&m[N].charAt(m[N].length-1)!==":"){l=m[N].split(":")[0];break}}if(s(l,d)){const N=l.split("."),y=d.split(".");return y[0].length===0?!0:N.length===y.length}return!1}function i(u,h){const l=u.valueBlock.valueHexView,d=h.valueBlock.valueHexView;if(l.length===4&&d.length===8){for(let m=0;m<4;m++)if((l[m]^d[m])&d[m+4])return!1;return!0}if(l.length===16&&d.length===32){for(let m=0;m<16;m++)if((l[m]^d[m])&d[m+16])return!1;return!0}return!1}function o(u,h){if(u.typesAndValues.length===0||h.typesAndValues.length===0)return!0;if(u.typesAndValues.length<h.typesAndValues.length)return!1;let l=!0,d=0;for(let m=0;m<h.typesAndValues.length;m++){let N=!1;for(let y=d;y<u.typesAndValues.length;y++)if(N=u.typesAndValues[y].isEqual(h.typesAndValues[m]),u.typesAndValues[y].type===h.typesAndValues[m].type&&(l=l&&N),N===!0)if(d===0||d===y){d=y+1;break}else return!1;if(N===!1)return!1}return d===0?!1:l}try{if(this.certs.length===0)throw new Error("Empty certificate array");const u=e.passedWhenNotRevValues||!1,h=e.initialPolicySet||[os],l=e.initialExplicitPolicy||!1,d=e.initialPolicyMappingInhibit||!1,m=e.initialInhibitPolicy||!1,N=e.initialPermittedSubtreesSet||[],y=e.initialExcludedSubtreesSet||[],w=e.initialRequiredNameForms||[];let g=l,S=d,A=m;const k=[!1,!1,!1];let C=0,V=0,M=0,U=N,H=y;const x=w;let Y=1;this.certs=await this.sort(u,t);const ee=[];ee.push(os);const O=[],G=new Array(this.certs.length-1);for(let te=0;te<this.certs.length-1;te++)G[te]=!0;O.push(G);const we=new Array(this.certs.length-1),le=new Array(this.certs.length-1);let Se=g?this.certs.length-1:-1;for(let te=this.certs.length-2;te>=0;te--,Y++){const se=this.certs[te];if(se.extensions){for(let Q=0;Q<se.extensions.length;Q++){const ie=se.extensions[Q];if(ie.extnID===Ww){le[te]=ie.parsedValue;for(let he=0;he<ee.length;he++)if(ee[he]===os){delete O[he][te];break}for(let he=0;he<ie.parsedValue.certificatePolicies.length;he++){let Ce=-1;const Fe=ie.parsedValue.certificatePolicies[he].policyIdentifier;for(let I=0;I<ee.length;I++)if(Fe===ee[I]){Ce=I;break}if(Ce===-1){ee.push(Fe);const I=new Array(this.certs.length-1);I[te]=!0,O.push(I)}else O[Ce][te]=!0}}if(ie.extnID===Gw){if(S)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};we[te]=ie.parsedValue}ie.extnID===zw&&g===!1&&(ie.parsedValue.requireExplicitPolicy===0?(g=!0,Se=te):k[0]===!1?(k[0]=!0,C=ie.parsedValue.requireExplicitPolicy):C=C>ie.parsedValue.requireExplicitPolicy?ie.parsedValue.requireExplicitPolicy:C,ie.parsedValue.inhibitPolicyMapping===0?S=!0:k[1]===!1?(k[1]=!0,V=ie.parsedValue.inhibitPolicyMapping+1):V=V>ie.parsedValue.inhibitPolicyMapping+1?ie.parsedValue.inhibitPolicyMapping+1:V),ie.extnID===Pb&&A===!1&&(ie.parsedValue.valueBlock.valueDec===0?A=!0:k[2]===!1?(k[2]=!0,M=ie.parsedValue.valueBlock.valueDec):M=M>ie.parsedValue.valueBlock.valueDec?ie.parsedValue.valueBlock.valueDec:M)}if(A===!0){let Q=-1;for(let ie=0;ie<ee.length;ie++)if(ee[ie]===os){Q=ie;break}Q!==-1&&delete O[0][te]}g===!1&&k[0]===!0&&(C--,C===0&&(g=!0,Se=te,k[0]=!1)),S===!1&&k[1]===!0&&(V--,V===0&&(S=!0,k[1]=!1)),A===!1&&k[2]===!0&&(M--,M===0&&(A=!0,k[2]=!1))}}for(let te=0;te<this.certs.length-1;te++)if(te<this.certs.length-2&&typeof we[te+1]<"u")for(let se=0;se<we[te+1].mappings.length;se++){if(we[te+1].mappings[se].issuerDomainPolicy===os||we[te+1].mappings[se].subjectDomainPolicy===os)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let Q=-1,ie=-1;for(let he=0;he<ee.length;he++)ee[he]===we[te+1].mappings[se].issuerDomainPolicy&&(Q=he),ee[he]===we[te+1].mappings[se].subjectDomainPolicy&&(ie=he);typeof O[Q][te]<"u"&&delete O[Q][te];for(let he=0;he<le[te].certificatePolicies.length;he++)if(we[te+1].mappings[se].subjectDomainPolicy===le[te].certificatePolicies[he].policyIdentifier&&Q!==-1&&ie!==-1)for(let Ce=0;Ce<=te;Ce++)typeof O[ie][Ce]<"u"&&(O[Q][Ce]=!0,delete O[ie][Ce])}for(let te=0;te<ee.length;te++)if(ee[te]===os)for(let se=0;se<Se;se++)delete O[te][se];const re=[];for(let te=0;te<O.length;te++){let se=!0;for(let Q=0;Q<this.certs.length-1;Q++){let ie=!1;if(Q<Se&&ee[te]===os&&ee.length>1){se=!1;break}if(typeof O[te][Q]>"u"){if(Q>=Se){for(let he=0;he<ee.length;he++)if(ee[he]===os){O[he][Q]===!0&&(ie=!0);break}}if(!ie){se=!1;break}}}se===!0&&re.push(ee[te])}let be=[];if(h.length===1&&h[0]===os&&g===!1)be=h;else if(re.length===1&&re[0]===os)be=h;else for(let te=0;te<re.length;te++)for(let se=0;se<h.length;se++)if(h[se]===re[te]||h[se]===os){be.push(re[te]);break}const de={result:be.length>0,resultCode:0,resultMessage:be.length>0?E:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:re,userConstrPolicies:be,explicitPolicyIndicator:g,policyMappings:we,certificatePath:this.certs};if(be.length===0||de.result===!1)return de;Y=1;for(let te=this.certs.length-2;te>=0;te--,Y++){const se=this.certs[te];let Q=[],ie=[],he=[];if(se.extensions)for(let v=0;v<se.extensions.length;v++){const R=se.extensions[v];R.extnID===qw&&("permittedSubtrees"in R.parsedValue&&(ie=ie.concat(R.parsedValue.permittedSubtrees)),"excludedSubtrees"in R.parsedValue&&(he=he.concat(R.parsedValue.excludedSubtrees))),R.extnID===Kw&&(Q=Q.concat(R.parsedValue.altNames))}let Ce=x.length<=0;for(let v=0;v<x.length;v++)switch(x[v].base.type){case 4:{if(x[v].base.value.typesAndValues.length!==se.subject.typesAndValues.length)continue;Ce=!0;for(let R=0;R<se.subject.typesAndValues.length;R++)if(se.subject.typesAndValues[R].type!==x[v].base.value.typesAndValues[R].type){Ce=!1;break}if(Ce===!0)break}break;default:}if(Ce===!1)throw de.result=!1,de.resultCode=21,de.resultMessage="No necessary name form found",de;const Fe=[[],[],[],[],[]];for(let v=0;v<U.length;v++)switch(U[v].base.type){case 1:Fe[0].push(U[v]);break;case 2:Fe[1].push(U[v]);break;case 4:Fe[2].push(U[v]);break;case 6:Fe[3].push(U[v]);break;case 7:Fe[4].push(U[v]);break;default:}for(let v=0;v<5;v++){let R=!1,D=!1;const me=Fe[v];for(let ke=0;ke<me.length;ke++){switch(v){case 0:if(Q.length>0)for(let oe=0;oe<Q.length;oe++)Q[oe].type===1&&(D=!0,R=R||a(Q[oe].value,me[ke].base.value));else for(let oe=0;oe<se.subject.typesAndValues.length;oe++)(se.subject.typesAndValues[oe].type==="1.2.840.113549.1.9.1"||se.subject.typesAndValues[oe].type==="0.9.2342.19200300.100.1.3")&&(D=!0,R=R||a(se.subject.typesAndValues[oe].value.valueBlock.value,me[ke].base.value));break;case 1:if(Q.length>0)for(let oe=0;oe<Q.length;oe++)Q[oe].type===2&&(D=!0,R=R||s(Q[oe].value,me[ke].base.value));break;case 2:D=!0,R=o(se.subject,me[ke].base.value);break;case 3:if(Q.length>0)for(let oe=0;oe<Q.length;oe++)Q[oe].type===6&&(D=!0,R=R||n(Q[oe].value,me[ke].base.value));break;case 4:if(Q.length>0)for(let oe=0;oe<Q.length;oe++)Q[oe].type===7&&(D=!0,R=R||i(Q[oe].value,me[ke].base.value));break;default:}if(R)break}if(R===!1&&me.length>0&&D)throw de.result=!1,de.resultCode=41,de.resultMessage='Failed to meet "permitted sub-trees" name constraint',de}let I=!1;for(let v=0;v<H.length;v++){switch(H[v].base.type){case 1:if(Q.length>=0)for(let R=0;R<Q.length;R++)Q[R].type===1&&(I=I||a(Q[R].value,H[v].base.value));else for(let R=0;R<se.subject.typesAndValues.length;R++)(se.subject.typesAndValues[R].type==="1.2.840.113549.1.9.1"||se.subject.typesAndValues[R].type==="0.9.2342.19200300.100.1.3")&&(I=I||a(se.subject.typesAndValues[R].value.valueBlock.value,H[v].base.value));break;case 2:if(Q.length>0)for(let R=0;R<Q.length;R++)Q[R].type===2&&(I=I||s(Q[R].value,H[v].base.value));break;case 4:I=I||o(se.subject,H[v].base.value);break;case 6:if(Q.length>0)for(let R=0;R<Q.length;R++)Q[R].type===6&&(I=I||n(Q[R].value,H[v].base.value));break;case 7:if(Q.length>0)for(let R=0;R<Q.length;R++)Q[R].type===7&&(I=I||i(Q[R].value,H[v].base.value));break;default:}if(I)break}if(I===!0)throw de.result=!1,de.resultCode=42,de.resultMessage='Failed to meet "excluded sub-trees" name constraint',de;U=U.concat(ie),H=H.concat(he)}return de}catch(u){return u instanceof Error?u instanceof fa?{result:!1,resultCode:u.code,resultMessage:u.message,error:u}:{result:!1,resultCode:jn.unknown,resultMessage:u.message,error:u}:u&&typeof u=="object"&&"resultMessage"in u?u:{result:!1,resultCode:-1,resultMessage:"".concat(u)}}}}const Oh="tbsResponseData",ac="signatureAlgorithm",nc="signature",mo="certs",jc="BasicOCSPResponse",ap="".concat(jc,".").concat(Oh),np="".concat(jc,".").concat(ac),ip="".concat(jc,".").concat(nc),Dh="".concat(jc,".").concat(mo),vS=[ap,np,ip,Dh];class fs extends J{constructor(e={}){super(),this.tbsResponseData=f(e,Oh,fs.defaultValues(Oh)),this.signatureAlgorithm=f(e,ac,fs.defaultValues(ac)),this.signature=f(e,nc,fs.defaultValues(nc)),mo in e&&(this.certs=f(e,mo,fs.defaultValues(mo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oh:return new ht;case ac:return new j;case nc:return new pe;case mo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let s=ht.compareWithDefault("tbs",t.tbs)&&ht.compareWithDefault("responderID",t.responderID)&&ht.compareWithDefault("producedAt",t.producedAt)&&ht.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(s=s&&ht.compareWithDefault("responseExtensions",t.responseExtensions)),s}case ac:return t.algorithmId===E&&!("algorithmParams"in t);case nc:return t.isEqual(fs.defaultValues(e));case mo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||jc,value:[ht.schema(t.tbsResponseData||{names:{blockName:ap}}),j.schema(t.signatureAlgorithm||{names:{blockName:np}}),new pe({name:t.signature||ip}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new B({value:[new ue({name:Dh,value:ye.schema(t.certs||{})})]})]})]})}fromSchema(e){q(e,vS);const t=_(e,e,fs.schema());K.assertSchema(t,this.className),this.tbsResponseData=new ht({schema:t.result[ap]}),this.signatureAlgorithm=new j({schema:t.result[np]}),this.signature=t.result[ip],Dh in t.result&&(this.certs=Array.from(t.result[Dh],s=>new ye({schema:s})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[new B({value:Array.from(this.certs,t=>t.toSchema())})]})),new B({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}async getCertificateStatus(e,t,s=ce(!0)){const a={isForCertificate:!1,status:2},n={},i=[];for(const o of this.tbsResponseData.responses){const u=s.getAlgorithmByOID(o.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!n[u.name]){n[u.name]=1;const h=new ze;i.push(h),await h.createForCertificate(e,{hashAlgorithm:u.name,issuerCertificate:t},s)}}for(const o of this.tbsResponseData.responses)for(const u of i)if(o.certID.isEqual(u)){a.isForCertificate=!0;try{switch(o.certStatus.idBlock.isConstructed){case!0:o.certStatus.idBlock.tagNumber===1&&(a.status=1);break;case!1:switch(o.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2;break;default:}break;default:}}catch(h){}return a}return a}async sign(e,t="SHA-1",s=ce(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters.algorithm;if(!("name"in n))throw new Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());const i=await s.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:n});this.signature=new pe({valueHex:i})}async verify(e={},t=ce(!0)){let s=null,a=-1;const n=e.trustedCerts||[];if(!this.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof Ee:for(const[o,u]of this.certs.entries())if(u.subject.isEqual(this.tbsResponseData.responderID)){a=o;break}break;case this.tbsResponseData.responderID instanceof W:for(const[o,u]of this.certs.entries()){const h=await t.digest({name:"sha-1"},u.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(Ic(h,this.tbsResponseData.responderID.valueBlock.valueHex)){a=o;break}}break;default:throw new Error("Wrong value for responderID")}if(a===-1)throw new Error("Correct certificate was not found in OCSP response");s=this.certs[a];const i=[s];for(const o of this.certs){const u=await ay(o,s);u&&i.push(u)}if(!(await new Im({certs:i,trustedCerts:n}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}fs.CLASS_NAME="BasicOCSPResponse";const Pf="tbs",Of="version",Df="subject",Tf="subjectPublicKeyInfo",mi="attributes",ic="signatureAlgorithm",oc="signatureValue",tu="CertificationRequestInfo",Gp="".concat(tu,".version"),zp="".concat(tu,".subject"),Xp="".concat(tu,".subjectPublicKeyInfo"),ym="".concat(tu,".attributes"),bS=[tu,Gp,zp,Xp,ym,ic,oc];function AS(r={}){const e=f(r,"names",{});return new B({name:e.CertificationRequestInfo||tu,value:[new $({name:e.CertificationRequestInfoVersion||Gp}),Ee.schema(e.subject||{names:{blockName:zp}}),Jt.schema({names:{blockName:Xp}}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({optional:!0,name:e.CertificationRequestInfoAttributes||ym,value:Ve.schema(e.attributes||{})})]})]})}class bs extends J{get tbs(){return xe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,Pf,bs.defaultValues(Pf))),this.version=f(e,Of,bs.defaultValues(Of)),this.subject=f(e,Df,bs.defaultValues(Df)),this.subjectPublicKeyInfo=f(e,Tf,bs.defaultValues(Tf)),mi in e&&(this.attributes=f(e,mi,bs.defaultValues(mi))),this.signatureAlgorithm=f(e,ic,bs.defaultValues(ic)),this.signatureValue=f(e,oc,bs.defaultValues(oc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pf:return Qe;case Of:return 0;case Df:return new Ee;case Tf:return new Jt;case mi:return[];case ic:return new j;case oc:return new pe;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({value:[AS(t.certificationRequestInfo||{}),new B({name:t.signatureAlgorithm||ic,value:[new Z,new ne({optional:!0})]}),new pe({name:t.signatureValue||oc})]})}fromSchema(e){q(e,bS);const t=_(e,e,bs.schema());K.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[Gp].valueBlock.valueDec,this.subject=new Ee({schema:t.result[zp]}),this.subjectPublicKeyInfo=new Jt({schema:t.result[Xp]}),ym in t.result&&(this.attributes=Array.from(t.result[ym],s=>new Ve({schema:s}))),this.signatureAlgorithm=new j({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new $({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return mi in this&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new B({value:e})}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return bs.schema();const s=Ye(this.tbsView);K.assert(s,"PKCS#10 Certificate Request"),t=s.result}else t=this.encodeTBS();return new B({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return mi in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}async sign(e,t="SHA-1",s=ce(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new pe({valueHex:i})}async verify(e=ce(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=ce(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}bs.CLASS_NAME="CertificationRequest";const Bn="digestAlgorithm",xn="digest",SS=[Bn,xn];class ds extends J{constructor(e={}){super(),this.digestAlgorithm=f(e,Bn,ds.defaultValues(Bn)),this.digest=f(e,xn,ds.defaultValues(xn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bn:return new j;case xn:return new W;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bn:return j.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case xn:return t.isEqual(ds.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[j.schema(t.digestAlgorithm||{names:{blockName:Bn}}),new W({name:t.digest||xn})]})}fromSchema(e){q(e,SS);const t=_(e,e,ds.schema({names:{digestAlgorithm:{names:{blockName:Bn}},digest:xn}}));K.assertSchema(t,this.className),this.digestAlgorithm=new j({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new B({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}ds.CLASS_NAME="DigestInfo";const fo="eContentType",vs="eContent",NS=[fo,vs];class Yt extends J{constructor(e={}){if(super(),this.eContentType=f(e,fo,Yt.defaultValues(fo)),vs in e&&(this.eContent=f(e,vs,Yt.defaultValues(vs)),this.eContent.idBlock.tagClass===1&&this.eContent.idBlock.tagNumber===4&&this.eContent.idBlock.isConstructed===!1)){const t=new W({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,s,s+65536>a.byteLength?a.byteLength-s:65536),o=new ArrayBuffer(i.length),u=new Uint8Array(o);for(let h=0;h<u.length;h++)u[h]=i[h];t.valueBlock.value.push(new W({valueHex:o})),n-=i.length,s+=i.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fo:return E;case vs:return new W;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fo:return t===E;case vs:return t.idBlock.tagClass===1&&t.idBlock.tagNumber===4?t.isEqual(Yt.defaultValues(vs)):!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.eContentType||E}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ne({name:t.eContent||E})]})]})}fromSchema(e){q(e,NS);const t=_(e,e,Yt.schema({names:{eContentType:fo,eContent:vs}}));K.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),vs in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new Z({value:this.eContentType})),this.eContent&&Yt.compareWithDefault(vs,this.eContent)===!1&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new B({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&Yt.compareWithDefault(vs,this.eContent)===!1&&(e.eContent=this.eContent.toJSON()),e}}Yt.CLASS_NAME="EncapsulatedContentInfo";const Vn="mac",Pn="macSalt",Xs="iterations",ES=[Vn,Pn,Xs];class $t extends J{constructor(e={}){super(),this.mac=f(e,Vn,$t.defaultValues(Vn)),this.macSalt=f(e,Pn,$t.defaultValues(Pn)),Xs in e&&(this.iterations=f(e,Xs,$t.defaultValues(Xs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vn:return new ds;case Pn:return new W;case Xs:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vn:return ds.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&ds.compareWithDefault("digest",t.digest);case Pn:return t.isEqual($t.defaultValues(e));case Xs:return t===$t.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,optional:t.optional||!0,value:[ds.schema(t.mac||{names:{blockName:Vn}}),new W({name:t.macSalt||Pn}),new $({optional:!0,name:t.iterations||Xs})]})}fromSchema(e){q(e,ES);const t=_(e,e,$t.schema({names:{mac:{names:{blockName:Vn}},macSalt:Pn,iterations:Xs}}));K.assertSchema(t,this.className),this.mac=new ds({schema:t.result.mac}),this.macSalt=t.result.macSalt,Xs in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return this.iterations!==void 0&&e.push(new $({value:this.iterations})),new B({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return this.iterations!==void 0&&(e.iterations=this.iterations),e}}$t.CLASS_NAME="MacData";const $n="hashAlgorithm",Mn="hashedMessage",kS=[$n,Mn];class Et extends J{static async create(e,t,s=ce(!0)){const a=s.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),n=await s.digest(e,t);return new Et({hashAlgorithm:new j({algorithmId:a,algorithmParams:new nt}),hashedMessage:new W({valueHex:n})})}constructor(e={}){super(),this.hashAlgorithm=f(e,$n,Et.defaultValues($n)),this.hashedMessage=f(e,Mn,Et.defaultValues(Mn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $n:return new j;case Mn:return new W;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $n:return t.algorithmId===E&&!("algorithmParams"in t);case Mn:return t.isEqual(Et.defaultValues(e))===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[j.schema(t.hashAlgorithm||{}),new W({name:t.hashedMessage||E})]})}fromSchema(e){q(e,kS);const t=_(e,e,Et.schema({names:{hashAlgorithm:{names:{blockName:$n}},hashedMessage:Mn}}));K.assertSchema(t,this.className),this.hashAlgorithm=new j({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new B({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}Et.CLASS_NAME="MessageImprint";const po="reqCert",ra="singleRequestExtensions",IS=[po,ra];let vm=class uc extends J{constructor(e={}){super(),this.reqCert=f(e,po,uc.defaultValues(po)),ra in e&&(this.singleRequestExtensions=f(e,ra,uc.defaultValues(ra))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case po:return new ze;case ra:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case po:return t.isEqual(uc.defaultValues(e));case ra:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[ze.schema(t.reqCert||{}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Ge.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||E}})]})]})}fromSchema(e){q(e,IS);const t=_(e,e,uc.schema({names:{reqCert:{names:{blockName:po}},extensions:{names:{blockName:ra}}}}));K.assertSchema(t,this.className),this.reqCert=new ze({schema:t.result.reqCert}),ra in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,s=>new Ge({schema:s})))}toSchema(){const e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new B({value:Array.from(this.singleRequestExtensions,t=>t.toSchema())})]})),new B({value:e})}toJSON(){const e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,t=>t.toJSON())),e}};vm.CLASS_NAME="Request";const dh="tbs",go="version",wo="requestorName",gh="requestList",yo="requestExtensions",su="TBSRequest",Th="".concat(su,".").concat(go),Rh="".concat(su,".").concat(wo),op="".concat(su,".requests"),Lh="".concat(su,".").concat(yo),CS=[su,Th,Rh,op,Lh];class bt extends J{get tbs(){return xe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,dh,bt.defaultValues(dh))),go in e&&(this.version=f(e,go,bt.defaultValues(go))),wo in e&&(this.requestorName=f(e,wo,bt.defaultValues(wo))),this.requestList=f(e,gh,bt.defaultValues(gh)),yo in e&&(this.requestExtensions=f(e,yo,bt.defaultValues(yo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case dh:return Qe;case go:return 0;case wo:return new ve;case gh:case yo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case dh:return t.byteLength===0;case go:return t===bt.defaultValues(e);case wo:return t.type===ve.defaultValues("type")&&Object.keys(t.value).length===0;case gh:case yo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||su,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $({name:t.TBSRequestVersion||Th})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[ve.schema(t.requestorName||{names:{blockName:Rh}})]}),new B({name:t.requestList||"TBSRequest.requestList",value:[new ue({name:t.requests||op,value:vm.schema(t.requestNames||{})})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[Ze.schema(t.extensions||{names:{blockName:t.requestExtensions||Lh}})]})]})}fromSchema(e){q(e,CS);const t=_(e,e,bt.schema());K.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,Th in t.result&&(this.version=t.result[Th].valueBlock.valueDec),Rh in t.result&&(this.requestorName=new ve({schema:t.result[Rh]})),this.requestList=Array.from(t.result[op],s=>new vm({schema:s})),Lh in t.result&&(this.requestExtensions=Array.from(t.result[Lh].valueBlock.value,s=>new Ge({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return bt.schema();const s=Ye(this.tbsView);if(K.assert(s,"TBS Request"),!(s.result instanceof B))throw new Error("ASN.1 result should be SEQUENCE");t=s.result}else{const s=[];this.version!==void 0&&s.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[new $({value:this.version})]})),this.requestorName&&s.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),s.push(new B({value:Array.from(this.requestList,a=>a.toSchema())})),this.requestExtensions&&s.push(new T({idBlock:{tagClass:3,tagNumber:2},value:[new B({value:Array.from(this.requestExtensions,a=>a.toSchema())})]})),t=new B({value:s})}return t}toJSON(){const e={};return this.version!=null&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,t=>t.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,t=>t.toJSON())),e}}bt.CLASS_NAME="TBSRequest";const fi="signatureAlgorithm",pi="signature",Ar="certs";class ss extends J{constructor(e={}){super(),this.signatureAlgorithm=f(e,fi,ss.defaultValues(fi)),this.signature=f(e,pi,ss.defaultValues(pi)),Ar in e&&(this.certs=f(e,Ar,ss.defaultValues(Ar))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fi:return new j;case pi:return new pe;case Ar:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fi:return t.algorithmId===E&&!("algorithmParams"in t);case pi:return t.isEqual(ss.defaultValues(e));case Ar:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[j.schema(t.signatureAlgorithm||{}),new pe({name:t.signature||E}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new B({value:[new ue({name:t.certs||E,value:ye.schema({})})]})]})]})}fromSchema(e){q(e,[fi,pi,Ar]);const t=_(e,e,ss.schema({names:{signatureAlgorithm:{names:{blockName:fi}},signature:pi,certs:Ar}}));K.assertSchema(t,this.className),this.signatureAlgorithm=new j({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,Ar in t.result&&(this.certs=Array.from(t.result.certs,s=>new ye({schema:s})))}toSchema(){const e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new B({value:Array.from(this.certs,t=>t.toSchema())})]})),new B({value:e})}toJSON(){const e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}}ss.CLASS_NAME="Signature";const vo="tbsRequest",aa="optionalSignature",BS=[vo,aa];class Nc extends J{constructor(e={}){super(),this.tbsRequest=f(e,vo,Nc.defaultValues(vo)),aa in e&&(this.optionalSignature=f(e,aa,Nc.defaultValues(aa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vo:return new bt;case aa:return new ss;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vo:return bt.compareWithDefault("tbs",t.tbs)&&bt.compareWithDefault("version",t.version)&&bt.compareWithDefault("requestorName",t.requestorName)&&bt.compareWithDefault("requestList",t.requestList)&&bt.compareWithDefault("requestExtensions",t.requestExtensions);case aa:return ss.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&ss.compareWithDefault("signature",t.signature)&&ss.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||"OCSPRequest",value:[bt.schema(t.tbsRequest||{names:{blockName:vo}}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ss.schema(t.optionalSignature||{names:{blockName:aa}})]})]})}fromSchema(e){q(e,BS);const t=_(e,e,Nc.schema());K.assertSchema(t,this.className),this.tbsRequest=new bt({schema:t.result.tbsRequest}),aa in t.result&&(this.optionalSignature=new ss({schema:t.result.optionalSignature}))}toSchema(e=!1){const t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new B({value:t})}toJSON(){const e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,s=ce(!0)){const a=new ze;await a.createForCertificate(e,t,s),this.tbsRequest.requestList.push(new vm({reqCert:a}))}async sign(e,t="SHA-1",s=ce(!0)){if(ge.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw new Error('Need to create "optionalSignature" field before signing');const a=await s.getSignatureParameters(e,t),n=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;const i=this.tbsRequest.toSchema(!0).toBER(!1),o=await s.signWithPrivateKey(i,e,n);this.optionalSignature.signature=new pe({valueHex:o})}verify(){}}Nc.CLASS_NAME="OCSPRequest";const bo="responseType",Ao="response",xS=[bo,Ao];class Es extends J{constructor(e={}){super(),this.responseType=f(e,bo,Es.defaultValues(bo)),this.response=f(e,Ao,Es.defaultValues(Ao)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bo:return E;case Ao:return new W;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bo:return t===E;case Ao:return t.isEqual(Es.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new Z({name:t.responseType||E}),new W({name:t.response||E})]})}fromSchema(e){q(e,xS);const t=_(e,e,Es.schema({names:{responseType:bo,response:Ao}}));K.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new B({value:[new Z({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}Es.CLASS_NAME="ResponseBytes";const di="responseStatus",Ks="responseBytes";class Mo extends J{constructor(e={}){super(),this.responseStatus=f(e,di,Mo.defaultValues(di)),Ks in e&&(this.responseBytes=f(e,Ks,Mo.defaultValues(Ks))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case di:return new Cc;case Ks:return new Es;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case di:return t.isEqual(Mo.defaultValues(e));case Ks:return Es.compareWithDefault("responseType",t.responseType)&&Es.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||"OCSPResponse",value:[new Cc({name:t.responseStatus||di}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Es.schema(t.responseBytes||{names:{blockName:Ks}})]})]})}fromSchema(e){q(e,[di,Ks]);const t=_(e,e,Mo.schema());K.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,Ks in t.result&&(this.responseBytes=new Es({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new B({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,s=ce(!0)){let a;const n={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==Sh)return n;try{const i=Ye(this.responseBytes.response.valueBlock.valueHexView);K.assert(i,"Basic OCSP response"),a=new fs({schema:i.result})}catch(i){return n}return a.getCertificateStatus(e,t,s)}async sign(e,t,s=ce(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===Sh)return fs.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,s);throw new Error("Unknown ResponseBytes type: ".concat(((a=this.responseBytes)===null||a===void 0?void 0:a.responseType)||"Unknown"))}async verify(e=null,t=ce(!0)){var s;if(!(Ks in this))throw new Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===Sh){const a=fs.fromBER(this.responseBytes.response.valueBlock.valueHexView);return e!==null&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw new Error("Unknown ResponseBytes type: ".concat(((s=this.responseBytes)===null||s===void 0?void 0:s.responseType)||"Unknown"))}}Mo.CLASS_NAME="OCSPResponse";const La="type",Ys="attributes",wh="encodedValue",VS=[Ys];class Le extends J{constructor(e={}){super(),this.type=f(e,La,Le.defaultValues(La)),this.attributes=f(e,Ys,Le.defaultValues(Ys)),this.encodedValue=f(e,wh,Le.defaultValues(wh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case La:return-1;case Ys:return[];case wh:return Qe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case La:return t===Le.defaultValues(La);case Ys:return t.length===0;case wh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new T({name:t.blockName||E,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new ue({name:t.attributes||E,value:Ve.schema()})]})}fromSchema(e){q(e,VS);const t=_(e,e,Le.schema({names:{tagNumber:this.type,attributes:Ys}}));K.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=xe.toArrayBuffer(t.result.valueBeforeDecodeView);const s=new Uint8Array(this.encodedValue);if(s[0]=49,!(Ys in t.result)){if(this.type===0)throw new Error("Wrong structure of SignedUnsignedAttributes");return}this.attributes=Array.from(t.result.attributes,a=>new Ve({schema:a}))}toSchema(){if(Le.compareWithDefault(La,this.type)||Le.compareWithDefault(Ys,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new T({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(Le.compareWithDefault(La,this.type)||Le.compareWithDefault(Ys,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}Le.CLASS_NAME="SignedAndUnsignedAttributes";const So="version",On="sid",No="digestAlgorithm",na="signedAttrs",Eo="signatureAlgorithm",lc="signature",ia="unsignedAttrs",Va="SignerInfo",up="".concat(Va,".").concat(So),cc="".concat(Va,".").concat(On),lp="".concat(Va,".").concat(No),Uh="".concat(Va,".").concat(na),cp="".concat(Va,".").concat(Eo),hp="".concat(Va,".").concat(lc),jh="".concat(Va,".").concat(ia),PS=[up,cc,lp,Uh,cp,hp,jh];class He extends J{constructor(e={}){super(),this.version=f(e,So,He.defaultValues(So)),this.sid=f(e,On,He.defaultValues(On)),this.digestAlgorithm=f(e,No,He.defaultValues(No)),na in e&&(this.signedAttrs=f(e,na,He.defaultValues(na))),this.signatureAlgorithm=f(e,Eo,He.defaultValues(Eo)),this.signature=f(e,lc,He.defaultValues(lc)),ia in e&&(this.unsignedAttrs=f(e,ia,He.defaultValues(ia))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case So:return 0;case On:return new ne;case No:return new j;case na:return new Le({type:0});case Eo:return new j;case lc:return new W;case ia:return new Le({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case So:return He.defaultValues(So)===t;case On:return t instanceof ne;case No:return t instanceof j?t.isEqual(He.defaultValues(No)):!1;case na:return Le.compareWithDefault("type",t.type)&&Le.compareWithDefault("attributes",t.attributes)&&Le.compareWithDefault("encodedValue",t.encodedValue);case Eo:return t instanceof j?t.isEqual(He.defaultValues(Eo)):!1;case lc:case ia:return Le.compareWithDefault("type",t.type)&&Le.compareWithDefault("attributes",t.attributes)&&Le.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:Va,value:[new $({name:t.version||up}),new je({value:[et.schema(t.sidSchema||{names:{blockName:cc}}),new je({value:[new T({optional:!0,name:t.sid||cc,idBlock:{tagClass:3,tagNumber:0},value:[new W]}),new ae({optional:!0,name:t.sid||cc,idBlock:{tagClass:3,tagNumber:0}})]})]}),j.schema(t.digestAlgorithm||{names:{blockName:lp}}),Le.schema(t.signedAttrs||{names:{blockName:Uh,tagNumber:0}}),j.schema(t.signatureAlgorithm||{names:{blockName:cp}}),new W({name:t.signature||hp}),Le.schema(t.unsignedAttrs||{names:{blockName:jh,tagNumber:1}})]})}fromSchema(e){q(e,PS);const t=_(e,e,He.schema());K.assertSchema(t,this.className),this.version=t.result[up].valueBlock.valueDec;const s=t.result[cc];s.idBlock.tagClass===1?this.sid=new et({schema:s}):this.sid=s,this.digestAlgorithm=new j({schema:t.result[lp]}),Uh in t.result&&(this.signedAttrs=new Le({type:0,schema:t.result[Uh]})),this.signatureAlgorithm=new j({schema:t.result[cp]}),this.signature=t.result[hp],jh in t.result&&(this.unsignedAttrs=new Le({type:1,schema:t.result[jh]}))}toSchema(){if(He.compareWithDefault(On,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new $({value:this.version})),this.sid instanceof et?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&He.compareWithDefault(na,this.signedAttrs)===!1&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&He.compareWithDefault(ia,this.unsignedAttrs)===!1&&e.push(this.unsignedAttrs.toSchema()),new B({value:e})}toJSON(){if(He.compareWithDefault(On,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof ne||(e.sid=this.sid.toJSON()),this.signedAttrs&&He.compareWithDefault(na,this.signedAttrs)===!1&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&He.compareWithDefault(ia,this.unsignedAttrs)===!1&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}He.CLASS_NAME="SignerInfo";const hc="version",mc="policy",fc="messageImprint",pc="serialNumber",dc="genTime",Dn="ordering",Tn="nonce",ko="accuracy",Io="tsa",Co="extensions",Cs="TSTInfo",mp="".concat(Cs,".").concat(hc),fp="".concat(Cs,".").concat(mc),pp="".concat(Cs,".").concat(fc),dp="".concat(Cs,".").concat(pc),gp="".concat(Cs,".").concat(dc),$h="".concat(Cs,".").concat(ko),Mh="".concat(Cs,".").concat(Dn),Kh="".concat(Cs,".").concat(Tn),Hh="".concat(Cs,".").concat(Io),Fh="".concat(Cs,".").concat(Co),OS=[mp,fp,pp,dp,gp,$h,Mh,Kh,Hh,Fh];class xt extends J{constructor(e={}){super(),this.version=f(e,hc,xt.defaultValues(hc)),this.policy=f(e,mc,xt.defaultValues(mc)),this.messageImprint=f(e,fc,xt.defaultValues(fc)),this.serialNumber=f(e,pc,xt.defaultValues(pc)),this.genTime=f(e,dc,xt.defaultValues(dc)),ko in e&&(this.accuracy=f(e,ko,xt.defaultValues(ko))),Dn in e&&(this.ordering=f(e,Dn,xt.defaultValues(Dn))),Tn in e&&(this.nonce=f(e,Tn,xt.defaultValues(Tn))),Io in e&&(this.tsa=f(e,Io,xt.defaultValues(Io))),Co in e&&(this.extensions=f(e,Co,xt.defaultValues(Co))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hc:return 0;case mc:return E;case fc:return new Et;case pc:return new $;case dc:return new Date(0,0,0);case ko:return new ts;case Dn:return!1;case Tn:return new $;case Io:return new ve;case Co:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hc:case mc:case dc:case Dn:return t===xt.defaultValues(Dn);case fc:return Et.compareWithDefault($n,t.hashAlgorithm)&&Et.compareWithDefault(Mn,t.hashedMessage);case pc:case Tn:return t.isEqual(xt.defaultValues(Tn));case ko:return ts.compareWithDefault(kr,t.seconds)&&ts.compareWithDefault(Ir,t.millis)&&ts.compareWithDefault(Cr,t.micros);case Io:return ve.compareWithDefault(ku,t.type)&&ve.compareWithDefault(Iu,t.value);case Co:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||Cs,value:[new $({name:t.version||mp}),new Z({name:t.policy||fp}),Et.schema(t.messageImprint||{names:{blockName:pp}}),new $({name:t.serialNumber||dp}),new $e({name:t.genTime||gp}),ts.schema(t.accuracy||{names:{blockName:$h}}),new Ba({name:t.ordering||Mh,optional:!0}),new $({name:t.nonce||Kh,optional:!0}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ve.schema(t.tsa||{names:{blockName:Hh}})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ue({name:t.extensions||Fh,value:Ge.schema(t.extension||{})})]})]})}fromSchema(e){q(e,OS);const t=_(e,e,xt.schema());K.assertSchema(t,this.className),this.version=t.result[mp].valueBlock.valueDec,this.policy=t.result[fp].valueBlock.toString(),this.messageImprint=new Et({schema:t.result[pp]}),this.serialNumber=t.result[dp],this.genTime=t.result[gp].toDate(),$h in t.result&&(this.accuracy=new ts({schema:t.result[$h]})),Mh in t.result&&(this.ordering=t.result[Mh].valueBlock.value),Kh in t.result&&(this.nonce=t.result[Kh]),Hh in t.result&&(this.tsa=new ve({schema:t.result[Hh]})),Fh in t.result&&(this.extensions=Array.from(t.result[Fh],s=>new Ge({schema:s})))}toSchema(){const e=[];return e.push(new $({value:this.version})),e.push(new Z({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new $e({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),this.ordering!==void 0&&e.push(new Ba({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new B({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),this.ordering!==void 0&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async verify(e,t=ce(!0)){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const s=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),n=await t.digest(a.name,new Uint8Array(s));return xe.isEqual(n,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}xt.CLASS_NAME="TSTInfo";const Bo="version",gc="digestAlgorithms",wc="encapContentInfo",xo="certificates",Vo="crls",yc="signerInfos",Su="ocsps",ni="SignedData",wp="".concat(ni,".").concat(Bo),Jh="".concat(ni,".").concat(gc),yp="".concat(ni,".").concat(wc),qh="".concat(ni,".").concat(xo),_h="".concat(ni,".").concat(Vo),Wh="".concat(ni,".").concat(yc),DS=[wp,Jh,yp,qh,_h,Wh];class Bt extends Error{constructor({message:e,code:t=0,date:s=new Date,signatureVerified:a=null,signerCertificate:n=null,signerCertificateVerified:i=null,timestampSerial:o=null,certificatePath:u=[]}){super(e),this.name="SignedDataVerifyError",this.date=s,this.code=t,this.timestampSerial=o,this.signatureVerified=a,this.signerCertificate=n,this.signerCertificateVerified=i,this.certificatePath=u}}class vt extends J{constructor(e={}){super(),this.version=f(e,Bo,vt.defaultValues(Bo)),this.digestAlgorithms=f(e,gc,vt.defaultValues(gc)),this.encapContentInfo=f(e,wc,vt.defaultValues(wc)),xo in e&&(this.certificates=f(e,xo,vt.defaultValues(xo))),Vo in e&&(this.crls=f(e,Vo,vt.defaultValues(Vo))),Su in e&&(this.ocsps=f(e,Su,vt.defaultValues(Su))),this.signerInfos=f(e,yc,vt.defaultValues(yc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bo:return 0;case gc:return[];case wc:return new Yt;case xo:return[];case Vo:return[];case Su:return[];case yc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bo:return t===vt.defaultValues(Bo);case wc:return Yt.compareWithDefault("eContentType",t.eContentType)&&Yt.compareWithDefault("eContent",t.eContent);case gc:case xo:case Vo:case Su:case yc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return t.optional===void 0&&(t.optional=!1),new B({name:t.blockName||ni,optional:t.optional,value:[new $({name:t.version||wp}),new it({value:[new ue({name:t.digestAlgorithms||Jh,value:j.schema()})]}),Yt.schema(t.encapContentInfo||{names:{blockName:yp}}),new T({name:t.certificates||qh,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Us.schema().valueBlock.value}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:hr.schema(t.crls||{names:{crls:_h}}).valueBlock.value}),new it({value:[new ue({name:t.signerInfos||Wh,value:He.schema()})]})]})}fromSchema(e){q(e,DS);const t=_(e,e,vt.schema());if(K.assertSchema(t,this.className),this.version=t.result[wp].valueBlock.valueDec,Jh in t.result&&(this.digestAlgorithms=Array.from(t.result[Jh],s=>new j({schema:s}))),this.encapContentInfo=new Yt({schema:t.result[yp]}),qh in t.result){const s=new Us({schema:new it({value:t.result[qh].valueBlock.value})});this.certificates=s.certificates.slice(0)}_h in t.result&&(this.crls=Array.from(t.result[_h],s=>s.idBlock.tagClass===1?new at({schema:s}):(s.idBlock.tagClass=1,s.idBlock.tagNumber=16,new cr({schema:s})))),Wh in t.result&&(this.signerInfos=Array.from(t.result[Wh],s=>new He({schema:s})))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof ka)||this.crls&&this.crls.length&&this.crls.some(s=>s instanceof cr)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof as)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof nr)||this.signerInfos.some(s=>s.version===3)||this.encapContentInfo.eContentType!==vt.ID_DATA?this.version=3:this.version=1,t.push(new $({value:this.version})),t.push(new it({value:Array.from(this.digestAlgorithms,s=>s.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const s=new Us({certificates:this.certificates}).toSchema();t.push(new T({idBlock:{tagClass:3,tagNumber:0},value:s.valueBlock.value}))}return this.crls&&t.push(new T({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,s=>{if(s instanceof cr){const a=s.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return s.toSchema(e)})})),t.push(new it({value:Array.from(this.signerInfos,s=>s.toSchema())})),new B({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}async verify({signer:e=-1,data:t=Qe,trustedCerts:s=[],checkDate:a=new Date,checkChain:n=!1,passedWhenNotRevValues:i=!1,extendedMode:o=!1,findOrigin:u=null,findIssuer:h=null}={},l=ce(!0)){let d=null,m=null;try{let N=Qe,y=E,w=[];const g=this.signerInfos[e];if(!g)throw new Bt({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new Bt({date:a,code:2,message:"No certificates attached to this signed data"});if(g.sid instanceof et){for(const C of this.certificates)if(C instanceof ye&&C.issuer.isEqual(g.sid.issuer)&&C.serialNumber.isEqual(g.sid.serialNumber)){d=C;break}}else{const C=g.sid,V=C.idBlock.isConstructed?C.valueBlock.value[0].valueBlock.valueHex:C.valueBlock.valueHex;for(const M of this.certificates){if(!(M instanceof ye))continue;const U=await l.digest({name:"sha-1"},M.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(Ic(U,V)){d=M;break}}}if(!d)throw new Bt({date:a,code:3,message:"Unable to find signer certificate"});if(this.encapContentInfo.eContentType===Ub){if(!this.encapContentInfo.eContent)throw new Bt({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:d,timestampSerial:m,signerCertificateVerified:!0});let C;try{C=xt.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch(V){throw new Bt({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:d,timestampSerial:m,signerCertificateVerified:!0})}if(a=C.genTime,m=C.serialNumber.valueBlock.valueHexView.slice(),t.byteLength===0)throw new Bt({date:a,code:4,message:"Missed detached data input array"});if(!await C.verify({data:t},l))throw new Bt({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:d,timestampSerial:m,signerCertificateVerified:!0})}if(n){const C=this.certificates.filter(H=>H instanceof ye&&!!ay(H,d)),V={checkDate:a,certs:C,trustedCerts:s};h&&(V.findIssuer=h),u&&(V.findOrigin=u);const M=new Im(V);if(M.certs.push(d),this.crls)for(const H of this.crls)"thisUpdate"in H?M.crls.push(H):H.otherRevInfoFormat===Sh&&M.ocsps.push(new fs({schema:H.otherRevInfo}));this.ocsps&&M.ocsps.push(...this.ocsps);const U=await M.verify({passedWhenNotRevValues:i},l).catch(H=>{throw new Bt({date:a,code:5,message:"Validation of signer's certificate failed with error: ".concat(H instanceof Object?H.resultMessage:H),signerCertificate:d,signerCertificateVerified:!1})});if(U.certificatePath&&(w=U.certificatePath),!U.result)throw new Bt({date:a,code:5,message:"Validation of signer's certificate failed: ".concat(U.resultMessage),signerCertificate:d,signerCertificateVerified:!1})}const S=l.getAlgorithmByOID(g.digestAlgorithm.algorithmId);if(!("name"in S))throw new Bt({date:a,code:7,message:"Unsupported signature algorithm: ".concat(g.digestAlgorithm.algorithmId),signerCertificate:d,signerCertificateVerified:!0});y=S.name;const A=this.encapContentInfo.eContent;if(A)A.idBlock.tagClass===1&&A.idBlock.tagNumber===4?t=A.getValue():t=A.valueBlock.valueBeforeDecodeView;else if(t.byteLength===0)throw new Bt({date:a,code:8,message:"Missed detached data input array",signerCertificate:d,signerCertificateVerified:!0});if(g.signedAttrs){let C=!1,V=!1;for(const M of g.signedAttrs.attributes)if(M.type==="1.2.840.113549.1.9.3"&&(C=!0),M.type==="1.2.840.113549.1.9.4"&&(V=!0,N=M.values[0].valueBlock.valueHex),C&&V)break;if(C===!1)throw new Bt({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:d,signerCertificateVerified:!0});if(V===!1)throw new Bt({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:d,signerCertificateVerified:!0})}if(g.signedAttrs){const C=await l.digest(y,new Uint8Array(t));if(!Ic(C,N))throw new Bt({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:d,timestampSerial:m,signerCertificateVerified:!0});t=g.signedAttrs.encodedValue}const k=g.signatureAlgorithm.algorithmId==="1.2.840.113549.1.1.1"?await l.verifyWithPublicKey(t,g.signature,d.subjectPublicKeyInfo,g.signatureAlgorithm,y):await l.verifyWithPublicKey(t,g.signature,d.subjectPublicKeyInfo,g.signatureAlgorithm);return o?{date:a,code:14,message:E,signatureVerified:k,signerCertificate:d,timestampSerial:m,signerCertificateVerified:!0,certificatePath:w}:k}catch(N){throw N instanceof Bt?N:new Bt({date:a,code:15,message:"Error during verification: ".concat(N instanceof Error?N.message:N),signatureVerified:null,signerCertificate:d,timestampSerial:m,signerCertificateVerified:!0})}}async sign(e,t,s="SHA-1",a=Qe,n=ce(!0)){var i;if(!e)throw new Error("Need to provide a private key for signing");const o=this.signerInfos[t];if(!o)throw new RangeError("SignerInfo index is out of range");!(!((i=o.signedAttrs)===null||i===void 0)&&i.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(s=e.algorithm.hash.name);const u=n.getOIDByAlgorithm({name:s},!0,"hashAlgorithm");this.digestAlgorithms.filter(m=>m.algorithmId===u).length===0&&this.digestAlgorithms.push(new j({algorithmId:u,algorithmParams:new nt})),o.digestAlgorithm=new j({algorithmId:u,algorithmParams:new nt});const h=await n.getSignatureParameters(e,s),l=h.parameters;if(o.signatureAlgorithm=h.signatureAlgorithm,o.signedAttrs)if(o.signedAttrs.encodedValue.byteLength!==0)a=o.signedAttrs.encodedValue;else{a=o.signedAttrs.toSchema().toBER();const m=xe.toUint8Array(a);m[0]=49}else{const m=this.encapContentInfo.eContent;if(m)m.idBlock.tagClass===1&&m.idBlock.tagNumber===4?a=m.getValue():a=m.valueBlock.valueBeforeDecodeView;else if(a.byteLength===0)throw new Error("Missed detached data input array")}const d=await n.signWithPrivateKey(a,e,l);o.signature=new W({valueHex:d})}}vt.CLASS_NAME="SignedData",vt.ID_DATA=Mp;const Rn="version",Ln="authSafe",Qs="macData",Nu="parsedValue",TS=[Rn,Ln,Qs];class ha extends J{constructor(e={}){super(),this.version=f(e,Rn,ha.defaultValues(Rn)),this.authSafe=f(e,Ln,ha.defaultValues(Ln)),Qs in e&&(this.macData=f(e,Qs,ha.defaultValues(Qs))),Nu in e&&(this.parsedValue=f(e,Nu,ha.defaultValues(Nu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rn:return 3;case Ln:return new Ie;case Qs:return new $t;case Nu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Rn:return t===ha.defaultValues(e);case Ln:return Ie.compareWithDefault("contentType",t.contentType)&&Ie.compareWithDefault("content",t.content);case Qs:return $t.compareWithDefault("mac",t.mac)&&$t.compareWithDefault("macSalt",t.macSalt)&&$t.compareWithDefault("iterations",t.iterations);case Nu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.version||Rn}),Ie.schema(t.authSafe||{names:{blockName:Ln}}),$t.schema(t.macData||{names:{blockName:Qs,optional:!0}})]})}fromSchema(e){q(e,TS);const t=_(e,e,ha.schema({names:{version:Rn,authSafe:{names:{blockName:Ln}},macData:{names:{blockName:Qs}}}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new Ie({schema:t.result.authSafe}),Qs in t.result&&(this.macData=new $t({schema:t.result.macData}))}toSchema(){const e=[new $({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new B({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=ce(!0)){if(Ne.assert(e,"parameters","object"),!this.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(ge.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),ge.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new ge("iterations");ge.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),ge.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),ge.assertEmpty(e.password,"password");const s=new ArrayBuffer(64),a=new Uint8Array(s);t.getRandomValues(a);const n=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new Ie({contentType:Ie.DATA,content:new W({valueHex:n})});const i=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:s,iterationCount:e.iterations,contentToStamp:n});this.macData=new $t({mac:new ds({digestAlgorithm:new j({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new W({valueHex:i})}),macSalt:new W({valueHex:s}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new ge("signingCertificate");ge.assertEmpty(e.privateKey,"privateKey"),ge.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const s=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new vt({version:1,encapContentInfo:new Yt({eContentType:"1.2.840.113549.1.7.1",eContent:new W({valueHex:s})}),certificates:[e.signingCertificate]}),n=await t.digest({name:e.hashAlgorithm},new Uint8Array(s)),i=[];i.push(new Ve({type:"1.2.840.113549.1.9.3",values:[new Z({value:"1.2.840.113549.1.7.1"})]})),i.push(new Ve({type:"1.2.840.113549.1.9.5",values:[new Mf({valueDate:new Date})]})),i.push(new Ve({type:"1.2.840.113549.1.9.4",values:[new W({valueHex:n})]})),a.signerInfos.push(new He({version:1,sid:new et({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new Le({type:0,attributes:i})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new Ie({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw new Error('Parameter "integrityMode" has unknown value: '.concat(this.parsedValue.integrityMode))}}async parseInternalValues(e,t=ce(!0)){switch(Ne.assert(e,"parameters","object"),e.checkIntegrity===void 0&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case Ie.DATA:{ge.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,Ne.assert(this.authSafe.content,"authSafe.content",W);const s=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=si.fromBER(s),e.checkIntegrity){if(!this.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:xe.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:s,signatureToVerify:xe.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case Ie.SIGNED_DATA:{this.parsedValue.integrityMode=1;const s=new vt({schema:this.authSafe.content}),a=s.encapContentInfo.eContent;ge.assert(a,"eContent","cmsSigned.encapContentInfo"),Ne.assert(a,"eContent",W);const n=a.getValue();if(this.parsedValue.authenticatedSafe=si.fromBER(n),!await s.verify({signer:0,checkChain:!1},t))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error('Incorrect value for "this.authSafe.contentType": '.concat(this.authSafe.contentType))}}}ha.CLASS_NAME="PFX";const Po="status",oa="statusStrings",ua="failInfo",RS=[Po,oa,ua];var Dg;(function(r){r[r.granted=0]="granted",r[r.grantedWithMods=1]="grantedWithMods",r[r.rejection=2]="rejection",r[r.waiting=3]="waiting",r[r.revocationWarning=4]="revocationWarning",r[r.revocationNotification=5]="revocationNotification"})(Dg||(Dg={}));class ps extends J{constructor(e={}){super(),this.status=f(e,Po,ps.defaultValues(Po)),oa in e&&(this.statusStrings=f(e,oa,ps.defaultValues(oa))),ua in e&&(this.failInfo=f(e,ua,ps.defaultValues(ua))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Po:return 2;case oa:return[];case ua:return new pe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Po:return t===ps.defaultValues(e);case oa:return t.length===0;case ua:return t.isEqual(ps.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||E,value:[new $({name:t.status||E}),new B({optional:!0,value:[new ue({name:t.statusStrings||E,value:new tm})]}),new pe({name:t.failInfo||E,optional:!0})]})}fromSchema(e){q(e,RS);const t=_(e,e,ps.schema({names:{status:Po,statusStrings:oa,failInfo:ua}}));K.assertSchema(t,this.className);const s=t.result.status;if(s.valueBlock.isHexOnly===!0||s.valueBlock.valueDec<0||s.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=s.valueBlock.valueDec,oa in t.result&&(this.statusStrings=t.result.statusStrings),ua in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){const e=[];return e.push(new $({value:this.status})),this.statusStrings&&e.push(new B({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new B({value:e})}toJSON(){const e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,t=>t.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}ps.CLASS_NAME="PKIStatusInfo";const vc="version",bc="messageImprint",Oo="reqPolicy",Do="nonce",Zs="certReq",To="extensions",ii="TimeStampReq",vp="".concat(ii,".").concat(vc),bp="".concat(ii,".").concat(bc),Gh="".concat(ii,".").concat(Oo),zh="".concat(ii,".").concat(Do),Xh="".concat(ii,".").concat(Zs),Yh="".concat(ii,".").concat(To),LS=[vp,bp,Gh,zh,Xh,Yh];class Qt extends J{constructor(e={}){super(),this.version=f(e,vc,Qt.defaultValues(vc)),this.messageImprint=f(e,bc,Qt.defaultValues(bc)),Oo in e&&(this.reqPolicy=f(e,Oo,Qt.defaultValues(Oo))),Do in e&&(this.nonce=f(e,Do,Qt.defaultValues(Do))),Zs in e&&(this.certReq=f(e,Zs,Qt.defaultValues(Zs))),To in e&&(this.extensions=f(e,To,Qt.defaultValues(To))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vc:return 0;case bc:return new Et;case Oo:return E;case Do:return new $;case Zs:return!1;case To:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vc:case Oo:case Zs:return t===Qt.defaultValues(e);case bc:return Et.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Et.compareWithDefault("hashedMessage",t.hashedMessage);case Do:return t.isEqual(Qt.defaultValues(e));case To:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||ii,value:[new $({name:t.version||vp}),Et.schema(t.messageImprint||{names:{blockName:bp}}),new Z({name:t.reqPolicy||Gh,optional:!0}),new $({name:t.nonce||zh,optional:!0}),new Ba({name:t.certReq||Xh,optional:!0}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:t.extensions||Yh,value:Ge.schema()})]})]})}fromSchema(e){q(e,LS);const t=_(e,e,Qt.schema());K.assertSchema(t,this.className),this.version=t.result[vp].valueBlock.valueDec,this.messageImprint=new Et({schema:t.result[bp]}),Gh in t.result&&(this.reqPolicy=t.result[Gh].valueBlock.toString()),zh in t.result&&(this.nonce=t.result[zh]),Xh in t.result&&(this.certReq=t.result[Xh].valueBlock.value),Yh in t.result&&(this.extensions=Array.from(t.result[Yh],s=>new Ge({schema:s})))}toSchema(){const e=[];return e.push(new $({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new Z({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),Zs in this&&Qt.compareWithDefault(Zs,this.certReq)===!1&&e.push(new Ba({value:this.certReq})),this.extensions&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,t=>t.toSchema())})),new B({value:e})}toJSON(){const e={version:this.version,messageImprint:this.messageImprint.toJSON()};return this.reqPolicy!==void 0&&(e.reqPolicy=this.reqPolicy),this.nonce!==void 0&&(e.nonce=this.nonce.toJSON()),this.certReq!==void 0&&Qt.compareWithDefault(Zs,this.certReq)===!1&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}}Qt.CLASS_NAME="TimeStampReq";const Ro="status",Lo="timeStampToken",Yp="TimeStampResp",Ap="".concat(Yp,".").concat(Ro),Qh="".concat(Yp,".").concat(Lo),US=[Ap,Qh];class Ec extends J{constructor(e={}){super(),this.status=f(e,Ro,Ec.defaultValues(Ro)),Lo in e&&(this.timeStampToken=f(e,Lo,Ec.defaultValues(Lo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ro:return new ps;case Lo:return new Ie;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ro:return ps.compareWithDefault(Ro,t.status)&&!("statusStrings"in t)&&!("failInfo"in t);case Lo:return t.contentType===E&&t.content instanceof ne;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new B({name:t.blockName||Yp,value:[ps.schema(t.status||{names:{blockName:Ap}}),Ie.schema(t.timeStampToken||{names:{blockName:Qh,optional:!0}})]})}fromSchema(e){q(e,US);const t=_(e,e,Ec.schema());K.assertSchema(t,this.className),this.status=new ps({schema:t.result[Ap]}),Qh in t.result&&(this.timeStampToken=new Ie({schema:t.result[Qh]}))}toSchema(){const e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new B({value:e})}toJSON(){const e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,s=ce(!0)){return this.assertContentType(),new vt({schema:this.timeStampToken.content}).sign(e,0,t,void 0,s)}async verify(e={signer:0,trustedCerts:[],data:Qe},t=ce(!0)){return this.assertContentType(),new vt({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==Xw)throw new Error("Wrong format of timeStampToken: ".concat(this.timeStampToken.contentType))}}Ec.CLASS_NAME="TimeStampResp";function jS(){if(typeof self<"u"){if("crypto"in self){let r="webcrypto";"webkitSubtle"in self.crypto&&(r="safari"),wg(r,new Dc({name:r,crypto}))}}else if(typeof crypto<"u"&&"webcrypto"in crypto){const r="NodeJS ^15",e=crypto.webcrypto;wg(r,new Dc({name:r,crypto:e}))}}jS();function $S(r){return String.fromCharCode(...r)}function iy(r){return Uint8Array.from(r,e=>e.charCodeAt(0))}function MS(r){return Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")}function $s(r){return iy(atob(r))}function Qp(r){const e=r.replace(/-----BEGIN ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/-----END ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/\n/g,"");return $s(e)}var KS=Object.defineProperty,HS=Object.defineProperties,FS=Object.getOwnPropertyDescriptors,Tg=Object.getOwnPropertySymbols,JS=Object.prototype.hasOwnProperty,qS=Object.prototype.propertyIsEnumerable,Rg=(r,e,t)=>e in r?KS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Sp=(r,e)=>{for(var t in e||(e={}))JS.call(e,t)&&Rg(r,t,e[t]);if(Tg)for(var t of Tg(e))qS.call(e,t)&&Rg(r,t,e[t]);return r},Lg=(r,e)=>HS(r,FS(e));async function Zp(r,e,t={}){return await self.crypto.subtle.decrypt(Sp({name:"AES-GCM"},t),e,r)}async function _S(r,e){return await self.crypto.subtle.decrypt({name:"RSA-OAEP"},e,r)}async function oy(r){return await self.crypto.subtle.importKey("raw",r,{name:"AES-GCM",length:128},!0,["decrypt","encrypt"])}async function WS(r,e){return await self.crypto.subtle.importKey("spki",r,{name:"RSASSA-PKCS1-v1_5",hash:e},!0,["verify"])}async function GS(r){return await self.crypto.subtle.importKey("pkcs8",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])}async function zS(r){return new Uint8Array(await self.crypto.subtle.exportKey("raw",r))}async function XS(r){const e=await self.crypto.subtle.digest("SHA-256",r);return MS(new Uint8Array(e))}async function YS(r,e){const t=new qy(r),s=await WS(Qp(e),t.signatureAlgorithm.hash.name);return t.verify({publicKey:s},QS())}function QS(){return Lg(Sp({},self.crypto),{subtle:Lg(Sp({},self.crypto.subtle),{async verify(r,e,t,s){return self.crypto.subtle.verify(r,e,new Uint8Array(t),new Uint8Array(s))}})})}async function ZS(r,e,t){const s=Ie.fromBER(e),a=new vt({schema:s.content}),n=a.signerInfos[0].sid.issuer.typesAndValues.find(({type:u})=>u==="2.5.4.3").value.valueBlock.value,i=t.find(({userId:u})=>u===n);if(i===void 0)throw new Error("Signer not found in the users array");const o=ye.fromBER(Qp(i.certificate));return await a.verify({signer:0,trustedCerts:[o],data:r,checkChain:!0},tN())}class eN extends Dc{verify(e,t,s,a){return super.verify(e,t,s,new Uint8Array(a))}}function tN(){return new eN({crypto:self.crypto})}var sN=Object.defineProperty,Ug=Object.getOwnPropertySymbols,rN=Object.prototype.hasOwnProperty,aN=Object.prototype.propertyIsEnumerable,jg=(r,e,t)=>e in r?sN(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,nN=(r,e)=>{for(var t in e||(e={}))rN.call(e,t)&&jg(r,t,e[t]);if(Ug)for(var t of Ug(e))aN.call(e,t)&&jg(r,t,e[t]);return r};async function iN(r,e){mt.debug("Decrypting private key",{privateKeyInfo:r,mnemonic:e});const t=await Promise.all([await Rf(e,r.salt,{hash:"SHA-256",iterations:6e5}),await Rf(e,r.salt,{hash:"SHA-1",iterations:1024}),await Rf(e,r.salt,{hash:"SHA-1",iterations:6e5})]);for(const s of t)try{const a=await Zp(r.encryptedPrivateKey,s,{iv:r.iv,tagLength:128}),n=atob($S(new Uint8Array(a)));return GS(Qp(n))}catch(a){}throw new Error("Failed to decrypt private key")}async function Rf(r,e,t){const s=await crypto.subtle.importKey("raw",new TextEncoder().encode(r.replaceAll(" ","")),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey(nN({name:"PBKDF2",salt:e},t),s,{name:"AES-GCM",length:256},!0,["decrypt","encrypt"])}const $g="apps/end_to_end_encryption/api/v2",uy={PrivateKey:$g+"/private-key",ServerKey:$g+"/server-key"};async function oN(){const r=(await Jg.get(qg(uy.PrivateKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["private-key"],[e,t,s]=r.split("|");return{encryptedPrivateKey:$s(e),iv:$s(t),salt:$s(s)}}async function uN(){return await(await Jg.get(qg(uy.ServerKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["public-key"]}const lN={name:"AlertCircleOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var cN=function(){var r=this,e=r._self._c;return e("span",r._b({staticClass:"material-design-icon alert-circle-outline-icon",attrs:{"aria-hidden":r.title?null:"true","aria-label":r.title,role:"img"},on:{click:function(t){return r.$emit("click",t)}}},"span",r.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:r.fillColor,width:r.size,height:r.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z"}},[r.title?e("title",[r._v(r._s(r.title))]):r._e()])])])},hN=[],mN=Am(lN,cN,hN,!1,null,null);const fN=mN.exports,pN={name:"CheckIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var dN=function(){var r=this,e=r._self._c;return e("span",r._b({staticClass:"material-design-icon check-icon",attrs:{"aria-hidden":r.title?null:"true","aria-label":r.title,role:"img"},on:{click:function(t){return r.$emit("click",t)}}},"span",r.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:r.fillColor,width:r.size,height:r.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}},[r.title?e("title",[r._v(r._s(r.title))]):r._e()])])])},gN=[],wN=Am(pN,dN,gN,!1,null,null);const yN=wN.exports,vN={name:"NcInputField",components:{NcButton:ky,AlertCircle:fN,Check:yN},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:{value:{type:[String,Number],default:void 0},modelValue:{type:[String,Number],default:void 0},type:{type:String,default:"text",validator:r=>["text","password","email","tel","url","search","number"].includes(r)},label:{type:String,default:void 0},labelOutside:{type:Boolean,default:!1},placeholder:{type:String,default:void 0},showTrailingButton:{type:Boolean,default:!1},trailingButtonLabel:{type:String,default:""},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1},helperText:{type:String,default:""},disabled:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},inputClass:{type:[Object,String],default:""}},emits:["update:value","update:modelValue","update:model-value","trailing-button-click"],setup(){const r=Wg("value","update:value",!0);return{isLegacy32:cd,model:r}},computed:{computedId(){return this.$attrs.id&&this.$attrs.id!==""?this.$attrs.id:this.inputName},inputName(){return"input"+Cy()},hasTrailingIcon(){return this.success},computedPlaceholder(){if(this.placeholder)return this.placeholder;if(this.label)return cd?this.label:""},isValidLabel(){const r=this.label||this.labelOutside;return r||Iy.warn("You need to add a label to the NcInputField component. Either use the prop label or use an external one, as per the example in the documentation."),r},ariaDescribedby(){const r=[];return this.helperText.length>0&&r.push("".concat(this.inputName,"-helper-text")),this.$attrs["aria-describedby"]&&r.push(this.$attrs["aria-describedby"]),r.join(" ")||null}},methods:{focus(){this.$refs.input.focus()},select(){this.$refs.input.select()},handleInput(r){const e=this.type==="number"&&typeof this.model=="number"?parseFloat(r.target.value,10):r.target.value;this.model=e},handleTrailingButtonClick(r){this.$emit("trailing-button-click",r)}}};var bN=function(){var t;var r=this,e=r._self._c;return e("div",{staticClass:"input-field",class:{"input-field--disabled":r.disabled,"input-field--error":r.error,"input-field--label-outside":r.labelOutside||!r.isValidLabel,"input-field--leading-icon":!!r.$scopedSlots.icon||!!r.$scopedSlots.default||!!r.$slots.default,"input-field--success":r.success,"input-field--trailing-icon":r.showTrailingButton||r.hasTrailingIcon,"input-field--pill":r.pill,"input-field--legacy":r.isLegacy32}},[e("div",{staticClass:"input-field__main-wrapper"},[e("input",r._g(r._b({ref:"input",staticClass:"input-field__input",class:[r.inputClass,{"input-field__input--success":r.success,"input-field__input--error":r.error}],attrs:{id:r.computedId,type:r.type,disabled:r.disabled,placeholder:r.computedPlaceholder,"aria-describedby":r.ariaDescribedby,"aria-live":"polite"},domProps:{value:(t=r.model)==null?void 0:t.toString()},on:{input:r.handleInput}},"input",r.$attrs,!1),r.$listeners)),!r.labelOutside&&r.isValidLabel?e("label",{staticClass:"input-field__label",attrs:{for:r.computedId}},[r._v(" "+r._s(r.label)+" ")]):r._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:!!r.$scopedSlots.icon||!!r.$scopedSlots.default||!!r.$slots.default,expression:"!!$scopedSlots.icon || !!$scopedSlots.default || !!$slots.default"}],staticClass:"input-field__icon input-field__icon--leading"},[r._t("icon",function(){return[r._t("default")]})],2),r.showTrailingButton?e("NcButton",{staticClass:"input-field__trailing-button",attrs:{"aria-label":r.trailingButtonLabel,disabled:r.disabled,variant:"tertiary-no-background"},on:{click:r.handleTrailingButtonClick},scopedSlots:r._u([{key:"icon",fn:function(){return[r._t("trailing-button-icon")]},proxy:!0}],null,!0)}):r.success||r.error?e("div",{staticClass:"input-field__icon input-field__icon--trailing"},[r.success?e("Check",{staticStyle:{color:"var(--color-success-text)"},attrs:{size:20}}):r.error?e("AlertCircle",{staticStyle:{color:"var(--color-error-text)"},attrs:{size:20}}):r._e()],1):r._e()],1),r.helperText.length>0?e("p",{staticClass:"input-field__helper-text-message",class:{"input-field__helper-text-message--error":r.error,"input-field__helper-text-message--success":r.success},attrs:{id:"".concat(r.inputName,"-helper-text")}},[r.success?e("Check",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):r.error?e("AlertCircle",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):r._e(),r._v(" "+r._s(r.helperText)+" ")],1):r._e()])},AN=[],SN=Am(vN,bN,AN,!1,null,"a3ad91bd");const Np=SN.exports;By(Vy,xy);const NN=new Set(Object.keys(Np.props)),EN={name:"NcTextField",components:{NcIconSvgWrapper:Py,NcInputField:Np},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:xs(It({" ":{}},Np.props),{trailingButtonLabel:{type:String,default:""},trailingButtonIcon:{type:String,default:"close",validator:r=>["close","arrowEnd","arrowRight","undo"].includes(r)}}),emits:["update:value","update:modelValue","update:model-value"],setup(){return{model:Wg("value","update:value"),mdiArrowRight:Ty,mdiClose:Dy,mdiUndo:Oy}},computed:{isArrow(){return this.trailingButtonIcon==="arrowEnd"||this.trailingButtonIcon==="arrowRight"},propsAndAttrsToForward(){const r={arrowEnd:Kc("Save changes"),arrowRight:Kc("Save changes"),close:Kc("Clear text"),undo:Kc("Undo changes")};return xs(It(It({},this.$attrs),Object.fromEntries(Object.entries(this.$props).filter(([e])=>NN.has(e)))),{trailingButtonLabel:this.trailingButtonLabel||r[this.trailingButtonIcon]})}},methods:{focus(){this.$refs.inputField.focus()},select(){this.$refs.inputField.select()}}};var kN=function(){var r=this,e=r._self._c;return e("NcInputField",r._g(r._b({ref:"inputField",scopedSlots:r._u([r.$scopedSlots.icon||r.$slots.default||r.$scopedSlots.default?{key:"icon",fn:function(){return[r._t("icon",function(){return[r._t("default")]})]},proxy:!0}:null,r.type!=="search"?{key:"trailing-button-icon",fn:function(){return[r.isArrow?e("NcIconSvgWrapper",{attrs:{directional:"",path:r.mdiArrowRight}}):e("NcIconSvgWrapper",{attrs:{path:r.trailingButtonIcon==="undo"?r.mdiUndo:r.mdiClose}})]},proxy:!0}:null],null,!0)},"NcInputField",r.propsAndAttrsToForward,!1),r.$listeners))},IN=[],CN=Am(EN,kN,IN,!1,null,null);const BN=CN.exports,xN=Ry({__name:"MnemonicPromptDialog",emits:["close"],setup(r,{emit:e}){const t=Tm(),s=Tm(""),a=Tm(!1),n=hd(()=>a.value===!0&&s.value.trim().split(/\s+/g).length===12);function i(){e("close",s.value)}const o=hd(()=>[{label:jf("end_to_en_encryption","Submit"),nativeType:"submit",type:"primary",disabled:!n.value,callback:i}]);return{__sfc:!0,emit:e,dialogRef:t,mnemonic:s,confirmToggle:a,isFormValid:n,submit:i,buttons:o,t:jf,NcDialog:Gy,NcTextField:BN,NcNoteCard:Wy,NcCheckboxRadioSwitch:_y}}});var VN=function(){var r=this,e=r._self._c,t=r._self._setupProxy;return e(t.NcDialog,{ref:"dialogRef",attrs:{name:t.t("end_to_end_encryption","Enter your 12 words mnemonic"),buttons:t.buttons,"is-form":!0},on:{submit:t.submit}},[e(t.NcNoteCard,{attrs:{type:"warning","show-alert":!0,heading:t.t("end_to_end_encryption","Decrypting your files in the browser can weaken security")}},[r._v(" "+r._s(t.t("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" "),e(t.NcCheckboxRadioSwitch,{attrs:{required:!0,"data-cy-e2ee-mnemonic-prompt":"i_understand_the_risks",type:"switch"},model:{value:t.confirmToggle,callback:function(s){t.confirmToggle=s},expression:"confirmToggle"}},[r._v(" "+r._s(t.t("end_to_end_encryption","I understand the risks"))+" ")])],1),e(t.NcTextField,{attrs:{value:t.mnemonic,required:"true",pattern:"^(\\w+\\s+){11}\\w+$",label:t.t("end_to_end_encryption","Mnemonic"),autofocus:!0},on:{"update:value":function(s){t.mnemonic=s}}})],1)},PN=[],ON=Ly(xN,VN,PN,!1,null,null);const DN=ON.exports;async function TN(){const r=Promise.withResolvers();return zy(DN,void 0,e=>{e!==void 0?r.resolve(e):r.reject()}),r.promise}async function RN(r,e){mt.debug("Decrypting metadata info",{metadata:r});const[t,s]=r.metadata.ciphertext.split("|"),a=await Zp($s(t),e,{iv:$s(s)}),n=JSON.parse(await jN(a));return LN(n,r),await UN(n,e),n}function LN(r,e){var t,s;if(((t=r.keyChecksums)==null?void 0:t.length)!==((s=e.users)==null?void 0:s.length))throw new Error("Key checksums length does not match users length")}async function UN(r,e){if(r.keyChecksums===void 0)return;const t=await zS(e),s=await XS(t);if(!r.keyChecksums.includes(s))throw new Error("Key checksum is not in keyChecksums")}async function jN(r){const e=new ReadableStream({start(t){t.enqueue(new Uint8Array(r)),t.close()}}).pipeThrough(new DecompressionStream("gzip"));return await new Response(e).text()}async function $N(r,e,t){var s;mt.debug("Getting metadata private key",{metadata:r,userId:e});const a=(s=r.users)==null?void 0:s.find(o=>o.userId===e);if(!a)throw new Error("User not found in metadata");const n=$s(a.encryptedMetadataKey),i=await _S(n,t);return await oy(new Uint8Array(i))}async function Mg(r,e,t){const s=JSON.stringify(r,(n,i)=>{if(n!=="filedrop")return i}),a=await ZS(iy(btoa(s)),$s(e),t.users);if(!a)throw new Error("Metadata signature verification failed");return a}async function MN(r,e){const t=r.users.map(async({userId:s,certificate:a})=>{const n=await YS(a,e);if(!n)throw new Error("Certificate verification failed for user ".concat(s));return n});return await Promise.all(t)}const KN=av(),Pt={_userPrivateKey:void 0,_serverPublicKey:void 0,_metadataCache:{},async getUserPrivateKey(){var r;return(r=this._userPrivateKey)!=null||(this._userPrivateKey=await iN(await oN(),await TN())),this._userPrivateKey},async getServerPublicKeyPEM(){var r;return(r=this._serverPublicKey)!=null||(this._serverPublicKey=await uN()),this._serverPublicKey},async getMetadata(r){if(this._metadataCache[r])return mt.debug("Found metadata in cache",{path:r,state:Pt}),this._metadataCache[r];if(mt.debug("Fetching PROPFIND for metadata",{path:r,state:Pt}),await KN.stat(decodeURI(r).replace("remote.php/dav/",""),{details:!0,data:ev()}),this._metadataCache[r])return mt.debug("Found metadata in cache after PROPFIND",{path:r,state:Pt}),this._metadataCache[r];throw new Error("Could not find metadata for ".concat(r))},async setMetadata(r,e,t){const s=JSON.parse(e);Ah(s)?(await Mg(s,t,s),await MN(s,await this.getServerPublicKeyPEM())):await Mg(s,t,await this.getRootMetadata(zo.dirname(r))),this._metadataCache[r]=s,mt.debug("Added metadata in cache",{path:r,state:Pt})},async getMetadataInfo(r){const e=await this.getMetadata(r),t=await this.getRootMetadata(r),s=Ep();if(s===null)throw new Error("No user logged in");return RN(e,await $N(t,s.uid,await Pt.getUserPrivateKey()))},async getRootMetadata(r){const e=Object.entries(Pt._metadataCache).filter(([t])=>r.startsWith(t)).map(([,t])=>t).find(t=>Ah(t));if(e)return mt.debug("Found root metadata in cache",{path:r,state:Pt}),e;for(mt.debug("Looking for root metadata",{path:r,state:Pt});r!=="/";){const t=await Pt.getMetadata(r);if(Ah(t))return mt.debug("Fetched root metadata",{path:r,state:Pt}),t;r=zo.dirname(r)}throw new Error("Found no root metadata for ".concat(r))}};var HN=Object.defineProperty,FN=Object.defineProperties,JN=Object.getOwnPropertyDescriptors,Kg=Object.getOwnPropertySymbols,qN=Object.prototype.hasOwnProperty,_N=Object.prototype.propertyIsEnumerable,Hg=(r,e,t)=>e in r?HN(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,WN=(r,e)=>{for(var t in e||(e={}))qN.call(e,t)&&Hg(r,t,e[t]);if(Kg)for(var t of Kg(e))_N.call(e,t)&&Hg(r,t,e[t]);return r},GN=(r,e)=>FN(r,JN(e));let bm;function zN(){bm=window.fetch,mt.debug("Setting up WebDAV decryption proxy"),window.fetch=async(r,e={})=>{let t=new Request(r,e);if(!(t.url.includes("/remote.php/dav/files/")&&(t.method==="GET"||t.method==="PROPFIND")))return bm(t);mt.debug("Proxying ".concat(t.method," ").concat(t.url),{request:t});const s=new Headers(t.headers);switch(s.set("X-E2EE-SUPPORTED","true"),t=new Request(t,{headers:s}),t.method){case"PROPFIND":return YN(t);case"GET":default:return XN(t)}}}async function XN(r){const e=new URL(r.url).pathname,t=bm(r);try{const s=await Pt.getMetadataInfo(zo.dirname(e)),a=s.files[zo.basename(r.url)];if(a===void 0)throw mt.debug("Could not find file in metadata",{path:e,metadataInfo:s}),new Error("Could not find file in metadata");return await QN(await t,a)}catch(s){return await t}}async function YN(r){var e;mt.debug("Fetching raw PROPFIND",{request:r});const t=await bm(r),s=new URL(r.url).pathname,a=await t.text(),n=await Uc(a),i=ww(n,s,!0);if(((e=i.props)==null?void 0:e["e2ee-is-encrypted"])!==1)return mt.debug("Node is not e2ee",{xml:n}),new Response(a,t);if(i.type==="directory"){const o=i.props["e2ee-metadata"],u=i.props["e2ee-metadata-signature"];o!==void 0&&u!==void 0&&await Pt.setMetadata(s,o,u);const h=await Pt.getMetadata(s),l=await Pt.getMetadataInfo(s);if(Ah(h))Lf(n,s,l);else{const d=await Pt.getMetadataInfo(zo.dirname(s));Lf(n,s,l,d)}}else if(i.type==="file"){const o=await Pt.getMetadataInfo(zo.dirname(s));if(o===void 0)return mt.debug("Cannot find metadata for parent folder",{path:s}),new Response(a,t);Lf(n,s,void 0,o)}return new Response(new ga().build(n),t)}function Lf(r,e,t,s){mt.debug("Updating PROPFIND info",{path:e,decryptedMetadata:t,decryptedParentMetadata:s,xml:r}),r.multistatus.response.forEach(a=>{if(a.propstat===void 0)return;const n=a.href===e?s:t,i=a.propstat.prop.displayname;let o=i;n!==void 0&&(n.files[i]?(o=n.files[i].filename,a.propstat.prop.getcontenttype=n.files[i].mimetype):n.folders[i]&&(o=n.folders[i],a.propstat.prop.getcontenttype="httpd/unix-directory")),a.propstat.prop.displayname=o,a.propstat.prop.permissions=a.propstat.prop.permissions.replace(/(R)|(D)|(N)|(V)|(W)|(CK)/g,"")})}async function QN(r,e){mt.debug("Decrypting encrypted file",{response:r,fileEncryptionInfo:e});const t=await Zp(new Uint8Array(await r.arrayBuffer()),await oy($s(e.key)),{iv:$s(e.nonce)}),s=new Headers(r.headers);return s.set("Content-Type",e.mimetype),new Response(t,GN(WN({},r),{headers:s}))}const ZN='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-arrow-down" viewBox="0 0 24 24"><path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" /></svg>';function eE(r){if((r.permissions&Iw.READ)===0)return!1;if(r.attributes["share-attributes"]){const e=JSON.parse(r.attributes["share-attributes"]||"[]").find(({scope:t,key:s})=>t==="permissions"&&s==="download");if(e!==void 0)return e.value===!0}return!0}async function tE([r]){const e=await(await fetch(r.encodedSource)).arrayBuffer(),t=new Blob([e],{type:r.mime}),s=document.createElement("a");s.href=window.URL.createObjectURL(t),s.download=r.displayname,s.click()}const sE=new cv({id:"download_unencrypted",default:Tp.DEFAULT,displayName:()=>jf("files","Download unencrypted"),iconSvgInline:()=>ZN,enabled(r){return r.length!==1||r.some(e=>e.attributes["e2ee-is-encrypted"]!==1)||r.some(e=>!e.isDavRessource)||r.some(e=>e.type!==kw.File)?!1:r.every(eE)},async exec(r){return tE([r]),null},order:30}),rE=Uy("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1});rE.e2eeInBrowserEnabled&&(zN(),qm("nc:e2ee-is-encrypted",{nc:"http://nextcloud.org/ns"}),qm("nc:e2ee-metadata",{nc:"http://nextcloud.org/ns"}),qm("nc:e2ee-metadata-signature",{nc:"http://nextcloud.org/ns"}),hv(sE),Fg("download"),Fg("move-copy"));function Fg(r){mt.debug("Inhibiting ".concat(r," actions for e2ee files"));const e=mv().find(s=>s.id===r),t=e._action.enabled;e._action.enabled=(s,a)=>s.some(n=>n.attributes["e2ee-is-encrypted"]===1)?!1:t(s,a)}
//# sourceMappingURL=end_to_end_encryption-files.mjs.map
