(function(){"use strict";try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode("/*!\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */.toastify.dialogs{min-width:200px;background:none;background-color:var(--color-main-background);color:var(--color-main-text);box-shadow:0 0 6px 0 var(--color-box-shadow);padding:0 12px;margin-top:45px;position:fixed;z-index:10100;border-radius:var(--border-radius);display:flex;align-items:center;min-height:50px}.toastify.dialogs .toast-loader-container,.toastify.dialogs .toast-undo-container{display:flex;align-items:center;width:100%}.toastify.dialogs .toast-undo-button,.toastify.dialogs .toast-close{position:static;overflow:hidden;box-sizing:border-box;min-width:44px;height:100%;padding:12px;white-space:nowrap;background-repeat:no-repeat;background-position:center;background-color:transparent;min-height:0}.toastify.dialogs .toast-undo-button.toast-close,.toastify.dialogs .toast-close.toast-close{text-indent:0;opacity:.4;border:none;min-height:44px;margin-left:10px;font-size:0}.toastify.dialogs .toast-undo-button.toast-close:before,.toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\");content:\" \";filter:var(--background-invert-if-dark);display:inline-block;width:16px;height:16px}.toastify.dialogs .toast-undo-button.toast-undo-button,.toastify.dialogs .toast-close.toast-undo-button{height:calc(100% - 6px);margin:3px 3px 3px 12px}.toastify.dialogs .toast-undo-button:hover,.toastify.dialogs .toast-undo-button:focus,.toastify.dialogs .toast-undo-button:active,.toastify.dialogs .toast-close:hover,.toastify.dialogs .toast-close:focus,.toastify.dialogs .toast-close:active{cursor:pointer;opacity:1}.toastify.dialogs.toastify-top{right:10px}.toastify.dialogs.toast-with-click{cursor:pointer}.toastify.dialogs.toast-error{border-left:3px solid var(--color-element-error, var(--color-error))}.toastify.dialogs.toast-info{border-left:3px solid var(--color-element-info, var(--color-primary))}.toastify.dialogs.toast-warning{border-left:3px solid var(--color-element-warning, var(--color-warning))}.toastify.dialogs.toast-success,.toastify.dialogs.toast-undo{border-left:3px solid var(--color-element-success, var(--color-success))}.toastify.dialogs.toast-loading{border-left:3px solid var(--color-element-info, var(--color-primary))}.toastify.dialogs.toast-loading .toast-loader{display:inline-block;width:20px;height:20px;animation:rotate var(--animation-duration, .8s) linear infinite;margin-left:auto}.theme--dark .toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill:%23fff;fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\")}.nc-generic-dialog .dialog__actions{justify-content:space-between;min-width:calc(100% - 12px)}/*!\n * SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */._file-picker__file-icon_3v9zx_9{position:relative;width:32px;height:32px;min-width:32px;min-height:32px;background-repeat:no-repeat;background-size:contain;display:flex;justify-content:center}._file-picker__file-icon--primary_3v9zx_21{color:var(--color-primary-element)}._file-picker__file-icon-overlay_3v9zx_25{color:var(--color-primary-element-text);position:absolute;inset-block-start:10px}tr.file-picker__row[data-v-15187afc]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-15187afc]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-15187afc]{padding:0 2px}tr.file-picker__row td[data-v-15187afc]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-15187afc]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-15187afc]{padding-inline:2px 0}@keyframes gradient-15187afc{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}.loading-row .row-checkbox[data-v-15187afc]{text-align:center!important}.loading-row span[data-v-15187afc]{display:inline-block;height:24px;background:linear-gradient(to right,var(--color-background-darker),var(--color-text-maxcontrast),var(--color-background-darker));background-size:600px 100%;border-radius:var(--border-radius);animation:gradient-15187afc 12s ease infinite}.loading-row .row-wrapper[data-v-15187afc]{display:inline-flex;align-items:center}.loading-row .row-checkbox span[data-v-15187afc]{width:24px}.loading-row .row-name span[data-v-15187afc]:last-of-type{margin-inline-start:6px;width:130px}.loading-row .row-size span[data-v-15187afc]{width:80px}.loading-row .row-modified span[data-v-15187afc]{width:90px}/*!\n* SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n* SPDX-License-Identifier: AGPL-3.0-or-later\n*/tr.file-picker__row[data-v-4892c2a0]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-4892c2a0]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-4892c2a0]{padding:0 2px}tr.file-picker__row td[data-v-4892c2a0]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-4892c2a0]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-4892c2a0]{padding-inline:2px 0}.file-picker__row--selected[data-v-4892c2a0]{background-color:var(--color-background-dark)}.file-picker__row[data-v-4892c2a0]:hover{background-color:var(--color-background-hover)}.file-picker__name-container[data-v-4892c2a0]{display:flex;justify-content:start;align-items:center;height:100%}.file-picker__file-name[data-v-4892c2a0]{padding-inline-start:6px;min-width:0;overflow:hidden;text-overflow:ellipsis}.file-picker__file-extension[data-v-4892c2a0]{color:var(--color-text-maxcontrast);min-width:fit-content}.file-picker__header-preview[data-v-4f5d2a56]{width:22px;height:32px;flex:0 0 auto}.file-picker__files[data-v-4f5d2a56]{margin:2px;margin-inline-start:12px;overflow:scroll auto}.file-picker__files table[data-v-4f5d2a56]{width:100%;max-height:100%;table-layout:fixed}.file-picker__files th[data-v-4f5d2a56]{position:-webkit-sticky;position:sticky;z-index:1;top:0;background-color:var(--color-main-background);padding:2px}.file-picker__files th .header-wrapper[data-v-4f5d2a56]{display:flex}.file-picker__files th.row-checkbox[data-v-4f5d2a56]{width:44px}.file-picker__files th.row-name[data-v-4f5d2a56]{width:230px}.file-picker__files th.row-size[data-v-4f5d2a56]{width:100px}.file-picker__files th.row-modified[data-v-4f5d2a56]{width:120px}.file-picker__files th[data-v-4f5d2a56]:not(.row-size) .button-vue__wrapper{justify-content:start;flex-direction:row-reverse}.file-picker__files th[data-v-4f5d2a56]:not(.row-size) .button-vue{padding-inline:16px 4px}.file-picker__files th.row-size[data-v-4f5d2a56] .button-vue__wrapper{justify-content:end}.file-picker__files th[data-v-4f5d2a56] .button-vue__wrapper{color:var(--color-text-maxcontrast)}.file-picker__files th[data-v-4f5d2a56] .button-vue__wrapper .button-vue__text{font-weight:400}.file-picker__breadcrumbs[data-v-ec4d392b]{flex-grow:0!important}.file-picker__side[data-v-f5975252]{display:flex;flex-direction:column;align-items:stretch;gap:.5rem;min-width:200px;padding:2px;margin-block-start:7px;overflow:auto}.file-picker__side[data-v-f5975252] .button-vue__wrapper{justify-content:start}.file-picker__filter-input[data-v-f5975252]{margin-block:7px;max-width:260px}@media (max-width: 736px){.file-picker__side[data-v-f5975252]{flex-direction:row;min-width:unset}}@media (max-width: 512px){.file-picker__side[data-v-f5975252]{flex-direction:row;min-width:unset}.file-picker__filter-input[data-v-f5975252]{max-width:unset}}.file-picker__navigation{padding-inline:8px 2px}.file-picker__navigation,.file-picker__navigation *{box-sizing:border-box}.file-picker__navigation .v-select.select{min-width:220px}@media (min-width: 513px) and (max-width: 736px){.file-picker__navigation{gap:11px}}@media (max-width: 512px){.file-picker__navigation{flex-direction:column-reverse!important}}.file-picker__view[data-v-552cc2f5]{height:50px;display:flex;justify-content:start;align-items:center}.file-picker__view h3[data-v-552cc2f5]{font-weight:700;height:fit-content;margin:0}.file-picker__main[data-v-552cc2f5]{box-sizing:border-box;width:100%;display:flex;flex-direction:column;min-height:0;flex:1;padding-inline:2px}.file-picker__main *[data-v-552cc2f5]{box-sizing:border-box}[data-v-552cc2f5] .file-picker{height:min(80vh,800px)!important}@media (max-width: 512px){[data-v-552cc2f5] .file-picker{height:calc(100% - 16px - var(--default-clickable-area))!important}}[data-v-552cc2f5] .file-picker__content{display:flex;flex-direction:column;overflow:hidden}.public-auth-prompt__text[data-v-414f7090]{font-size:1.25em;margin-block:0 calc(3 * var(--default-grid-baseline))}.public-auth-prompt__header[data-v-414f7090]{margin-block:0 calc(3 * var(--default-grid-baseline))}.public-auth-prompt__header[data-v-414f7090]:first-child{margin-top:0}.public-auth-prompt__input[data-v-414f7090]{margin-block:calc(4 * var(--default-grid-baseline)) calc(2 * var(--default-grid-baseline))}.material-design-icon[data-v-770f8cf7]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.input-field[data-v-770f8cf7]{--input-border-color: var(--color-border-maxcontrast);--input-border-radius: var(--border-radius-element);--input-border-width-offset: calc(var(--border-width-input-focused, 2px) - var(--border-width-input, 2px));--input-padding-start: var(--border-radius-large);--input-padding-end: var(--border-radius-large);position:relative;width:100%;margin-block-start:6px}.input-field--disabled[data-v-770f8cf7]{opacity:.4;filter:saturate(.4)}.input-field--label-outside[data-v-770f8cf7]{margin-block-start:0}.input-field--leading-icon[data-v-770f8cf7]{--input-padding-start: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--trailing-icon[data-v-770f8cf7]{--input-padding-end: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--pill[data-v-770f8cf7]{--input-border-radius: var(--border-radius-pill)}.input-field__main-wrapper[data-v-770f8cf7]{height:var(--default-clickable-area);padding:var(--border-width-input, 2px);position:relative}.input-field__main-wrapper[data-v-770f8cf7]:not(:has([disabled])):has(input:focus),.input-field__main-wrapper[data-v-770f8cf7]:not(:has([disabled])):has(input:active){padding:0}.input-field__input[data-v-770f8cf7]{background-color:var(--color-main-background);color:var(--color-main-text);border:none;border-radius:var(--input-border-radius);box-shadow:0 -1px var(--input-border-color),0 0 0 1px color-mix(in srgb,var(--input-border-color),65% transparent);cursor:pointer;-webkit-appearance:textfield!important;-moz-appearance:textfield!important;appearance:textfield!important;font-size:var(--default-font-size);text-overflow:ellipsis;height:100%!important;min-height:unset;width:100%;padding-block:var(--input-border-width-offset);padding-inline:calc(var(--input-padding-start) + var(--input-border-width-offset)) calc(var(--input-padding-end) + var(--input-border-width-offset))}.input-field__input[data-v-770f8cf7]::placeholder{color:var(--color-text-maxcontrast)}.input-field__input[data-v-770f8cf7]::-webkit-search-cancel-button{display:none}.input-field__input[data-v-770f8cf7]::-webkit-search-decoration,.input-field__input[data-v-770f8cf7]::-webkit-search-results-button,.input-field__input[data-v-770f8cf7]::-webkit-search-results-decoration,.input-field__input[data-v-770f8cf7]::-ms-clear{display:none}.input-field__input[data-v-770f8cf7]:hover:not([disabled]){box-shadow:0 0 0 1px var(--input-border-color)}.input-field__input[data-v-770f8cf7]:active:not([disabled]),.input-field__input[data-v-770f8cf7]:focus:not([disabled]){--input-border-color: var(--color-main-text);--input-border-width-offset: 0px;border:var(--border-width-input-focused, 2px) solid var(--input-border-color);box-shadow:0 0 0 2px var(--color-main-background)!important}.input-field__input:focus+.input-field__label[data-v-770f8cf7],.input-field__input:hover:not(:placeholder-shown)+.input-field__label[data-v-770f8cf7]{color:var(--color-main-text)}.input-field__input[data-v-770f8cf7]:focus{cursor:text}.input-field__input[data-v-770f8cf7]:disabled{cursor:default}.input-field__input[data-v-770f8cf7]:focus-visible{box-shadow:unset!important}.input-field__input--success[data-v-770f8cf7]{border-color:var(--color-border-success, var(--color-success))!important}.input-field__input--success[data-v-770f8cf7]:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field__input--error[data-v-770f8cf7],.input-field__input[data-v-770f8cf7]:user-invalid{border-color:var(--color-border-error, var(--color-error))!important}.input-field__input--error[data-v-770f8cf7]:focus-visible,.input-field__input[data-v-770f8cf7]:user-invalid:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field:not(.input-field--label-outside) .input-field__input[data-v-770f8cf7]:not(:focus)::placeholder{opacity:0}.input-field__label[data-v-770f8cf7]{--input-label-font-size: var(--default-font-size);position:absolute;margin-inline:var(--input-padding-start) var(--input-padding-end);max-width:fit-content;font-size:var(--input-label-font-size);inset-block-start:calc((var(--default-clickable-area) - 1lh) / 2);inset-inline:var(--border-width-input-focused, 2px);color:var(--color-text-maxcontrast);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;pointer-events:none;transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick),background-color var(--animation-quick) var(--animation-slow)}.input-field__input:focus+.input-field__label[data-v-770f8cf7],.input-field__input:not(:placeholder-shown)+.input-field__label[data-v-770f8cf7]{--input-label-font-size: 13px;line-height:1.5;inset-block-start:calc(-1.5 * var(--input-label-font-size) / 2);font-weight:500;border-radius:var(--default-grid-baseline) var(--default-grid-baseline) 0 0;background-color:var(--color-main-background);padding-inline:var(--default-grid-baseline);margin-inline:calc(var(--input-padding-start) - var(--default-grid-baseline)) calc(var(--input-padding-end) - var(--default-grid-baseline));transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick)}.input-field__icon[data-v-770f8cf7]{position:absolute;height:var(--default-clickable-area);width:var(--default-clickable-area);display:flex;align-items:center;justify-content:center;opacity:.7;inset-block-end:0}.input-field__icon--leading[data-v-770f8cf7]{inset-inline-start:0px}.input-field__icon--trailing[data-v-770f8cf7]{inset-inline-end:0px}.input-field__trailing-button[data-v-770f8cf7]{--button-size: calc(var(--default-clickable-area) - 2 * var(--border-width-input-focused, 2px)) !important;--button-radius: calc(var(--input-border-radius) - var(--border-width-input-focused, 2px))}.input-field__trailing-button.button-vue[data-v-770f8cf7]{position:absolute;top:var(--border-width-input-focused, 2px);inset-inline-end:var(--border-width-input-focused, 2px)}.input-field__trailing-button.button-vue[data-v-770f8cf7]:focus-visible{box-shadow:none!important}.input-field__helper-text-message[data-v-770f8cf7]{padding-block:4px;padding-inline:var(--border-radius-large);display:flex;align-items:center;color:var(--color-text-maxcontrast)}.input-field__helper-text-message__icon[data-v-770f8cf7]{margin-inline-end:8px}.input-field__helper-text-message--error[data-v-770f8cf7]{color:var(--color-text-error, var(--color-error))}.input-field--error .input-field__input[data-v-770f8cf7],.input-field__input[data-v-770f8cf7]:user-invalid{--input-border-color: var(--color-border-error, var(--color-error)) !important}.input-field--error .input-field__input[data-v-770f8cf7]:focus-visible,.input-field__input[data-v-770f8cf7]:user-invalid:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field--success .input-field__input[data-v-770f8cf7]{--input-border-color: var(--color-border-success, var(--color-success)) !important}.input-field--success .input-field__input[data-v-770f8cf7]:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field--legacy .input-field__input[data-v-770f8cf7]{box-shadow:0 0 0 1px var(--input-border-color) inset}.input-field--legacy .input-field__main-wrapper[data-v-770f8cf7]:hover:not(:has([disabled])){padding:0}.input-field--legacy .input-field__main-wrapper:hover:not(:has([disabled])) .input-field__input[data-v-770f8cf7]{--input-border-color: var(--color-main-text);--input-border-width-offset: 0px;border:var(--border-width-input-focused, 2px) solid var(--input-border-color);box-shadow:0 0 0 2px var(--color-main-background)!important}")),document.head.appendChild(i)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
var zw=Object.defineProperty,Xw=Object.defineProperties;var Yw=Object.getOwnPropertyDescriptors;var ed=Object.getOwnPropertySymbols;var Qw=Object.prototype.hasOwnProperty,Zw=Object.prototype.propertyIsEnumerable;var td=r=>{throw TypeError(r)};var Em=(r,e,t)=>e in r?zw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Gt=(r,e)=>{for(var t in e||(e={}))Qw.call(e,t)&&Em(r,t,e[t]);if(ed)for(var t of ed(e))Zw.call(e,t)&&Em(r,t,e[t]);return r},fr=(r,e)=>Xw(r,Yw(e));var tt=(r,e,t)=>Em(r,typeof e!="symbol"?e+"":e,t),km=(r,e,t)=>e.has(r)||td("Cannot "+t);var Z=(r,e,t)=>(km(r,e,"read from private field"),t?t.call(r):e.get(r)),Jt=(r,e,t)=>e.has(r)?td("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),qe=(r,e,t,s)=>(km(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),pr=(r,e,t)=>(km(r,e,"access private method"),t);import{l as dp,p as lt,g as Wt,a as Bf,b as gp,U as ey,c as ty,o as sy,d as ry,B as Im,e as Og,v as Pg,n as pm,N as ay,f as ny,i as sd,G as iy,r as oy,t as uy,h as ly,j as cy,k as Dc,m as hy,q as my,s as fy,u as py,w as Cm,x as rd,y as Of,z as dy,A as Fo}from"./_plugin-vue2_normalizer-D54WreRG.chunk.mjs";import{f as Xe,B as Be,s as Jo,a as qh,O as X,N as at,g as d,S as O,I as H,C as L,R as me,c as G,b as z,d as ae,e as ye,h as je,A as le,P as ue,i as Ae,j as nt,k as wc,n as gy,l as yc,m as Wh,u as Uo,t as Pf,G as $e,o as Ia,U as Df,T as Tf,p as er,q as Rf,r as _h,v as Uf,w as Dg,x as ch,V as wy,y as yy,z as vy,D as by,E as Sy,F as vc,H as Ay,J as ad,K as nd,X as Ny}from"./x509.es-LdUcWQbH.chunk.mjs";import{N as Ey,a as ky,b as Iy,s as Cy}from"./NcCheckboxRadioSwitch-ezquUuPz-BOf-7LZX.chunk.mjs";import{u as Tg}from"./useModelMigration-DBUi8saj-D8jFcWuO.chunk.mjs";function Rg(){var r;return(r=dp("files_sharing","isPublic",null))!=null?r:document.querySelector('input#isPublic[type="hidden"][name="isPublic"][value="1"]')!==null}function Vy(){var r,e,t;return(t=(e=dp("files_sharing","sharingToken",null))!=null?e:(r=document.querySelector('input#sharingToken[type="hidden"]'))==null?void 0:r.value)!=null?t:null}function Sr(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function id(r,e,t){xy(r,e),e.set(r,t)}function xy(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function At(r,e){var t=Ug(r,e,"get");return By(r,t)}function By(r,e){return e.get?e.get.call(r):e.value}function od(r,e,t){var s=Ug(r,e,"set");return Oy(r,s,t),t}function Ug(r,e,t){if(!e.has(r))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(r)}function Oy(r,e,t){if(e.set)e.set.call(r,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}var Py=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",kt=new WeakMap,Zo=new WeakMap;class dm{constructor(e){var{executor:t=()=>{},internals:s=yp(),promise:a=new Promise((n,i)=>t(n,i,o=>{s.onCancelList.push(o)}))}=e;id(this,kt,{writable:!0,value:void 0}),id(this,Zo,{writable:!0,value:void 0}),Sr(this,Py,"CancelablePromise"),this.cancel=this.cancel.bind(this),od(this,kt,s),od(this,Zo,a||new Promise((n,i)=>t(n,i,o=>{s.onCancelList.push(o)})))}then(e,t){return hh(At(this,Zo).then(Tc(e,At(this,kt)),Tc(t,At(this,kt))),At(this,kt))}catch(e){return hh(At(this,Zo).catch(Tc(e,At(this,kt))),At(this,kt))}finally(e,t){return t&&At(this,kt).onCancelList.push(e),hh(At(this,Zo).finally(Tc(()=>{if(e)return t&&(At(this,kt).onCancelList=At(this,kt).onCancelList.filter(s=>s!==e)),e()},At(this,kt))),At(this,kt))}cancel(){At(this,kt).isCanceled=!0;var e=At(this,kt).onCancelList;At(this,kt).onCancelList=[];for(var t of e)if(typeof t=="function")try{t()}catch(s){console.error(s)}}isCanceled(){return At(this,kt).isCanceled===!0}}class Ar extends dm{constructor(e){super({executor:e})}}Sr(Ar,"all",function(r){return Rc(r,Promise.all(r))}),Sr(Ar,"allSettled",function(r){return Rc(r,Promise.allSettled(r))}),Sr(Ar,"any",function(r){return Rc(r,Promise.any(r))}),Sr(Ar,"race",function(r){return Rc(r,Promise.race(r))}),Sr(Ar,"resolve",function(r){return ud(Promise.resolve(r))}),Sr(Ar,"reject",function(r){return ud(Promise.reject(r))}),Sr(Ar,"isCancelable",wp);function ud(r){return hh(r,yp())}function wp(r){return r instanceof Ar||r instanceof dm}function Tc(r,e){if(r)return t=>{if(!e.isCanceled){var s=r(t);return wp(s)&&e.onCancelList.push(s.cancel),s}return t}}function hh(r,e){return new dm({internals:e,promise:r})}function Rc(r,e){var t=yp();return t.onCancelList.push(()=>{for(var s of r)wp(s)&&s.cancel()}),new dm({internals:t,promise:e})}function yp(){return{isCanceled:!1,onCancelList:[]}}var Vm={},Dy={2:r=>{function e(a,n,i){a instanceof RegExp&&(a=t(a,i)),n instanceof RegExp&&(n=t(n,i));var o=s(a,n,i);return o&&{start:o[0],end:o[1],pre:i.slice(0,o[0]),body:i.slice(o[0]+a.length,o[1]),post:i.slice(o[1]+n.length)}}function t(a,n){var i=n.match(a);return i?i[0]:null}function s(a,n,i){var o,h,u,l,f,m=i.indexOf(a),v=i.indexOf(n,m+1),w=m;if(m>=0&&v>0){for(o=[],u=i.length;w>=0&&!f;)w==m?(o.push(w),m=i.indexOf(a,w+1)):o.length==1?f=[o.pop(),v]:((h=o.pop())<u&&(u=h,l=v),v=i.indexOf(n,w+1)),w=m<v&&m>=0?m:v;o.length&&(f=[u,l])}return f}r.exports=e,e.range=s},101:function(r,e,t){var s;r=t.nmd(r),function(a){var n=(r&&r.exports,typeof Wt=="object"&&Wt);n.global!==n&&n.window;var i=function(f){this.message=f};(i.prototype=new Error).name="InvalidCharacterError";var o=function(f){throw new i(f)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=/[\t\n\f\r ]/g,l={encode:function(f){f=String(f),/[^\0-\xFF]/.test(f)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var m,v,w,S,y=f.length%3,k="",p=-1,b=f.length-y;++p<b;)m=f.charCodeAt(p)<<16,v=f.charCodeAt(++p)<<8,w=f.charCodeAt(++p),k+=h.charAt((S=m+v+w)>>18&63)+h.charAt(S>>12&63)+h.charAt(S>>6&63)+h.charAt(63&S);return y==2?(m=f.charCodeAt(p)<<8,v=f.charCodeAt(++p),k+=h.charAt((S=m+v)>>10)+h.charAt(S>>4&63)+h.charAt(S<<2&63)+"="):y==1&&(S=f.charCodeAt(p),k+=h.charAt(S>>2)+h.charAt(S<<4&63)+"=="),k},decode:function(f){var m=(f=String(f).replace(u,"")).length;m%4==0&&(m=(f=f.replace(/==?$/,"")).length),(m%4==1||/[^+a-zA-Z0-9/]/.test(f))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var v,w,S=0,y="",k=-1;++k<m;)w=h.indexOf(f.charAt(k)),v=S%4?64*v+w:w,S++%4&&(y+=String.fromCharCode(255&v>>(-2*S&6)));return y},version:"1.0.0"};(s=function(){return l}.call(e,t,e,r))===void 0||(r.exports=s)}()},172:(r,e)=>{e.d=function(t){if(!t)return 0;for(var s=(t=t.toString()).length,a=t.length;a--;){var n=t.charCodeAt(a);56320<=n&&n<=57343&&a--,127<n&&n<=2047?s++:2047<n&&n<=65535&&(s+=2)}return s}},526:r=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var s=[],a=0;a<t.length;a++)s.push(255&t.charCodeAt(a));return s},bytesToString:function(t){for(var s=[],a=0;a<t.length;a++)s.push(String.fromCharCode(t[a]));return s.join("")}}};r.exports=e},298:r=>{var e,t;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(s,a){return s<<a|s>>>32-a},rotr:function(s,a){return s<<32-a|s>>>a},endian:function(s){if(s.constructor==Number)return 16711935&t.rotl(s,8)|4278255360&t.rotl(s,24);for(var a=0;a<s.length;a++)s[a]=t.endian(s[a]);return s},randomBytes:function(s){for(var a=[];s>0;s--)a.push(Math.floor(256*Math.random()));return a},bytesToWords:function(s){for(var a=[],n=0,i=0;n<s.length;n++,i+=8)a[i>>>5]|=s[n]<<24-i%32;return a},wordsToBytes:function(s){for(var a=[],n=0;n<32*s.length;n+=8)a.push(s[n>>>5]>>>24-n%32&255);return a},bytesToHex:function(s){for(var a=[],n=0;n<s.length;n++)a.push((s[n]>>>4).toString(16)),a.push((15&s[n]).toString(16));return a.join("")},hexToBytes:function(s){for(var a=[],n=0;n<s.length;n+=2)a.push(parseInt(s.substr(n,2),16));return a},bytesToBase64:function(s){for(var a=[],n=0;n<s.length;n+=3)for(var i=s[n]<<16|s[n+1]<<8|s[n+2],o=0;o<4;o++)8*n+6*o<=8*s.length?a.push(e.charAt(i>>>6*(3-o)&63)):a.push("=");return a.join("")},base64ToBytes:function(s){s=s.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],n=0,i=0;n<s.length;i=++n%4)i!=0&&a.push((e.indexOf(s.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|e.indexOf(s.charAt(n))>>>6-2*i);return a}},r.exports=t},635:(r,e,t)=>{const s=t(31),a=t(338),n=t(221);r.exports={XMLParser:a,XMLValidator:s,XMLBuilder:n}},118:r=>{r.exports=function(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const s of e)if(typeof s=="string"&&t===s||s instanceof RegExp&&s.test(t))return!0}:()=>!1}},705:(r,e)=>{const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",s="["+t+"]["+t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",a=new RegExp("^"+s+"$");e.isExist=function(n){return n!==void 0},e.isEmptyObject=function(n){return Object.keys(n).length===0},e.merge=function(n,i,o){if(i){const h=Object.keys(i),u=h.length;for(let l=0;l<u;l++)n[h[l]]=o==="strict"?[i[h[l]]]:i[h[l]]}},e.getValue=function(n){return e.isExist(n)?n:""},e.isName=function(n){return a.exec(n)!=null},e.getAllMatches=function(n,i){const o=[];let h=i.exec(n);for(;h;){const u=[];u.startIndex=i.lastIndex-h[0].length;const l=h.length;for(let f=0;f<l;f++)u.push(h[f]);o.push(u),h=i.exec(n)}return o},e.nameRegexp=s},31:(r,e,t)=>{const s=t(705),a={allowBooleanAttributes:!1,unpairedTags:[]};function n(p){return p===" "||p==="	"||p==="\n"||p==="\r"}function i(p,b){const I=b;for(;b<p.length;b++)if(!(p[b]!="?"&&p[b]!=" ")){const P=p.substr(I,b-I);if(b>5&&P==="xml")return w("InvalidXml","XML declaration allowed only at the start of the document.",y(p,b));if(p[b]=="?"&&p[b+1]==">"){b++;break}}return b}function o(p,b){if(p.length>b+5&&p[b+1]==="-"&&p[b+2]==="-"){for(b+=3;b<p.length;b++)if(p[b]==="-"&&p[b+1]==="-"&&p[b+2]===">"){b+=2;break}}else if(p.length>b+8&&p[b+1]==="D"&&p[b+2]==="O"&&p[b+3]==="C"&&p[b+4]==="T"&&p[b+5]==="Y"&&p[b+6]==="P"&&p[b+7]==="E"){let I=1;for(b+=8;b<p.length;b++)if(p[b]==="<")I++;else if(p[b]===">"&&(I--,I===0))break}else if(p.length>b+9&&p[b+1]==="["&&p[b+2]==="C"&&p[b+3]==="D"&&p[b+4]==="A"&&p[b+5]==="T"&&p[b+6]==="A"&&p[b+7]==="["){for(b+=8;b<p.length;b++)if(p[b]==="]"&&p[b+1]==="]"&&p[b+2]===">"){b+=2;break}}return b}e.validate=function(p,b){b=Object.assign({},a,b);const I=[];let P=!1,x=!1;p[0]==="\uFEFF"&&(p=p.substr(1));for(let B=0;B<p.length;B++)if(p[B]==="<"&&p[B+1]==="?"){if(B+=2,B=i(p,B),B.err)return B}else{if(p[B]!=="<"){if(n(p[B]))continue;return w("InvalidChar","char '"+p[B]+"' is not expected.",y(p,B))}{let V=B;if(B++,p[B]==="!"){B=o(p,B);continue}{let J=!1;p[B]==="/"&&(J=!0,B++);let F="";for(;B<p.length&&p[B]!==">"&&p[B]!==" "&&p[B]!=="	"&&p[B]!=="\n"&&p[B]!=="\r";B++)F+=p[B];if(F=F.trim(),F[F.length-1]==="/"&&(F=F.substring(0,F.length-1),B--),T=F,!s.isName(T)){let te;return te=F.trim().length===0?"Invalid space after '<'.":"Tag '"+F+"' is an invalid name.",w("InvalidTag",te,y(p,B))}const D=l(p,B);if(D===!1)return w("InvalidAttr","Attributes for '"+F+"' have open quote.",y(p,B));let j=D.value;if(B=D.index,j[j.length-1]==="/"){const te=B-j.length;j=j.substring(0,j.length-1);const Y=m(j,b);if(Y!==!0)return w(Y.err.code,Y.err.msg,y(p,te+Y.err.line));P=!0}else if(J){if(!D.tagClosed)return w("InvalidTag","Closing tag '"+F+"' doesn't have proper closing.",y(p,B));if(j.trim().length>0)return w("InvalidTag","Closing tag '"+F+"' can't have attributes or invalid starting.",y(p,V));if(I.length===0)return w("InvalidTag","Closing tag '"+F+"' has not been opened.",y(p,V));{const te=I.pop();if(F!==te.tagName){let Y=y(p,te.tagStartPos);return w("InvalidTag","Expected closing tag '"+te.tagName+"' (opened in line "+Y.line+", col "+Y.col+") instead of closing tag '"+F+"'.",y(p,V))}I.length==0&&(x=!0)}}else{const te=m(j,b);if(te!==!0)return w(te.err.code,te.err.msg,y(p,B-j.length+te.err.line));if(x===!0)return w("InvalidXml","Multiple possible root nodes found.",y(p,B));b.unpairedTags.indexOf(F)!==-1||I.push({tagName:F,tagStartPos:V}),P=!0}for(B++;B<p.length;B++)if(p[B]==="<"){if(p[B+1]==="!"){B++,B=o(p,B);continue}if(p[B+1]!=="?")break;if(B=i(p,++B),B.err)return B}else if(p[B]==="&"){const te=v(p,B);if(te==-1)return w("InvalidChar","char '&' is not expected.",y(p,B));B=te}else if(x===!0&&!n(p[B]))return w("InvalidXml","Extra text at the end",y(p,B));p[B]==="<"&&B--}}}var T;return P?I.length==1?w("InvalidTag","Unclosed tag '"+I[0].tagName+"'.",y(p,I[0].tagStartPos)):!(I.length>0)||w("InvalidXml","Invalid '"+JSON.stringify(I.map(B=>B.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):w("InvalidXml","Start tag expected.",1)};const h='"',u="'";function l(p,b){let I="",P="",x=!1;for(;b<p.length;b++){if(p[b]===h||p[b]===u)P===""?P=p[b]:P!==p[b]||(P="");else if(p[b]===">"&&P===""){x=!0;break}I+=p[b]}return P===""&&{value:I,index:b,tagClosed:x}}const f=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function m(p,b){const I=s.getAllMatches(p,f),P={};for(let x=0;x<I.length;x++){if(I[x][1].length===0)return w("InvalidAttr","Attribute '"+I[x][2]+"' has no space in starting.",k(I[x]));if(I[x][3]!==void 0&&I[x][4]===void 0)return w("InvalidAttr","Attribute '"+I[x][2]+"' is without value.",k(I[x]));if(I[x][3]===void 0&&!b.allowBooleanAttributes)return w("InvalidAttr","boolean attribute '"+I[x][2]+"' is not allowed.",k(I[x]));const T=I[x][2];if(!S(T))return w("InvalidAttr","Attribute '"+T+"' is an invalid name.",k(I[x]));if(P.hasOwnProperty(T))return w("InvalidAttr","Attribute '"+T+"' is repeated.",k(I[x]));P[T]=1}return!0}function v(p,b){if(p[++b]===";")return-1;if(p[b]==="#")return function(P,x){let T=/\d/;for(P[x]==="x"&&(x++,T=/[\da-fA-F]/);x<P.length;x++){if(P[x]===";")return x;if(!P[x].match(T))break}return-1}(p,++b);let I=0;for(;b<p.length;b++,I++)if(!(p[b].match(/\w/)&&I<20)){if(p[b]===";")break;return-1}return b}function w(p,b,I){return{err:{code:p,msg:b,line:I.line||I,col:I.col}}}function S(p){return s.isName(p)}function y(p,b){const I=p.substring(0,b).split(/\r?\n/);return{line:I.length,col:I[I.length-1].length+1}}function k(p){return p.startIndex+p[1].length}},221:(r,e,t)=>{const s=t(87),a=t(118),n={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(l,f){return f},attributeValueProcessor:function(l,f){return f},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function i(l){this.options=Object.assign({},n,l),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=a(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=u),this.processTextOrObjNode=o,this.options.format?(this.indentate=h,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function o(l,f,m,v){const w=this.j2x(l,m+1,v.concat(f));return l[this.options.textNodeName]!==void 0&&Object.keys(l).length===1?this.buildTextValNode(l[this.options.textNodeName],f,w.attrStr,m):this.buildObjectNode(w.val,f,w.attrStr,m)}function h(l){return this.options.indentBy.repeat(l)}function u(l){return!(!l.startsWith(this.options.attributeNamePrefix)||l===this.options.textNodeName)&&l.substr(this.attrPrefixLen)}i.prototype.build=function(l){return this.options.preserveOrder?s(l,this.options):(Array.isArray(l)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(l={[this.options.arrayNodeName]:l}),this.j2x(l,0,[]).val)},i.prototype.j2x=function(l,f,m){let v="",w="";const S=m.join(".");for(let y in l)if(Object.prototype.hasOwnProperty.call(l,y))if(l[y]===void 0)this.isAttribute(y)&&(w+="");else if(l[y]===null)this.isAttribute(y)?w+="":y[0]==="?"?w+=this.indentate(f)+"<"+y+"?"+this.tagEndChar:w+=this.indentate(f)+"<"+y+"/"+this.tagEndChar;else if(l[y]instanceof Date)w+=this.buildTextValNode(l[y],y,"",f);else if(typeof l[y]!="object"){const k=this.isAttribute(y);if(k&&!this.ignoreAttributesFn(k,S))v+=this.buildAttrPairStr(k,""+l[y]);else if(!k)if(y===this.options.textNodeName){let p=this.options.tagValueProcessor(y,""+l[y]);w+=this.replaceEntitiesValue(p)}else w+=this.buildTextValNode(l[y],y,"",f)}else if(Array.isArray(l[y])){const k=l[y].length;let p="",b="";for(let I=0;I<k;I++){const P=l[y][I];if(P!==void 0)if(P===null)y[0]==="?"?w+=this.indentate(f)+"<"+y+"?"+this.tagEndChar:w+=this.indentate(f)+"<"+y+"/"+this.tagEndChar;else if(typeof P=="object")if(this.options.oneListGroup){const x=this.j2x(P,f+1,m.concat(y));p+=x.val,this.options.attributesGroupName&&P.hasOwnProperty(this.options.attributesGroupName)&&(b+=x.attrStr)}else p+=this.processTextOrObjNode(P,y,f,m);else if(this.options.oneListGroup){let x=this.options.tagValueProcessor(y,P);x=this.replaceEntitiesValue(x),p+=x}else p+=this.buildTextValNode(P,y,"",f)}this.options.oneListGroup&&(p=this.buildObjectNode(p,y,b,f)),w+=p}else if(this.options.attributesGroupName&&y===this.options.attributesGroupName){const k=Object.keys(l[y]),p=k.length;for(let b=0;b<p;b++)v+=this.buildAttrPairStr(k[b],""+l[y][k[b]])}else w+=this.processTextOrObjNode(l[y],y,f,m);return{attrStr:v,val:w}},i.prototype.buildAttrPairStr=function(l,f){return f=this.options.attributeValueProcessor(l,""+f),f=this.replaceEntitiesValue(f),this.options.suppressBooleanAttributes&&f==="true"?" "+l:" "+l+'="'+f+'"'},i.prototype.buildObjectNode=function(l,f,m,v){if(l==="")return f[0]==="?"?this.indentate(v)+"<"+f+m+"?"+this.tagEndChar:this.indentate(v)+"<"+f+m+this.closeTag(f)+this.tagEndChar;{let w="</"+f+this.tagEndChar,S="";return f[0]==="?"&&(S="?",w=""),!m&&m!==""||l.indexOf("<")!==-1?this.options.commentPropName!==!1&&f===this.options.commentPropName&&S.length===0?this.indentate(v)+"<!--".concat(l,"-->")+this.newLine:this.indentate(v)+"<"+f+m+S+this.tagEndChar+l+this.indentate(v)+w:this.indentate(v)+"<"+f+m+S+">"+l+w}},i.prototype.closeTag=function(l){let f="";return this.options.unpairedTags.indexOf(l)!==-1?this.options.suppressUnpairedNode||(f="/"):f=this.options.suppressEmptyNode?"/":"></".concat(l),f},i.prototype.buildTextValNode=function(l,f,m,v){if(this.options.cdataPropName!==!1&&f===this.options.cdataPropName)return this.indentate(v)+"<![CDATA[".concat(l,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&f===this.options.commentPropName)return this.indentate(v)+"<!--".concat(l,"-->")+this.newLine;if(f[0]==="?")return this.indentate(v)+"<"+f+m+"?"+this.tagEndChar;{let w=this.options.tagValueProcessor(f,l);return w=this.replaceEntitiesValue(w),w===""?this.indentate(v)+"<"+f+m+this.closeTag(f)+this.tagEndChar:this.indentate(v)+"<"+f+m+">"+w+"</"+f+this.tagEndChar}},i.prototype.replaceEntitiesValue=function(l){if(l&&l.length>0&&this.options.processEntities)for(let f=0;f<this.options.entities.length;f++){const m=this.options.entities[f];l=l.replace(m.regex,m.val)}return l},r.exports=i},87:r=>{function e(i,o,h,u){let l="",f=!1;for(let m=0;m<i.length;m++){const v=i[m],w=t(v);if(w===void 0)continue;let S="";if(S=h.length===0?w:"".concat(h,".").concat(w),w===o.textNodeName){let b=v[w];a(S,o)||(b=o.tagValueProcessor(w,b),b=n(b,o)),f&&(l+=u),l+=b,f=!1;continue}if(w===o.cdataPropName){f&&(l+=u),l+="<![CDATA[".concat(v[w][0][o.textNodeName],"]]>"),f=!1;continue}if(w===o.commentPropName){l+=u+"<!--".concat(v[w][0][o.textNodeName],"-->"),f=!0;continue}if(w[0]==="?"){const b=s(v[":@"],o),I=w==="?xml"?"":u;let P=v[w][0][o.textNodeName];P=P.length!==0?" "+P:"",l+=I+"<".concat(w).concat(P).concat(b,"?>"),f=!0;continue}let y=u;y!==""&&(y+=o.indentBy);const k=u+"<".concat(w).concat(s(v[":@"],o)),p=e(v[w],o,S,y);o.unpairedTags.indexOf(w)!==-1?o.suppressUnpairedNode?l+=k+">":l+=k+"/>":p&&p.length!==0||!o.suppressEmptyNode?p&&p.endsWith(">")?l+=k+">".concat(p).concat(u,"</").concat(w,">"):(l+=k+">",p&&u!==""&&(p.includes("/>")||p.includes("</"))?l+=u+o.indentBy+p+u:l+=p,l+="</".concat(w,">")):l+=k+"/>",f=!0}return l}function t(i){const o=Object.keys(i);for(let h=0;h<o.length;h++){const u=o[h];if(i.hasOwnProperty(u)&&u!==":@")return u}}function s(i,o){let h="";if(i&&!o.ignoreAttributes)for(let u in i){if(!i.hasOwnProperty(u))continue;let l=o.attributeValueProcessor(u,i[u]);l=n(l,o),l===!0&&o.suppressBooleanAttributes?h+=" ".concat(u.substr(o.attributeNamePrefix.length)):h+=" ".concat(u.substr(o.attributeNamePrefix.length),'="').concat(l,'"')}return h}function a(i,o){let h=(i=i.substr(0,i.length-o.textNodeName.length-1)).substr(i.lastIndexOf(".")+1);for(let u in o.stopNodes)if(o.stopNodes[u]===i||o.stopNodes[u]==="*."+h)return!0;return!1}function n(i,o){if(i&&i.length>0&&o.processEntities)for(let h=0;h<o.entities.length;h++){const u=o.entities[h];i=i.replace(u.regex,u.val)}return i}r.exports=function(i,o){let h="";return o.format&&o.indentBy.length>0&&(h="\n"),e(i,o,"",h)}},193:(r,e,t)=>{const s=t(705);function a(f,m){let v="";for(;m<f.length&&f[m]!=="'"&&f[m]!=='"';m++)v+=f[m];if(v=v.trim(),v.indexOf(" ")!==-1)throw new Error("External entites are not supported");const w=f[m++];let S="";for(;m<f.length&&f[m]!==w;m++)S+=f[m];return[v,S,m]}function n(f,m){return f[m+1]==="!"&&f[m+2]==="-"&&f[m+3]==="-"}function i(f,m){return f[m+1]==="!"&&f[m+2]==="E"&&f[m+3]==="N"&&f[m+4]==="T"&&f[m+5]==="I"&&f[m+6]==="T"&&f[m+7]==="Y"}function o(f,m){return f[m+1]==="!"&&f[m+2]==="E"&&f[m+3]==="L"&&f[m+4]==="E"&&f[m+5]==="M"&&f[m+6]==="E"&&f[m+7]==="N"&&f[m+8]==="T"}function h(f,m){return f[m+1]==="!"&&f[m+2]==="A"&&f[m+3]==="T"&&f[m+4]==="T"&&f[m+5]==="L"&&f[m+6]==="I"&&f[m+7]==="S"&&f[m+8]==="T"}function u(f,m){return f[m+1]==="!"&&f[m+2]==="N"&&f[m+3]==="O"&&f[m+4]==="T"&&f[m+5]==="A"&&f[m+6]==="T"&&f[m+7]==="I"&&f[m+8]==="O"&&f[m+9]==="N"}function l(f){if(s.isName(f))return f;throw new Error("Invalid entity name ".concat(f))}r.exports=function(f,m){const v={};if(f[m+3]!=="O"||f[m+4]!=="C"||f[m+5]!=="T"||f[m+6]!=="Y"||f[m+7]!=="P"||f[m+8]!=="E")throw new Error("Invalid Tag instead of DOCTYPE");{m+=9;let w=1,S=!1,y=!1,k="";for(;m<f.length;m++)if(f[m]!=="<"||y)if(f[m]===">"){if(y?f[m-1]==="-"&&f[m-2]==="-"&&(y=!1,w--):w--,w===0)break}else f[m]==="["?S=!0:k+=f[m];else{if(S&&i(f,m)){let p,b;m+=7,[p,b,m]=a(f,m+1),b.indexOf("&")===-1&&(v[l(p)]={regx:RegExp("&".concat(p,";"),"g"),val:b})}else if(S&&o(f,m))m+=8;else if(S&&h(f,m))m+=8;else if(S&&u(f,m))m+=9;else{if(!n)throw new Error("Invalid DOCTYPE");y=!0}w++,k=""}if(w!==0)throw new Error("Unclosed DOCTYPE")}return{entities:v,i:m}}},63:(r,e)=>{const t={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,a){return a},attributeValueProcessor:function(s,a){return a},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,a,n){return s}};e.buildOptions=function(s){return Object.assign({},t,s)},e.defaultOptions=t},299:(r,e,t)=>{const s=t(705),a=t(365),n=t(193),i=t(494),o=t(118);function h(x){const T=Object.keys(x);for(let B=0;B<T.length;B++){const V=T[B];this.lastEntities[V]={regex:new RegExp("&"+V+";","g"),val:x[V]}}}function u(x,T,B,V,J,F,D){if(x!==void 0&&(this.options.trimValues&&!V&&(x=x.trim()),x.length>0)){D||(x=this.replaceEntitiesValue(x));const j=this.options.tagValueProcessor(T,x,B,J,F);return j==null?x:typeof j!=typeof x||j!==x?j:this.options.trimValues||x.trim()===x?P(x,this.options.parseTagValue,this.options.numberParseOptions):x}}function l(x){if(this.options.removeNSPrefix){const T=x.split(":"),B=x.charAt(0)==="/"?"/":"";if(T[0]==="xmlns")return"";T.length===2&&(x=B+T[1])}return x}const f=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function m(x,T,B){if(this.options.ignoreAttributes!==!0&&typeof x=="string"){const V=s.getAllMatches(x,f),J=V.length,F={};for(let D=0;D<J;D++){const j=this.resolveNameSpace(V[D][1]);if(this.ignoreAttributesFn(j,T))continue;let te=V[D][4],Y=this.options.attributeNamePrefix+j;if(j.length)if(this.options.transformAttributeName&&(Y=this.options.transformAttributeName(Y)),Y==="__proto__"&&(Y="#__proto__"),te!==void 0){this.options.trimValues&&(te=te.trim()),te=this.replaceEntitiesValue(te);const oe=this.options.attributeValueProcessor(j,te,T);F[Y]=oe==null?te:typeof oe!=typeof te||oe!==te?oe:P(te,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(F[Y]=!0)}if(!Object.keys(F).length)return;if(this.options.attributesGroupName){const D={};return D[this.options.attributesGroupName]=F,D}return F}}const v=function(x){x=x.replace(/\r\n?/g,"\n");const T=new a("!xml");let B=T,V="",J="";for(let F=0;F<x.length;F++)if(x[F]==="<")if(x[F+1]==="/"){const D=p(x,">",F,"Closing Tag is not closed.");let j=x.substring(F+2,D).trim();if(this.options.removeNSPrefix){const oe=j.indexOf(":");oe!==-1&&(j=j.substr(oe+1))}this.options.transformTagName&&(j=this.options.transformTagName(j)),B&&(V=this.saveTextToParentTag(V,B,J));const te=J.substring(J.lastIndexOf(".")+1);if(j&&this.options.unpairedTags.indexOf(j)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(j,">"));let Y=0;te&&this.options.unpairedTags.indexOf(te)!==-1?(Y=J.lastIndexOf(".",J.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Y=J.lastIndexOf("."),J=J.substring(0,Y),B=this.tagsNodeStack.pop(),V="",F=D}else if(x[F+1]==="?"){let D=b(x,F,!1,"?>");if(!D)throw new Error("Pi Tag is not closed.");if(V=this.saveTextToParentTag(V,B,J),!(this.options.ignoreDeclaration&&D.tagName==="?xml"||this.options.ignorePiTags)){const j=new a(D.tagName);j.add(this.options.textNodeName,""),D.tagName!==D.tagExp&&D.attrExpPresent&&(j[":@"]=this.buildAttributesMap(D.tagExp,J,D.tagName)),this.addChild(B,j,J)}F=D.closeIndex+1}else if(x.substr(F+1,3)==="!--"){const D=p(x,"-->",F+4,"Comment is not closed.");if(this.options.commentPropName){const j=x.substring(F+4,D-2);V=this.saveTextToParentTag(V,B,J),B.add(this.options.commentPropName,[{[this.options.textNodeName]:j}])}F=D}else if(x.substr(F+1,2)==="!D"){const D=n(x,F);this.docTypeEntities=D.entities,F=D.i}else if(x.substr(F+1,2)==="!["){const D=p(x,"]]>",F,"CDATA is not closed.")-2,j=x.substring(F+9,D);V=this.saveTextToParentTag(V,B,J);let te=this.parseTextData(j,B.tagname,J,!0,!1,!0,!0);te==null&&(te=""),this.options.cdataPropName?B.add(this.options.cdataPropName,[{[this.options.textNodeName]:j}]):B.add(this.options.textNodeName,te),F=D+2}else{let D=b(x,F,this.options.removeNSPrefix),j=D.tagName;const te=D.rawTagName;let Y=D.tagExp,oe=D.attrExpPresent,ne=D.closeIndex;this.options.transformTagName&&(j=this.options.transformTagName(j)),B&&V&&B.tagname!=="!xml"&&(V=this.saveTextToParentTag(V,B,J,!1));const de=B;if(de&&this.options.unpairedTags.indexOf(de.tagname)!==-1&&(B=this.tagsNodeStack.pop(),J=J.substring(0,J.lastIndexOf("."))),j!==T.tagname&&(J+=J?"."+j:j),this.isItStopNode(this.options.stopNodes,J,j)){let ie="";if(Y.length>0&&Y.lastIndexOf("/")===Y.length-1)j[j.length-1]==="/"?(j=j.substr(0,j.length-1),J=J.substr(0,J.length-1),Y=j):Y=Y.substr(0,Y.length-1),F=D.closeIndex;else if(this.options.unpairedTags.indexOf(j)!==-1)F=D.closeIndex;else{const se=this.readStopNodeData(x,te,ne+1);if(!se)throw new Error("Unexpected end of ".concat(te));F=se.i,ie=se.tagContent}const re=new a(j);j!==Y&&oe&&(re[":@"]=this.buildAttributesMap(Y,J,j)),ie&&(ie=this.parseTextData(ie,j,J,!0,oe,!0,!0)),J=J.substr(0,J.lastIndexOf(".")),re.add(this.options.textNodeName,ie),this.addChild(B,re,J)}else{if(Y.length>0&&Y.lastIndexOf("/")===Y.length-1){j[j.length-1]==="/"?(j=j.substr(0,j.length-1),J=J.substr(0,J.length-1),Y=j):Y=Y.substr(0,Y.length-1),this.options.transformTagName&&(j=this.options.transformTagName(j));const ie=new a(j);j!==Y&&oe&&(ie[":@"]=this.buildAttributesMap(Y,J,j)),this.addChild(B,ie,J),J=J.substr(0,J.lastIndexOf("."))}else{const ie=new a(j);this.tagsNodeStack.push(B),j!==Y&&oe&&(ie[":@"]=this.buildAttributesMap(Y,J,j)),this.addChild(B,ie,J),B=ie}V="",F=ne}}else V+=x[F];return T.child};function w(x,T,B){const V=this.options.updateTag(T.tagname,B,T[":@"]);V===!1||(typeof V=="string"&&(T.tagname=V),x.addChild(T))}const S=function(x){if(this.options.processEntities){for(let T in this.docTypeEntities){const B=this.docTypeEntities[T];x=x.replace(B.regx,B.val)}for(let T in this.lastEntities){const B=this.lastEntities[T];x=x.replace(B.regex,B.val)}if(this.options.htmlEntities)for(let T in this.htmlEntities){const B=this.htmlEntities[T];x=x.replace(B.regex,B.val)}x=x.replace(this.ampEntity.regex,this.ampEntity.val)}return x};function y(x,T,B,V){return x&&(V===void 0&&(V=Object.keys(T.child).length===0),(x=this.parseTextData(x,T.tagname,B,!1,!!T[":@"]&&Object.keys(T[":@"]).length!==0,V))!==void 0&&x!==""&&T.add(this.options.textNodeName,x),x=""),x}function k(x,T,B){const V="*."+B;for(const J in x){const F=x[J];if(V===F||T===F)return!0}return!1}function p(x,T,B,V){const J=x.indexOf(T,B);if(J===-1)throw new Error(V);return J+T.length-1}function b(x,T,B){const V=function(oe,ne){let de,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",re="";for(let se=ne;se<oe.length;se++){let ee=oe[se];if(de)ee===de&&(de="");else if(ee==='"'||ee==="'")de=ee;else if(ee===ie[0]){if(!ie[1])return{data:re,index:se};if(oe[se+1]===ie[1])return{data:re,index:se}}else ee==="	"&&(ee=" ");re+=ee}}(x,T+1,arguments.length>3&&arguments[3]!==void 0?arguments[3]:">");if(!V)return;let J=V.data;const F=V.index,D=J.search(/\s/);let j=J,te=!0;D!==-1&&(j=J.substring(0,D),J=J.substring(D+1).trimStart());const Y=j;if(B){const oe=j.indexOf(":");oe!==-1&&(j=j.substr(oe+1),te=j!==V.data.substr(oe+1))}return{tagName:j,tagExp:J,closeIndex:F,attrExpPresent:te,rawTagName:Y}}function I(x,T,B){const V=B;let J=1;for(;B<x.length;B++)if(x[B]==="<")if(x[B+1]==="/"){const F=p(x,">",B,"".concat(T," is not closed"));if(x.substring(B+2,F).trim()===T&&(J--,J===0))return{tagContent:x.substring(V,B),i:F};B=F}else if(x[B+1]==="?")B=p(x,"?>",B+1,"StopNode is not closed.");else if(x.substr(B+1,3)==="!--")B=p(x,"-->",B+3,"StopNode is not closed.");else if(x.substr(B+1,2)==="![")B=p(x,"]]>",B,"StopNode is not closed.")-2;else{const F=b(x,B,">");F&&((F&&F.tagName)===T&&F.tagExp[F.tagExp.length-1]!=="/"&&J++,B=F.closeIndex)}}function P(x,T,B){if(T&&typeof x=="string"){const V=x.trim();return V==="true"||V!=="false"&&i(x,B)}return s.isExist(x)?x:""}r.exports=class{constructor(x){this.options=x,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(T,B)=>String.fromCharCode(Number.parseInt(B,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(T,B)=>String.fromCharCode(Number.parseInt(B,16))}},this.addExternalEntities=h,this.parseXml=v,this.parseTextData=u,this.resolveNameSpace=l,this.buildAttributesMap=m,this.isItStopNode=k,this.replaceEntitiesValue=S,this.readStopNodeData=I,this.saveTextToParentTag=y,this.addChild=w,this.ignoreAttributesFn=o(this.options.ignoreAttributes)}}},338:(r,e,t)=>{const{buildOptions:s}=t(63),a=t(299),{prettify:n}=t(728),i=t(31);r.exports=class{constructor(o){this.externalEntities={},this.options=s(o)}parse(o,h){if(typeof o!="string"){if(!o.toString)throw new Error("XML data is accepted in String or Bytes[] form.");o=o.toString()}if(h){h===!0&&(h={});const f=i.validate(o,h);if(f!==!0)throw Error("".concat(f.err.msg,":").concat(f.err.line,":").concat(f.err.col))}const u=new a(this.options);u.addExternalEntities(this.externalEntities);const l=u.parseXml(o);return this.options.preserveOrder||l===void 0?l:n(l,this.options)}addEntity(o,h){if(h.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(o.indexOf("&")!==-1||o.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(h==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[o]=h}}},728:(r,e)=>{function t(i,o,h){let u;const l={};for(let f=0;f<i.length;f++){const m=i[f],v=s(m);let w="";if(w=h===void 0?v:h+"."+v,v===o.textNodeName)u===void 0?u=m[v]:u+=""+m[v];else{if(v===void 0)continue;if(m[v]){let S=t(m[v],o,w);const y=n(S,o);m[":@"]?a(S,m[":@"],w,o):Object.keys(S).length!==1||S[o.textNodeName]===void 0||o.alwaysCreateTextNode?Object.keys(S).length===0&&(o.alwaysCreateTextNode?S[o.textNodeName]="":S=""):S=S[o.textNodeName],l[v]!==void 0&&l.hasOwnProperty(v)?(Array.isArray(l[v])||(l[v]=[l[v]]),l[v].push(S)):o.isArray(v,w,y)?l[v]=[S]:l[v]=S}}}return typeof u=="string"?u.length>0&&(l[o.textNodeName]=u):u!==void 0&&(l[o.textNodeName]=u),l}function s(i){const o=Object.keys(i);for(let h=0;h<o.length;h++){const u=o[h];if(u!==":@")return u}}function a(i,o,h,u){if(o){const l=Object.keys(o),f=l.length;for(let m=0;m<f;m++){const v=l[m];u.isArray(v,h+"."+v,!0,!0)?i[v]=[o[v]]:i[v]=o[v]}}}function n(i,o){const{textNodeName:h}=o,u=Object.keys(i).length;return u===0||!(u!==1||!i[h]&&typeof i[h]!="boolean"&&i[h]!==0)}e.prettify=function(i,o){return t(i,o)}},365:r=>{r.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},135:r=>{function e(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}r.exports=function(t){return t!=null&&(e(t)||function(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&e(s.slice(0,0))}(t)||!!t._isBuffer)}},542:(r,e,t)=>{(function(){var s=t(298),a=t(526).utf8,n=t(135),i=t(526).bin,o=function(h,u){h.constructor==String?h=u&&u.encoding==="binary"?i.stringToBytes(h):a.stringToBytes(h):n(h)?h=Array.prototype.slice.call(h,0):Array.isArray(h)||h.constructor===Uint8Array||(h=h.toString());for(var l=s.bytesToWords(h),f=8*h.length,m=1732584193,v=-271733879,w=-1732584194,S=271733878,y=0;y<l.length;y++)l[y]=16711935&(l[y]<<8|l[y]>>>24)|4278255360&(l[y]<<24|l[y]>>>8);l[f>>>5]|=128<<f%32,l[14+(f+64>>>9<<4)]=f;var k=o._ff,p=o._gg,b=o._hh,I=o._ii;for(y=0;y<l.length;y+=16){var P=m,x=v,T=w,B=S;m=k(m,v,w,S,l[y+0],7,-680876936),S=k(S,m,v,w,l[y+1],12,-389564586),w=k(w,S,m,v,l[y+2],17,606105819),v=k(v,w,S,m,l[y+3],22,-1044525330),m=k(m,v,w,S,l[y+4],7,-176418897),S=k(S,m,v,w,l[y+5],12,1200080426),w=k(w,S,m,v,l[y+6],17,-1473231341),v=k(v,w,S,m,l[y+7],22,-45705983),m=k(m,v,w,S,l[y+8],7,1770035416),S=k(S,m,v,w,l[y+9],12,-1958414417),w=k(w,S,m,v,l[y+10],17,-42063),v=k(v,w,S,m,l[y+11],22,-1990404162),m=k(m,v,w,S,l[y+12],7,1804603682),S=k(S,m,v,w,l[y+13],12,-40341101),w=k(w,S,m,v,l[y+14],17,-1502002290),m=p(m,v=k(v,w,S,m,l[y+15],22,1236535329),w,S,l[y+1],5,-165796510),S=p(S,m,v,w,l[y+6],9,-1069501632),w=p(w,S,m,v,l[y+11],14,643717713),v=p(v,w,S,m,l[y+0],20,-373897302),m=p(m,v,w,S,l[y+5],5,-701558691),S=p(S,m,v,w,l[y+10],9,38016083),w=p(w,S,m,v,l[y+15],14,-660478335),v=p(v,w,S,m,l[y+4],20,-405537848),m=p(m,v,w,S,l[y+9],5,568446438),S=p(S,m,v,w,l[y+14],9,-1019803690),w=p(w,S,m,v,l[y+3],14,-187363961),v=p(v,w,S,m,l[y+8],20,1163531501),m=p(m,v,w,S,l[y+13],5,-1444681467),S=p(S,m,v,w,l[y+2],9,-51403784),w=p(w,S,m,v,l[y+7],14,1735328473),m=b(m,v=p(v,w,S,m,l[y+12],20,-1926607734),w,S,l[y+5],4,-378558),S=b(S,m,v,w,l[y+8],11,-2022574463),w=b(w,S,m,v,l[y+11],16,1839030562),v=b(v,w,S,m,l[y+14],23,-35309556),m=b(m,v,w,S,l[y+1],4,-1530992060),S=b(S,m,v,w,l[y+4],11,1272893353),w=b(w,S,m,v,l[y+7],16,-155497632),v=b(v,w,S,m,l[y+10],23,-1094730640),m=b(m,v,w,S,l[y+13],4,681279174),S=b(S,m,v,w,l[y+0],11,-358537222),w=b(w,S,m,v,l[y+3],16,-722521979),v=b(v,w,S,m,l[y+6],23,76029189),m=b(m,v,w,S,l[y+9],4,-640364487),S=b(S,m,v,w,l[y+12],11,-421815835),w=b(w,S,m,v,l[y+15],16,530742520),m=I(m,v=b(v,w,S,m,l[y+2],23,-995338651),w,S,l[y+0],6,-198630844),S=I(S,m,v,w,l[y+7],10,1126891415),w=I(w,S,m,v,l[y+14],15,-1416354905),v=I(v,w,S,m,l[y+5],21,-57434055),m=I(m,v,w,S,l[y+12],6,1700485571),S=I(S,m,v,w,l[y+3],10,-1894986606),w=I(w,S,m,v,l[y+10],15,-1051523),v=I(v,w,S,m,l[y+1],21,-2054922799),m=I(m,v,w,S,l[y+8],6,1873313359),S=I(S,m,v,w,l[y+15],10,-30611744),w=I(w,S,m,v,l[y+6],15,-1560198380),v=I(v,w,S,m,l[y+13],21,1309151649),m=I(m,v,w,S,l[y+4],6,-145523070),S=I(S,m,v,w,l[y+11],10,-1120210379),w=I(w,S,m,v,l[y+2],15,718787259),v=I(v,w,S,m,l[y+9],21,-343485551),m=m+P>>>0,v=v+x>>>0,w=w+T>>>0,S=S+B>>>0}return s.endian([m,v,w,S])};o._ff=function(h,u,l,f,m,v,w){var S=h+(u&l|~u&f)+(m>>>0)+w;return(S<<v|S>>>32-v)+u},o._gg=function(h,u,l,f,m,v,w){var S=h+(u&f|l&~f)+(m>>>0)+w;return(S<<v|S>>>32-v)+u},o._hh=function(h,u,l,f,m,v,w){var S=h+(u^l^f)+(m>>>0)+w;return(S<<v|S>>>32-v)+u},o._ii=function(h,u,l,f,m,v,w){var S=h+(l^(u|~f))+(m>>>0)+w;return(S<<v|S>>>32-v)+u},o._blocksize=16,o._digestsize=16,r.exports=function(h,u){if(h==null)throw new Error("Illegal argument "+h);var l=s.wordsToBytes(o(h,u));return u&&u.asBytes?l:u&&u.asString?i.bytesToString(l):s.bytesToHex(l)}})()},285:(r,e,t)=>{var s=t(2);r.exports=function(k){return k?(k.substr(0,2)==="{}"&&(k="\\{\\}"+k.substr(2)),y(function(p){return p.split("\\\\").join(a).split("\\{").join(n).split("\\}").join(i).split("\\,").join(o).split("\\.").join(h)}(k),!0).map(l)):[]};var a="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",i="\0CLOSE"+Math.random()+"\0",o="\0COMMA"+Math.random()+"\0",h="\0PERIOD"+Math.random()+"\0";function u(k){return parseInt(k,10)==k?parseInt(k,10):k.charCodeAt(0)}function l(k){return k.split(a).join("\\").split(n).join("{").split(i).join("}").split(o).join(",").split(h).join(".")}function f(k){if(!k)return[""];var p=[],b=s("{","}",k);if(!b)return k.split(",");var I=b.pre,P=b.body,x=b.post,T=I.split(",");T[T.length-1]+="{"+P+"}";var B=f(x);return x.length&&(T[T.length-1]+=B.shift(),T.push.apply(T,B)),p.push.apply(p,T),p}function m(k){return"{"+k+"}"}function v(k){return/^-?0\d/.test(k)}function w(k,p){return k<=p}function S(k,p){return k>=p}function y(k,p){var b=[],I=s("{","}",k);if(!I)return[k];var P=I.pre,x=I.post.length?y(I.post,!1):[""];if(/\$$/.test(I.pre))for(var T=0;T<x.length;T++){var B=P+"{"+I.body+"}"+x[T];b.push(B)}else{var V,J,F=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(I.body),D=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(I.body),j=F||D,te=I.body.indexOf(",")>=0;if(!j&&!te)return I.post.match(/,.*\}/)?y(k=I.pre+"{"+I.body+i+I.post):[k];if(j)V=I.body.split(/\.\./);else if((V=f(I.body)).length===1&&(V=y(V[0],!1).map(m)).length===1)return x.map(function(Fe){return I.pre+V[0]+Fe});if(j){var Y=u(V[0]),oe=u(V[1]),ne=Math.max(V[0].length,V[1].length),de=V.length==3?Math.abs(u(V[2])):1,ie=w;oe<Y&&(de*=-1,ie=S);var re=V.some(v);J=[];for(var se=Y;ie(se,oe);se+=de){var ee;if(D)(ee=String.fromCharCode(se))==="\\"&&(ee="");else if(ee=String(se),re){var ce=ne-ee.length;if(ce>0){var pe=new Array(ce+1).join("0");ee=se<0?"-"+pe+ee.slice(1):pe+ee}}J.push(ee)}}else{J=[];for(var Ce=0;Ce<V.length;Ce++)J.push.apply(J,y(V[Ce],!1))}for(Ce=0;Ce<J.length;Ce++)for(T=0;T<x.length;T++)B=P+J[Ce]+x[T],(!p||j||B)&&b.push(B)}return b}},829:r=>{function e(u){return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},e(u)}function t(u){var l=typeof Map=="function"?new Map:void 0;return t=function(f){if(f===null||(m=f,Function.toString.call(m).indexOf("[native code]")===-1))return f;var m;if(typeof f!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(f))return l.get(f);l.set(f,v)}function v(){return s(f,arguments,n(this).constructor)}return v.prototype=Object.create(f.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),a(v,f)},t(u)}function s(u,l,f){return s=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}()?Reflect.construct:function(m,v,w){var S=[null];S.push.apply(S,v);var y=new(Function.bind.apply(m,S));return w&&a(y,w.prototype),y},s.apply(null,arguments)}function a(u,l){return a=Object.setPrototypeOf||function(f,m){return f.__proto__=m,f},a(u,l)}function n(u){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(l){return l.__proto__||Object.getPrototypeOf(l)},n(u)}var i=function(u){function l(f){var m;return function(v,w){if(!(v instanceof w))throw new TypeError("Cannot call a class as a function")}(this,l),(m=function(v,w){return!w||e(w)!=="object"&&typeof w!="function"?function(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}(v):w}(this,n(l).call(this,f))).name="ObjectPrototypeMutationError",m}return function(f,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(m&&m.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),m&&a(f,m)}(l,u),l}(t(Error));function o(u,l){for(var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},m=l.split("."),v=m.length,w=function(k){var p=m[k];if(!u)return{v:void 0};if(p==="+"){if(Array.isArray(u))return{v:u.map(function(I,P){var x=m.slice(k+1);return x.length>0?o(I,x.join("."),f):f(u,P,m,k)})};var b=m.slice(0,k).join(".");throw new Error("Object at wildcard (".concat(b,") is not an array"))}u=f(u,p,m,k)},S=0;S<v;S++){var y=w(S);if(e(y)==="object")return y.v}return u}function h(u,l){return u.length===l+1}r.exports={set:function(u,l,f){if(e(u)!="object"||u===null||l===void 0)return u;if(typeof l=="number")return u[l]=f,u[l];try{return o(u,l,function(m,v,w,S){if(m===Reflect.getPrototypeOf({}))throw new i("Attempting to mutate Object.prototype");if(!m[v]){var y=Number.isInteger(Number(w[S+1])),k=w[S+1]==="+";m[v]=y||k?[]:{}}return h(w,S)&&(m[v]=f),m[v]})}catch(m){if(m instanceof i)throw m;return u}},get:function(u,l){if(e(u)!="object"||u===null||l===void 0)return u;if(typeof l=="number")return u[l];try{return o(u,l,function(f,m){return f[m]})}catch(f){return u}},has:function(u,l){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e(u)!="object"||u===null||l===void 0)return!1;if(typeof l=="number")return l in u;try{var m=!1;return o(u,l,function(v,w,S,y){if(!h(S,y))return v&&v[w];m=f.own?v.hasOwnProperty(w):w in v}),m}catch(v){return!1}},hasOwn:function(u,l,f){return this.has(u,l,f||{own:!0})},isIn:function(u,l,f){var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(e(u)!="object"||u===null||l===void 0)return!1;try{var v=!1,w=!1;return o(u,l,function(S,y,k,p){return v=v||S===f||!!S&&S[y]===f,w=h(k,p)&&e(S)==="object"&&y in S,S&&S[y]}),m.validPath?v&&w:v}catch(S){return!1}},ObjectPrototypeMutationError:i}},47:(r,e,t)=>{var s=t(410),a=function(u){return typeof u=="string"};function n(u,l){for(var f=[],m=0;m<u.length;m++){var v=u[m];v&&v!=="."&&(v===".."?f.length&&f[f.length-1]!==".."?f.pop():l&&f.push(".."):f.push(v))}return f}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o={};function h(u){return i.exec(u).slice(1)}o.resolve=function(){for(var u="",l=!1,f=arguments.length-1;f>=-1&&!l;f--){var m=f>=0?arguments[f]:lt.cwd();if(!a(m))throw new TypeError("Arguments to path.resolve must be strings");m&&(u=m+"/"+u,l=m.charAt(0)==="/")}return(l?"/":"")+(u=n(u.split("/"),!l).join("/"))||"."},o.normalize=function(u){var l=o.isAbsolute(u),f=u.substr(-1)==="/";return(u=n(u.split("/"),!l).join("/"))||l||(u="."),u&&f&&(u+="/"),(l?"/":"")+u},o.isAbsolute=function(u){return u.charAt(0)==="/"},o.join=function(){for(var u="",l=0;l<arguments.length;l++){var f=arguments[l];if(!a(f))throw new TypeError("Arguments to path.join must be strings");f&&(u+=u?"/"+f:f)}return o.normalize(u)},o.relative=function(u,l){function f(p){for(var b=0;b<p.length&&p[b]==="";b++);for(var I=p.length-1;I>=0&&p[I]==="";I--);return b>I?[]:p.slice(b,I+1)}u=o.resolve(u).substr(1),l=o.resolve(l).substr(1);for(var m=f(u.split("/")),v=f(l.split("/")),w=Math.min(m.length,v.length),S=w,y=0;y<w;y++)if(m[y]!==v[y]){S=y;break}var k=[];for(y=S;y<m.length;y++)k.push("..");return(k=k.concat(v.slice(S))).join("/")},o._makeLong=function(u){return u},o.dirname=function(u){var l=h(u),f=l[0],m=l[1];return f||m?(m&&(m=m.substr(0,m.length-1)),f+m):"."},o.basename=function(u,l){var f=h(u)[2];return l&&f.substr(-1*l.length)===l&&(f=f.substr(0,f.length-l.length)),f},o.extname=function(u){return h(u)[3]},o.format=function(u){if(!s.isObject(u))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof u);var l=u.root||"";if(!a(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof u.root);return(u.dir?u.dir+o.sep:"")+(u.base||"")},o.parse=function(u){if(!a(u))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof u);var l=h(u);if(!l||l.length!==4)throw new TypeError("Invalid path '"+u+"'");return l[1]=l[1]||"",l[2]=l[2]||"",l[3]=l[3]||"",{root:l[0],dir:l[0]+l[1].slice(0,l[1].length-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},o.sep="/",o.delimiter=":",r.exports=o},647:(r,e)=>{var t=Object.prototype.hasOwnProperty;function s(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch(i){return null}}function a(n){try{return encodeURIComponent(n)}catch(i){return null}}e.stringify=function(n,i){i=i||"";var o,h,u=[];for(h in typeof i!="string"&&(i="?"),n)if(t.call(n,h)){if((o=n[h])||o!=null&&!isNaN(o)||(o=""),h=a(h),o=a(o),h===null||o===null)continue;u.push(h+"="+o)}return u.length?i+u.join("&"):""},e.parse=function(n){for(var i,o=/([^=?#&]+)=?([^&]*)/g,h={};i=o.exec(n);){var u=s(i[1]),l=s(i[2]);u===null||l===null||u in h||(h[u]=l)}return h}},670:r=>{r.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}},494:r=>{const e=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const s={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};r.exports=function(a){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n=Object.assign({},s,n),!a||typeof a!="string")return a;let i=a.trim();if(n.skipLike!==void 0&&n.skipLike.test(i))return a;if(n.hex&&e.test(i))return Number.parseInt(i,16);{const h=t.exec(i);if(h){const u=h[1],l=h[2];let f=((o=h[3])&&o.indexOf(".")!==-1&&((o=o.replace(/0+$/,""))==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substr(0,o.length-1))),o);const m=h[4]||h[6];if(!n.leadingZeros&&l.length>0&&u&&i[2]!=="."||!n.leadingZeros&&l.length>0&&!u&&i[1]!==".")return a;{const v=Number(i),w=""+v;return w.search(/[eE]/)!==-1||m?n.eNotation?v:a:i.indexOf(".")!==-1?w==="0"&&f===""||w===f||u&&w==="-"+f?v:a:l?f===w||u+f===w?v:a:i===w||i===u+w?v:a}}return a}var o}},737:(r,e,t)=>{var s=t(670),a=t(647),n=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,i=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,h=/:\d+$/,u=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,l=/^[a-zA-Z]:/;function f(p){return(p||"").toString().replace(n,"")}var m=[["#","hash"],["?","query"],function(p,b){return S(b.protocol)?p.replace(/\\/g,"/"):p},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],v={hash:1,query:1};function w(p){var b,I=(typeof window<"u"?window:typeof Wt<"u"?Wt:typeof self<"u"?self:{}).location||{},P={},x=typeof(p=p||I);if(p.protocol==="blob:")P=new k(unescape(p.pathname),{});else if(x==="string")for(b in P=new k(p,{}),v)delete P[b];else if(x==="object"){for(b in p)b in v||(P[b]=p[b]);P.slashes===void 0&&(P.slashes=o.test(p.href))}return P}function S(p){return p==="file:"||p==="ftp:"||p==="http:"||p==="https:"||p==="ws:"||p==="wss:"}function y(p,b){p=(p=f(p)).replace(i,""),b=b||{};var I,P=u.exec(p),x=P[1]?P[1].toLowerCase():"",T=!!P[2],B=!!P[3],V=0;return T?B?(I=P[2]+P[3]+P[4],V=P[2].length+P[3].length):(I=P[2]+P[4],V=P[2].length):B?(I=P[3]+P[4],V=P[3].length):I=P[4],x==="file:"?V>=2&&(I=I.slice(2)):S(x)?I=P[4]:x?T&&(I=I.slice(2)):V>=2&&S(b.protocol)&&(I=P[4]),{protocol:x,slashes:T||S(x),slashesCount:V,rest:I}}function k(p,b,I){if(p=(p=f(p)).replace(i,""),!(this instanceof k))return new k(p,b,I);var P,x,T,B,V,J,F=m.slice(),D=typeof b,j=this,te=0;for(D!=="object"&&D!=="string"&&(I=b,b=null),I&&typeof I!="function"&&(I=a.parse),P=!(x=y(p||"",b=w(b))).protocol&&!x.slashes,j.slashes=x.slashes||P&&b.slashes,j.protocol=x.protocol||b.protocol||"",p=x.rest,(x.protocol==="file:"&&(x.slashesCount!==2||l.test(p))||!x.slashes&&(x.protocol||x.slashesCount<2||!S(j.protocol)))&&(F[3]=[/(.*)/,"pathname"]);te<F.length;te++)typeof(B=F[te])!="function"?(T=B[0],J=B[1],T!=T?j[J]=p:typeof T=="string"?~(V=T==="@"?p.lastIndexOf(T):p.indexOf(T))&&(typeof B[2]=="number"?(j[J]=p.slice(0,V),p=p.slice(V+B[2])):(j[J]=p.slice(V),p=p.slice(0,V))):(V=T.exec(p))&&(j[J]=V[1],p=p.slice(0,V.index)),j[J]=j[J]||P&&B[3]&&b[J]||"",B[4]&&(j[J]=j[J].toLowerCase())):p=B(p,j);I&&(j.query=I(j.query)),P&&b.slashes&&j.pathname.charAt(0)!=="/"&&(j.pathname!==""||b.pathname!=="")&&(j.pathname=function(Y,oe){if(Y==="")return oe;for(var ne=(oe||"/").split("/").slice(0,-1).concat(Y.split("/")),de=ne.length,ie=ne[de-1],re=!1,se=0;de--;)ne[de]==="."?ne.splice(de,1):ne[de]===".."?(ne.splice(de,1),se++):se&&(de===0&&(re=!0),ne.splice(de,1),se--);return re&&ne.unshift(""),ie!=="."&&ie!==".."||ne.push(""),ne.join("/")}(j.pathname,b.pathname)),j.pathname.charAt(0)!=="/"&&S(j.protocol)&&(j.pathname="/"+j.pathname),s(j.port,j.protocol)||(j.host=j.hostname,j.port=""),j.username=j.password="",j.auth&&(~(V=j.auth.indexOf(":"))?(j.username=j.auth.slice(0,V),j.username=encodeURIComponent(decodeURIComponent(j.username)),j.password=j.auth.slice(V+1),j.password=encodeURIComponent(decodeURIComponent(j.password))):j.username=encodeURIComponent(decodeURIComponent(j.auth)),j.auth=j.password?j.username+":"+j.password:j.username),j.origin=j.protocol!=="file:"&&S(j.protocol)&&j.host?j.protocol+"//"+j.host:"null",j.href=j.toString()}k.prototype={set:function(p,b,I){var P=this;switch(p){case"query":typeof b=="string"&&b.length&&(b=(I||a.parse)(b)),P[p]=b;break;case"port":P[p]=b,s(b,P.protocol)?b&&(P.host=P.hostname+":"+b):(P.host=P.hostname,P[p]="");break;case"hostname":P[p]=b,P.port&&(b+=":"+P.port),P.host=b;break;case"host":P[p]=b,h.test(b)?(b=b.split(":"),P.port=b.pop(),P.hostname=b.join(":")):(P.hostname=b,P.port="");break;case"protocol":P.protocol=b.toLowerCase(),P.slashes=!I;break;case"pathname":case"hash":if(b){var x=p==="pathname"?"/":"#";P[p]=b.charAt(0)!==x?x+b:b}else P[p]=b;break;case"username":case"password":P[p]=encodeURIComponent(b);break;case"auth":var T=b.indexOf(":");~T?(P.username=b.slice(0,T),P.username=encodeURIComponent(decodeURIComponent(P.username)),P.password=b.slice(T+1),P.password=encodeURIComponent(decodeURIComponent(P.password))):P.username=encodeURIComponent(decodeURIComponent(b))}for(var B=0;B<m.length;B++){var V=m[B];V[4]&&(P[V[1]]=P[V[1]].toLowerCase())}return P.auth=P.password?P.username+":"+P.password:P.username,P.origin=P.protocol!=="file:"&&S(P.protocol)&&P.host?P.protocol+"//"+P.host:"null",P.href=P.toString(),P},toString:function(p){p&&typeof p=="function"||(p=a.stringify);var b,I=this,P=I.host,x=I.protocol;x&&x.charAt(x.length-1)!==":"&&(x+=":");var T=x+(I.protocol&&I.slashes||S(I.protocol)?"//":"");return I.username?(T+=I.username,I.password&&(T+=":"+I.password),T+="@"):I.password?(T+=":"+I.password,T+="@"):I.protocol!=="file:"&&S(I.protocol)&&!P&&I.pathname!=="/"&&(T+="@"),(P[P.length-1]===":"||h.test(I.hostname)&&!I.port)&&(P+=":"),T+=P+I.pathname,(b=typeof I.query=="object"?p(I.query):I.query)&&(T+=b.charAt(0)!=="?"?"?"+b:b),I.hash&&(T+=I.hash),T}},k.extractProtocol=y,k.location=w,k.trimLeft=f,k.qs=a,r.exports=k},410:()=>{},388:()=>{},805:()=>{},345:()=>{},800:()=>{}},ld={};function Ve(r){var e=ld[r];if(e!==void 0)return e.exports;var t=ld[r]={id:r,loaded:!1,exports:{}};return Dy[r].call(t.exports,t,t.exports,Ve),t.loaded=!0,t.exports}Ve.n=r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return Ve.d(e,{a:e}),e},Ve.d=(r,e)=>{for(var t in e)Ve.o(e,t)&&!Ve.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},Ve.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),Ve.nmd=r=>(r.paths=[],r.children||(r.children=[]),r);var fs={};Ve.d(fs,{hT:()=>Lt,O4:()=>cr,Kd:()=>Hy,YK:()=>Fy,UU:()=>z0,Gu:()=>Kg,ky:()=>Yg,h4:()=>xc,ch:()=>gm,hq:()=>Qn,i5:()=>Qg});var Ty=Ve(737),Ry=Ve.n(Ty);function xm(r){if(!Lf(r))throw new Error("Parameter was not an error")}function Lf(r){return!!r&&typeof r=="object"&&(e=r,Object.prototype.toString.call(e)==="[object Error]")||r instanceof Error;var e}class Kt extends Error{constructor(e,t){const s=[...arguments],{options:a,shortMessage:n}=function(o){let h,u="";if(o.length===0)h={};else if(Lf(o[0]))h={cause:o[0]},u=o.slice(1).join(" ")||"";else if(o[0]&&typeof o[0]=="object")h=Object.assign({},o[0]),u=o.slice(1).join(" ")||"";else{if(typeof o[0]!="string")throw new Error("Invalid arguments passed to Layerr");h={},u=u=o.join(" ")||""}return{options:h,shortMessage:u}}(s);let i=n;if(a.cause&&(i="".concat(i,": ").concat(a.cause.message)),super(i),this.message=i,a.name&&typeof a.name=="string"?this.name=a.name:this.name="Layerr",a.cause&&Object.defineProperty(this,"_cause",{value:a.cause}),Object.defineProperty(this,"_info",{value:{}}),a.info&&typeof a.info=="object"&&Object.assign(this._info,a.info),Error.captureStackTrace){const o=a.constructorOpt||this.constructor;Error.captureStackTrace(this,o)}}static cause(e){return xm(e),e._cause&&Lf(e._cause)?e._cause:null}static fullStack(e){var s;xm(e);const t=Kt.cause(e);return t?"".concat(e.stack,"\ncaused by: ").concat(Kt.fullStack(t)):(s=e.stack)!=null?s:""}static info(e){xm(e);const t={},s=Kt.cause(e);return s&&Object.assign(t,Kt.info(s)),e._info&&Object.assign(t,e._info),t}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e="".concat(e,": ").concat(this.message)),e}}var Uy=Ve(47),Gh=Ve.n(Uy);const cd="__PATH_SEPARATOR_POSIX__",hd="__PATH_SEPARATOR_WINDOWS__";function Ke(r){try{const e=r.replace(/\//g,cd).replace(/\\\\/g,hd);return encodeURIComponent(e).split(hd).join("\\\\").split(cd).join("/")}catch(e){throw new Kt(e,"Failed encoding path")}}function md(r){return r.startsWith("/")?r:"/"+r}function bc(r){let e=r;return e[0]!=="/"&&(e="/"+e),/^.+\/$/.test(e)&&(e=e.substr(0,e.length-1)),e}function Ly(r){let e=new(Ry())(r).pathname;return e.length<=0&&(e="/"),bc(e)}function Me(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return function(){return function(s){var a=[];if(s.length===0)return"";if(typeof s[0]!="string")throw new TypeError("Url must be a string. Received "+s[0]);if(s[0].match(/^[^/:]+:\/*$/)&&s.length>1){var n=s.shift();s[0]=n+s[0]}s[0].match(/^file:\/\/\//)?s[0]=s[0].replace(/^([^/:]+):\/*/,"$1:///"):s[0]=s[0].replace(/^([^/:]+):\/*/,"$1://");for(var i=0;i<s.length;i++){var o=s[i];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(i>0&&(o=o.replace(/^[\/]+/,"")),o=i<s.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),a.push(o))}var h=a.join("/"),u=(h=h.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return u.shift()+(u.length>0?"?":"")+u.join("&")}(typeof arguments[0]=="object"?arguments[0]:[].slice.call(arguments))}(e.reduce((s,a,n)=>((n===0||a!=="/"||a==="/"&&s[s.length-1]!=="/")&&s.push(a),s),[]))}var jy=Ve(542),eu=Ve.n(jy);const $y="abcdef0123456789";function fd(r,e){const t=r.url.replace("//",""),s=t.indexOf("/")==-1?"/":t.slice(t.indexOf("/")),a=r.method?r.method.toUpperCase():"GET",n=!!/(^|,)\s*auth\s*($|,)/.test(e.qop)&&"auth",i="00000000".concat(e.nc).slice(-8),o=function(m,v,w,S,y,k,p){const b=p||eu()("".concat(v,":").concat(w,":").concat(S));return m&&m.toLowerCase()==="md5-sess"?eu()("".concat(b,":").concat(y,":").concat(k)):b}(e.algorithm,e.username,e.realm,e.password,e.nonce,e.cnonce,e.ha1),h=eu()("".concat(a,":").concat(s)),u=n?eu()("".concat(o,":").concat(e.nonce,":").concat(i,":").concat(e.cnonce,":").concat(n,":").concat(h)):eu()("".concat(o,":").concat(e.nonce,":").concat(h)),l={username:e.username,realm:e.realm,nonce:e.nonce,uri:s,qop:n,response:u,nc:i,cnonce:e.cnonce,algorithm:e.algorithm,opaque:e.opaque},f=[];for(const m in l)l[m]&&(m==="qop"||m==="nc"||m==="algorithm"?f.push("".concat(m,"=").concat(l[m])):f.push("".concat(m,'="').concat(l[m],'"')));return"Digest ".concat(f.join(", "))}function Lg(r){return(r.headers&&r.headers.get("www-authenticate")||"").split(/\s/)[0].toLowerCase()==="digest"}var Ky=Ve(101),jg=Ve.n(Ky);function pd(r){return jg().decode(r)}function dd(r,e){var t;return"Basic ".concat((t="".concat(r,":").concat(e),jg().encode(t)))}const zh=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:typeof window<"u"?window:globalThis,My=zh.fetch.bind(zh),Hy=zh.Request,Fy=zh.Response;let Lt=function(r){return r.Auto="auto",r.Digest="digest",r.None="none",r.Password="password",r.Token="token",r}({}),cr=function(r){return r.DataTypeNoLength="data-type-no-length",r.InvalidAuthType="invalid-auth-type",r.InvalidOutputFormat="invalid-output-format",r.LinkUnsupportedAuthType="link-unsupported-auth",r.InvalidUpdateRange="invalid-update-range",r.NotSupported="not-supported",r}({});function $g(r,e,t,s,a){switch(r.authType){case Lt.Auto:e&&t&&(r.headers.Authorization=dd(e,t));break;case Lt.Digest:r.digest=function(i,o,h){return{username:i,password:o,ha1:h,nc:0,algorithm:"md5",hasDigestAuth:!1}}(e,t,a);break;case Lt.None:break;case Lt.Password:r.headers.Authorization=dd(e,t);break;case Lt.Token:r.headers.Authorization="".concat((n=s).token_type," ").concat(n.access_token);break;default:throw new Kt({info:{code:cr.InvalidAuthType}},"Invalid auth type: ".concat(r.authType))}var n}Ve(345),Ve(800);const gd="@@HOTPATCHER",Jy=()=>{};function Bm(r){return{original:r,methods:[r],final:!1}}class qy{constructor(){this._configuration={registry:{},getEmptyAction:"null"},this.__type__=gd}get configuration(){return this._configuration}get getEmptyAction(){return this.configuration.getEmptyAction}set getEmptyAction(e){this.configuration.getEmptyAction=e}control(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e||e.__type__!==gd)throw new Error("Failed taking control of target HotPatcher instance: Invalid type or object");return Object.keys(e.configuration.registry).forEach(s=>{this.configuration.registry.hasOwnProperty(s)?t&&(this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])):this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])}),e._configuration=this.configuration,this}execute(e){const t=this.get(e)||Jy;for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];return t(...a)}get(e){const t=this.configuration.registry[e];if(!t)switch(this.getEmptyAction){case"null":return null;case"throw":throw new Error("Failed handling method request: No method provided for override: ".concat(e));default:throw new Error("Failed handling request which resulted in an empty method: Invalid empty-action specified: ".concat(this.getEmptyAction))}return function(){for(var s=arguments.length,a=new Array(s),n=0;n<s;n++)a[n]=arguments[n];if(a.length===0)throw new Error("Failed creating sequence: No functions provided");return function(){for(var i=arguments.length,o=new Array(i),h=0;h<i;h++)o[h]=arguments[h];let u=o;const l=this;for(;a.length>0;)u=[a.shift().apply(l,u)];return u[0]}}(...t.methods)}isPatched(e){return!!this.configuration.registry[e]}patch(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{chain:a=!1}=s;if(this.configuration.registry[e]&&this.configuration.registry[e].final)throw new Error("Failed patching '".concat(e,"': Method marked as being final"));if(typeof t!="function")throw new Error("Failed patching '".concat(e,"': Provided method is not a function"));if(a)this.configuration.registry[e]?this.configuration.registry[e].methods.push(t):this.configuration.registry[e]=Bm(t);else if(this.isPatched(e)){const{original:n}=this.configuration.registry[e];this.configuration.registry[e]=Object.assign(Bm(t),{original:n})}else this.configuration.registry[e]=Bm(t);return this}patchInline(e,t){this.isPatched(e)||this.patch(e,t);for(var s=arguments.length,a=new Array(s>2?s-2:0),n=2;n<s;n++)a[n-2]=arguments[n];return this.execute(e,...a)}plugin(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return s.forEach(n=>{this.patch(e,n,{chain:!0})}),this}restore(e){if(!this.isPatched(e))throw new Error("Failed restoring method: No method present for key: ".concat(e));if(typeof this.configuration.registry[e].original!="function")throw new Error("Failed restoring method: Original method not found or of invalid type for key: ".concat(e));return this.configuration.registry[e].methods=[this.configuration.registry[e].original],this}setFinal(e){if(!this.configuration.registry.hasOwnProperty(e))throw new Error("Failed marking '".concat(e,"' as final: No method found for key"));return this.configuration.registry[e].final=!0,this}}let Om=null;function Kg(){return Om||(Om=new qy),Om}function Xh(r){return function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(r)?Object.assign({},r):Object.setPrototypeOf(Object.assign({},r),Object.getPrototypeOf(r))}function wd(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let s=null,a=[...e];for(;a.length>0;){const n=a.shift();s=s?Mg(s,n):Xh(n)}return s}function Mg(r,e){const t=Xh(r);return Object.keys(e).forEach(s=>{t.hasOwnProperty(s)?Array.isArray(e[s])?t[s]=Array.isArray(t[s])?[...t[s],...e[s]]:[...e[s]]:typeof e[s]=="object"&&e[s]?t[s]=typeof t[s]=="object"&&t[s]?Mg(t[s],e[s]):Xh(e[s]):t[s]=e[s]:t[s]=e[s]}),t}function Wy(r){const e={};for(const t of r.keys())e[t]=r.get(t);return e}function jf(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(e.length===0)return{};const s={};return e.reduce((a,n)=>(Object.keys(n).forEach(i=>{const o=i.toLowerCase();s.hasOwnProperty(o)?a[s[o]]=n[i]:(s[o]=i,a[i]=n[i])}),a),{})}Ve(805);const _y=typeof ArrayBuffer=="function",{toString:Gy}=Object.prototype;function Hg(r){return _y&&(r instanceof ArrayBuffer||Gy.call(r)==="[object ArrayBuffer]")}function Fg(r){return r!=null&&r.constructor!=null&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function vp(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function $f(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Jg=vp(function(r){const e=r._digest;return delete r._digest,e.hasDigestAuth&&(r=wd(r,{headers:{Authorization:fd(r,e)}})),$f(Yh(r),function(t){let s=!1;return a=function(i){return s?i:t},(n=function(){if(t.status==401)return e.hasDigestAuth=function(i,o){if(!Lg(i))return!1;const h=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;for(;;){const u=i.headers&&i.headers.get("www-authenticate")||"",l=h.exec(u);if(!l)break;o[l[1]]=l[2]||l[3]}return o.nc+=1,o.cnonce=function(){let u="";for(let l=0;l<32;++l)u="".concat(u).concat($y[Math.floor(16*Math.random())]);return u}(),!0}(t,e),function(){if(e.hasDigestAuth)return $f(Yh(r=wd(r,{headers:{Authorization:fd(r,e)}})),function(i){return i.status==401?e.hasDigestAuth=!1:e.nc++,s=!0,i})}();e.nc++}())&&n.then?n.then(a):a(n);var a,n})}),zy=vp(function(r,e){return $f(Yh(r),function(t){return t.ok?(e.authType=Lt.Password,t):t.status==401&&Lg(t)?(e.authType=Lt.Digest,$g(e,e.username,e.password,void 0,void 0),r._digest=e.digest,Jg(r)):t})}),mt=vp(function(r,e){return e.authType===Lt.Auto?zy(r,e):r._digest?Jg(r):Yh(r)});function ft(r,e,t){const s=Xh(r);return s.headers=jf(e.headers,s.headers||{},t.headers||{}),t.data!==void 0&&(s.data=t.data),t.signal&&(s.signal=t.signal),e.httpAgent&&(s.httpAgent=e.httpAgent),e.httpsAgent&&(s.httpsAgent=e.httpsAgent),e.digest&&(s._digest=e.digest),typeof e.withCredentials=="boolean"&&(s.withCredentials=e.withCredentials),s}function Yh(r){const e=Kg();return e.patchInline("request",t=>e.patchInline("fetch",My,t.url,function(s){let a={};const n={method:s.method};if(s.headers&&(a=jf(a,s.headers)),s.data!==void 0){const[i,o]=function(h){if(typeof h=="string")return[h,{}];if(Fg(h))return[h,{}];if(Hg(h))return[h,{}];if(h&&typeof h=="object")return[JSON.stringify(h),{"content-type":"application/json"}];throw new Error("Unable to convert request body: Unexpected body type: "+typeof h)}(s.data);n.body=i,a=jf(a,o)}return s.signal&&(n.signal=s.signal),s.withCredentials&&(n.credentials="include"),n.headers=a,n}(t)),r)}var Xy=Ve(285);const Qh=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>65536)throw new TypeError("pattern is too long")},Yy={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},tu=r=>r.replace(/[[\]\\-]/g,"\\$&"),yd=r=>r.join(""),Qy=(r,e)=>{const t=e;if(r.charAt(t)!=="[")throw new Error("not in a brace expression");const s=[],a=[];let n=t+1,i=!1,o=!1,h=!1,u=!1,l=t,f="";e:for(;n<r.length;){const S=r.charAt(n);if(S!=="!"&&S!=="^"||n!==t+1){if(S==="]"&&i&&!h){l=n+1;break}if(i=!0,S!=="\\"||h){if(S==="["&&!h){for(const[y,[k,p,b]]of Object.entries(Yy))if(r.startsWith(y,n)){if(f)return["$.",!1,r.length-t,!0];n+=y.length,b?a.push(k):s.push(k),o=o||p;continue e}}h=!1,f?(S>f?s.push(tu(f)+"-"+tu(S)):S===f&&s.push(tu(S)),f="",n++):r.startsWith("-]",n+1)?(s.push(tu(S+"-")),n+=2):r.startsWith("-",n+1)?(f=S,n+=2):(s.push(tu(S)),n++)}else h=!0,n++}else u=!0,n++}if(l<n)return["",!1,0,!1];if(!s.length&&!a.length)return["$.",!1,r.length-t,!0];if(a.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!u)return[(m=s[0].length===2?s[0].slice(-1):s[0],m.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,l-t,!1];var m;const v="["+(u?"^":"")+yd(s)+"]",w="["+(u?"":"^")+yd(a)+"]";return[s.length&&a.length?"("+v+"|"+w+")":s.length?v:w,o,l-t,!0]},gu=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/\[([^\/\\])\]/g,"$1"):r.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1")},Zy=new Set(["!","?","+","*","@"]),vd=r=>Zy.has(r),Pm="(?!\\.)",e0=new Set(["[","."]),t0=new Set(["..","."]),s0=new Set("().*{}+?[]^$\\!"),bp="[^/]",bd=bp+"*?",Sd=bp+"+?";var ut,gt,Qs,Re,st,ma,$n,fa,Bs,Kn,Vc,Yn,qg,ka,mh,Kf,Wg;const Pt=class Pt{constructor(e,t){Jt(this,Yn);tt(this,"type");Jt(this,ut);Jt(this,gt);Jt(this,Qs,!1);Jt(this,Re,[]);Jt(this,st);Jt(this,ma);Jt(this,$n);Jt(this,fa,!1);Jt(this,Bs);Jt(this,Kn);Jt(this,Vc,!1);let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.type=e,e&&qe(this,gt,!0),qe(this,st,t),qe(this,ut,Z(this,st)?Z(Z(this,st),ut):this),qe(this,Bs,Z(this,ut)===this?s:Z(Z(this,ut),Bs)),qe(this,$n,Z(this,ut)===this?[]:Z(Z(this,ut),$n)),e!=="!"||Z(Z(this,ut),fa)||Z(this,$n).push(this),qe(this,ma,Z(this,st)?Z(Z(this,st),Re).length:0)}get hasMagic(){if(Z(this,gt)!==void 0)return Z(this,gt);for(const e of Z(this,Re))if(typeof e!="string"&&(e.type||e.hasMagic))return qe(this,gt,!0);return Z(this,gt)}toString(){return Z(this,Kn)!==void 0?Z(this,Kn):this.type?qe(this,Kn,this.type+"("+Z(this,Re).map(e=>String(e)).join("|")+")"):qe(this,Kn,Z(this,Re).map(e=>String(e)).join(""))}push(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];for(const a of t)if(a!==""){if(typeof a!="string"&&!(a instanceof Pt&&Z(a,st)===this))throw new Error("invalid part: "+a);Z(this,Re).push(a)}}toJSON(){var t;const e=this.type===null?Z(this,Re).slice().map(s=>typeof s=="string"?s:s.toJSON()):[this.type,...Z(this,Re).map(s=>s.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===Z(this,ut)||Z(Z(this,ut),fa)&&((t=Z(this,st))==null?void 0:t.type)==="!")&&e.push({}),e}isStart(){var t;if(Z(this,ut)===this)return!0;if(!((t=Z(this,st))!=null&&t.isStart()))return!1;if(Z(this,ma)===0)return!0;const e=Z(this,st);for(let s=0;s<Z(this,ma);s++){const a=Z(e,Re)[s];if(!(a instanceof Pt&&a.type==="!"))return!1}return!0}isEnd(){var t,s,a;if(Z(this,ut)===this||((t=Z(this,st))==null?void 0:t.type)==="!")return!0;if(!((s=Z(this,st))!=null&&s.isEnd()))return!1;if(!this.type)return(a=Z(this,st))==null?void 0:a.isEnd();const e=Z(this,st)?Z(Z(this,st),Re).length:0;return Z(this,ma)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new Pt(this.type,e);for(const s of Z(this,Re))t.copyIn(s);return t}static fromGlob(e){var a;let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new Pt(null,void 0,t);return pr(a=Pt,ka,mh).call(a,e,s,0,t),s}toMMPattern(){if(this!==Z(this,ut))return Z(this,ut).toMMPattern();const e=this.toString(),[t,s,a,n]=this.toRegExpSource();if(!(a||Z(this,gt)||Z(this,Bs).nocase&&!Z(this,Bs).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;const i=(Z(this,Bs).nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp("^".concat(t,"$"),i),{_src:t,_glob:e})}get options(){return Z(this,Bs)}toRegExpSource(e){var h;const t=e!=null?e:!!Z(this,Bs).dot;if(Z(this,ut)===this&&pr(this,Yn,qg).call(this),!this.type){const u=this.isStart()&&this.isEnd(),l=Z(this,Re).map(v=>{var p;const[w,S,y,k]=typeof v=="string"?pr(p=Pt,ka,Wg).call(p,v,Z(this,gt),u):v.toRegExpSource(e);return qe(this,gt,Z(this,gt)||y),qe(this,Qs,Z(this,Qs)||k),w}).join("");let f="";if(this.isStart()&&typeof Z(this,Re)[0]=="string"&&(Z(this,Re).length!==1||!t0.has(Z(this,Re)[0]))){const v=e0,w=t&&v.has(l.charAt(0))||l.startsWith("\\.")&&v.has(l.charAt(2))||l.startsWith("\\.\\.")&&v.has(l.charAt(4)),S=!t&&!e&&v.has(l.charAt(0));f=w?"(?!(?:^|/)\\.\\.?(?:$|/))":S?Pm:""}let m="";return this.isEnd()&&Z(Z(this,ut),fa)&&((h=Z(this,st))==null?void 0:h.type)==="!"&&(m="(?:$|\\/)"),[f+l+m,gu(l),qe(this,gt,!!Z(this,gt)),Z(this,Qs)]}const s=this.type==="*"||this.type==="+",a=this.type==="!"?"(?:(?!(?:":"(?:";let n=pr(this,Yn,Kf).call(this,t);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){const u=this.toString();return qe(this,Re,[u]),this.type=null,qe(this,gt,void 0),[u,gu(this.toString()),!1,!1]}let i=!s||e||t?"":pr(this,Yn,Kf).call(this,!0);i===n&&(i=""),i&&(n="(?:".concat(n,")(?:").concat(i,")*?"));let o="";return o=this.type==="!"&&Z(this,Vc)?(this.isStart()&&!t?Pm:"")+Sd:a+n+(this.type==="!"?"))"+(!this.isStart()||t||e?"":Pm)+bd+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":")".concat(this.type)),[o,gu(n),qe(this,gt,!!Z(this,gt)),Z(this,Qs)]}};ut=new WeakMap,gt=new WeakMap,Qs=new WeakMap,Re=new WeakMap,st=new WeakMap,ma=new WeakMap,$n=new WeakMap,fa=new WeakMap,Bs=new WeakMap,Kn=new WeakMap,Vc=new WeakMap,Yn=new WeakSet,qg=function(){if(this!==Z(this,ut))throw new Error("should only call on root");if(Z(this,fa))return this;let e;for(this.toString(),qe(this,fa,!0);e=Z(this,$n).pop();){if(e.type!=="!")continue;let t=e,s=Z(t,st);for(;s;){for(let a=Z(t,ma)+1;!s.type&&a<Z(s,Re).length;a++)for(const n of Z(e,Re)){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(Z(s,Re)[a])}t=s,s=Z(t,st)}}return this},ka=new WeakSet,mh=function(e,t,s,a){var v,w;let n=!1,i=!1,o=-1,h=!1;if(t.type===null){let S=s,y="";for(;S<e.length;){const k=e.charAt(S++);if(n||k==="\\")n=!n,y+=k;else if(i)S===o+1?k!=="^"&&k!=="!"||(h=!0):k!=="]"||S===o+2&&h||(i=!1),y+=k;else if(k!=="[")if(a.noext||!vd(k)||e.charAt(S)!=="(")y+=k;else{t.push(y),y="";const p=new Pt(k,t);S=pr(v=Pt,ka,mh).call(v,e,p,S,a),t.push(p)}else i=!0,o=S,h=!1,y+=k}return t.push(y),S}let u=s+1,l=new Pt(null,t);const f=[];let m="";for(;u<e.length;){const S=e.charAt(u++);if(n||S==="\\")n=!n,m+=S;else if(i)u===o+1?S!=="^"&&S!=="!"||(h=!0):S!=="]"||u===o+2&&h||(i=!1),m+=S;else if(S!=="[")if(vd(S)&&e.charAt(u)==="("){l.push(m),m="";const y=new Pt(S,l);l.push(y),u=pr(w=Pt,ka,mh).call(w,e,y,u,a)}else if(S!=="|"){if(S===")")return m===""&&Z(t,Re).length===0&&qe(t,Vc,!0),l.push(m),m="",t.push(...f,l),u;m+=S}else l.push(m),m="",f.push(l),l=new Pt(null,t);else i=!0,o=u,h=!1,m+=S}return t.type=null,qe(t,gt,void 0),qe(t,Re,[e.substring(s-1)]),u},Kf=function(e){return Z(this,Re).map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[s,a,n,i]=t.toRegExpSource(e);return qe(this,Qs,Z(this,Qs)||i),s}).filter(t=>!(this.isStart()&&this.isEnd()&&!t)).join("|")},Wg=function(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=!1,n="",i=!1;for(let o=0;o<e.length;o++){const h=e.charAt(o);if(a)a=!1,n+=(s0.has(h)?"\\":"")+h;else if(h!=="\\"){if(h==="["){const[u,l,f,m]=Qy(e,o);if(f){n+=u,i=i||l,o+=f-1,t=t||m;continue}}h!=="*"?h!=="?"?n+=h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(n+=bp,t=!0):(n+=s&&e==="*"?Sd:bd,t=!0)}else o===e.length-1?n+="\\\\":a=!0}return[n,gu(e),!!t,i]},Jt(Pt,ka);let Zh=Pt;const Ot=function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Qh(e),!(!t.nocomment&&e.charAt(0)==="#")&&new em(e,t).match(r)},r0=/^\*+([^+@!?\*\[\(]*)$/,a0=r=>e=>!e.startsWith(".")&&e.endsWith(r),n0=r=>e=>e.endsWith(r),i0=r=>(r=r.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(r)),o0=r=>(r=r.toLowerCase(),e=>e.toLowerCase().endsWith(r)),u0=/^\*+\.\*+$/,l0=r=>!r.startsWith(".")&&r.includes("."),c0=r=>r!=="."&&r!==".."&&r.includes("."),h0=/^\.\*+$/,m0=r=>r!=="."&&r!==".."&&r.startsWith("."),f0=/^\*+$/,p0=r=>r.length!==0&&!r.startsWith("."),d0=r=>r.length!==0&&r!=="."&&r!=="..",g0=/^\?+([^+@!?\*\[\(]*)?$/,w0=r=>{let[e,t=""]=r;const s=_g([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},y0=r=>{let[e,t=""]=r;const s=Gg([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},v0=r=>{let[e,t=""]=r;const s=Gg([e]);return t?a=>s(a)&&a.endsWith(t):s},b0=r=>{let[e,t=""]=r;const s=_g([e]);return t?a=>s(a)&&a.endsWith(t):s},_g=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&!s.startsWith(".")},Gg=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&s!=="."&&s!==".."},zg=typeof lt=="object"&&lt?typeof Vm=="object"&&Vm&&Vm.__MINIMATCH_TESTING_PLATFORM__||lt.platform:"posix";Ot.sep=zg==="win32"?"\\":"/";const ns=Symbol("globstar **");Ot.GLOBSTAR=ns,Ot.filter=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return t=>Ot(t,r,e)};const rs=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.assign({},r,e)};Ot.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return Ot;const e=Ot;return Object.assign(function(t,s){return e(t,s,rs(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))},{Minimatch:class extends e.Minimatch{constructor(t){super(t,rs(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}))}static defaults(t){return e.defaults(rs(r,t)).Minimatch}},AST:class extends e.AST{constructor(t,s){super(t,s,rs(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))}static fromGlob(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.AST.fromGlob(t,rs(r,s))}},unescape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.unescape(t,rs(r,s))},escape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.escape(t,rs(r,s))},filter:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.filter(t,rs(r,s))},defaults:t=>e.defaults(rs(r,t)),makeRe:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.makeRe(t,rs(r,s))},braceExpand:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.braceExpand(t,rs(r,s))},match:function(t,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e.match(t,s,rs(r,a))},sep:e.sep,GLOBSTAR:ns})};const Xg=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Qh(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:Xy(r)};Ot.braceExpand=Xg,Ot.makeRe=function(r){return new em(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).makeRe()},Ot.match=function(r,e){const t=new em(e,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{});return r=r.filter(s=>t.match(s)),t.options.nonull&&!r.length&&r.push(e),r};const Ad=/[?*]|[+@!]\(.*?\)|\[|\]/;class em{constructor(e){tt(this,"options");tt(this,"set");tt(this,"pattern");tt(this,"windowsPathsNoEscape");tt(this,"nonegate");tt(this,"negate");tt(this,"comment");tt(this,"empty");tt(this,"preserveMultipleSlashes");tt(this,"partial");tt(this,"globSet");tt(this,"globParts");tt(this,"nocase");tt(this,"isWindows");tt(this,"platform");tt(this,"windowsNoMagicRoot");tt(this,"regexp");let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Qh(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||zg,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#")return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=function(){return console.error(...arguments)}),this.debug(this.pattern,this.globSet);const s=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let a=this.globParts.map((n,i,o)=>{if(this.isWindows&&this.windowsNoMagicRoot){const h=!(n[0]!==""||n[1]!==""||n[2]!=="?"&&Ad.test(n[2])||Ad.test(n[3])),u=/^[a-z]:/i.test(n[0]);if(h)return[...n.slice(0,4),...n.slice(4).map(l=>this.parse(l))];if(u)return[n[0],...n.slice(1).map(l=>this.parse(l))]}return n.map(h=>this.parse(h))});if(this.debug(this.pattern,a),this.set=a.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){const i=this.set[n];i[0]===""&&i[1]===""&&this.globParts[n][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)e[s][a]==="**"&&(e[s][a]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let a=s;for(;t[a+1]==="**";)a++;a!==s&&t.splice(s,a-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,a)=>{const n=s[s.length-1];return a==="**"&&n==="**"?s:a===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(s.pop(),s):(s.push(a),s)},[])).length===0?[""]:t)}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let a=1;a<e.length-1;a++){const n=e[a];a===1&&n===""&&e[0]===""||n!=="."&&n!==""||(t=!0,e.splice(a,1),a--)}e[0]!=="."||e.length!==2||e[1]!=="."&&e[1]!==""||(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){const a=e[s-1];a&&a!=="."&&a!==".."&&a!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let a=-1;for(;(a=s.indexOf("**",a+1))!==-1;){let i=a;for(;s[i+1]==="**";)i++;i>a&&s.splice(a+1,i-a);let o=s[a+1];const h=s[a+2],u=s[a+3];if(o!==".."||!h||h==="."||h===".."||!u||u==="."||u==="..")continue;t=!0,s.splice(a,1);const l=s.slice(0);l[a]="**",e.push(l),a--}if(!this.preserveMultipleSlashes){for(let i=1;i<s.length-1;i++){const o=s[i];i===1&&o===""&&s[0]===""||o!=="."&&o!==""||(t=!0,s.splice(i,1),i--)}s[0]!=="."||s.length!==2||s[1]!=="."&&s[1]!==""||(t=!0,s.pop())}let n=0;for(;(n=s.indexOf("..",n+1))!==-1;){const i=s[n-1];if(i&&i!=="."&&i!==".."&&i!=="**"){t=!0;const o=n===1&&s[n+1]==="**"?["."]:[];s.splice(n-1,2,...o),s.length===0&&s.push(""),n-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){const a=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(a){e[t]=[],e[s]=a;break}}return e.filter(t=>t.length)}partsMatch(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=0,n=0,i=[],o="";for(;a<e.length&&n<t.length;)if(e[a]===t[n])i.push(o==="b"?t[n]:e[a]),a++,n++;else if(s&&e[a]==="**"&&t[n]===e[a+1])i.push(e[a]),a++;else if(s&&t[n]==="**"&&e[a]===t[n+1])i.push(t[n]),n++;else if(e[a]!=="*"||!t[n]||!this.options.dot&&t[n].startsWith(".")||t[n]==="**"){if(t[n]!=="*"||!e[a]||!this.options.dot&&e[a].startsWith(".")||e[a]==="**"||o==="a")return!1;o="b",i.push(t[n]),a++,n++}else{if(o==="b")return!1;o="a",i.push(e[a]),a++,n++}return e.length===t.length&&i}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let a=0;a<e.length&&e.charAt(a)==="!";a++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const a=this.options;if(this.isWindows){const S=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),y=!S&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),k=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),p=y?3:S?0:void 0,b=!k&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3])?3:k?0:void 0;if(typeof p=="number"&&typeof b=="number"){const[I,P]=[e[p],t[b]];I.toLowerCase()===P.toLowerCase()&&(t[b]=I,b>p?t=t.slice(b):p>b&&(e=e.slice(p)))}}const{optimizationLevel:n=1}=this.options;n>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,o=0,h=e.length,u=t.length;i<h&&o<u;i++,o++){this.debug("matchOne loop");var l=t[o],f=e[i];if(this.debug(t,l,f),l===!1)return!1;if(l===ns){this.debug("GLOBSTAR",[t,l,f]);var m=i,v=o+1;if(v===u){for(this.debug("** at the end");i<h;i++)if(e[i]==="."||e[i]===".."||!a.dot&&e[i].charAt(0)===".")return!1;return!0}for(;m<h;){var w=e[m];if(this.debug("\nglobstar while",e,m,t,v,w),this.matchOne(e.slice(m),t.slice(v),s))return this.debug("globstar found match!",m,h,w),!0;if(w==="."||w===".."||!a.dot&&w.charAt(0)==="."){this.debug("dot detected!",e,m,t,v);break}this.debug("globstar swallow a segment, and continue"),m++}return!(!s||(this.debug("\n>>> no match, partial?",e,m,t,v),m!==h))}let S;if(typeof l=="string"?(S=f===l,this.debug("string match",l,f,S)):(S=l.test(f),this.debug("pattern match",l,f,S)),!S)return!1}if(i===h&&o===u)return!0;if(i===h)return s;if(o===u)return i===h-1&&e[i]==="";throw new Error("wtf?")}braceExpand(){return Xg(this.pattern,this.options)}parse(e){Qh(e);const t=this.options;if(e==="**")return ns;if(e==="")return"";let s,a=null;(s=e.match(f0))?a=t.dot?d0:p0:(s=e.match(r0))?a=(t.nocase?t.dot?o0:i0:t.dot?n0:a0)(s[1]):(s=e.match(g0))?a=(t.nocase?t.dot?y0:w0:t.dot?v0:b0)(s):(s=e.match(u0))?a=t.dot?c0:l0:(s=e.match(h0))&&(a=m0);const n=Zh.fromGlob(e,this.options).toMMPattern();return a&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:a}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",a=new Set(t.nocase?["i"]:[]);let n=e.map(h=>{const u=h.map(l=>{if(l instanceof RegExp)for(const f of l.flags.split(""))a.add(f);return typeof l=="string"?l.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):l===ns?ns:l._src});return u.forEach((l,f)=>{const m=u[f+1],v=u[f-1];l===ns&&v!==ns&&(v===void 0?m!==void 0&&m!==ns?u[f+1]="(?:\\/|"+s+"\\/)?"+m:u[f]=s:m===void 0?u[f-1]=v+"(?:\\/|"+s+")?":m!==ns&&(u[f-1]=v+"(?:\\/|\\/"+s+"\\/)"+m,u[f+1]=ns))}),u.filter(l=>l!==ns).join("/")}).join("|");const[i,o]=e.length>1?["(?:",")"]:["",""];n="^"+i+n+o+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...a].join(""))}catch(h){this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.partial;if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const s=this.options;this.isWindows&&(e=e.split("\\").join("/"));const a=this.slashSplit(e);this.debug(this.pattern,"split",a);const n=this.set;this.debug(this.pattern,"set",n);let i=a[a.length-1];if(!i)for(let o=a.length-2;!i&&o>=0;o--)i=a[o];for(let o=0;o<n.length;o++){const h=n[o];let u=a;if(s.matchBase&&h.length===1&&(u=[i]),this.matchOne(u,h,t))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(e){return Ot.defaults(e).Minimatch}}function Sp(r){const e=new Error("".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"","Invalid response: ").concat(r.status," ").concat(r.statusText));return e.status=r.status,e.response=r,e}function pt(r,e){const{status:t}=e;if(t===401&&r.digest)return e;if(t>=400)throw Sp(e);return e}function Qn(r,e){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?{data:e,headers:r.headers?Wy(r.headers):{},status:r.status,statusText:r.statusText}:e}Ot.AST=Zh,Ot.Minimatch=em,Ot.escape=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/[?*()[\]]/g,"[$&]"):r.replace(/[?*()[\]\\]/g,"\\$&")},Ot.unescape=gu;const S0=(Nd=function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ft({url:Me(r.remoteURL,Ke(e)),method:"COPY",headers:{Destination:Me(r.remoteURL,Ke(t)),Overwrite:s.overwrite===!1?"F":"T",Depth:s.shallow?"0":"infinity"}},r,s);return i=function(o){pt(r,o)},(n=mt(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i},function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];try{return Promise.resolve(Nd.apply(this,r))}catch(t){return Promise.reject(t)}});var Nd,Ap=Ve(635),A0=Ve(829),Ys=Ve.n(A0),Po=function(r){return r.Array="array",r.Object="object",r.Original="original",r}(Po||{});function Uc(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Po.Original;const s=Ys().get(r,e);return t==="array"&&Array.isArray(s)===!1?[s]:t==="object"&&Array.isArray(s)?s[0]:s}function xc(r){return new Promise(e=>{e(function(t){const{multistatus:s}=t;if(s==="")return{multistatus:{response:[]}};if(!s)throw new Error("Invalid response: No root multistatus found");const a={multistatus:Array.isArray(s)?s[0]:s};return Ys().set(a,"multistatus.response",Uc(a,"multistatus.response",Po.Array)),Ys().set(a,"multistatus.response",Ys().get(a,"multistatus.response").map(n=>function(i){const o=Object.assign({},i);return o.status?Ys().set(o,"status",Uc(o,"status",Po.Object)):(Ys().set(o,"propstat",Uc(o,"propstat",Po.Object)),Ys().set(o,"propstat.prop",Uc(o,"propstat.prop",Po.Object))),o}(n))),a}(new Ap.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",textNodeName:"text",ignoreAttributes:!1,removeNSPrefix:!0,numberParseOptions:{hex:!0,leadingZeros:!1},attributeValueProcessor:(t,s,a)=>s==="true"||s==="false"?s==="true":s,tagValueProcessor(t,s,a){if(!a.endsWith("propstat.prop.displayname"))return s}}).parse(r)))})}function gm(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const{getlastmodified:s=null,getcontentlength:a="0",resourcetype:n=null,getcontenttype:i=null,getetag:o=null}=r,h=n&&typeof n=="object"&&n.collection!==void 0?"directory":"file",u={filename:e,basename:Gh().basename(e),lastmod:s,size:parseInt(a,10),type:h,etag:typeof o=="string"?o.replace(/"/g,""):null};return h==="file"&&(u.mime=i&&typeof i=="string"?i.split(";")[0]:""),t&&(r.displayname!==void 0&&(r.displayname=String(r.displayname)),u.props=r),u}function Yg(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=null;try{r.multistatus.response[0].propstat&&(s=r.multistatus.response[0])}catch(l){}if(!s)throw new Error("Failed getting item stat: bad response");const{propstat:{prop:a,status:n}}=s,[i,o,h]=n.split(" ",3),u=parseInt(o,10);if(u>=400){const l=new Error("Invalid response: ".concat(u," ").concat(h));throw l.status=u,l}return gm(a,bc(e),t)}function Qg(r){switch(String(r)){case"-3":return"unlimited";case"-2":case"-1":return"unknown";default:return parseInt(String(r),10)}}function Dm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Np=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=ft({url:Me(r.remoteURL,Ke(e)),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,t);return Dm(mt(a,r),function(n){return pt(r,n),Dm(n.text(),function(i){return Dm(xc(i),function(o){const h=Yg(o,e,s);return Qn(n,h,s)})})})});function Zg(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const N0=ew(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=function(n){if(!n||n==="/")return[];let i=n;const o=[];do o.push(i),i=Gh().dirname(i);while(i&&i!=="/");return o}(bc(e));s.sort((n,i)=>n.length>i.length?1:i.length>n.length?-1:0);let a=!1;return function(n,i,o){if(typeof n[kd]=="function"){let S=function(y){try{for(;!(h=f.next()).done;)if((y=i(h.value))&&y.then){if(!Id(y))return void y.then(S,l||(l=jt.bind(null,u=new Do,2)));y=y.v}u?jt(u,1,y):u=y}catch(k){jt(u||(u=new Do),2,k)}};var h,u,l,f=n[kd]();if(S(),f.return){var m=function(y){try{h.done||f.return()}catch(k){}return y};if(u&&u.then)return u.then(m,function(y){throw m(y)});m()}return u}if(!("length"in n))throw new TypeError("Object is not iterable");for(var v=[],w=0;w<n.length;w++)v.push(n[w]);return function(S,y,k){var p,b,I=-1;return function P(x){try{for(;++I<S.length&&(!k||!k());)if((x=y(I))&&x.then){if(!Id(x))return void x.then(P,b||(b=jt.bind(null,p=new Do,2)));x=x.v}p?jt(p,1,x):p=x}catch(T){jt(p||(p=new Do),2,T)}}(),p}(v,function(S){return i(v[S])},o)}(s,function(n){return i=function(){return function(h,u){try{var l=Zg(Np(r,n),function(f){if(f.type!=="directory")throw new Error("Path includes a file: ".concat(e))})}catch(f){return u(f)}return l&&l.then?l.then(void 0,u):l}(0,function(h){const u=h;return function(){if(u.status===404)return a=!0,Ed(Mf(r,n,fr(Gt({},t),{recursive:!1})));throw h}()})},(o=function(){if(a)return Ed(Mf(r,n,fr(Gt({},t),{recursive:!1})))}())&&o.then?o.then(i):i();var i,o},function(){return!1})});function ew(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function E0(){}function Ed(r,e){return r&&r.then?r.then(E0):Promise.resolve()}const kd=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function jt(r,e,t){if(!r.s){if(t instanceof Do){if(!t.s)return void(t.o=jt.bind(null,r,e));1&e&&(e=t.s),t=t.v}if(t&&t.then)return void t.then(jt.bind(null,r,e),jt.bind(null,r,2));r.s=e,r.v=t;const s=r.o;s&&s(r)}}const Do=function(){function r(){}return r.prototype.then=function(e,t){const s=new r,a=this.s;if(a){const n=1&a?e:t;if(n){try{jt(s,1,n(this.v))}catch(i){jt(s,2,i)}return s}return this}return this.o=function(n){try{const i=n.v;1&n.s?jt(s,1,e?e(i):i):t?jt(s,1,t(i)):jt(s,2,i)}catch(i){jt(s,2,i)}},s},r}();function Id(r){return r instanceof Do&&1&r.s}const Mf=ew(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.recursive===!0)return N0(r,e,t);const s=ft({url:Me(r.remoteURL,(a=Ke(e),a.endsWith("/")?a:a+"/")),method:"MKCOL"},r,t);var a;return Zg(mt(s,r),function(n){pt(r,n)})});var k0=Ve(388),Cd=Ve.n(k0);const I0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s={};if(typeof t.range=="object"&&typeof t.range.start=="number"){let o="bytes=".concat(t.range.start,"-");typeof t.range.end=="number"&&(o="".concat(o).concat(t.range.end)),s.Range=o}const a=ft({url:Me(r.remoteURL,Ke(e)),method:"GET",headers:s},r,t);return i=function(o){if(pt(r,o),s.Range&&o.status!==206){const h=new Error("Invalid response code for partial request: ".concat(o.status));throw h.status=o.status,h}return t.callback&&setTimeout(()=>{t.callback(o)},0),o.body},(n=mt(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i}),C0=()=>{},V0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){t.url||(t.url=Me(r.remoteURL,Ke(e)));const s=ft(t,r,{});return n=function(i){return pt(r,i),i},(a=mt(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),x0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:Me(r.remoteURL,Ke(e)),method:"DELETE"},r,t);return n=function(i){pt(r,i)},(a=mt(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),B0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function(s,a){try{var n=(i=Np(r,e,t),o=function(){return!0},h?o?o(i):i:(i&&i.then||(i=Promise.resolve(i)),o?i.then(o):i))}catch(u){return a(u)}var i,o,h;return n&&n.then?n.then(void 0,a):n}(0,function(s){if(s.status===404)return!1;throw s})});function Tm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const O0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:Me(r.remoteURL,Ke(e),"/"),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:t.deep?"infinity":"1"}},r,t);return Tm(mt(s,r),function(a){return pt(r,a),Tm(a.text(),function(n){if(!n)throw new Error("Failed parsing directory contents: Empty response");return Tm(xc(n),function(i){const o=md(e);let h=function(u,l,f){let m=arguments.length>3&&arguments[3]!==void 0&&arguments[3],v=arguments.length>4&&arguments[4]!==void 0&&arguments[4];const w=Gh().join(l,"/"),{multistatus:{response:S}}=u,y=S.map(k=>{const p=function(I){try{return I.replace(/^https?:\/\/[^\/]+/,"")}catch(P){throw new Kt(P,"Failed normalising HREF")}}(k.href),{propstat:{prop:b}}=k;return gm(b,w==="/"?decodeURIComponent(bc(p)):bc(Gh().relative(decodeURIComponent(w),decodeURIComponent(p))),m)});return v?y:y.filter(k=>k.basename&&(k.type==="file"||k.filename!==f.replace(/\/$/,"")))}(i,md(r.remoteBasePath||r.remotePath),o,t.details,t.includeSelf);return t.glob&&(h=function(u,l){return u.filter(f=>Ot(f.filename,l,{matchBase:!0}))}(h,t.glob)),Qn(a,h,t.details)})})})});function Ep(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const P0=Ep(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:Me(r.remoteURL,Ke(e)),method:"GET",headers:{Accept:"text/plain"},transformResponse:[R0]},r,t);return tm(mt(s,r),function(a){return pt(r,a),tm(a.text(),function(n){return Qn(a,n,t.details)})})});function tm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const D0=Ep(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:Me(r.remoteURL,Ke(e)),method:"GET"},r,t);return tm(mt(s,r),function(a){let n;return pt(r,a),function(i,o){var h=i();return h&&h.then?h.then(o):o()}(function(){return tm(a.arrayBuffer(),function(i){n=i})},function(){return Qn(a,n,t.details)})})}),T0=Ep(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{format:s="binary"}=t;if(s!=="binary"&&s!=="text")throw new Kt({info:{code:cr.InvalidOutputFormat}},"Invalid output format: ".concat(s));return s==="text"?P0(r,e,t):D0(r,e,t)}),R0=r=>r;function U0(r){return new Ap.XMLBuilder({attributeNamePrefix:"@_",format:!0,ignoreAttributes:!1,suppressEmptyNode:!0}).build(tw({lockinfo:{"@_xmlns:d":"DAV:",lockscope:{exclusive:{}},locktype:{write:{}},owner:{href:r}}},"d"))}function tw(r,e){const t=Gt({},r);for(const s in t)t.hasOwnProperty(s)&&(t[s]&&typeof t[s]=="object"&&s.indexOf(":")===-1?(t["".concat(e,":").concat(s)]=tw(t[s],e),delete t[s]):/^@_/.test(s)===!1&&(t["".concat(e,":").concat(s)]=t[s],delete t[s]));return t}function Hf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}function sw(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const L0=sw(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ft({url:Me(r.remoteURL,Ke(e)),method:"UNLOCK",headers:{"Lock-Token":t}},r,s);return Hf(mt(a,r),function(n){if(pt(r,n),n.status!==204&&n.status!==200)throw Sp(n)})}),j0=sw(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{refreshToken:s,timeout:a=$0}=t,n={Accept:"text/plain,application/xml",Timeout:a};s&&(n.If=s);const i=ft({url:Me(r.remoteURL,Ke(e)),method:"LOCK",headers:n,data:U0(r.contactHref)},r,t);return Hf(mt(i,r),function(o){return pt(r,o),Hf(o.text(),function(h){const u=(m=h,new Ap.XMLParser({removeNSPrefix:!0,parseAttributeValue:!0,parseTagValue:!0}).parse(m)),l=Ys().get(u,"prop.lockdiscovery.activelock.locktoken.href"),f=Ys().get(u,"prop.lockdiscovery.activelock.timeout");var m;if(!l)throw Sp(o,"No lock token received: ");return{token:l,serverTimeout:f}})})}),$0="Infinite, Second-4100000000";function Rm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const K0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.path||"/",s=ft({url:Me(r.remoteURL,t),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,e);return Rm(mt(s,r),function(a){return pt(r,a),Rm(a.text(),function(n){return Rm(xc(n),function(i){const o=function(h){try{const[u]=h.multistatus.response,{propstat:{prop:{"quota-used-bytes":l,"quota-available-bytes":f}}}=u;return l!==void 0&&f!==void 0?{used:parseInt(String(l),10),available:Qg(f)}:null}catch(u){}return null}(i);return Qn(a,o,e.details)})})})});function Um(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const M0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=ft({url:Me(r.remoteURL,Ke(e)),method:"SEARCH",headers:{Accept:"text/plain,application/xml","Content-Type":r.headers["Content-Type"]||"application/xml; charset=utf-8"}},r,t);return Um(mt(a,r),function(n){return pt(r,n),Um(n.text(),function(i){return Um(xc(i),function(o){const h=function(u,l,f){const m={truncated:!1,results:[]};return m.truncated=u.multistatus.response.some(v=>{var w,S;return((S=(v.status||((w=v.propstat)==null?void 0:w.status)).split(" ",3))==null?void 0:S[1])==="507"&&v.href.replace(/\/$/,"").endsWith(Ke(l).replace(/\/$/,""))}),u.multistatus.response.forEach(v=>{if(v.propstat===void 0)return;const w=v.href.split("/").map(decodeURIComponent).join("/");m.results.push(gm(v.propstat.prop,w,f))}),m}(o,e,s);return Qn(n,h,s)})})})}),H0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ft({url:Me(r.remoteURL,Ke(e)),method:"MOVE",headers:{Destination:Me(r.remoteURL,Ke(t)),Overwrite:s.overwrite===!1?"F":"T"}},r,s);return i=function(o){pt(r,o)},(n=mt(a,r))&&n.then||(n=Promise.resolve(n)),i?n.then(i):n;var n,i});var F0=Ve(172);const J0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const{contentLength:a=!0,overwrite:n=!0}=s,i={"Content-Type":"application/octet-stream"};a===!1||(i["Content-Length"]=typeof a=="number"?"".concat(a):"".concat(function(l){if(Hg(l))return l.byteLength;if(Fg(l))return l.length;if(typeof l=="string")return(0,F0.d)(l);throw new Kt({info:{code:cr.DataTypeNoLength}},"Cannot calculate data length: Invalid type")}(t))),n||(i["If-None-Match"]="*");const o=ft({url:Me(r.remoteURL,Ke(e)),method:"PUT",headers:i,data:t},r,s);return u=function(l){try{pt(r,l)}catch(f){const m=f;if(m.status!==412||n)throw m;return!1}return!0},(h=mt(o,r))&&h.then||(h=Promise.resolve(h)),u?h.then(u):h;var h,u}),rw=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:Me(r.remoteURL,Ke(e)),method:"OPTIONS"},r,t);return n=function(i){var o,h;try{pt(r,i)}catch(u){throw u}return{compliance:((o=i.headers.get("DAV"))!=null?o:"").split(",").map(u=>u.trim()),server:(h=i.headers.get("Server"))!=null?h:""}},(a=mt(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n});function fc(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const q0=kp(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new Kt({info:{code:cr.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const i={"Content-Type":"application/octet-stream","Content-Length":""+(s-t+1),"Content-Range":"bytes ".concat(t,"-").concat(s,"/*")},o=ft({url:Me(r.remoteURL,Ke(e)),method:"PUT",headers:i,data:a},r,n);return fc(mt(o,r),function(h){pt(r,h)})});function Vd(r,e){var t=r();return t&&t.then?t.then(e):e(t)}const W0=kp(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new Kt({info:{code:cr.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const i={"Content-Type":"application/x-sabredav-partialupdate","Content-Length":""+(s-t+1),"X-Update-Range":"bytes=".concat(t,"-").concat(s)},o=ft({url:Me(r.remoteURL,Ke(e)),method:"PATCH",headers:i,data:a},r,n);return fc(mt(o,r),function(h){pt(r,h)})});function kp(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const _0=kp(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};return fc(rw(r,e,n),function(i){let o=!1;return Vd(function(){if(i.compliance.includes("sabredav-partialupdate"))return fc(W0(r,e,t,s,a,n),function(h){return o=!0,h})},function(h){let u=!1;return o?h:Vd(function(){if(i.server.includes("Apache")&&i.compliance.includes("<http://apache.org/dav/propset/fs/1>"))return fc(q0(r,e,t,s,a,n),function(l){return u=!0,l})},function(l){if(u)return l;throw new Kt({info:{code:cr.NotSupported}},"Not supported")})})})}),G0="https://github.com/perry-mitchell/webdav-client/blob/master/LOCK_CONTACT.md";function z0(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{authType:t=null,remoteBasePath:s,contactHref:a=G0,ha1:n,headers:i={},httpAgent:o,httpsAgent:h,password:u,token:l,username:f,withCredentials:m}=e;let v=t;v||(v=f||u?Lt.Password:Lt.None);const w={authType:v,remoteBasePath:s,contactHref:a,ha1:n,headers:Object.assign({},i),httpAgent:o,httpsAgent:h,password:u,remotePath:Ly(r),remoteURL:r,token:l,username:f,withCredentials:m};return $g(w,f,u,l,n),{copyFile:(S,y,k)=>S0(w,S,y,k),createDirectory:(S,y)=>Mf(w,S,y),createReadStream:(S,y)=>function(k,p){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const I=new(Cd()).PassThrough;return I0(k,p,b).then(P=>{P.pipe(I)}).catch(P=>{I.emit("error",P)}),I}(w,S,y),createWriteStream:(S,y,k)=>function(p,b){let I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:C0;const x=new(Cd()).PassThrough,T={};I.overwrite===!1&&(T["If-None-Match"]="*");const B=ft({url:Me(p.remoteURL,Ke(b)),method:"PUT",headers:T,data:x,maxRedirects:0},p,I);return mt(B,p).then(V=>pt(p,V)).then(V=>{setTimeout(()=>{P(V)},0)}).catch(V=>{x.emit("error",V)}),x}(w,S,y,k),customRequest:(S,y)=>V0(w,S,y),deleteFile:(S,y)=>x0(w,S,y),exists:(S,y)=>B0(w,S,y),getDirectoryContents:(S,y)=>O0(w,S,y),getFileContents:(S,y)=>T0(w,S,y),getFileDownloadLink:S=>function(y,k){let p=Me(y.remoteURL,Ke(k));const b=/^https:/i.test(p)?"https":"http";switch(y.authType){case Lt.None:break;case Lt.Password:{const I=pd(y.headers.Authorization.replace(/^Basic /i,"").trim());p=p.replace(/^https?:\/\//,"".concat(b,"://").concat(I,"@"));break}default:throw new Kt({info:{code:cr.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(y.authType))}return p}(w,S),getFileUploadLink:S=>function(y,k){let p="".concat(Me(y.remoteURL,Ke(k)),"?Content-Type=application/octet-stream");const b=/^https:/i.test(p)?"https":"http";switch(y.authType){case Lt.None:break;case Lt.Password:{const I=pd(y.headers.Authorization.replace(/^Basic /i,"").trim());p=p.replace(/^https?:\/\//,"".concat(b,"://").concat(I,"@"));break}default:throw new Kt({info:{code:cr.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(y.authType))}return p}(w,S),getHeaders:()=>Object.assign({},w.headers),getQuota:S=>K0(w,S),lock:(S,y)=>j0(w,S,y),moveFile:(S,y,k)=>H0(w,S,y,k),putFileContents:(S,y,k)=>J0(w,S,y,k),partialUpdateFileContents:(S,y,k,p,b)=>_0(w,S,y,k,p,b),getDAVCompliance:S=>rw(w,S),search:(S,y)=>M0(w,S,y),setHeaders:S=>{w.headers=Object.assign({},S)},stat:(S,y)=>Np(w,S,y),unlock:(S,y,k)=>L0(w,S,y,k)}}fs.hT,fs.O4,fs.Kd,fs.YK;var X0=fs.UU,Y0=fs.Gu,Q0=fs.ky,Z0=fs.h4;fs.ch,fs.hq,fs.i5;const Lo=Bf().setApp("@nextcloud/files").detectUser().build();var aw=(r=>(r.Folder="folder",r.File="file",r))(aw||{}),nw=(r=>(r[r.NONE=0]="NONE",r[r.CREATE=4]="CREATE",r[r.READ=1]="READ",r[r.UPDATE=2]="UPDATE",r[r.DELETE=8]="DELETE",r[r.SHARE=16]="SHARE",r[r.ALL=31]="ALL",r))(nw||{});const iw=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],ow={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},Lm=function(r,e={nc:"http://nextcloud.org/ns"}){typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...iw],window._nc_dav_namespaces=Gt({},ow));const t=Gt(Gt({},window._nc_dav_namespaces),e);if(window._nc_dav_properties.find(a=>a===r))return Lo.warn("".concat(r," already registered"),{prop:r}),!1;if(r.startsWith("<")||r.split(":").length!==2)return Lo.error("".concat(r," is not valid. See example: 'oc:fileid'"),{prop:r}),!1;const s=r.split(":")[0];return t[s]?(window._nc_dav_properties.push(r),window._nc_dav_namespaces=t,!0):(Lo.error("".concat(r," namespace unknown"),{prop:r,namespaces:t}),!1)},e1=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...iw]),window._nc_dav_properties.map(r=>"<".concat(r," />")).join(" ")},t1=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces=Gt({},ow)),Object.keys(window._nc_dav_namespaces).map(r=>{var e;return"xmlns:".concat(r,'="').concat((e=window._nc_dav_namespaces)==null?void 0:e[r],'"')}).join(" ")},s1=function(){return'<?xml version="1.0"?>\n		<d:propfind '.concat(t1(),">\n			<d:prop>\n				").concat(e1(),"\n			</d:prop>\n		</d:propfind>")};function r1(){var r;return Rg()?"/files/".concat(Vy()):"/files/".concat((r=gp())==null?void 0:r.uid)}r1();function a1(){const r=ey("dav");return Rg()?r.replace("remote.php","public.php"):r}const n1=a1(),i1=function(r=n1,e={}){const t=X0(r,{headers:e});function s(a){t.setHeaders(fr(Gt({},e),{"X-Requested-With":"XMLHttpRequest",requesttoken:a!=null?a:""}))}return sy(s),s(ty()),Y0().patch("fetch",(a,n)=>{const i=n.headers;return i!=null&&i.method&&(n.method=i.method,delete i.method),fetch(a,n)}),t};var jm={},$m={exports:{}},xd={},Bd;function o1(){return Bd||(Bd=1,function(r){Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},t={};t.byteLength=l,t.toByteArray=m,t.fromByteArray=S;for(var s=[],a=[],n=typeof Uint8Array<"u"?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=i.length;o<h;++o)s[o]=i[o],a[i.charCodeAt(o)]=o;a[45]=62,a[95]=63;function u(p){var b=p.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=p.indexOf("=");I===-1&&(I=b);var P=I===b?0:4-I%4;return[I,P]}function l(p){var b=u(p),I=b[0],P=b[1];return(I+P)*3/4-P}function f(p,b,I){return(b+I)*3/4-I}function m(p){var b,I=u(p),P=I[0],x=I[1],T=new n(f(p,P,x)),B=0,V=x>0?P-4:P,J;for(J=0;J<V;J+=4)b=a[p.charCodeAt(J)]<<18|a[p.charCodeAt(J+1)]<<12|a[p.charCodeAt(J+2)]<<6|a[p.charCodeAt(J+3)],T[B++]=b>>16&255,T[B++]=b>>8&255,T[B++]=b&255;return x===2&&(b=a[p.charCodeAt(J)]<<2|a[p.charCodeAt(J+1)]>>4,T[B++]=b&255),x===1&&(b=a[p.charCodeAt(J)]<<10|a[p.charCodeAt(J+1)]<<4|a[p.charCodeAt(J+2)]>>2,T[B++]=b>>8&255,T[B++]=b&255),T}function v(p){return s[p>>18&63]+s[p>>12&63]+s[p>>6&63]+s[p&63]}function w(p,b,I){for(var P,x=[],T=b;T<I;T+=3)P=(p[T]<<16&16711680)+(p[T+1]<<8&65280)+(p[T+2]&255),x.push(v(P));return x.join("")}function S(p){for(var b,I=p.length,P=I%3,x=[],T=16383,B=0,V=I-P;B<V;B+=T)x.push(w(p,B,B+T>V?V:B+T));return P===1?(b=p[I-1],x.push(s[b>>2]+s[b<<4&63]+"==")):P===2&&(b=(p[I-2]<<8)+p[I-1],x.push(s[b>>10]+s[b>>4&63]+s[b<<2&63]+"=")),x.join("")}var y={};y.read=function(p,b,I,P,x){var T,B,V=x*8-P-1,J=(1<<V)-1,F=J>>1,D=-7,j=I?x-1:0,te=I?-1:1,Y=p[b+j];for(j+=te,T=Y&(1<<-D)-1,Y>>=-D,D+=V;D>0;T=T*256+p[b+j],j+=te,D-=8);for(B=T&(1<<-D)-1,T>>=-D,D+=P;D>0;B=B*256+p[b+j],j+=te,D-=8);if(T===0)T=1-F;else{if(T===J)return B?NaN:(Y?-1:1)*(1/0);B=B+Math.pow(2,P),T=T-F}return(Y?-1:1)*B*Math.pow(2,T-P)},y.write=function(p,b,I,P,x,T){var B,V,J,F=T*8-x-1,D=(1<<F)-1,j=D>>1,te=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=P?0:T-1,oe=P?1:-1,ne=b<0||b===0&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(V=isNaN(b)?1:0,B=D):(B=Math.floor(Math.log(b)/Math.LN2),b*(J=Math.pow(2,-B))<1&&(B--,J*=2),B+j>=1?b+=te/J:b+=te*Math.pow(2,1-j),b*J>=2&&(B++,J/=2),B+j>=D?(V=0,B=D):B+j>=1?(V=(b*J-1)*Math.pow(2,x),B=B+j):(V=b*Math.pow(2,j-1)*Math.pow(2,x),B=0));x>=8;p[I+Y]=V&255,Y+=oe,V/=256,x-=8);for(B=B<<x|V,F+=x;F>0;p[I+Y]=B&255,Y+=oe,B/=256,F-=8);p[I+Y-oe]|=ne*128},function(p){const b=t,I=y,P=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;p.Buffer=D,p.SlowBuffer=ce,p.INSPECT_MAX_BYTES=50;const x=2147483647;p.kMaxLength=x;const{Uint8Array:T,ArrayBuffer:B,SharedArrayBuffer:V}=globalThis;D.TYPED_ARRAY_SUPPORT=J(),!D.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function J(){try{const c=new T(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,T.prototype),Object.setPrototypeOf(c,g),c.foo()===42}catch(c){return!1}}Object.defineProperty(D.prototype,"parent",{enumerable:!0,get:function(){if(D.isBuffer(this))return this.buffer}}),Object.defineProperty(D.prototype,"offset",{enumerable:!0,get:function(){if(D.isBuffer(this))return this.byteOffset}});function F(c){if(c>x)throw new RangeError('The value "'+c+'" is invalid for option "size"');const g=new T(c);return Object.setPrototypeOf(g,D.prototype),g}function D(c,g,N){if(typeof c=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return oe(c)}return j(c,g,N)}D.poolSize=8192;function j(c,g,N){if(typeof c=="string")return ne(c,g);if(B.isView(c))return ie(c);if(c==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof c);if(Is(c,B)||c&&Is(c.buffer,B)||typeof V<"u"&&(Is(c,V)||c&&Is(c.buffer,V)))return re(c,g,N);if(typeof c=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const R=c.valueOf&&c.valueOf();if(R!=null&&R!==c)return D.from(R,g,N);const K=se(c);if(K)return K;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof c[Symbol.toPrimitive]=="function")return D.from(c[Symbol.toPrimitive]("string"),g,N);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof c)}D.from=function(c,g,N){return j(c,g,N)},Object.setPrototypeOf(D.prototype,T.prototype),Object.setPrototypeOf(D,T);function te(c){if(typeof c!="number")throw new TypeError('"size" argument must be of type number');if(c<0)throw new RangeError('The value "'+c+'" is invalid for option "size"')}function Y(c,g,N){return te(c),c<=0?F(c):g!==void 0?typeof N=="string"?F(c).fill(g,N):F(c).fill(g):F(c)}D.alloc=function(c,g,N){return Y(c,g,N)};function oe(c){return te(c),F(c<0?0:ee(c)|0)}D.allocUnsafe=function(c){return oe(c)},D.allocUnsafeSlow=function(c){return oe(c)};function ne(c,g){if((typeof g!="string"||g==="")&&(g="utf8"),!D.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const N=pe(c,g)|0;let R=F(N);const K=R.write(c,g);return K!==N&&(R=R.slice(0,K)),R}function de(c){const g=c.length<0?0:ee(c.length)|0,N=F(g);for(let R=0;R<g;R+=1)N[R]=c[R]&255;return N}function ie(c){if(Is(c,T)){const g=new T(c);return re(g.buffer,g.byteOffset,g.byteLength)}return de(c)}function re(c,g,N){if(g<0||c.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(c.byteLength<g+(N||0))throw new RangeError('"length" is outside of buffer bounds');let R;return g===void 0&&N===void 0?R=new T(c):N===void 0?R=new T(c,g):R=new T(c,g,N),Object.setPrototypeOf(R,D.prototype),R}function se(c){if(D.isBuffer(c)){const g=ee(c.length)|0,N=F(g);return N.length===0||c.copy(N,0,0,g),N}if(c.length!==void 0)return typeof c.length!="number"||Nm(c.length)?F(0):de(c);if(c.type==="Buffer"&&Array.isArray(c.data))return de(c.data)}function ee(c){if(c>=x)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+x.toString(16)+" bytes");return c|0}function ce(c){return+c!=c&&(c=0),D.alloc(+c)}D.isBuffer=function(c){return c!=null&&c._isBuffer===!0&&c!==D.prototype},D.compare=function(c,g){if(Is(c,T)&&(c=D.from(c,c.offset,c.byteLength)),Is(g,T)&&(g=D.from(g,g.offset,g.byteLength)),!D.isBuffer(c)||!D.isBuffer(g))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(c===g)return 0;let N=c.length,R=g.length;for(let K=0,W=Math.min(N,R);K<W;++K)if(c[K]!==g[K]){N=c[K],R=g[K];break}return N<R?-1:R<N?1:0},D.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},D.concat=function(c,g){if(!Array.isArray(c))throw new TypeError('"list" argument must be an Array of Buffers');if(c.length===0)return D.alloc(0);let N;if(g===void 0)for(g=0,N=0;N<c.length;++N)g+=c[N].length;const R=D.allocUnsafe(g);let K=0;for(N=0;N<c.length;++N){let W=c[N];if(Is(W,T))K+W.length>R.length?(D.isBuffer(W)||(W=D.from(W)),W.copy(R,K)):T.prototype.set.call(R,W,K);else if(D.isBuffer(W))W.copy(R,K);else throw new TypeError('"list" argument must be an Array of Buffers');K+=W.length}return R};function pe(c,g){if(D.isBuffer(c))return c.length;if(B.isView(c)||Is(c,B))return c.byteLength;if(typeof c!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof c);const N=c.length,R=arguments.length>2&&arguments[2]===!0;if(!R&&N===0)return 0;let K=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return N;case"utf8":case"utf-8":return Am(c).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N*2;case"hex":return N>>>1;case"base64":return Zp(c).length;default:if(K)return R?-1:Am(c).length;g=(""+g).toLowerCase(),K=!0}}D.byteLength=pe;function Ce(c,g,N){let R=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((N===void 0||N>this.length)&&(N=this.length),N<=0)||(N>>>=0,g>>>=0,N<=g))return"";for(c||(c="utf8");;)switch(c){case"hex":return Oc(this,g,N);case"utf8":case"utf-8":return bt(this,g,N);case"ascii":return ps(this,g,N);case"latin1":case"binary":return bm(this,g,N);case"base64":return Et(this,g,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Yo(this,g,N);default:if(R)throw new TypeError("Unknown encoding: "+c);c=(c+"").toLowerCase(),R=!0}}D.prototype._isBuffer=!0;function Fe(c,g,N){const R=c[g];c[g]=c[N],c[N]=R}D.prototype.swap16=function(){const c=this.length;if(c%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let g=0;g<c;g+=2)Fe(this,g,g+1);return this},D.prototype.swap32=function(){const c=this.length;if(c%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let g=0;g<c;g+=4)Fe(this,g,g+3),Fe(this,g+1,g+2);return this},D.prototype.swap64=function(){const c=this.length;if(c%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let g=0;g<c;g+=8)Fe(this,g,g+7),Fe(this,g+1,g+6),Fe(this,g+2,g+5),Fe(this,g+3,g+4);return this},D.prototype.toString=function(){const c=this.length;return c===0?"":arguments.length===0?bt(this,0,c):Ce.apply(this,arguments)},D.prototype.toLocaleString=D.prototype.toString,D.prototype.equals=function(c){if(!D.isBuffer(c))throw new TypeError("Argument must be a Buffer");return this===c?!0:D.compare(this,c)===0},D.prototype.inspect=function(){let c="";const g=p.INSPECT_MAX_BYTES;return c=this.toString("hex",0,g).replace(/(.{2})/g,"$1 ").trim(),this.length>g&&(c+=" ... "),"<Buffer "+c+">"},P&&(D.prototype[P]=D.prototype.inspect),D.prototype.compare=function(c,g,N,R,K){if(Is(c,T)&&(c=D.from(c,c.offset,c.byteLength)),!D.isBuffer(c))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof c);if(g===void 0&&(g=0),N===void 0&&(N=c?c.length:0),R===void 0&&(R=0),K===void 0&&(K=this.length),g<0||N>c.length||R<0||K>this.length)throw new RangeError("out of range index");if(R>=K&&g>=N)return 0;if(R>=K)return-1;if(g>=N)return 1;if(g>>>=0,N>>>=0,R>>>=0,K>>>=0,this===c)return 0;let W=K-R,Q=N-g;const Pe=Math.min(W,Q),St=this.slice(R,K),De=c.slice(g,N);for(let xe=0;xe<Pe;++xe)if(St[xe]!==De[xe]){W=St[xe],Q=De[xe];break}return W<Q?-1:Q<W?1:0};function C(c,g,N,R,K){if(c.length===0)return-1;if(typeof N=="string"?(R=N,N=0):N>2147483647?N=2147483647:N<-2147483648&&(N=-2147483648),N=+N,Nm(N)&&(N=K?0:c.length-1),N<0&&(N=c.length+N),N>=c.length){if(K)return-1;N=c.length-1}else if(N<0)if(K)N=0;else return-1;if(typeof g=="string"&&(g=D.from(g,R)),D.isBuffer(g))return g.length===0?-1:A(c,g,N,R,K);if(typeof g=="number")return g=g&255,typeof T.prototype.indexOf=="function"?K?T.prototype.indexOf.call(c,g,N):T.prototype.lastIndexOf.call(c,g,N):A(c,[g],N,R,K);throw new TypeError("val must be string, number or Buffer")}function A(c,g,N,R,K){let W=1,Q=c.length,Pe=g.length;if(R!==void 0&&(R=String(R).toLowerCase(),R==="ucs2"||R==="ucs-2"||R==="utf16le"||R==="utf-16le")){if(c.length<2||g.length<2)return-1;W=2,Q/=2,Pe/=2,N/=2}function St(xe,et){return W===1?xe[et]:xe.readUInt16BE(et*W)}let De;if(K){let xe=-1;for(De=N;De<Q;De++)if(St(c,De)===St(g,xe===-1?0:De-xe)){if(xe===-1&&(xe=De),De-xe+1===Pe)return xe*W}else xe!==-1&&(De-=De-xe),xe=-1}else for(N+Pe>Q&&(N=Q-Pe),De=N;De>=0;De--){let xe=!0;for(let et=0;et<Pe;et++)if(St(c,De+et)!==St(g,et)){xe=!1;break}if(xe)return De}return-1}D.prototype.includes=function(c,g,N){return this.indexOf(c,g,N)!==-1},D.prototype.indexOf=function(c,g,N){return C(this,c,g,N,!0)},D.prototype.lastIndexOf=function(c,g,N){return C(this,c,g,N,!1)};function $(c,g,N,R){N=Number(N)||0;const K=c.length-N;R?(R=Number(R),R>K&&(R=K)):R=K;const W=g.length;R>W/2&&(R=W/2);let Q;for(Q=0;Q<R;++Q){const Pe=parseInt(g.substr(Q*2,2),16);if(Nm(Pe))return Q;c[N+Q]=Pe}return Q}function U(c,g,N,R){return Pc(Am(g,c.length-N),c,N,R)}function ge(c,g,N,R){return Pc(qw(g),c,N,R)}function ke(c,g,N,R){return Pc(Zp(g),c,N,R)}function he(c,g,N,R){return Pc(Ww(g,c.length-N),c,N,R)}D.prototype.write=function(c,g,N,R){if(g===void 0)R="utf8",N=this.length,g=0;else if(N===void 0&&typeof g=="string")R=g,N=this.length,g=0;else if(isFinite(g))g=g>>>0,isFinite(N)?(N=N>>>0,R===void 0&&(R="utf8")):(R=N,N=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const K=this.length-g;if((N===void 0||N>K)&&(N=K),c.length>0&&(N<0||g<0)||g>this.length)throw new RangeError("Attempt to write outside buffer bounds");R||(R="utf8");let W=!1;for(;;)switch(R){case"hex":return $(this,c,g,N);case"utf8":case"utf-8":return U(this,c,g,N);case"ascii":case"latin1":case"binary":return ge(this,c,g,N);case"base64":return ke(this,c,g,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return he(this,c,g,N);default:if(W)throw new TypeError("Unknown encoding: "+R);R=(""+R).toLowerCase(),W=!0}},D.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Et(c,g,N){return g===0&&N===c.length?b.fromByteArray(c):b.fromByteArray(c.slice(g,N))}function bt(c,g,N){N=Math.min(c.length,N);const R=[];let K=g;for(;K<N;){const W=c[K];let Q=null,Pe=W>239?4:W>223?3:W>191?2:1;if(K+Pe<=N){let St,De,xe,et;switch(Pe){case 1:W<128&&(Q=W);break;case 2:St=c[K+1],(St&192)===128&&(et=(W&31)<<6|St&63,et>127&&(Q=et));break;case 3:St=c[K+1],De=c[K+2],(St&192)===128&&(De&192)===128&&(et=(W&15)<<12|(St&63)<<6|De&63,et>2047&&(et<55296||et>57343)&&(Q=et));break;case 4:St=c[K+1],De=c[K+2],xe=c[K+3],(St&192)===128&&(De&192)===128&&(xe&192)===128&&(et=(W&15)<<18|(St&63)<<12|(De&63)<<6|xe&63,et>65535&&et<1114112&&(Q=et))}}Q===null?(Q=65533,Pe=1):Q>65535&&(Q-=65536,R.push(Q>>>10&1023|55296),Q=56320|Q&1023),R.push(Q),K+=Pe}return ot(R)}const Ls=4096;function ot(c){const g=c.length;if(g<=Ls)return String.fromCharCode.apply(String,c);let N="",R=0;for(;R<g;)N+=String.fromCharCode.apply(String,c.slice(R,R+=Ls));return N}function ps(c,g,N){let R="";N=Math.min(c.length,N);for(let K=g;K<N;++K)R+=String.fromCharCode(c[K]&127);return R}function bm(c,g,N){let R="";N=Math.min(c.length,N);for(let K=g;K<N;++K)R+=String.fromCharCode(c[K]);return R}function Oc(c,g,N){const R=c.length;(!g||g<0)&&(g=0),(!N||N<0||N>R)&&(N=R);let K="";for(let W=g;W<N;++W)K+=_w[c[W]];return K}function Yo(c,g,N){const R=c.slice(g,N);let K="";for(let W=0;W<R.length-1;W+=2)K+=String.fromCharCode(R[W]+R[W+1]*256);return K}D.prototype.slice=function(c,g){const N=this.length;c=~~c,g=g===void 0?N:~~g,c<0?(c+=N,c<0&&(c=0)):c>N&&(c=N),g<0?(g+=N,g<0&&(g=0)):g>N&&(g=N),g<c&&(g=c);const R=this.subarray(c,g);return Object.setPrototypeOf(R,D.prototype),R};function Je(c,g,N){if(c%1!==0||c<0)throw new RangeError("offset is not uint");if(c+g>N)throw new RangeError("Trying to access beyond buffer length")}D.prototype.readUintLE=D.prototype.readUIntLE=function(c,g,N){c=c>>>0,g=g>>>0,N||Je(c,g,this.length);let R=this[c],K=1,W=0;for(;++W<g&&(K*=256);)R+=this[c+W]*K;return R},D.prototype.readUintBE=D.prototype.readUIntBE=function(c,g,N){c=c>>>0,g=g>>>0,N||Je(c,g,this.length);let R=this[c+--g],K=1;for(;g>0&&(K*=256);)R+=this[c+--g]*K;return R},D.prototype.readUint8=D.prototype.readUInt8=function(c,g){return c=c>>>0,g||Je(c,1,this.length),this[c]},D.prototype.readUint16LE=D.prototype.readUInt16LE=function(c,g){return c=c>>>0,g||Je(c,2,this.length),this[c]|this[c+1]<<8},D.prototype.readUint16BE=D.prototype.readUInt16BE=function(c,g){return c=c>>>0,g||Je(c,2,this.length),this[c]<<8|this[c+1]},D.prototype.readUint32LE=D.prototype.readUInt32LE=function(c,g){return c=c>>>0,g||Je(c,4,this.length),(this[c]|this[c+1]<<8|this[c+2]<<16)+this[c+3]*16777216},D.prototype.readUint32BE=D.prototype.readUInt32BE=function(c,g){return c=c>>>0,g||Je(c,4,this.length),this[c]*16777216+(this[c+1]<<16|this[c+2]<<8|this[c+3])},D.prototype.readBigUInt64LE=mr(function(c){c=c>>>0,ri(c,"offset");const g=this[c],N=this[c+7];(g===void 0||N===void 0)&&Qo(c,this.length-8);const R=g+this[++c]*2**8+this[++c]*2**16+this[++c]*2**24,K=this[++c]+this[++c]*2**8+this[++c]*2**16+N*2**24;return BigInt(R)+(BigInt(K)<<BigInt(32))}),D.prototype.readBigUInt64BE=mr(function(c){c=c>>>0,ri(c,"offset");const g=this[c],N=this[c+7];(g===void 0||N===void 0)&&Qo(c,this.length-8);const R=g*2**24+this[++c]*2**16+this[++c]*2**8+this[++c],K=this[++c]*2**24+this[++c]*2**16+this[++c]*2**8+N;return(BigInt(R)<<BigInt(32))+BigInt(K)}),D.prototype.readIntLE=function(c,g,N){c=c>>>0,g=g>>>0,N||Je(c,g,this.length);let R=this[c],K=1,W=0;for(;++W<g&&(K*=256);)R+=this[c+W]*K;return K*=128,R>=K&&(R-=Math.pow(2,8*g)),R},D.prototype.readIntBE=function(c,g,N){c=c>>>0,g=g>>>0,N||Je(c,g,this.length);let R=g,K=1,W=this[c+--R];for(;R>0&&(K*=256);)W+=this[c+--R]*K;return K*=128,W>=K&&(W-=Math.pow(2,8*g)),W},D.prototype.readInt8=function(c,g){return c=c>>>0,g||Je(c,1,this.length),this[c]&128?(255-this[c]+1)*-1:this[c]},D.prototype.readInt16LE=function(c,g){c=c>>>0,g||Je(c,2,this.length);const N=this[c]|this[c+1]<<8;return N&32768?N|4294901760:N},D.prototype.readInt16BE=function(c,g){c=c>>>0,g||Je(c,2,this.length);const N=this[c+1]|this[c]<<8;return N&32768?N|4294901760:N},D.prototype.readInt32LE=function(c,g){return c=c>>>0,g||Je(c,4,this.length),this[c]|this[c+1]<<8|this[c+2]<<16|this[c+3]<<24},D.prototype.readInt32BE=function(c,g){return c=c>>>0,g||Je(c,4,this.length),this[c]<<24|this[c+1]<<16|this[c+2]<<8|this[c+3]},D.prototype.readBigInt64LE=mr(function(c){c=c>>>0,ri(c,"offset");const g=this[c],N=this[c+7];(g===void 0||N===void 0)&&Qo(c,this.length-8);const R=this[c+4]+this[c+5]*2**8+this[c+6]*2**16+(N<<24);return(BigInt(R)<<BigInt(32))+BigInt(g+this[++c]*2**8+this[++c]*2**16+this[++c]*2**24)}),D.prototype.readBigInt64BE=mr(function(c){c=c>>>0,ri(c,"offset");const g=this[c],N=this[c+7];(g===void 0||N===void 0)&&Qo(c,this.length-8);const R=(g<<24)+this[++c]*2**16+this[++c]*2**8+this[++c];return(BigInt(R)<<BigInt(32))+BigInt(this[++c]*2**24+this[++c]*2**16+this[++c]*2**8+N)}),D.prototype.readFloatLE=function(c,g){return c=c>>>0,g||Je(c,4,this.length),I.read(this,c,!0,23,4)},D.prototype.readFloatBE=function(c,g){return c=c>>>0,g||Je(c,4,this.length),I.read(this,c,!1,23,4)},D.prototype.readDoubleLE=function(c,g){return c=c>>>0,g||Je(c,8,this.length),I.read(this,c,!0,52,8)},D.prototype.readDoubleBE=function(c,g){return c=c>>>0,g||Je(c,8,this.length),I.read(this,c,!1,52,8)};function Ft(c,g,N,R,K,W){if(!D.isBuffer(c))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>K||g<W)throw new RangeError('"value" argument is out of bounds');if(N+R>c.length)throw new RangeError("Index out of range")}D.prototype.writeUintLE=D.prototype.writeUIntLE=function(c,g,N,R){if(c=+c,g=g>>>0,N=N>>>0,!R){const Q=Math.pow(2,8*N)-1;Ft(this,c,g,N,Q,0)}let K=1,W=0;for(this[g]=c&255;++W<N&&(K*=256);)this[g+W]=c/K&255;return g+N},D.prototype.writeUintBE=D.prototype.writeUIntBE=function(c,g,N,R){if(c=+c,g=g>>>0,N=N>>>0,!R){const Q=Math.pow(2,8*N)-1;Ft(this,c,g,N,Q,0)}let K=N-1,W=1;for(this[g+K]=c&255;--K>=0&&(W*=256);)this[g+K]=c/W&255;return g+N},D.prototype.writeUint8=D.prototype.writeUInt8=function(c,g,N){return c=+c,g=g>>>0,N||Ft(this,c,g,1,255,0),this[g]=c&255,g+1},D.prototype.writeUint16LE=D.prototype.writeUInt16LE=function(c,g,N){return c=+c,g=g>>>0,N||Ft(this,c,g,2,65535,0),this[g]=c&255,this[g+1]=c>>>8,g+2},D.prototype.writeUint16BE=D.prototype.writeUInt16BE=function(c,g,N){return c=+c,g=g>>>0,N||Ft(this,c,g,2,65535,0),this[g]=c>>>8,this[g+1]=c&255,g+2},D.prototype.writeUint32LE=D.prototype.writeUInt32LE=function(c,g,N){return c=+c,g=g>>>0,N||Ft(this,c,g,4,4294967295,0),this[g+3]=c>>>24,this[g+2]=c>>>16,this[g+1]=c>>>8,this[g]=c&255,g+4},D.prototype.writeUint32BE=D.prototype.writeUInt32BE=function(c,g,N){return c=+c,g=g>>>0,N||Ft(this,c,g,4,4294967295,0),this[g]=c>>>24,this[g+1]=c>>>16,this[g+2]=c>>>8,this[g+3]=c&255,g+4};function Wp(c,g,N,R,K){Qp(g,R,K,c,N,7);let W=Number(g&BigInt(4294967295));c[N++]=W,W=W>>8,c[N++]=W,W=W>>8,c[N++]=W,W=W>>8,c[N++]=W;let Q=Number(g>>BigInt(32)&BigInt(4294967295));return c[N++]=Q,Q=Q>>8,c[N++]=Q,Q=Q>>8,c[N++]=Q,Q=Q>>8,c[N++]=Q,N}function _p(c,g,N,R,K){Qp(g,R,K,c,N,7);let W=Number(g&BigInt(4294967295));c[N+7]=W,W=W>>8,c[N+6]=W,W=W>>8,c[N+5]=W,W=W>>8,c[N+4]=W;let Q=Number(g>>BigInt(32)&BigInt(4294967295));return c[N+3]=Q,Q=Q>>8,c[N+2]=Q,Q=Q>>8,c[N+1]=Q,Q=Q>>8,c[N]=Q,N+8}D.prototype.writeBigUInt64LE=mr(function(c,g=0){return Wp(this,c,g,BigInt(0),BigInt("0xffffffffffffffff"))}),D.prototype.writeBigUInt64BE=mr(function(c,g=0){return _p(this,c,g,BigInt(0),BigInt("0xffffffffffffffff"))}),D.prototype.writeIntLE=function(c,g,N,R){if(c=+c,g=g>>>0,!R){const Pe=Math.pow(2,8*N-1);Ft(this,c,g,N,Pe-1,-Pe)}let K=0,W=1,Q=0;for(this[g]=c&255;++K<N&&(W*=256);)c<0&&Q===0&&this[g+K-1]!==0&&(Q=1),this[g+K]=(c/W>>0)-Q&255;return g+N},D.prototype.writeIntBE=function(c,g,N,R){if(c=+c,g=g>>>0,!R){const Pe=Math.pow(2,8*N-1);Ft(this,c,g,N,Pe-1,-Pe)}let K=N-1,W=1,Q=0;for(this[g+K]=c&255;--K>=0&&(W*=256);)c<0&&Q===0&&this[g+K+1]!==0&&(Q=1),this[g+K]=(c/W>>0)-Q&255;return g+N},D.prototype.writeInt8=function(c,g,N){return c=+c,g=g>>>0,N||Ft(this,c,g,1,127,-128),c<0&&(c=255+c+1),this[g]=c&255,g+1},D.prototype.writeInt16LE=function(c,g,N){return c=+c,g=g>>>0,N||Ft(this,c,g,2,32767,-32768),this[g]=c&255,this[g+1]=c>>>8,g+2},D.prototype.writeInt16BE=function(c,g,N){return c=+c,g=g>>>0,N||Ft(this,c,g,2,32767,-32768),this[g]=c>>>8,this[g+1]=c&255,g+2},D.prototype.writeInt32LE=function(c,g,N){return c=+c,g=g>>>0,N||Ft(this,c,g,4,2147483647,-2147483648),this[g]=c&255,this[g+1]=c>>>8,this[g+2]=c>>>16,this[g+3]=c>>>24,g+4},D.prototype.writeInt32BE=function(c,g,N){return c=+c,g=g>>>0,N||Ft(this,c,g,4,2147483647,-2147483648),c<0&&(c=4294967295+c+1),this[g]=c>>>24,this[g+1]=c>>>16,this[g+2]=c>>>8,this[g+3]=c&255,g+4},D.prototype.writeBigInt64LE=mr(function(c,g=0){return Wp(this,c,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),D.prototype.writeBigInt64BE=mr(function(c,g=0){return _p(this,c,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Gp(c,g,N,R,K,W){if(N+R>c.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("Index out of range")}function zp(c,g,N,R,K){return g=+g,N=N>>>0,K||Gp(c,g,N,4),I.write(c,g,N,R,23,4),N+4}D.prototype.writeFloatLE=function(c,g,N){return zp(this,c,g,!0,N)},D.prototype.writeFloatBE=function(c,g,N){return zp(this,c,g,!1,N)};function Xp(c,g,N,R,K){return g=+g,N=N>>>0,K||Gp(c,g,N,8),I.write(c,g,N,R,52,8),N+8}D.prototype.writeDoubleLE=function(c,g,N){return Xp(this,c,g,!0,N)},D.prototype.writeDoubleBE=function(c,g,N){return Xp(this,c,g,!1,N)},D.prototype.copy=function(c,g,N,R){if(!D.isBuffer(c))throw new TypeError("argument should be a Buffer");if(N||(N=0),!R&&R!==0&&(R=this.length),g>=c.length&&(g=c.length),g||(g=0),R>0&&R<N&&(R=N),R===N||c.length===0||this.length===0)return 0;if(g<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("Index out of range");if(R<0)throw new RangeError("sourceEnd out of bounds");R>this.length&&(R=this.length),c.length-g<R-N&&(R=c.length-g+N);const K=R-N;return this===c&&typeof T.prototype.copyWithin=="function"?this.copyWithin(g,N,R):T.prototype.set.call(c,this.subarray(N,R),g),K},D.prototype.fill=function(c,g,N,R){if(typeof c=="string"){if(typeof g=="string"?(R=g,g=0,N=this.length):typeof N=="string"&&(R=N,N=this.length),R!==void 0&&typeof R!="string")throw new TypeError("encoding must be a string");if(typeof R=="string"&&!D.isEncoding(R))throw new TypeError("Unknown encoding: "+R);if(c.length===1){const W=c.charCodeAt(0);(R==="utf8"&&W<128||R==="latin1")&&(c=W)}}else typeof c=="number"?c=c&255:typeof c=="boolean"&&(c=Number(c));if(g<0||this.length<g||this.length<N)throw new RangeError("Out of range index");if(N<=g)return this;g=g>>>0,N=N===void 0?this.length:N>>>0,c||(c=0);let K;if(typeof c=="number")for(K=g;K<N;++K)this[K]=c;else{const W=D.isBuffer(c)?c:D.from(c,R),Q=W.length;if(Q===0)throw new TypeError('The value "'+c+'" is invalid for argument "value"');for(K=0;K<N-g;++K)this[K+g]=W[K%Q]}return this};const si={};function Sm(c,g,N){si[c]=class extends N{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name="".concat(this.name," [").concat(c,"]"),this.stack,delete this.name}get code(){return c}set code(R){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:R,writable:!0})}toString(){return"".concat(this.name," [").concat(c,"]: ").concat(this.message)}}}Sm("ERR_BUFFER_OUT_OF_BOUNDS",function(c){return c?"".concat(c," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"},RangeError),Sm("ERR_INVALID_ARG_TYPE",function(c,g){return'The "'.concat(c,'" argument must be of type number. Received type ').concat(typeof g)},TypeError),Sm("ERR_OUT_OF_RANGE",function(c,g,N){let R='The value of "'.concat(c,'" is out of range.'),K=N;return Number.isInteger(N)&&Math.abs(N)>2**32?K=Yp(String(N)):typeof N=="bigint"&&(K=String(N),(N>BigInt(2)**BigInt(32)||N<-(BigInt(2)**BigInt(32)))&&(K=Yp(K)),K+="n"),R+=" It must be ".concat(g,". Received ").concat(K),R},RangeError);function Yp(c){let g="",N=c.length;const R=c[0]==="-"?1:0;for(;N>=R+4;N-=3)g="_".concat(c.slice(N-3,N)).concat(g);return"".concat(c.slice(0,N)).concat(g)}function Hw(c,g,N){ri(g,"offset"),(c[g]===void 0||c[g+N]===void 0)&&Qo(g,c.length-(N+1))}function Qp(c,g,N,R,K,W){if(c>N||c<g){const Q=typeof g=="bigint"?"n":"";let Pe;throw g===0||g===BigInt(0)?Pe=">= 0".concat(Q," and < 2").concat(Q," ** ").concat((W+1)*8).concat(Q):Pe=">= -(2".concat(Q," ** ").concat((W+1)*8-1).concat(Q,") and < 2 ** ").concat((W+1)*8-1).concat(Q),new si.ERR_OUT_OF_RANGE("value",Pe,c)}Hw(R,K,W)}function ri(c,g){if(typeof c!="number")throw new si.ERR_INVALID_ARG_TYPE(g,"number",c)}function Qo(c,g,N){throw Math.floor(c)!==c?(ri(c,N),new si.ERR_OUT_OF_RANGE("offset","an integer",c)):g<0?new si.ERR_BUFFER_OUT_OF_BOUNDS:new si.ERR_OUT_OF_RANGE("offset",">= 0 and <= ".concat(g),c)}const Fw=/[^+/0-9A-Za-z-_]/g;function Jw(c){if(c=c.split("=")[0],c=c.trim().replace(Fw,""),c.length<2)return"";for(;c.length%4!==0;)c=c+"=";return c}function Am(c,g){g=g||1/0;let N;const R=c.length;let K=null;const W=[];for(let Q=0;Q<R;++Q){if(N=c.charCodeAt(Q),N>55295&&N<57344){if(!K){if(N>56319){(g-=3)>-1&&W.push(239,191,189);continue}else if(Q+1===R){(g-=3)>-1&&W.push(239,191,189);continue}K=N;continue}if(N<56320){(g-=3)>-1&&W.push(239,191,189),K=N;continue}N=(K-55296<<10|N-56320)+65536}else K&&(g-=3)>-1&&W.push(239,191,189);if(K=null,N<128){if((g-=1)<0)break;W.push(N)}else if(N<2048){if((g-=2)<0)break;W.push(N>>6|192,N&63|128)}else if(N<65536){if((g-=3)<0)break;W.push(N>>12|224,N>>6&63|128,N&63|128)}else if(N<1114112){if((g-=4)<0)break;W.push(N>>18|240,N>>12&63|128,N>>6&63|128,N&63|128)}else throw new Error("Invalid code point")}return W}function qw(c){const g=[];for(let N=0;N<c.length;++N)g.push(c.charCodeAt(N)&255);return g}function Ww(c,g){let N,R,K;const W=[];for(let Q=0;Q<c.length&&!((g-=2)<0);++Q)N=c.charCodeAt(Q),R=N>>8,K=N%256,W.push(K),W.push(R);return W}function Zp(c){return b.toByteArray(Jw(c))}function Pc(c,g,N,R){let K;for(K=0;K<R&&!(K+N>=g.length||K>=c.length);++K)g[K+N]=c[K];return K}function Is(c,g){return c instanceof g||c!=null&&c.constructor!=null&&c.constructor.name!=null&&c.constructor.name===g.name}function Nm(c){return c!==c}const _w=function(){const c="0123456789abcdef",g=new Array(256);for(let N=0;N<16;++N){const R=N*16;for(let K=0;K<16;++K)g[R+K]=c[N]+c[K]}return g}();function mr(c){return typeof BigInt>"u"?Gw:c}function Gw(){throw new Error("BigInt not supported")}}(e);const k=e.Buffer;r.Blob=e.Blob,r.BlobOptions=e.BlobOptions,r.Buffer=e.Buffer,r.File=e.File,r.FileOptions=e.FileOptions,r.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,r.SlowBuffer=e.SlowBuffer,r.TranscodeEncoding=e.TranscodeEncoding,r.atob=e.atob,r.btoa=e.btoa,r.constants=e.constants,r.default=k,r.isAscii=e.isAscii,r.isUtf8=e.isUtf8,r.kMaxLength=e.kMaxLength,r.kStringMaxLength=e.kStringMaxLength,r.resolveObjectURL=e.resolveObjectURL,r.transcode=e.transcode}(xd)),xd}var Od;function u1(){return Od||(Od=1,function(r,e){var t=o1(),s=t.Buffer;function a(i,o){for(var h in i)o[h]=i[h]}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?r.exports=t:(a(t,e),e.Buffer=n);function n(i,o,h){return s(i,o,h)}n.prototype=Object.create(s.prototype),a(s,n),n.from=function(i,o,h){if(typeof i=="number")throw new TypeError("Argument must not be a number");return s(i,o,h)},n.alloc=function(i,o,h){if(typeof i!="number")throw new TypeError("Argument must be a number");var u=s(i);return o!==void 0?typeof h=="string"?u.fill(o,h):u.fill(o):u.fill(0),u},n.allocUnsafe=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return s(i)},n.allocUnsafeSlow=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(i)}}($m,$m.exports)),$m.exports}var Pd;function l1(){if(Pd)return jm;Pd=1;var r=u1().Buffer,e=r.isEncoding||function(k){switch(k=""+k,k&&k.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(k){if(!k)return"utf8";for(var p;;)switch(k){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return k;default:if(p)return;k=(""+k).toLowerCase(),p=!0}}function s(k){var p=t(k);if(typeof p!="string"&&(r.isEncoding===e||!e(k)))throw new Error("Unknown encoding: "+k);return p||k}jm.StringDecoder=a;function a(k){this.encoding=s(k);var p;switch(this.encoding){case"utf16le":this.text=f,this.end=m,p=4;break;case"utf8":this.fillLast=h,p=4;break;case"base64":this.text=v,this.end=w,p=3;break;default:this.write=S,this.end=y;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(p)}a.prototype.write=function(k){if(k.length===0)return"";var p,b;if(this.lastNeed){if(p=this.fillLast(k),p===void 0)return"";b=this.lastNeed,this.lastNeed=0}else b=0;return b<k.length?p?p+this.text(k,b):this.text(k,b):p||""},a.prototype.end=l,a.prototype.text=u,a.prototype.fillLast=function(k){if(this.lastNeed<=k.length)return k.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);k.copy(this.lastChar,this.lastTotal-this.lastNeed,0,k.length),this.lastNeed-=k.length};function n(k){return k<=127?0:k>>5===6?2:k>>4===14?3:k>>3===30?4:k>>6===2?-1:-2}function i(k,p,b){var I=p.length-1;if(I<b)return 0;var P=n(p[I]);return P>=0?(P>0&&(k.lastNeed=P-1),P):--I<b||P===-2?0:(P=n(p[I]),P>=0?(P>0&&(k.lastNeed=P-2),P):--I<b||P===-2?0:(P=n(p[I]),P>=0?(P>0&&(P===2?P=0:k.lastNeed=P-3),P):0))}function o(k,p,b){if((p[0]&192)!==128)return k.lastNeed=0,"�";if(k.lastNeed>1&&p.length>1){if((p[1]&192)!==128)return k.lastNeed=1,"�";if(k.lastNeed>2&&p.length>2&&(p[2]&192)!==128)return k.lastNeed=2,"�"}}function h(k){var p=this.lastTotal-this.lastNeed,b=o(this,k);if(b!==void 0)return b;if(this.lastNeed<=k.length)return k.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);k.copy(this.lastChar,p,0,k.length),this.lastNeed-=k.length}function u(k,p){var b=i(this,k,p);if(!this.lastNeed)return k.toString("utf8",p);this.lastTotal=b;var I=k.length-(b-this.lastNeed);return k.copy(this.lastChar,0,I),k.toString("utf8",p,I)}function l(k){var p=k&&k.length?this.write(k):"";return this.lastNeed?p+"�":p}function f(k,p){if((k.length-p)%2===0){var b=k.toString("utf16le",p);if(b){var I=b.charCodeAt(b.length-1);if(I>=55296&&I<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=k[k.length-2],this.lastChar[1]=k[k.length-1],b.slice(0,-1)}return b}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=k[k.length-1],k.toString("utf16le",p,k.length-1)}function m(k){var p=k&&k.length?this.write(k):"";if(this.lastNeed){var b=this.lastTotal-this.lastNeed;return p+this.lastChar.toString("utf16le",0,b)}return p}function v(k,p){var b=(k.length-p)%3;return b===0?k.toString("base64",p):(this.lastNeed=3-b,this.lastTotal=3,b===1?this.lastChar[0]=k[k.length-1]:(this.lastChar[0]=k[k.length-2],this.lastChar[1]=k[k.length-1]),k.toString("base64",p,k.length-b))}function w(k){var p=k&&k.length?this.write(k):"";return this.lastNeed?p+this.lastChar.toString("base64",0,3-this.lastNeed):p}function S(k){return k.toString(this.encoding)}function y(k){return k&&k.length?this.write(k):""}return jm}var c1=l1();const h1=ry(c1);var Km={},Ip=(r=>(r.DEFAULT="default",r.HIDDEN="hidden",r))(Ip||{});class m1{constructor(e){tt(this,"_action");this.validateAction(e),this._action=e}get id(){return this._action.id}get displayName(){return this._action.displayName}get title(){return this._action.title}get iconSvgInline(){return this._action.iconSvgInline}get enabled(){return this._action.enabled}get exec(){return this._action.exec}get execBatch(){return this._action.execBatch}get hotkey(){return this._action.hotkey}get order(){return this._action.order}get parent(){return this._action.parent}get default(){return this._action.default}get destructive(){return this._action.destructive}get inline(){return this._action.inline}get renderInline(){return this._action.renderInline}validateAction(e){if(!e.id||typeof e.id!="string")throw new Error("Invalid id");if(!e.displayName||typeof e.displayName!="function")throw new Error("Invalid displayName function");if("title"in e&&typeof e.title!="function")throw new Error("Invalid title function");if(!e.iconSvgInline||typeof e.iconSvgInline!="function")throw new Error("Invalid iconSvgInline function");if(!e.exec||typeof e.exec!="function")throw new Error("Invalid exec function");if("enabled"in e&&typeof e.enabled!="function")throw new Error("Invalid enabled function");if("execBatch"in e&&typeof e.execBatch!="function")throw new Error("Invalid execBatch function");if("order"in e&&typeof e.order!="number")throw new Error("Invalid order");if(e.destructive!==void 0&&typeof e.destructive!="boolean")throw new Error("Invalid destructive flag");if("parent"in e&&typeof e.parent!="string")throw new Error("Invalid parent");if(e.default&&!Object.values(Ip).includes(e.default))throw new Error("Invalid default");if("inline"in e&&typeof e.inline!="function")throw new Error("Invalid inline function");if("renderInline"in e&&typeof e.renderInline!="function")throw new Error("Invalid renderInline function");if("hotkey"in e&&e.hotkey!==void 0){if(typeof e.hotkey!="object")throw new Error("Invalid hotkey configuration");if(typeof e.hotkey.key!="string"||!e.hotkey.key)throw new Error("Missing or invalid hotkey key");if(typeof e.hotkey.description!="string"||!e.hotkey.description)throw new Error("Missing or invalid hotkey description")}}}const f1=function(r){if(typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],Lo.debug("FileActions initialized")),window._nc_fileactions.find(e=>e.id===r.id)){Lo.error("FileAction ".concat(r.id," already registered"),{action:r});return}window._nc_fileactions.push(r)},p1=function(){return typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],Lo.debug("FileActions initialized")),window._nc_fileactions};var Dd,Td;function uw(){return Td||(Td=1,Dd=typeof lt=="object"&&Km&&Km.NODE_DEBUG&&/\bsemver\b/i.test(Km.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{}),Dd}var Mm,Rd;function lw(){if(Rd)return Mm;Rd=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,s=16,a=e-6;return Mm={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Mm}var Hm={exports:{}},Ud;function d1(){return Ud||(Ud=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:a}=lw(),n=uw();e=r.exports={};const i=e.re=[],o=e.safeRe=[],h=e.src=[],u=e.t={};let l=0;const f="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",a],[f,s]],v=S=>{for(const[y,k]of m)S=S.split("".concat(y,"*")).join("".concat(y,"{0,").concat(k,"}")).split("".concat(y,"+")).join("".concat(y,"{1,").concat(k,"}"));return S},w=(S,y,k)=>{const p=v(y),b=l++;n(S,b,y),u[S]=b,h[b]=y,i[b]=new RegExp(y,k?"g":void 0),o[b]=new RegExp(p,k?"g":void 0)};w("NUMERICIDENTIFIER","0|[1-9]\\d*"),w("NUMERICIDENTIFIERLOOSE","\\d+"),w("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-]".concat(f,"*")),w("MAINVERSION","(".concat(h[u.NUMERICIDENTIFIER],")\\.(").concat(h[u.NUMERICIDENTIFIER],")\\.(").concat(h[u.NUMERICIDENTIFIER],")")),w("MAINVERSIONLOOSE","(".concat(h[u.NUMERICIDENTIFIERLOOSE],")\\.(").concat(h[u.NUMERICIDENTIFIERLOOSE],")\\.(").concat(h[u.NUMERICIDENTIFIERLOOSE],")")),w("PRERELEASEIDENTIFIER","(?:".concat(h[u.NUMERICIDENTIFIER],"|").concat(h[u.NONNUMERICIDENTIFIER],")")),w("PRERELEASEIDENTIFIERLOOSE","(?:".concat(h[u.NUMERICIDENTIFIERLOOSE],"|").concat(h[u.NONNUMERICIDENTIFIER],")")),w("PRERELEASE","(?:-(".concat(h[u.PRERELEASEIDENTIFIER],"(?:\\.").concat(h[u.PRERELEASEIDENTIFIER],")*))")),w("PRERELEASELOOSE","(?:-?(".concat(h[u.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(h[u.PRERELEASEIDENTIFIERLOOSE],")*))")),w("BUILDIDENTIFIER","".concat(f,"+")),w("BUILD","(?:\\+(".concat(h[u.BUILDIDENTIFIER],"(?:\\.").concat(h[u.BUILDIDENTIFIER],")*))")),w("FULLPLAIN","v?".concat(h[u.MAINVERSION]).concat(h[u.PRERELEASE],"?").concat(h[u.BUILD],"?")),w("FULL","^".concat(h[u.FULLPLAIN],"$")),w("LOOSEPLAIN","[v=\\s]*".concat(h[u.MAINVERSIONLOOSE]).concat(h[u.PRERELEASELOOSE],"?").concat(h[u.BUILD],"?")),w("LOOSE","^".concat(h[u.LOOSEPLAIN],"$")),w("GTLT","((?:<|>)?=?)"),w("XRANGEIDENTIFIERLOOSE","".concat(h[u.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),w("XRANGEIDENTIFIER","".concat(h[u.NUMERICIDENTIFIER],"|x|X|\\*")),w("XRANGEPLAIN","[v=\\s]*(".concat(h[u.XRANGEIDENTIFIER],")(?:\\.(").concat(h[u.XRANGEIDENTIFIER],")(?:\\.(").concat(h[u.XRANGEIDENTIFIER],")(?:").concat(h[u.PRERELEASE],")?").concat(h[u.BUILD],"?)?)?")),w("XRANGEPLAINLOOSE","[v=\\s]*(".concat(h[u.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(h[u.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(h[u.XRANGEIDENTIFIERLOOSE],")(?:").concat(h[u.PRERELEASELOOSE],")?").concat(h[u.BUILD],"?)?)?")),w("XRANGE","^".concat(h[u.GTLT],"\\s*").concat(h[u.XRANGEPLAIN],"$")),w("XRANGELOOSE","^".concat(h[u.GTLT],"\\s*").concat(h[u.XRANGEPLAINLOOSE],"$")),w("COERCEPLAIN","(^|[^\\d])(\\d{1,".concat(t,"})(?:\\.(\\d{1,").concat(t,"}))?(?:\\.(\\d{1,").concat(t,"}))?")),w("COERCE","".concat(h[u.COERCEPLAIN],"(?:$|[^\\d])")),w("COERCEFULL",h[u.COERCEPLAIN]+"(?:".concat(h[u.PRERELEASE],")?(?:").concat(h[u.BUILD],")?(?:$|[^\\d])")),w("COERCERTL",h[u.COERCE],!0),w("COERCERTLFULL",h[u.COERCEFULL],!0),w("LONETILDE","(?:~>?)"),w("TILDETRIM","(\\s*)".concat(h[u.LONETILDE],"\\s+"),!0),e.tildeTrimReplace="$1~",w("TILDE","^".concat(h[u.LONETILDE]).concat(h[u.XRANGEPLAIN],"$")),w("TILDELOOSE","^".concat(h[u.LONETILDE]).concat(h[u.XRANGEPLAINLOOSE],"$")),w("LONECARET","(?:\\^)"),w("CARETTRIM","(\\s*)".concat(h[u.LONECARET],"\\s+"),!0),e.caretTrimReplace="$1^",w("CARET","^".concat(h[u.LONECARET]).concat(h[u.XRANGEPLAIN],"$")),w("CARETLOOSE","^".concat(h[u.LONECARET]).concat(h[u.XRANGEPLAINLOOSE],"$")),w("COMPARATORLOOSE","^".concat(h[u.GTLT],"\\s*(").concat(h[u.LOOSEPLAIN],")$|^$")),w("COMPARATOR","^".concat(h[u.GTLT],"\\s*(").concat(h[u.FULLPLAIN],")$|^$")),w("COMPARATORTRIM","(\\s*)".concat(h[u.GTLT],"\\s*(").concat(h[u.LOOSEPLAIN],"|").concat(h[u.XRANGEPLAIN],")"),!0),e.comparatorTrimReplace="$1$2$3",w("HYPHENRANGE","^\\s*(".concat(h[u.XRANGEPLAIN],")\\s+-\\s+(").concat(h[u.XRANGEPLAIN],")\\s*$")),w("HYPHENRANGELOOSE","^\\s*(".concat(h[u.XRANGEPLAINLOOSE],")\\s+-\\s+(").concat(h[u.XRANGEPLAINLOOSE],")\\s*$")),w("STAR","(<|>)?=?\\s*\\*"),w("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),w("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Hm,Hm.exports)),Hm.exports}var Fm,Ld;function g1(){if(Ld)return Fm;Ld=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return Fm=t=>t?typeof t!="object"?r:t:e,Fm}var Jm,jd;function w1(){if(jd)return Jm;jd=1;const r=/^[0-9]+$/,e=(t,s)=>{const a=r.test(t),n=r.test(s);return a&&n&&(t=+t,s=+s),t===s?0:a&&!n?-1:n&&!a?1:t<s?-1:1};return Jm={compareIdentifiers:e,rcompareIdentifiers:(t,s)=>e(s,t)},Jm}var qm,$d;function cw(){if($d)return qm;$d=1;const r=uw(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=lw(),{safeRe:s,t:a}=d1(),n=g1(),{compareIdentifiers:i}=w1();class o{constructor(u,l){if(l=n(l),u instanceof o){if(u.loose===!!l.loose&&u.includePrerelease===!!l.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError('Invalid version. Must be a string. Got type "'.concat(typeof u,'".'));if(u.length>e)throw new TypeError("version is longer than ".concat(e," characters"));r("SemVer",u,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const f=u.trim().match(l.loose?s[a.LOOSE]:s[a.FULL]);if(!f)throw new TypeError("Invalid Version: ".concat(u));if(this.raw=u,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(m=>{if(/^[0-9]+$/.test(m)){const v=+m;if(v>=0&&v<t)return v}return m}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}toString(){return this.version}compare(u){if(r("SemVer.compare",this.version,this.options,u),!(u instanceof o)){if(typeof u=="string"&&u===this.version)return 0;u=new o(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof o||(u=new o(u,this.options)),i(this.major,u.major)||i(this.minor,u.minor)||i(this.patch,u.patch)}comparePre(u){if(u instanceof o||(u=new o(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let l=0;do{const f=this.prerelease[l],m=u.prerelease[l];if(r("prerelease compare",l,f,m),f===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(f===void 0)return-1;if(f!==m)return i(f,m)}while(++l)}compareBuild(u){u instanceof o||(u=new o(u,this.options));let l=0;do{const f=this.build[l],m=u.build[l];if(r("build compare",l,f,m),f===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(f===void 0)return-1;if(f!==m)return i(f,m)}while(++l)}inc(u,l,f){switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",l,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",l,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",l,f),this.inc("pre",l,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",l,f),this.inc("pre",l,f);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const m=Number(f)?1:0;if(!l&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[m];else{let v=this.prerelease.length;for(;--v>=0;)typeof this.prerelease[v]=="number"&&(this.prerelease[v]++,v=-2);if(v===-1){if(l===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(m)}}if(l){let v=[l,m];f===!1&&(v=[l]),i(this.prerelease[0],l)===0?isNaN(this.prerelease[1])&&(this.prerelease=v):this.prerelease=v}break}default:throw new Error("invalid increment argument: ".concat(u))}return this.raw=this.format(),this.build.length&&(this.raw+="+".concat(this.build.join("."))),this}}return qm=o,qm}var Wm,Kd;function y1(){if(Kd)return Wm;Kd=1;const r=cw();return Wm=(e,t,s=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(a){if(!s)return null;throw a}},Wm}var _m,Md;function v1(){if(Md)return _m;Md=1;const r=y1();return _m=(e,t)=>{const s=r(e,t);return s?s.version:null},_m}v1();var Gm,Hd;function b1(){if(Hd)return Gm;Hd=1;const r=cw();return Gm=(e,t)=>new r(e,t).major,Gm}b1();var Fd={},Jd;function S1(){return Jd||(Jd=1,function(r){(function(e){e.parser=function(C,A){return new s(C,A)},e.SAXParser=s,e.SAXStream=l,e.createStream=u,e.MAX_BUFFER_LENGTH=64*1024;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function s(C,A){if(!(this instanceof s))return new s(C,A);var $=this;n($),$.q=$.c="",$.bufferCheckPosition=e.MAX_BUFFER_LENGTH,$.opt=A||{},$.opt.lowercase=$.opt.lowercase||$.opt.lowercasetags,$.looseCase=$.opt.lowercase?"toLowerCase":"toUpperCase",$.tags=[],$.closed=$.closedRoot=$.sawRoot=!1,$.tag=$.error=null,$.strict=!!C,$.noscript=!!(C||$.opt.noscript),$.state=V.BEGIN,$.strictEntities=$.opt.strictEntities,$.ENTITIES=$.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),$.attribList=[],$.opt.xmlns&&($.ns=Object.create(S)),$.opt.unquotedAttributeValues===void 0&&($.opt.unquotedAttributeValues=!C),$.trackPosition=$.opt.position!==!1,$.trackPosition&&($.position=$.line=$.column=0),F($,"onready")}Object.create||(Object.create=function(C){function A(){}A.prototype=C;var $=new A;return $}),Object.keys||(Object.keys=function(C){var A=[];for(var $ in C)C.hasOwnProperty($)&&A.push($);return A});function a(C){for(var A=Math.max(e.MAX_BUFFER_LENGTH,10),$=0,U=0,ge=t.length;U<ge;U++){var ke=C[t[U]].length;if(ke>A)switch(t[U]){case"textNode":j(C);break;case"cdata":D(C,"oncdata",C.cdata),C.cdata="";break;case"script":D(C,"onscript",C.script),C.script="";break;default:Y(C,"Max buffer length exceeded: "+t[U])}$=Math.max($,ke)}var he=e.MAX_BUFFER_LENGTH-$;C.bufferCheckPosition=he+C.position}function n(C){for(var A=0,$=t.length;A<$;A++)C[t[A]]=""}function i(C){j(C),C.cdata!==""&&(D(C,"oncdata",C.cdata),C.cdata=""),C.script!==""&&(D(C,"onscript",C.script),C.script="")}s.prototype={end:function(){oe(this)},write:Fe,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){i(this)}};var o;try{o=require("stream").Stream}catch(C){o=function(){}}o||(o=function(){});var h=e.EVENTS.filter(function(C){return C!=="error"&&C!=="end"});function u(C,A){return new l(C,A)}function l(C,A){if(!(this instanceof l))return new l(C,A);o.apply(this),this._parser=new s(C,A),this.writable=!0,this.readable=!0;var $=this;this._parser.onend=function(){$.emit("end")},this._parser.onerror=function(U){$.emit("error",U),$._parser.error=null},this._decoder=null,h.forEach(function(U){Object.defineProperty($,"on"+U,{get:function(){return $._parser["on"+U]},set:function(ge){if(!ge)return $.removeAllListeners(U),$._parser["on"+U]=ge,ge;$.on(U,ge)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(o.prototype,{constructor:{value:l}}),l.prototype.write=function(C){if(typeof Im=="function"&&typeof Im.isBuffer=="function"&&Im.isBuffer(C)){if(!this._decoder){var A=h1.StringDecoder;this._decoder=new A("utf8")}C=this._decoder.write(C)}return this._parser.write(C.toString()),this.emit("data",C),!0},l.prototype.end=function(C){return C&&C.length&&this.write(C),this._parser.end(),!0},l.prototype.on=function(C,A){var $=this;return!$._parser["on"+C]&&h.indexOf(C)!==-1&&($._parser["on"+C]=function(){var U=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);U.splice(0,0,C),$.emit.apply($,U)}),o.prototype.on.call($,C,A)};var f="[CDATA[",m="DOCTYPE",v="http://www.w3.org/XML/1998/namespace",w="http://www.w3.org/2000/xmlns/",S={xml:v,xmlns:w},y=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,k=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,p=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,b=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function I(C){return C===" "||C==="\n"||C==="\r"||C==="	"}function P(C){return C==='"'||C==="'"}function x(C){return C===">"||I(C)}function T(C,A){return C.test(A)}function B(C,A){return!T(C,A)}var V=0;e.STATE={BEGIN:V++,BEGIN_WHITESPACE:V++,TEXT:V++,TEXT_ENTITY:V++,OPEN_WAKA:V++,SGML_DECL:V++,SGML_DECL_QUOTED:V++,DOCTYPE:V++,DOCTYPE_QUOTED:V++,DOCTYPE_DTD:V++,DOCTYPE_DTD_QUOTED:V++,COMMENT_STARTING:V++,COMMENT:V++,COMMENT_ENDING:V++,COMMENT_ENDED:V++,CDATA:V++,CDATA_ENDING:V++,CDATA_ENDING_2:V++,PROC_INST:V++,PROC_INST_BODY:V++,PROC_INST_ENDING:V++,OPEN_TAG:V++,OPEN_TAG_SLASH:V++,ATTRIB:V++,ATTRIB_NAME:V++,ATTRIB_NAME_SAW_WHITE:V++,ATTRIB_VALUE:V++,ATTRIB_VALUE_QUOTED:V++,ATTRIB_VALUE_CLOSED:V++,ATTRIB_VALUE_UNQUOTED:V++,ATTRIB_VALUE_ENTITY_Q:V++,ATTRIB_VALUE_ENTITY_U:V++,CLOSE_TAG:V++,CLOSE_TAG_SAW_WHITE:V++,SCRIPT:V++,SCRIPT_ENDING:V++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(C){var A=e.ENTITIES[C],$=typeof A=="number"?String.fromCharCode(A):A;e.ENTITIES[C]=$});for(var J in e.STATE)e.STATE[e.STATE[J]]=J;V=e.STATE;function F(C,A,$){C[A]&&C[A]($)}function D(C,A,$){C.textNode&&j(C),F(C,A,$)}function j(C){C.textNode=te(C.opt,C.textNode),C.textNode&&F(C,"ontext",C.textNode),C.textNode=""}function te(C,A){return C.trim&&(A=A.trim()),C.normalize&&(A=A.replace(/\s+/g," ")),A}function Y(C,A){return j(C),C.trackPosition&&(A+="\nLine: "+C.line+"\nColumn: "+C.column+"\nChar: "+C.c),A=new Error(A),C.error=A,F(C,"onerror",A),C}function oe(C){return C.sawRoot&&!C.closedRoot&&ne(C,"Unclosed root tag"),C.state!==V.BEGIN&&C.state!==V.BEGIN_WHITESPACE&&C.state!==V.TEXT&&Y(C,"Unexpected end"),j(C),C.c="",C.closed=!0,F(C,"onend"),s.call(C,C.strict,C.opt),C}function ne(C,A){if(typeof C!="object"||!(C instanceof s))throw new Error("bad call to strictFail");C.strict&&Y(C,A)}function de(C){C.strict||(C.tagName=C.tagName[C.looseCase]());var A=C.tags[C.tags.length-1]||C,$=C.tag={name:C.tagName,attributes:{}};C.opt.xmlns&&($.ns=A.ns),C.attribList.length=0,D(C,"onopentagstart",$)}function ie(C,A){var $=C.indexOf(":"),U=$<0?["",C]:C.split(":"),ge=U[0],ke=U[1];return A&&C==="xmlns"&&(ge="xmlns",ke=""),{prefix:ge,local:ke}}function re(C){if(C.strict||(C.attribName=C.attribName[C.looseCase]()),C.attribList.indexOf(C.attribName)!==-1||C.tag.attributes.hasOwnProperty(C.attribName)){C.attribName=C.attribValue="";return}if(C.opt.xmlns){var A=ie(C.attribName,!0),$=A.prefix,U=A.local;if($==="xmlns")if(U==="xml"&&C.attribValue!==v)ne(C,"xml: prefix must be bound to "+v+"\nActual: "+C.attribValue);else if(U==="xmlns"&&C.attribValue!==w)ne(C,"xmlns: prefix must be bound to "+w+"\nActual: "+C.attribValue);else{var ge=C.tag,ke=C.tags[C.tags.length-1]||C;ge.ns===ke.ns&&(ge.ns=Object.create(ke.ns)),ge.ns[U]=C.attribValue}C.attribList.push([C.attribName,C.attribValue])}else C.tag.attributes[C.attribName]=C.attribValue,D(C,"onattribute",{name:C.attribName,value:C.attribValue});C.attribName=C.attribValue=""}function se(C,A){if(C.opt.xmlns){var $=C.tag,U=ie(C.tagName);$.prefix=U.prefix,$.local=U.local,$.uri=$.ns[U.prefix]||"",$.prefix&&!$.uri&&(ne(C,"Unbound namespace prefix: "+JSON.stringify(C.tagName)),$.uri=U.prefix);var ge=C.tags[C.tags.length-1]||C;$.ns&&ge.ns!==$.ns&&Object.keys($.ns).forEach(function(Je){D(C,"onopennamespace",{prefix:Je,uri:$.ns[Je]})});for(var ke=0,he=C.attribList.length;ke<he;ke++){var Et=C.attribList[ke],bt=Et[0],Ls=Et[1],ot=ie(bt,!0),ps=ot.prefix,bm=ot.local,Oc=ps===""?"":$.ns[ps]||"",Yo={name:bt,value:Ls,prefix:ps,local:bm,uri:Oc};ps&&ps!=="xmlns"&&!Oc&&(ne(C,"Unbound namespace prefix: "+JSON.stringify(ps)),Yo.uri=ps),C.tag.attributes[bt]=Yo,D(C,"onattribute",Yo)}C.attribList.length=0}C.tag.isSelfClosing=!!A,C.sawRoot=!0,C.tags.push(C.tag),D(C,"onopentag",C.tag),A||(!C.noscript&&C.tagName.toLowerCase()==="script"?C.state=V.SCRIPT:C.state=V.TEXT,C.tag=null,C.tagName=""),C.attribName=C.attribValue="",C.attribList.length=0}function ee(C){if(!C.tagName){ne(C,"Weird empty close tag."),C.textNode+="</>",C.state=V.TEXT;return}if(C.script){if(C.tagName!=="script"){C.script+="</"+C.tagName+">",C.tagName="",C.state=V.SCRIPT;return}D(C,"onscript",C.script),C.script=""}var A=C.tags.length,$=C.tagName;C.strict||($=$[C.looseCase]());for(var U=$;A--;){var ge=C.tags[A];if(ge.name!==U)ne(C,"Unexpected close tag");else break}if(A<0){ne(C,"Unmatched closing tag: "+C.tagName),C.textNode+="</"+C.tagName+">",C.state=V.TEXT;return}C.tagName=$;for(var ke=C.tags.length;ke-- >A;){var he=C.tag=C.tags.pop();C.tagName=C.tag.name,D(C,"onclosetag",C.tagName);var Et={};for(var bt in he.ns)Et[bt]=he.ns[bt];var Ls=C.tags[C.tags.length-1]||C;C.opt.xmlns&&he.ns!==Ls.ns&&Object.keys(he.ns).forEach(function(ot){var ps=he.ns[ot];D(C,"onclosenamespace",{prefix:ot,uri:ps})})}A===0&&(C.closedRoot=!0),C.tagName=C.attribValue=C.attribName="",C.attribList.length=0,C.state=V.TEXT}function ce(C){var A=C.entity,$=A.toLowerCase(),U,ge="";return C.ENTITIES[A]?C.ENTITIES[A]:C.ENTITIES[$]?C.ENTITIES[$]:(A=$,A.charAt(0)==="#"&&(A.charAt(1)==="x"?(A=A.slice(2),U=parseInt(A,16),ge=U.toString(16)):(A=A.slice(1),U=parseInt(A,10),ge=U.toString(10))),A=A.replace(/^0+/,""),isNaN(U)||ge.toLowerCase()!==A?(ne(C,"Invalid character entity"),"&"+C.entity+";"):String.fromCodePoint(U))}function pe(C,A){A==="<"?(C.state=V.OPEN_WAKA,C.startTagPosition=C.position):I(A)||(ne(C,"Non-whitespace before first tag."),C.textNode=A,C.state=V.TEXT)}function Ce(C,A){var $="";return A<C.length&&($=C.charAt(A)),$}function Fe(C){var A=this;if(this.error)throw this.error;if(A.closed)return Y(A,"Cannot write after close. Assign an onready handler.");if(C===null)return oe(A);typeof C=="object"&&(C=C.toString());for(var $=0,U="";U=Ce(C,$++),A.c=U,!!U;)switch(A.trackPosition&&(A.position++,U==="\n"?(A.line++,A.column=0):A.column++),A.state){case V.BEGIN:if(A.state=V.BEGIN_WHITESPACE,U==="\uFEFF")continue;pe(A,U);continue;case V.BEGIN_WHITESPACE:pe(A,U);continue;case V.TEXT:if(A.sawRoot&&!A.closedRoot){for(var ge=$-1;U&&U!=="<"&&U!=="&";)U=Ce(C,$++),U&&A.trackPosition&&(A.position++,U==="\n"?(A.line++,A.column=0):A.column++);A.textNode+=C.substring(ge,$-1)}U==="<"&&!(A.sawRoot&&A.closedRoot&&!A.strict)?(A.state=V.OPEN_WAKA,A.startTagPosition=A.position):(!I(U)&&(!A.sawRoot||A.closedRoot)&&ne(A,"Text data outside of root node."),U==="&"?A.state=V.TEXT_ENTITY:A.textNode+=U);continue;case V.SCRIPT:U==="<"?A.state=V.SCRIPT_ENDING:A.script+=U;continue;case V.SCRIPT_ENDING:U==="/"?A.state=V.CLOSE_TAG:(A.script+="<"+U,A.state=V.SCRIPT);continue;case V.OPEN_WAKA:if(U==="!")A.state=V.SGML_DECL,A.sgmlDecl="";else if(!I(U))if(T(y,U))A.state=V.OPEN_TAG,A.tagName=U;else if(U==="/")A.state=V.CLOSE_TAG,A.tagName="";else if(U==="?")A.state=V.PROC_INST,A.procInstName=A.procInstBody="";else{if(ne(A,"Unencoded <"),A.startTagPosition+1<A.position){var ke=A.position-A.startTagPosition;U=new Array(ke).join(" ")+U}A.textNode+="<"+U,A.state=V.TEXT}continue;case V.SGML_DECL:if(A.sgmlDecl+U==="--"){A.state=V.COMMENT,A.comment="",A.sgmlDecl="";continue}A.doctype&&A.doctype!==!0&&A.sgmlDecl?(A.state=V.DOCTYPE_DTD,A.doctype+="<!"+A.sgmlDecl+U,A.sgmlDecl=""):(A.sgmlDecl+U).toUpperCase()===f?(D(A,"onopencdata"),A.state=V.CDATA,A.sgmlDecl="",A.cdata=""):(A.sgmlDecl+U).toUpperCase()===m?(A.state=V.DOCTYPE,(A.doctype||A.sawRoot)&&ne(A,"Inappropriately located doctype declaration"),A.doctype="",A.sgmlDecl=""):U===">"?(D(A,"onsgmldeclaration",A.sgmlDecl),A.sgmlDecl="",A.state=V.TEXT):(P(U)&&(A.state=V.SGML_DECL_QUOTED),A.sgmlDecl+=U);continue;case V.SGML_DECL_QUOTED:U===A.q&&(A.state=V.SGML_DECL,A.q=""),A.sgmlDecl+=U;continue;case V.DOCTYPE:U===">"?(A.state=V.TEXT,D(A,"ondoctype",A.doctype),A.doctype=!0):(A.doctype+=U,U==="["?A.state=V.DOCTYPE_DTD:P(U)&&(A.state=V.DOCTYPE_QUOTED,A.q=U));continue;case V.DOCTYPE_QUOTED:A.doctype+=U,U===A.q&&(A.q="",A.state=V.DOCTYPE);continue;case V.DOCTYPE_DTD:U==="]"?(A.doctype+=U,A.state=V.DOCTYPE):U==="<"?(A.state=V.OPEN_WAKA,A.startTagPosition=A.position):P(U)?(A.doctype+=U,A.state=V.DOCTYPE_DTD_QUOTED,A.q=U):A.doctype+=U;continue;case V.DOCTYPE_DTD_QUOTED:A.doctype+=U,U===A.q&&(A.state=V.DOCTYPE_DTD,A.q="");continue;case V.COMMENT:U==="-"?A.state=V.COMMENT_ENDING:A.comment+=U;continue;case V.COMMENT_ENDING:U==="-"?(A.state=V.COMMENT_ENDED,A.comment=te(A.opt,A.comment),A.comment&&D(A,"oncomment",A.comment),A.comment=""):(A.comment+="-"+U,A.state=V.COMMENT);continue;case V.COMMENT_ENDED:U!==">"?(ne(A,"Malformed comment"),A.comment+="--"+U,A.state=V.COMMENT):A.doctype&&A.doctype!==!0?A.state=V.DOCTYPE_DTD:A.state=V.TEXT;continue;case V.CDATA:U==="]"?A.state=V.CDATA_ENDING:A.cdata+=U;continue;case V.CDATA_ENDING:U==="]"?A.state=V.CDATA_ENDING_2:(A.cdata+="]"+U,A.state=V.CDATA);continue;case V.CDATA_ENDING_2:U===">"?(A.cdata&&D(A,"oncdata",A.cdata),D(A,"onclosecdata"),A.cdata="",A.state=V.TEXT):U==="]"?A.cdata+="]":(A.cdata+="]]"+U,A.state=V.CDATA);continue;case V.PROC_INST:U==="?"?A.state=V.PROC_INST_ENDING:I(U)?A.state=V.PROC_INST_BODY:A.procInstName+=U;continue;case V.PROC_INST_BODY:if(!A.procInstBody&&I(U))continue;U==="?"?A.state=V.PROC_INST_ENDING:A.procInstBody+=U;continue;case V.PROC_INST_ENDING:U===">"?(D(A,"onprocessinginstruction",{name:A.procInstName,body:A.procInstBody}),A.procInstName=A.procInstBody="",A.state=V.TEXT):(A.procInstBody+="?"+U,A.state=V.PROC_INST_BODY);continue;case V.OPEN_TAG:T(k,U)?A.tagName+=U:(de(A),U===">"?se(A):U==="/"?A.state=V.OPEN_TAG_SLASH:(I(U)||ne(A,"Invalid character in tag name"),A.state=V.ATTRIB));continue;case V.OPEN_TAG_SLASH:U===">"?(se(A,!0),ee(A)):(ne(A,"Forward-slash in opening tag not followed by >"),A.state=V.ATTRIB);continue;case V.ATTRIB:if(I(U))continue;U===">"?se(A):U==="/"?A.state=V.OPEN_TAG_SLASH:T(y,U)?(A.attribName=U,A.attribValue="",A.state=V.ATTRIB_NAME):ne(A,"Invalid attribute name");continue;case V.ATTRIB_NAME:U==="="?A.state=V.ATTRIB_VALUE:U===">"?(ne(A,"Attribute without value"),A.attribValue=A.attribName,re(A),se(A)):I(U)?A.state=V.ATTRIB_NAME_SAW_WHITE:T(k,U)?A.attribName+=U:ne(A,"Invalid attribute name");continue;case V.ATTRIB_NAME_SAW_WHITE:if(U==="=")A.state=V.ATTRIB_VALUE;else{if(I(U))continue;ne(A,"Attribute without value"),A.tag.attributes[A.attribName]="",A.attribValue="",D(A,"onattribute",{name:A.attribName,value:""}),A.attribName="",U===">"?se(A):T(y,U)?(A.attribName=U,A.state=V.ATTRIB_NAME):(ne(A,"Invalid attribute name"),A.state=V.ATTRIB)}continue;case V.ATTRIB_VALUE:if(I(U))continue;P(U)?(A.q=U,A.state=V.ATTRIB_VALUE_QUOTED):(A.opt.unquotedAttributeValues||Y(A,"Unquoted attribute value"),A.state=V.ATTRIB_VALUE_UNQUOTED,A.attribValue=U);continue;case V.ATTRIB_VALUE_QUOTED:if(U!==A.q){U==="&"?A.state=V.ATTRIB_VALUE_ENTITY_Q:A.attribValue+=U;continue}re(A),A.q="",A.state=V.ATTRIB_VALUE_CLOSED;continue;case V.ATTRIB_VALUE_CLOSED:I(U)?A.state=V.ATTRIB:U===">"?se(A):U==="/"?A.state=V.OPEN_TAG_SLASH:T(y,U)?(ne(A,"No whitespace between attributes"),A.attribName=U,A.attribValue="",A.state=V.ATTRIB_NAME):ne(A,"Invalid attribute name");continue;case V.ATTRIB_VALUE_UNQUOTED:if(!x(U)){U==="&"?A.state=V.ATTRIB_VALUE_ENTITY_U:A.attribValue+=U;continue}re(A),U===">"?se(A):A.state=V.ATTRIB;continue;case V.CLOSE_TAG:if(A.tagName)U===">"?ee(A):T(k,U)?A.tagName+=U:A.script?(A.script+="</"+A.tagName,A.tagName="",A.state=V.SCRIPT):(I(U)||ne(A,"Invalid tagname in closing tag"),A.state=V.CLOSE_TAG_SAW_WHITE);else{if(I(U))continue;B(y,U)?A.script?(A.script+="</"+U,A.state=V.SCRIPT):ne(A,"Invalid tagname in closing tag."):A.tagName=U}continue;case V.CLOSE_TAG_SAW_WHITE:if(I(U))continue;U===">"?ee(A):ne(A,"Invalid characters in closing tag");continue;case V.TEXT_ENTITY:case V.ATTRIB_VALUE_ENTITY_Q:case V.ATTRIB_VALUE_ENTITY_U:var he,Et;switch(A.state){case V.TEXT_ENTITY:he=V.TEXT,Et="textNode";break;case V.ATTRIB_VALUE_ENTITY_Q:he=V.ATTRIB_VALUE_QUOTED,Et="attribValue";break;case V.ATTRIB_VALUE_ENTITY_U:he=V.ATTRIB_VALUE_UNQUOTED,Et="attribValue";break}if(U===";"){var bt=ce(A);A.opt.unparsedEntities&&!Object.values(e.XML_ENTITIES).includes(bt)?(A.entity="",A.state=he,A.write(bt)):(A[Et]+=bt,A.entity="",A.state=he)}else T(A.entity.length?b:p,U)?A.entity+=U:(ne(A,"Invalid character in entity name"),A[Et]+="&"+A.entity+U,A.entity="",A.state=he);continue;default:throw new Error(A,"Unknown state: "+A.state)}return A.position>=A.bufferCheckPosition&&a(A),A}String.fromCodePoint||function(){var C=String.fromCharCode,A=Math.floor,$=function(){var U=16384,ge=[],ke,he,Et=-1,bt=arguments.length;if(!bt)return"";for(var Ls="";++Et<bt;){var ot=Number(arguments[Et]);if(!isFinite(ot)||ot<0||ot>1114111||A(ot)!==ot)throw RangeError("Invalid code point: "+ot);ot<=65535?ge.push(ot):(ot-=65536,ke=(ot>>10)+55296,he=ot%1024+56320,ge.push(ke,he)),(Et+1===bt||ge.length>U)&&(Ls+=C.apply(null,ge),ge.length=0)}return Ls};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:$,configurable:!0,writable:!0}):String.fromCodePoint=$}()})(r)}(Fd)),Fd}S1();function A1(r){return typeof r=="function"?r:Array.isArray(r)?e=>{for(const t of r)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}const N1="\n";function E1(r,e){let t="";return e.format&&e.indentBy.length>0&&(t=N1),hw(r,e,"",t)}function hw(r,e,t,s){let a="",n=!1;for(let i=0;i<r.length;i++){const o=r[i],h=k1(o);if(h===void 0)continue;let u="";if(t.length===0?u=h:u="".concat(t,".").concat(h),h===e.textNodeName){let w=o[h];I1(u,e)||(w=e.tagValueProcessor(h,w),w=mw(w,e)),n&&(a+=s),a+=w,n=!1;continue}else if(h===e.cdataPropName){n&&(a+=s),a+="<![CDATA[".concat(o[h][0][e.textNodeName],"]]>"),n=!1;continue}else if(h===e.commentPropName){a+=s+"<!--".concat(o[h][0][e.textNodeName],"-->"),n=!0;continue}else if(h[0]==="?"){const w=qd(o[":@"],e),S=h==="?xml"?"":s;let y=o[h][0][e.textNodeName];y=y.length!==0?" "+y:"",a+=S+"<".concat(h).concat(y).concat(w,"?>"),n=!0;continue}let l=s;l!==""&&(l+=e.indentBy);const f=qd(o[":@"],e),m=s+"<".concat(h).concat(f),v=hw(o[h],e,u,l);e.unpairedTags.indexOf(h)!==-1?e.suppressUnpairedNode?a+=m+">":a+=m+"/>":(!v||v.length===0)&&e.suppressEmptyNode?a+=m+"/>":v&&v.endsWith(">")?a+=m+">".concat(v).concat(s,"</").concat(h,">"):(a+=m+">",v&&s!==""&&(v.includes("/>")||v.includes("</"))?a+=s+e.indentBy+v+s:a+=v,a+="</".concat(h,">")),n=!0}return a}function k1(r){const e=Object.keys(r);for(let t=0;t<e.length;t++){const s=e[t];if(r.hasOwnProperty(s)&&s!==":@")return s}}function qd(r,e){let t="";if(r&&!e.ignoreAttributes)for(let s in r){if(!r.hasOwnProperty(s))continue;let a=e.attributeValueProcessor(s,r[s]);a=mw(a,e),a===!0&&e.suppressBooleanAttributes?t+=" ".concat(s.substr(e.attributeNamePrefix.length)):t+=" ".concat(s.substr(e.attributeNamePrefix.length),'="').concat(a,'"')}return t}function I1(r,e){r=r.substr(0,r.length-e.textNodeName.length-1);let t=r.substr(r.lastIndexOf(".")+1);for(let s in e.stopNodes)if(e.stopNodes[s]===r||e.stopNodes[s]==="*."+t)return!0;return!1}function mw(r,e){if(r&&r.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const s=e.entities[t];r=r.replace(s.regex,s.val)}return r}const C1={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function pa(r){this.options=Object.assign({},C1,r),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=A1(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=B1),this.processTextOrObjNode=V1,this.options.format?(this.indentate=x1,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}pa.prototype.build=function(r){return this.options.preserveOrder?E1(r,this.options):(Array.isArray(r)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(r={[this.options.arrayNodeName]:r}),this.j2x(r,0,[]).val)},pa.prototype.j2x=function(r,e,t){let s="",a="";const n=t.join(".");for(let i in r)if(Object.prototype.hasOwnProperty.call(r,i))if(typeof r[i]>"u")this.isAttribute(i)&&(a+="");else if(r[i]===null)this.isAttribute(i)||i===this.options.cdataPropName?a+="":i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(r[i]instanceof Date)a+=this.buildTextValNode(r[i],i,"",e);else if(typeof r[i]!="object"){const o=this.isAttribute(i);if(o&&!this.ignoreAttributesFn(o,n))s+=this.buildAttrPairStr(o,""+r[i]);else if(!o)if(i===this.options.textNodeName){let h=this.options.tagValueProcessor(i,""+r[i]);a+=this.replaceEntitiesValue(h)}else a+=this.buildTextValNode(r[i],i,"",e)}else if(Array.isArray(r[i])){const o=r[i].length;let h="",u="";for(let l=0;l<o;l++){const f=r[i][l];if(!(typeof f>"u"))if(f===null)i[0]==="?"?a+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(typeof f=="object")if(this.options.oneListGroup){const m=this.j2x(f,e+1,t.concat(i));h+=m.val,this.options.attributesGroupName&&f.hasOwnProperty(this.options.attributesGroupName)&&(u+=m.attrStr)}else h+=this.processTextOrObjNode(f,i,e,t);else if(this.options.oneListGroup){let m=this.options.tagValueProcessor(i,f);m=this.replaceEntitiesValue(m),h+=m}else h+=this.buildTextValNode(f,i,"",e)}this.options.oneListGroup&&(h=this.buildObjectNode(h,i,u,e)),a+=h}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const o=Object.keys(r[i]),h=o.length;for(let u=0;u<h;u++)s+=this.buildAttrPairStr(o[u],""+r[i][o[u]])}else a+=this.processTextOrObjNode(r[i],i,e,t);return{attrStr:s,val:a}},pa.prototype.buildAttrPairStr=function(r,e){return e=this.options.attributeValueProcessor(r,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+r:" "+r+'="'+e+'"'};function V1(r,e,t,s){const a=this.j2x(r,t+1,s.concat(e));return r[this.options.textNodeName]!==void 0&&Object.keys(r).length===1?this.buildTextValNode(r[this.options.textNodeName],e,a.attrStr,t):this.buildObjectNode(a.val,e,a.attrStr,t)}pa.prototype.buildObjectNode=function(r,e,t,s){if(r==="")return e[0]==="?"?this.indentate(s)+"<"+e+t+"?"+this.tagEndChar:this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let a="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",a=""),(t||t==="")&&r.indexOf("<")===-1?this.indentate(s)+"<"+e+t+n+">"+r+a:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(s)+"<!--".concat(r,"-->")+this.newLine:this.indentate(s)+"<"+e+t+n+this.tagEndChar+r+this.indentate(s)+a}},pa.prototype.closeTag=function(r){let e="";return this.options.unpairedTags.indexOf(r)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e="></".concat(r),e},pa.prototype.buildTextValNode=function(r,e,t,s){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(s)+"<![CDATA[".concat(r,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(s)+"<!--".concat(r,"-->")+this.newLine;if(e[0]==="?")return this.indentate(s)+"<"+e+t+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(e,r);return a=this.replaceEntitiesValue(a),a===""?this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(s)+"<"+e+t+">"+a+"</"+e+this.tagEndChar}},pa.prototype.replaceEntitiesValue=function(r){if(r&&r.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];r=r.replace(t.regex,t.val)}return r};function x1(r){return this.options.indentBy.repeat(r)}function B1(r){return r.startsWith(this.options.attributeNamePrefix)&&r!==this.options.textNodeName?r.substr(this.attrPrefixLen):!1}function fh(r){return r.users!==void 0}const O1=r=>r===null?Bf().setApp("end_to_end_encryption").build():Bf().setApp("end_to_end_encryption").setUid(r.uid).build(),ht=O1(gp());class Le{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let s=0;s<t;s++)this.view[s]=e.charCodeAt(s)}toString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)s+=String.fromCharCode(this.view[a]);return s}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const s=new Map;s.set("0",0),s.set("1",1),s.set("2",2),s.set("3",3),s.set("4",4),s.set("5",5),s.set("6",6),s.set("7",7),s.set("8",8),s.set("9",9),s.set("A",10),s.set("a",10),s.set("B",11),s.set("b",11),s.set("C",12),s.set("c",12),s.set("D",13),s.set("d",13),s.set("E",14),s.set("e",14),s.set("F",15),s.set("f",15);let a=0,n=0;for(let i=0;i<t;i++)i%2?(n|=s.get(e.charAt(i)),this.view[a]=n,a++):n=s.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){const n=this.view[a].toString(16).toUpperCase();s=s+(n.length==1?"0":"")+n}return s}copy(e=0,t=this.length-e){if(!e&&!this.length)return new Le;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Le({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new Le;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Le({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),s=new Uint8Array(t);e>this._view.length?s.set(this._view):s.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,s=e.length,a=e._view.subarray();this.realloc(t+s),this._view.set(a,t)}insert(e,t=0,s=this.length-t){return t>this.length-1?!1:(s>this.length-t&&(s=this.length-t),s>e.length&&(s=e.length),s==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,s),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a),h=e.length;if(h>i)return-1;const u=[];for(let l=0;l<h;l++)u.push(e.view[l]);for(let l=0;l<=i-h;l++){let f=!0;const m=o?n-h-l:n+l;for(let v=0;v<h;v++)if(this.view[v+m]!=u[v]){f=!1;break}if(f)return o?n-h-l:n+h+l}return-1}findFirstIn(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a),h={id:-1,position:o?0:n+i,length:0};for(let u=0;u<e.length;u++){const l=this.findPattern(e[u],n,i,o);if(l!=-1){let f=!1;const m=e[u].length;o?l-m>=h.position-h.length&&(f=!0):l-m<=h.position-h.length&&(f=!0),f&&(h.position=l,h.id=u,h.length=m)}}return h}findAllIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={id:-1,position:a};do{const h=o.position;if(o=this.findFirstIn(e,o.position,n),o.id==-1)break;n-=o.position-h,i.push({id:o.id,position:o.position})}while(!0);return i}findAllPatternIn(e,t,s){const{start:a,length:n}=this.prepareFindParameters(t,s),i=[],o=e.length;if(o>n)return-1;const h=Array.from(e.view);for(let u=0;u<=n-o;u++){let l=!0;const f=a+u;for(let m=0;m<o;m++)if(this.view[m+f]!=h[m]){l=!1;break}l&&(i.push(a+o+u),u+=o-1)}return i}findFirstNotIn(e,t,s,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);const h={left:{id:-1,position:n},right:{id:-1,position:0},value:new Le};let u=i;for(;u>0;){if(h.right=this.findFirstIn(e,o?n-i+u:n+i-u,u,o),h.right.id==-1){i=u,o?n-=i:n=h.left.position,h.value=new Le({buffer:this._buffer.slice(n,n+i)});break}if(h.right.position!=(o?h.left.position-e[h.right.id].length:h.left.position+e[h.right.id].length)){o?(n=h.right.position+e[h.right.id].length,i=h.left.position-h.right.position-e[h.right.id].length):(n=h.left.position,i=h.right.position-h.left.position-e[h.right.id].length),h.value=new Le({buffer:this._buffer.slice(n,n+i)});break}h.left=h.right,u-=e[h.right.id].length}if(o){const l=h.right;h.right=h.left,h.left=l}return h}findAllNotIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={left:{id:-1,position:a},right:{id:-1,position:a},value:new Le};do{const h=o.right.position;o=this.findFirstNotIn(e,o.right.position,n),n-=o.right.position-h,i.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(o.right.id!=-1);return i}findFirstSequence(e,t,s,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);const h=this.skipNotPatterns(e,n,i,o);if(h==-1)return{position:-1,value:new Le};const u=this.skipPatterns(e,h,i-(o?n-h:h-n),o);o?(n=u,i=h-u):(n=h,i=u-h);const l=new Le({buffer:this._buffer.slice(n,n+i)});return{position:u,value:l}}findAllSequences(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const i=[];let o={position:a,value:new Le};do{const h=o.position;o=this.findFirstSequence(e,o.position,n),o.position!=-1&&(n-=o.position-h,i.push({position:o.position,value:o.value}))}while(o.position!=-1);return i}findPairedPatterns(e,t,s,a){const n=[];if(e.isEqual(t))return n;const{start:i,length:o}=this.prepareFindParameters(s,a);let h=0;const u=this.findAllPatternIn(e,i,o);if(!Array.isArray(u)||u.length==0)return n;const l=this.findAllPatternIn(t,i,o);if(!Array.isArray(l)||l.length==0)return n;for(;h<u.length&&l.length!=0;){if(u[0]==l[0]){n.push({left:u[0],right:l[0]}),u.splice(0,1),l.splice(0,1);continue}if(u[h]>l[0])break;for(;u[h]<l[0]&&(h++,!(h>=u.length)););n.push({left:u[h-1],right:l[0]}),u.splice(h-1,1),l.splice(0,1),h=0}return n.sort((f,m)=>f.left-m.left),n}findPairedArrays(e,t,s,a){const{start:n,length:i}=this.prepareFindParameters(s,a),o=[];let h=0;const u=this.findAllIn(e,n,i);if(u.length==0)return o;const l=this.findAllIn(t,n,i);if(l.length==0)return o;for(;h<u.length&&l.length!=0;){if(u[0].position==l[0].position){o.push({left:u[0],right:l[0]}),u.splice(0,1),l.splice(0,1);continue}if(u[h].position>l[0].position)break;for(;u[h].position<l[0].position&&(h++,!(h>=u.length)););o.push({left:u[h-1],right:l[0]}),u.splice(h-1,1),l.splice(0,1),h=0}return o.sort((f,m)=>f.left.position-m.left.position),o}replacePattern(e,t,s,a,n=null){let i=[],o;const h={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:u,length:l}=this.prepareFindParameters(s,a);if(n==null){if(i=this.findAllIn([e],u,l),i.length==0)return h}else i=n;h.searchPatternPositions.push(...Array.from(i,w=>w.position));const f=e.length-t.length,m=new ArrayBuffer(this.view.length-i.length*f),v=new Uint8Array(m);for(v.set(new Uint8Array(this.buffer,0,u)),o=0;o<i.length;o++){const w=o==0?u:i[o-1].position;v.set(new Uint8Array(this.buffer,w,i[o].position-e.length-w),w-o*f),v.set(t.view,i[o].position-e.length-o*f),h.replacePatternPositions.push(i[o].position-e.length-o*f)}return o--,v.set(new Uint8Array(this.buffer,i[o].position,this.length-i[o].position),i[o].position-e.length+t.length-o*f),this.buffer=m,this.view=new Uint8Array(this.buffer),h.status=1,h}skipPatterns(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);let h=n;for(let u=0;u<e.length;u++){const l=e[u].length,f=o?h-l:h;let m=!0;for(let v=0;v<l;v++)if(this.view[v+f]!=e[u].view[v]){m=!1;break}if(m){if(u=-1,o){if(h-=l,h<=0)return h}else if(h+=l,h>=n+i)return h}}return h}skipNotPatterns(e,t,s,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,s,a);let h=-1;for(let u=0;u<i;u++){for(let l=0;l<e.length;l++){const f=e[l].length,m=o?n-u-f:n+u;let v=!0;for(let w=0;w<f;w++)if(this.view[w+m]!=e[l].view[w]){v=!1;break}if(v){h=o?n-u:n+u;break}}if(h!=-1)break}return h}prepareFindParameters(e=null,t=null,s=!1){return e===null&&(e=s?this.length:0),e>this.length&&(e=this.length),s?(t===null&&(t=e),t>e&&(t=e)):(t===null&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:s}}}const P1=16777216;class Sa{constructor(e={}){this._stream=new Le,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new Le({view:e.view}):"buffer"in e?this.stream=new Le({buffer:e.buffer}):"string"in e?this.stream=new Le({string:e.string}):"hexstring"in e?this.stream=new Le({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new Le,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findPattern(e,this.start,this.length,this.backward);if(s==-1)return s;if(this.backward){if(s<this.start-e.length-t)return-1}else if(s>this.start+e.length+t)return-1;return this.start=s,s}findFirstIn(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(s.id==-1)return s;if(this.backward){if(s.position<this.start-e[s.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(s.position>this.start+e[s.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=s.position,s}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(t==null||t>this._length)&&(t=this._length);const s=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(s.left.id==-1&&s.right.id==-1)return s;if(this.backward){if(s.right.id!=-1&&s.right.position<this._start-e[s.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Le}}else if(s.left.id!=-1&&s.left.position>this._start+e[s.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Le};return this.backward?s.left.id==-1?this.start=0:this.start=s.left.position:s.right.id==-1?this.start=this._start+this._length:this.start=s.right.position,s}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,s=null){(t==null||t>this._length)&&(t=this._length),(s==null||s>t)&&(s=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(a.value.length==0)return a;if(this.backward){if(a.position<this._start-a.value.length-s)return{position:-1,value:new Le}}else if(a.position>this._start+a.value.length+s)return{position:-1,value:new Le};return this.start=a.position,a}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right<this.start-t.length-s)return[]}else if(n[0].left>this.start+e.length+s)return[]}return n}findPairedArrays(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-s)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+s)return[]}return n}replacePattern(e,t){const s=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,s,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return t==-1?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),s=new Uint8Array(t.buffer);this.stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[2],this._stream.view[this._start+1]=s[1],this._stream.view[this._start+2]=s[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);this._length<e&&(e=this._length);let s;if(this.backward){const a=this._stream.view.subarray(this._length-e,this._length);s=new Uint8Array(e);for(let n=0;n<e;n++)s[e-1-n]=a[n]}else s=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),s}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),s=32768;return t&s?-(s-(t^s)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:t[0]*P1+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),s=2147483648;return t&s?-(s-(t^s)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+Sa.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}Sa.APPEND_BLOCK=1e3;function D1(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function fw(r,...e){if(!D1(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Wd(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function T1(r,e){fw(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const zm=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Cs=(r,e)=>r<<32-e|r>>>e,Xm=(r,e)=>r<<e|r>>>32-e>>>0;function R1(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function pw(r){return typeof r=="string"&&(r=R1(r)),fw(r),r}class U1{clone(){return this._cloneInto()}}function wm(r){const e=s=>r().update(pw(s)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function L1(r,e,t,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,s);const a=BigInt(32),n=BigInt(4294967295),i=Number(t>>a&n),o=Number(t&n),h=s?4:0,u=s?0:4;r.setUint32(e+h,i,s),r.setUint32(e+u,o,s)}const dw=(r,e,t)=>r&e^~r&t,gw=(r,e,t)=>r&e^r&t^e&t;class Cp extends U1{constructor(e,t,s,a){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=zm(this.buffer)}update(e){Wd(this);const{view:t,buffer:s,blockLen:a}=this;e=pw(e);const n=e.length;for(let i=0;i<n;){const o=Math.min(a-this.pos,n-i);if(o===a){const h=zm(e);for(;a<=n-i;i+=a)this.process(h,i);continue}s.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Wd(this),T1(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:a,isLE:n}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>a-i&&(this.process(s,0),i=0);for(let f=i;f<a;f++)t[f]=0;L1(s,a-8,BigInt(this.length*8),n),this.process(s,0);const o=zm(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=h/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)o.setUint32(4*f,l[f],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:a,finished:n,destroyed:i,pos:o}=this;return e.length=a,e.pos=o,e.finished=n,e.destroyed=i,a%t&&e.buffer.set(s),e}}const su=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),dr=new Uint32Array(80);let j1=class extends Cp{constructor(){super(64,20,8,!1),this.A=su[0]|0,this.B=su[1]|0,this.C=su[2]|0,this.D=su[3]|0,this.E=su[4]|0}get(){const{A:r,B:e,C:t,D:s,E:a}=this;return[r,e,t,s,a]}set(r,e,t,s,a){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0}process(r,e){for(let o=0;o<16;o++,e+=4)dr[o]=r.getUint32(e,!1);for(let o=16;o<80;o++)dr[o]=Xm(dr[o-3]^dr[o-8]^dr[o-14]^dr[o-16],1);let{A:t,B:s,C:a,D:n,E:i}=this;for(let o=0;o<80;o++){let h,u;o<20?(h=dw(s,a,n),u=1518500249):o<40?(h=s^a^n,u=1859775393):o<60?(h=gw(s,a,n),u=2400959708):(h=s^a^n,u=3395469782);const l=Xm(t,5)+h+i+u+dr[o]|0;i=n,n=a,a=Xm(s,30),s=t,t=l}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,i=i+this.E|0,this.set(t,s,a,n,i)}roundClean(){dr.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}};const $1=wm(()=>new j1),K1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),gr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),wr=new Uint32Array(64);let M1=class extends Cp{constructor(){super(64,32,8,!1),this.A=gr[0]|0,this.B=gr[1]|0,this.C=gr[2]|0,this.D=gr[3]|0,this.E=gr[4]|0,this.F=gr[5]|0,this.G=gr[6]|0,this.H=gr[7]|0}get(){const{A:r,B:e,C:t,D:s,E:a,F:n,G:i,H:o}=this;return[r,e,t,s,a,n,i,o]}set(r,e,t,s,a,n,i,o){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0,this.F=n|0,this.G=i|0,this.H=o|0}process(r,e){for(let l=0;l<16;l++,e+=4)wr[l]=r.getUint32(e,!1);for(let l=16;l<64;l++){const f=wr[l-15],m=wr[l-2],v=Cs(f,7)^Cs(f,18)^f>>>3,w=Cs(m,17)^Cs(m,19)^m>>>10;wr[l]=w+wr[l-7]+v+wr[l-16]|0}let{A:t,B:s,C:a,D:n,E:i,F:o,G:h,H:u}=this;for(let l=0;l<64;l++){const f=Cs(i,6)^Cs(i,11)^Cs(i,25),m=u+f+dw(i,o,h)+K1[l]+wr[l]|0,v=(Cs(t,2)^Cs(t,13)^Cs(t,22))+gw(t,s,a)|0;u=h,h=o,o=i,i=n+m|0,n=a,a=s,s=t,t=m+v|0}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,i=i+this.E|0,o=o+this.F|0,h=h+this.G|0,u=u+this.H|0,this.set(t,s,a,n,i,o,h,u)}roundClean(){wr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const H1=wm(()=>new M1),Lc=BigInt(2**32-1),Ff=BigInt(32);function ww(r,e=!1){return e?{h:Number(r&Lc),l:Number(r>>Ff&Lc)}:{h:Number(r>>Ff&Lc)|0,l:Number(r&Lc)|0}}function F1(r,e=!1){let t=new Uint32Array(r.length),s=new Uint32Array(r.length);for(let a=0;a<r.length;a++){const{h:n,l:i}=ww(r[a],e);[t[a],s[a]]=[n,i]}return[t,s]}const J1=(r,e)=>BigInt(r>>>0)<<Ff|BigInt(e>>>0),q1=(r,e,t)=>r>>>t,W1=(r,e,t)=>r<<32-t|e>>>t,_1=(r,e,t)=>r>>>t|e<<32-t,G1=(r,e,t)=>r<<32-t|e>>>t,z1=(r,e,t)=>r<<64-t|e>>>t-32,X1=(r,e,t)=>r>>>t-32|e<<64-t,Y1=(r,e)=>e,Q1=(r,e)=>r,Z1=(r,e,t)=>r<<t|e>>>32-t,ev=(r,e,t)=>e<<t|r>>>32-t,tv=(r,e,t)=>e<<t-32|r>>>64-t,sv=(r,e,t)=>r<<t-32|e>>>64-t;function rv(r,e,t,s){const a=(e>>>0)+(s>>>0);return{h:r+t+(a/2**32|0)|0,l:a|0}}const av=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),nv=(r,e,t,s)=>e+t+s+(r/2**32|0)|0,iv=(r,e,t,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0),ov=(r,e,t,s,a)=>e+t+s+a+(r/2**32|0)|0,uv=(r,e,t,s,a)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0)+(a>>>0),lv=(r,e,t,s,a,n)=>e+t+s+a+n+(r/2**32|0)|0,we={fromBig:ww,split:F1,toBig:J1,shrSH:q1,shrSL:W1,rotrSH:_1,rotrSL:G1,rotrBH:z1,rotrBL:X1,rotr32H:Y1,rotr32L:Q1,rotlSH:Z1,rotlSL:ev,rotlBH:tv,rotlBL:sv,add:rv,add3L:av,add3H:nv,add4L:iv,add4H:ov,add5H:lv,add5L:uv},[cv,hv]=we.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),yr=new Uint32Array(80),vr=new Uint32Array(80);let yw=class extends Cp{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:r,Al:e,Bh:t,Bl:s,Ch:a,Cl:n,Dh:i,Dl:o,Eh:h,El:u,Fh:l,Fl:f,Gh:m,Gl:v,Hh:w,Hl:S}=this;return[r,e,t,s,a,n,i,o,h,u,l,f,m,v,w,S]}set(r,e,t,s,a,n,i,o,h,u,l,f,m,v,w,S){this.Ah=r|0,this.Al=e|0,this.Bh=t|0,this.Bl=s|0,this.Ch=a|0,this.Cl=n|0,this.Dh=i|0,this.Dl=o|0,this.Eh=h|0,this.El=u|0,this.Fh=l|0,this.Fl=f|0,this.Gh=m|0,this.Gl=v|0,this.Hh=w|0,this.Hl=S|0}process(r,e){for(let p=0;p<16;p++,e+=4)yr[p]=r.getUint32(e),vr[p]=r.getUint32(e+=4);for(let p=16;p<80;p++){const b=yr[p-15]|0,I=vr[p-15]|0,P=we.rotrSH(b,I,1)^we.rotrSH(b,I,8)^we.shrSH(b,I,7),x=we.rotrSL(b,I,1)^we.rotrSL(b,I,8)^we.shrSL(b,I,7),T=yr[p-2]|0,B=vr[p-2]|0,V=we.rotrSH(T,B,19)^we.rotrBH(T,B,61)^we.shrSH(T,B,6),J=we.rotrSL(T,B,19)^we.rotrBL(T,B,61)^we.shrSL(T,B,6),F=we.add4L(x,J,vr[p-7],vr[p-16]),D=we.add4H(F,P,V,yr[p-7],yr[p-16]);yr[p]=D|0,vr[p]=F|0}let{Ah:t,Al:s,Bh:a,Bl:n,Ch:i,Cl:o,Dh:h,Dl:u,Eh:l,El:f,Fh:m,Fl:v,Gh:w,Gl:S,Hh:y,Hl:k}=this;for(let p=0;p<80;p++){const b=we.rotrSH(l,f,14)^we.rotrSH(l,f,18)^we.rotrBH(l,f,41),I=we.rotrSL(l,f,14)^we.rotrSL(l,f,18)^we.rotrBL(l,f,41),P=l&m^~l&w,x=f&v^~f&S,T=we.add5L(k,I,x,hv[p],vr[p]),B=we.add5H(T,y,b,P,cv[p],yr[p]),V=T|0,J=we.rotrSH(t,s,28)^we.rotrBH(t,s,34)^we.rotrBH(t,s,39),F=we.rotrSL(t,s,28)^we.rotrBL(t,s,34)^we.rotrBL(t,s,39),D=t&a^t&i^a&i,j=s&n^s&o^n&o;y=w|0,k=S|0,w=m|0,S=v|0,m=l|0,v=f|0,{h:l,l:f}=we.add(h|0,u|0,B|0,V|0),h=i|0,u=o|0,i=a|0,o=n|0,a=t|0,n=s|0;const te=we.add3L(V,F,j);t=we.add3H(te,B,J,D),s=te|0}({h:t,l:s}=we.add(this.Ah|0,this.Al|0,t|0,s|0)),{h:a,l:n}=we.add(this.Bh|0,this.Bl|0,a|0,n|0),{h:i,l:o}=we.add(this.Ch|0,this.Cl|0,i|0,o|0),{h,l:u}=we.add(this.Dh|0,this.Dl|0,h|0,u|0),{h:l,l:f}=we.add(this.Eh|0,this.El|0,l|0,f|0),{h:m,l:v}=we.add(this.Fh|0,this.Fl|0,m|0,v|0),{h:w,l:S}=we.add(this.Gh|0,this.Gl|0,w|0,S|0),{h:y,l:k}=we.add(this.Hh|0,this.Hl|0,y|0,k|0),this.set(t,s,a,n,i,o,h,u,l,f,m,v,w,S,y,k)}roundClean(){yr.fill(0),vr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},mv=class extends yw{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}};const fv=wm(()=>new yw),pv=wm(()=>new mv),Ye=new ArrayBuffer(0),E="";class Ne extends TypeError{constructor(){super(...arguments),this.name=Ne.NAME}static isType(e,t){if(typeof t=="string"){if(t==="Array"&&Array.isArray(e)||t==="ArrayBuffer"&&e instanceof ArrayBuffer||t==="ArrayBufferView"&&ArrayBuffer.isView(e)||typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...s){for(const n of s)if(this.isType(e,n))return;const a=s.map(n=>n instanceof Function&&"name"in n?n.name:"".concat(n));throw new Ne("Parameter '".concat(t,"' is not of type ").concat(a.length>1?"(".concat(a.join(" or "),")"):a[0]))}}Ne.NAME="ArgumentError";class ve extends TypeError{static assert(...e){let t=null,s,a;typeof e[0]=="string"?(t=e[0],s=e[1],a=e.slice(2)):(s=e[0],a=e.slice(1)),Ne.assert(s,"parameters","object");for(const n of a)if(s[n]==null)throw new ve(n,t)}static assertEmpty(e,t,s){if(e==null)throw new ve(t,s)}constructor(e,t=null,s){super(),this.name=ve.NAME,this.field=e,t&&(this.target=t),s?this.message=s:this.message="Absent mandatory parameter '".concat(e,"' ").concat(t?" in '".concat(t,"'"):E)}}ve.NAME="ParameterError";class q extends Error{static assertSchema(e,t){if(!e.verified)throw new Error("Object's schema was not verified against input data for ".concat(t))}static assert(e,t){if(e.offset===-1)throw new q("Error during parsing of ASN.1 data. Data is not correct for '".concat(t,"'."))}constructor(e){super(e),this.name="AsnError"}}class _{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=Xe(e);q.assert(t,this.name);try{return new this({schema:t.result})}catch(s){throw new q("Cannot create '".concat(this.CLASS_NAME,"' from ASN.1 object"))}}static defaultValues(e){throw new Error("Invalid member name for ".concat(this.CLASS_NAME," class: ").concat(e))}static schema(e={}){throw new Error("Method '".concat(this.CLASS_NAME,".schema' should be overridden"))}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch(s){t=this.toSchema(!0)}return Ae.ToString(t.toBER(),e)}}_.CLASS_NAME="PkiObject";function oa(r){let e=!1,t=E;const s=r.trim();for(let a=0;a<s.length;a++)s.charCodeAt(a)===32?e===!1&&(e=!0):(e&&(t+=" ",e=!1),t+=s[a]);return t.toLowerCase()}const ru="type",Ym="value";class da extends _{constructor(e={}){super(),this.type=d(e,ru,da.defaultValues(ru)),this.value=d(e,Ym,da.defaultValues(Ym)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ru:return E;case Ym:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.type||E}),new le({name:t.value||E})]})}fromSchema(e){G(e,[ru,"typeValue"]);const t=z(e,e,da.schema({names:{type:ru,value:"typeValue"}}));q.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new O({value:[new ae({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return Object.keys(this.value).length!==0?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[_h.blockName(),Uf.blockName(),Rf.blockName(),ch.blockName(),er.blockName(),Tf.blockName(),wy.blockName(),Dg.blockName(),yy.blockName(),vy.blockName(),by.blockName(),Sy.blockName()];if(e instanceof ArrayBuffer)return Be.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===da.blockName()){if(this.type!==e.type)return!1;const s=[!1,!1],a=this.value.constructor.blockName();for(const n of t)a===n&&(s[0]=!0),e.value.constructor.blockName()===n&&(s[1]=!0);if(s[0]!==s[1])return!1;if(s[0]&&s[1]){const n=oa(this.value.valueBlock.value),i=oa(e.value.valueBlock.value);if(n.localeCompare(i)!==0)return!1}else if(!Be.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}da.CLASS_NAME="AttributeTypeAndValue";const Va="typesAndValues",jc="valueBeforeDecode",_d="RDN";class Ee extends _{constructor(e={}){super(),this.typesAndValues=d(e,Va,Ee.defaultValues(Va)),this.valueBeforeDecode=d(e,jc,Ee.defaultValues(jc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Va:return[];case jc:return Ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Va:return t.length===0;case jc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.repeatedSequence||E,value:new nt({value:[new me({name:t.repeatedSet||E,value:da.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){G(e,[_d,Va]);const t=z(e,e,Ee.schema({names:{blockName:_d,repeatedSet:Va}}));q.assertSchema(t,this.className),Va in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,s=>new da({schema:s}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(this.valueBeforeDecode.byteLength===0)return new O({value:[new nt({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=Xe(this.valueBeforeDecode);if(q.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof O))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof Ee){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,s]of this.typesAndValues.entries())if(s.isEqual(e.typesAndValues[t])===!1)return!1;return!0}return e instanceof ArrayBuffer?yc(this.valueBeforeDecode,e):!1}}Ee.CLASS_NAME="RelativeDistinguishedNames";const wu="type",yu="value";function dv(r={},e=!1){const t=d(r,"names",{});return new O({optional:e,value:[new L({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:t.country_name||E,value:[new je({value:[new ch,new er]})]}),new L({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:t.administration_domain_name||E,value:[new je({value:[new ch,new er]})]}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:t.network_address||E,isHexOnly:!0}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:t.terminal_identifier||E,isHexOnly:!0}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:t.private_domain_name||E,value:[new je({value:[new ch,new er]})]}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:t.organization_name||E,isHexOnly:!0}),new ue({optional:!0,name:t.numeric_user_identifier||E,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new L({optional:!0,name:t.personal_name||E,idBlock:{tagClass:3,tagNumber:5},value:[new ue({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new L({optional:!0,name:t.organizational_unit_names||E,idBlock:{tagClass:3,tagNumber:6},value:[new me({value:new er})]})]})}function gv(r=!1){return new O({optional:r,value:[new er,new er]})}function wv(r=!1){return new nt({optional:r,value:[new ue({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new le]})]})}class Se extends _{constructor(e={}){super(),this.type=d(e,wu,Se.defaultValues(wu)),this.value=d(e,yu,Se.defaultValues(yu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wu:return 9;case yu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wu:return t===Se.defaultValues(e);case yu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new je({value:[new L({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||E,value:[new ae,new L({idBlock:{tagClass:3,tagNumber:0},value:[new le]})]}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:1}}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:2}}),new L({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||E,value:[dv(t.builtInStandardAttributes||{},!1),gv(!0),wv(!0)]}),new L({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||E,value:[Ee.schema(t.directoryName||{})]}),new L({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||E,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new je({value:[new Tf,new er,new Rf,new _h,new Uf]})]}),new L({idBlock:{tagClass:3,tagNumber:1},value:[new je({value:[new Tf,new er,new Rf,new _h,new Uf]})]})]}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:6}}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:7}}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){G(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=z(e,e,Se.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(q.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=t.result.blockName;break;case 1:case 2:case 6:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=22;const a=s.toBER(!1),n=Xe(a);q.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value}break;case 3:this.value=t.result.blockName;break;case 4:this.value=new Ee({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new X({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=6;const a=s.toBER(!1),n=Xe(a);q.assert(n,"GeneralName registeredID"),this.value=n.result.valueBlock.toString()}break}}toSchema(){switch(this.type){case 0:case 3:case 5:return new L({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new Dg({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new L({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new ae({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return Se.schema()}}toJSON(){const e={type:this.type,value:E};if(typeof this.value=="string")e.value=this.value;else try{e.value=this.value.toJSON()}catch(t){}return e}}Se.CLASS_NAME="GeneralName";const vu="accessMethod",bu="accessLocation",yv=[vu,bu];class Mn extends _{constructor(e={}){super(),this.accessMethod=d(e,vu,Mn.defaultValues(vu)),this.accessLocation=d(e,bu,Mn.defaultValues(bu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vu:return E;case bu:return new Se;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.accessMethod||E}),Se.schema(t.accessLocation||{})]})}fromSchema(e){G(e,yv);const t=z(e,e,Mn.schema({names:{accessMethod:vu,accessLocation:{names:{blockName:bu}}}}));q.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new Se({schema:t.result.accessLocation})}toSchema(){return new O({value:[new ae({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}Mn.CLASS_NAME="AccessDescription";const Nr="seconds",Er="millis",kr="micros";class Qt extends _{constructor(e={}){super(),Nr in e&&(this.seconds=d(e,Nr,Qt.defaultValues(Nr))),Er in e&&(this.millis=d(e,Er,Qt.defaultValues(Er))),kr in e&&(this.micros=d(e,kr,Qt.defaultValues(kr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nr:case Er:case kr:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Nr:case Er:case kr:return t===Qt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,optional:!0,value:[new H({optional:!0,name:t.seconds||E}),new ue({name:t.millis||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new ue({name:t.micros||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){G(e,[Nr,Er,kr]);const t=z(e,e,Qt.schema({names:{seconds:Nr,millis:Er,micros:kr}}));if(q.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const s=new H({valueHex:t.result.millis.valueBlock.valueHex});this.millis=s.valueBlock.valueDec}if("micros"in t.result){const s=new H({valueHex:t.result.micros.valueBlock.valueHex});this.micros=s.valueBlock.valueDec}}toSchema(){const e=[];if(this.seconds!==void 0&&e.push(new H({value:this.seconds})),this.millis!==void 0){const t=new H({value:this.millis});e.push(new ue({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(this.micros!==void 0){const t=new H({value:this.micros});e.push(new ue({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new O({value:e})}toJSON(){const e={};return this.seconds!==void 0&&(e.seconds=this.seconds),this.millis!==void 0&&(e.millis=this.millis),this.micros!==void 0&&(e.micros=this.micros),e}}Qt.CLASS_NAME="Accuracy";const $c="algorithmId",au="algorithmParams",vw="algorithm",Jf="params",vv=[vw,Jf];class M extends _{constructor(e={}){super(),this.algorithmId=d(e,$c,M.defaultValues($c)),au in e&&(this.algorithmParams=d(e,au,M.defaultValues(au))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $c:return E;case au:return new le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $c:return t===E;case au:return t instanceof le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,optional:t.optional||!1,value:[new ae({name:t.algorithmIdentifier||E}),new le({name:t.algorithmParams||E,optional:!0})]})}fromSchema(e){G(e,vv);const t=z(e,e,M.schema({names:{algorithmIdentifier:vw,algorithmParams:Jf}}));q.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),Jf in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new ae({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof le)&&e.push(this.algorithmParams),new O({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof le)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return!(e instanceof M)||this.algorithmId!==e.algorithmId?!1:this.algorithmParams?e.algorithmParams?JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!1:!e.algorithmParams}}M.CLASS_NAME="AlgorithmIdentifier";const hi="altNames",bv=[hi];class qo extends _{constructor(e={}){super(),this.altNames=d(e,hi,qo.defaultValues(hi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hi:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.altNames||E,value:Se.schema()})]})}fromSchema(e){G(e,bv);const t=z(e,e,qo.schema({names:{altNames:hi}}));q.assertSchema(t,this.className),hi in t.result&&(this.altNames=Array.from(t.result.altNames,s=>new Se({schema:s})))}toSchema(){return new O({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}qo.CLASS_NAME="AltName";const mi="type",fi="values",Sv=[mi,fi];class Oe extends _{constructor(e={}){super(),this.type=d(e,mi,Oe.defaultValues(mi)),this.values=d(e,fi,Oe.defaultValues(fi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mi:return E;case fi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mi:return t===E;case fi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.type||E}),new nt({name:t.setName||E,value:[new me({name:t.values||E,value:new le})]})]})}fromSchema(e){G(e,Sv);const t=z(e,e,Oe.schema({names:{type:mi,values:fi}}));q.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new O({value:[new ae({value:this.type}),new nt({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}Oe.CLASS_NAME="Attribute";const Su="notBeforeTime",Au="notAfterTime",Av=[Su,Au];class Ns extends _{constructor(e={}){super(),this.notBeforeTime=d(e,Su,Ns.defaultValues(Su)),this.notAfterTime=d(e,Au,Ns.defaultValues(Au)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Su:case Au:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new $e({name:t.notBeforeTime||E}),new $e({name:t.notAfterTime||E})]})}fromSchema(e){G(e,Av);const t=z(e,e,Ns.schema({names:{notBeforeTime:Su,notAfterTime:Au}}));q.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new O({value:[new $e({valueDate:this.notBeforeTime}),new $e({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}Ns.CLASS_NAME="AttCertValidityPeriod";const nu="names",Gd="generalNames";class it extends _{constructor(e={}){super(),this.names=d(e,nu,it.defaultValues(nu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"names":return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,nu,{});return new O({optional:t,name:s.blockName||E,value:[new me({name:s.generalNames||E,value:Se.schema()})]})}fromSchema(e){G(e,[nu,Gd]);const t=z(e,e,it.schema({names:{blockName:nu,generalNames:Gd}}));q.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,s=>new Se({schema:s}))}toSchema(){return new O({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}it.CLASS_NAME="GeneralNames";const Nv="2.5.29.9",Ev="2.5.29.14",kv="2.5.29.15",Iv="2.5.29.16",bw="2.5.29.17",Sw="2.5.29.18",Vp="2.5.29.19",Cv="2.5.29.20",Vv="2.5.29.27",xv="2.5.29.21",Bv="2.5.29.24",Aw="2.5.29.28",Nw="2.5.29.29",Ew="2.5.29.30",kw="2.5.29.31",xp="2.5.29.46",Iw="2.5.29.32",as="2.5.29.32.0",Ov="1.3.6.1.4.1.311.21.10",Cw="2.5.29.33",Bp="2.5.29.35",Vw="2.5.29.36",Pv="2.5.29.37",Dv="2.5.29.54",Op="1.3.6.1.5.5.7.1.1",Tv="1.3.6.1.5.5.7.1.11",Rv="1.3.6.1.4.1.11129.2.4.2",Uv="1.3.6.1.4.1.311.21.7",Lv="1.3.6.1.4.1.311.21.1",jv="1.3.6.1.5.5.7.1.3",Pp="1.2.840.113549.1.7.1",xw="1.2.840.113549.1.7.2",Bw="1.2.840.113549.1.7.3",Ow="1.2.840.113549.1.7.6",$v="1.2.840.113549.1.9.16.1.4",zd="1.2.840.113549.1.9.22.1",Kv="1.2.840.113549.1.9.22.2",Xd="1.2.840.113549.1.9.22.3",Yd="1.2.840.113549.1.9.23.1",Mv="1.3.6.1.5.5.7",Hv="".concat(Mv,".48"),ph="".concat(Hv,".1.1"),Da="keyIdentifier",Ta="authorityCertIssuer",Ra="authorityCertSerialNumber",Fv=[Da,Ta,Ra];class ga extends _{constructor(e={}){super(),Da in e&&(this.keyIdentifier=d(e,Da,ga.defaultValues(Da))),Ta in e&&(this.authorityCertIssuer=d(e,Ta,ga.defaultValues(Ta))),Ra in e&&(this.authorityCertSerialNumber=d(e,Ra,ga.defaultValues(Ra))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Da:return new X;case Ta:return[];case Ra:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ue({name:t.keyIdentifier||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new me({name:t.authorityCertIssuer||E,value:Se.schema()})]}),new ue({name:t.authorityCertSerialNumber||E,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){G(e,Fv);const t=z(e,e,ga.schema({names:{keyIdentifier:Da,authorityCertIssuer:Ta,authorityCertSerialNumber:Ra}}));q.assertSchema(t,this.className),Da in t.result&&(this.keyIdentifier=new X({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),Ta in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,s=>new Se({schema:s}))),Ra in t.result&&(this.authorityCertSerialNumber=new H({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new ue({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new ue({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new O({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}ga.CLASS_NAME="AuthorityKeyIdentifier";const xa="pathLenConstraint",Ba="cA";class Hn extends _{constructor(e={}){super(),this.cA=d(e,Ba,!1),xa in e&&(this.pathLenConstraint=d(e,xa,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ba:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new Ia({optional:!0,name:t.cA||E}),new H({optional:!0,name:t.pathLenConstraint||E})]})}fromSchema(e){G(e,[Ba,xa]);const t=z(e,e,Hn.schema({names:{cA:Ba,pathLenConstraint:xa}}));q.assertSchema(t,this.className),Ba in t.result&&(this.cA=t.result.cA.valueBlock.value),xa in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==Hn.defaultValues(Ba)&&e.push(new Ia({value:this.cA})),xa in this&&(this.pathLenConstraint instanceof H?e.push(this.pathLenConstraint):e.push(new H({value:this.pathLenConstraint}))),new O({value:e})}toJSON(){const e={};return this.cA!==Hn.defaultValues(Ba)&&(e.cA=this.cA),xa in this&&(this.pathLenConstraint instanceof H?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}Hn.CLASS_NAME="BasicConstraints";const Qm="certificateIndex",Zm="keyIndex";class Sc extends _{constructor(e={}){super(),this.certificateIndex=d(e,Qm,Sc.defaultValues(Qm)),this.keyIndex=d(e,Zm,Sc.defaultValues(Zm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qm:case Zm:return 0;default:return super.defaultValues(e)}}static schema(){return new H}fromSchema(e){if(e.constructor.blockName()!==H.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const s=new Uint8Array(t);switch(!0){case t.byteLength<4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(s,4-t.byteLength),t=f.slice(0)}break;case t.byteLength>4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(s.slice(0,4)),t=f.slice(0)}break}const a=t.slice(0,2),n=new Uint8Array(a);let i=n[0];n[0]=n[1],n[1]=i;const o=new Uint16Array(a);this.keyIndex=o[0];const h=t.slice(2),u=new Uint8Array(h);i=u[0],u[0]=u[1],u[1]=i;const l=new Uint16Array(h);this.certificateIndex=l[0]}toSchema(){const e=new ArrayBuffer(2),t=new Uint16Array(e);t[0]=this.certificateIndex;const s=new Uint8Array(e);let a=s[0];s[0]=s[1],s[1]=a;const n=new ArrayBuffer(2),i=new Uint16Array(n);i[0]=this.keyIndex;const o=new Uint8Array(n);return a=o[0],o[0]=o[1],o[1]=a,new H({valueHex:Uo(n,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}Sc.CLASS_NAME="CAVersion";const Nu="policyQualifierId",Eu="qualifier",Jv=[Nu,Eu];class Fn extends _{constructor(e={}){super(),this.policyQualifierId=d(e,Nu,Fn.defaultValues(Nu)),this.qualifier=d(e,Eu,Fn.defaultValues(Eu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nu:return E;case Eu:return new le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.policyQualifierId||E}),new le({name:t.qualifier||E})]})}fromSchema(e){G(e,Jv);const t=z(e,e,Fn.schema({names:{policyQualifierId:Nu,qualifier:Eu}}));q.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new O({value:[new ae({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}Fn.CLASS_NAME="PolicyQualifierInfo";const ku="policyIdentifier",Ua="policyQualifiers",qv=[ku,Ua];class Jn extends _{constructor(e={}){super(),this.policyIdentifier=d(e,ku,Jn.defaultValues(ku)),Ua in e&&(this.policyQualifiers=d(e,Ua,Jn.defaultValues(Ua))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ku:return E;case Ua:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.policyIdentifier||E}),new O({optional:!0,value:[new me({name:t.policyQualifiers||E,value:Fn.schema()})]})]})}fromSchema(e){G(e,qv);const t=z(e,e,Jn.schema({names:{policyIdentifier:ku,policyQualifiers:Ua}}));q.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),Ua in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,s=>new Fn({schema:s})))}toSchema(){const e=[];return e.push(new ae({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new O({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}Jn.CLASS_NAME="PolicyInformation";const Iu="certificatePolicies",Wv=[Iu];class Wo extends _{constructor(e={}){super(),this.certificatePolicies=d(e,Iu,Wo.defaultValues(Iu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Iu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.certificatePolicies||E,value:Jn.schema()})]})}fromSchema(e){G(e,Wv);const t=z(e,e,Wo.schema({names:{certificatePolicies:Iu}}));q.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,s=>new Jn({schema:s}))}toSchema(){return new O({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}Wo.CLASS_NAME="CertificatePolicies";const Cu="templateID",$s="templateMajorVersion",Ks="templateMinorVersion",_v=[Cu,$s,Ks];class To extends _{constructor(e={}){super(),this.templateID=d(e,Cu,To.defaultValues(Cu)),$s in e&&(this.templateMajorVersion=d(e,$s,To.defaultValues($s))),Ks in e&&(this.templateMinorVersion=d(e,Ks,To.defaultValues(Ks))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cu:return E;case $s:case Ks:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.templateID||E}),new H({name:t.templateMajorVersion||E,optional:!0}),new H({name:t.templateMinorVersion||E,optional:!0})]})}fromSchema(e){G(e,_v);const t=z(e,e,To.schema({names:{templateID:Cu,templateMajorVersion:$s,templateMinorVersion:Ks}}));q.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),$s in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),Ks in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new ae({value:this.templateID})),$s in this&&e.push(new H({value:this.templateMajorVersion})),Ks in this&&e.push(new H({value:this.templateMinorVersion})),new O({value:e})}toJSON(){const e={templateID:this.templateID};return $s in this&&(e.templateMajorVersion=this.templateMajorVersion),Ks in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}const La="distributionPoint",Pw="distributionPointNames",ja="reasons",$a="cRLIssuer",Dw="cRLIssuerNames",Gv=[La,Pw,ja,$a,Dw];class wa extends _{constructor(e={}){super(),La in e&&(this.distributionPoint=d(e,La,wa.defaultValues(La))),ja in e&&(this.reasons=d(e,ja,wa.defaultValues(ja))),$a in e&&(this.cRLIssuer=d(e,$a,wa.defaultValues($a))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case La:return[];case ja:return new ye;case $a:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new je({value:[new L({name:t.distributionPoint||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:t.distributionPointNames||E,value:Se.schema()})]}),new L({name:t.distributionPoint||E,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Ee.schema().valueBlock.value})]})]}),new ue({name:t.reasons||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new L({name:t.cRLIssuer||E,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new me({name:t.cRLIssuerNames||E,value:Se.schema()})]})]})}fromSchema(e){G(e,Gv);const t=z(e,e,wa.schema({names:{distributionPoint:La,distributionPointNames:Pw,reasons:ja,cRLIssuer:$a,cRLIssuerNames:Dw}}));q.assertSchema(t,this.className),La in t.result&&(t.result.distributionPoint.idBlock.tagNumber===0&&(this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new Se({schema:s}))),t.result.distributionPoint.idBlock.tagNumber===1&&(this.distributionPoint=new Ee({schema:new O({value:t.result.distributionPoint.valueBlock.value})}))),ja in t.result&&(this.reasons=new ye({valueHex:t.result.reasons.valueBlock.valueHex})),$a in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,s=>new Se({schema:s})))}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new L({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):t=new L({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new ue({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new L({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}wa.CLASS_NAME="DistributionPoint";const Vu="distributionPoints",zv=[Vu];class _o extends _{constructor(e={}){super(),this.distributionPoints=d(e,Vu,_o.defaultValues(Vu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.distributionPoints||E,value:wa.schema()})]})}fromSchema(e){G(e,zv);const t=z(e,e,_o.schema({names:{distributionPoints:Vu}}));q.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,s=>new wa({schema:s}))}toSchema(){return new O({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}_o.CLASS_NAME="CRLDistributionPoints";const xu="keyPurposes",Xv=[xu];class Ac extends _{constructor(e={}){super(),this.keyPurposes=d(e,xu,Ac.defaultValues(xu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.keyPurposes||E,value:new ae})]})}fromSchema(e){G(e,Xv);const t=z(e,e,Ac.schema({names:{keyPurposes:xu}}));q.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,s=>s.valueBlock.toString())}toSchema(){return new O({value:Array.from(this.keyPurposes,e=>new ae({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}Ac.CLASS_NAME="ExtKeyUsage";const iu="accessDescriptions";class Go extends _{constructor(e={}){super(),this.accessDescriptions=d(e,iu,Go.defaultValues(iu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.accessDescriptions||E,value:Mn.schema()})]})}fromSchema(e){G(e,[iu]);const t=z(e,e,Go.schema({names:{accessDescriptions:iu}}));q.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,s=>new Mn({schema:s}))}toSchema(){return new O({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}Go.CLASS_NAME="InfoAccess";const Ka="distributionPoint",Tw="distributionPointNames",Ir="onlyContainsUserCerts",Cr="onlyContainsCACerts",Vr="onlySomeReasons",xr="indirectCRL",Br="onlyContainsAttributeCerts",Yv=[Ka,Tw,Ir,Cr,Vr,xr,Br];class dt extends _{constructor(e={}){super(),Ka in e&&(this.distributionPoint=d(e,Ka,dt.defaultValues(Ka))),this.onlyContainsUserCerts=d(e,Ir,dt.defaultValues(Ir)),this.onlyContainsCACerts=d(e,Cr,dt.defaultValues(Cr)),Vr in e&&(this.onlySomeReasons=d(e,Vr,dt.defaultValues(Vr))),this.indirectCRL=d(e,xr,dt.defaultValues(xr)),this.onlyContainsAttributeCerts=d(e,Br,dt.defaultValues(Br)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ka:return[];case Ir:return!1;case Cr:return!1;case Vr:return 0;case xr:return!1;case Br:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new je({value:[new L({name:t.distributionPoint||E,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:t.distributionPointNames||E,value:Se.schema()})]}),new L({name:t.distributionPoint||E,idBlock:{tagClass:3,tagNumber:1},value:Ee.schema().valueBlock.value})]})]}),new ue({name:t.onlyContainsUserCerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new ue({name:t.onlyContainsCACerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new ue({name:t.onlySomeReasons||E,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new ue({name:t.indirectCRL||E,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new ue({name:t.onlyContainsAttributeCerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){G(e,Yv);const t=z(e,e,dt.schema({names:{distributionPoint:Ka,distributionPointNames:Tw,onlyContainsUserCerts:Ir,onlyContainsCACerts:Cr,onlySomeReasons:Vr,indirectCRL:xr,onlyContainsAttributeCerts:Br}}));if(q.assertSchema(t,this.className),Ka in t.result)switch(!0){case t.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new Se({schema:s}));break;case t.result.distributionPoint.idBlock.tagNumber===1:this.distributionPoint=new Ee({schema:new O({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(Ir in t.result){const s=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=s[0]!==0}if(Cr in t.result){const s=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=s[0]!==0}if(Vr in t.result){const s=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=s[0]}if(xr in t.result){const s=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=s[0]!==0}if(Br in t.result){const s=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=s[0]!==0}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new L({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==dt.defaultValues(Ir)&&e.push(new ue({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==dt.defaultValues(Cr)&&e.push(new ue({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),this.onlySomeReasons!==void 0){const t=new ArrayBuffer(1),s=new Uint8Array(t);s[0]=this.onlySomeReasons,e.push(new ue({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==dt.defaultValues(xr)&&e.push(new ue({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==dt.defaultValues(Br)&&e.push(new ue({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new O({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==dt.defaultValues(Ir)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==dt.defaultValues(Cr)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),Vr in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==dt.defaultValues(xr)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==dt.defaultValues(Br)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}dt.CLASS_NAME="IssuingDistributionPoint";const Bu="base",pi="minimum",Or="maximum",Qv=[Bu,pi,Or];class Ps extends _{constructor(e={}){super(),this.base=d(e,Bu,Ps.defaultValues(Bu)),this.minimum=d(e,pi,Ps.defaultValues(pi)),Or in e&&(this.maximum=d(e,Or,Ps.defaultValues(Or))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bu:return new Se;case pi:return 0;case Or:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Se.schema(t.base||{}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:t.minimum||E})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new H({name:t.maximum||E})]})]})}fromSchema(e){G(e,Qv);const t=z(e,e,Ps.schema({names:{base:{names:{blockName:Bu}},minimum:pi,maximum:Or}}));q.assertSchema(t,this.className),this.base=new Se({schema:t.result.base}),pi in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),Or in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),this.minimum!==0){let t=0;this.minimum instanceof H?t=this.minimum:t=new H({value:this.minimum}),e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(Or in this){let t=0;this.maximum instanceof H?t=this.maximum:t=new H({value:this.maximum}),e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new O({value:e})}toJSON(){const e={base:this.base.toJSON()};return this.minimum!==0&&(typeof this.minimum=="number"?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),this.maximum!==void 0&&(typeof this.maximum=="number"?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}Ps.CLASS_NAME="GeneralSubtree";const Ma="permittedSubtrees",Ha="excludedSubtrees",Zv=[Ma,Ha];class jo extends _{constructor(e={}){super(),Ma in e&&(this.permittedSubtrees=d(e,Ma,jo.defaultValues(Ma))),Ha in e&&(this.excludedSubtrees=d(e,Ha,jo.defaultValues(Ha))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ma:case Ha:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:t.permittedSubtrees||E,value:Ps.schema()})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new me({name:t.excludedSubtrees||E,value:Ps.schema()})]})]})}fromSchema(e){G(e,Zv);const t=z(e,e,jo.schema({names:{permittedSubtrees:Ma,excludedSubtrees:Ha}}));q.assertSchema(t,this.className),Ma in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,s=>new Ps({schema:s}))),Ha in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,s=>new Ps({schema:s})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}jo.CLASS_NAME="NameConstraints";const Ms="requireExplicitPolicy",Hs="inhibitPolicyMapping",eb=[Ms,Hs];class $o extends _{constructor(e={}){super(),Ms in e&&(this.requireExplicitPolicy=d(e,Ms,$o.defaultValues(Ms))),Hs in e&&(this.inhibitPolicyMapping=d(e,Hs,$o.defaultValues(Hs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ms:return 0;case Hs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ue({name:t.requireExplicitPolicy||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new ue({name:t.inhibitPolicyMapping||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){G(e,eb);const t=z(e,e,$o.schema({names:{requireExplicitPolicy:Ms,inhibitPolicyMapping:Hs}}));if(q.assertSchema(t,this.className),Ms in t.result){const s=t.result.requireExplicitPolicy;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=Xe(a);q.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(Hs in t.result){const s=t.result.inhibitPolicyMapping;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=Xe(a);q.assert(n,"Integer"),this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if(Ms in this){const t=new H({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(Hs in this){const t=new H({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new O({value:e})}toJSON(){const e={};return Ms in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),Hs in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}$o.CLASS_NAME="PolicyConstraints";const Ou="issuerDomainPolicy",Pu="subjectDomainPolicy",tb=[Ou,Pu];class qn extends _{constructor(e={}){super(),this.issuerDomainPolicy=d(e,Ou,qn.defaultValues(Ou)),this.subjectDomainPolicy=d(e,Pu,qn.defaultValues(Pu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ou:return E;case Pu:return E;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.issuerDomainPolicy||E}),new ae({name:t.subjectDomainPolicy||E})]})}fromSchema(e){G(e,tb);const t=z(e,e,qn.schema({names:{issuerDomainPolicy:Ou,subjectDomainPolicy:Pu}}));q.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new O({value:[new ae({value:this.issuerDomainPolicy}),new ae({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}qn.CLASS_NAME="PolicyMapping";const Du="mappings",sb=[Du];class Nc extends _{constructor(e={}){super(),this.mappings=d(e,Du,Nc.defaultValues(Du)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Du:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.mappings||E,value:qn.schema()})]})}fromSchema(e){G(e,sb);const t=z(e,e,Nc.schema({names:{mappings:Du}}));q.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,s=>new qn({schema:s}))}toSchema(){return new O({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}Nc.CLASS_NAME="PolicyMappings";const Pr="notBefore",Dr="notAfter",rb=[Pr,Dr];class Ko extends _{constructor(e={}){super(),Pr in e&&(this.notBefore=d(e,Pr,Ko.defaultValues(Pr))),Dr in e&&(this.notAfter=d(e,Dr,Ko.defaultValues(Dr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pr:return new Date;case Dr:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ue({name:t.notBefore||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new ue({name:t.notAfter||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){G(e,rb);const t=z(e,e,Ko.schema({names:{notBefore:Pr,notAfter:Dr}}));if(q.assertSchema(t,this.className),Pr in t.result){const s=new $e;s.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=s.toDate()}if(Dr in t.result){const s=new $e({valueHex:t.result.notAfter.valueBlock.valueHex});s.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=s.toDate()}}toSchema(){const e=[];return Pr in this&&e.push(new ue({idBlock:{tagClass:3,tagNumber:0},valueHex:new $e({valueDate:this.notBefore}).valueBlock.valueHexView})),Dr in this&&e.push(new ue({idBlock:{tagClass:3,tagNumber:1},valueHex:new $e({valueDate:this.notAfter}).valueBlock.valueHexView})),new O({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}Ko.CLASS_NAME="PrivateKeyUsagePeriod";const di="id",Fs="type",gi="values",ab=[di,Fs],nb=[gi];class Wn extends _{constructor(e={}){super(),this.id=d(e,di,Wn.defaultValues(di)),Fs in e&&(this.type=d(e,Fs,Wn.defaultValues(Fs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case di:return E;case Fs:return new at;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case di:return t===E;case Fs:return t instanceof at;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.id||E}),new le({name:t.type||E,optional:!0})]})}fromSchema(e){G(e,ab);const t=z(e,e,Wn.schema({names:{id:di,type:Fs}}));q.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),Fs in t.result&&(this.type=t.result.type)}toSchema(){const e=[new ae({value:this.id})];return Fs in this&&e.push(this.type),new O({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}Wn.CLASS_NAME="QCStatement";class Ec extends _{constructor(e={}){super(),this.values=d(e,gi,Ec.defaultValues(gi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case gi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.values||E,value:Wn.schema(t.value||{})})]})}fromSchema(e){G(e,nb);const t=z(e,e,Ec.schema({names:{values:gi}}));q.assertSchema(t,this.className),this.values=Array.from(t.result.values,s=>new Wn({schema:s}))}toSchema(){return new O({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}Ec.CLASS_NAME="QCStatements";var Oa;class Aa{static register(e,t,s){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:s}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}Oa=Aa,Aa.namedCurves={},Oa.register("P-256","1.2.840.10045.3.1.7",32),Oa.register("P-384","1.3.132.0.34",48),Oa.register("P-521","1.3.132.0.35",66),Oa.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),Oa.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),Oa.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const Kc="x",Mc="y",Hc="namedCurve";class $t extends _{constructor(e={}){super(),this.x=d(e,Kc,$t.defaultValues(Kc)),this.y=d(e,Mc,$t.defaultValues(Mc)),this.namedCurve=d(e,Hc,$t.defaultValues(Hc)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Kc:case Mc:return Ye;case Hc:return E;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Kc:case Mc:return t instanceof ArrayBuffer&&yc(t,$t.defaultValues(e));case Hc:return typeof t=="string"&&t===$t.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new Wh}fromSchema(e){const t=Be.toUint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");const s=Aa.find(this.namedCurve);if(!s)throw new Error("Incorrect curve OID: ".concat(this.namedCurve));const a=s.size;if(t.byteLength!==a*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=s.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,a*2+1).buffer}toSchema(){return new Wh({data:Uo(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=Aa.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:Pf(qh(this.x),!0,!0,!1),y:Pf(qh(this.y),!0,!0,!1)}}fromJSON(e){ve.assert("json",e,"crv","x","y");let t=0;const s=Aa.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=Jo(wc(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const i=new Uint8Array(this.x),o=new Uint8Array(a);i.set(o,1)}else this.x=a.slice(0,t);const n=Jo(wc(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const i=new Uint8Array(this.y),o=new Uint8Array(n);i.set(o,1)}else this.y=n.slice(0,t)}}$t.CLASS_NAME="ECPublicKey";const Tu="modulus",Ru="publicExponent",ib=[Tu,Ru];class _n extends _{constructor(e={}){super(),this.modulus=d(e,Tu,_n.defaultValues(Tu)),this.publicExponent=d(e,Ru,_n.defaultValues(Ru)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tu:return new H;case Ru:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.modulus||E}),new H({name:t.publicExponent||E})]})}fromSchema(e){G(e,ib);const t=z(e,e,_n.schema({names:{modulus:Tu,publicExponent:Ru}}));q.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new O({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:Ae.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ae.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){ve.assert("json",e,"n","e");const t=Jo(wc(e.n,!0));this.modulus=new H({valueHex:t.slice(0,Math.pow(2,gy(t.byteLength)))}),this.publicExponent=new H({valueHex:Jo(wc(e.e,!0)).slice(0,3)})}}_n.CLASS_NAME="RSAPublicKey";const Uu="algorithm",Lu="subjectPublicKey",ob=[Uu,Lu];class Ht extends _{get parsedKey(){if(this._parsedKey===void 0){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===ae.blockName())try{this._parsedKey=new $t({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":{const e=Xe(this.subjectPublicKey.valueBlock.valueHexView);if(e.offset!==-1)try{this._parsedKey=new _n({schema:e.result})}catch(t){}}break}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=d(e,Uu,Ht.defaultValues(Uu)),this.subjectPublicKey=d(e,Lu,Ht.defaultValues(Lu));const t=d(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uu:return new M;case Lu:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.algorithm||{}),new ye({name:t.subjectPublicKey||E})]})}fromSchema(e){G(e,ob);const t=z(e,e,Ht.schema({names:{algorithm:{names:{blockName:Uu}},subjectPublicKey:Lu}}));q.assertSchema(t,this.className),this.algorithm=new M({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new O({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new $t({json:e}),this.algorithm=new M({algorithmId:"1.2.840.10045.2.1",algorithmParams:new ae({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new _n({json:e}),this.algorithm=new M({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new at});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.subjectPublicKey=new ye({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=fe(!0)){try{if(!e)throw new Error("Need to provide publicKey input parameter");const s=await t.exportKey("spki",e),a=Xe(s);try{this.fromSchema(a.result)}catch(n){throw new Error("Error during initializing object from schema")}}catch(s){const a=s instanceof Error?s.message:"".concat(s);throw new Error("Error during exporting public key: ".concat(a))}}}Ht.CLASS_NAME="PublicKeyInfo";const wi="version",yi="privateKey",ds="namedCurve",Tr="publicKey",ub=[wi,yi,ds,Tr];class is extends _{constructor(e={}){super(),this.version=d(e,wi,is.defaultValues(wi)),this.privateKey=d(e,yi,is.defaultValues(yi)),ds in e&&(this.namedCurve=d(e,ds,is.defaultValues(ds))),Tr in e&&(this.publicKey=d(e,Tr,is.defaultValues(Tr))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wi:return 1;case yi:return new X;case ds:return E;case Tr:return new $t;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wi:return t===is.defaultValues(e);case yi:return t.isEqual(is.defaultValues(e));case ds:return t===E;case Tr:return $t.compareWithDefault(ds,t.namedCurve)&&$t.compareWithDefault("x",t.x)&&$t.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new X({name:t.privateKey||E}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ae({name:t.namedCurve||E})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ye({name:t.publicKey||E})]})]})}fromSchema(e){G(e,ub);const t=z(e,e,is.schema({names:{version:wi,privateKey:yi,namedCurve:ds,publicKey:Tr}}));if(q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,ds in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),Tr in t.result){const s={schema:t.result.publicKey.valueBlock.valueHex};ds in this&&(s.namedCurve=this.namedCurve),this.publicKey=new $t(s)}}toSchema(){const e=[new H({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[new ae({value:this.namedCurve})]})),this.publicKey&&e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[new ye({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new O({value:e})}toJSON(){if(!this.namedCurve||is.compareWithDefault(ds,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=Aa.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:Ae.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const s=this.publicKey.toJSON();t.x=s.x,t.y=s.y}return t}fromJSON(e){ve.assert("json",e,"crv","d");let t=0;const s=Aa.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=Ae.FromBase64Url(e.d);if(a.byteLength<t){const n=new ArrayBuffer(t),i=new Uint8Array(n),o=new Uint8Array(a);i.set(o,1),this.privateKey=new X({valueHex:n})}else this.privateKey=new X({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new $t({json:e}))}}is.CLASS_NAME="ECPrivateKey";const ju="prime",$u="exponent",Ku="coefficient",lb=[ju,$u,Ku];class tr extends _{constructor(e={}){super(),this.prime=d(e,ju,tr.defaultValues(ju)),this.exponent=d(e,$u,tr.defaultValues($u)),this.coefficient=d(e,Ku,tr.defaultValues(Ku)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ju:return new H;case $u:return new H;case Ku:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.prime||E}),new H({name:t.exponent||E}),new H({name:t.coefficient||E})]})}fromSchema(e){G(e,lb);const t=z(e,e,tr.schema({names:{prime:ju,exponent:$u,coefficient:Ku}}));q.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new O({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:Ae.ToBase64Url(this.prime.valueBlock.valueHexView),d:Ae.ToBase64Url(this.exponent.valueBlock.valueHexView),t:Ae.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){ve.assert("json",e,"r","d","r"),this.prime=new H({valueHex:Ae.FromBase64Url(e.r)}),this.exponent=new H({valueHex:Ae.FromBase64Url(e.d)}),this.coefficient=new H({valueHex:Ae.FromBase64Url(e.t)})}}tr.CLASS_NAME="OtherPrimeInfo";const Mu="version",Hu="modulus",Fu="publicExponent",Ju="privateExponent",qu="prime1",Wu="prime2",_u="exponent1",Gu="exponent2",zu="coefficient",Fa="otherPrimeInfos",cb=[Mu,Hu,Fu,Ju,qu,Wu,_u,Gu,zu,Fa];class Dt extends _{constructor(e={}){super(),this.version=d(e,Mu,Dt.defaultValues(Mu)),this.modulus=d(e,Hu,Dt.defaultValues(Hu)),this.publicExponent=d(e,Fu,Dt.defaultValues(Fu)),this.privateExponent=d(e,Ju,Dt.defaultValues(Ju)),this.prime1=d(e,qu,Dt.defaultValues(qu)),this.prime2=d(e,Wu,Dt.defaultValues(Wu)),this.exponent1=d(e,_u,Dt.defaultValues(_u)),this.exponent2=d(e,Gu,Dt.defaultValues(Gu)),this.coefficient=d(e,zu,Dt.defaultValues(zu)),Fa in e&&(this.otherPrimeInfos=d(e,Fa,Dt.defaultValues(Fa))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mu:return 0;case Hu:return new H;case Fu:return new H;case Ju:return new H;case qu:return new H;case Wu:return new H;case _u:return new H;case Gu:return new H;case zu:return new H;case Fa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new H({name:t.modulus||E}),new H({name:t.publicExponent||E}),new H({name:t.privateExponent||E}),new H({name:t.prime1||E}),new H({name:t.prime2||E}),new H({name:t.exponent1||E}),new H({name:t.exponent2||E}),new H({name:t.coefficient||E}),new O({optional:!0,value:[new me({name:t.otherPrimeInfosName||E,value:tr.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){G(e,cb);const t=z(e,e,Dt.schema({names:{version:Mu,modulus:Hu,publicExponent:Fu,privateExponent:Ju,prime1:qu,prime2:Wu,exponent1:_u,exponent2:Gu,coefficient:zu,otherPrimeInfo:{names:{blockName:Fa}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),Fa in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,s=>new tr({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new O({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={n:Ae.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ae.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:Ae.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:Ae.ToBase64Url(this.prime1.valueBlock.valueHexView),q:Ae.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:Ae.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:Ae.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:Ae.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){ve.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new H({valueHex:Ae.FromBase64Url(e.n)}),this.publicExponent=new H({valueHex:Ae.FromBase64Url(e.e)}),this.privateExponent=new H({valueHex:Ae.FromBase64Url(e.d)}),this.prime1=new H({valueHex:Ae.FromBase64Url(e.p)}),this.prime2=new H({valueHex:Ae.FromBase64Url(e.q)}),this.exponent1=new H({valueHex:Ae.FromBase64Url(e.dp)}),this.exponent2=new H({valueHex:Ae.FromBase64Url(e.dq)}),this.coefficient=new H({valueHex:Ae.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new tr({json:t})))}}Dt.CLASS_NAME="RSAPrivateKey";const Xu="version",Yu="privateKeyAlgorithm",Qu="privateKey",Ja="attributes",Fc="parsedKey",hb=[Xu,Yu,Qu,Ja];class us extends _{constructor(e={}){super(),this.version=d(e,Xu,us.defaultValues(Xu)),this.privateKeyAlgorithm=d(e,Yu,us.defaultValues(Yu)),this.privateKey=d(e,Qu,us.defaultValues(Qu)),Ja in e&&(this.attributes=d(e,Ja,us.defaultValues(Ja))),Fc in e&&(this.parsedKey=d(e,Fc,us.defaultValues(Fc))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xu:return 0;case Yu:return new M;case Qu:return new X;case Ja:return[];case Fc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),M.schema(t.privateKeyAlgorithm||{}),new X({name:t.privateKey||E}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:t.attributes||E,value:Oe.schema()})]})]})}fromSchema(e){G(e,hb);const t=z(e,e,us.schema({names:{version:Xu,privateKeyAlgorithm:{names:{blockName:Yu}},privateKey:Qu,attributes:Ja}}));switch(q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new M({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,Ja in t.result&&(this.attributes=Array.from(t.result.attributes,s=>new Oe({schema:s}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const s=Xe(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new Dt({schema:s.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof ae){const s=Xe(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new is({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:s.result}))}break}}toSchema(){const e=[new H({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new O({value:e})}toJSON(){if(!this.parsedKey){const s={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(s.attributes=Array.from(this.attributes,a=>a.toJSON())),s}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new is({json:e}),this.privateKeyAlgorithm=new M({algorithmId:"1.2.840.10045.2.1",algorithmParams:new ae({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Dt({json:e}),this.privateKeyAlgorithm=new M({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new at});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.privateKey=new X({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}us.CLASS_NAME="PrivateKeyInfo";const vi="contentType",bi="contentEncryptionAlgorithm",qa="encryptedContent",mb=[vi,bi,qa],Qd=1024;class We extends _{constructor(e={}){if(super(),this.contentType=d(e,vi,We.defaultValues(vi)),this.contentEncryptionAlgorithm=d(e,bi,We.defaultValues(bi)),qa in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4&&this.encryptedContent.idBlock.isConstructed===!1&&!e.disableSplit)){const t=new X({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,s,s+Qd>a.byteLength?a.byteLength-s:Qd),o=new ArrayBuffer(i.length),h=new Uint8Array(o);for(let u=0;u<h.length;u++)h[u]=i[u];t.valueBlock.value.push(new X({valueHex:o})),n-=i.length,s+=i.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vi:return E;case bi:return new M;case qa:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vi:return t===E;case bi:return t.algorithmId===E&&!("algorithmParams"in t);case qa:return t.isEqual(We.defaultValues(qa));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.contentType||E}),M.schema(t.contentEncryptionAlgorithm||{}),new je({value:[new L({name:t.encryptedContent||E,idBlock:{tagClass:3,tagNumber:0},value:[new me({value:new X})]}),new ue({name:t.encryptedContent||E,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){G(e,mb);const t=z(e,e,We.schema({names:{contentType:vi,contentEncryptionAlgorithm:{names:{blockName:bi}},encryptedContent:qa}}));q.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new M({schema:t.result.contentEncryptionAlgorithm}),qa in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new ae({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const s=this.encryptedContent;s.idBlock.tagClass=3,s.idBlock.tagNumber=0,s.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(s)}return new O({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return X.prototype.getValue.call(this.encryptedContent)}}We.CLASS_NAME="EncryptedContentInfo";const Rr="hashAlgorithm",Ur="maskGenAlgorithm",Lr="saltLength",jr="trailerField",fb=[Rr,Ur,Lr,jr];class wt extends _{constructor(e={}){super(),this.hashAlgorithm=d(e,Rr,wt.defaultValues(Rr)),this.maskGenAlgorithm=d(e,Ur,wt.defaultValues(Ur)),this.saltLength=d(e,Lr,wt.defaultValues(Lr)),this.trailerField=d(e,jr,wt.defaultValues(jr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rr:return new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new at});case Ur:return new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new at}).toSchema()});case Lr:return 20;case jr:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[M.schema(t.hashAlgorithm||{})]}),new L({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[M.schema(t.maskGenAlgorithm||{})]}),new L({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new H({name:t.saltLength||E})]}),new L({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new H({name:t.trailerField||E})]})]})}fromSchema(e){G(e,fb);const t=z(e,e,wt.schema({names:{hashAlgorithm:{names:{blockName:Rr}},maskGenAlgorithm:{names:{blockName:Ur}},saltLength:Lr,trailerField:jr}}));q.assertSchema(t,this.className),Rr in t.result&&(this.hashAlgorithm=new M({schema:t.result.hashAlgorithm})),Ur in t.result&&(this.maskGenAlgorithm=new M({schema:t.result.maskGenAlgorithm})),Lr in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),jr in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(wt.defaultValues(Rr))||e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(wt.defaultValues(Ur))||e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==wt.defaultValues(Lr)&&e.push(new L({idBlock:{tagClass:3,tagNumber:2},value:[new H({value:this.saltLength})]})),this.trailerField!==wt.defaultValues(jr)&&e.push(new L({idBlock:{tagClass:3,tagNumber:3},value:[new H({value:this.trailerField})]})),new O({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(wt.defaultValues(Rr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(wt.defaultValues(Ur))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==wt.defaultValues(Lr)&&(e.saltLength=this.saltLength),this.trailerField!==wt.defaultValues(jr)&&(e.trailerField=this.trailerField),e}}wt.CLASS_NAME="RSASSAPSSParams";const Si="salt",Zu="iterationCount",gs="keyLength",Js="prf",pb=[Si,Zu,gs,Js];class Bt extends _{constructor(e={}){super(),this.salt=d(e,Si,Bt.defaultValues(Si)),this.iterationCount=d(e,Zu,Bt.defaultValues(Zu)),gs in e&&(this.keyLength=d(e,gs,Bt.defaultValues(gs))),Js in e&&(this.prf=d(e,Js,Bt.defaultValues(Js))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Si:return{};case Zu:return-1;case gs:return 0;case Js:return new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new at});default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new je({value:[new X({name:t.saltPrimitive||E}),M.schema(t.saltConstructed||{})]}),new H({name:t.iterationCount||E}),new H({name:t.keyLength||E,optional:!0}),M.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){G(e,pb);const t=z(e,e,Bt.schema({names:{saltPrimitive:Si,saltConstructed:{names:{blockName:Si}},iterationCount:Zu,keyLength:gs,prf:{names:{blockName:Js,optional:!0}}}}));q.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,gs in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),Js in t.result&&(this.prf=new M({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new H({value:this.iterationCount})),gs in this&&Bt.defaultValues(gs)!==this.keyLength&&e.push(new H({value:this.keyLength})),this.prf&&Bt.defaultValues(Js).isEqual(this.prf)===!1&&e.push(this.prf.toSchema()),new O({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return gs in this&&Bt.defaultValues(gs)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&Bt.defaultValues(Js).isEqual(this.prf)===!1&&(e.prf=this.prf.toJSON()),e}}Bt.CLASS_NAME="PBKDF2Params";const el="keyDerivationFunc",tl="encryptionScheme",db=[el,tl];class Gn extends _{constructor(e={}){super(),this.keyDerivationFunc=d(e,el,Gn.defaultValues(el)),this.encryptionScheme=d(e,tl,Gn.defaultValues(tl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case el:return new M;case tl:return new M;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.keyDerivationFunc||{}),M.schema(t.encryptionScheme||{})]})}fromSchema(e){G(e,db);const t=z(e,e,Gn.schema({names:{keyDerivationFunc:{names:{blockName:el}},encryptionScheme:{names:{blockName:tl}}}}));q.assertSchema(t,this.className),this.keyDerivationFunc=new M({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new M({schema:t.result.encryptionScheme})}toSchema(){return new O({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}Gn.CLASS_NAME="PBES2Params";class gb{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=d(e,"name",E)}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){return this.crypto.getRandomValues(e)}}async function Zd(r,e,t,s,a){let n,i,o;switch(r.toUpperCase()){case"SHA-1":n=20,i=64,o=$1;break;case"SHA-256":n=32,i=64,o=H1;break;case"SHA-384":n=48,i=128,o=pv;break;case"SHA-512":n=64,i=128,o=fv;break;default:throw new Error("Unsupported hashing algorithm")}const h=new Uint8Array(t);let u=new TextDecoder().decode(t);new TextEncoder().encode(u).some((b,I)=>b!==h[I])&&(u=String.fromCharCode(...h));const l=new Uint8Array(u.length*2+2),f=new DataView(l.buffer);for(let b=0;b<u.length;b++)f.setUint16(b*2,u.charCodeAt(b),!1);f.setUint16(u.length*2,0,!1);const m=new Uint8Array(i).fill(3),v=new Uint8Array(s),w=new Uint8Array(i*Math.ceil(v.length/i)).map((b,I)=>v[I%v.length]),S=new Uint8Array(i*Math.ceil(l.length/i)).map((b,I)=>l[I%l.length]);let y=new Uint8Array(w.length+S.length);y.set(w),y.set(S,w.length);const k=Math.ceil((e>>3)/n),p=[];for(let b=0;b<k;b++){let I=new Uint8Array(m.length+y.length);I.set(m),I.set(y,m.length);for(let B=0;B<a;B++)I=o(I);const P=new Uint8Array(i).map((B,V)=>I[V%I.length]),x=Math.ceil(v.length/i)+Math.ceil(l.length/i),T=[];for(let B=0;B<x;B++){const V=Array.from(y.slice(B*i,(B+1)*i));let J=511;for(let F=P.length-1;F>=0;F--)J>>=8,J+=P[F]+(V[F]||0),V[F]=J&255;T.push(...V)}y=new Uint8Array(T),p.push(...I)}return new Uint8Array(p.slice(0,e>>3)).buffer}function Rw(r){const e=typeof r=="string"?{name:r}:r;return"hash"in e?fr(Gt({},e),{hash:Rw(e.hash)}):e}class kc extends gb{async importKey(e,t,s,a,n){var i,o,h,u,l,f;let m={};const v=Rw(s);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,s,a,n);case"spki":{const w=Xe(Be.toArrayBuffer(t));q.assert(w,"keyData");const S=new Ht;try{S.fromSchema(w.result)}catch(y){throw new Ne("Incorrect keyData")}switch(v.name.toUpperCase()){case"RSA-PSS":{if(!v.hash)throw new ve("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":m.alg="PS1";break;case"SHA-256":m.alg="PS256";break;case"SHA-384":m.alg="PS384";break;case"SHA-512":m.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(v.hash.name.toUpperCase()))}}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],m.kty="RSA",m.ext=a,m.key_ops=n,S.algorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect public key algorithm: ".concat(S.algorithm.algorithmId));if(!m.alg){if(!v.hash)throw new ve("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":m.alg="RS1";break;case"SHA-256":m.alg="RS256";break;case"SHA-384":m.alg="RS384";break;case"SHA-512":m.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(v.hash.name.toUpperCase()))}}const y=S.toJSON();Object.assign(m,y)}break;case"ECDSA":n=["verify"];case"ECDH":{if(m={kty:"EC",ext:a,key_ops:n},S.algorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect public key algorithm: ".concat(S.algorithm.algorithmId));const y=S.toJSON();Object.assign(m,y)}break;case"RSA-OAEP":{if(m.kty="RSA",m.ext=a,m.key_ops=n,this.name.toLowerCase()==="safari")m.alg="RSA-OAEP";else{if(!v.hash)throw new ve("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":m.alg="RSA-OAEP";break;case"SHA-256":m.alg="RSA-OAEP-256";break;case"SHA-384":m.alg="RSA-OAEP-384";break;case"SHA-512":m.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat(v.hash.name.toUpperCase()))}}const y=S.toJSON();Object.assign(m,y)}break;case"RSAES-PKCS1-V1_5":{m.kty="RSA",m.ext=a,m.key_ops=n,m.alg="PS1";const y=S.toJSON();Object.assign(m,y)}break;default:throw new Error("Incorrect algorithm name: ".concat(v.name.toUpperCase()))}}break;case"pkcs8":{const w=new us,S=Xe(Be.toArrayBuffer(t));q.assert(S,"keyData");try{w.fromSchema(S.result)}catch(y){throw new Error("Incorrect keyData")}if(!w.parsedKey)throw new Error("Incorrect keyData");switch(v.name.toUpperCase()){case"RSA-PSS":switch((i=v.hash)===null||i===void 0?void 0:i.name.toUpperCase()){case"SHA-1":m.alg="PS1";break;case"SHA-256":m.alg="PS256";break;case"SHA-384":m.alg="PS384";break;case"SHA-512":m.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((o=v.hash)===null||o===void 0?void 0:o.name.toUpperCase()))}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],m.kty="RSA",m.ext=a,m.key_ops=n,w.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect private key algorithm: ".concat(w.privateKeyAlgorithm.algorithmId));if(!("alg"in m))switch((h=v.hash)===null||h===void 0?void 0:h.name.toUpperCase()){case"SHA-1":m.alg="RS1";break;case"SHA-256":m.alg="RS256";break;case"SHA-384":m.alg="RS384";break;case"SHA-512":m.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((u=v.hash)===null||u===void 0?void 0:u.name.toUpperCase()))}const y=w.toJSON();Object.assign(m,y)}break;case"ECDSA":n=["sign"];case"ECDH":{if(m={kty:"EC",ext:a,key_ops:n},w.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect algorithm: ".concat(w.privateKeyAlgorithm.algorithmId));const y=w.toJSON();Object.assign(m,y)}break;case"RSA-OAEP":{if(m.kty="RSA",m.ext=a,m.key_ops=n,this.name.toLowerCase()==="safari")m.alg="RSA-OAEP";else switch((l=v.hash)===null||l===void 0?void 0:l.name.toUpperCase()){case"SHA-1":m.alg="RSA-OAEP";break;case"SHA-256":m.alg="RSA-OAEP-256";break;case"SHA-384":m.alg="RSA-OAEP-384";break;case"SHA-512":m.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat((f=v.hash)===null||f===void 0?void 0:f.name.toUpperCase()))}const y=w.toJSON();Object.assign(m,y)}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],m.kty="RSA",m.ext=a,m.key_ops=n,m.alg="PS1";const y=w.toJSON();Object.assign(m,y)}break;default:throw new Error("Incorrect algorithm name: ".concat(v.name.toUpperCase()))}}break;case"jwk":m=t;break;default:throw new Error("Incorrect format: ".concat(e))}if(this.name.toLowerCase()==="safari")try{return this.subtle.importKey("jwk",Jo(JSON.stringify(m)),s,a,n)}catch(w){return this.subtle.importKey("jwk",m,s,a,n)}return this.subtle.importKey("jwk",m,s,a,n)}async exportKey(e,t){let s=await this.subtle.exportKey("jwk",t);switch(this.name.toLowerCase()==="safari"&&s instanceof ArrayBuffer&&(s=JSON.parse(qh(s))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{const a=new Ht;try{a.fromJSON(s)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new us;try{a.fromJSON(s)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return s;default:throw new Error("Incorrect format: ".concat(e))}}async convert(e,t,s,a,n,i){if(e.toLowerCase()===t.toLowerCase())return s;const o=await this.importKey(e,s,a,n,i);return this.exportKey(t,o)}getAlgorithmByOID(e,t=!1,s){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error("Unsupported algorithm identifier ".concat(s?"for ".concat(s," "):E,": ").concat(e));return{}}getOIDByAlgorithm(e,t=!1,s){let a=E;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11";break}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35";break}if(!a&&t)throw new Error("Unsupported algorithm ".concat(s?"for ".concat(s," "):E,": ").concat(e.name));return a}getAlgorithmParameters(e,t){let s={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":s={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":s={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":s={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":s={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":s={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":s={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":s={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":s={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return s}getHashAlgorithm(e){let t=E;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const s=new wt({schema:e.algorithmParams});if(s.hashAlgorithm){const a=this.getAlgorithmByOID(s.hashAlgorithm.algorithmId);if("name"in a)t=a.name;else return E}else t="SHA-1"}catch(s){}break}return t}async encryptEncryptedContentInfo(e){ve.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),s=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),n=new ArrayBuffer(16),i=new Uint8Array(n);this.getRandomValues(i);const o=new ArrayBuffer(64),h=new Uint8Array(o);this.getRandomValues(h);const u=new Uint8Array(e.contentToEncrypt),l=new Bt({salt:new X({valueHex:o}),iterationCount:e.iterationCount,prf:new M({algorithmId:a,algorithmParams:new at})}),f=new Uint8Array(e.password),m=await this.importKey("raw",f,"PBKDF2",!1,["deriveKey"]),v=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:h,iterations:e.iterationCount},m,e.contentEncryptionAlgorithm,!1,["encrypt"]),w=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:i},v,u),S=new Gn({keyDerivationFunc:new M({algorithmId:s,algorithmParams:l.toSchema()}),encryptionScheme:new M({algorithmId:t,algorithmParams:new X({valueHex:n})})});return new We({contentType:e.contentType,contentEncryptionAlgorithm:new M({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:S.toSchema()}),encryptedContent:new X({valueHex:w})})}async decryptEncryptedContentInfo(e){if(ve.assert(e,"password","encryptedContentInfo"),e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")throw new Error('Unknown "contentEncryptionAlgorithm": '.concat(e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId));let t;try{t=new Gn({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(w){throw new Error('Incorrectly encoded "pbes2Parameters"')}let s;try{s=new Bt({schema:t.keyDerivationFunc.algorithmParams})}catch(w){throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),n=t.encryptionScheme.algorithmParams.valueBlock.valueHex,i=new Uint8Array(n),o=s.salt.valueBlock.valueHex,h=new Uint8Array(o),u=s.iterationCount;let l="SHA-1";s.prf&&(l=this.getAlgorithmByOID(s.prf.algorithmId,!0).hash.name);const f=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),m=await this.deriveKey({name:"PBKDF2",hash:{name:l},salt:h,iterations:u},f,a,!1,["decrypt"]),v=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:i},m,v)}async stampDataWithPassword(e){if(!(e instanceof Object))throw new Error('Parameters must have type "Object"');ve.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp");let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Zd(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["sign"]);return this.sign(s,n,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){ve.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Zd(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["verify"]);return this.verify(s,n,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");const s=new M,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const n=a.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?n.hash.name=e.algorithm.hash.name:n.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":s.algorithmId=this.getOIDByAlgorithm(n,!0);break;case"RSA-PSS":{switch(n.hash.name.toUpperCase()){case"SHA-256":n.saltLength=32;break;case"SHA-384":n.saltLength=48;break;case"SHA-512":n.saltLength=64;break}const i={};if(n.hash.name.toUpperCase()!=="SHA-1"){const h=this.getOIDByAlgorithm({name:n.hash.name},!0,"hashAlgorithm");i.hashAlgorithm=new M({algorithmId:h,algorithmParams:new at}),i.maskGenAlgorithm=new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:i.hashAlgorithm.toSchema()})}n.saltLength!==20&&(i.saltLength=n.saltLength);const o=new wt(i);s.algorithmId="1.2.840.113549.1.1.10",s.algorithmParams=o.toSchema()}break;default:throw new Error("Unsupported signature algorithm: ".concat(e.algorithm.name))}return{signatureAlgorithm:s,parameters:a}}async signWithPrivateKey(e,t,s){const a=await this.sign(s.algorithm,t,e);return s.algorithm.name==="ECDSA"?yb(a):a}fillPublicKeyParameters(e,t){const s={},a=this.getHashAlgorithm(t);if(a===E)throw new Error("Unsupported signature algorithm: ".concat(t.algorithmId));let n;t.algorithmId==="1.2.840.113549.1.1.10"?n=t.algorithmId:n=e.algorithm.algorithmId;const i=this.getAlgorithmByOID(n,!0);if(s.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in s.algorithm.algorithm&&(s.algorithm.algorithm.hash.name=a),i.name==="ECDSA"){const o=e.algorithm;if(!o.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const h=o.algorithmParams;if("idBlock"in o.algorithmParams&&!(h.idBlock.tagClass===1&&h.idBlock.tagNumber===6))throw new Error("Incorrect type for ECDSA public key parameters");const u=this.getAlgorithmByOID(h.valueBlock.toString(),!0);s.algorithm.algorithm.namedCurve=u.name}return s}async getPublicKey(e,t,s){s||(s=this.fillPublicKeyParameters(e,t));const a=e.toSchema().toBER(!1);return this.importKey("spki",a,s.algorithm.algorithm,!0,s.algorithm.usages)}async verifyWithPublicKey(e,t,s,a,n){let i;if(n){const u={};let l;a.algorithmId==="1.2.840.113549.1.1.10"?l=a.algorithmId:l=s.algorithm.algorithmId;const f=this.getAlgorithmByOID(l,!0);if(u.algorithm=this.getAlgorithmParameters(f.name,"importKey"),"hash"in u.algorithm.algorithm&&(u.algorithm.algorithm.hash.name=n),f.name==="ECDSA"){let m=!1;if("algorithmParams"in s.algorithm&&"idBlock"in s.algorithm.algorithmParams&&s.algorithm.algorithmParams.idBlock.tagClass===1&&s.algorithm.algorithmParams.idBlock.tagNumber===6&&(m=!0),m===!1)throw new Error("Incorrect type for ECDSA public key parameters");const v=this.getAlgorithmByOID(s.algorithm.algorithmParams.valueBlock.toString(),!0);u.algorithm.algorithm.namedCurve=v.name}i=await this.getPublicKey(s,null,u)}else{if(n=this.getHashAlgorithm(a),!n)throw new Error("Unsupported signature algorithm: ".concat(a.algorithmId));i=await this.getPublicKey(s,a)}const o=this.getAlgorithmParameters(i.algorithm.name,"verify");"hash"in o.algorithm&&(o.algorithm.hash.name=n);let h=t.valueBlock.valueHexView;if(i.algorithm.name==="ECDSA"){const u=Aa.find(i.algorithm.namedCurve);if(!u)throw new Error("Unsupported named curve in use");const l=Xe(h);q.assert(l,"Signature value"),h=vb(l.result,u.size)}if(i.algorithm.name==="RSA-PSS"){const u=new wt({schema:a.algorithmParams});"saltLength"in u?o.algorithm.saltLength=u.saltLength:o.algorithm.saltLength=20;let l="SHA-1";"hashAlgorithm"in u&&(l=this.getAlgorithmByOID(u.hashAlgorithm.algorithmId,!0).name),o.algorithm.hash.name=l}return this.verify(o.algorithm,i,h,e)}}let Uw={name:"none",crypto:null};function eg(r){return!!(r&&typeof r=="object"&&"crypto"in r)}function tg(r,...e){let t=null;if(e.length<2)e.length?t=e[0]:t=typeof self<"u"&&self.crypto?new kc({name:"browser",crypto:self.crypto}):null;else{const s=e[0],a=e[1];eg(a)?t=a:eg(s)?t=s:"subtle"in s&&"getRandomValues"in s&&(t=new kc({crypto:s}))}if(typeof lt<"u"&&"pid"in lt&&typeof Wt<"u"&&typeof window>"u"){if(typeof Wt[lt.pid]>"u")Wt[lt.pid]={};else if(typeof Wt[lt.pid]!="object")throw new Error("Name global.".concat(lt.pid," already exists and it is not an object"));if(typeof Wt[lt.pid].pkijs>"u")Wt[lt.pid].pkijs={};else if(typeof Wt[lt.pid].pkijs!="object")throw new Error("Name global.".concat(lt.pid,".pkijs already exists and it is not an object"));Wt[lt.pid].pkijs.engine={name:r,crypto:t}}else Uw={name:r,crypto:t}}function wb(){if(typeof lt<"u"&&"pid"in lt&&typeof Wt<"u"&&typeof window>"u"){let r;try{r=Wt[lt.pid].pkijs.engine}catch(e){throw new Error("Please call 'setEngine' before call to 'getEngine'")}return r}return Uw}function fe(r=!1){const e=wb();if(!e.crypto&&r)throw new Error("Unable to create WebCrypto object");return e.crypto}function yb(r){if(r.byteLength%2!==0)return Ye;const e=r.byteLength/2,t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(r,0,e));const s=new H({valueHex:t}),a=new ArrayBuffer(e);new Uint8Array(a).set(new Uint8Array(r,e,e));const n=new H({valueHex:a});return new O({value:[s.convertToDER(),n.convertToDER()]}).toBER(!1)}function vb(r,e){if(!(r instanceof O&&r.valueBlock.value.length===2&&r.valueBlock.value[0]instanceof H&&r.valueBlock.value[1]instanceof H))return Ye;const t=r.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,s=r.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,a=new Uint8Array(e*2);return a.set(t,e-t.byteLength),a.set(s,2*e-s.byteLength),a.buffer}async function bb(r,e,t,s,a){switch(r.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new Ne("Unknown hash function: ".concat(r))}if(Ne.assert(e,"zBuffer","ArrayBuffer"),e.byteLength===0)throw new Ne("'zBuffer' has zero length, error");if(Ne.assert(s,"SharedInfo","ArrayBuffer"),t>255)throw new Ne("Please set 'Counter' argument to value less or equal to 255");const n=new ArrayBuffer(4),i=new Uint8Array(n);i[0]=0,i[1]=0,i[2]=0,i[3]=t;let o=Ye;o=Uo(o,e),o=Uo(o,n),o=Uo(o,s);const h=await a.digest({name:r},o);return{counter:t,result:h}}async function sg(r,e,t,s,a=fe(!0)){let n=0,i=1;switch(r.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:throw new Ne("Unknown hash function: ".concat(r))}if(Ne.assert(e,"Zbuffer","ArrayBuffer"),e.byteLength===0)throw new Ne("'Zbuffer' has zero length, error");Ne.assert(s,"SharedInfo","ArrayBuffer");const o=t/n;Math.floor(o)>0&&(i=Math.floor(o),o-i>0&&i++);const h=[];for(let m=1;m<=i;m++)h.push(await bb(r,e,m,s,a));let u=Ye,l=1,f=!0;for(;f;){f=!1;for(const m of h)if(m.counter===l){u=Uo(u,m.result),f=!0;break}l++}if(t>>=3,u.byteLength>t){const m=new ArrayBuffer(t),v=new Uint8Array(m),w=new Uint8Array(u);for(let S=0;S<t;S++)v[S]=w[S];return m}return u}const ef="version",tf="logID",sf="extensions",rf="timestamp",af="hashAlgorithm",nf="signatureAlgorithm",of="signature",rg="none",ag="md5",ng="sha1",ig="sha224",og="sha256",ug="sha384",lg="sha512",cg="anonymous",hg="rsa",mg="dsa",fg="ecdsa";class xs extends _{constructor(e={}){super(),this.version=d(e,ef,xs.defaultValues(ef)),this.logID=d(e,tf,xs.defaultValues(tf)),this.timestamp=d(e,rf,xs.defaultValues(rf)),this.extensions=d(e,sf,xs.defaultValues(sf)),this.hashAlgorithm=d(e,af,xs.defaultValues(af)),this.signatureAlgorithm=d(e,nf,xs.defaultValues(nf)),this.signature=d(e,of,xs.defaultValues(of)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ef:return 0;case tf:case sf:return Ye;case rf:return new Date(0);case af:case nf:return E;case of:return new le;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof Wh))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new Sa({stream:new Le({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(Ay(new Uint8Array(e.getBlock(8)),8));const s=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(s)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=rg;break;case 1:this.hashAlgorithm=ag;break;case 2:this.hashAlgorithm=ng;break;case 3:this.hashAlgorithm=ig;break;case 4:this.hashAlgorithm=og;break;case 5:this.hashAlgorithm=ug;break;case 6:this.hashAlgorithm=lg;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=cg;break;case 1:this.signatureAlgorithm=hg;break;case 2:this.signatureAlgorithm=mg;break;case 3:this.signatureAlgorithm=fg;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16(),n=new Uint8Array(e.getBlock(a)).buffer.slice(0),i=Xe(n);if(q.assert(i,"SignedCertificateTimestamp"),this.signature=i.result,t!==47+s+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new Wh({data:e.stream.buffer})}toStream(){const e=new Sa;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),s=new Uint8Array(t),a=ad(this.timestamp.valueOf(),8);s.set(new Uint8Array(a),8-a.byteLength),e.appendView(s),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions));let n;switch(this.hashAlgorithm.toLowerCase()){case rg:n=0;break;case ag:n=1;break;case ng:n=2;break;case ig:n=3;break;case og:n=4;break;case ug:n=5;break;case lg:n=6;break;default:throw new Error("Incorrect data for hashAlgorithm: ".concat(this.hashAlgorithm))}e.appendChar(n);let i;switch(this.signatureAlgorithm.toLowerCase()){case cg:i=0;break;case hg:i=1;break;case mg:i=2;break;case fg:i=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: ".concat(this.signatureAlgorithm))}e.appendChar(i);const o=this.signature.toBER(!1);return e.appendUint16(o.byteLength),e.appendView(new Uint8Array(o)),e}toJSON(){return{version:this.version,logID:nd(this.logID),timestamp:this.timestamp,extensions:nd(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,s=0,a=fe(!0)){const n=Pf(qh(this.logID));let i=null;const o=new Sa;for(const v of e)if(v.log_id===n){i=v.key;break}if(!i)throw new Error("Public key not found for CT with logId: ".concat(n));const h=Jo(wc(i)),u=Ht.fromBER(h);o.appendChar(0),o.appendChar(0);const l=new ArrayBuffer(8),f=new Uint8Array(l),m=ad(this.timestamp.valueOf(),8);return f.set(new Uint8Array(m),8-m.byteLength),o.appendView(f),o.appendUint16(s),s===0&&o.appendUint24(t.byteLength),o.appendView(new Uint8Array(t)),o.appendUint16(this.extensions.byteLength),this.extensions.byteLength!==0&&o.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(o.buffer.slice(0,o.length),new X({valueHex:this.signature.toBER(!1)}),u,{algorithmId:E},"SHA-256")}}xs.CLASS_NAME="SignedCertificateTimestamp";const Jc="timestamps";class ym extends _{constructor(e={}){super(),this.timestamps=d(e,Jc,ym.defaultValues(Jc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Jc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){var t;const s=d(e,"names",{});return(t=s.optional)!==null&&t!==void 0||(s.optional=!1),new X({name:s.blockName||"SignedCertificateTimestampList",optional:s.optional})}fromSchema(e){if(!(e instanceof X))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new Sa({stream:new Le({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new xs({stream:t}))}toSchema(){const e=new Sa;let t=0;const s=[];for(const a of this.timestamps){const n=a.toStream();s.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const a of s)e.appendView(a.stream.view);return new X({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}ym.CLASS_NAME="SignedCertificateTimestampList";const sl="attributes",Sb=[sl];class Ic extends _{constructor(e={}){super(),this.attributes=d(e,sl,Ic.defaultValues(sl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.attributes||E,value:Oe.schema()})]})}fromSchema(e){G(e,Sb);const t=z(e,e,Ic.schema({names:{attributes:sl}}));q.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,s=>new Oe({schema:s}))}toSchema(){return new O({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}Ic.CLASS_NAME="SubjectDirectoryAttributes";class Te{static getItems(){return this.types||(this.types={},Te.register(bw,"SubjectAltName",qo),Te.register(Sw,"IssuerAltName",qo),Te.register(Bp,"AuthorityKeyIdentifier",ga),Te.register(Vp,"BasicConstraints",Hn),Te.register(Lv,"MicrosoftCaVersion",Sc),Te.register(Iw,"CertificatePolicies",Wo),Te.register(Ov,"CertificatePoliciesMicrosoft",Wo),Te.register(Uv,"MicrosoftCertTemplateV2",To),Te.register(kw,"CRLDistributionPoints",_o),Te.register(xp,"FreshestCRL",_o),Te.register(Pv,"ExtKeyUsage",Ac),Te.register(Nw,"CertificateIssuer",it),Te.register(Op,"AuthorityInfoAccess",Go),Te.register(Tv,"SubjectInfoAccess",Go),Te.register(Aw,"IssuingDistributionPoint",dt),Te.register(Ew,"NameConstraints",jo),Te.register(Vw,"PolicyConstraints",$o),Te.register(Cw,"PolicyMappings",Nc),Te.register(Iv,"PrivateKeyUsagePeriod",Ko),Te.register(jv,"QCStatements",Ec),Te.register(Rv,"SignedCertificateTimestampList",ym),Te.register(Nv,"SubjectDirectoryAttributes",Ic)),this.types}static fromBER(e,t){const s=Xe(t);if(s.offset===-1)return null;const a=this.find(e);if(a)try{return new a.type({schema:s.result})}catch(n){const i=new a.type;return i.parsingError="Incorrectly formatted value of extension ".concat(a.name," (").concat(e,")"),i}return s.result}static find(e){return this.getItems()[e]||null}static register(e,t,s){this.getItems()[e]={name:t,type:s}}}const rl="extnID",$r="critical",al="extnValue",qc="parsedValue",Ab=[rl,$r,al];class _e extends _{get parsedValue(){if(this._parsedValue===void 0){const e=Te.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=d(e,rl,_e.defaultValues(rl)),this.critical=d(e,$r,_e.defaultValues($r)),al in e?this.extnValue=new X({valueHex:e.extnValue}):this.extnValue=_e.defaultValues(al),qc in e&&(this.parsedValue=d(e,qc,_e.defaultValues(qc))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rl:return E;case $r:return!1;case al:return new X;case qc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.extnID||E}),new Ia({name:t.critical||E,optional:!0}),new X({name:t.extnValue||E})]})}fromSchema(e){G(e,Ab);const t=z(e,e,_e.schema({names:{extnID:rl,critical:$r,extnValue:al}}));q.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),$r in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new ae({value:this.extnID})),this.critical!==_e.defaultValues($r)&&e.push(new Ia({value:this.critical})),e.push(this.extnValue),new O({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==_e.defaultValues($r)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}_e.CLASS_NAME="Extension";const nl="extensions",Nb=[nl];class Qe extends _{constructor(e={}){super(),this.extensions=d(e,nl,Qe.defaultValues(nl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nl:return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,"names",{});return new O({optional:t,name:s.blockName||E,value:[new me({name:s.extensions||E,value:_e.schema(s.extension||{})})]})}fromSchema(e){G(e,Nb);const t=z(e,e,Qe.schema({names:{extensions:nl}}));q.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,s=>new _e({schema:s}))}toSchema(){return new O({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}Qe.CLASS_NAME="Extensions";const il="issuer",ol="serialNumber",Wa="issuerUID",Eb=[il,ol,Wa];class Mt extends _{constructor(e={}){super(),this.issuer=d(e,il,Mt.defaultValues(il)),this.serialNumber=d(e,ol,Mt.defaultValues(ol)),Wa in e&&(this.issuerUID=d(e,Wa,Mt.defaultValues(Wa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case il:return new it;case ol:return new H;case Wa:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[it.schema(t.issuer||{}),new H({name:t.serialNumber||E}),new ye({optional:!0,name:t.issuerUID||E})]})}fromSchema(e){G(e,Eb);const t=z(e,e,Mt.schema({names:{issuer:{names:{blockName:il}},serialNumber:ol,issuerUID:Wa}}));q.assertSchema(t,this.className),this.issuer=new it({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,Wa in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new O({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}Mt.CLASS_NAME="IssuerSerial";const ul="version",_a="baseCertificateID",Ga="subjectName",ll="issuer",cl="signature",hl="serialNumber",ml="attrCertValidityPeriod",fl="attributes",za="issuerUniqueID",Xa="extensions",kb=[ul,_a,Ga,ll,cl,hl,ml,fl,za,Xa];class Vt extends _{constructor(e={}){super(),this.version=d(e,ul,Vt.defaultValues(ul)),_a in e&&(this.baseCertificateID=d(e,_a,Vt.defaultValues(_a))),Ga in e&&(this.subjectName=d(e,Ga,Vt.defaultValues(Ga))),this.issuer=d(e,ll,Vt.defaultValues(ll)),this.signature=d(e,cl,Vt.defaultValues(cl)),this.serialNumber=d(e,hl,Vt.defaultValues(hl)),this.attrCertValidityPeriod=d(e,ml,Vt.defaultValues(ml)),this.attributes=d(e,fl,Vt.defaultValues(fl)),za in e&&(this.issuerUniqueID=d(e,za,Vt.defaultValues(za))),Xa in e&&(this.extensions=d(e,Xa,Vt.defaultValues(Xa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ul:return 0;case _a:return new Mt;case Ga:return new it;case ll:return new it;case cl:return new M;case hl:return new H;case ml:return new Ns;case fl:return[];case za:return new ye;case Xa:return new Qe;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new je({value:[new L({name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Mt.schema().valueBlock.value}),new L({name:t.subjectName||E,idBlock:{tagClass:3,tagNumber:1},value:it.schema().valueBlock.value})]}),it.schema({names:{blockName:t.issuer||E}}),M.schema(t.signature||{}),new H({name:t.serialNumber||E}),Ns.schema(t.attrCertValidityPeriod||{}),new O({name:t.attributes||E,value:[new me({value:Oe.schema()})]}),new ye({optional:!0,name:t.issuerUniqueID||E}),Qe.schema(t.extensions||{},!0)]})}fromSchema(e){G(e,kb);const t=z(e,e,Vt.schema({names:{version:ul,baseCertificateID:_a,subjectName:Ga,issuer:ll,signature:{names:{blockName:cl}},serialNumber:hl,attrCertValidityPeriod:{names:{blockName:ml}},attributes:fl,issuerUniqueID:za,extensions:{names:{blockName:Xa}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,_a in t.result&&(this.baseCertificateID=new Mt({schema:new O({value:t.result.baseCertificateID.valueBlock.value})})),Ga in t.result&&(this.subjectName=new it({schema:new O({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new M({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new Ns({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new Oe({schema:s})),za in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),Xa in t.result&&(this.extensions=new Qe({schema:t.result.extensions}))}toSchema(){const e=new O({value:[new H({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new O({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}Vt.CLASS_NAME="AttributeCertificateInfoV1";const pl="acinfo",dl="signatureAlgorithm",gl="signatureValue",Ib=[pl,gl,dl];class sr extends _{constructor(e={}){super(),this.acinfo=d(e,pl,sr.defaultValues(pl)),this.signatureAlgorithm=d(e,dl,sr.defaultValues(dl)),this.signatureValue=d(e,gl,sr.defaultValues(gl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pl:return new Vt;case dl:return new M;case gl:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Vt.schema(t.acinfo||{}),M.schema(t.signatureAlgorithm||{}),new ye({name:t.signatureValue||E})]})}fromSchema(e){G(e,Ib);const t=z(e,e,sr.schema({names:{acinfo:{names:{blockName:pl}},signatureAlgorithm:{names:{blockName:dl}},signatureValue:gl}}));q.assertSchema(t,this.className),this.acinfo=new Vt({schema:t.result.acinfo}),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new O({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}sr.CLASS_NAME="AttributeCertificateV1";const wl="digestedObjectType",Ya="otherObjectTypeID",yl="digestAlgorithm",vl="objectDigest",Cb=[wl,Ya,yl,vl];class es extends _{constructor(e={}){super(),this.digestedObjectType=d(e,wl,es.defaultValues(wl)),Ya in e&&(this.otherObjectTypeID=d(e,Ya,es.defaultValues(Ya))),this.digestAlgorithm=d(e,yl,es.defaultValues(yl)),this.objectDigest=d(e,vl,es.defaultValues(vl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wl:return new vc;case Ya:return new ae;case yl:return new M;case vl:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new vc({name:t.digestedObjectType||E}),new ae({optional:!0,name:t.otherObjectTypeID||E}),M.schema(t.digestAlgorithm||{}),new ye({name:t.objectDigest||E})]})}fromSchema(e){G(e,Cb);const t=z(e,e,es.schema({names:{digestedObjectType:wl,otherObjectTypeID:Ya,digestAlgorithm:{names:{blockName:yl}},objectDigest:vl}}));q.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,Ya in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new M({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new O({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}es.CLASS_NAME="ObjectDigestInfo";const Qa="issuerName",Za="baseCertificateID",en="objectDigestInfo",Vb=[Qa,Za,en];class ya extends _{constructor(e={}){super(),Qa in e&&(this.issuerName=d(e,Qa,ya.defaultValues(Qa))),Za in e&&(this.baseCertificateID=d(e,Za,ya.defaultValues(Za))),en in e&&(this.objectDigestInfo=d(e,en,ya.defaultValues(en))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qa:return new it;case Za:return new Mt;case en:return new es;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[it.schema({names:{blockName:t.issuerName}},!0),new L({optional:!0,name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Mt.schema().valueBlock.value}),new L({optional:!0,name:t.objectDigestInfo||E,idBlock:{tagClass:3,tagNumber:1},value:es.schema().valueBlock.value})]})}fromSchema(e){G(e,Vb);const t=z(e,e,ya.schema({names:{issuerName:Qa,baseCertificateID:Za,objectDigestInfo:en}}));q.assertSchema(t,this.className),Qa in t.result&&(this.issuerName=new it({schema:t.result.issuerName})),Za in t.result&&(this.baseCertificateID=new Mt({schema:new O({value:t.result.baseCertificateID.valueBlock.value})})),en in t.result&&(this.objectDigestInfo=new es({schema:new O({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new O;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}ya.CLASS_NAME="V2Form";const tn="baseCertificateID",sn="entityName",rn="objectDigestInfo",xb=[tn,sn,rn];class rr extends _{constructor(e={}){super(),tn in e&&(this.baseCertificateID=d(e,tn,rr.defaultValues(tn))),sn in e&&(this.entityName=d(e,sn,rr.defaultValues(sn))),rn in e&&(this.objectDigestInfo=d(e,rn,rr.defaultValues(rn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tn:return new Mt;case sn:return new it;case rn:return new es;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({optional:!0,name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Mt.schema().valueBlock.value}),new L({optional:!0,name:t.entityName||E,idBlock:{tagClass:3,tagNumber:1},value:it.schema().valueBlock.value}),new L({optional:!0,name:t.objectDigestInfo||E,idBlock:{tagClass:3,tagNumber:2},value:es.schema().valueBlock.value})]})}fromSchema(e){G(e,xb);const t=z(e,e,rr.schema({names:{baseCertificateID:tn,entityName:sn,objectDigestInfo:rn}}));q.assertSchema(t,this.className),tn in t.result&&(this.baseCertificateID=new Mt({schema:new O({value:t.result.baseCertificateID.valueBlock.value})})),sn in t.result&&(this.entityName=new it({schema:new O({value:t.result.entityName.valueBlock.value})})),rn in t.result&&(this.objectDigestInfo=new es({schema:new O({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new O;return this.baseCertificateID&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}rr.CLASS_NAME="Holder";const bl="version",Sl="holder",Al="issuer",Nl="signature",El="serialNumber",kl="attrCertValidityPeriod",Il="attributes",an="issuerUniqueID",nn="extensions",Bb=[bl,Sl,Al,Nl,El,kl,Il,an,nn];class Tt extends _{constructor(e={}){super(),this.version=d(e,bl,Tt.defaultValues(bl)),this.holder=d(e,Sl,Tt.defaultValues(Sl)),this.issuer=d(e,Al,Tt.defaultValues(Al)),this.signature=d(e,Nl,Tt.defaultValues(Nl)),this.serialNumber=d(e,El,Tt.defaultValues(El)),this.attrCertValidityPeriod=d(e,kl,Tt.defaultValues(kl)),this.attributes=d(e,Il,Tt.defaultValues(Il)),an in e&&(this.issuerUniqueID=d(e,an,Tt.defaultValues(an))),nn in e&&(this.extensions=d(e,nn,Tt.defaultValues(nn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bl:return 1;case Sl:return new rr;case Al:return{};case Nl:return new M;case El:return new H;case kl:return new Ns;case Il:return[];case an:return new ye;case nn:return new Qe;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),rr.schema(t.holder||{}),new je({value:[it.schema({names:{blockName:t.issuer||E}}),new L({name:t.issuer||E,idBlock:{tagClass:3,tagNumber:0},value:ya.schema().valueBlock.value})]}),M.schema(t.signature||{}),new H({name:t.serialNumber||E}),Ns.schema(t.attrCertValidityPeriod||{}),new O({name:t.attributes||E,value:[new me({value:Oe.schema()})]}),new ye({optional:!0,name:t.issuerUniqueID||E}),Qe.schema(t.extensions||{},!0)]})}fromSchema(e){G(e,Bb);const t=z(e,e,Tt.schema({names:{version:bl,holder:{names:{blockName:Sl}},issuer:Al,signature:{names:{blockName:Nl}},serialNumber:El,attrCertValidityPeriod:{names:{blockName:kl}},attributes:Il,issuerUniqueID:an,extensions:{names:{blockName:nn}}}}));switch(q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new rr({schema:t.result.holder}),t.result.issuer.idBlock.tagClass){case 3:this.issuer=new ya({schema:new O({value:t.result.issuer.valueBlock.value})});break;case 1:default:throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2")}this.signature=new M({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new Ns({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new Oe({schema:s})),an in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),nn in t.result&&(this.extensions=new Qe({schema:t.result.extensions}))}toSchema(){const e=new O({value:[new H({value:this.version}),this.holder.toSchema(),new L({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new O({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}Tt.CLASS_NAME="AttributeCertificateInfoV2";const Cl="acinfo",Vl="signatureAlgorithm",xl="signatureValue",Ob=[Cl,Vl,xl];class ts extends _{constructor(e={}){super(),this.acinfo=d(e,Cl,ts.defaultValues(Cl)),this.signatureAlgorithm=d(e,Vl,ts.defaultValues(Vl)),this.signatureValue=d(e,xl,ts.defaultValues(xl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cl:return new Tt;case Vl:return new M;case xl:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Tt.schema(t.acinfo||{}),M.schema(t.signatureAlgorithm||{}),new ye({name:t.signatureValue||E})]})}fromSchema(e){G(e,Ob);const t=z(e,e,ts.schema({names:{acinfo:{names:{blockName:Cl}},signatureAlgorithm:{names:{blockName:Vl}},signatureValue:xl}}));q.assertSchema(t,this.className),this.acinfo=new Tt({schema:t.result.acinfo}),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new O({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}ts.CLASS_NAME="AttributeCertificateV2";const on="contentType",Ai="content",Pb=[on,Ai];class Ie extends _{constructor(e={}){super(),this.contentType=d(e,on,Ie.defaultValues(on)),this.content=d(e,Ai,Ie.defaultValues(Ai)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case on:return E;case Ai:return new le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case on:return typeof t=="string"&&t===this.defaultValues(on);case Ai:return t instanceof le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return"optional"in t||(t.optional=!1),new O({name:t.blockName||"ContentInfo",optional:t.optional,value:[new ae({name:t.contentType||on}),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.content||Ai})]})]})}fromSchema(e){G(e,Pb);const t=z(e,e,Ie.schema());q.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new O({value:[new ae({value:this.contentType}),new L({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof le||(e.content=this.content.toJSON()),e}}Ie.CLASS_NAME="ContentInfo",Ie.DATA=Pp,Ie.SIGNED_DATA=xw,Ie.ENVELOPED_DATA=Bw,Ie.ENCRYPTED_DATA=Ow;const uf="type",lf="value",qf="utcTimeName",Wf="generalTimeName",Db=[qf,Wf];var pg;(function(r){r[r.UTCTime=0]="UTCTime",r[r.GeneralizedTime=1]="GeneralizedTime",r[r.empty=2]="empty"})(pg||(pg={}));class ze extends _{constructor(e={}){super(),this.type=d(e,uf,ze.defaultValues(uf)),this.value=d(e,lf,ze.defaultValues(lf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uf:return 0;case lf:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,"names",{});return new je({optional:t,value:[new Df({name:s.utcTimeName||E}),new $e({name:s.generalTimeName||E})]})}fromSchema(e){G(e,Db);const t=z(e,e,ze.schema({names:{utcTimeName:qf,generalTimeName:Wf}}));q.assertSchema(t,this.className),qf in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),Wf in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return this.type===0?new Df({valueDate:this.value}):this.type===1?new $e({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}ze.CLASS_NAME="Time";const cf="tbs",Kr="version",dh="serialNumber",gh="signature",wh="issuer",yh="notBefore",vh="notAfter",bh="subject",Sh="subjectPublicKeyInfo",Bl="issuerUniqueID",Ol="subjectUniqueID",Pl="extensions",Dl="signatureAlgorithm",Tl="signatureValue",ss="tbsCertificate",sm="".concat(ss,".").concat(Kr),Dp="".concat(ss,".").concat(dh),Tp="".concat(ss,".").concat(gh),Rp="".concat(ss,".").concat(wh),rm="".concat(ss,".").concat(yh),am="".concat(ss,".").concat(vh),Up="".concat(ss,".").concat(bh),Lp="".concat(ss,".").concat(Sh),nm="".concat(ss,".").concat(Bl),im="".concat(ss,".").concat(Ol),pc="".concat(ss,".").concat(Pl),Tb=[ss,sm,Dp,Tp,Rp,rm,am,Up,Lp,nm,im,pc,Dl,Tl];function Rb(r={}){const e=d(r,"names",{});return new O({name:e.blockName||ss,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:e.tbsCertificateVersion||sm})]}),new H({name:e.tbsCertificateSerialNumber||Dp}),M.schema(e.signature||{names:{blockName:Tp}}),Ee.schema(e.issuer||{names:{blockName:Rp}}),new O({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[ze.schema(e.notBefore||{names:{utcTimeName:rm,generalTimeName:rm}}),ze.schema(e.notAfter||{names:{utcTimeName:am,generalTimeName:am}})]}),Ee.schema(e.subject||{names:{blockName:Up}}),Ht.schema(e.subjectPublicKeyInfo||{names:{blockName:Lp}}),new ue({name:e.tbsCertificateIssuerUniqueID||nm,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new ue({name:e.tbsCertificateSubjectUniqueID||im,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Qe.schema(e.extensions||{names:{blockName:pc}})]})]})}class be extends _{get tbs(){return Be.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,cf,be.defaultValues(cf))),this.version=d(e,Kr,be.defaultValues(Kr)),this.serialNumber=d(e,dh,be.defaultValues(dh)),this.signature=d(e,gh,be.defaultValues(gh)),this.issuer=d(e,wh,be.defaultValues(wh)),this.notBefore=d(e,yh,be.defaultValues(yh)),this.notAfter=d(e,vh,be.defaultValues(vh)),this.subject=d(e,bh,be.defaultValues(bh)),this.subjectPublicKeyInfo=d(e,Sh,be.defaultValues(Sh)),Bl in e&&(this.issuerUniqueID=d(e,Bl,be.defaultValues(Bl))),Ol in e&&(this.subjectUniqueID=d(e,Ol,be.defaultValues(Ol))),Pl in e&&(this.extensions=d(e,Pl,be.defaultValues(Pl))),this.signatureAlgorithm=d(e,Dl,be.defaultValues(Dl)),this.signatureValue=d(e,Tl,be.defaultValues(Tl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cf:return Ye;case Kr:return 0;case dh:return new H;case gh:return new M;case wh:return new Ee;case yh:return new ze;case vh:return new ze;case bh:return new Ee;case Sh:return new Ht;case Bl:return Ye;case Ol:return Ye;case Pl:return[];case Dl:return new M;case Tl:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Rb(t.tbsCertificate),M.schema(t.signatureAlgorithm||{names:{blockName:Dl}}),new ye({name:t.signatureValue||Tl})]})}fromSchema(e){G(e,Tb);const t=z(e,e,be.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:pc}}}}}}));q.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,sm in t.result&&(this.version=t.result[sm].valueBlock.valueDec),this.serialNumber=t.result[Dp],this.signature=new M({schema:t.result[Tp]}),this.issuer=new Ee({schema:t.result[Rp]}),this.notBefore=new ze({schema:t.result[rm]}),this.notAfter=new ze({schema:t.result[am]}),this.subject=new Ee({schema:t.result[Up]}),this.subjectPublicKeyInfo=new Ht({schema:t.result[Lp]}),nm in t.result&&(this.issuerUniqueID=t.result[nm].valueBlock.valueHex),im in t.result&&(this.subjectUniqueID=t.result[im].valueBlock.valueHex),pc in t.result&&(this.extensions=Array.from(t.result[pc],s=>new _e({schema:s}))),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return Kr in this&&this.version!==be.defaultValues(Kr)&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new O({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new ue({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new ue({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new O({value:Array.from(this.extensions,t=>t.toSchema())})]})),new O({value:e})}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return be.schema().value[0];const s=Xe(this.tbsView);q.assert(s,"TBS Certificate"),t=s.result}else t=this.encodeTBS();return new O({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Kr in this&&this.version!==be.defaultValues(Kr)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=Ae.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=Ae.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async getPublicKey(e,t=fe(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=fe(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",s=fe(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ye({valueHex:i})}async verify(e,t=fe(!0)){let s;if(e?s=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(s=this.subjectPublicKeyInfo),!(s instanceof Ht))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}be.CLASS_NAME="Certificate";function Lw(r,e=null){if(e&&r.issuer.isEqual(e.issuer)&&r.serialNumber.isEqual(e.serialNumber))return null;let t=!1;if(r.extensions){for(const s of r.extensions)if(s.extnID===Vp&&s.parsedValue instanceof Hn&&s.parsedValue.cA){t=!0;break}}return t?r:null}const Ni="certId",Ei="certValue",ai="parsedValue",Ub=[Ni,Ei];class Un extends _{constructor(e={}){super(),this.certId=d(e,Ni,Un.defaultValues(Ni)),this.certValue=d(e,Ei,Un.defaultValues(Ei)),ai in e&&(this.parsedValue=d(e,ai,Un.defaultValues(ai))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ni:return E;case Ei:return new le;case ai:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ni:return t===E;case Ei:return t instanceof le;case ai:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.id||"id"}),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.value||"value"})]})]})}fromSchema(e){G(e,Ub);const t=z(e,e,Un.schema({names:{id:Ni,value:Ei}}));q.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const s=this.certValue.valueBlock.valueHexView;switch(this.certId){case zd:try{this.parsedValue=be.fromBER(s)}catch(a){ts.fromBER(s)}break;case Xd:this.parsedValue=ts.fromBER(s);break;case Kv:default:throw new Error("Incorrect CERT_ID value in CertBag: ".concat(this.certId))}}toSchema(){return ai in this&&("acinfo"in this.parsedValue?this.certId=Xd:this.certId=zd,this.certValue=new X({valueHex:this.parsedValue.toSchema().toBER(!1)})),new O({value:[new ae({value:this.certId}),new L({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}Un.CLASS_NAME="CertBag";const Rl="userCertificate",ki="revocationDate",un="crlEntryExtensions",Lb=[Rl,ki,un];class Ln extends _{constructor(e={}){super(),this.userCertificate=d(e,Rl,Ln.defaultValues(Rl)),this.revocationDate=d(e,ki,Ln.defaultValues(ki)),un in e&&(this.crlEntryExtensions=d(e,un,Ln.defaultValues(un))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rl:return new H;case ki:return new ze;case un:return new Qe;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.userCertificate||Rl}),ze.schema({names:{utcTimeName:t.revocationDate||ki,generalTimeName:t.revocationDate||ki}}),Qe.schema({names:{blockName:t.crlEntryExtensions||un}},!0)]})}fromSchema(e){G(e,Lb);const t=z(e,e,Ln.schema());q.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new ze({schema:t.result.revocationDate}),un in t.result&&(this.crlEntryExtensions=new Qe({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new O({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}Ln.CLASS_NAME="RevokedCertificate";const hf="tbs",ou="version",mf="signature",ff="issuer",pf="thisUpdate",Wc="nextUpdate",_c="revokedCertificates",Gc="crlExtensions",Ul="signatureAlgorithm",Ll="signatureValue",hr="tbsCertList",om="".concat(hr,".version"),jp="".concat(hr,".signature"),$p="".concat(hr,".issuer"),um="".concat(hr,".thisUpdate"),Cc="".concat(hr,".nextUpdate"),lm="".concat(hr,".revokedCertificates"),cm="".concat(hr,".extensions"),jb=[hr,om,jp,$p,um,Cc,lm,cm,Ul,Ll];function $b(r={}){const e=d(r,"names",{});return new O({name:e.blockName||hr,value:[new H({optional:!0,name:e.tbsCertListVersion||om,value:2}),M.schema(e.signature||{names:{blockName:jp}}),Ee.schema(e.issuer||{names:{blockName:$p}}),ze.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:um,generalTimeName:um}}),ze.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:Cc,generalTimeName:Cc}},!0),new O({optional:!0,value:[new me({name:e.tbsCertListRevokedCertificates||lm,value:new O({value:[new H,ze.schema(),Qe.schema({},!0)]})})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Qe.schema(e.crlExtensions||{names:{blockName:cm}})]})]})}const Kb=[Bp,Sw,Cv,Vv,Aw,xp,Op,xv,Bv,Nw];class rt extends _{get tbs(){return Be.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,hf,rt.defaultValues(hf))),this.version=d(e,ou,rt.defaultValues(ou)),this.signature=d(e,mf,rt.defaultValues(mf)),this.issuer=d(e,ff,rt.defaultValues(ff)),this.thisUpdate=d(e,pf,rt.defaultValues(pf)),Wc in e&&(this.nextUpdate=d(e,Wc,rt.defaultValues(Wc))),_c in e&&(this.revokedCertificates=d(e,_c,rt.defaultValues(_c))),Gc in e&&(this.crlExtensions=d(e,Gc,rt.defaultValues(Gc))),this.signatureAlgorithm=d(e,Ul,rt.defaultValues(Ul)),this.signatureValue=d(e,Ll,rt.defaultValues(Ll)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hf:return Ye;case ou:return 0;case mf:return new M;case ff:return new Ee;case pf:return new ze;case Wc:return new ze;case _c:return[];case Gc:return new Qe;case Ul:return new M;case Ll:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||"CertificateList",value:[$b(e),M.schema(t.signatureAlgorithm||{names:{blockName:Ul}}),new ye({name:t.signatureValue||Ll})]})}fromSchema(e){G(e,jb);const t=z(e,e,rt.schema());q.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,om in t.result&&(this.version=t.result[om].valueBlock.valueDec),this.signature=new M({schema:t.result[jp]}),this.issuer=new Ee({schema:t.result[$p]}),this.thisUpdate=new ze({schema:t.result[um]}),Cc in t.result&&(this.nextUpdate=new ze({schema:t.result[Cc]})),lm in t.result&&(this.revokedCertificates=Array.from(t.result[lm],s=>new Ln({schema:s}))),cm in t.result&&(this.crlExtensions=new Qe({schema:t.result[cm]})),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==rt.defaultValues(ou)&&e.push(new H({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new O({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new O({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return rt.schema();const s=Xe(this.tbsView);q.assert(s,"TBS Certificate Revocation List"),t=s.result}return new O({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==rt.defaultValues(ou)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",s=fe(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),{parameters:n}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ye({valueHex:i})}async verify(e={},t=fe(!0)){let s;if(e.issuerCertificate&&(s=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(s=e.publicKeyInfo),!s)throw new Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(const a of this.crlExtensions.extensions)if(a.critical&&!Kb.includes(a.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}rt.CLASS_NAME="CertificateRevocationList";const Ii="crlId",Ci="crlValue",uu="parsedValue",Mb=[Ii,Ci];class jn extends _{constructor(e={}){super(),this.crlId=d(e,Ii,jn.defaultValues(Ii)),this.crlValue=d(e,Ci,jn.defaultValues(Ci)),uu in e&&(this.parsedValue=d(e,uu,jn.defaultValues(uu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ii:return E;case Ci:return new le;case uu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ii:return t===E;case Ci:return t instanceof le;case uu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.id||"id"}),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.value||"value"})]})]})}fromSchema(e){G(e,Mb);const t=z(e,e,jn.schema({names:{id:Ii,value:Ci}}));switch(q.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId){case Yd:this.parsedValue=rt.fromBER(this.certValue.valueBlock.valueHex);break;default:throw new Error("Incorrect CRL_ID value in CRLBag: ".concat(this.crlId))}}toSchema(){return this.parsedValue&&(this.crlId=Yd,this.crlValue=new X({valueHex:this.parsedValue.toSchema().toBER(!1)})),new O({value:[new ae({value:this.crlId}),new L({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}jn.CLASS_NAME="CRLBag";const Vi="version",xi="encryptedContentInfo",Mr="unprotectedAttrs",Hb=[Vi,xi,Mr];class Ds extends _{constructor(e={}){super(),this.version=d(e,Vi,Ds.defaultValues(Vi)),this.encryptedContentInfo=d(e,xi,Ds.defaultValues(xi)),Mr in e&&(this.unprotectedAttrs=d(e,Mr,Ds.defaultValues(Mr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vi:return 0;case xi:return new We;case Mr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vi:return t===0;case xi:return We.compareWithDefault("contentType",t.contentType)&&We.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&We.compareWithDefault("encryptedContent",t.encryptedContent);case Mr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),We.schema(t.encryptedContentInfo||{}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new me({name:t.unprotectedAttrs||E,value:Oe.schema()})]})]})}fromSchema(e){G(e,Hb);const t=z(e,e,Ds.schema({names:{version:Vi,encryptedContentInfo:{names:{blockName:xi}},unprotectedAttrs:Mr}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new We({schema:t.result.encryptedContentInfo}),Mr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new Oe({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}async encrypt(e,t=fe(!0)){Ne.assert(e,"parameters","object");const s=fr(Gt({},e),{contentType:"1.2.840.113549.1.7.1"});this.encryptedContentInfo=await t.encryptEncryptedContentInfo(s)}async decrypt(e,t=fe(!0)){Ne.assert(e,"parameters","object");const s=fr(Gt({},e),{encryptedContentInfo:this.encryptedContentInfo});return t.decryptEncryptedContentInfo(s)}}Ds.CLASS_NAME="EncryptedData";const ln="encryptionAlgorithm",Hr="encryptedData",lu="parsedValue",Fb=[ln,Hr];class ca extends _{constructor(e={}){super(),this.encryptionAlgorithm=d(e,ln,ca.defaultValues(ln)),this.encryptedData=d(e,Hr,ca.defaultValues(Hr)),lu in e&&(this.parsedValue=d(e,lu,ca.defaultValues(lu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ln:return new M;case Hr:return new X;case lu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ln:return M.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Hr:return t.isEqual(ca.defaultValues(e));case lu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.encryptionAlgorithm||{names:{blockName:ln}}),new je({value:[new X({name:t.encryptedData||Hr}),new X({idBlock:{isConstructed:!0},name:t.encryptedData||Hr})]})]})}fromSchema(e){G(e,Fb);const t=z(e,e,ca.schema({names:{encryptionAlgorithm:{names:{blockName:ln}},encryptedData:Hr}}));q.assertSchema(t,this.className),this.encryptionAlgorithm=new M({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new O({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=fe(!0)){const s=await new Ds({encryptedContentInfo:new We({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}).decrypt(e,t);this.parsedValue=us.fromBER(s)}async makeInternalValues(e,t=fe(!0)){if(!this.parsedValue)throw new Error('Please initialize "parsedValue" first');const s=new Ds,a=fr(Gt({},e),{contentToEncrypt:this.parsedValue.toSchema().toBER(!1)});if(await s.encrypt(a,t),!s.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=s.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=s.encryptedContentInfo.encryptedContent}}ca.CLASS_NAME="PKCS8ShroudedKeyBag";const Bi="secretTypeId",Oi="secretValue",Jb=[Bi,Oi];class Mo extends _{constructor(e={}){super(),this.secretTypeId=d(e,Bi,Mo.defaultValues(Bi)),this.secretValue=d(e,Oi,Mo.defaultValues(Oi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bi:return E;case Oi:return new le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bi:return t===E;case Oi:return t instanceof le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.id||"id"}),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.value||"value"})]})]})}fromSchema(e){G(e,Jb);const t=z(e,e,Mo.schema({names:{id:Bi,value:Oi}}));q.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new O({value:[new ae({value:this.secretTypeId}),new L({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}Mo.CLASS_NAME="SecretBag";class ua{static getItems(){return this.items||(this.items={},ua.register("1.2.840.113549.1.12.10.1.1",us),ua.register("1.2.840.113549.1.12.10.1.2",ca),ua.register("1.2.840.113549.1.12.10.1.3",Un),ua.register("1.2.840.113549.1.12.10.1.4",jn),ua.register("1.2.840.113549.1.12.10.1.5",Mo),ua.register("1.2.840.113549.1.12.10.1.6",ar)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}const cn="bagId",hn="bagValue",qs="bagAttributes",qb=[cn,hn,qs];class va extends _{constructor(e={}){super(),this.bagId=d(e,cn,va.defaultValues(cn)),this.bagValue=d(e,hn,va.defaultValues(hn)),qs in e&&(this.bagAttributes=d(e,qs,va.defaultValues(qs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cn:return E;case hn:return new le;case qs:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cn:return t===E;case hn:return t instanceof le;case qs:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.bagId||cn}),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.bagValue||hn})]}),new nt({optional:!0,value:[new me({name:t.bagAttributes||qs,value:Oe.schema()})]})]})}fromSchema(e){G(e,qb);const t=z(e,e,va.schema({names:{bagId:cn,bagValue:hn,bagAttributes:qs}}));q.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const s=ua.find(this.bagId);if(!s)throw new Error("Invalid BAG_ID for SafeBag: ".concat(this.bagId));this.bagValue=new s({schema:t.result.bagValue}),qs in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new Oe({schema:a})))}toSchema(){const e=[new ae({value:this.bagId}),new L({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new nt({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}va.CLASS_NAME="SafeBag";const ni="safeBags";class ar extends _{constructor(e={}){super(),this.safeBags=d(e,ni,ar.defaultValues(ni)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ni:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ni:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.safeBags||E,value:va.schema()})]})}fromSchema(e){G(e,[ni]);const t=z(e,e,ar.schema({names:{safeBags:ni}}));q.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,s=>new va({schema:s}))}toSchema(){return new O({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}ar.CLASS_NAME="SafeContents";const jl="otherCertFormat",$l="otherCert",Wb=[jl,$l];class Na extends _{constructor(e={}){super(),this.otherCertFormat=d(e,jl,Na.defaultValues(jl)),this.otherCert=d(e,$l,Na.defaultValues($l)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case jl:return E;case $l:return new le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.otherCertFormat||jl}),new le({name:t.otherCert||$l})]})}fromSchema(e){G(e,Wb);const t=z(e,e,Na.schema());q.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new O({value:[new ae({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof le||(e.otherCert=this.otherCert.toJSON()),e}}const Kl="certificates",_b=[Kl];class Ts extends _{constructor(e={}){super(),this.certificates=d(e,Kl,Ts.defaultValues(Kl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Kl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new nt({name:t.blockName||E,value:[new me({name:t.certificates||Kl,value:new je({value:[be.schema(),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le]}),new L({idBlock:{tagClass:3,tagNumber:1},value:[new O]}),new L({idBlock:{tagClass:3,tagNumber:2},value:ts.schema().valueBlock.value}),new L({idBlock:{tagClass:3,tagNumber:3},value:Na.schema().valueBlock.value})]})})]})}fromSchema(e){G(e,_b);const t=z(e,e,Ts.schema());q.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],s=>{const a=s.idBlock.tagNumber;if(s.idBlock.tagClass===1)return new be({schema:s});const n=new O({value:s.valueBlock.value});switch(a){case 1:return n.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec===1?new ts({schema:n}):new sr({schema:n});case 2:return new ts({schema:n});case 3:return new Na({schema:n})}return s})}toSchema(){return new nt({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof be:return e.toSchema();case e instanceof sr:return new L({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof ts:return new L({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof Na:return new L({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}Ts.CLASS_NAME="CertificateSet";const Ml="otherRevInfoFormat",Hl="otherRevInfo",Gb=[Ml,Hl];class or extends _{constructor(e={}){super(),this.otherRevInfoFormat=d(e,Ml,or.defaultValues(Ml)),this.otherRevInfo=d(e,Hl,or.defaultValues(Hl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ml:return E;case Hl:return new le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.otherRevInfoFormat||Ml}),new le({name:t.otherRevInfo||Hl})]})}fromSchema(e){G(e,Gb);const t=z(e,e,or.schema());q.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new O({value:[new ae({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof le||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}or.CLASS_NAME="OtherRevocationInfoFormat";const Fl="crls",df="otherRevocationInfos",zb=[Fl];class ur extends _{constructor(e={}){super(),this.crls=d(e,Fl,ur.defaultValues(Fl)),this.otherRevocationInfos=d(e,df,ur.defaultValues(df)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fl:return[];case df:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new nt({name:t.blockName||E,value:[new me({name:t.crls||E,value:new je({value:[rt.schema(),new L({idBlock:{tagClass:3,tagNumber:1},value:[new ae,new le]})]})})]})}fromSchema(e){G(e,zb);const t=z(e,e,ur.schema({names:{crls:Fl}}));if(q.assertSchema(t,this.className),t.result.crls)for(const s of t.result.crls)s.idBlock.tagClass===1?this.crls.push(new rt({schema:s})):this.otherRevocationInfos.push(new or({schema:s}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const s=t.toSchema();return s.idBlock.tagClass=3,s.idBlock.tagNumber=1,s})),new nt({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}ur.CLASS_NAME="RevocationInfoChoices";const Jl="certs",mn="crls",Xb=[Jl,mn];class zn extends _{constructor(e={}){super(),this.crls=d(e,mn,zn.defaultValues(mn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jl:return new Ts;case mn:return new ur;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Jl:return t.certificates.length===0;case mn:return t.crls.length===0&&t.otherRevocationInfos.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({name:t.certs||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Ts.schema().valueBlock.value}),new L({name:t.crls||E,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:ur.schema().valueBlock.value})]})}fromSchema(e){G(e,Xb);const t=z(e,e,zn.schema({names:{certs:Jl,crls:mn}}));q.assertSchema(t,this.className),Jl in t.result&&(this.certs=new Ts({schema:new nt({value:t.result.certs.valueBlock.value})})),mn in t.result&&(this.crls=new ur({schema:new nt({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new O({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}zn.CLASS_NAME="OriginatorInfo";const ql="issuer",Wl="serialNumber",Yb=[ql,Wl];class Ze extends _{constructor(e={}){super(),this.issuer=d(e,ql,Ze.defaultValues(ql)),this.serialNumber=d(e,Wl,Ze.defaultValues(Wl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ql:return new Ee;case Wl:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Ee.schema(t.issuer||{}),new H({name:t.serialNumber||E})]})}fromSchema(e){G(e,Yb);const t=z(e,e,Ze.schema({names:{issuer:{names:{blockName:ql}},serialNumber:Wl}}));q.assertSchema(t,this.className),this.issuer=new Ee({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new O({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}Ze.CLASS_NAME="IssuerAndSerialNumber";const zc="variant",cu="value",Qb=["blockName"];class Ho extends _{constructor(e={}){super(),this.variant=d(e,zc,Ho.defaultValues(zc)),cu in e&&(this.value=d(e,cu,Ho.defaultValues(cu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zc:return-1;case cu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zc:return t===-1;case cu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new je({value:[Ze.schema({names:{blockName:t.blockName||E}}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){G(e,Qb);const t=z(e,e,Ho.schema({names:{blockName:"blockName"}}));q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ze({schema:t.result.blockName})):(this.variant=2,this.value=new X({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof Ze))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof X))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new ue({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new le}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&this.value&&(e.value=this.value.toJSON()),e}}Ho.CLASS_NAME="RecipientIdentifier";const fn="version",Pi="rid",Di="keyEncryptionAlgorithm",Ti="encryptedKey",Xc="recipientCertificate",Zb=[fn,Pi,Di,Ti];class Xt extends _{constructor(e={}){super(),this.version=d(e,fn,Xt.defaultValues(fn)),this.rid=d(e,Pi,Xt.defaultValues(Pi)),this.keyEncryptionAlgorithm=d(e,Di,Xt.defaultValues(Di)),this.encryptedKey=d(e,Ti,Xt.defaultValues(Ti)),this.recipientCertificate=d(e,Xc,Xt.defaultValues(Xc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fn:return-1;case Pi:return{};case Di:return new M;case Ti:return new X;case Xc:return new be;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fn:return t===Xt.defaultValues(fn);case Pi:return Object.keys(t).length===0;case Di:case Ti:return t.isEqual(Xt.defaultValues(e));case Xc:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),Ho.schema(t.rid||{}),M.schema(t.keyEncryptionAlgorithm||{}),new X({name:t.encryptedKey||E})]})}fromSchema(e){G(e,Zb);const t=z(e,e,Xt.schema({names:{version:fn,rid:{names:{blockName:Pi}},keyEncryptionAlgorithm:{names:{blockName:Di}},encryptedKey:Ti}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,t.result.rid.idBlock.tagClass===3?this.rid=new X({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new Ze({schema:t.result.rid}),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof Ze?(this.version=0,e.push(new H({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new H({value:this.version})),e.push(new ue({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new O({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Xt.CLASS_NAME="KeyTransRecipientInfo";const Ri="algorithm",Ui="publicKey",eS=[Ri,Ui];class nr extends _{constructor(e={}){super(),this.algorithm=d(e,Ri,nr.defaultValues(Ri)),this.publicKey=d(e,Ui,nr.defaultValues(Ui)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ri:return new M;case Ui:return new ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ri:case Ui:return t.isEqual(nr.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.algorithm||{}),new ye({name:t.publicKey||E})]})}fromSchema(e){G(e,eS);const t=z(e,e,nr.schema({names:{algorithm:{names:{blockName:Ri}},publicKey:Ui}}));q.assertSchema(t,this.className),this.algorithm=new M({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new O({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}nr.CLASS_NAME="OriginatorPublicKey";const Yc="variant",hu="value",tS=["blockName"];class lr extends _{constructor(e={}){super(),this.variant=d(e,Yc,lr.defaultValues(Yc)),hu in e&&(this.value=d(e,hu,lr.defaultValues(hu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yc:return-1;case hu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yc:return t===-1;case hu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new je({value:[Ze.schema({names:{blockName:t.blockName||E}}),new ue({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||E}),new L({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||E,value:nr.schema().valueBlock.value})]})}fromSchema(e){G(e,tS);const t=z(e,e,lr.schema({names:{blockName:"blockName"}}));q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ze({schema:t.result.blockName})):t.result.blockName.idBlock.tagNumber===0?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new nr({schema:new O({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new le}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2||this.variant===3)&&(e.value=this.value.toJSON()),e}}lr.CLASS_NAME="OriginatorIdentifierOrKey";const Li="keyAttrId",Vs="keyAttr",sS=[Li,Vs];class Es extends _{constructor(e={}){super(),this.keyAttrId=d(e,Li,Es.defaultValues(Li)),Vs in e&&(this.keyAttr=d(e,Vs,Es.defaultValues(Vs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Li:return E;case Vs:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Li:return typeof t=="string"&&t===E;case Vs:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({optional:t.optional||!0,name:t.blockName||E,value:[new ae({name:t.keyAttrId||E}),new le({optional:!0,name:t.keyAttr||E})]})}fromSchema(e){G(e,sS);const t=z(e,e,Es.schema({names:{keyAttrId:Li,keyAttr:Vs}}));q.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),Vs in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new ae({value:this.keyAttrId})),Vs in this&&e.push(this.keyAttr),new O({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return Vs in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}Es.CLASS_NAME="OtherKeyAttribute";const pn="subjectKeyIdentifier",Fr="date",Jr="other",rS=[pn,Fr,Jr];class Os extends _{constructor(e={}){super(),this.subjectKeyIdentifier=d(e,pn,Os.defaultValues(pn)),Fr in e&&(this.date=d(e,Fr,Os.defaultValues(Fr))),Jr in e&&(this.other=d(e,Jr,Os.defaultValues(Jr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pn:return new X;case Fr:return new $e;case Jr:return new Es;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case pn:return t.isEqual(Os.defaultValues(pn));case Fr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Jr:return t.keyAttrId===E&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new X({name:t.subjectKeyIdentifier||E}),new $e({optional:!0,name:t.date||E}),Es.schema(t.other||{})]})}fromSchema(e){G(e,rS);const t=z(e,e,Os.schema({names:{subjectKeyIdentifier:pn,date:Fr,other:{names:{blockName:Jr}}}}));q.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,Fr in t.result&&(this.date=t.result.date),Jr in t.result&&(this.other=new Es({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new O({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}Os.CLASS_NAME="RecipientKeyIdentifier";const Qc="variant",Zc="value",aS=["blockName"];class Rs extends _{constructor(e={}){super(),this.variant=d(e,Qc,Rs.defaultValues(Qc)),this.value=d(e,Zc,Rs.defaultValues(Zc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qc:return-1;case Zc:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qc:return t===-1;case Zc:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new je({value:[Ze.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||E}}),new L({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:0},value:Os.schema(t.rKeyId||{names:{blockName:t.blockName||E}}).valueBlock.value})]})}fromSchema(e){G(e,aS);const t=z(e,e,Rs.schema({names:{blockName:"blockName"}}));q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ze({schema:t.result.blockName})):(this.variant=2,this.value=new Os({schema:new O({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new L({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new le}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&(e.value=this.value.toJSON()),e}}Rs.CLASS_NAME="KeyAgreeRecipientIdentifier";const ji="rid",dn="encryptedKey",nS=[ji,dn];class ir extends _{constructor(e={}){super(),this.rid=d(e,ji,ir.defaultValues(ji)),this.encryptedKey=d(e,dn,ir.defaultValues(dn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ji:return new Rs;case dn:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ji:return t.variant===-1&&!("value"in t);case dn:return t.isEqual(ir.defaultValues(dn));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Rs.schema(t.rid||{}),new X({name:t.encryptedKey||E})]})}fromSchema(e){G(e,nS);const t=z(e,e,ir.schema({names:{rid:{names:{blockName:ji}},encryptedKey:dn}}));q.assertSchema(t,this.className),this.rid=new Rs({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new O({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}ir.CLASS_NAME="RecipientEncryptedKey";const eh="encryptedKeys",jw="RecipientEncryptedKeys",iS=[jw];class Ea extends _{constructor(e={}){super(),this.encryptedKeys=d(e,eh,Ea.defaultValues(eh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eh:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case eh:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.RecipientEncryptedKeys||E,value:ir.schema()})]})}fromSchema(e){G(e,iS);const t=z(e,e,Ea.schema({names:{RecipientEncryptedKeys:jw}}));q.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,s=>new ir({schema:s}))}toSchema(){return new O({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}Ea.CLASS_NAME="RecipientEncryptedKeys";const $i="version",Ki="originator",Ws="ukm",Mi="keyEncryptionAlgorithm",Hi="recipientEncryptedKeys",th="recipientCertificate",sh="recipientPublicKey",oS=[$i,Ki,Ws,Mi,Hi];class qt extends _{constructor(e={}){super(),this.version=d(e,$i,qt.defaultValues($i)),this.originator=d(e,Ki,qt.defaultValues(Ki)),Ws in e&&(this.ukm=d(e,Ws,qt.defaultValues(Ws))),this.keyEncryptionAlgorithm=d(e,Mi,qt.defaultValues(Mi)),this.recipientEncryptedKeys=d(e,Hi,qt.defaultValues(Hi)),this.recipientCertificate=d(e,th,qt.defaultValues(th)),this.recipientPublicKey=d(e,sh,qt.defaultValues(sh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $i:return 0;case Ki:return new lr;case Ws:return new X;case Mi:return new M;case Hi:return new Ea;case th:return new be;case sh:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $i:return t===0;case Ki:return t.variant===-1&&!("value"in t);case Ws:return t.isEqual(qt.defaultValues(Ws));case Mi:return t.algorithmId===E&&!("algorithmParams"in t);case Hi:return t.encryptedKeys.length===0;case th:return!1;case sh:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new L({idBlock:{tagClass:3,tagNumber:0},value:[lr.schema(t.originator||{})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new X({name:t.ukm||E})]}),M.schema(t.keyEncryptionAlgorithm||{}),Ea.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){G(e,oS);const t=z(e,e,qt.schema({names:{version:$i,originator:{names:{blockName:Ki}},ukm:Ws,keyEncryptionAlgorithm:{names:{blockName:Mi}},recipientEncryptedKeys:{names:{blockName:Hi}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new lr({schema:t.result.originator}),Ws in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new Ea({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new O({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}qt.CLASS_NAME="KeyAgreeRecipientInfo";const gn="keyIdentifier",qr="date",Wr="other",uS=[gn,qr,Wr];class Ss extends _{constructor(e={}){super(),this.keyIdentifier=d(e,gn,Ss.defaultValues(gn)),qr in e&&(this.date=d(e,qr,Ss.defaultValues(qr))),Wr in e&&(this.other=d(e,Wr,Ss.defaultValues(Wr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gn:return new X;case qr:return new $e;case Wr:return new Es;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case gn:return t.isEqual(Ss.defaultValues(gn));case qr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Wr:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new X({name:t.keyIdentifier||E}),new $e({optional:!0,name:t.date||E}),Es.schema(t.other||{})]})}fromSchema(e){G(e,uS);const t=z(e,e,Ss.schema({names:{keyIdentifier:gn,date:qr,other:{names:{blockName:Wr}}}}));q.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,qr in t.result&&(this.date=t.result.date),Wr in t.result&&(this.other=new Es({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new O({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}Ss.CLASS_NAME="KEKIdentifier";const Fi="version",Ji="kekid",qi="keyEncryptionAlgorithm",wn="encryptedKey",rh="preDefinedKEK",lS=[Fi,Ji,qi,wn];class Yt extends _{constructor(e={}){super(),this.version=d(e,Fi,Yt.defaultValues(Fi)),this.kekid=d(e,Ji,Yt.defaultValues(Ji)),this.keyEncryptionAlgorithm=d(e,qi,Yt.defaultValues(qi)),this.encryptedKey=d(e,wn,Yt.defaultValues(wn)),this.preDefinedKEK=d(e,rh,Yt.defaultValues(rh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fi:return 0;case Ji:return new Ss;case qi:return new M;case wn:return new X;case rh:return Ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===Yt.defaultValues(Fi);case Ji:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case qi:return t.algorithmId===E&&!("algorithmParams"in t);case wn:return t.isEqual(Yt.defaultValues(wn));case rh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),Ss.schema(t.kekid||{}),M.schema(t.keyEncryptionAlgorithm||{}),new X({name:t.encryptedKey||E})]})}fromSchema(e){G(e,lS);const t=z(e,e,Yt.schema({names:{version:Fi,kekid:{names:{blockName:Ji}},keyEncryptionAlgorithm:{names:{blockName:qi}},encryptedKey:wn}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new Ss({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new O({value:[new H({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Yt.CLASS_NAME="KEKRecipientInfo";const Wi="version",_r="keyDerivationAlgorithm",_i="keyEncryptionAlgorithm",yn="encryptedKey",ah="password",cS=[Wi,_r,_i,yn];class os extends _{constructor(e={}){super(),this.version=d(e,Wi,os.defaultValues(Wi)),_r in e&&(this.keyDerivationAlgorithm=d(e,_r,os.defaultValues(_r))),this.keyEncryptionAlgorithm=d(e,_i,os.defaultValues(_i)),this.encryptedKey=d(e,yn,os.defaultValues(yn)),this.password=d(e,ah,os.defaultValues(ah)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wi:return-1;case _r:return new M;case _i:return new M;case yn:return new X;case ah:return Ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wi:return t===-1;case _r:case _i:return t.algorithmId===E&&!("algorithmParams"in t);case yn:return t.isEqual(os.defaultValues(yn));case ah:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new L({name:t.keyDerivationAlgorithm||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:M.schema().valueBlock.value}),M.schema(t.keyEncryptionAlgorithm||{}),new X({name:t.encryptedKey||E})]})}fromSchema(e){G(e,cS);const t=z(e,e,os.schema({names:{version:Wi,keyDerivationAlgorithm:_r,keyEncryptionAlgorithm:{names:{blockName:_i}},encryptedKey:yn}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,_r in t.result&&(this.keyDerivationAlgorithm=new M({schema:new O({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new H({value:this.version})),this.keyDerivationAlgorithm&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new O({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}os.CLASS_NAME="PasswordRecipientInfo";const Gi="oriType",vn="oriValue",hS=[Gi,vn];class ba extends _{constructor(e={}){super(),this.oriType=d(e,Gi,ba.defaultValues(Gi)),this.oriValue=d(e,vn,ba.defaultValues(vn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gi:return E;case vn:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Gi:return t===E;case vn:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.oriType||E}),new le({name:t.oriValue||E})]})}fromSchema(e){G(e,hS);const t=z(e,e,ba.schema({names:{oriType:Gi,oriValue:vn}}));q.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new O({value:[new ae({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return ba.compareWithDefault(vn,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}ba.CLASS_NAME="OtherRecipientInfo";const nh="variant",mu="value",mS=["blockName"];class ls extends _{constructor(e={}){super(),this.variant=d(e,nh,ls.defaultValues(nh)),mu in e&&(this.value=d(e,mu,ls.defaultValues(mu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nh:return-1;case mu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nh:return t===ls.defaultValues(e);case mu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new je({value:[Xt.schema({names:{blockName:t.blockName||E}}),new L({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:1},value:qt.schema().valueBlock.value}),new L({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:2},value:Yt.schema().valueBlock.value}),new L({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:3},value:os.schema().valueBlock.value}),new L({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:4},value:ba.schema().valueBlock.value})]})}fromSchema(e){G(e,mS);const t=z(e,e,ls.schema({names:{blockName:"blockName"}}));if(q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1)this.variant=1,this.value=new Xt({schema:t.result.blockName});else{const s=new O({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new qt({schema:s});break;case 2:this.variant=3,this.value=new Yt({schema:s});break;case 3:this.variant=4,this.value=new os({schema:s});break;case 4:this.variant=5,this.value=new ba({schema:s});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){ve.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new le}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}ls.CLASS_NAME="RecipientInfo";const Gr="hashAlgorithm",zr="maskGenAlgorithm",Xr="pSourceAlgorithm",fS=[Gr,zr,Xr];class Rt extends _{constructor(e={}){super(),this.hashAlgorithm=d(e,Gr,Rt.defaultValues(Gr)),this.maskGenAlgorithm=d(e,zr,Rt.defaultValues(zr)),this.pSourceAlgorithm=d(e,Xr,Rt.defaultValues(Xr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gr:return new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new at});case zr:return new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new at}).toSchema()});case Xr:return new M({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new X({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[M.schema(t.hashAlgorithm||{})]}),new L({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[M.schema(t.maskGenAlgorithm||{})]}),new L({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[M.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){G(e,fS);const t=z(e,e,Rt.schema({names:{hashAlgorithm:{names:{blockName:Gr}},maskGenAlgorithm:{names:{blockName:zr}},pSourceAlgorithm:{names:{blockName:Xr}}}}));q.assertSchema(t,this.className),Gr in t.result&&(this.hashAlgorithm=new M({schema:t.result.hashAlgorithm})),zr in t.result&&(this.maskGenAlgorithm=new M({schema:t.result.maskGenAlgorithm})),Xr in t.result&&(this.pSourceAlgorithm=new M({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Rt.defaultValues(Gr))||e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Rt.defaultValues(zr))||e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(Rt.defaultValues(Xr))||e.push(new L({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new O({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Rt.defaultValues(Gr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Rt.defaultValues(zr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(Rt.defaultValues(Xr))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}Rt.CLASS_NAME="RSAESOAEPParams";const zi="keyInfo",Yr="entityUInfo",Xi="suppPubInfo",pS=[zi,Yr,Xi];class Zs extends _{constructor(e={}){super(),this.keyInfo=d(e,zi,Zs.defaultValues(zi)),Yr in e&&(this.entityUInfo=d(e,Yr,Zs.defaultValues(Yr))),this.suppPubInfo=d(e,Xi,Zs.defaultValues(Xi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zi:return new M;case Yr:return new X;case Xi:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zi:case Yr:case Xi:return t.isEqual(Zs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.keyInfo||{}),new L({name:t.entityUInfo||E,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new X]}),new L({name:t.suppPubInfo||E,idBlock:{tagClass:3,tagNumber:2},value:[new X]})]})}fromSchema(e){G(e,pS);const t=z(e,e,Zs.schema({names:{keyInfo:{names:{blockName:zi}},entityUInfo:Yr,suppPubInfo:Xi}}));q.assertSchema(t,this.className),this.keyInfo=new M({schema:t.result.keyInfo}),Yr in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new L({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new O({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}Zs.CLASS_NAME="ECCCMSSharedInfo";const Yi="version",Qr="originatorInfo",Qi="recipientInfos",Zi="encryptedContentInfo",Zr="unprotectedAttrs",dS=[Yi,Qr,Qi,Zi,Zr],dg={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},gS={"P-256":256,"P-384":384,"P-521":528};class vs extends _{constructor(e={}){super(),this.version=d(e,Yi,vs.defaultValues(Yi)),Qr in e&&(this.originatorInfo=d(e,Qr,vs.defaultValues(Qr))),this.recipientInfos=d(e,Qi,vs.defaultValues(Qi)),this.encryptedContentInfo=d(e,Zi,vs.defaultValues(Zi)),Zr in e&&(this.unprotectedAttrs=d(e,Zr,vs.defaultValues(Zr))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yi:return 0;case Qr:return new zn;case Qi:return[];case Zi:return new We;case Zr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yi:return t===vs.defaultValues(e);case Qr:return t.certs.certificates.length===0&&t.crls.crls.length===0;case Qi:case Zr:return t.length===0;case Zi:return We.compareWithDefault("contentType",t.contentType)&&We.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&We.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new L({name:t.originatorInfo||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:zn.schema().valueBlock.value}),new nt({value:[new me({name:t.recipientInfos||E,value:ls.schema()})]}),We.schema(t.encryptedContentInfo||{}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new me({name:t.unprotectedAttrs||E,value:Oe.schema()})]})]})}fromSchema(e){G(e,dS);const t=z(e,e,vs.schema({names:{version:Yi,originatorInfo:Qr,recipientInfos:Qi,encryptedContentInfo:{names:{blockName:Zi}},unprotectedAttrs:Zr}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Qr in t.result&&(this.originatorInfo=new zn({schema:new O({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,s=>new ls({schema:s})),this.encryptedContentInfo=new We({schema:t.result.encryptedContentInfo}),Zr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new Oe({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),this.originatorInfo&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new nt({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,s,a=fe(!0)){const n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},dg,t||{});if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549")!==-1)s=1;else if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045")!==-1)s=2;else throw new Error("Unknown type of certificate's public key: ".concat(e.subjectPublicKeyInfo.algorithm.algorithmId));switch(s){case 1:{let i,o;if(n.useOAEP===!0){i=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const u=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),l=new M({algorithmId:u,algorithmParams:new at});o=new Rt({hashAlgorithm:l,maskGenAlgorithm:new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:l.toSchema()})}).toSchema()}else{if(i=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),i===E)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");o=new at}const h=new Xt({version:0,rid:new Ze({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new M({algorithmId:i,algorithmParams:o}),recipientCertificate:e});this.recipientInfos.push(new ls({variant:1,value:h}))}break;case 2:{const i=new Rs({variant:1,value:new Ze({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(i,n,{recipientCertificate:e},a)}break;default:throw new Error('Unknown "variant" value: '.concat(s))}return!0}addRecipientByPreDefinedData(e,t={},s,a=fe(!0)){if(Ne.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const n=new ArrayBuffer(16),i=new Uint8Array(n);a.getRandomValues(i),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),t.iterationCount===void 0&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new at),s){case 1:{const n=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),i=new Yt({version:4,kekid:new Ss({keyIdentifier:new X({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new M({algorithmId:n,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new ls({variant:3,value:i}))}break;case 2:{const n=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),i=new ArrayBuffer(64),o=new Uint8Array(i);a.getRandomValues(o);const h=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),u=new Bt({salt:new X({valueHex:i}),iterationCount:t.iterationCount,prf:new M({algorithmId:h,algorithmParams:new at})}),l=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),f=new os({version:0,keyDerivationAlgorithm:new M({algorithmId:n,algorithmParams:u.toSchema()}),keyEncryptionAlgorithm:new M({algorithmId:l,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new ls({variant:4,value:f}))}break;default:throw new Error('Unknown value for "variant": '.concat(s))}}addRecipientByKeyIdentifier(e,t,s,a=fe(!0)){const n=Object.assign({},dg,s||{}),i=new Rs({variant:2,value:new Os({subjectKeyIdentifier:new X({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,n,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,s,a=fe(!0)){const n=new ir({rid:e}),i=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),o=new M({algorithmId:i}),h=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),u=new ArrayBuffer(64),l=new Uint8Array(u);a.getRandomValues(l);const f={version:3,ukm:new X({valueHex:u}),keyEncryptionAlgorithm:new M({algorithmId:h,algorithmParams:o.toSchema()}),recipientEncryptedKeys:new Ea({encryptedKeys:[n]})},m=new qt(Object.assign(f,s));this.recipientInfos.push(new ls({variant:2,value:m}))}async encrypt(e,t,s=fe(!0)){const a=new ArrayBuffer(16),n=new Uint8Array(a);s.getRandomValues(n);const i=new Uint8Array(t),o=s.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),h=await s.generateKey(e,!0,["encrypt"]),u=await s.encrypt({name:e.name,iv:n},h,i),l=await s.exportKey("raw",h);this.version=2,this.encryptedContentInfo=new We({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new M({algorithmId:o,algorithmParams:new X({valueHex:a})}),encryptedContent:new X({valueHex:u})});const f=async y=>{const k=this.recipientInfos[y].value;let p,b;if(k.recipientPublicKey)p=k.recipientPublicKey.algorithm.namedCurve,b=k.recipientPublicKey;else if(k.recipientCertificate){const ie=k.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(ie.constructor.blockName()!==ae.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(y));switch(ie.valueBlock.toString()){case"1.2.840.10045.3.1.7":p="P-256";break;case"1.3.132.0.34":p="P-384";break;case"1.3.132.0.35":p="P-521";break;default:throw new Error("Incorrect curve OID for index ".concat(y))}b=await k.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:p},usages:[]}},s)}else throw new Error("Unsupported RecipientInfo");const I=gS[p],P=await s.generateKey({name:"ECDH",namedCurve:p},!0,["deriveBits"]),x=await s.exportKey("spki",P.publicKey),T=await s.deriveBits({name:"ECDH",public:b},P.privateKey,I),B=new M({schema:k.keyEncryptionAlgorithm.algorithmParams}),V=s.getAlgorithmByOID(B.algorithmId,!0,"aesKWAlgorithm");let J=V.length;const F=new ArrayBuffer(4),D=new Uint8Array(F);for(let ie=3;ie>=0;ie--)D[ie]=J,J>>=8;const j=new Zs({keyInfo:new M({algorithmId:B.algorithmId}),entityUInfo:k.ukm,suppPubInfo:new X({valueHex:F})}).toSchema().toBER(!1),te=s.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),Y=await sg(te.kdf,T,V.length,j,s),oe=await s.importKey("raw",Y,{name:"AES-KW"},!0,["wrapKey"]),ne=await s.wrapKey("raw",h,oe,{name:"AES-KW"}),de=new lr;return de.variant=3,de.value=nr.fromBER(x),k.originator=de,k.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new X({valueHex:ne}),{ecdhPrivateKey:P.privateKey}},m=async y=>{const k=this.recipientInfos[y].value,p=s.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(p.name==="RSA-OAEP"){const b=k.keyEncryptionAlgorithm.algorithmParams,I=new Rt({schema:b});if(p.hash=s.getAlgorithmByOID(I.hashAlgorithm.algorithmId),!("name"in p.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(I.hashAlgorithm.algorithmId))}try{const b=await k.recipientCertificate.getPublicKey({algorithm:{algorithm:p,usages:["encrypt","wrapKey"]}},s),I=await s.encrypt(b.algorithm,b,l);k.encryptedKey=new X({valueHex:I})}catch(b){}},v=async y=>{const k=this.recipientInfos[y].value,p=s.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),b=await s.importKey("raw",new Uint8Array(k.preDefinedKEK),p,!0,["wrapKey"]),I=await s.wrapKey("raw",h,b,p);k.encryptedKey=new X({valueHex:I})},w=async y=>{const k=this.recipientInfos[y].value;let p;if(!k.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!k.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{p=new Bt({schema:k.keyDerivationAlgorithm.algorithmParams})}catch(F){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const b=new Uint8Array(k.password),I=await s.importKey("raw",b,"PBKDF2",!1,["deriveKey"]),P=s.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let x="SHA-1";p.prf&&(x=s.getAlgorithmByOID(p.prf.algorithmId,!0,"prfAlgorithm").hash.name);const T=new Uint8Array(p.salt.valueBlock.valueHex),B=p.iterationCount,V=await s.deriveKey({name:"PBKDF2",hash:{name:x},salt:T,iterations:B},I,P,!0,["wrapKey"]),J=await s.wrapKey("raw",h,V,P);k.encryptedKey=new X({valueHex:J})},S=[];for(let y=0;y<this.recipientInfos.length;y++)switch(this.recipientInfos[y].variant){case 1:S.push(await m(y));break;case 2:S.push(await f(y));break;case 3:S.push(await v(y));break;case 4:S.push(await w(y));break;default:throw new Error("Unknown recipient type in array with index ".concat(y))}return S}async decrypt(e,t,s=fe(!0)){const a=t||{};if(e+1>this.recipientInfos.length)throw new Error('Maximum value for "index" is: '.concat(this.recipientInfos.length-1));const n=async S=>{const y=this.recipientInfos[S].value;let k,p,b;const I=y.originator;if(a.recipientCertificate){const Y=a.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(Y.constructor.blockName()!==ae.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(S));k=Y.valueBlock.toString()}else if(I.value.algorithm.algorithmParams){const Y=I.value.algorithm.algorithmParams;if(Y.constructor.blockName()!==ae.blockName())throw new Error("Incorrect originator for index ".concat(S));k=Y.valueBlock.toString()}else throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(k){case"1.2.840.10045.3.1.7":p="P-256",b=256;break;case"1.3.132.0.34":p="P-384",b=384;break;case"1.3.132.0.35":p="P-521",b=528;break;default:throw new Error("Incorrect curve OID for index ".concat(S))}let P,x=s;Be.isBufferSource(a.recipientPrivateKey)?P=await s.importKey("pkcs8",a.recipientPrivateKey,{name:"ECDH",namedCurve:p},!0,["deriveBits"]):(P=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(x=a.crypto.subtle)),"algorithmParams"in I.value.algorithm||(I.value.algorithm.algorithmParams=new ae({value:k}));const T=I.value.toSchema().toBER(!1),B=await s.importKey("spki",T,{name:"ECDH",namedCurve:p},!0,[]),V=await x.deriveBits({name:"ECDH",public:B},P,b);async function J(Y){Y=Y||!1;const oe=new M({schema:y.keyEncryptionAlgorithm.algorithmParams}),ne=s.getAlgorithmByOID(oe.algorithmId,!0,"kwAlgorithm");let de=ne.length;const ie=new ArrayBuffer(4),re=new Uint8Array(ie);for(let pe=3;pe>=0;pe--)re[pe]=de,de>>=8;const se={algorithmId:oe.algorithmId};Y&&(se.algorithmParams=new at);const ee=new Zs({keyInfo:new M(se),entityUInfo:y.ukm,suppPubInfo:new X({valueHex:ie})}).toSchema().toBER(!1),ce=s.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!ce.name)throw new Error("Incorrect OID for key encryption algorithm: ".concat(y.keyEncryptionAlgorithm.algorithmId));return sg(ce.kdf,V,ne.length,ee,s)}const F=await J(),D=async Y=>s.importKey("raw",Y,{name:"AES-KW"},!0,["unwrapKey"]),j=await D(F),te=async Y=>{const oe=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,ne=s.getAlgorithmByOID(oe,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",y.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,Y,{name:"AES-KW"},ne,!0,["decrypt"])};try{return await te(j)}catch(Y){const oe=await J(!0),ne=await D(oe);return te(ne)}},i=async S=>{const y=this.recipientInfos[S].value;if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const k=s.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(k.name==="RSA-OAEP"){const T=y.keyEncryptionAlgorithm.algorithmParams,B=new Rt({schema:T});if(k.hash=s.getAlgorithmByOID(B.hashAlgorithm.algorithmId),!("name"in k.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(B.hashAlgorithm.algorithmId))}let p,b=s;Be.isBufferSource(a.recipientPrivateKey)?p=await s.importKey("pkcs8",a.recipientPrivateKey,k,!0,["decrypt"]):(p=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(b=a.crypto.subtle));const I=await b.decrypt(p.algorithm,p,y.encryptedKey.valueBlock.valueHexView),P=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,x=s.getAlgorithmByOID(P,!0,"contentEncryptionAlgorithm");if(!("name"in x))throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(P));return s.importKey("raw",I,x,!0,["decrypt"])},o=async S=>{const y=this.recipientInfos[S].value;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const k=s.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),p=await s.importKey("raw",a.preDefinedData,k,!0,["unwrapKey"]),b=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,I=s.getAlgorithmByOID(b,!0,"contentEncryptionAlgorithm");if(!I.name)throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(b));return s.unwrapKey("raw",y.encryptedKey.valueBlock.valueHexView,p,k,I,!0,["decrypt"])},h=async S=>{const y=this.recipientInfos[S].value;let k;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!y.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!y.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{k=new Bt({schema:y.keyDerivationAlgorithm.algorithmParams})}catch(J){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const p=await s.importKey("raw",a.preDefinedData,"PBKDF2",!1,["deriveKey"]),b=s.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),I=k.prf?s.getAlgorithmByOID(k.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",P=new Uint8Array(k.salt.valueBlock.valueHex),x=k.iterationCount,T=await s.deriveKey({name:"PBKDF2",hash:{name:I},salt:P,iterations:x},p,b,!0,["unwrapKey"]),B=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,V=s.getAlgorithmByOID(B,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",y.encryptedKey.valueBlock.valueHexView,T,b,V,!0,["decrypt"])};let u;switch(this.recipientInfos[e].variant){case 1:u=await i(e);break;case 2:u=await n(e);break;case 3:u=await o(e);break;case 4:u=await h(e);break;default:throw new Error("Unknown recipient type in array with index ".concat(e))}const l=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,f=s.getAlgorithmByOID(l,!0,"contentEncryptionAlgorithm"),m=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,v=new Uint8Array(m);if(!this.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const w=this.encryptedContentInfo.getEncryptedContent();return s.decrypt({name:f.name,iv:v},u,w)}}vs.CLASS_NAME="EnvelopedData";const ii="safeContents",fu="parsedValue",gg="contentInfos";class Xn extends _{constructor(e={}){super(),this.safeContents=d(e,ii,Xn.defaultValues(ii)),fu in e&&(this.parsedValue=d(e,fu,Xn.defaultValues(fu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ii:return[];case fu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ii:return t.length===0;case fu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.contentInfos||E,value:Ie.schema()})]})}fromSchema(e){G(e,[gg]);const t=z(e,e,Xn.schema({names:{contentInfos:gg}}));q.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,s=>new Ie({schema:s}))}toSchema(){return new O({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=fe(!0)){if(ve.assert(e,ii),Ne.assert(e.safeContents,ii,"Array"),e.safeContents.length!==this.safeContents.length)throw new Ne('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');this.parsedValue={safeContents:[]};for(const[s,a]of this.safeContents.entries()){const n=e.safeContents[s],i="parameters.safeContents[".concat(s,"]");switch(a.contentType){case Pp:{Ne.assert(a.content,"this.safeContents[j].content",X);const o=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:ar.fromBER(o)})}break;case Bw:{const o=new vs({schema:a.content});ve.assert(i,n,"recipientCertificate","recipientKey");const h=n,u=h.recipientCertificate,l=h.recipientKey,f=await o.decrypt(0,{recipientCertificate:u,recipientPrivateKey:l},t);this.parsedValue.safeContents.push({privacyMode:2,value:ar.fromBER(f)})}break;case Ow:{const o=new Ds({schema:a.content});ve.assert(i,n,"password");const h=n.password,u=await o.decrypt({password:h},t);this.parsedValue.safeContents.push({privacyMode:1,value:ar.fromBER(u)})}break;default:throw new Error('Unknown "contentType" for AuthenticatedSafe: " '.concat(a.contentType))}}}async makeInternalValues(e,t=fe(!0)){if(!this.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(Ne.assert(this.parsedValue,"this.parsedValue","object"),Ne.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),Ne.assert(e,"parameters","object"),ve.assert(e,"safeContents"),Ne.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new Ne('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');this.safeContents=[];for(const[s,a]of this.parsedValue.safeContents.entries())switch(ve.assert("content",a,"privacyMode","value"),Ne.assert(a.value,"content.value",ar),a.privacyMode){case 0:{const n=a.value.toSchema().toBER(!1);this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.1",content:new X({valueHex:n})}))}break;case 1:{const n=new Ds,i=e.safeContents[s];i.contentToEncrypt=a.value.toSchema().toBER(!1),await n.encrypt(i,t),this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.6",content:n.toSchema()}))}break;case 2:{const n=new vs,i=a.value.toSchema().toBER(!1),o=e.safeContents[s];switch(ve.assert("parameters.safeContents[".concat(s,"]"),o,"encryptingCertificate","encryptionAlgorithm"),!0){case o.encryptionAlgorithm.name.toLowerCase()==="aes-cbc":case o.encryptionAlgorithm.name.toLowerCase()==="aes-gcm":break;default:throw new Error('Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": '.concat(o.encryptionAlgorithm))}switch(!0){case o.encryptionAlgorithm.length===128:case o.encryptionAlgorithm.length===192:case o.encryptionAlgorithm.length===256:break;default:throw new Error('Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": '.concat(o.encryptionAlgorithm.length))}const h=o.encryptionAlgorithm;n.addRecipientByCertificate(o.encryptingCertificate,{},void 0,t),await n.encrypt(h,i,t),this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.3",content:n.toSchema()}))}break;default:throw new Error('Incorrect value for "content.privacyMode": '.concat(a.privacyMode))}return this}}Xn.CLASS_NAME="AuthenticatedSafe";const bn="hashAlgorithm",eo="issuerNameHash",to="issuerKeyHash",Sn="serialNumber",wS=[bn,eo,to,Sn];class Ge extends _{static async create(e,t,s=fe(!0)){const a=new Ge;return await a.createForCertificate(e,t,s),a}constructor(e={}){super(),this.hashAlgorithm=d(e,bn,Ge.defaultValues(bn)),this.issuerNameHash=d(e,eo,Ge.defaultValues(eo)),this.issuerKeyHash=d(e,to,Ge.defaultValues(to)),this.serialNumber=d(e,Sn,Ge.defaultValues(Sn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bn:return new M;case eo:case to:return new X;case Sn:return new H;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bn:return t.algorithmId===E&&!("algorithmParams"in t);case eo:case to:case Sn:return t.isEqual(Ge.defaultValues(Sn));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||E}}),new X({name:t.issuerNameHash||E}),new X({name:t.issuerKeyHash||E}),new H({name:t.serialNumber||E})]})}fromSchema(e){G(e,wS);const t=z(e,e,Ge.schema({names:{hashAlgorithm:bn,issuerNameHash:eo,issuerKeyHash:to,serialNumber:Sn}}));q.assertSchema(t,this.className),this.hashAlgorithm=new M({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new O({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!Be.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!Be.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,s=fe(!0)){ve.assert(t,bn,"issuerCertificate");const a=s.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new M({algorithmId:a,algorithmParams:new at});const n=t.issuerCertificate;this.serialNumber=e.serialNumber;const i=await s.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1));this.issuerNameHash=new X({valueHex:i});const o=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,h=await s.digest({name:t.hashAlgorithm},o);this.issuerKeyHash=new X({valueHex:h})}}Ge.CLASS_NAME="CertID";const so="certID",ro="certStatus",ao="thisUpdate",ea="nextUpdate",An="singleExtensions",yS=[so,ro,ao,ea,An];class bs extends _{constructor(e={}){super(),this.certID=d(e,so,bs.defaultValues(so)),this.certStatus=d(e,ro,bs.defaultValues(ro)),this.thisUpdate=d(e,ao,bs.defaultValues(ao)),ea in e&&(this.nextUpdate=d(e,ea,bs.defaultValues(ea))),An in e&&(this.singleExtensions=d(e,An,bs.defaultValues(An))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case so:return new Ge;case ro:return{};case ao:case ea:return new Date(0,0,0);case An:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case so:return Ge.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Ge.compareWithDefault("issuerNameHash",t.issuerNameHash)&&Ge.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&Ge.compareWithDefault("serialNumber",t.serialNumber);case ro:return Object.keys(t).length===0;case ao:case ea:return t===bs.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Ge.schema(t.certID||{}),new je({value:[new ue({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:0}}),new L({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:1},value:[new $e,new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new vc]})]}),new ue({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new $e({name:t.thisUpdate||E}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $e({name:t.nextUpdate||E})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Qe.schema(t.singleExtensions||{})]})]})}fromSchema(e){G(e,yS);const t=z(e,e,bs.schema({names:{certID:{names:{blockName:so}},certStatus:ro,thisUpdate:ao,nextUpdate:ea,singleExtensions:{names:{blockName:An}}}}));q.assertSchema(t,this.className),this.certID=new Ge({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),ea in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),An in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,s=>new _e({schema:s})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new $e({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[new $e({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new O({value:Array.from(this.singleExtensions,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}bs.CLASS_NAME="SingleResponse";const ih="tbs",Nn="version",_l="responderID",Gl="producedAt",zl="responses",no="responseExtensions",Zn="ResponseData",Ah="".concat(Zn,".").concat(Nn),io="".concat(Zn,".").concat(_l),_f="".concat(Zn,".").concat(Gl),Gf="".concat(Zn,".").concat(zl),Nh="".concat(Zn,".").concat(no),vS=[Zn,Ah,io,_f,Gf,Nh];class ct extends _{get tbs(){return Be.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,ih,ct.defaultValues(ih))),Nn in e&&(this.version=d(e,Nn,ct.defaultValues(Nn))),this.responderID=d(e,_l,ct.defaultValues(_l)),this.producedAt=d(e,Gl,ct.defaultValues(Gl)),this.responses=d(e,zl,ct.defaultValues(zl)),no in e&&(this.responseExtensions=d(e,no,ct.defaultValues(no))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nn:return 0;case ih:return Ye;case _l:return{};case Gl:return new Date(0,0,0);case zl:case no:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ih:return t.byteLength===0;case _l:return Object.keys(t).length===0;case Gl:return t===ct.defaultValues(e);case zl:case no:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||Zn,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:t.version||Ah})]}),new je({value:[new L({name:t.responderID||io,idBlock:{tagClass:3,tagNumber:1},value:[Ee.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new L({name:t.responderID||io,idBlock:{tagClass:3,tagNumber:2},value:[new X({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new $e({name:t.producedAt||_f}),new O({value:[new me({name:Gf,value:bs.schema(t.response||{})})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Qe.schema(t.extensions||{names:{blockName:Nh}})]})]})}fromSchema(e){G(e,vS);const t=z(e,e,ct.schema());q.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,Ah in t.result&&(this.version=t.result[Ah].valueBlock.valueDec),t.result[io].idBlock.tagNumber===1?this.responderID=new Ee({schema:t.result[io].valueBlock.value[0]}):this.responderID=t.result[io].valueBlock.value[0],this.producedAt=t.result[_f].toDate(),this.responses=Array.from(t.result[Gf],s=>new bs({schema:s})),Nh in t.result&&(this.responseExtensions=Array.from(t.result[Nh].valueBlock.value,s=>new _e({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return ct.schema();const s=Xe(this.tbsView);q.assert(s,"TBS Response Data"),t=s.result}else{const s=[];Nn in this&&s.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[new H({value:this.version})]})),this.responderID instanceof Ee?s.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):s.push(new L({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),s.push(new $e({valueDate:this.producedAt})),s.push(new O({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&s.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[new O({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new O({value:s})}return t}toJSON(){const e={};return Nn in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}ct.CLASS_NAME="ResponseData";const gf="trustedCerts",wf="certs",yf="crls",vf="ocsps",bf="checkDate",Sf="findOrigin",Af="findIssuer";var Dn;(function(r){r[r.unknown=-1]="unknown",r[r.success=0]="success",r[r.noRevocation=11]="noRevocation",r[r.noPath=60]="noPath",r[r.noValidPath=97]="noValidPath"})(Dn||(Dn={}));class ha extends Error{constructor(e,t){super(t),this.name=ha.NAME,this.code=e,this.message=t}}ha.NAME="ChainValidationError";function bS(r,e){for(let t=0;t<e.length;t++)if(Be.isEqual(r.tbsView,e[t].tbsView))return!0;return!1}class vm{constructor(e={}){this.trustedCerts=d(e,gf,this.defaultValues(gf)),this.certs=d(e,wf,this.defaultValues(wf)),this.crls=d(e,yf,this.defaultValues(yf)),this.ocsps=d(e,vf,this.defaultValues(vf)),this.checkDate=d(e,bf,this.defaultValues(bf)),this.findOrigin=d(e,Sf,this.defaultValues(Sf)),this.findIssuer=d(e,Af,this.defaultValues(Af))}static defaultFindOrigin(e,t){e.tbsView.byteLength===0&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));for(const s of t.certs)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),Be.isEqual(e.tbsView,s.tbsView))return"Intermediate Certificates";for(const s of t.trustedCerts)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),Be.isEqual(e.tbsView,s.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,s=fe(!0)){const a=[];let n=null,i=null,o=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,s))return[e]}catch(u){}if(e.extensions){for(const u of e.extensions)if(u.extnID===Bp&&u.parsedValue instanceof ga){u.parsedValue.keyIdentifier?n=u.parsedValue.keyIdentifier:(u.parsedValue.authorityCertIssuer&&(i=u.parsedValue.authorityCertIssuer),u.parsedValue.authorityCertSerialNumber&&(o=u.parsedValue.authorityCertSerialNumber));break}}function h(u){if(n!==null&&u.extensions){let f=!1;for(const m of u.extensions)if(m.extnID===Ev&&m.parsedValue){f=!0,Be.isEqual(m.parsedValue.valueBlock.valueHex,n.valueBlock.valueHexView)&&a.push(u);break}if(f)return}let l=!1;o!==null&&(l=u.serialNumber.isEqual(o)),i!==null?u.subject.isEqual(i)&&l&&a.push(u):e.issuer.isEqual(u.subject)&&a.push(u)}for(const u of t.trustedCerts)h(u);for(const u of t.certs)h(u);for(let u=a.length-1;u>=0;u--)try{await e.verify(a[u],s)===!1&&a.splice(u,1)}catch(l){a.splice(u,1)}return a}defaultValues(e){switch(e){case gf:return[];case wf:return[];case yf:return[];case vf:return[];case bf:return new Date;case Sf:return vm.defaultFindOrigin;case Af:return this.defaultFindIssuer;default:throw new Error("Invalid member name for CertificateChainValidationEngine class: ".concat(e))}}async sort(e=!1,t=fe(!0)){const s=[],a=async(w,S)=>{const y=[];function k(b){let I=!0;for(let P=0;P<b.length;P++){for(let x=0;x<b.length;x++)if(x!==P&&b[P]===b[x]){I=!1;break}if(!I)break}return I}if(bS(w,this.trustedCerts))return[[w]];const p=await this.findIssuer(w,this,S);if(p.length===0)throw new Error("No valid certificate paths found");for(let b=0;b<p.length;b++){if(Be.isEqual(p[b].tbsView,w.tbsView)){y.push([p[b]]);continue}const I=await a(p[b],S);for(let P=0;P<I.length;P++){const x=I[P].slice();x.splice(0,0,p[b]),k(x)?y.push(x):y.push(I[P])}}return y},n=async w=>{const S=[],y=[],k=[];if(S.push(...s.filter(p=>w.issuer.isEqual(p.subject))),S.length===0)return{status:1,statusMessage:"No certificate's issuers"};if(y.push(...this.crls.filter(p=>p.issuer.isEqual(w.issuer))),y.length===0)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let p=0;p<y.length;p++){const b=y[p];if(!(b.nextUpdate&&b.nextUpdate.value<this.checkDate))for(let I=0;I<S.length;I++)try{if(await y[p].verify({issuerCertificate:S[I]},t)){k.push({crl:y[p],certificate:S[I]});break}}catch(P){}}return k.length?{status:0,statusMessage:E,result:k}:{status:3,statusMessage:"No valid CRLs found"}},i=async(w,S)=>{const y=t.getAlgorithmByOID(w.signatureAlgorithm.algorithmId);if(!y.name||!y.hash)return 1;for(let k=0;k<this.ocsps.length;k++){const p=await this.ocsps[k].getCertificateStatus(w,S,t);if(p.isForCertificate)return p.status===0?0:1}return 2};async function o(w,S=!1){let y=!1,k=!1,p=!1,b=!1;if(w.extensions){for(let I=0;I<w.extensions.length;I++){const P=w.extensions[I];if(P.critical&&!P.parsedValue)return{result:!1,resultCode:6,resultMessage:"Unable to parse critical certificate extension: ".concat(P.extnID)};if(P.extnID===kv){p=!0;const x=new Uint8Array(P.parsedValue.valueBlock.valueHex);(x[0]&4)===4&&(k=!0),(x[0]&2)===2&&(b=!0)}P.extnID===Vp&&"cA"in P.parsedValue&&P.parsedValue.cA===!0&&(y=!0)}if(k===!0&&y===!1)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(p===!0&&y===!0&&k===!1)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(y===!0&&p===!0&&S&&b===!1)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return y===!1?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:E}}const h=async(w,S)=>{for(let y=0;y<w.length;y++)if(w[y].notBefore.value>S||w[y].notAfter.value<S)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(w.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let y=w.length-2;y>=0;y--)if(w[y].issuer.isEqual(w[y].subject)===!1&&w[y].issuer.isEqual(w[y+1].subject)===!1)return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(this.crls.length!==0||this.ocsps.length!==0)for(let y=0;y<w.length-1;y++){let k=2,p={status:0,statusMessage:E};if(this.ocsps.length!==0)switch(k=await i(w[y],w[y+1]),k){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(this.crls.length!==0){if(p=await n(w[y]),p.status===0&&p.result)for(let b=0;b<p.result.length;b++){if(p.result[b].crl.isCertificateRevoked(w[y]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if((await o(p.result[b].certificate,!0)).result===!1)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(e===!1)throw new ha(Dn.noRevocation,"No revocation values found for one of certificates: ".concat(p.statusMessage))}else if(k===2)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(k===2&&p.status===2&&e){const b=w[y+1];let I=!1;if(b.extensions)for(const P of b.extensions)switch(P.extnID){case kw:case xp:case Op:I=!0;break}if(I)throw new ha(Dn.noRevocation,"No revocation values found for one of certificates: ".concat(p.statusMessage))}}for(const[y,k]of w.entries())if(y&&!(await o(k)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}};s.push(...this.trustedCerts),s.push(...this.certs);for(let w=0;w<s.length;w++)for(let S=0;S<s.length;S++)if(w!==S&&Be.isEqual(s[w].tbsView,s[S].tbsView)){s.splice(S,1),w=0;break}const u=s[s.length-1];let l;const f=[u];if(l=await a(u,t),l.length===0)throw new ha(Dn.noPath,"Unable to find certificate path");for(let w=l.length-1;w>=0;w--){let S=!1;for(let y=0;y<l[w].length;y++){const k=l[w][y];for(let p=0;p<this.trustedCerts.length;p++)if(Be.isEqual(k.tbsView,this.trustedCerts[p].tbsView)){S=!0;break}if(S)break}S||l.splice(w,1)}if(l.length===0)throw new ha(Dn.noValidPath,"No valid certificate paths found");let m=l[0].length,v=0;for(let w=0;w<l.length;w++)l[w].length<m&&(m=l[w].length,v=w);for(let w=0;w<l[v].length;w++)f.push(l[v][w]);if(l=await h(f,this.checkDate),l.result===!1)throw l;return f}async verify(e={},t=fe(!0)){function s(h,u){const l=oa(h),f=oa(u),m=l.split("."),v=f.split("."),w=m.length,S=v.length;if(w===0||S===0||w<S)return!1;for(let y=0;y<w;y++)if(m[y].length===0)return!1;for(let y=0;y<S;y++)if(v[y].length===0){if(y===0){if(S===1)return!1;continue}return!1}for(let y=0;y<S;y++)if(v[S-1-y].length!==0&&m[w-1-y].localeCompare(v[S-1-y])!==0)return!1;return!0}function a(h,u){const l=oa(h),f=oa(u),m=l.split("@"),v=f.split("@");if(m.length===0||v.length===0||m.length<v.length)return!1;if(v.length===1){if(s(m[1],v[0])){const w=m[1].split("."),S=v[0].split(".");return S[0].length===0?!0:w.length===S.length}return!1}return l.localeCompare(f)===0}function n(h,u){let l=oa(h);const f=oa(u),m=l.split("/");if(f.split("/").length>1)return!1;if(m.length>1){for(let v=0;v<m.length;v++)if(m[v].length>0&&m[v].charAt(m[v].length-1)!==":"){l=m[v].split(":")[0];break}}if(s(l,f)){const v=l.split("."),w=f.split(".");return w[0].length===0?!0:v.length===w.length}return!1}function i(h,u){const l=h.valueBlock.valueHexView,f=u.valueBlock.valueHexView;if(l.length===4&&f.length===8){for(let m=0;m<4;m++)if((l[m]^f[m])&f[m+4])return!1;return!0}if(l.length===16&&f.length===32){for(let m=0;m<16;m++)if((l[m]^f[m])&f[m+16])return!1;return!0}return!1}function o(h,u){if(h.typesAndValues.length===0||u.typesAndValues.length===0)return!0;if(h.typesAndValues.length<u.typesAndValues.length)return!1;let l=!0,f=0;for(let m=0;m<u.typesAndValues.length;m++){let v=!1;for(let w=f;w<h.typesAndValues.length;w++)if(v=h.typesAndValues[w].isEqual(u.typesAndValues[m]),h.typesAndValues[w].type===u.typesAndValues[m].type&&(l=l&&v),v===!0)if(f===0||f===w){f=w+1;break}else return!1;if(v===!1)return!1}return f===0?!1:l}try{if(this.certs.length===0)throw new Error("Empty certificate array");const h=e.passedWhenNotRevValues||!1,u=e.initialPolicySet||[as],l=e.initialExplicitPolicy||!1,f=e.initialPolicyMappingInhibit||!1,m=e.initialInhibitPolicy||!1,v=e.initialPermittedSubtreesSet||[],w=e.initialExcludedSubtreesSet||[],S=e.initialRequiredNameForms||[];let y=l,k=f,p=m;const b=[!1,!1,!1];let I=0,P=0,x=0,T=v,B=w;const V=S;let J=1;this.certs=await this.sort(h,t);const F=[];F.push(as);const D=[],j=new Array(this.certs.length-1);for(let re=0;re<this.certs.length-1;re++)j[re]=!0;D.push(j);const te=new Array(this.certs.length-1),Y=new Array(this.certs.length-1);let oe=y?this.certs.length-1:-1;for(let re=this.certs.length-2;re>=0;re--,J++){const se=this.certs[re];if(se.extensions){for(let ee=0;ee<se.extensions.length;ee++){const ce=se.extensions[ee];if(ce.extnID===Iw){Y[re]=ce.parsedValue;for(let pe=0;pe<F.length;pe++)if(F[pe]===as){delete D[pe][re];break}for(let pe=0;pe<ce.parsedValue.certificatePolicies.length;pe++){let Ce=-1;const Fe=ce.parsedValue.certificatePolicies[pe].policyIdentifier;for(let C=0;C<F.length;C++)if(Fe===F[C]){Ce=C;break}if(Ce===-1){F.push(Fe);const C=new Array(this.certs.length-1);C[re]=!0,D.push(C)}else D[Ce][re]=!0}}if(ce.extnID===Cw){if(k)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};te[re]=ce.parsedValue}ce.extnID===Vw&&y===!1&&(ce.parsedValue.requireExplicitPolicy===0?(y=!0,oe=re):b[0]===!1?(b[0]=!0,I=ce.parsedValue.requireExplicitPolicy):I=I>ce.parsedValue.requireExplicitPolicy?ce.parsedValue.requireExplicitPolicy:I,ce.parsedValue.inhibitPolicyMapping===0?k=!0:b[1]===!1?(b[1]=!0,P=ce.parsedValue.inhibitPolicyMapping+1):P=P>ce.parsedValue.inhibitPolicyMapping+1?ce.parsedValue.inhibitPolicyMapping+1:P),ce.extnID===Dv&&p===!1&&(ce.parsedValue.valueBlock.valueDec===0?p=!0:b[2]===!1?(b[2]=!0,x=ce.parsedValue.valueBlock.valueDec):x=x>ce.parsedValue.valueBlock.valueDec?ce.parsedValue.valueBlock.valueDec:x)}if(p===!0){let ee=-1;for(let ce=0;ce<F.length;ce++)if(F[ce]===as){ee=ce;break}ee!==-1&&delete D[0][re]}y===!1&&b[0]===!0&&(I--,I===0&&(y=!0,oe=re,b[0]=!1)),k===!1&&b[1]===!0&&(P--,P===0&&(k=!0,b[1]=!1)),p===!1&&b[2]===!0&&(x--,x===0&&(p=!0,b[2]=!1))}}for(let re=0;re<this.certs.length-1;re++)if(re<this.certs.length-2&&typeof te[re+1]<"u")for(let se=0;se<te[re+1].mappings.length;se++){if(te[re+1].mappings[se].issuerDomainPolicy===as||te[re+1].mappings[se].subjectDomainPolicy===as)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let ee=-1,ce=-1;for(let pe=0;pe<F.length;pe++)F[pe]===te[re+1].mappings[se].issuerDomainPolicy&&(ee=pe),F[pe]===te[re+1].mappings[se].subjectDomainPolicy&&(ce=pe);typeof D[ee][re]<"u"&&delete D[ee][re];for(let pe=0;pe<Y[re].certificatePolicies.length;pe++)if(te[re+1].mappings[se].subjectDomainPolicy===Y[re].certificatePolicies[pe].policyIdentifier&&ee!==-1&&ce!==-1)for(let Ce=0;Ce<=re;Ce++)typeof D[ce][Ce]<"u"&&(D[ee][Ce]=!0,delete D[ce][Ce])}for(let re=0;re<F.length;re++)if(F[re]===as)for(let se=0;se<oe;se++)delete D[re][se];const ne=[];for(let re=0;re<D.length;re++){let se=!0;for(let ee=0;ee<this.certs.length-1;ee++){let ce=!1;if(ee<oe&&F[re]===as&&F.length>1){se=!1;break}if(typeof D[re][ee]>"u"){if(ee>=oe){for(let pe=0;pe<F.length;pe++)if(F[pe]===as){D[pe][ee]===!0&&(ce=!0);break}}if(!ce){se=!1;break}}}se===!0&&ne.push(F[re])}let de=[];if(u.length===1&&u[0]===as&&y===!1)de=u;else if(ne.length===1&&ne[0]===as)de=u;else for(let re=0;re<ne.length;re++)for(let se=0;se<u.length;se++)if(u[se]===ne[re]||u[se]===as){de.push(ne[re]);break}const ie={result:de.length>0,resultCode:0,resultMessage:de.length>0?E:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:ne,userConstrPolicies:de,explicitPolicyIndicator:y,policyMappings:te,certificatePath:this.certs};if(de.length===0||ie.result===!1)return ie;J=1;for(let re=this.certs.length-2;re>=0;re--,J++){const se=this.certs[re];let ee=[],ce=[],pe=[];if(se.extensions)for(let A=0;A<se.extensions.length;A++){const $=se.extensions[A];$.extnID===Ew&&("permittedSubtrees"in $.parsedValue&&(ce=ce.concat($.parsedValue.permittedSubtrees)),"excludedSubtrees"in $.parsedValue&&(pe=pe.concat($.parsedValue.excludedSubtrees))),$.extnID===bw&&(ee=ee.concat($.parsedValue.altNames))}let Ce=V.length<=0;for(let A=0;A<V.length;A++)switch(V[A].base.type){case 4:{if(V[A].base.value.typesAndValues.length!==se.subject.typesAndValues.length)continue;Ce=!0;for(let $=0;$<se.subject.typesAndValues.length;$++)if(se.subject.typesAndValues[$].type!==V[A].base.value.typesAndValues[$].type){Ce=!1;break}if(Ce===!0)break}break;default:}if(Ce===!1)throw ie.result=!1,ie.resultCode=21,ie.resultMessage="No necessary name form found",ie;const Fe=[[],[],[],[],[]];for(let A=0;A<T.length;A++)switch(T[A].base.type){case 1:Fe[0].push(T[A]);break;case 2:Fe[1].push(T[A]);break;case 4:Fe[2].push(T[A]);break;case 6:Fe[3].push(T[A]);break;case 7:Fe[4].push(T[A]);break;default:}for(let A=0;A<5;A++){let $=!1,U=!1;const ge=Fe[A];for(let ke=0;ke<ge.length;ke++){switch(A){case 0:if(ee.length>0)for(let he=0;he<ee.length;he++)ee[he].type===1&&(U=!0,$=$||a(ee[he].value,ge[ke].base.value));else for(let he=0;he<se.subject.typesAndValues.length;he++)(se.subject.typesAndValues[he].type==="1.2.840.113549.1.9.1"||se.subject.typesAndValues[he].type==="0.9.2342.19200300.100.1.3")&&(U=!0,$=$||a(se.subject.typesAndValues[he].value.valueBlock.value,ge[ke].base.value));break;case 1:if(ee.length>0)for(let he=0;he<ee.length;he++)ee[he].type===2&&(U=!0,$=$||s(ee[he].value,ge[ke].base.value));break;case 2:U=!0,$=o(se.subject,ge[ke].base.value);break;case 3:if(ee.length>0)for(let he=0;he<ee.length;he++)ee[he].type===6&&(U=!0,$=$||n(ee[he].value,ge[ke].base.value));break;case 4:if(ee.length>0)for(let he=0;he<ee.length;he++)ee[he].type===7&&(U=!0,$=$||i(ee[he].value,ge[ke].base.value));break;default:}if($)break}if($===!1&&ge.length>0&&U)throw ie.result=!1,ie.resultCode=41,ie.resultMessage='Failed to meet "permitted sub-trees" name constraint',ie}let C=!1;for(let A=0;A<B.length;A++){switch(B[A].base.type){case 1:if(ee.length>=0)for(let $=0;$<ee.length;$++)ee[$].type===1&&(C=C||a(ee[$].value,B[A].base.value));else for(let $=0;$<se.subject.typesAndValues.length;$++)(se.subject.typesAndValues[$].type==="1.2.840.113549.1.9.1"||se.subject.typesAndValues[$].type==="0.9.2342.19200300.100.1.3")&&(C=C||a(se.subject.typesAndValues[$].value.valueBlock.value,B[A].base.value));break;case 2:if(ee.length>0)for(let $=0;$<ee.length;$++)ee[$].type===2&&(C=C||s(ee[$].value,B[A].base.value));break;case 4:C=C||o(se.subject,B[A].base.value);break;case 6:if(ee.length>0)for(let $=0;$<ee.length;$++)ee[$].type===6&&(C=C||n(ee[$].value,B[A].base.value));break;case 7:if(ee.length>0)for(let $=0;$<ee.length;$++)ee[$].type===7&&(C=C||i(ee[$].value,B[A].base.value));break;default:}if(C)break}if(C===!0)throw ie.result=!1,ie.resultCode=42,ie.resultMessage='Failed to meet "excluded sub-trees" name constraint',ie;T=T.concat(ce),B=B.concat(pe)}return ie}catch(h){return h instanceof Error?h instanceof ha?{result:!1,resultCode:h.code,resultMessage:h.message,error:h}:{result:!1,resultCode:Dn.unknown,resultMessage:h.message,error:h}:h&&typeof h=="object"&&"resultMessage"in h?h:{result:!1,resultCode:-1,resultMessage:"".concat(h)}}}}const Eh="tbsResponseData",Xl="signatureAlgorithm",Yl="signature",oo="certs",Bc="BasicOCSPResponse",zf="".concat(Bc,".").concat(Eh),Xf="".concat(Bc,".").concat(Xl),Yf="".concat(Bc,".").concat(Yl),kh="".concat(Bc,".").concat(oo),SS=[zf,Xf,Yf,kh];class cs extends _{constructor(e={}){super(),this.tbsResponseData=d(e,Eh,cs.defaultValues(Eh)),this.signatureAlgorithm=d(e,Xl,cs.defaultValues(Xl)),this.signature=d(e,Yl,cs.defaultValues(Yl)),oo in e&&(this.certs=d(e,oo,cs.defaultValues(oo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Eh:return new ct;case Xl:return new M;case Yl:return new ye;case oo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let s=ct.compareWithDefault("tbs",t.tbs)&&ct.compareWithDefault("responderID",t.responderID)&&ct.compareWithDefault("producedAt",t.producedAt)&&ct.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(s=s&&ct.compareWithDefault("responseExtensions",t.responseExtensions)),s}case Xl:return t.algorithmId===E&&!("algorithmParams"in t);case Yl:return t.isEqual(cs.defaultValues(e));case oo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||Bc,value:[ct.schema(t.tbsResponseData||{names:{blockName:zf}}),M.schema(t.signatureAlgorithm||{names:{blockName:Xf}}),new ye({name:t.signature||Yf}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:[new me({name:kh,value:be.schema(t.certs||{})})]})]})]})}fromSchema(e){G(e,SS);const t=z(e,e,cs.schema());q.assertSchema(t,this.className),this.tbsResponseData=new ct({schema:t.result[zf]}),this.signatureAlgorithm=new M({schema:t.result[Xf]}),this.signature=t.result[Yf],kh in t.result&&(this.certs=Array.from(t.result[kh],s=>new be({schema:s})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[new O({value:Array.from(this.certs,t=>t.toSchema())})]})),new O({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}async getCertificateStatus(e,t,s=fe(!0)){const a={isForCertificate:!1,status:2},n={},i=[];for(const o of this.tbsResponseData.responses){const h=s.getAlgorithmByOID(o.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!n[h.name]){n[h.name]=1;const u=new Ge;i.push(u),await u.createForCertificate(e,{hashAlgorithm:h.name,issuerCertificate:t},s)}}for(const o of this.tbsResponseData.responses)for(const h of i)if(o.certID.isEqual(h)){a.isForCertificate=!0;try{switch(o.certStatus.idBlock.isConstructed){case!0:o.certStatus.idBlock.tagNumber===1&&(a.status=1);break;case!1:switch(o.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2;break;default:}break;default:}}catch(u){}return a}return a}async sign(e,t="SHA-1",s=fe(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters.algorithm;if(!("name"in n))throw new Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());const i=await s.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:n});this.signature=new ye({valueHex:i})}async verify(e={},t=fe(!0)){let s=null,a=-1;const n=e.trustedCerts||[];if(!this.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof Ee:for(const[o,h]of this.certs.entries())if(h.subject.isEqual(this.tbsResponseData.responderID)){a=o;break}break;case this.tbsResponseData.responderID instanceof X:for(const[o,h]of this.certs.entries()){const u=await t.digest({name:"sha-1"},h.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(yc(u,this.tbsResponseData.responderID.valueBlock.valueHex)){a=o;break}}break;default:throw new Error("Wrong value for responderID")}if(a===-1)throw new Error("Correct certificate was not found in OCSP response");s=this.certs[a];const i=[s];for(const o of this.certs){const h=await Lw(o,s);h&&i.push(h)}if(!(await new vm({certs:i,trustedCerts:n}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}cs.CLASS_NAME="BasicOCSPResponse";const Nf="tbs",Ef="version",kf="subject",If="subjectPublicKeyInfo",oi="attributes",Ql="signatureAlgorithm",Zl="signatureValue",zo="CertificationRequestInfo",Kp="".concat(zo,".version"),Mp="".concat(zo,".subject"),Hp="".concat(zo,".subjectPublicKeyInfo"),hm="".concat(zo,".attributes"),AS=[zo,Kp,Mp,Hp,hm,Ql,Zl];function NS(r={}){const e=d(r,"names",{});return new O({name:e.CertificationRequestInfo||zo,value:[new H({name:e.CertificationRequestInfoVersion||Kp}),Ee.schema(e.subject||{names:{blockName:Mp}}),Ht.schema({names:{blockName:Hp}}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({optional:!0,name:e.CertificationRequestInfoAttributes||hm,value:Oe.schema(e.attributes||{})})]})]})}class ys extends _{get tbs(){return Be.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,Nf,ys.defaultValues(Nf))),this.version=d(e,Ef,ys.defaultValues(Ef)),this.subject=d(e,kf,ys.defaultValues(kf)),this.subjectPublicKeyInfo=d(e,If,ys.defaultValues(If)),oi in e&&(this.attributes=d(e,oi,ys.defaultValues(oi))),this.signatureAlgorithm=d(e,Ql,ys.defaultValues(Ql)),this.signatureValue=d(e,Zl,ys.defaultValues(Zl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nf:return Ye;case Ef:return 0;case kf:return new Ee;case If:return new Ht;case oi:return[];case Ql:return new M;case Zl:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({value:[NS(t.certificationRequestInfo||{}),new O({name:t.signatureAlgorithm||Ql,value:[new ae,new le({optional:!0})]}),new ye({name:t.signatureValue||Zl})]})}fromSchema(e){G(e,AS);const t=z(e,e,ys.schema());q.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[Kp].valueBlock.valueDec,this.subject=new Ee({schema:t.result[Mp]}),this.subjectPublicKeyInfo=new Ht({schema:t.result[Hp]}),hm in t.result&&(this.attributes=Array.from(t.result[hm],s=>new Oe({schema:s}))),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new H({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return oi in this&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new O({value:e})}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return ys.schema();const s=Xe(this.tbsView);q.assert(s,"PKCS#10 Certificate Request"),t=s.result}else t=this.encodeTBS();return new O({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return oi in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}async sign(e,t="SHA-1",s=fe(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ye({valueHex:i})}async verify(e=fe(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=fe(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}ys.CLASS_NAME="CertificationRequest";const En="digestAlgorithm",kn="digest",ES=[En,kn];class ms extends _{constructor(e={}){super(),this.digestAlgorithm=d(e,En,ms.defaultValues(En)),this.digest=d(e,kn,ms.defaultValues(kn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case En:return new M;case kn:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case En:return M.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case kn:return t.isEqual(ms.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.digestAlgorithm||{names:{blockName:En}}),new X({name:t.digest||kn})]})}fromSchema(e){G(e,ES);const t=z(e,e,ms.schema({names:{digestAlgorithm:{names:{blockName:En}},digest:kn}}));q.assertSchema(t,this.className),this.digestAlgorithm=new M({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new O({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}ms.CLASS_NAME="DigestInfo";const uo="eContentType",ws="eContent",kS=[uo,ws];class _t extends _{constructor(e={}){if(super(),this.eContentType=d(e,uo,_t.defaultValues(uo)),ws in e&&(this.eContent=d(e,ws,_t.defaultValues(ws)),this.eContent.idBlock.tagClass===1&&this.eContent.idBlock.tagNumber===4&&this.eContent.idBlock.isConstructed===!1)){const t=new X({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,s,s+65536>a.byteLength?a.byteLength-s:65536),o=new ArrayBuffer(i.length),h=new Uint8Array(o);for(let u=0;u<h.length;u++)h[u]=i[u];t.valueBlock.value.push(new X({valueHex:o})),n-=i.length,s+=i.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uo:return E;case ws:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uo:return t===E;case ws:return t.idBlock.tagClass===1&&t.idBlock.tagNumber===4?t.isEqual(_t.defaultValues(ws)):!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.eContentType||E}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.eContent||E})]})]})}fromSchema(e){G(e,kS);const t=z(e,e,_t.schema({names:{eContentType:uo,eContent:ws}}));q.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),ws in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new ae({value:this.eContentType})),this.eContent&&_t.compareWithDefault(ws,this.eContent)===!1&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new O({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&_t.compareWithDefault(ws,this.eContent)===!1&&(e.eContent=this.eContent.toJSON()),e}}_t.CLASS_NAME="EncapsulatedContentInfo";const In="mac",Cn="macSalt",_s="iterations",IS=[In,Cn,_s];class Ut extends _{constructor(e={}){super(),this.mac=d(e,In,Ut.defaultValues(In)),this.macSalt=d(e,Cn,Ut.defaultValues(Cn)),_s in e&&(this.iterations=d(e,_s,Ut.defaultValues(_s))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case In:return new ms;case Cn:return new X;case _s:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case In:return ms.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&ms.compareWithDefault("digest",t.digest);case Cn:return t.isEqual(Ut.defaultValues(e));case _s:return t===Ut.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,optional:t.optional||!0,value:[ms.schema(t.mac||{names:{blockName:In}}),new X({name:t.macSalt||Cn}),new H({optional:!0,name:t.iterations||_s})]})}fromSchema(e){G(e,IS);const t=z(e,e,Ut.schema({names:{mac:{names:{blockName:In}},macSalt:Cn,iterations:_s}}));q.assertSchema(t,this.className),this.mac=new ms({schema:t.result.mac}),this.macSalt=t.result.macSalt,_s in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return this.iterations!==void 0&&e.push(new H({value:this.iterations})),new O({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return this.iterations!==void 0&&(e.iterations=this.iterations),e}}Ut.CLASS_NAME="MacData";const Tn="hashAlgorithm",Rn="hashedMessage",CS=[Tn,Rn];class Nt extends _{static async create(e,t,s=fe(!0)){const a=s.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),n=await s.digest(e,t);return new Nt({hashAlgorithm:new M({algorithmId:a,algorithmParams:new at}),hashedMessage:new X({valueHex:n})})}constructor(e={}){super(),this.hashAlgorithm=d(e,Tn,Nt.defaultValues(Tn)),this.hashedMessage=d(e,Rn,Nt.defaultValues(Rn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tn:return new M;case Rn:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Tn:return t.algorithmId===E&&!("algorithmParams"in t);case Rn:return t.isEqual(Nt.defaultValues(e))===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.hashAlgorithm||{}),new X({name:t.hashedMessage||E})]})}fromSchema(e){G(e,CS);const t=z(e,e,Nt.schema({names:{hashAlgorithm:{names:{blockName:Tn}},hashedMessage:Rn}}));q.assertSchema(t,this.className),this.hashAlgorithm=new M({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new O({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}Nt.CLASS_NAME="MessageImprint";const lo="reqCert",ta="singleRequestExtensions",VS=[lo,ta];let mm=class ec extends _{constructor(e={}){super(),this.reqCert=d(e,lo,ec.defaultValues(lo)),ta in e&&(this.singleRequestExtensions=d(e,ta,ec.defaultValues(ta))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lo:return new Ge;case ta:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case lo:return t.isEqual(ec.defaultValues(e));case ta:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Ge.schema(t.reqCert||{}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[_e.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||E}})]})]})}fromSchema(e){G(e,VS);const t=z(e,e,ec.schema({names:{reqCert:{names:{blockName:lo}},extensions:{names:{blockName:ta}}}}));q.assertSchema(t,this.className),this.reqCert=new Ge({schema:t.result.reqCert}),ta in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,s=>new _e({schema:s})))}toSchema(){const e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:Array.from(this.singleRequestExtensions,t=>t.toSchema())})]})),new O({value:e})}toJSON(){const e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,t=>t.toJSON())),e}};mm.CLASS_NAME="Request";const oh="tbs",co="version",ho="requestorName",uh="requestList",mo="requestExtensions",Xo="TBSRequest",Ih="".concat(Xo,".").concat(co),Ch="".concat(Xo,".").concat(ho),Qf="".concat(Xo,".requests"),Vh="".concat(Xo,".").concat(mo),xS=[Xo,Ih,Ch,Qf,Vh];class vt extends _{get tbs(){return Be.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,oh,vt.defaultValues(oh))),co in e&&(this.version=d(e,co,vt.defaultValues(co))),ho in e&&(this.requestorName=d(e,ho,vt.defaultValues(ho))),this.requestList=d(e,uh,vt.defaultValues(uh)),mo in e&&(this.requestExtensions=d(e,mo,vt.defaultValues(mo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oh:return Ye;case co:return 0;case ho:return new Se;case uh:case mo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oh:return t.byteLength===0;case co:return t===vt.defaultValues(e);case ho:return t.type===Se.defaultValues("type")&&Object.keys(t.value).length===0;case uh:case mo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||Xo,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:t.TBSRequestVersion||Ih})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Se.schema(t.requestorName||{names:{blockName:Ch}})]}),new O({name:t.requestList||"TBSRequest.requestList",value:[new me({name:t.requests||Qf,value:mm.schema(t.requestNames||{})})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[Qe.schema(t.extensions||{names:{blockName:t.requestExtensions||Vh}})]})]})}fromSchema(e){G(e,xS);const t=z(e,e,vt.schema());q.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,Ih in t.result&&(this.version=t.result[Ih].valueBlock.valueDec),Ch in t.result&&(this.requestorName=new Se({schema:t.result[Ch]})),this.requestList=Array.from(t.result[Qf],s=>new mm({schema:s})),Vh in t.result&&(this.requestExtensions=Array.from(t.result[Vh].valueBlock.value,s=>new _e({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return vt.schema();const s=Xe(this.tbsView);if(q.assert(s,"TBS Request"),!(s.result instanceof O))throw new Error("ASN.1 result should be SEQUENCE");t=s.result}else{const s=[];this.version!==void 0&&s.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[new H({value:this.version})]})),this.requestorName&&s.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),s.push(new O({value:Array.from(this.requestList,a=>a.toSchema())})),this.requestExtensions&&s.push(new L({idBlock:{tagClass:3,tagNumber:2},value:[new O({value:Array.from(this.requestExtensions,a=>a.toSchema())})]})),t=new O({value:s})}return t}toJSON(){const e={};return this.version!=null&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,t=>t.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,t=>t.toJSON())),e}}vt.CLASS_NAME="TBSRequest";const ui="signatureAlgorithm",li="signature",br="certs";class Zt extends _{constructor(e={}){super(),this.signatureAlgorithm=d(e,ui,Zt.defaultValues(ui)),this.signature=d(e,li,Zt.defaultValues(li)),br in e&&(this.certs=d(e,br,Zt.defaultValues(br))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ui:return new M;case li:return new ye;case br:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ui:return t.algorithmId===E&&!("algorithmParams"in t);case li:return t.isEqual(Zt.defaultValues(e));case br:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.signatureAlgorithm||{}),new ye({name:t.signature||E}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:[new me({name:t.certs||E,value:be.schema({})})]})]})]})}fromSchema(e){G(e,[ui,li,br]);const t=z(e,e,Zt.schema({names:{signatureAlgorithm:{names:{blockName:ui}},signature:li,certs:br}}));q.assertSchema(t,this.className),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,br in t.result&&(this.certs=Array.from(t.result.certs,s=>new be({schema:s})))}toSchema(){const e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:Array.from(this.certs,t=>t.toSchema())})]})),new O({value:e})}toJSON(){const e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}}Zt.CLASS_NAME="Signature";const fo="tbsRequest",sa="optionalSignature",BS=[fo,sa];class dc extends _{constructor(e={}){super(),this.tbsRequest=d(e,fo,dc.defaultValues(fo)),sa in e&&(this.optionalSignature=d(e,sa,dc.defaultValues(sa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fo:return new vt;case sa:return new Zt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fo:return vt.compareWithDefault("tbs",t.tbs)&&vt.compareWithDefault("version",t.version)&&vt.compareWithDefault("requestorName",t.requestorName)&&vt.compareWithDefault("requestList",t.requestList)&&vt.compareWithDefault("requestExtensions",t.requestExtensions);case sa:return Zt.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&Zt.compareWithDefault("signature",t.signature)&&Zt.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||"OCSPRequest",value:[vt.schema(t.tbsRequest||{names:{blockName:fo}}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Zt.schema(t.optionalSignature||{names:{blockName:sa}})]})]})}fromSchema(e){G(e,BS);const t=z(e,e,dc.schema());q.assertSchema(t,this.className),this.tbsRequest=new vt({schema:t.result.tbsRequest}),sa in t.result&&(this.optionalSignature=new Zt({schema:t.result.optionalSignature}))}toSchema(e=!1){const t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new O({value:t})}toJSON(){const e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,s=fe(!0)){const a=new Ge;await a.createForCertificate(e,t,s),this.tbsRequest.requestList.push(new mm({reqCert:a}))}async sign(e,t="SHA-1",s=fe(!0)){if(ve.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw new Error('Need to create "optionalSignature" field before signing');const a=await s.getSignatureParameters(e,t),n=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;const i=this.tbsRequest.toSchema(!0).toBER(!1),o=await s.signWithPrivateKey(i,e,n);this.optionalSignature.signature=new ye({valueHex:o})}verify(){}}dc.CLASS_NAME="OCSPRequest";const po="responseType",go="response",OS=[po,go];class As extends _{constructor(e={}){super(),this.responseType=d(e,po,As.defaultValues(po)),this.response=d(e,go,As.defaultValues(go)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case po:return E;case go:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case po:return t===E;case go:return t.isEqual(As.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.responseType||E}),new X({name:t.response||E})]})}fromSchema(e){G(e,OS);const t=z(e,e,As.schema({names:{responseType:po,response:go}}));q.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new O({value:[new ae({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}As.CLASS_NAME="ResponseBytes";const ci="responseStatus",js="responseBytes";class Ro extends _{constructor(e={}){super(),this.responseStatus=d(e,ci,Ro.defaultValues(ci)),js in e&&(this.responseBytes=d(e,js,Ro.defaultValues(js))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ci:return new vc;case js:return new As;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ci:return t.isEqual(Ro.defaultValues(e));case js:return As.compareWithDefault("responseType",t.responseType)&&As.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||"OCSPResponse",value:[new vc({name:t.responseStatus||ci}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[As.schema(t.responseBytes||{names:{blockName:js}})]})]})}fromSchema(e){G(e,[ci,js]);const t=z(e,e,Ro.schema());q.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,js in t.result&&(this.responseBytes=new As({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new O({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,s=fe(!0)){let a;const n={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==ph)return n;try{const i=Xe(this.responseBytes.response.valueBlock.valueHexView);q.assert(i,"Basic OCSP response"),a=new cs({schema:i.result})}catch(i){return n}return a.getCertificateStatus(e,t,s)}async sign(e,t,s=fe(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===ph)return cs.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,s);throw new Error("Unknown ResponseBytes type: ".concat(((a=this.responseBytes)===null||a===void 0?void 0:a.responseType)||"Unknown"))}async verify(e=null,t=fe(!0)){var s;if(!(js in this))throw new Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===ph){const a=cs.fromBER(this.responseBytes.response.valueBlock.valueHexView);return e!==null&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw new Error("Unknown ResponseBytes type: ".concat(((s=this.responseBytes)===null||s===void 0?void 0:s.responseType)||"Unknown"))}}Ro.CLASS_NAME="OCSPResponse";const Pa="type",Gs="attributes",lh="encodedValue",PS=[Gs];class Ue extends _{constructor(e={}){super(),this.type=d(e,Pa,Ue.defaultValues(Pa)),this.attributes=d(e,Gs,Ue.defaultValues(Gs)),this.encodedValue=d(e,lh,Ue.defaultValues(lh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pa:return-1;case Gs:return[];case lh:return Ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pa:return t===Ue.defaultValues(Pa);case Gs:return t.length===0;case lh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new L({name:t.blockName||E,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new me({name:t.attributes||E,value:Oe.schema()})]})}fromSchema(e){G(e,PS);const t=z(e,e,Ue.schema({names:{tagNumber:this.type,attributes:Gs}}));q.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=Be.toArrayBuffer(t.result.valueBeforeDecodeView);const s=new Uint8Array(this.encodedValue);if(s[0]=49,!(Gs in t.result)){if(this.type===0)throw new Error("Wrong structure of SignedUnsignedAttributes");return}this.attributes=Array.from(t.result.attributes,a=>new Oe({schema:a}))}toSchema(){if(Ue.compareWithDefault(Pa,this.type)||Ue.compareWithDefault(Gs,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new L({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(Ue.compareWithDefault(Pa,this.type)||Ue.compareWithDefault(Gs,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}Ue.CLASS_NAME="SignedAndUnsignedAttributes";const wo="version",Vn="sid",yo="digestAlgorithm",ra="signedAttrs",vo="signatureAlgorithm",tc="signature",aa="unsignedAttrs",Ca="SignerInfo",Zf="".concat(Ca,".").concat(wo),sc="".concat(Ca,".").concat(Vn),ep="".concat(Ca,".").concat(yo),xh="".concat(Ca,".").concat(ra),tp="".concat(Ca,".").concat(vo),sp="".concat(Ca,".").concat(tc),Bh="".concat(Ca,".").concat(aa),DS=[Zf,sc,ep,xh,tp,sp,Bh];class He extends _{constructor(e={}){super(),this.version=d(e,wo,He.defaultValues(wo)),this.sid=d(e,Vn,He.defaultValues(Vn)),this.digestAlgorithm=d(e,yo,He.defaultValues(yo)),ra in e&&(this.signedAttrs=d(e,ra,He.defaultValues(ra))),this.signatureAlgorithm=d(e,vo,He.defaultValues(vo)),this.signature=d(e,tc,He.defaultValues(tc)),aa in e&&(this.unsignedAttrs=d(e,aa,He.defaultValues(aa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wo:return 0;case Vn:return new le;case yo:return new M;case ra:return new Ue({type:0});case vo:return new M;case tc:return new X;case aa:return new Ue({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wo:return He.defaultValues(wo)===t;case Vn:return t instanceof le;case yo:return t instanceof M?t.isEqual(He.defaultValues(yo)):!1;case ra:return Ue.compareWithDefault("type",t.type)&&Ue.compareWithDefault("attributes",t.attributes)&&Ue.compareWithDefault("encodedValue",t.encodedValue);case vo:return t instanceof M?t.isEqual(He.defaultValues(vo)):!1;case tc:case aa:return Ue.compareWithDefault("type",t.type)&&Ue.compareWithDefault("attributes",t.attributes)&&Ue.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:Ca,value:[new H({name:t.version||Zf}),new je({value:[Ze.schema(t.sidSchema||{names:{blockName:sc}}),new je({value:[new L({optional:!0,name:t.sid||sc,idBlock:{tagClass:3,tagNumber:0},value:[new X]}),new ue({optional:!0,name:t.sid||sc,idBlock:{tagClass:3,tagNumber:0}})]})]}),M.schema(t.digestAlgorithm||{names:{blockName:ep}}),Ue.schema(t.signedAttrs||{names:{blockName:xh,tagNumber:0}}),M.schema(t.signatureAlgorithm||{names:{blockName:tp}}),new X({name:t.signature||sp}),Ue.schema(t.unsignedAttrs||{names:{blockName:Bh,tagNumber:1}})]})}fromSchema(e){G(e,DS);const t=z(e,e,He.schema());q.assertSchema(t,this.className),this.version=t.result[Zf].valueBlock.valueDec;const s=t.result[sc];s.idBlock.tagClass===1?this.sid=new Ze({schema:s}):this.sid=s,this.digestAlgorithm=new M({schema:t.result[ep]}),xh in t.result&&(this.signedAttrs=new Ue({type:0,schema:t.result[xh]})),this.signatureAlgorithm=new M({schema:t.result[tp]}),this.signature=t.result[sp],Bh in t.result&&(this.unsignedAttrs=new Ue({type:1,schema:t.result[Bh]}))}toSchema(){if(He.compareWithDefault(Vn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new H({value:this.version})),this.sid instanceof Ze?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&He.compareWithDefault(ra,this.signedAttrs)===!1&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&He.compareWithDefault(aa,this.unsignedAttrs)===!1&&e.push(this.unsignedAttrs.toSchema()),new O({value:e})}toJSON(){if(He.compareWithDefault(Vn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof le||(e.sid=this.sid.toJSON()),this.signedAttrs&&He.compareWithDefault(ra,this.signedAttrs)===!1&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&He.compareWithDefault(aa,this.unsignedAttrs)===!1&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}He.CLASS_NAME="SignerInfo";const rc="version",ac="policy",nc="messageImprint",ic="serialNumber",oc="genTime",xn="ordering",Bn="nonce",bo="accuracy",So="tsa",Ao="extensions",ks="TSTInfo",rp="".concat(ks,".").concat(rc),ap="".concat(ks,".").concat(ac),np="".concat(ks,".").concat(nc),ip="".concat(ks,".").concat(ic),op="".concat(ks,".").concat(oc),Oh="".concat(ks,".").concat(bo),Ph="".concat(ks,".").concat(xn),Dh="".concat(ks,".").concat(Bn),Th="".concat(ks,".").concat(So),Rh="".concat(ks,".").concat(Ao),TS=[rp,ap,np,ip,op,Oh,Ph,Dh,Th,Rh];class Ct extends _{constructor(e={}){super(),this.version=d(e,rc,Ct.defaultValues(rc)),this.policy=d(e,ac,Ct.defaultValues(ac)),this.messageImprint=d(e,nc,Ct.defaultValues(nc)),this.serialNumber=d(e,ic,Ct.defaultValues(ic)),this.genTime=d(e,oc,Ct.defaultValues(oc)),bo in e&&(this.accuracy=d(e,bo,Ct.defaultValues(bo))),xn in e&&(this.ordering=d(e,xn,Ct.defaultValues(xn))),Bn in e&&(this.nonce=d(e,Bn,Ct.defaultValues(Bn))),So in e&&(this.tsa=d(e,So,Ct.defaultValues(So))),Ao in e&&(this.extensions=d(e,Ao,Ct.defaultValues(Ao))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rc:return 0;case ac:return E;case nc:return new Nt;case ic:return new H;case oc:return new Date(0,0,0);case bo:return new Qt;case xn:return!1;case Bn:return new H;case So:return new Se;case Ao:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case rc:case ac:case oc:case xn:return t===Ct.defaultValues(xn);case nc:return Nt.compareWithDefault(Tn,t.hashAlgorithm)&&Nt.compareWithDefault(Rn,t.hashedMessage);case ic:case Bn:return t.isEqual(Ct.defaultValues(Bn));case bo:return Qt.compareWithDefault(Nr,t.seconds)&&Qt.compareWithDefault(Er,t.millis)&&Qt.compareWithDefault(kr,t.micros);case So:return Se.compareWithDefault(wu,t.type)&&Se.compareWithDefault(yu,t.value);case Ao:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||ks,value:[new H({name:t.version||rp}),new ae({name:t.policy||ap}),Nt.schema(t.messageImprint||{names:{blockName:np}}),new H({name:t.serialNumber||ip}),new $e({name:t.genTime||op}),Qt.schema(t.accuracy||{names:{blockName:Oh}}),new Ia({name:t.ordering||Ph,optional:!0}),new H({name:t.nonce||Dh,optional:!0}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Se.schema(t.tsa||{names:{blockName:Th}})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new me({name:t.extensions||Rh,value:_e.schema(t.extension||{})})]})]})}fromSchema(e){G(e,TS);const t=z(e,e,Ct.schema());q.assertSchema(t,this.className),this.version=t.result[rp].valueBlock.valueDec,this.policy=t.result[ap].valueBlock.toString(),this.messageImprint=new Nt({schema:t.result[np]}),this.serialNumber=t.result[ip],this.genTime=t.result[op].toDate(),Oh in t.result&&(this.accuracy=new Qt({schema:t.result[Oh]})),Ph in t.result&&(this.ordering=t.result[Ph].valueBlock.value),Dh in t.result&&(this.nonce=t.result[Dh]),Th in t.result&&(this.tsa=new Se({schema:t.result[Th]})),Rh in t.result&&(this.extensions=Array.from(t.result[Rh],s=>new _e({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(new ae({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new $e({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),this.ordering!==void 0&&e.push(new Ia({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),this.ordering!==void 0&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async verify(e,t=fe(!0)){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const s=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),n=await t.digest(a.name,new Uint8Array(s));return Be.isEqual(n,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}Ct.CLASS_NAME="TSTInfo";const No="version",uc="digestAlgorithms",lc="encapContentInfo",Eo="certificates",ko="crls",cc="signerInfos",pu="ocsps",ei="SignedData",up="".concat(ei,".").concat(No),Uh="".concat(ei,".").concat(uc),lp="".concat(ei,".").concat(lc),Lh="".concat(ei,".").concat(Eo),jh="".concat(ei,".").concat(ko),$h="".concat(ei,".").concat(cc),RS=[up,Uh,lp,Lh,jh,$h];class It extends Error{constructor({message:e,code:t=0,date:s=new Date,signatureVerified:a=null,signerCertificate:n=null,signerCertificateVerified:i=null,timestampSerial:o=null,certificatePath:h=[]}){super(e),this.name="SignedDataVerifyError",this.date=s,this.code=t,this.timestampSerial=o,this.signatureVerified=a,this.signerCertificate=n,this.signerCertificateVerified=i,this.certificatePath=h}}class yt extends _{constructor(e={}){super(),this.version=d(e,No,yt.defaultValues(No)),this.digestAlgorithms=d(e,uc,yt.defaultValues(uc)),this.encapContentInfo=d(e,lc,yt.defaultValues(lc)),Eo in e&&(this.certificates=d(e,Eo,yt.defaultValues(Eo))),ko in e&&(this.crls=d(e,ko,yt.defaultValues(ko))),pu in e&&(this.ocsps=d(e,pu,yt.defaultValues(pu))),this.signerInfos=d(e,cc,yt.defaultValues(cc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case No:return 0;case uc:return[];case lc:return new _t;case Eo:return[];case ko:return[];case pu:return[];case cc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case No:return t===yt.defaultValues(No);case lc:return _t.compareWithDefault("eContentType",t.eContentType)&&_t.compareWithDefault("eContent",t.eContent);case uc:case Eo:case ko:case pu:case cc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return t.optional===void 0&&(t.optional=!1),new O({name:t.blockName||ei,optional:t.optional,value:[new H({name:t.version||up}),new nt({value:[new me({name:t.digestAlgorithms||Uh,value:M.schema()})]}),_t.schema(t.encapContentInfo||{names:{blockName:lp}}),new L({name:t.certificates||Lh,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Ts.schema().valueBlock.value}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:ur.schema(t.crls||{names:{crls:jh}}).valueBlock.value}),new nt({value:[new me({name:t.signerInfos||$h,value:He.schema()})]})]})}fromSchema(e){G(e,RS);const t=z(e,e,yt.schema());if(q.assertSchema(t,this.className),this.version=t.result[up].valueBlock.valueDec,Uh in t.result&&(this.digestAlgorithms=Array.from(t.result[Uh],s=>new M({schema:s}))),this.encapContentInfo=new _t({schema:t.result[lp]}),Lh in t.result){const s=new Ts({schema:new nt({value:t.result[Lh].valueBlock.value})});this.certificates=s.certificates.slice(0)}jh in t.result&&(this.crls=Array.from(t.result[jh],s=>s.idBlock.tagClass===1?new rt({schema:s}):(s.idBlock.tagClass=1,s.idBlock.tagNumber=16,new or({schema:s})))),$h in t.result&&(this.signerInfos=Array.from(t.result[$h],s=>new He({schema:s})))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof Na)||this.crls&&this.crls.length&&this.crls.some(s=>s instanceof or)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof ts)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof sr)||this.signerInfos.some(s=>s.version===3)||this.encapContentInfo.eContentType!==yt.ID_DATA?this.version=3:this.version=1,t.push(new H({value:this.version})),t.push(new nt({value:Array.from(this.digestAlgorithms,s=>s.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const s=new Ts({certificates:this.certificates}).toSchema();t.push(new L({idBlock:{tagClass:3,tagNumber:0},value:s.valueBlock.value}))}return this.crls&&t.push(new L({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,s=>{if(s instanceof or){const a=s.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return s.toSchema(e)})})),t.push(new nt({value:Array.from(this.signerInfos,s=>s.toSchema())})),new O({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}async verify({signer:e=-1,data:t=Ye,trustedCerts:s=[],checkDate:a=new Date,checkChain:n=!1,passedWhenNotRevValues:i=!1,extendedMode:o=!1,findOrigin:h=null,findIssuer:u=null}={},l=fe(!0)){let f=null,m=null;try{let v=Ye,w=E,S=[];const y=this.signerInfos[e];if(!y)throw new It({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new It({date:a,code:2,message:"No certificates attached to this signed data"});if(y.sid instanceof Ze){for(const I of this.certificates)if(I instanceof be&&I.issuer.isEqual(y.sid.issuer)&&I.serialNumber.isEqual(y.sid.serialNumber)){f=I;break}}else{const I=y.sid,P=I.idBlock.isConstructed?I.valueBlock.value[0].valueBlock.valueHex:I.valueBlock.valueHex;for(const x of this.certificates){if(!(x instanceof be))continue;const T=await l.digest({name:"sha-1"},x.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(yc(T,P)){f=x;break}}}if(!f)throw new It({date:a,code:3,message:"Unable to find signer certificate"});if(this.encapContentInfo.eContentType===$v){if(!this.encapContentInfo.eContent)throw new It({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0});let I;try{I=Ct.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch(P){throw new It({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0})}if(a=I.genTime,m=I.serialNumber.valueBlock.valueHexView.slice(),t.byteLength===0)throw new It({date:a,code:4,message:"Missed detached data input array"});if(!await I.verify({data:t},l))throw new It({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0})}if(n){const I=this.certificates.filter(B=>B instanceof be&&!!Lw(B,f)),P={checkDate:a,certs:I,trustedCerts:s};u&&(P.findIssuer=u),h&&(P.findOrigin=h);const x=new vm(P);if(x.certs.push(f),this.crls)for(const B of this.crls)"thisUpdate"in B?x.crls.push(B):B.otherRevInfoFormat===ph&&x.ocsps.push(new cs({schema:B.otherRevInfo}));this.ocsps&&x.ocsps.push(...this.ocsps);const T=await x.verify({passedWhenNotRevValues:i},l).catch(B=>{throw new It({date:a,code:5,message:"Validation of signer's certificate failed with error: ".concat(B instanceof Object?B.resultMessage:B),signerCertificate:f,signerCertificateVerified:!1})});if(T.certificatePath&&(S=T.certificatePath),!T.result)throw new It({date:a,code:5,message:"Validation of signer's certificate failed: ".concat(T.resultMessage),signerCertificate:f,signerCertificateVerified:!1})}const k=l.getAlgorithmByOID(y.digestAlgorithm.algorithmId);if(!("name"in k))throw new It({date:a,code:7,message:"Unsupported signature algorithm: ".concat(y.digestAlgorithm.algorithmId),signerCertificate:f,signerCertificateVerified:!0});w=k.name;const p=this.encapContentInfo.eContent;if(p)p.idBlock.tagClass===1&&p.idBlock.tagNumber===4?t=p.getValue():t=p.valueBlock.valueBeforeDecodeView;else if(t.byteLength===0)throw new It({date:a,code:8,message:"Missed detached data input array",signerCertificate:f,signerCertificateVerified:!0});if(y.signedAttrs){let I=!1,P=!1;for(const x of y.signedAttrs.attributes)if(x.type==="1.2.840.113549.1.9.3"&&(I=!0),x.type==="1.2.840.113549.1.9.4"&&(P=!0,v=x.values[0].valueBlock.valueHex),I&&P)break;if(I===!1)throw new It({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:f,signerCertificateVerified:!0});if(P===!1)throw new It({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:f,signerCertificateVerified:!0})}if(y.signedAttrs){const I=await l.digest(w,new Uint8Array(t));if(!yc(I,v))throw new It({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0});t=y.signedAttrs.encodedValue}const b=y.signatureAlgorithm.algorithmId==="1.2.840.113549.1.1.1"?await l.verifyWithPublicKey(t,y.signature,f.subjectPublicKeyInfo,y.signatureAlgorithm,w):await l.verifyWithPublicKey(t,y.signature,f.subjectPublicKeyInfo,y.signatureAlgorithm);return o?{date:a,code:14,message:E,signatureVerified:b,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0,certificatePath:S}:b}catch(v){throw v instanceof It?v:new It({date:a,code:15,message:"Error during verification: ".concat(v instanceof Error?v.message:v),signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0})}}async sign(e,t,s="SHA-1",a=Ye,n=fe(!0)){var i;if(!e)throw new Error("Need to provide a private key for signing");const o=this.signerInfos[t];if(!o)throw new RangeError("SignerInfo index is out of range");!(!((i=o.signedAttrs)===null||i===void 0)&&i.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(s=e.algorithm.hash.name);const h=n.getOIDByAlgorithm({name:s},!0,"hashAlgorithm");this.digestAlgorithms.filter(m=>m.algorithmId===h).length===0&&this.digestAlgorithms.push(new M({algorithmId:h,algorithmParams:new at})),o.digestAlgorithm=new M({algorithmId:h,algorithmParams:new at});const u=await n.getSignatureParameters(e,s),l=u.parameters;if(o.signatureAlgorithm=u.signatureAlgorithm,o.signedAttrs)if(o.signedAttrs.encodedValue.byteLength!==0)a=o.signedAttrs.encodedValue;else{a=o.signedAttrs.toSchema().toBER();const m=Be.toUint8Array(a);m[0]=49}else{const m=this.encapContentInfo.eContent;if(m)m.idBlock.tagClass===1&&m.idBlock.tagNumber===4?a=m.getValue():a=m.valueBlock.valueBeforeDecodeView;else if(a.byteLength===0)throw new Error("Missed detached data input array")}const f=await n.signWithPrivateKey(a,e,l);o.signature=new X({valueHex:f})}}yt.CLASS_NAME="SignedData",yt.ID_DATA=Pp;const On="version",Pn="authSafe",zs="macData",du="parsedValue",US=[On,Pn,zs];class la extends _{constructor(e={}){super(),this.version=d(e,On,la.defaultValues(On)),this.authSafe=d(e,Pn,la.defaultValues(Pn)),zs in e&&(this.macData=d(e,zs,la.defaultValues(zs))),du in e&&(this.parsedValue=d(e,du,la.defaultValues(du))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case On:return 3;case Pn:return new Ie;case zs:return new Ut;case du:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case On:return t===la.defaultValues(e);case Pn:return Ie.compareWithDefault("contentType",t.contentType)&&Ie.compareWithDefault("content",t.content);case zs:return Ut.compareWithDefault("mac",t.mac)&&Ut.compareWithDefault("macSalt",t.macSalt)&&Ut.compareWithDefault("iterations",t.iterations);case du:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||On}),Ie.schema(t.authSafe||{names:{blockName:Pn}}),Ut.schema(t.macData||{names:{blockName:zs,optional:!0}})]})}fromSchema(e){G(e,US);const t=z(e,e,la.schema({names:{version:On,authSafe:{names:{blockName:Pn}},macData:{names:{blockName:zs}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new Ie({schema:t.result.authSafe}),zs in t.result&&(this.macData=new Ut({schema:t.result.macData}))}toSchema(){const e=[new H({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new O({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=fe(!0)){if(Ne.assert(e,"parameters","object"),!this.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(ve.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),ve.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new ve("iterations");ve.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),ve.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),ve.assertEmpty(e.password,"password");const s=new ArrayBuffer(64),a=new Uint8Array(s);t.getRandomValues(a);const n=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new Ie({contentType:Ie.DATA,content:new X({valueHex:n})});const i=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:s,iterationCount:e.iterations,contentToStamp:n});this.macData=new Ut({mac:new ms({digestAlgorithm:new M({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new X({valueHex:i})}),macSalt:new X({valueHex:s}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new ve("signingCertificate");ve.assertEmpty(e.privateKey,"privateKey"),ve.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const s=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new yt({version:1,encapContentInfo:new _t({eContentType:"1.2.840.113549.1.7.1",eContent:new X({valueHex:s})}),certificates:[e.signingCertificate]}),n=await t.digest({name:e.hashAlgorithm},new Uint8Array(s)),i=[];i.push(new Oe({type:"1.2.840.113549.1.9.3",values:[new ae({value:"1.2.840.113549.1.7.1"})]})),i.push(new Oe({type:"1.2.840.113549.1.9.5",values:[new Df({valueDate:new Date})]})),i.push(new Oe({type:"1.2.840.113549.1.9.4",values:[new X({valueHex:n})]})),a.signerInfos.push(new He({version:1,sid:new Ze({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new Ue({type:0,attributes:i})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new Ie({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw new Error('Parameter "integrityMode" has unknown value: '.concat(this.parsedValue.integrityMode))}}async parseInternalValues(e,t=fe(!0)){switch(Ne.assert(e,"parameters","object"),e.checkIntegrity===void 0&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case Ie.DATA:{ve.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,Ne.assert(this.authSafe.content,"authSafe.content",X);const s=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=Xn.fromBER(s),e.checkIntegrity){if(!this.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:Be.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:s,signatureToVerify:Be.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case Ie.SIGNED_DATA:{this.parsedValue.integrityMode=1;const s=new yt({schema:this.authSafe.content}),a=s.encapContentInfo.eContent;ve.assert(a,"eContent","cmsSigned.encapContentInfo"),Ne.assert(a,"eContent",X);const n=a.getValue();if(this.parsedValue.authenticatedSafe=Xn.fromBER(n),!await s.verify({signer:0,checkChain:!1},t))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error('Incorrect value for "this.authSafe.contentType": '.concat(this.authSafe.contentType))}}}la.CLASS_NAME="PFX";const Io="status",na="statusStrings",ia="failInfo",LS=[Io,na,ia];var wg;(function(r){r[r.granted=0]="granted",r[r.grantedWithMods=1]="grantedWithMods",r[r.rejection=2]="rejection",r[r.waiting=3]="waiting",r[r.revocationWarning=4]="revocationWarning",r[r.revocationNotification=5]="revocationNotification"})(wg||(wg={}));class hs extends _{constructor(e={}){super(),this.status=d(e,Io,hs.defaultValues(Io)),na in e&&(this.statusStrings=d(e,na,hs.defaultValues(na))),ia in e&&(this.failInfo=d(e,ia,hs.defaultValues(ia))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Io:return 2;case na:return[];case ia:return new ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Io:return t===hs.defaultValues(e);case na:return t.length===0;case ia:return t.isEqual(hs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.status||E}),new O({optional:!0,value:[new me({name:t.statusStrings||E,value:new _h})]}),new ye({name:t.failInfo||E,optional:!0})]})}fromSchema(e){G(e,LS);const t=z(e,e,hs.schema({names:{status:Io,statusStrings:na,failInfo:ia}}));q.assertSchema(t,this.className);const s=t.result.status;if(s.valueBlock.isHexOnly===!0||s.valueBlock.valueDec<0||s.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=s.valueBlock.valueDec,na in t.result&&(this.statusStrings=t.result.statusStrings),ia in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){const e=[];return e.push(new H({value:this.status})),this.statusStrings&&e.push(new O({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new O({value:e})}toJSON(){const e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,t=>t.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}hs.CLASS_NAME="PKIStatusInfo";const hc="version",mc="messageImprint",Co="reqPolicy",Vo="nonce",Xs="certReq",xo="extensions",ti="TimeStampReq",cp="".concat(ti,".").concat(hc),hp="".concat(ti,".").concat(mc),Kh="".concat(ti,".").concat(Co),Mh="".concat(ti,".").concat(Vo),Hh="".concat(ti,".").concat(Xs),Fh="".concat(ti,".").concat(xo),jS=[cp,hp,Kh,Mh,Hh,Fh];class zt extends _{constructor(e={}){super(),this.version=d(e,hc,zt.defaultValues(hc)),this.messageImprint=d(e,mc,zt.defaultValues(mc)),Co in e&&(this.reqPolicy=d(e,Co,zt.defaultValues(Co))),Vo in e&&(this.nonce=d(e,Vo,zt.defaultValues(Vo))),Xs in e&&(this.certReq=d(e,Xs,zt.defaultValues(Xs))),xo in e&&(this.extensions=d(e,xo,zt.defaultValues(xo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hc:return 0;case mc:return new Nt;case Co:return E;case Vo:return new H;case Xs:return!1;case xo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hc:case Co:case Xs:return t===zt.defaultValues(e);case mc:return Nt.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Nt.compareWithDefault("hashedMessage",t.hashedMessage);case Vo:return t.isEqual(zt.defaultValues(e));case xo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||ti,value:[new H({name:t.version||cp}),Nt.schema(t.messageImprint||{names:{blockName:hp}}),new ae({name:t.reqPolicy||Kh,optional:!0}),new H({name:t.nonce||Mh,optional:!0}),new Ia({name:t.certReq||Hh,optional:!0}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:t.extensions||Fh,value:_e.schema()})]})]})}fromSchema(e){G(e,jS);const t=z(e,e,zt.schema());q.assertSchema(t,this.className),this.version=t.result[cp].valueBlock.valueDec,this.messageImprint=new Nt({schema:t.result[hp]}),Kh in t.result&&(this.reqPolicy=t.result[Kh].valueBlock.toString()),Mh in t.result&&(this.nonce=t.result[Mh]),Hh in t.result&&(this.certReq=t.result[Hh].valueBlock.value),Fh in t.result&&(this.extensions=Array.from(t.result[Fh],s=>new _e({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new ae({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),Xs in this&&zt.compareWithDefault(Xs,this.certReq)===!1&&e.push(new Ia({value:this.certReq})),this.extensions&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,messageImprint:this.messageImprint.toJSON()};return this.reqPolicy!==void 0&&(e.reqPolicy=this.reqPolicy),this.nonce!==void 0&&(e.nonce=this.nonce.toJSON()),this.certReq!==void 0&&zt.compareWithDefault(Xs,this.certReq)===!1&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}}zt.CLASS_NAME="TimeStampReq";const Bo="status",Oo="timeStampToken",Fp="TimeStampResp",mp="".concat(Fp,".").concat(Bo),Jh="".concat(Fp,".").concat(Oo),$S=[mp,Jh];class gc extends _{constructor(e={}){super(),this.status=d(e,Bo,gc.defaultValues(Bo)),Oo in e&&(this.timeStampToken=d(e,Oo,gc.defaultValues(Oo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bo:return new hs;case Oo:return new Ie;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bo:return hs.compareWithDefault(Bo,t.status)&&!("statusStrings"in t)&&!("failInfo"in t);case Oo:return t.contentType===E&&t.content instanceof le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||Fp,value:[hs.schema(t.status||{names:{blockName:mp}}),Ie.schema(t.timeStampToken||{names:{blockName:Jh,optional:!0}})]})}fromSchema(e){G(e,$S);const t=z(e,e,gc.schema());q.assertSchema(t,this.className),this.status=new hs({schema:t.result[mp]}),Jh in t.result&&(this.timeStampToken=new Ie({schema:t.result[Jh]}))}toSchema(){const e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new O({value:e})}toJSON(){const e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,s=fe(!0)){return this.assertContentType(),new yt({schema:this.timeStampToken.content}).sign(e,0,t,void 0,s)}async verify(e={signer:0,trustedCerts:[],data:Ye},t=fe(!0)){return this.assertContentType(),new yt({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==xw)throw new Error("Wrong format of timeStampToken: ".concat(this.timeStampToken.contentType))}}gc.CLASS_NAME="TimeStampResp";function KS(){if(typeof self<"u"){if("crypto"in self){let r="webcrypto";"webkitSubtle"in self.crypto&&(r="safari"),tg(r,new kc({name:r,crypto}))}}else if(typeof crypto<"u"&&"webcrypto"in crypto){const r="NodeJS ^15",e=crypto.webcrypto;tg(r,new kc({name:r,crypto:e}))}}KS();function MS(r){return String.fromCharCode(...r)}function $w(r){return Uint8Array.from(r,e=>e.charCodeAt(0))}function HS(r){return Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")}function Us(r){return $w(atob(r))}function Jp(r){const e=r.replace(/-----BEGIN ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/-----END ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/\n/g,"");return Us(e)}var FS=Object.defineProperty,JS=Object.defineProperties,qS=Object.getOwnPropertyDescriptors,yg=Object.getOwnPropertySymbols,WS=Object.prototype.hasOwnProperty,_S=Object.prototype.propertyIsEnumerable,vg=(r,e,t)=>e in r?FS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fp=(r,e)=>{for(var t in e||(e={}))WS.call(e,t)&&vg(r,t,e[t]);if(yg)for(var t of yg(e))_S.call(e,t)&&vg(r,t,e[t]);return r},bg=(r,e)=>JS(r,qS(e));async function qp(r,e,t={}){return await self.crypto.subtle.decrypt(fp({name:"AES-GCM"},t),e,r)}async function GS(r,e){return await self.crypto.subtle.decrypt({name:"RSA-OAEP"},e,r)}async function Kw(r){return await self.crypto.subtle.importKey("raw",r,{name:"AES-GCM",length:128},!0,["decrypt","encrypt"])}async function zS(r,e){return await self.crypto.subtle.importKey("spki",r,{name:"RSASSA-PKCS1-v1_5",hash:e},!0,["verify"])}async function XS(r){return await self.crypto.subtle.importKey("pkcs8",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])}async function YS(r){return new Uint8Array(await self.crypto.subtle.exportKey("raw",r))}async function QS(r){const e=await self.crypto.subtle.digest("SHA-256",r);return HS(new Uint8Array(e))}async function ZS(r,e){const t=new Ny(r),s=await zS(Jp(e),t.signatureAlgorithm.hash.name);return t.verify({publicKey:s},eA())}function eA(){return bg(fp({},self.crypto),{subtle:bg(fp({},self.crypto.subtle),{async verify(r,e,t,s){return self.crypto.subtle.verify(r,e,new Uint8Array(t),new Uint8Array(s))}})})}async function tA(r,e,t){const s=Ie.fromBER(e),a=new yt({schema:s.content}),n=a.signerInfos[0].sid.issuer.typesAndValues.find(({type:h})=>h==="2.5.4.3").value.valueBlock.value,i=t.find(({userId:h})=>h===n);if(i===void 0)throw new Error("Signer not found in the users array");const o=be.fromBER(Jp(i.certificate));return await a.verify({signer:0,trustedCerts:[o],data:r,checkChain:!0},rA())}class sA extends kc{verify(e,t,s,a){return super.verify(e,t,s,new Uint8Array(a))}}function rA(){return new sA({crypto:self.crypto})}var aA=Object.defineProperty,Sg=Object.getOwnPropertySymbols,nA=Object.prototype.hasOwnProperty,iA=Object.prototype.propertyIsEnumerable,Ag=(r,e,t)=>e in r?aA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,oA=(r,e)=>{for(var t in e||(e={}))nA.call(e,t)&&Ag(r,t,e[t]);if(Sg)for(var t of Sg(e))iA.call(e,t)&&Ag(r,t,e[t]);return r};async function uA(r,e){ht.debug("Decrypting private key",{privateKeyInfo:r,mnemonic:e});const t=await Promise.all([await Cf(e,r.salt,{hash:"SHA-256",iterations:6e5}),await Cf(e,r.salt,{hash:"SHA-1",iterations:1024}),await Cf(e,r.salt,{hash:"SHA-1",iterations:6e5})]);for(const s of t)try{const a=await qp(r.encryptedPrivateKey,s,{iv:r.iv,tagLength:128}),n=atob(MS(new Uint8Array(a)));return XS(Jp(n))}catch(a){}throw new Error("Failed to decrypt private key")}async function Cf(r,e,t){const s=await crypto.subtle.importKey("raw",new TextEncoder().encode(r.replaceAll(" ","")),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey(oA({name:"PBKDF2",salt:e},t),s,{name:"AES-GCM",length:256},!0,["decrypt","encrypt"])}const Ng="apps/end_to_end_encryption/api/v2",Mw={PrivateKey:Ng+"/private-key",ServerKey:Ng+"/server-key"};async function lA(){const r=(await Og.get(Pg(Mw.PrivateKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["private-key"],[e,t,s]=r.split("|");return{encryptedPrivateKey:Us(e),iv:Us(t),salt:Us(s)}}async function cA(){return await(await Og.get(Pg(Mw.ServerKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["public-key"]}const hA={name:"AlertCircleOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var mA=function(){var r=this,e=r._self._c;return e("span",r._b({staticClass:"material-design-icon alert-circle-outline-icon",attrs:{"aria-hidden":r.title?null:"true","aria-label":r.title,role:"img"},on:{click:function(t){return r.$emit("click",t)}}},"span",r.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:r.fillColor,width:r.size,height:r.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z"}},[r.title?e("title",[r._v(r._s(r.title))]):r._e()])])])},fA=[],pA=pm(hA,mA,fA,!1,null,null);const dA=pA.exports,gA={name:"CheckIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var wA=function(){var r=this,e=r._self._c;return e("span",r._b({staticClass:"material-design-icon check-icon",attrs:{"aria-hidden":r.title?null:"true","aria-label":r.title,role:"img"},on:{click:function(t){return r.$emit("click",t)}}},"span",r.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:r.fillColor,width:r.size,height:r.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}},[r.title?e("title",[r._v(r._s(r.title))]):r._e()])])])},yA=[],vA=pm(gA,wA,yA,!1,null,null);const bA=vA.exports,SA={name:"NcInputField",components:{NcButton:ay,AlertCircle:dA,Check:bA},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:{value:{type:[String,Number],default:void 0},modelValue:{type:[String,Number],default:void 0},type:{type:String,default:"text",validator:r=>["text","password","email","tel","url","search","number"].includes(r)},label:{type:String,default:void 0},labelOutside:{type:Boolean,default:!1},placeholder:{type:String,default:void 0},showTrailingButton:{type:Boolean,default:!1},trailingButtonLabel:{type:String,default:""},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1},helperText:{type:String,default:""},disabled:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},inputClass:{type:[Object,String],default:""}},emits:["update:value","update:modelValue","update:model-value","trailing-button-click"],setup(){const r=Tg("value","update:value",!0);return{isLegacy32:sd,model:r}},computed:{computedId(){return this.$attrs.id&&this.$attrs.id!==""?this.$attrs.id:this.inputName},inputName(){return"input"+iy()},hasTrailingIcon(){return this.success},hasPlaceholder(){return this.placeholder!==""&&this.placeholder!==void 0},computedPlaceholder(){if(this.hasPlaceholder)return this.placeholder;if(sd)return this.label},isValidLabel(){const r=this.label||this.labelOutside;return r||ny.warn("You need to add a label to the NcInputField component. Either use the prop label or use an external one, as per the example in the documentation."),r},ariaDescribedby(){const r=[];return this.helperText.length>0&&r.push("".concat(this.inputName,"-helper-text")),this.$attrs["aria-describedby"]&&r.push(this.$attrs["aria-describedby"]),r.join(" ")||null}},methods:{focus(){this.$refs.input.focus()},select(){this.$refs.input.select()},handleInput(r){const e=this.type==="number"&&typeof this.model=="number"?parseFloat(r.target.value,10):r.target.value;this.model=e},handleTrailingButtonClick(r){this.$emit("trailing-button-click",r)}}};var AA=function(){var r,e=this,t=e._self._c;return t("div",{staticClass:"input-field",class:{"input-field--disabled":e.disabled,"input-field--error":e.error,"input-field--label-outside":e.labelOutside||!e.isValidLabel,"input-field--leading-icon":!!e.$scopedSlots.icon||!!e.$scopedSlots.default||!!e.$slots.default,"input-field--success":e.success,"input-field--trailing-icon":e.showTrailingButton||e.hasTrailingIcon,"input-field--pill":e.pill,"input-field--legacy":e.isLegacy32}},[t("div",{staticClass:"input-field__main-wrapper"},[t("input",e._g(e._b({ref:"input",staticClass:"input-field__input",class:[e.inputClass,{"input-field__input--success":e.success,"input-field__input--error":e.error}],attrs:{id:e.computedId,type:e.type,disabled:e.disabled,placeholder:e.computedPlaceholder,"aria-describedby":e.ariaDescribedby,"aria-live":"polite"},domProps:{value:(r=e.model)==null?void 0:r.toString()},on:{input:e.handleInput}},"input",e.$attrs,!1),e.$listeners)),!e.labelOutside&&e.isValidLabel?t("label",{staticClass:"input-field__label",attrs:{for:e.computedId}},[e._v(" "+e._s(e.label)+" ")]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.$scopedSlots.icon||!!e.$scopedSlots.default||!!e.$slots.default,expression:"!!$scopedSlots.icon || !!$scopedSlots.default || !!$slots.default"}],staticClass:"input-field__icon input-field__icon--leading"},[e._t("icon",function(){return[e._t("default")]})],2),e.showTrailingButton?t("NcButton",{staticClass:"input-field__trailing-button",attrs:{"aria-label":e.trailingButtonLabel,disabled:e.disabled,variant:"tertiary-no-background"},on:{click:e.handleTrailingButtonClick},scopedSlots:e._u([{key:"icon",fn:function(){return[e._t("trailing-button-icon")]},proxy:!0}],null,!0)}):e.success||e.error?t("div",{staticClass:"input-field__icon input-field__icon--trailing"},[e.success?t("Check",{staticStyle:{color:"var(--color-success-text)"},attrs:{size:20}}):e.error?t("AlertCircle",{staticStyle:{color:"var(--color-error-text)"},attrs:{size:20}}):e._e()],1):e._e()],1),e.helperText.length>0?t("p",{staticClass:"input-field__helper-text-message",class:{"input-field__helper-text-message--error":e.error,"input-field__helper-text-message--success":e.success},attrs:{id:"".concat(e.inputName,"-helper-text")}},[e.success?t("Check",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):e.error?t("AlertCircle",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):e._e(),e._v(" "+e._s(e.helperText)+" ")],1):e._e()])},NA=[],EA=pm(SA,AA,NA,!1,null,"770f8cf7");const pp=EA.exports;var kA=Object.defineProperty,IA=Object.defineProperties,CA=Object.getOwnPropertyDescriptors,Eg=Object.getOwnPropertySymbols,VA=Object.prototype.hasOwnProperty,xA=Object.prototype.propertyIsEnumerable,kg=(r,e,t)=>e in r?kA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Vf=(r,e)=>{for(var t in e||(e={}))VA.call(e,t)&&kg(r,t,e[t]);if(Eg)for(var t of Eg(e))xA.call(e,t)&&kg(r,t,e[t]);return r},Ig=(r,e)=>IA(r,CA(e));oy(ly,uy);const BA=new Set(Object.keys(pp.props)),OA={name:"NcTextField",components:{NcIconSvgWrapper:cy,NcInputField:pp},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:Ig(Vf({" ":{}},pp.props),{trailingButtonLabel:{type:String,default:""},trailingButtonIcon:{type:String,default:"close",validator:r=>["close","arrowEnd","arrowRight","undo"].includes(r)}}),emits:["update:value","update:modelValue","update:model-value"],setup(){return{model:Tg("value","update:value"),mdiArrowRight:fy,mdiClose:my,mdiUndo:hy}},computed:{isArrow(){return this.trailingButtonIcon==="arrowEnd"||this.trailingButtonIcon==="arrowRight"},propsAndAttrsToForward(){const r={arrowEnd:Dc("Save changes"),arrowRight:Dc("Save changes"),close:Dc("Clear text"),undo:Dc("Undo changes")};return Ig(Vf(Vf({},this.$attrs),Object.fromEntries(Object.entries(this.$props).filter(([e])=>BA.has(e)))),{trailingButtonLabel:this.trailingButtonLabel||r[this.trailingButtonIcon]})}},methods:{focus(){this.$refs.inputField.focus()},select(){this.$refs.inputField.select()}}};var PA=function(){var r=this,e=r._self._c;return e("NcInputField",r._g(r._b({ref:"inputField",scopedSlots:r._u([r.$scopedSlots.icon||r.$slots.default||r.$scopedSlots.default?{key:"icon",fn:function(){return[r._t("icon",function(){return[r._t("default")]})]},proxy:!0}:null,r.type!=="search"?{key:"trailing-button-icon",fn:function(){return[r.isArrow?e("NcIconSvgWrapper",{attrs:{directional:"",path:r.mdiArrowRight}}):e("NcIconSvgWrapper",{attrs:{path:r.trailingButtonIcon==="undo"?r.mdiUndo:r.mdiClose}})]},proxy:!0}:null],null,!0)},"NcInputField",r.propsAndAttrsToForward,!1),r.$listeners))},DA=[],TA=pm(OA,PA,DA,!1,null,null);const RA=TA.exports,UA=py({__name:"MnemonicPromptDialog",emits:["close"],setup(r,{emit:e}){const t=Cm(),s=Cm(""),a=Cm(!1),n=rd(()=>a.value===!0&&s.value.trim().split(/\s+/g).length===12);function i(){e("close",s.value)}const o=rd(()=>[{label:Of("end_to_en_encryption","Submit"),nativeType:"submit",type:"primary",disabled:!n.value,callback:i}]);return{__sfc:!0,emit:e,dialogRef:t,mnemonic:s,confirmToggle:a,isFormValid:n,submit:i,buttons:o,t:Of,NcDialog:Iy,NcTextField:RA,NcNoteCard:ky,NcCheckboxRadioSwitch:Ey}}});var LA=function(){var r=this,e=r._self._c,t=r._self._setupProxy;return e(t.NcDialog,{ref:"dialogRef",attrs:{name:t.t("end_to_end_encryption","Enter your 12 words mnemonic"),buttons:t.buttons,"is-form":!0},on:{submit:t.submit}},[e(t.NcNoteCard,{attrs:{type:"warning","show-alert":!0,heading:t.t("end_to_end_encryption","Decrypting your files in the browser can weaken security")}},[r._v(" "+r._s(t.t("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" "),e(t.NcCheckboxRadioSwitch,{attrs:{required:!0,"data-cy-e2ee-mnemonic-prompt":"i_understand_the_risks",type:"switch"},model:{value:t.confirmToggle,callback:function(s){t.confirmToggle=s},expression:"confirmToggle"}},[r._v(" "+r._s(t.t("end_to_end_encryption","I understand the risks"))+" ")])],1),e(t.NcTextField,{attrs:{value:t.mnemonic,required:"true",pattern:"^(\\w+\\s+){11}\\w+$",label:t.t("end_to_end_encryption","Mnemonic"),autofocus:!0},on:{"update:value":function(s){t.mnemonic=s}}})],1)},jA=[],$A=dy(UA,LA,jA,!1,null,null);const KA=$A.exports;async function MA(){const r=Promise.withResolvers();return Cy(KA,void 0,e=>{e!==void 0?r.resolve(e):r.reject()}),r.promise}async function HA(r,e){ht.debug("Decrypting metadata info",{metadata:r});const[t,s]=r.metadata.ciphertext.split("|"),a=await qp(Us(t),e,{iv:Us(s)}),n=JSON.parse(await qA(a));return FA(n,r),await JA(n,e),n}function FA(r,e){var t,s;if(((t=r.keyChecksums)==null?void 0:t.length)!==((s=e.users)==null?void 0:s.length))throw new Error("Key checksums length does not match users length")}async function JA(r,e){if(r.keyChecksums===void 0)return;const t=await YS(e),s=await QS(t);if(!r.keyChecksums.includes(s))throw new Error("Key checksum is not in keyChecksums")}async function qA(r){const e=new ReadableStream({start(t){t.enqueue(new Uint8Array(r)),t.close()}}).pipeThrough(new DecompressionStream("gzip"));return await new Response(e).text()}async function WA(r,e,t){var s;ht.debug("Getting metadata private key",{metadata:r,userId:e});const a=(s=r.users)==null?void 0:s.find(o=>o.userId===e);if(!a)throw new Error("User not found in metadata");const n=Us(a.encryptedMetadataKey),i=await GS(n,t);return await Kw(new Uint8Array(i))}async function Cg(r,e,t){const s=JSON.stringify(r,(n,i)=>{if(n!=="filedrop")return i}),a=await tA($w(btoa(s)),Us(e),t.users);if(!a)throw new Error("Metadata signature verification failed");return a}async function _A(r,e){const t=r.users.map(async({userId:s,certificate:a})=>{const n=await ZS(a,e);if(!n)throw new Error("Certificate verification failed for user ".concat(s));return n});return await Promise.all(t)}const GA=i1(),xt={_userPrivateKey:void 0,_serverPublicKey:void 0,_metadataCache:{},async getUserPrivateKey(){var r;return(r=this._userPrivateKey)!=null||(this._userPrivateKey=await uA(await lA(),await MA())),this._userPrivateKey},async getServerPublicKeyPEM(){var r;return(r=this._serverPublicKey)!=null||(this._serverPublicKey=await cA()),this._serverPublicKey},async getMetadata(r){if(this._metadataCache[r])return ht.debug("Found metadata in cache",{path:r,state:xt}),this._metadataCache[r];if(ht.debug("Fetching PROPFIND for metadata",{path:r,state:xt}),await GA.stat(decodeURI(r).replace("remote.php/dav/",""),{details:!0,data:s1()}),this._metadataCache[r])return ht.debug("Found metadata in cache after PROPFIND",{path:r,state:xt}),this._metadataCache[r];throw new Error("Could not find metadata for ".concat(r))},async setMetadata(r,e,t){const s=JSON.parse(e);fh(s)?(await Cg(s,t,s),await _A(s,await this.getServerPublicKeyPEM())):await Cg(s,t,await this.getRootMetadata(Fo.dirname(r))),this._metadataCache[r]=s,ht.debug("Added metadata in cache",{path:r,state:xt})},async getMetadataInfo(r){const e=await this.getMetadata(r),t=await this.getRootMetadata(r),s=gp();if(s===null)throw new Error("No user logged in");return HA(e,await WA(t,s.uid,await xt.getUserPrivateKey()))},async getRootMetadata(r){const e=Object.entries(xt._metadataCache).filter(([t])=>r.startsWith(t)).map(([,t])=>t).find(t=>fh(t));if(e)return ht.debug("Found root metadata in cache",{path:r,state:xt}),e;for(ht.debug("Looking for root metadata",{path:r,state:xt});r!=="/";){const t=await xt.getMetadata(r);if(fh(t))return ht.debug("Fetched root metadata",{path:r,state:xt}),t;r=Fo.dirname(r)}throw new Error("Found no root metadata for ".concat(r))}};var zA=Object.defineProperty,XA=Object.defineProperties,YA=Object.getOwnPropertyDescriptors,Vg=Object.getOwnPropertySymbols,QA=Object.prototype.hasOwnProperty,ZA=Object.prototype.propertyIsEnumerable,xg=(r,e,t)=>e in r?zA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,eN=(r,e)=>{for(var t in e||(e={}))QA.call(e,t)&&xg(r,t,e[t]);if(Vg)for(var t of Vg(e))ZA.call(e,t)&&xg(r,t,e[t]);return r},tN=(r,e)=>XA(r,YA(e));let fm;function sN(){fm=window.fetch,ht.debug("Setting up WebDAV decryption proxy"),window.fetch=async(r,e={})=>{let t=new Request(r,e);if(!(t.url.includes("/remote.php/dav/files/")&&(t.method==="GET"||t.method==="PROPFIND")))return fm(t);ht.debug("Proxying ".concat(t.method," ").concat(t.url),{request:t});const s=new Headers(t.headers);switch(s.set("X-E2EE-SUPPORTED","true"),t=new Request(t,{headers:s}),t.method){case"PROPFIND":return aN(t);case"GET":default:return rN(t)}}}async function rN(r){const e=new URL(r.url).pathname,t=fm(r);try{const s=await xt.getMetadataInfo(Fo.dirname(e)),a=s.files[Fo.basename(r.url)];if(a===void 0)throw ht.debug("Could not find file in metadata",{path:e,metadataInfo:s}),new Error("Could not find file in metadata");return await nN(await t,a)}catch(s){return await t}}async function aN(r){var e;ht.debug("Fetching raw PROPFIND",{request:r});const t=await fm(r),s=new URL(r.url).pathname,a=await t.text(),n=await Z0(a),i=Q0(n,s,!0);if(((e=i.props)==null?void 0:e["e2ee-is-encrypted"])!==1)return ht.debug("Node is not e2ee",{xml:n}),new Response(a,t);if(i.type==="directory"){const o=i.props["e2ee-metadata"],h=i.props["e2ee-metadata-signature"];o!==void 0&&h!==void 0&&await xt.setMetadata(s,o,h);const u=await xt.getMetadata(s),l=await xt.getMetadataInfo(s);if(fh(u))xf(n,s,l);else{const f=await xt.getMetadataInfo(Fo.dirname(s));xf(n,s,l,f)}}else if(i.type==="file"){const o=await xt.getMetadataInfo(Fo.dirname(s));if(o===void 0)return ht.debug("Cannot find metadata for parent folder",{path:s}),new Response(a,t);xf(n,s,void 0,o)}return new Response(new pa().build(n),t)}function xf(r,e,t,s){ht.debug("Updating PROPFIND info",{path:e,decryptedMetadata:t,decryptedParentMetadata:s,xml:r}),r.multistatus.response.forEach(a=>{if(a.propstat===void 0)return;const n=a.href===e?s:t,i=a.propstat.prop.displayname;let o=i;n!==void 0&&(n.files[i]?(o=n.files[i].filename,a.propstat.prop.getcontenttype=n.files[i].mimetype):n.folders[i]&&(o=n.folders[i],a.propstat.prop.getcontenttype="httpd/unix-directory")),a.propstat.prop.displayname=o,a.propstat.prop.permissions=a.propstat.prop.permissions.replace(/(R)|(D)|(N)|(V)|(W)|(CK)/g,"")})}async function nN(r,e){ht.debug("Decrypting encrypted file",{response:r,fileEncryptionInfo:e});const t=await qp(new Uint8Array(await r.arrayBuffer()),await Kw(Us(e.key)),{iv:Us(e.nonce)}),s=new Headers(r.headers);return s.set("Content-Type",e.mimetype),new Response(t,tN(eN({},r),{headers:s}))}const iN='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-arrow-down" viewBox="0 0 24 24"><path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" /></svg>';function oN(r){if((r.permissions&nw.READ)===0)return!1;if(r.attributes["share-attributes"]){const e=JSON.parse(r.attributes["share-attributes"]||"[]").find(({scope:t,key:s})=>t==="permissions"&&s==="download");if(e!==void 0)return e.value===!0}return!0}async function uN([r]){const e=await(await fetch(r.encodedSource)).arrayBuffer(),t=new Blob([e],{type:r.mime}),s=document.createElement("a");s.href=window.URL.createObjectURL(t),s.download=r.displayname,s.click()}const lN=new m1({id:"download_unencrypted",default:Ip.DEFAULT,displayName:()=>Of("files","Download unencrypted"),iconSvgInline:()=>iN,enabled(r){return r.length!==1||r.some(e=>e.attributes["e2ee-is-encrypted"]!==1)||r.some(e=>!e.isDavRessource)||r.some(e=>e.type!==aw.File)?!1:r.every(oN)},async exec(r){return uN([r]),null},order:30}),cN=dp("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1});cN.e2eeInBrowserEnabled&&(sN(),Lm("nc:e2ee-is-encrypted",{nc:"http://nextcloud.org/ns"}),Lm("nc:e2ee-metadata",{nc:"http://nextcloud.org/ns"}),Lm("nc:e2ee-metadata-signature",{nc:"http://nextcloud.org/ns"}),f1(lN),Bg("download"),Bg("move-copy"));function Bg(r){ht.debug("Inhibiting ".concat(r," actions for e2ee files"));const e=p1().find(s=>s.id===r),t=e._action.enabled;e._action.enabled=(s,a)=>s.some(n=>n.attributes["e2ee-is-encrypted"]===1)?!1:t(s,a)}
//# sourceMappingURL=end_to_end_encryption-files.mjs.map
