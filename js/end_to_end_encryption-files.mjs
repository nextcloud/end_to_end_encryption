(function(){"use strict";try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode("/*!\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */.toastify.dialogs{min-width:200px;background:none;background-color:var(--color-main-background);color:var(--color-main-text);box-shadow:0 0 6px 0 var(--color-box-shadow);padding:0 12px;margin-top:45px;position:fixed;z-index:10100;border-radius:var(--border-radius);display:flex;align-items:center;min-height:50px}.toastify.dialogs .toast-loader-container,.toastify.dialogs .toast-undo-container{display:flex;align-items:center;width:100%}.toastify.dialogs .toast-undo-button,.toastify.dialogs .toast-close{position:static;overflow:hidden;box-sizing:border-box;min-width:44px;height:100%;padding:12px;white-space:nowrap;background-repeat:no-repeat;background-position:center;background-color:transparent;min-height:0}.toastify.dialogs .toast-undo-button.toast-close,.toastify.dialogs .toast-close.toast-close{text-indent:0;opacity:.4;border:none;min-height:44px;margin-left:10px;font-size:0}.toastify.dialogs .toast-undo-button.toast-close:before,.toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\");content:\" \";filter:var(--background-invert-if-dark);display:inline-block;width:16px;height:16px}.toastify.dialogs .toast-undo-button.toast-undo-button,.toastify.dialogs .toast-close.toast-undo-button{height:calc(100% - 6px);margin:3px 3px 3px 12px}.toastify.dialogs .toast-undo-button:hover,.toastify.dialogs .toast-undo-button:focus,.toastify.dialogs .toast-undo-button:active,.toastify.dialogs .toast-close:hover,.toastify.dialogs .toast-close:focus,.toastify.dialogs .toast-close:active{cursor:pointer;opacity:1}.toastify.dialogs.toastify-top{right:10px}.toastify.dialogs.toast-with-click{cursor:pointer}.toastify.dialogs.toast-error{border-left:3px solid var(--color-element-error, var(--color-error))}.toastify.dialogs.toast-info{border-left:3px solid var(--color-element-info, var(--color-primary))}.toastify.dialogs.toast-warning{border-left:3px solid var(--color-element-warning, var(--color-warning))}.toastify.dialogs.toast-success,.toastify.dialogs.toast-undo{border-left:3px solid var(--color-element-success, var(--color-success))}.toastify.dialogs.toast-loading{border-left:3px solid var(--color-element-info, var(--color-primary))}.toastify.dialogs.toast-loading .toast-loader{display:inline-block;width:20px;height:20px;animation:rotate var(--animation-duration, .8s) linear infinite;margin-left:auto}.theme--dark .toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill:%23fff;fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\")}.nc-generic-dialog .dialog__actions{justify-content:space-between;min-width:calc(100% - 12px)}/*!\n * SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */._file-picker__file-icon_3v9zx_9{position:relative;width:32px;height:32px;min-width:32px;min-height:32px;background-repeat:no-repeat;background-size:contain;display:flex;justify-content:center}._file-picker__file-icon--primary_3v9zx_21{color:var(--color-primary-element)}._file-picker__file-icon-overlay_3v9zx_25{color:var(--color-primary-element-text);position:absolute;inset-block-start:10px}tr.file-picker__row[data-v-15187afc]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-15187afc]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-15187afc]{padding:0 2px}tr.file-picker__row td[data-v-15187afc]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-15187afc]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-15187afc]{padding-inline:2px 0}@keyframes gradient-15187afc{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}.loading-row .row-checkbox[data-v-15187afc]{text-align:center!important}.loading-row span[data-v-15187afc]{display:inline-block;height:24px;background:linear-gradient(to right,var(--color-background-darker),var(--color-text-maxcontrast),var(--color-background-darker));background-size:600px 100%;border-radius:var(--border-radius);animation:gradient-15187afc 12s ease infinite}.loading-row .row-wrapper[data-v-15187afc]{display:inline-flex;align-items:center}.loading-row .row-checkbox span[data-v-15187afc]{width:24px}.loading-row .row-name span[data-v-15187afc]:last-of-type{margin-inline-start:6px;width:130px}.loading-row .row-size span[data-v-15187afc]{width:80px}.loading-row .row-modified span[data-v-15187afc]{width:90px}/*!\n* SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n* SPDX-License-Identifier: AGPL-3.0-or-later\n*/tr.file-picker__row[data-v-82f380c9]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-82f380c9]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-82f380c9]{padding:0 2px}tr.file-picker__row td[data-v-82f380c9]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-82f380c9]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-82f380c9]{padding-inline:2px 0}.file-picker__row *[data-v-82f380c9]{cursor:pointer}.file-picker__row--selected[data-v-82f380c9]{background-color:var(--color-background-dark)}.file-picker__row--not-navigatable[data-v-82f380c9]{filter:saturate(.7);opacity:.7}.file-picker__row--not-navigatable *[data-v-82f380c9],.file-picker__row--not-pickable *[data-v-82f380c9]{cursor:default!important}.file-picker__row[data-v-82f380c9]:hover{background-color:var(--color-background-hover)}.file-picker__name-container[data-v-82f380c9]{display:flex;justify-content:start;align-items:center;height:100%}.file-picker__file-name[data-v-82f380c9]{padding-inline-start:6px;min-width:0;overflow:hidden;text-overflow:ellipsis}.file-picker__file-extension[data-v-82f380c9]{color:var(--color-text-maxcontrast);min-width:fit-content}.file-picker__header-preview[data-v-6503afab]{width:22px;height:32px;flex:0 0 auto}.file-picker__files[data-v-6503afab]{margin:2px;margin-inline-start:12px;overflow:scroll auto}.file-picker__files table[data-v-6503afab]{width:100%;max-height:100%;table-layout:fixed}.file-picker__files th[data-v-6503afab]{position:-webkit-sticky;position:sticky;z-index:1;top:0;background-color:var(--color-main-background);padding:2px}.file-picker__files th .header-wrapper[data-v-6503afab]{display:flex}.file-picker__files th.row-checkbox[data-v-6503afab]{width:44px}.file-picker__files th.row-name[data-v-6503afab]{width:230px}.file-picker__files th.row-size[data-v-6503afab]{width:100px}.file-picker__files th.row-modified[data-v-6503afab]{width:120px}.file-picker__files th[data-v-6503afab]:not(.row-size) .button-vue__wrapper{justify-content:start;flex-direction:row-reverse}.file-picker__files th[data-v-6503afab]:not(.row-size) .button-vue{padding-inline:16px 4px}.file-picker__files th.row-size[data-v-6503afab] .button-vue__wrapper{justify-content:end}.file-picker__files th[data-v-6503afab] .button-vue__wrapper{color:var(--color-text-maxcontrast)}.file-picker__files th[data-v-6503afab] .button-vue__wrapper .button-vue__text{font-weight:400}.file-picker__breadcrumbs[data-v-1a8cb0b2]{flex-grow:0!important}.file-picker__side[data-v-f5975252]{display:flex;flex-direction:column;align-items:stretch;gap:.5rem;min-width:200px;padding:2px;margin-block-start:7px;overflow:auto}.file-picker__side[data-v-f5975252] .button-vue__wrapper{justify-content:start}.file-picker__filter-input[data-v-f5975252]{margin-block:7px;max-width:260px}@media (max-width: 736px){.file-picker__side[data-v-f5975252]{flex-direction:row;min-width:unset}}@media (max-width: 512px){.file-picker__side[data-v-f5975252]{flex-direction:row;min-width:unset}.file-picker__filter-input[data-v-f5975252]{max-width:unset}}.file-picker__navigation{padding-inline:8px 2px}.file-picker__navigation,.file-picker__navigation *{box-sizing:border-box}.file-picker__navigation .v-select.select{min-width:220px}@media (min-width: 513px) and (max-width: 736px){.file-picker__navigation{gap:11px}}@media (max-width: 512px){.file-picker__navigation{flex-direction:column-reverse!important}}.file-picker__view[data-v-dda9b42b]{height:50px;display:flex;justify-content:start;align-items:center}.file-picker__view h3[data-v-dda9b42b]{font-weight:700;height:fit-content;margin:0}.file-picker__main[data-v-dda9b42b]{box-sizing:border-box;width:100%;display:flex;flex-direction:column;min-height:0;flex:1;padding-inline:2px}.file-picker__main *[data-v-dda9b42b]{box-sizing:border-box}[data-v-dda9b42b] .file-picker{height:min(80vh,800px)!important}@media (max-width: 512px){[data-v-dda9b42b] .file-picker{height:calc(100% - 16px - var(--default-clickable-area))!important}}[data-v-dda9b42b] .file-picker__content{display:flex;flex-direction:column;overflow:hidden}.public-auth-prompt__text[data-v-a2f36bdb]{font-size:1.25em;margin-block:0 calc(3 * var(--default-grid-baseline))}.public-auth-prompt__header[data-v-a2f36bdb]{margin-block:0 calc(3 * var(--default-grid-baseline))}.public-auth-prompt__header[data-v-a2f36bdb]:first-child{margin-top:0}.public-auth-prompt__input[data-v-a2f36bdb]{margin-block:calc(4 * var(--default-grid-baseline)) calc(2 * var(--default-grid-baseline))}.material-design-icon[data-v-ab8d7671]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}/*!\n * SPDX-FileCopyrightText: 2025 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */.input-field[data-v-ab8d7671]{--input-border-color: var(--color-border-maxcontrast);--input-border-radius: var(--border-radius-element);--input-padding-start: var(--border-radius-large);--input-padding-end: var(--border-radius-large);position:relative;width:100%;margin-block-start:6px}.input-field--disabled[data-v-ab8d7671]{opacity:.4;filter:saturate(.4)}.input-field--label-outside[data-v-ab8d7671]{margin-block-start:0}.input-field--leading-icon[data-v-ab8d7671]{--input-padding-start: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--trailing-icon[data-v-ab8d7671]{--input-padding-end: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--pill[data-v-ab8d7671]{--input-border-radius: var(--border-radius-pill)}.input-field__main-wrapper[data-v-ab8d7671]{height:var(--default-clickable-area);padding:var(--border-width-input-focused, 2px);position:relative}.input-field__input[data-v-ab8d7671]{--input-border-box-shadow-light: 0 -1px var(--input-border-color), 0 0 0 1px color-mix(in srgb, var(--input-border-color), 65% transparent);--input-border-box-shadow-dark: 0 1px var(--input-border-color), 0 0 0 1px color-mix(in srgb, var(--input-border-color), 65% transparent);--input-border-box-shadow: var(--input-border-box-shadow-light);border:none;border-radius:var(--border-radius-element);box-shadow:var(--input-border-box-shadow)}.input-field__input[data-v-ab8d7671]:hover:not([disabled]){box-shadow:0 0 0 1px var(--input-border-color)}@media (prefers-color-scheme: dark){.input-field__input[data-v-ab8d7671]{--input-border-box-shadow: var(--input-border-box-shadow-dark)}}[data-theme-dark] .input-field__input[data-v-ab8d7671]{--input-border-box-shadow: var(--input-border-box-shadow-dark)}[data-theme-light] .input-field__input[data-v-ab8d7671]{--input-border-box-shadow: var(--input-border-box-shadow-light)}.input-field--legacy .input-field__input[data-v-ab8d7671]{box-shadow:0 0 0 1px var(--input-border-color)}.input-field--legacy .input-field__input[data-v-ab8d7671]:hover:not([disabled]){box-shadow:0 0 0 2px var(--input-border-color)}.input-field__input[data-v-ab8d7671]:focus-within:not([disabled]),.input-field__input[data-v-ab8d7671]:active:not([disabled]){box-shadow:0 0 0 2px var(--input-border-color),0 0 0 4px var(--color-main-background)!important}.input-field__input[data-v-ab8d7671]{background-color:var(--color-main-background);color:var(--color-main-text);border-radius:var(--input-border-radius);cursor:pointer;-webkit-appearance:textfield!important;-moz-appearance:textfield!important;appearance:textfield!important;font-size:var(--default-font-size);text-overflow:ellipsis;padding-block:0;padding-inline:var(--input-padding-start) var(--input-padding-end);height:100%!important;min-height:unset;width:100%}.input-field__input[data-v-ab8d7671]::placeholder{color:var(--color-text-maxcontrast)}.input-field__input[data-v-ab8d7671]::-webkit-search-cancel-button{display:none}.input-field__input[data-v-ab8d7671]::-webkit-search-decoration,.input-field__input[data-v-ab8d7671]::-webkit-search-results-button,.input-field__input[data-v-ab8d7671]::-webkit-search-results-decoration,.input-field__input[data-v-ab8d7671]::-ms-clear{display:none}.input-field__input[data-v-ab8d7671]:active:not([disabled]),.input-field__input[data-v-ab8d7671]:focus:not([disabled]){--input-border-color: var(--color-main-text)}.input-field__input:focus+.input-field__label[data-v-ab8d7671],.input-field__input:hover:not(:placeholder-shown)+.input-field__label[data-v-ab8d7671]{color:var(--color-main-text)}.input-field__input[data-v-ab8d7671]:focus{cursor:text}.input-field__input[data-v-ab8d7671]:disabled{cursor:default}.input-field__input[data-v-ab8d7671]:focus-visible{box-shadow:unset!important}.input-field__input--success[data-v-ab8d7671]{border-color:var(--color-border-success, var(--color-success))!important}.input-field__input--success[data-v-ab8d7671]:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field__input--error[data-v-ab8d7671],.input-field__input[data-v-ab8d7671]:user-invalid{border-color:var(--color-border-error, var(--color-error))!important}.input-field__input--error[data-v-ab8d7671]:focus-visible,.input-field__input[data-v-ab8d7671]:user-invalid:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field:not(.input-field--label-outside) .input-field__input[data-v-ab8d7671]:not(:focus)::placeholder{opacity:0}.input-field__label[data-v-ab8d7671]{--input-label-font-size: var(--default-font-size);position:absolute;margin-inline:var(--input-padding-start) var(--input-padding-end);max-width:fit-content;font-size:var(--input-label-font-size);inset-block-start:calc((var(--default-clickable-area) - 1lh) / 2);inset-inline:var(--border-width-input-focused, 2px);color:var(--color-text-maxcontrast);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;pointer-events:none;transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick),background-color var(--animation-quick) var(--animation-slow)}.input-field__input:focus+.input-field__label[data-v-ab8d7671],.input-field__input:not(:placeholder-shown)+.input-field__label[data-v-ab8d7671]{--input-label-font-size: 13px;line-height:1.5;inset-block-start:calc(-1.5 * var(--input-label-font-size) / 2);font-weight:500;border-radius:var(--default-grid-baseline) var(--default-grid-baseline) 0 0;background-color:var(--color-main-background);padding-inline:var(--default-grid-baseline);margin-inline:calc(var(--input-padding-start) - var(--default-grid-baseline)) calc(var(--input-padding-end) - var(--default-grid-baseline));transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick)}.input-field__icon[data-v-ab8d7671]{position:absolute;height:var(--default-clickable-area);width:var(--default-clickable-area);display:flex;align-items:center;justify-content:center;opacity:.7;inset-block-end:0}.input-field__icon--leading[data-v-ab8d7671]{inset-inline-start:0px}.input-field__icon--trailing[data-v-ab8d7671]{inset-inline-end:0px}.input-field__trailing-button[data-v-ab8d7671]{--button-size: calc(var(--default-clickable-area) - 2 * var(--border-width-input-focused, 2px)) !important;--button-radius: calc(var(--input-border-radius) - var(--border-width-input-focused, 2px))}.input-field__trailing-button.button-vue[data-v-ab8d7671]{position:absolute;top:var(--border-width-input-focused, 2px);inset-inline-end:var(--border-width-input-focused, 2px)}.input-field__trailing-button.button-vue[data-v-ab8d7671]:focus-visible{box-shadow:none!important}.input-field__helper-text-message[data-v-ab8d7671]{padding-block:4px;padding-inline:var(--border-radius-large);display:flex;align-items:center;color:var(--color-text-maxcontrast)}.input-field__helper-text-message__icon[data-v-ab8d7671]{margin-inline-end:8px}.input-field__helper-text-message--error[data-v-ab8d7671]{color:var(--color-text-error, var(--color-error))}.input-field--error .input-field__input[data-v-ab8d7671],.input-field__input[data-v-ab8d7671]:user-invalid{--input-border-color: var(--color-border-error, var(--color-error)) !important}.input-field--error .input-field__input[data-v-ab8d7671]:focus-visible,.input-field__input[data-v-ab8d7671]:user-invalid:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field--success .input-field__input[data-v-ab8d7671]{--input-border-color: var(--color-border-success, var(--color-success)) !important}.input-field--success .input-field__input[data-v-ab8d7671]:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}")),document.head.appendChild(i)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();
var qw=Object.defineProperty,Ww=Object.defineProperties;var _w=Object.getOwnPropertyDescriptors;var Qp=Object.getOwnPropertySymbols;var Gw=Object.prototype.hasOwnProperty,zw=Object.prototype.propertyIsEnumerable;var Zp=r=>{throw TypeError(r)};var Em=(r,e,t)=>e in r?qw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,kt=(r,e)=>{for(var t in e||(e={}))Gw.call(e,t)&&Em(r,t,e[t]);if(Qp)for(var t of Qp(e))zw.call(e,t)&&Em(r,t,e[t]);return r},Cs=(r,e)=>Ww(r,_w(e));var tt=(r,e,t)=>Em(r,typeof e!="symbol"?e+"":e,t),km=(r,e,t)=>e.has(r)||Zp("Cannot "+t);var Z=(r,e,t)=>(km(r,e,"read from private field"),t?t.call(r):e.get(r)),qt=(r,e,t)=>e.has(r)?Zp("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),qe=(r,e,t,s)=>(km(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),pr=(r,e,t)=>(km(r,e,"access private method"),t);import{p as lt,g as _t,a as xf,b as pp,c as Xw,d as Yw,o as Qw,e as Zw,B as Im,f as Ig,h as Cg,n as pm,N as ey,l as ty,i as ed,G as sy,r as ry,t as ay,j as ny,k as iy,m as Dc,q as oy,s as uy,u as ly,v as cy,w as Cm,x as td,y as Bf,z as hy,A as my}from"./_plugin-vue2_normalizer-C5BKbfSZ.chunk.mjs";import{f as Xe,B as Be,s as Fo,a as qh,O as X,N as at,g as d,S as O,I as H,C as L,R as me,c as G,b as z,d as ae,e as ye,h as je,A as le,P as ue,i as Ae,j as nt,k as wc,n as fy,l as yc,m as Wh,u as Uo,t as Of,G as $e,o as Ia,U as Pf,T as Df,p as tr,q as Tf,r as _h,v as Rf,w as Vg,x as ch,V as py,y as dy,z as gy,D as wy,E as yy,F as vc,H as vy,J as sd,K as rd,X as by,L as Jo}from"./x509.es-D2BJ79mi.chunk.mjs";import{N as Sy,a as Ay,b as Ny,s as Ey}from"./NcCheckboxRadioSwitch-CgbTELjq-BX1RRDyM.chunk.mjs";import{u as xg}from"./useModelMigration-EhAWvqDD-0Jq8hvXQ.chunk.mjs";function Bg(r,e,t){var n;const s="#initial-state-".concat(r,"-").concat(e);if((n=window._nc_initial_state)!=null&&n.has(s))return window._nc_initial_state.get(s);window._nc_initial_state||(window._nc_initial_state=new Map);const a=document.querySelector(s);if(a===null)return t;try{const o=JSON.parse(atob(a.value));return window._nc_initial_state.set(s,o),o}catch(o){return console.error("[@nextcloud/initial-state] Could not parse initial state",{key:e,app:r,error:o}),t}}function Og(){var r;return(r=Bg("files_sharing","isPublic",null))!=null?r:document.querySelector('input#isPublic[type="hidden"][name="isPublic"][value="1"]')!==null}function ky(){var r,e,t;return(t=(e=Bg("files_sharing","sharingToken",null))!=null?e:(r=document.querySelector('input#sharingToken[type="hidden"]'))==null?void 0:r.value)!=null?t:null}function Sr(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ad(r,e,t){Iy(r,e),e.set(r,t)}function Iy(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function At(r,e){var t=Pg(r,e,"get");return Cy(r,t)}function Cy(r,e){return e.get?e.get.call(r):e.value}function nd(r,e,t){var s=Pg(r,e,"set");return Vy(r,s,t),t}function Pg(r,e,t){if(!e.has(r))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(r)}function Vy(r,e,t){if(e.set)e.set.call(r,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}var xy=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",It=new WeakMap,Zo=new WeakMap;class dm{constructor(e){var{executor:t=()=>{},internals:s=gp(),promise:a=new Promise((n,o)=>t(n,o,u=>{s.onCancelList.push(u)}))}=e;ad(this,It,{writable:!0,value:void 0}),ad(this,Zo,{writable:!0,value:void 0}),Sr(this,xy,"CancelablePromise"),this.cancel=this.cancel.bind(this),nd(this,It,s),nd(this,Zo,a||new Promise((n,o)=>t(n,o,u=>{s.onCancelList.push(u)})))}then(e,t){return hh(At(this,Zo).then(Tc(e,At(this,It)),Tc(t,At(this,It))),At(this,It))}catch(e){return hh(At(this,Zo).catch(Tc(e,At(this,It))),At(this,It))}finally(e,t){return t&&At(this,It).onCancelList.push(e),hh(At(this,Zo).finally(Tc(()=>{if(e)return t&&(At(this,It).onCancelList=At(this,It).onCancelList.filter(s=>s!==e)),e()},At(this,It))),At(this,It))}cancel(){At(this,It).isCanceled=!0;var e=At(this,It).onCancelList;At(this,It).onCancelList=[];for(var t of e)if(typeof t=="function")try{t()}catch(s){console.error(s)}}isCanceled(){return At(this,It).isCanceled===!0}}class Ar extends dm{constructor(e){super({executor:e})}}Sr(Ar,"all",function(r){return Rc(r,Promise.all(r))}),Sr(Ar,"allSettled",function(r){return Rc(r,Promise.allSettled(r))}),Sr(Ar,"any",function(r){return Rc(r,Promise.any(r))}),Sr(Ar,"race",function(r){return Rc(r,Promise.race(r))}),Sr(Ar,"resolve",function(r){return id(Promise.resolve(r))}),Sr(Ar,"reject",function(r){return id(Promise.reject(r))}),Sr(Ar,"isCancelable",dp);function id(r){return hh(r,gp())}function dp(r){return r instanceof Ar||r instanceof dm}function Tc(r,e){if(r)return t=>{if(!e.isCanceled){var s=r(t);return dp(s)&&e.onCancelList.push(s.cancel),s}return t}}function hh(r,e){return new dm({internals:e,promise:r})}function Rc(r,e){var t=gp();return t.onCancelList.push(()=>{for(var s of r)dp(s)&&s.cancel()}),new dm({internals:t,promise:e})}function gp(){return{isCanceled:!1,onCancelList:[]}}var Vm={},By={2:r=>{function e(a,n,o){a instanceof RegExp&&(a=t(a,o)),n instanceof RegExp&&(n=t(n,o));var u=s(a,n,o);return u&&{start:u[0],end:u[1],pre:o.slice(0,u[0]),body:o.slice(u[0]+a.length,u[1]),post:o.slice(u[1]+n.length)}}function t(a,n){var o=n.match(a);return o?o[0]:null}function s(a,n,o){var u,h,c,i,f,m=o.indexOf(a),b=o.indexOf(n,m+1),v=m;if(m>=0&&b>0){for(u=[],c=o.length;v>=0&&!f;)v==m?(u.push(v),m=o.indexOf(a,v+1)):u.length==1?f=[u.pop(),b]:((h=u.pop())<c&&(c=h,i=b),b=o.indexOf(n,v+1)),v=m<b&&m>=0?m:b;u.length&&(f=[c,i])}return f}r.exports=e,e.range=s},101:function(r,e,t){var s;r=t.nmd(r),function(a){var n=(r&&r.exports,typeof _t=="object"&&_t);n.global!==n&&n.window;var o=function(f){this.message=f};(o.prototype=new Error).name="InvalidCharacterError";var u=function(f){throw new o(f)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=/[\t\n\f\r ]/g,i={encode:function(f){f=String(f),/[^\0-\xFF]/.test(f)&&u("The string to be encoded contains characters outside of the Latin1 range.");for(var m,b,v,w,y=f.length%3,k="",p=-1,S=f.length-y;++p<S;)m=f.charCodeAt(p)<<16,b=f.charCodeAt(++p)<<8,v=f.charCodeAt(++p),k+=h.charAt((w=m+b+v)>>18&63)+h.charAt(w>>12&63)+h.charAt(w>>6&63)+h.charAt(63&w);return y==2?(m=f.charCodeAt(p)<<8,b=f.charCodeAt(++p),k+=h.charAt((w=m+b)>>10)+h.charAt(w>>4&63)+h.charAt(w<<2&63)+"="):y==1&&(w=f.charCodeAt(p),k+=h.charAt(w>>2)+h.charAt(w<<4&63)+"=="),k},decode:function(f){var m=(f=String(f).replace(c,"")).length;m%4==0&&(m=(f=f.replace(/==?$/,"")).length),(m%4==1||/[^+a-zA-Z0-9/]/.test(f))&&u("Invalid character: the string to be decoded is not correctly encoded.");for(var b,v,w=0,y="",k=-1;++k<m;)v=h.indexOf(f.charAt(k)),b=w%4?64*b+v:v,w++%4&&(y+=String.fromCharCode(255&b>>(-2*w&6)));return y},version:"1.0.0"};(s=function(){return i}.call(e,t,e,r))===void 0||(r.exports=s)}()},172:(r,e)=>{e.d=function(t){if(!t)return 0;for(var s=(t=t.toString()).length,a=t.length;a--;){var n=t.charCodeAt(a);56320<=n&&n<=57343&&a--,127<n&&n<=2047?s++:2047<n&&n<=65535&&(s+=2)}return s}},526:r=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var s=[],a=0;a<t.length;a++)s.push(255&t.charCodeAt(a));return s},bytesToString:function(t){for(var s=[],a=0;a<t.length;a++)s.push(String.fromCharCode(t[a]));return s.join("")}}};r.exports=e},298:r=>{var e,t;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(s,a){return s<<a|s>>>32-a},rotr:function(s,a){return s<<32-a|s>>>a},endian:function(s){if(s.constructor==Number)return 16711935&t.rotl(s,8)|4278255360&t.rotl(s,24);for(var a=0;a<s.length;a++)s[a]=t.endian(s[a]);return s},randomBytes:function(s){for(var a=[];s>0;s--)a.push(Math.floor(256*Math.random()));return a},bytesToWords:function(s){for(var a=[],n=0,o=0;n<s.length;n++,o+=8)a[o>>>5]|=s[n]<<24-o%32;return a},wordsToBytes:function(s){for(var a=[],n=0;n<32*s.length;n+=8)a.push(s[n>>>5]>>>24-n%32&255);return a},bytesToHex:function(s){for(var a=[],n=0;n<s.length;n++)a.push((s[n]>>>4).toString(16)),a.push((15&s[n]).toString(16));return a.join("")},hexToBytes:function(s){for(var a=[],n=0;n<s.length;n+=2)a.push(parseInt(s.substr(n,2),16));return a},bytesToBase64:function(s){for(var a=[],n=0;n<s.length;n+=3)for(var o=s[n]<<16|s[n+1]<<8|s[n+2],u=0;u<4;u++)8*n+6*u<=8*s.length?a.push(e.charAt(o>>>6*(3-u)&63)):a.push("=");return a.join("")},base64ToBytes:function(s){s=s.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],n=0,o=0;n<s.length;o=++n%4)o!=0&&a.push((e.indexOf(s.charAt(n-1))&Math.pow(2,-2*o+8)-1)<<2*o|e.indexOf(s.charAt(n))>>>6-2*o);return a}},r.exports=t},635:(r,e,t)=>{const s=t(31),a=t(338),n=t(221);r.exports={XMLParser:a,XMLValidator:s,XMLBuilder:n}},118:r=>{r.exports=function(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const s of e)if(typeof s=="string"&&t===s||s instanceof RegExp&&s.test(t))return!0}:()=>!1}},705:(r,e)=>{const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",s="["+t+"]["+t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",a=new RegExp("^"+s+"$");e.isExist=function(n){return n!==void 0},e.isEmptyObject=function(n){return Object.keys(n).length===0},e.merge=function(n,o,u){if(o){const h=Object.keys(o),c=h.length;for(let i=0;i<c;i++)n[h[i]]=u==="strict"?[o[h[i]]]:o[h[i]]}},e.getValue=function(n){return e.isExist(n)?n:""},e.isName=function(n){return a.exec(n)!=null},e.getAllMatches=function(n,o){const u=[];let h=o.exec(n);for(;h;){const c=[];c.startIndex=o.lastIndex-h[0].length;const i=h.length;for(let f=0;f<i;f++)c.push(h[f]);u.push(c),h=o.exec(n)}return u},e.nameRegexp=s},31:(r,e,t)=>{const s=t(705),a={allowBooleanAttributes:!1,unpairedTags:[]};function n(p){return p===" "||p==="	"||p==="\n"||p==="\r"}function o(p,S){const I=S;for(;S<p.length;S++)if(!(p[S]!="?"&&p[S]!=" ")){const P=p.substr(I,S-I);if(S>5&&P==="xml")return v("InvalidXml","XML declaration allowed only at the start of the document.",y(p,S));if(p[S]=="?"&&p[S+1]==">"){S++;break}}return S}function u(p,S){if(p.length>S+5&&p[S+1]==="-"&&p[S+2]==="-"){for(S+=3;S<p.length;S++)if(p[S]==="-"&&p[S+1]==="-"&&p[S+2]===">"){S+=2;break}}else if(p.length>S+8&&p[S+1]==="D"&&p[S+2]==="O"&&p[S+3]==="C"&&p[S+4]==="T"&&p[S+5]==="Y"&&p[S+6]==="P"&&p[S+7]==="E"){let I=1;for(S+=8;S<p.length;S++)if(p[S]==="<")I++;else if(p[S]===">"&&(I--,I===0))break}else if(p.length>S+9&&p[S+1]==="["&&p[S+2]==="C"&&p[S+3]==="D"&&p[S+4]==="A"&&p[S+5]==="T"&&p[S+6]==="A"&&p[S+7]==="["){for(S+=8;S<p.length;S++)if(p[S]==="]"&&p[S+1]==="]"&&p[S+2]===">"){S+=2;break}}return S}e.validate=function(p,S){S=Object.assign({},a,S);const I=[];let P=!1,x=!1;p[0]==="\uFEFF"&&(p=p.substr(1));for(let B=0;B<p.length;B++)if(p[B]==="<"&&p[B+1]==="?"){if(B+=2,B=o(p,B),B.err)return B}else{if(p[B]!=="<"){if(n(p[B]))continue;return v("InvalidChar","char '"+p[B]+"' is not expected.",y(p,B))}{let V=B;if(B++,p[B]==="!"){B=u(p,B);continue}{let J=!1;p[B]==="/"&&(J=!0,B++);let F="";for(;B<p.length&&p[B]!==">"&&p[B]!==" "&&p[B]!=="	"&&p[B]!=="\n"&&p[B]!=="\r";B++)F+=p[B];if(F=F.trim(),F[F.length-1]==="/"&&(F=F.substring(0,F.length-1),B--),T=F,!s.isName(T)){let te;return te=F.trim().length===0?"Invalid space after '<'.":"Tag '"+F+"' is an invalid name.",v("InvalidTag",te,y(p,B))}const D=i(p,B);if(D===!1)return v("InvalidAttr","Attributes for '"+F+"' have open quote.",y(p,B));let j=D.value;if(B=D.index,j[j.length-1]==="/"){const te=B-j.length;j=j.substring(0,j.length-1);const Y=m(j,S);if(Y!==!0)return v(Y.err.code,Y.err.msg,y(p,te+Y.err.line));P=!0}else if(J){if(!D.tagClosed)return v("InvalidTag","Closing tag '"+F+"' doesn't have proper closing.",y(p,B));if(j.trim().length>0)return v("InvalidTag","Closing tag '"+F+"' can't have attributes or invalid starting.",y(p,V));if(I.length===0)return v("InvalidTag","Closing tag '"+F+"' has not been opened.",y(p,V));{const te=I.pop();if(F!==te.tagName){let Y=y(p,te.tagStartPos);return v("InvalidTag","Expected closing tag '"+te.tagName+"' (opened in line "+Y.line+", col "+Y.col+") instead of closing tag '"+F+"'.",y(p,V))}I.length==0&&(x=!0)}}else{const te=m(j,S);if(te!==!0)return v(te.err.code,te.err.msg,y(p,B-j.length+te.err.line));if(x===!0)return v("InvalidXml","Multiple possible root nodes found.",y(p,B));S.unpairedTags.indexOf(F)!==-1||I.push({tagName:F,tagStartPos:V}),P=!0}for(B++;B<p.length;B++)if(p[B]==="<"){if(p[B+1]==="!"){B++,B=u(p,B);continue}if(p[B+1]!=="?")break;if(B=o(p,++B),B.err)return B}else if(p[B]==="&"){const te=b(p,B);if(te==-1)return v("InvalidChar","char '&' is not expected.",y(p,B));B=te}else if(x===!0&&!n(p[B]))return v("InvalidXml","Extra text at the end",y(p,B));p[B]==="<"&&B--}}}var T;return P?I.length==1?v("InvalidTag","Unclosed tag '"+I[0].tagName+"'.",y(p,I[0].tagStartPos)):!(I.length>0)||v("InvalidXml","Invalid '"+JSON.stringify(I.map(B=>B.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):v("InvalidXml","Start tag expected.",1)};const h='"',c="'";function i(p,S){let I="",P="",x=!1;for(;S<p.length;S++){if(p[S]===h||p[S]===c)P===""?P=p[S]:P!==p[S]||(P="");else if(p[S]===">"&&P===""){x=!0;break}I+=p[S]}return P===""&&{value:I,index:S,tagClosed:x}}const f=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function m(p,S){const I=s.getAllMatches(p,f),P={};for(let x=0;x<I.length;x++){if(I[x][1].length===0)return v("InvalidAttr","Attribute '"+I[x][2]+"' has no space in starting.",k(I[x]));if(I[x][3]!==void 0&&I[x][4]===void 0)return v("InvalidAttr","Attribute '"+I[x][2]+"' is without value.",k(I[x]));if(I[x][3]===void 0&&!S.allowBooleanAttributes)return v("InvalidAttr","boolean attribute '"+I[x][2]+"' is not allowed.",k(I[x]));const T=I[x][2];if(!w(T))return v("InvalidAttr","Attribute '"+T+"' is an invalid name.",k(I[x]));if(P.hasOwnProperty(T))return v("InvalidAttr","Attribute '"+T+"' is repeated.",k(I[x]));P[T]=1}return!0}function b(p,S){if(p[++S]===";")return-1;if(p[S]==="#")return function(P,x){let T=/\d/;for(P[x]==="x"&&(x++,T=/[\da-fA-F]/);x<P.length;x++){if(P[x]===";")return x;if(!P[x].match(T))break}return-1}(p,++S);let I=0;for(;S<p.length;S++,I++)if(!(p[S].match(/\w/)&&I<20)){if(p[S]===";")break;return-1}return S}function v(p,S,I){return{err:{code:p,msg:S,line:I.line||I,col:I.col}}}function w(p){return s.isName(p)}function y(p,S){const I=p.substring(0,S).split(/\r?\n/);return{line:I.length,col:I[I.length-1].length+1}}function k(p){return p.startIndex+p[1].length}},221:(r,e,t)=>{const s=t(87),a=t(118),n={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(i,f){return f},attributeValueProcessor:function(i,f){return f},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function o(i){this.options=Object.assign({},n,i),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=a(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=c),this.processTextOrObjNode=u,this.options.format?(this.indentate=h,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function u(i,f,m,b){const v=this.j2x(i,m+1,b.concat(f));return i[this.options.textNodeName]!==void 0&&Object.keys(i).length===1?this.buildTextValNode(i[this.options.textNodeName],f,v.attrStr,m):this.buildObjectNode(v.val,f,v.attrStr,m)}function h(i){return this.options.indentBy.repeat(i)}function c(i){return!(!i.startsWith(this.options.attributeNamePrefix)||i===this.options.textNodeName)&&i.substr(this.attrPrefixLen)}o.prototype.build=function(i){return this.options.preserveOrder?s(i,this.options):(Array.isArray(i)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(i={[this.options.arrayNodeName]:i}),this.j2x(i,0,[]).val)},o.prototype.j2x=function(i,f,m){let b="",v="";const w=m.join(".");for(let y in i)if(Object.prototype.hasOwnProperty.call(i,y))if(i[y]===void 0)this.isAttribute(y)&&(v+="");else if(i[y]===null)this.isAttribute(y)?v+="":y[0]==="?"?v+=this.indentate(f)+"<"+y+"?"+this.tagEndChar:v+=this.indentate(f)+"<"+y+"/"+this.tagEndChar;else if(i[y]instanceof Date)v+=this.buildTextValNode(i[y],y,"",f);else if(typeof i[y]!="object"){const k=this.isAttribute(y);if(k&&!this.ignoreAttributesFn(k,w))b+=this.buildAttrPairStr(k,""+i[y]);else if(!k)if(y===this.options.textNodeName){let p=this.options.tagValueProcessor(y,""+i[y]);v+=this.replaceEntitiesValue(p)}else v+=this.buildTextValNode(i[y],y,"",f)}else if(Array.isArray(i[y])){const k=i[y].length;let p="",S="";for(let I=0;I<k;I++){const P=i[y][I];if(P!==void 0)if(P===null)y[0]==="?"?v+=this.indentate(f)+"<"+y+"?"+this.tagEndChar:v+=this.indentate(f)+"<"+y+"/"+this.tagEndChar;else if(typeof P=="object")if(this.options.oneListGroup){const x=this.j2x(P,f+1,m.concat(y));p+=x.val,this.options.attributesGroupName&&P.hasOwnProperty(this.options.attributesGroupName)&&(S+=x.attrStr)}else p+=this.processTextOrObjNode(P,y,f,m);else if(this.options.oneListGroup){let x=this.options.tagValueProcessor(y,P);x=this.replaceEntitiesValue(x),p+=x}else p+=this.buildTextValNode(P,y,"",f)}this.options.oneListGroup&&(p=this.buildObjectNode(p,y,S,f)),v+=p}else if(this.options.attributesGroupName&&y===this.options.attributesGroupName){const k=Object.keys(i[y]),p=k.length;for(let S=0;S<p;S++)b+=this.buildAttrPairStr(k[S],""+i[y][k[S]])}else v+=this.processTextOrObjNode(i[y],y,f,m);return{attrStr:b,val:v}},o.prototype.buildAttrPairStr=function(i,f){return f=this.options.attributeValueProcessor(i,""+f),f=this.replaceEntitiesValue(f),this.options.suppressBooleanAttributes&&f==="true"?" "+i:" "+i+'="'+f+'"'},o.prototype.buildObjectNode=function(i,f,m,b){if(i==="")return f[0]==="?"?this.indentate(b)+"<"+f+m+"?"+this.tagEndChar:this.indentate(b)+"<"+f+m+this.closeTag(f)+this.tagEndChar;{let v="</"+f+this.tagEndChar,w="";return f[0]==="?"&&(w="?",v=""),!m&&m!==""||i.indexOf("<")!==-1?this.options.commentPropName!==!1&&f===this.options.commentPropName&&w.length===0?this.indentate(b)+"<!--".concat(i,"-->")+this.newLine:this.indentate(b)+"<"+f+m+w+this.tagEndChar+i+this.indentate(b)+v:this.indentate(b)+"<"+f+m+w+">"+i+v}},o.prototype.closeTag=function(i){let f="";return this.options.unpairedTags.indexOf(i)!==-1?this.options.suppressUnpairedNode||(f="/"):f=this.options.suppressEmptyNode?"/":"></".concat(i),f},o.prototype.buildTextValNode=function(i,f,m,b){if(this.options.cdataPropName!==!1&&f===this.options.cdataPropName)return this.indentate(b)+"<![CDATA[".concat(i,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&f===this.options.commentPropName)return this.indentate(b)+"<!--".concat(i,"-->")+this.newLine;if(f[0]==="?")return this.indentate(b)+"<"+f+m+"?"+this.tagEndChar;{let v=this.options.tagValueProcessor(f,i);return v=this.replaceEntitiesValue(v),v===""?this.indentate(b)+"<"+f+m+this.closeTag(f)+this.tagEndChar:this.indentate(b)+"<"+f+m+">"+v+"</"+f+this.tagEndChar}},o.prototype.replaceEntitiesValue=function(i){if(i&&i.length>0&&this.options.processEntities)for(let f=0;f<this.options.entities.length;f++){const m=this.options.entities[f];i=i.replace(m.regex,m.val)}return i},r.exports=o},87:r=>{function e(o,u,h,c){let i="",f=!1;for(let m=0;m<o.length;m++){const b=o[m],v=t(b);if(v===void 0)continue;let w="";if(w=h.length===0?v:"".concat(h,".").concat(v),v===u.textNodeName){let S=b[v];a(w,u)||(S=u.tagValueProcessor(v,S),S=n(S,u)),f&&(i+=c),i+=S,f=!1;continue}if(v===u.cdataPropName){f&&(i+=c),i+="<![CDATA[".concat(b[v][0][u.textNodeName],"]]>"),f=!1;continue}if(v===u.commentPropName){i+=c+"<!--".concat(b[v][0][u.textNodeName],"-->"),f=!0;continue}if(v[0]==="?"){const S=s(b[":@"],u),I=v==="?xml"?"":c;let P=b[v][0][u.textNodeName];P=P.length!==0?" "+P:"",i+=I+"<".concat(v).concat(P).concat(S,"?>"),f=!0;continue}let y=c;y!==""&&(y+=u.indentBy);const k=c+"<".concat(v).concat(s(b[":@"],u)),p=e(b[v],u,w,y);u.unpairedTags.indexOf(v)!==-1?u.suppressUnpairedNode?i+=k+">":i+=k+"/>":p&&p.length!==0||!u.suppressEmptyNode?p&&p.endsWith(">")?i+=k+">".concat(p).concat(c,"</").concat(v,">"):(i+=k+">",p&&c!==""&&(p.includes("/>")||p.includes("</"))?i+=c+u.indentBy+p+c:i+=p,i+="</".concat(v,">")):i+=k+"/>",f=!0}return i}function t(o){const u=Object.keys(o);for(let h=0;h<u.length;h++){const c=u[h];if(o.hasOwnProperty(c)&&c!==":@")return c}}function s(o,u){let h="";if(o&&!u.ignoreAttributes)for(let c in o){if(!o.hasOwnProperty(c))continue;let i=u.attributeValueProcessor(c,o[c]);i=n(i,u),i===!0&&u.suppressBooleanAttributes?h+=" ".concat(c.substr(u.attributeNamePrefix.length)):h+=" ".concat(c.substr(u.attributeNamePrefix.length),'="').concat(i,'"')}return h}function a(o,u){let h=(o=o.substr(0,o.length-u.textNodeName.length-1)).substr(o.lastIndexOf(".")+1);for(let c in u.stopNodes)if(u.stopNodes[c]===o||u.stopNodes[c]==="*."+h)return!0;return!1}function n(o,u){if(o&&o.length>0&&u.processEntities)for(let h=0;h<u.entities.length;h++){const c=u.entities[h];o=o.replace(c.regex,c.val)}return o}r.exports=function(o,u){let h="";return u.format&&u.indentBy.length>0&&(h="\n"),e(o,u,"",h)}},193:(r,e,t)=>{const s=t(705);function a(f,m){let b="";for(;m<f.length&&f[m]!=="'"&&f[m]!=='"';m++)b+=f[m];if(b=b.trim(),b.indexOf(" ")!==-1)throw new Error("External entites are not supported");const v=f[m++];let w="";for(;m<f.length&&f[m]!==v;m++)w+=f[m];return[b,w,m]}function n(f,m){return f[m+1]==="!"&&f[m+2]==="-"&&f[m+3]==="-"}function o(f,m){return f[m+1]==="!"&&f[m+2]==="E"&&f[m+3]==="N"&&f[m+4]==="T"&&f[m+5]==="I"&&f[m+6]==="T"&&f[m+7]==="Y"}function u(f,m){return f[m+1]==="!"&&f[m+2]==="E"&&f[m+3]==="L"&&f[m+4]==="E"&&f[m+5]==="M"&&f[m+6]==="E"&&f[m+7]==="N"&&f[m+8]==="T"}function h(f,m){return f[m+1]==="!"&&f[m+2]==="A"&&f[m+3]==="T"&&f[m+4]==="T"&&f[m+5]==="L"&&f[m+6]==="I"&&f[m+7]==="S"&&f[m+8]==="T"}function c(f,m){return f[m+1]==="!"&&f[m+2]==="N"&&f[m+3]==="O"&&f[m+4]==="T"&&f[m+5]==="A"&&f[m+6]==="T"&&f[m+7]==="I"&&f[m+8]==="O"&&f[m+9]==="N"}function i(f){if(s.isName(f))return f;throw new Error("Invalid entity name ".concat(f))}r.exports=function(f,m){const b={};if(f[m+3]!=="O"||f[m+4]!=="C"||f[m+5]!=="T"||f[m+6]!=="Y"||f[m+7]!=="P"||f[m+8]!=="E")throw new Error("Invalid Tag instead of DOCTYPE");{m+=9;let v=1,w=!1,y=!1,k="";for(;m<f.length;m++)if(f[m]!=="<"||y)if(f[m]===">"){if(y?f[m-1]==="-"&&f[m-2]==="-"&&(y=!1,v--):v--,v===0)break}else f[m]==="["?w=!0:k+=f[m];else{if(w&&o(f,m)){let p,S;m+=7,[p,S,m]=a(f,m+1),S.indexOf("&")===-1&&(b[i(p)]={regx:RegExp("&".concat(p,";"),"g"),val:S})}else if(w&&u(f,m))m+=8;else if(w&&h(f,m))m+=8;else if(w&&c(f,m))m+=9;else{if(!n)throw new Error("Invalid DOCTYPE");y=!0}v++,k=""}if(v!==0)throw new Error("Unclosed DOCTYPE")}return{entities:b,i:m}}},63:(r,e)=>{const t={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,a){return a},attributeValueProcessor:function(s,a){return a},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,a,n){return s}};e.buildOptions=function(s){return Object.assign({},t,s)},e.defaultOptions=t},299:(r,e,t)=>{const s=t(705),a=t(365),n=t(193),o=t(494),u=t(118);function h(x){const T=Object.keys(x);for(let B=0;B<T.length;B++){const V=T[B];this.lastEntities[V]={regex:new RegExp("&"+V+";","g"),val:x[V]}}}function c(x,T,B,V,J,F,D){if(x!==void 0&&(this.options.trimValues&&!V&&(x=x.trim()),x.length>0)){D||(x=this.replaceEntitiesValue(x));const j=this.options.tagValueProcessor(T,x,B,J,F);return j==null?x:typeof j!=typeof x||j!==x?j:this.options.trimValues||x.trim()===x?P(x,this.options.parseTagValue,this.options.numberParseOptions):x}}function i(x){if(this.options.removeNSPrefix){const T=x.split(":"),B=x.charAt(0)==="/"?"/":"";if(T[0]==="xmlns")return"";T.length===2&&(x=B+T[1])}return x}const f=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function m(x,T,B){if(this.options.ignoreAttributes!==!0&&typeof x=="string"){const V=s.getAllMatches(x,f),J=V.length,F={};for(let D=0;D<J;D++){const j=this.resolveNameSpace(V[D][1]);if(this.ignoreAttributesFn(j,T))continue;let te=V[D][4],Y=this.options.attributeNamePrefix+j;if(j.length)if(this.options.transformAttributeName&&(Y=this.options.transformAttributeName(Y)),Y==="__proto__"&&(Y="#__proto__"),te!==void 0){this.options.trimValues&&(te=te.trim()),te=this.replaceEntitiesValue(te);const oe=this.options.attributeValueProcessor(j,te,T);F[Y]=oe==null?te:typeof oe!=typeof te||oe!==te?oe:P(te,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(F[Y]=!0)}if(!Object.keys(F).length)return;if(this.options.attributesGroupName){const D={};return D[this.options.attributesGroupName]=F,D}return F}}const b=function(x){x=x.replace(/\r\n?/g,"\n");const T=new a("!xml");let B=T,V="",J="";for(let F=0;F<x.length;F++)if(x[F]==="<")if(x[F+1]==="/"){const D=p(x,">",F,"Closing Tag is not closed.");let j=x.substring(F+2,D).trim();if(this.options.removeNSPrefix){const oe=j.indexOf(":");oe!==-1&&(j=j.substr(oe+1))}this.options.transformTagName&&(j=this.options.transformTagName(j)),B&&(V=this.saveTextToParentTag(V,B,J));const te=J.substring(J.lastIndexOf(".")+1);if(j&&this.options.unpairedTags.indexOf(j)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(j,">"));let Y=0;te&&this.options.unpairedTags.indexOf(te)!==-1?(Y=J.lastIndexOf(".",J.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Y=J.lastIndexOf("."),J=J.substring(0,Y),B=this.tagsNodeStack.pop(),V="",F=D}else if(x[F+1]==="?"){let D=S(x,F,!1,"?>");if(!D)throw new Error("Pi Tag is not closed.");if(V=this.saveTextToParentTag(V,B,J),!(this.options.ignoreDeclaration&&D.tagName==="?xml"||this.options.ignorePiTags)){const j=new a(D.tagName);j.add(this.options.textNodeName,""),D.tagName!==D.tagExp&&D.attrExpPresent&&(j[":@"]=this.buildAttributesMap(D.tagExp,J,D.tagName)),this.addChild(B,j,J)}F=D.closeIndex+1}else if(x.substr(F+1,3)==="!--"){const D=p(x,"-->",F+4,"Comment is not closed.");if(this.options.commentPropName){const j=x.substring(F+4,D-2);V=this.saveTextToParentTag(V,B,J),B.add(this.options.commentPropName,[{[this.options.textNodeName]:j}])}F=D}else if(x.substr(F+1,2)==="!D"){const D=n(x,F);this.docTypeEntities=D.entities,F=D.i}else if(x.substr(F+1,2)==="!["){const D=p(x,"]]>",F,"CDATA is not closed.")-2,j=x.substring(F+9,D);V=this.saveTextToParentTag(V,B,J);let te=this.parseTextData(j,B.tagname,J,!0,!1,!0,!0);te==null&&(te=""),this.options.cdataPropName?B.add(this.options.cdataPropName,[{[this.options.textNodeName]:j}]):B.add(this.options.textNodeName,te),F=D+2}else{let D=S(x,F,this.options.removeNSPrefix),j=D.tagName;const te=D.rawTagName;let Y=D.tagExp,oe=D.attrExpPresent,ne=D.closeIndex;this.options.transformTagName&&(j=this.options.transformTagName(j)),B&&V&&B.tagname!=="!xml"&&(V=this.saveTextToParentTag(V,B,J,!1));const de=B;if(de&&this.options.unpairedTags.indexOf(de.tagname)!==-1&&(B=this.tagsNodeStack.pop(),J=J.substring(0,J.lastIndexOf("."))),j!==T.tagname&&(J+=J?"."+j:j),this.isItStopNode(this.options.stopNodes,J,j)){let ie="";if(Y.length>0&&Y.lastIndexOf("/")===Y.length-1)j[j.length-1]==="/"?(j=j.substr(0,j.length-1),J=J.substr(0,J.length-1),Y=j):Y=Y.substr(0,Y.length-1),F=D.closeIndex;else if(this.options.unpairedTags.indexOf(j)!==-1)F=D.closeIndex;else{const se=this.readStopNodeData(x,te,ne+1);if(!se)throw new Error("Unexpected end of ".concat(te));F=se.i,ie=se.tagContent}const re=new a(j);j!==Y&&oe&&(re[":@"]=this.buildAttributesMap(Y,J,j)),ie&&(ie=this.parseTextData(ie,j,J,!0,oe,!0,!0)),J=J.substr(0,J.lastIndexOf(".")),re.add(this.options.textNodeName,ie),this.addChild(B,re,J)}else{if(Y.length>0&&Y.lastIndexOf("/")===Y.length-1){j[j.length-1]==="/"?(j=j.substr(0,j.length-1),J=J.substr(0,J.length-1),Y=j):Y=Y.substr(0,Y.length-1),this.options.transformTagName&&(j=this.options.transformTagName(j));const ie=new a(j);j!==Y&&oe&&(ie[":@"]=this.buildAttributesMap(Y,J,j)),this.addChild(B,ie,J),J=J.substr(0,J.lastIndexOf("."))}else{const ie=new a(j);this.tagsNodeStack.push(B),j!==Y&&oe&&(ie[":@"]=this.buildAttributesMap(Y,J,j)),this.addChild(B,ie,J),B=ie}V="",F=ne}}else V+=x[F];return T.child};function v(x,T,B){const V=this.options.updateTag(T.tagname,B,T[":@"]);V===!1||(typeof V=="string"&&(T.tagname=V),x.addChild(T))}const w=function(x){if(this.options.processEntities){for(let T in this.docTypeEntities){const B=this.docTypeEntities[T];x=x.replace(B.regx,B.val)}for(let T in this.lastEntities){const B=this.lastEntities[T];x=x.replace(B.regex,B.val)}if(this.options.htmlEntities)for(let T in this.htmlEntities){const B=this.htmlEntities[T];x=x.replace(B.regex,B.val)}x=x.replace(this.ampEntity.regex,this.ampEntity.val)}return x};function y(x,T,B,V){return x&&(V===void 0&&(V=Object.keys(T.child).length===0),(x=this.parseTextData(x,T.tagname,B,!1,!!T[":@"]&&Object.keys(T[":@"]).length!==0,V))!==void 0&&x!==""&&T.add(this.options.textNodeName,x),x=""),x}function k(x,T,B){const V="*."+B;for(const J in x){const F=x[J];if(V===F||T===F)return!0}return!1}function p(x,T,B,V){const J=x.indexOf(T,B);if(J===-1)throw new Error(V);return J+T.length-1}function S(x,T,B){const V=function(oe,ne){let de,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",re="";for(let se=ne;se<oe.length;se++){let ee=oe[se];if(de)ee===de&&(de="");else if(ee==='"'||ee==="'")de=ee;else if(ee===ie[0]){if(!ie[1])return{data:re,index:se};if(oe[se+1]===ie[1])return{data:re,index:se}}else ee==="	"&&(ee=" ");re+=ee}}(x,T+1,arguments.length>3&&arguments[3]!==void 0?arguments[3]:">");if(!V)return;let J=V.data;const F=V.index,D=J.search(/\s/);let j=J,te=!0;D!==-1&&(j=J.substring(0,D),J=J.substring(D+1).trimStart());const Y=j;if(B){const oe=j.indexOf(":");oe!==-1&&(j=j.substr(oe+1),te=j!==V.data.substr(oe+1))}return{tagName:j,tagExp:J,closeIndex:F,attrExpPresent:te,rawTagName:Y}}function I(x,T,B){const V=B;let J=1;for(;B<x.length;B++)if(x[B]==="<")if(x[B+1]==="/"){const F=p(x,">",B,"".concat(T," is not closed"));if(x.substring(B+2,F).trim()===T&&(J--,J===0))return{tagContent:x.substring(V,B),i:F};B=F}else if(x[B+1]==="?")B=p(x,"?>",B+1,"StopNode is not closed.");else if(x.substr(B+1,3)==="!--")B=p(x,"-->",B+3,"StopNode is not closed.");else if(x.substr(B+1,2)==="![")B=p(x,"]]>",B,"StopNode is not closed.")-2;else{const F=S(x,B,">");F&&((F&&F.tagName)===T&&F.tagExp[F.tagExp.length-1]!=="/"&&J++,B=F.closeIndex)}}function P(x,T,B){if(T&&typeof x=="string"){const V=x.trim();return V==="true"||V!=="false"&&o(x,B)}return s.isExist(x)?x:""}r.exports=class{constructor(x){this.options=x,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(T,B)=>String.fromCharCode(Number.parseInt(B,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(T,B)=>String.fromCharCode(Number.parseInt(B,16))}},this.addExternalEntities=h,this.parseXml=b,this.parseTextData=c,this.resolveNameSpace=i,this.buildAttributesMap=m,this.isItStopNode=k,this.replaceEntitiesValue=w,this.readStopNodeData=I,this.saveTextToParentTag=y,this.addChild=v,this.ignoreAttributesFn=u(this.options.ignoreAttributes)}}},338:(r,e,t)=>{const{buildOptions:s}=t(63),a=t(299),{prettify:n}=t(728),o=t(31);r.exports=class{constructor(u){this.externalEntities={},this.options=s(u)}parse(u,h){if(typeof u!="string"){if(!u.toString)throw new Error("XML data is accepted in String or Bytes[] form.");u=u.toString()}if(h){h===!0&&(h={});const f=o.validate(u,h);if(f!==!0)throw Error("".concat(f.err.msg,":").concat(f.err.line,":").concat(f.err.col))}const c=new a(this.options);c.addExternalEntities(this.externalEntities);const i=c.parseXml(u);return this.options.preserveOrder||i===void 0?i:n(i,this.options)}addEntity(u,h){if(h.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(u.indexOf("&")!==-1||u.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(h==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[u]=h}}},728:(r,e)=>{function t(o,u,h){let c;const i={};for(let f=0;f<o.length;f++){const m=o[f],b=s(m);let v="";if(v=h===void 0?b:h+"."+b,b===u.textNodeName)c===void 0?c=m[b]:c+=""+m[b];else{if(b===void 0)continue;if(m[b]){let w=t(m[b],u,v);const y=n(w,u);m[":@"]?a(w,m[":@"],v,u):Object.keys(w).length!==1||w[u.textNodeName]===void 0||u.alwaysCreateTextNode?Object.keys(w).length===0&&(u.alwaysCreateTextNode?w[u.textNodeName]="":w=""):w=w[u.textNodeName],i[b]!==void 0&&i.hasOwnProperty(b)?(Array.isArray(i[b])||(i[b]=[i[b]]),i[b].push(w)):u.isArray(b,v,y)?i[b]=[w]:i[b]=w}}}return typeof c=="string"?c.length>0&&(i[u.textNodeName]=c):c!==void 0&&(i[u.textNodeName]=c),i}function s(o){const u=Object.keys(o);for(let h=0;h<u.length;h++){const c=u[h];if(c!==":@")return c}}function a(o,u,h,c){if(u){const i=Object.keys(u),f=i.length;for(let m=0;m<f;m++){const b=i[m];c.isArray(b,h+"."+b,!0,!0)?o[b]=[u[b]]:o[b]=u[b]}}}function n(o,u){const{textNodeName:h}=u,c=Object.keys(o).length;return c===0||!(c!==1||!o[h]&&typeof o[h]!="boolean"&&o[h]!==0)}e.prettify=function(o,u){return t(o,u)}},365:r=>{r.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},135:r=>{function e(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}r.exports=function(t){return t!=null&&(e(t)||function(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&e(s.slice(0,0))}(t)||!!t._isBuffer)}},542:(r,e,t)=>{(function(){var s=t(298),a=t(526).utf8,n=t(135),o=t(526).bin,u=function(h,c){h.constructor==String?h=c&&c.encoding==="binary"?o.stringToBytes(h):a.stringToBytes(h):n(h)?h=Array.prototype.slice.call(h,0):Array.isArray(h)||h.constructor===Uint8Array||(h=h.toString());for(var i=s.bytesToWords(h),f=8*h.length,m=1732584193,b=-271733879,v=-1732584194,w=271733878,y=0;y<i.length;y++)i[y]=16711935&(i[y]<<8|i[y]>>>24)|4278255360&(i[y]<<24|i[y]>>>8);i[f>>>5]|=128<<f%32,i[14+(f+64>>>9<<4)]=f;var k=u._ff,p=u._gg,S=u._hh,I=u._ii;for(y=0;y<i.length;y+=16){var P=m,x=b,T=v,B=w;m=k(m,b,v,w,i[y+0],7,-680876936),w=k(w,m,b,v,i[y+1],12,-389564586),v=k(v,w,m,b,i[y+2],17,606105819),b=k(b,v,w,m,i[y+3],22,-1044525330),m=k(m,b,v,w,i[y+4],7,-176418897),w=k(w,m,b,v,i[y+5],12,1200080426),v=k(v,w,m,b,i[y+6],17,-1473231341),b=k(b,v,w,m,i[y+7],22,-45705983),m=k(m,b,v,w,i[y+8],7,1770035416),w=k(w,m,b,v,i[y+9],12,-1958414417),v=k(v,w,m,b,i[y+10],17,-42063),b=k(b,v,w,m,i[y+11],22,-1990404162),m=k(m,b,v,w,i[y+12],7,1804603682),w=k(w,m,b,v,i[y+13],12,-40341101),v=k(v,w,m,b,i[y+14],17,-1502002290),m=p(m,b=k(b,v,w,m,i[y+15],22,1236535329),v,w,i[y+1],5,-165796510),w=p(w,m,b,v,i[y+6],9,-1069501632),v=p(v,w,m,b,i[y+11],14,643717713),b=p(b,v,w,m,i[y+0],20,-373897302),m=p(m,b,v,w,i[y+5],5,-701558691),w=p(w,m,b,v,i[y+10],9,38016083),v=p(v,w,m,b,i[y+15],14,-660478335),b=p(b,v,w,m,i[y+4],20,-405537848),m=p(m,b,v,w,i[y+9],5,568446438),w=p(w,m,b,v,i[y+14],9,-1019803690),v=p(v,w,m,b,i[y+3],14,-187363961),b=p(b,v,w,m,i[y+8],20,1163531501),m=p(m,b,v,w,i[y+13],5,-1444681467),w=p(w,m,b,v,i[y+2],9,-51403784),v=p(v,w,m,b,i[y+7],14,1735328473),m=S(m,b=p(b,v,w,m,i[y+12],20,-1926607734),v,w,i[y+5],4,-378558),w=S(w,m,b,v,i[y+8],11,-2022574463),v=S(v,w,m,b,i[y+11],16,1839030562),b=S(b,v,w,m,i[y+14],23,-35309556),m=S(m,b,v,w,i[y+1],4,-1530992060),w=S(w,m,b,v,i[y+4],11,1272893353),v=S(v,w,m,b,i[y+7],16,-155497632),b=S(b,v,w,m,i[y+10],23,-1094730640),m=S(m,b,v,w,i[y+13],4,681279174),w=S(w,m,b,v,i[y+0],11,-358537222),v=S(v,w,m,b,i[y+3],16,-722521979),b=S(b,v,w,m,i[y+6],23,76029189),m=S(m,b,v,w,i[y+9],4,-640364487),w=S(w,m,b,v,i[y+12],11,-421815835),v=S(v,w,m,b,i[y+15],16,530742520),m=I(m,b=S(b,v,w,m,i[y+2],23,-995338651),v,w,i[y+0],6,-198630844),w=I(w,m,b,v,i[y+7],10,1126891415),v=I(v,w,m,b,i[y+14],15,-1416354905),b=I(b,v,w,m,i[y+5],21,-57434055),m=I(m,b,v,w,i[y+12],6,1700485571),w=I(w,m,b,v,i[y+3],10,-1894986606),v=I(v,w,m,b,i[y+10],15,-1051523),b=I(b,v,w,m,i[y+1],21,-2054922799),m=I(m,b,v,w,i[y+8],6,1873313359),w=I(w,m,b,v,i[y+15],10,-30611744),v=I(v,w,m,b,i[y+6],15,-1560198380),b=I(b,v,w,m,i[y+13],21,1309151649),m=I(m,b,v,w,i[y+4],6,-145523070),w=I(w,m,b,v,i[y+11],10,-1120210379),v=I(v,w,m,b,i[y+2],15,718787259),b=I(b,v,w,m,i[y+9],21,-343485551),m=m+P>>>0,b=b+x>>>0,v=v+T>>>0,w=w+B>>>0}return s.endian([m,b,v,w])};u._ff=function(h,c,i,f,m,b,v){var w=h+(c&i|~c&f)+(m>>>0)+v;return(w<<b|w>>>32-b)+c},u._gg=function(h,c,i,f,m,b,v){var w=h+(c&f|i&~f)+(m>>>0)+v;return(w<<b|w>>>32-b)+c},u._hh=function(h,c,i,f,m,b,v){var w=h+(c^i^f)+(m>>>0)+v;return(w<<b|w>>>32-b)+c},u._ii=function(h,c,i,f,m,b,v){var w=h+(i^(c|~f))+(m>>>0)+v;return(w<<b|w>>>32-b)+c},u._blocksize=16,u._digestsize=16,r.exports=function(h,c){if(h==null)throw new Error("Illegal argument "+h);var i=s.wordsToBytes(u(h,c));return c&&c.asBytes?i:c&&c.asString?o.bytesToString(i):s.bytesToHex(i)}})()},285:(r,e,t)=>{var s=t(2);r.exports=function(k){return k?(k.substr(0,2)==="{}"&&(k="\\{\\}"+k.substr(2)),y(function(p){return p.split("\\\\").join(a).split("\\{").join(n).split("\\}").join(o).split("\\,").join(u).split("\\.").join(h)}(k),!0).map(i)):[]};var a="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",o="\0CLOSE"+Math.random()+"\0",u="\0COMMA"+Math.random()+"\0",h="\0PERIOD"+Math.random()+"\0";function c(k){return parseInt(k,10)==k?parseInt(k,10):k.charCodeAt(0)}function i(k){return k.split(a).join("\\").split(n).join("{").split(o).join("}").split(u).join(",").split(h).join(".")}function f(k){if(!k)return[""];var p=[],S=s("{","}",k);if(!S)return k.split(",");var I=S.pre,P=S.body,x=S.post,T=I.split(",");T[T.length-1]+="{"+P+"}";var B=f(x);return x.length&&(T[T.length-1]+=B.shift(),T.push.apply(T,B)),p.push.apply(p,T),p}function m(k){return"{"+k+"}"}function b(k){return/^-?0\d/.test(k)}function v(k,p){return k<=p}function w(k,p){return k>=p}function y(k,p){var S=[],I=s("{","}",k);if(!I)return[k];var P=I.pre,x=I.post.length?y(I.post,!1):[""];if(/\$$/.test(I.pre))for(var T=0;T<x.length;T++){var B=P+"{"+I.body+"}"+x[T];S.push(B)}else{var V,J,F=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(I.body),D=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(I.body),j=F||D,te=I.body.indexOf(",")>=0;if(!j&&!te)return I.post.match(/,.*\}/)?y(k=I.pre+"{"+I.body+o+I.post):[k];if(j)V=I.body.split(/\.\./);else if((V=f(I.body)).length===1&&(V=y(V[0],!1).map(m)).length===1)return x.map(function(Fe){return I.pre+V[0]+Fe});if(j){var Y=c(V[0]),oe=c(V[1]),ne=Math.max(V[0].length,V[1].length),de=V.length==3?Math.abs(c(V[2])):1,ie=v;oe<Y&&(de*=-1,ie=w);var re=V.some(b);J=[];for(var se=Y;ie(se,oe);se+=de){var ee;if(D)(ee=String.fromCharCode(se))==="\\"&&(ee="");else if(ee=String(se),re){var ce=ne-ee.length;if(ce>0){var pe=new Array(ce+1).join("0");ee=se<0?"-"+pe+ee.slice(1):pe+ee}}J.push(ee)}}else{J=[];for(var Ce=0;Ce<V.length;Ce++)J.push.apply(J,y(V[Ce],!1))}for(Ce=0;Ce<J.length;Ce++)for(T=0;T<x.length;T++)B=P+J[Ce]+x[T],(!p||j||B)&&S.push(B)}return S}},829:r=>{function e(c){return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},e(c)}function t(c){var i=typeof Map=="function"?new Map:void 0;return t=function(f){if(f===null||(m=f,Function.toString.call(m).indexOf("[native code]")===-1))return f;var m;if(typeof f!="function")throw new TypeError("Super expression must either be null or a function");if(i!==void 0){if(i.has(f))return i.get(f);i.set(f,b)}function b(){return s(f,arguments,n(this).constructor)}return b.prototype=Object.create(f.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),a(b,f)},t(c)}function s(c,i,f){return s=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}()?Reflect.construct:function(m,b,v){var w=[null];w.push.apply(w,b);var y=new(Function.bind.apply(m,w));return v&&a(y,v.prototype),y},s.apply(null,arguments)}function a(c,i){return a=Object.setPrototypeOf||function(f,m){return f.__proto__=m,f},a(c,i)}function n(c){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},n(c)}var o=function(c){function i(f){var m;return function(b,v){if(!(b instanceof v))throw new TypeError("Cannot call a class as a function")}(this,i),(m=function(b,v){return!v||e(v)!=="object"&&typeof v!="function"?function(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}(b):v}(this,n(i).call(this,f))).name="ObjectPrototypeMutationError",m}return function(f,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(m&&m.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),m&&a(f,m)}(i,c),i}(t(Error));function u(c,i){for(var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},m=i.split("."),b=m.length,v=function(k){var p=m[k];if(!c)return{v:void 0};if(p==="+"){if(Array.isArray(c))return{v:c.map(function(I,P){var x=m.slice(k+1);return x.length>0?u(I,x.join("."),f):f(c,P,m,k)})};var S=m.slice(0,k).join(".");throw new Error("Object at wildcard (".concat(S,") is not an array"))}c=f(c,p,m,k)},w=0;w<b;w++){var y=v(w);if(e(y)==="object")return y.v}return c}function h(c,i){return c.length===i+1}r.exports={set:function(c,i,f){if(e(c)!="object"||c===null||i===void 0)return c;if(typeof i=="number")return c[i]=f,c[i];try{return u(c,i,function(m,b,v,w){if(m===Reflect.getPrototypeOf({}))throw new o("Attempting to mutate Object.prototype");if(!m[b]){var y=Number.isInteger(Number(v[w+1])),k=v[w+1]==="+";m[b]=y||k?[]:{}}return h(v,w)&&(m[b]=f),m[b]})}catch(m){if(m instanceof o)throw m;return c}},get:function(c,i){if(e(c)!="object"||c===null||i===void 0)return c;if(typeof i=="number")return c[i];try{return u(c,i,function(f,m){return f[m]})}catch(f){return c}},has:function(c,i){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e(c)!="object"||c===null||i===void 0)return!1;if(typeof i=="number")return i in c;try{var m=!1;return u(c,i,function(b,v,w,y){if(!h(w,y))return b&&b[v];m=f.own?b.hasOwnProperty(v):v in b}),m}catch(b){return!1}},hasOwn:function(c,i,f){return this.has(c,i,f||{own:!0})},isIn:function(c,i,f){var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(e(c)!="object"||c===null||i===void 0)return!1;try{var b=!1,v=!1;return u(c,i,function(w,y,k,p){return b=b||w===f||!!w&&w[y]===f,v=h(k,p)&&e(w)==="object"&&y in w,w&&w[y]}),m.validPath?b&&v:b}catch(w){return!1}},ObjectPrototypeMutationError:o}},47:(r,e,t)=>{var s=t(410),a=function(c){return typeof c=="string"};function n(c,i){for(var f=[],m=0;m<c.length;m++){var b=c[m];b&&b!=="."&&(b===".."?f.length&&f[f.length-1]!==".."?f.pop():i&&f.push(".."):f.push(b))}return f}var o=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,u={};function h(c){return o.exec(c).slice(1)}u.resolve=function(){for(var c="",i=!1,f=arguments.length-1;f>=-1&&!i;f--){var m=f>=0?arguments[f]:lt.cwd();if(!a(m))throw new TypeError("Arguments to path.resolve must be strings");m&&(c=m+"/"+c,i=m.charAt(0)==="/")}return(i?"/":"")+(c=n(c.split("/"),!i).join("/"))||"."},u.normalize=function(c){var i=u.isAbsolute(c),f=c.substr(-1)==="/";return(c=n(c.split("/"),!i).join("/"))||i||(c="."),c&&f&&(c+="/"),(i?"/":"")+c},u.isAbsolute=function(c){return c.charAt(0)==="/"},u.join=function(){for(var c="",i=0;i<arguments.length;i++){var f=arguments[i];if(!a(f))throw new TypeError("Arguments to path.join must be strings");f&&(c+=c?"/"+f:f)}return u.normalize(c)},u.relative=function(c,i){function f(p){for(var S=0;S<p.length&&p[S]==="";S++);for(var I=p.length-1;I>=0&&p[I]==="";I--);return S>I?[]:p.slice(S,I+1)}c=u.resolve(c).substr(1),i=u.resolve(i).substr(1);for(var m=f(c.split("/")),b=f(i.split("/")),v=Math.min(m.length,b.length),w=v,y=0;y<v;y++)if(m[y]!==b[y]){w=y;break}var k=[];for(y=w;y<m.length;y++)k.push("..");return(k=k.concat(b.slice(w))).join("/")},u._makeLong=function(c){return c},u.dirname=function(c){var i=h(c),f=i[0],m=i[1];return f||m?(m&&(m=m.substr(0,m.length-1)),f+m):"."},u.basename=function(c,i){var f=h(c)[2];return i&&f.substr(-1*i.length)===i&&(f=f.substr(0,f.length-i.length)),f},u.extname=function(c){return h(c)[3]},u.format=function(c){if(!s.isObject(c))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof c);var i=c.root||"";if(!a(i))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof c.root);return(c.dir?c.dir+u.sep:"")+(c.base||"")},u.parse=function(c){if(!a(c))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof c);var i=h(c);if(!i||i.length!==4)throw new TypeError("Invalid path '"+c+"'");return i[1]=i[1]||"",i[2]=i[2]||"",i[3]=i[3]||"",{root:i[0],dir:i[0]+i[1].slice(0,i[1].length-1),base:i[2],ext:i[3],name:i[2].slice(0,i[2].length-i[3].length)}},u.sep="/",u.delimiter=":",r.exports=u},647:(r,e)=>{var t=Object.prototype.hasOwnProperty;function s(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch(o){return null}}function a(n){try{return encodeURIComponent(n)}catch(o){return null}}e.stringify=function(n,o){o=o||"";var u,h,c=[];for(h in typeof o!="string"&&(o="?"),n)if(t.call(n,h)){if((u=n[h])||u!=null&&!isNaN(u)||(u=""),h=a(h),u=a(u),h===null||u===null)continue;c.push(h+"="+u)}return c.length?o+c.join("&"):""},e.parse=function(n){for(var o,u=/([^=?#&]+)=?([^&]*)/g,h={};o=u.exec(n);){var c=s(o[1]),i=s(o[2]);c===null||i===null||c in h||(h[c]=i)}return h}},670:r=>{r.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}},494:r=>{const e=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const s={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};r.exports=function(a){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n=Object.assign({},s,n),!a||typeof a!="string")return a;let o=a.trim();if(n.skipLike!==void 0&&n.skipLike.test(o))return a;if(n.hex&&e.test(o))return Number.parseInt(o,16);{const h=t.exec(o);if(h){const c=h[1],i=h[2];let f=((u=h[3])&&u.indexOf(".")!==-1&&((u=u.replace(/0+$/,""))==="."?u="0":u[0]==="."?u="0"+u:u[u.length-1]==="."&&(u=u.substr(0,u.length-1))),u);const m=h[4]||h[6];if(!n.leadingZeros&&i.length>0&&c&&o[2]!=="."||!n.leadingZeros&&i.length>0&&!c&&o[1]!==".")return a;{const b=Number(o),v=""+b;return v.search(/[eE]/)!==-1||m?n.eNotation?b:a:o.indexOf(".")!==-1?v==="0"&&f===""||v===f||c&&v==="-"+f?b:a:i?f===v||c+f===v?b:a:o===v||o===c+v?b:a}}return a}var u}},737:(r,e,t)=>{var s=t(670),a=t(647),n=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o=/[\n\r\t]/g,u=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,h=/:\d+$/,c=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,i=/^[a-zA-Z]:/;function f(p){return(p||"").toString().replace(n,"")}var m=[["#","hash"],["?","query"],function(p,S){return w(S.protocol)?p.replace(/\\/g,"/"):p},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],b={hash:1,query:1};function v(p){var S,I=(typeof window<"u"?window:typeof _t<"u"?_t:typeof self<"u"?self:{}).location||{},P={},x=typeof(p=p||I);if(p.protocol==="blob:")P=new k(unescape(p.pathname),{});else if(x==="string")for(S in P=new k(p,{}),b)delete P[S];else if(x==="object"){for(S in p)S in b||(P[S]=p[S]);P.slashes===void 0&&(P.slashes=u.test(p.href))}return P}function w(p){return p==="file:"||p==="ftp:"||p==="http:"||p==="https:"||p==="ws:"||p==="wss:"}function y(p,S){p=(p=f(p)).replace(o,""),S=S||{};var I,P=c.exec(p),x=P[1]?P[1].toLowerCase():"",T=!!P[2],B=!!P[3],V=0;return T?B?(I=P[2]+P[3]+P[4],V=P[2].length+P[3].length):(I=P[2]+P[4],V=P[2].length):B?(I=P[3]+P[4],V=P[3].length):I=P[4],x==="file:"?V>=2&&(I=I.slice(2)):w(x)?I=P[4]:x?T&&(I=I.slice(2)):V>=2&&w(S.protocol)&&(I=P[4]),{protocol:x,slashes:T||w(x),slashesCount:V,rest:I}}function k(p,S,I){if(p=(p=f(p)).replace(o,""),!(this instanceof k))return new k(p,S,I);var P,x,T,B,V,J,F=m.slice(),D=typeof S,j=this,te=0;for(D!=="object"&&D!=="string"&&(I=S,S=null),I&&typeof I!="function"&&(I=a.parse),P=!(x=y(p||"",S=v(S))).protocol&&!x.slashes,j.slashes=x.slashes||P&&S.slashes,j.protocol=x.protocol||S.protocol||"",p=x.rest,(x.protocol==="file:"&&(x.slashesCount!==2||i.test(p))||!x.slashes&&(x.protocol||x.slashesCount<2||!w(j.protocol)))&&(F[3]=[/(.*)/,"pathname"]);te<F.length;te++)typeof(B=F[te])!="function"?(T=B[0],J=B[1],T!=T?j[J]=p:typeof T=="string"?~(V=T==="@"?p.lastIndexOf(T):p.indexOf(T))&&(typeof B[2]=="number"?(j[J]=p.slice(0,V),p=p.slice(V+B[2])):(j[J]=p.slice(V),p=p.slice(0,V))):(V=T.exec(p))&&(j[J]=V[1],p=p.slice(0,V.index)),j[J]=j[J]||P&&B[3]&&S[J]||"",B[4]&&(j[J]=j[J].toLowerCase())):p=B(p,j);I&&(j.query=I(j.query)),P&&S.slashes&&j.pathname.charAt(0)!=="/"&&(j.pathname!==""||S.pathname!=="")&&(j.pathname=function(Y,oe){if(Y==="")return oe;for(var ne=(oe||"/").split("/").slice(0,-1).concat(Y.split("/")),de=ne.length,ie=ne[de-1],re=!1,se=0;de--;)ne[de]==="."?ne.splice(de,1):ne[de]===".."?(ne.splice(de,1),se++):se&&(de===0&&(re=!0),ne.splice(de,1),se--);return re&&ne.unshift(""),ie!=="."&&ie!==".."||ne.push(""),ne.join("/")}(j.pathname,S.pathname)),j.pathname.charAt(0)!=="/"&&w(j.protocol)&&(j.pathname="/"+j.pathname),s(j.port,j.protocol)||(j.host=j.hostname,j.port=""),j.username=j.password="",j.auth&&(~(V=j.auth.indexOf(":"))?(j.username=j.auth.slice(0,V),j.username=encodeURIComponent(decodeURIComponent(j.username)),j.password=j.auth.slice(V+1),j.password=encodeURIComponent(decodeURIComponent(j.password))):j.username=encodeURIComponent(decodeURIComponent(j.auth)),j.auth=j.password?j.username+":"+j.password:j.username),j.origin=j.protocol!=="file:"&&w(j.protocol)&&j.host?j.protocol+"//"+j.host:"null",j.href=j.toString()}k.prototype={set:function(p,S,I){var P=this;switch(p){case"query":typeof S=="string"&&S.length&&(S=(I||a.parse)(S)),P[p]=S;break;case"port":P[p]=S,s(S,P.protocol)?S&&(P.host=P.hostname+":"+S):(P.host=P.hostname,P[p]="");break;case"hostname":P[p]=S,P.port&&(S+=":"+P.port),P.host=S;break;case"host":P[p]=S,h.test(S)?(S=S.split(":"),P.port=S.pop(),P.hostname=S.join(":")):(P.hostname=S,P.port="");break;case"protocol":P.protocol=S.toLowerCase(),P.slashes=!I;break;case"pathname":case"hash":if(S){var x=p==="pathname"?"/":"#";P[p]=S.charAt(0)!==x?x+S:S}else P[p]=S;break;case"username":case"password":P[p]=encodeURIComponent(S);break;case"auth":var T=S.indexOf(":");~T?(P.username=S.slice(0,T),P.username=encodeURIComponent(decodeURIComponent(P.username)),P.password=S.slice(T+1),P.password=encodeURIComponent(decodeURIComponent(P.password))):P.username=encodeURIComponent(decodeURIComponent(S))}for(var B=0;B<m.length;B++){var V=m[B];V[4]&&(P[V[1]]=P[V[1]].toLowerCase())}return P.auth=P.password?P.username+":"+P.password:P.username,P.origin=P.protocol!=="file:"&&w(P.protocol)&&P.host?P.protocol+"//"+P.host:"null",P.href=P.toString(),P},toString:function(p){p&&typeof p=="function"||(p=a.stringify);var S,I=this,P=I.host,x=I.protocol;x&&x.charAt(x.length-1)!==":"&&(x+=":");var T=x+(I.protocol&&I.slashes||w(I.protocol)?"//":"");return I.username?(T+=I.username,I.password&&(T+=":"+I.password),T+="@"):I.password?(T+=":"+I.password,T+="@"):I.protocol!=="file:"&&w(I.protocol)&&!P&&I.pathname!=="/"&&(T+="@"),(P[P.length-1]===":"||h.test(I.hostname)&&!I.port)&&(P+=":"),T+=P+I.pathname,(S=typeof I.query=="object"?p(I.query):I.query)&&(T+=S.charAt(0)!=="?"?"?"+S:S),I.hash&&(T+=I.hash),T}},k.extractProtocol=y,k.location=v,k.trimLeft=f,k.qs=a,r.exports=k},410:()=>{},388:()=>{},805:()=>{},345:()=>{},800:()=>{}},od={};function Ve(r){var e=od[r];if(e!==void 0)return e.exports;var t=od[r]={id:r,loaded:!1,exports:{}};return By[r].call(t.exports,t,t.exports,Ve),t.loaded=!0,t.exports}Ve.n=r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return Ve.d(e,{a:e}),e},Ve.d=(r,e)=>{for(var t in e)Ve.o(e,t)&&!Ve.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},Ve.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),Ve.nmd=r=>(r.paths=[],r.children||(r.children=[]),r);var fs={};Ve.d(fs,{hT:()=>jt,O4:()=>hr,Kd:()=>$y,YK:()=>Ky,UU:()=>W0,Gu:()=>Ug,ky:()=>_g,h4:()=>xc,ch:()=>gm,hq:()=>Qn,i5:()=>Gg});var Oy=Ve(737),Py=Ve.n(Oy);function xm(r){if(!Uf(r))throw new Error("Parameter was not an error")}function Uf(r){return!!r&&typeof r=="object"&&(e=r,Object.prototype.toString.call(e)==="[object Error]")||r instanceof Error;var e}class Mt extends Error{constructor(e,t){const s=[...arguments],{options:a,shortMessage:n}=function(u){let h,c="";if(u.length===0)h={};else if(Uf(u[0]))h={cause:u[0]},c=u.slice(1).join(" ")||"";else if(u[0]&&typeof u[0]=="object")h=Object.assign({},u[0]),c=u.slice(1).join(" ")||"";else{if(typeof u[0]!="string")throw new Error("Invalid arguments passed to Layerr");h={},c=c=u.join(" ")||""}return{options:h,shortMessage:c}}(s);let o=n;if(a.cause&&(o="".concat(o,": ").concat(a.cause.message)),super(o),this.message=o,a.name&&typeof a.name=="string"?this.name=a.name:this.name="Layerr",a.cause&&Object.defineProperty(this,"_cause",{value:a.cause}),Object.defineProperty(this,"_info",{value:{}}),a.info&&typeof a.info=="object"&&Object.assign(this._info,a.info),Error.captureStackTrace){const u=a.constructorOpt||this.constructor;Error.captureStackTrace(this,u)}}static cause(e){return xm(e),e._cause&&Uf(e._cause)?e._cause:null}static fullStack(e){var s;xm(e);const t=Mt.cause(e);return t?"".concat(e.stack,"\ncaused by: ").concat(Mt.fullStack(t)):(s=e.stack)!=null?s:""}static info(e){xm(e);const t={},s=Mt.cause(e);return s&&Object.assign(t,Mt.info(s)),e._info&&Object.assign(t,e._info),t}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e="".concat(e,": ").concat(this.message)),e}}var Dy=Ve(47),Gh=Ve.n(Dy);const ud="__PATH_SEPARATOR_POSIX__",ld="__PATH_SEPARATOR_WINDOWS__";function Ke(r){try{const e=r.replace(/\//g,ud).replace(/\\\\/g,ld);return encodeURIComponent(e).split(ld).join("\\\\").split(ud).join("/")}catch(e){throw new Mt(e,"Failed encoding path")}}function cd(r){return r.startsWith("/")?r:"/"+r}function bc(r){let e=r;return e[0]!=="/"&&(e="/"+e),/^.+\/$/.test(e)&&(e=e.substr(0,e.length-1)),e}function Ty(r){let e=new(Py())(r).pathname;return e.length<=0&&(e="/"),bc(e)}function Me(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return function(){return function(s){var a=[];if(s.length===0)return"";if(typeof s[0]!="string")throw new TypeError("Url must be a string. Received "+s[0]);if(s[0].match(/^[^/:]+:\/*$/)&&s.length>1){var n=s.shift();s[0]=n+s[0]}s[0].match(/^file:\/\/\//)?s[0]=s[0].replace(/^([^/:]+):\/*/,"$1:///"):s[0]=s[0].replace(/^([^/:]+):\/*/,"$1://");for(var o=0;o<s.length;o++){var u=s[o];if(typeof u!="string")throw new TypeError("Url must be a string. Received "+u);u!==""&&(o>0&&(u=u.replace(/^[\/]+/,"")),u=o<s.length-1?u.replace(/[\/]+$/,""):u.replace(/[\/]+$/,"/"),a.push(u))}var h=a.join("/"),c=(h=h.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return c.shift()+(c.length>0?"?":"")+c.join("&")}(typeof arguments[0]=="object"?arguments[0]:[].slice.call(arguments))}(e.reduce((s,a,n)=>((n===0||a!=="/"||a==="/"&&s[s.length-1]!=="/")&&s.push(a),s),[]))}var Ry=Ve(542),eu=Ve.n(Ry);const Uy="abcdef0123456789";function hd(r,e){const t=r.url.replace("//",""),s=t.indexOf("/")==-1?"/":t.slice(t.indexOf("/")),a=r.method?r.method.toUpperCase():"GET",n=!!/(^|,)\s*auth\s*($|,)/.test(e.qop)&&"auth",o="00000000".concat(e.nc).slice(-8),u=function(m,b,v,w,y,k,p){const S=p||eu()("".concat(b,":").concat(v,":").concat(w));return m&&m.toLowerCase()==="md5-sess"?eu()("".concat(S,":").concat(y,":").concat(k)):S}(e.algorithm,e.username,e.realm,e.password,e.nonce,e.cnonce,e.ha1),h=eu()("".concat(a,":").concat(s)),c=n?eu()("".concat(u,":").concat(e.nonce,":").concat(o,":").concat(e.cnonce,":").concat(n,":").concat(h)):eu()("".concat(u,":").concat(e.nonce,":").concat(h)),i={username:e.username,realm:e.realm,nonce:e.nonce,uri:s,qop:n,response:c,nc:o,cnonce:e.cnonce,algorithm:e.algorithm,opaque:e.opaque},f=[];for(const m in i)i[m]&&(m==="qop"||m==="nc"||m==="algorithm"?f.push("".concat(m,"=").concat(i[m])):f.push("".concat(m,'="').concat(i[m],'"')));return"Digest ".concat(f.join(", "))}function Dg(r){return(r.headers&&r.headers.get("www-authenticate")||"").split(/\s/)[0].toLowerCase()==="digest"}var Ly=Ve(101),Tg=Ve.n(Ly);function md(r){return Tg().decode(r)}function fd(r,e){var t;return"Basic ".concat((t="".concat(r,":").concat(e),Tg().encode(t)))}const zh=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:typeof window<"u"?window:globalThis,jy=zh.fetch.bind(zh),$y=zh.Request,Ky=zh.Response;let jt=function(r){return r.Auto="auto",r.Digest="digest",r.None="none",r.Password="password",r.Token="token",r}({}),hr=function(r){return r.DataTypeNoLength="data-type-no-length",r.InvalidAuthType="invalid-auth-type",r.InvalidOutputFormat="invalid-output-format",r.LinkUnsupportedAuthType="link-unsupported-auth",r.InvalidUpdateRange="invalid-update-range",r.NotSupported="not-supported",r}({});function Rg(r,e,t,s,a){switch(r.authType){case jt.Auto:e&&t&&(r.headers.Authorization=fd(e,t));break;case jt.Digest:r.digest=function(o,u,h){return{username:o,password:u,ha1:h,nc:0,algorithm:"md5",hasDigestAuth:!1}}(e,t,a);break;case jt.None:break;case jt.Password:r.headers.Authorization=fd(e,t);break;case jt.Token:r.headers.Authorization="".concat((n=s).token_type," ").concat(n.access_token);break;default:throw new Mt({info:{code:hr.InvalidAuthType}},"Invalid auth type: ".concat(r.authType))}var n}Ve(345),Ve(800);const pd="@@HOTPATCHER",My=()=>{};function Bm(r){return{original:r,methods:[r],final:!1}}class Hy{constructor(){this._configuration={registry:{},getEmptyAction:"null"},this.__type__=pd}get configuration(){return this._configuration}get getEmptyAction(){return this.configuration.getEmptyAction}set getEmptyAction(e){this.configuration.getEmptyAction=e}control(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e||e.__type__!==pd)throw new Error("Failed taking control of target HotPatcher instance: Invalid type or object");return Object.keys(e.configuration.registry).forEach(s=>{this.configuration.registry.hasOwnProperty(s)?t&&(this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])):this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])}),e._configuration=this.configuration,this}execute(e){const t=this.get(e)||My;for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];return t(...a)}get(e){const t=this.configuration.registry[e];if(!t)switch(this.getEmptyAction){case"null":return null;case"throw":throw new Error("Failed handling method request: No method provided for override: ".concat(e));default:throw new Error("Failed handling request which resulted in an empty method: Invalid empty-action specified: ".concat(this.getEmptyAction))}return function(){for(var s=arguments.length,a=new Array(s),n=0;n<s;n++)a[n]=arguments[n];if(a.length===0)throw new Error("Failed creating sequence: No functions provided");return function(){for(var o=arguments.length,u=new Array(o),h=0;h<o;h++)u[h]=arguments[h];let c=u;const i=this;for(;a.length>0;)c=[a.shift().apply(i,c)];return c[0]}}(...t.methods)}isPatched(e){return!!this.configuration.registry[e]}patch(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{chain:a=!1}=s;if(this.configuration.registry[e]&&this.configuration.registry[e].final)throw new Error("Failed patching '".concat(e,"': Method marked as being final"));if(typeof t!="function")throw new Error("Failed patching '".concat(e,"': Provided method is not a function"));if(a)this.configuration.registry[e]?this.configuration.registry[e].methods.push(t):this.configuration.registry[e]=Bm(t);else if(this.isPatched(e)){const{original:n}=this.configuration.registry[e];this.configuration.registry[e]=Object.assign(Bm(t),{original:n})}else this.configuration.registry[e]=Bm(t);return this}patchInline(e,t){this.isPatched(e)||this.patch(e,t);for(var s=arguments.length,a=new Array(s>2?s-2:0),n=2;n<s;n++)a[n-2]=arguments[n];return this.execute(e,...a)}plugin(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return s.forEach(n=>{this.patch(e,n,{chain:!0})}),this}restore(e){if(!this.isPatched(e))throw new Error("Failed restoring method: No method present for key: ".concat(e));if(typeof this.configuration.registry[e].original!="function")throw new Error("Failed restoring method: Original method not found or of invalid type for key: ".concat(e));return this.configuration.registry[e].methods=[this.configuration.registry[e].original],this}setFinal(e){if(!this.configuration.registry.hasOwnProperty(e))throw new Error("Failed marking '".concat(e,"' as final: No method found for key"));return this.configuration.registry[e].final=!0,this}}let Om=null;function Ug(){return Om||(Om=new Hy),Om}function Xh(r){return function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(r)?Object.assign({},r):Object.setPrototypeOf(Object.assign({},r),Object.getPrototypeOf(r))}function dd(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let s=null,a=[...e];for(;a.length>0;){const n=a.shift();s=s?Lg(s,n):Xh(n)}return s}function Lg(r,e){const t=Xh(r);return Object.keys(e).forEach(s=>{t.hasOwnProperty(s)?Array.isArray(e[s])?t[s]=Array.isArray(t[s])?[...t[s],...e[s]]:[...e[s]]:typeof e[s]=="object"&&e[s]?t[s]=typeof t[s]=="object"&&t[s]?Lg(t[s],e[s]):Xh(e[s]):t[s]=e[s]:t[s]=e[s]}),t}function Fy(r){const e={};for(const t of r.keys())e[t]=r.get(t);return e}function Lf(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(e.length===0)return{};const s={};return e.reduce((a,n)=>(Object.keys(n).forEach(o=>{const u=o.toLowerCase();s.hasOwnProperty(u)?a[s[u]]=n[o]:(s[u]=o,a[o]=n[o])}),a),{})}Ve(805);const Jy=typeof ArrayBuffer=="function",{toString:qy}=Object.prototype;function jg(r){return Jy&&(r instanceof ArrayBuffer||qy.call(r)==="[object ArrayBuffer]")}function $g(r){return r!=null&&r.constructor!=null&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function wp(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function jf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Kg=wp(function(r){const e=r._digest;return delete r._digest,e.hasDigestAuth&&(r=dd(r,{headers:{Authorization:hd(r,e)}})),jf(Yh(r),function(t){let s=!1;return a=function(o){return s?o:t},(n=function(){if(t.status==401)return e.hasDigestAuth=function(o,u){if(!Dg(o))return!1;const h=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;for(;;){const c=o.headers&&o.headers.get("www-authenticate")||"",i=h.exec(c);if(!i)break;u[i[1]]=i[2]||i[3]}return u.nc+=1,u.cnonce=function(){let c="";for(let i=0;i<32;++i)c="".concat(c).concat(Uy[Math.floor(16*Math.random())]);return c}(),!0}(t,e),function(){if(e.hasDigestAuth)return jf(Yh(r=dd(r,{headers:{Authorization:hd(r,e)}})),function(o){return o.status==401?e.hasDigestAuth=!1:e.nc++,s=!0,o})}();e.nc++}())&&n.then?n.then(a):a(n);var a,n})}),Wy=wp(function(r,e){return jf(Yh(r),function(t){return t.ok?(e.authType=jt.Password,t):t.status==401&&Dg(t)?(e.authType=jt.Digest,Rg(e,e.username,e.password,void 0,void 0),r._digest=e.digest,Kg(r)):t})}),mt=wp(function(r,e){return e.authType===jt.Auto?Wy(r,e):r._digest?Kg(r):Yh(r)});function ft(r,e,t){const s=Xh(r);return s.headers=Lf(e.headers,s.headers||{},t.headers||{}),t.data!==void 0&&(s.data=t.data),t.signal&&(s.signal=t.signal),e.httpAgent&&(s.httpAgent=e.httpAgent),e.httpsAgent&&(s.httpsAgent=e.httpsAgent),e.digest&&(s._digest=e.digest),typeof e.withCredentials=="boolean"&&(s.withCredentials=e.withCredentials),s}function Yh(r){const e=Ug();return e.patchInline("request",t=>e.patchInline("fetch",jy,t.url,function(s){let a={};const n={method:s.method};if(s.headers&&(a=Lf(a,s.headers)),s.data!==void 0){const[o,u]=function(h){if(typeof h=="string")return[h,{}];if($g(h))return[h,{}];if(jg(h))return[h,{}];if(h&&typeof h=="object")return[JSON.stringify(h),{"content-type":"application/json"}];throw new Error("Unable to convert request body: Unexpected body type: "+typeof h)}(s.data);n.body=o,a=Lf(a,u)}return s.signal&&(n.signal=s.signal),s.withCredentials&&(n.credentials="include"),n.headers=a,n}(t)),r)}var _y=Ve(285);const Qh=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>65536)throw new TypeError("pattern is too long")},Gy={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},tu=r=>r.replace(/[[\]\\-]/g,"\\$&"),gd=r=>r.join(""),zy=(r,e)=>{const t=e;if(r.charAt(t)!=="[")throw new Error("not in a brace expression");const s=[],a=[];let n=t+1,o=!1,u=!1,h=!1,c=!1,i=t,f="";e:for(;n<r.length;){const w=r.charAt(n);if(w!=="!"&&w!=="^"||n!==t+1){if(w==="]"&&o&&!h){i=n+1;break}if(o=!0,w!=="\\"||h){if(w==="["&&!h){for(const[y,[k,p,S]]of Object.entries(Gy))if(r.startsWith(y,n)){if(f)return["$.",!1,r.length-t,!0];n+=y.length,S?a.push(k):s.push(k),u=u||p;continue e}}h=!1,f?(w>f?s.push(tu(f)+"-"+tu(w)):w===f&&s.push(tu(w)),f="",n++):r.startsWith("-]",n+1)?(s.push(tu(w+"-")),n+=2):r.startsWith("-",n+1)?(f=w,n+=2):(s.push(tu(w)),n++)}else h=!0,n++}else c=!0,n++}if(i<n)return["",!1,0,!1];if(!s.length&&!a.length)return["$.",!1,r.length-t,!0];if(a.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!c)return[(m=s[0].length===2?s[0].slice(-1):s[0],m.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,i-t,!1];var m;const b="["+(c?"^":"")+gd(s)+"]",v="["+(c?"":"^")+gd(a)+"]";return[s.length&&a.length?"("+b+"|"+v+")":s.length?b:v,u,i-t,!0]},gu=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/\[([^\/\\])\]/g,"$1"):r.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1")},Xy=new Set(["!","?","+","*","@"]),wd=r=>Xy.has(r),Pm="(?!\\.)",Yy=new Set(["[","."]),Qy=new Set(["..","."]),Zy=new Set("().*{}+?[]^$\\!"),yp="[^/]",yd=yp+"*?",vd=yp+"+?";var ut,gt,Zs,Re,st,ma,$n,fa,Os,Kn,Vc,Yn,Mg,ka,mh,$f,Hg;const Dt=class Dt{constructor(e,t){qt(this,Yn);tt(this,"type");qt(this,ut);qt(this,gt);qt(this,Zs,!1);qt(this,Re,[]);qt(this,st);qt(this,ma);qt(this,$n);qt(this,fa,!1);qt(this,Os);qt(this,Kn);qt(this,Vc,!1);let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.type=e,e&&qe(this,gt,!0),qe(this,st,t),qe(this,ut,Z(this,st)?Z(Z(this,st),ut):this),qe(this,Os,Z(this,ut)===this?s:Z(Z(this,ut),Os)),qe(this,$n,Z(this,ut)===this?[]:Z(Z(this,ut),$n)),e!=="!"||Z(Z(this,ut),fa)||Z(this,$n).push(this),qe(this,ma,Z(this,st)?Z(Z(this,st),Re).length:0)}get hasMagic(){if(Z(this,gt)!==void 0)return Z(this,gt);for(const e of Z(this,Re))if(typeof e!="string"&&(e.type||e.hasMagic))return qe(this,gt,!0);return Z(this,gt)}toString(){return Z(this,Kn)!==void 0?Z(this,Kn):this.type?qe(this,Kn,this.type+"("+Z(this,Re).map(e=>String(e)).join("|")+")"):qe(this,Kn,Z(this,Re).map(e=>String(e)).join(""))}push(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];for(const a of t)if(a!==""){if(typeof a!="string"&&!(a instanceof Dt&&Z(a,st)===this))throw new Error("invalid part: "+a);Z(this,Re).push(a)}}toJSON(){var t;const e=this.type===null?Z(this,Re).slice().map(s=>typeof s=="string"?s:s.toJSON()):[this.type,...Z(this,Re).map(s=>s.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===Z(this,ut)||Z(Z(this,ut),fa)&&((t=Z(this,st))==null?void 0:t.type)==="!")&&e.push({}),e}isStart(){var t;if(Z(this,ut)===this)return!0;if(!((t=Z(this,st))!=null&&t.isStart()))return!1;if(Z(this,ma)===0)return!0;const e=Z(this,st);for(let s=0;s<Z(this,ma);s++){const a=Z(e,Re)[s];if(!(a instanceof Dt&&a.type==="!"))return!1}return!0}isEnd(){var t,s,a;if(Z(this,ut)===this||((t=Z(this,st))==null?void 0:t.type)==="!")return!0;if(!((s=Z(this,st))!=null&&s.isEnd()))return!1;if(!this.type)return(a=Z(this,st))==null?void 0:a.isEnd();const e=Z(this,st)?Z(Z(this,st),Re).length:0;return Z(this,ma)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new Dt(this.type,e);for(const s of Z(this,Re))t.copyIn(s);return t}static fromGlob(e){var a;let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new Dt(null,void 0,t);return pr(a=Dt,ka,mh).call(a,e,s,0,t),s}toMMPattern(){if(this!==Z(this,ut))return Z(this,ut).toMMPattern();const e=this.toString(),[t,s,a,n]=this.toRegExpSource();if(!(a||Z(this,gt)||Z(this,Os).nocase&&!Z(this,Os).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;const o=(Z(this,Os).nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp("^".concat(t,"$"),o),{_src:t,_glob:e})}get options(){return Z(this,Os)}toRegExpSource(e){var h;const t=e!=null?e:!!Z(this,Os).dot;if(Z(this,ut)===this&&pr(this,Yn,Mg).call(this),!this.type){const c=this.isStart()&&this.isEnd(),i=Z(this,Re).map(b=>{var p;const[v,w,y,k]=typeof b=="string"?pr(p=Dt,ka,Hg).call(p,b,Z(this,gt),c):b.toRegExpSource(e);return qe(this,gt,Z(this,gt)||y),qe(this,Zs,Z(this,Zs)||k),v}).join("");let f="";if(this.isStart()&&typeof Z(this,Re)[0]=="string"&&(Z(this,Re).length!==1||!Qy.has(Z(this,Re)[0]))){const b=Yy,v=t&&b.has(i.charAt(0))||i.startsWith("\\.")&&b.has(i.charAt(2))||i.startsWith("\\.\\.")&&b.has(i.charAt(4)),w=!t&&!e&&b.has(i.charAt(0));f=v?"(?!(?:^|/)\\.\\.?(?:$|/))":w?Pm:""}let m="";return this.isEnd()&&Z(Z(this,ut),fa)&&((h=Z(this,st))==null?void 0:h.type)==="!"&&(m="(?:$|\\/)"),[f+i+m,gu(i),qe(this,gt,!!Z(this,gt)),Z(this,Zs)]}const s=this.type==="*"||this.type==="+",a=this.type==="!"?"(?:(?!(?:":"(?:";let n=pr(this,Yn,$f).call(this,t);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){const c=this.toString();return qe(this,Re,[c]),this.type=null,qe(this,gt,void 0),[c,gu(this.toString()),!1,!1]}let o=!s||e||t?"":pr(this,Yn,$f).call(this,!0);o===n&&(o=""),o&&(n="(?:".concat(n,")(?:").concat(o,")*?"));let u="";return u=this.type==="!"&&Z(this,Vc)?(this.isStart()&&!t?Pm:"")+vd:a+n+(this.type==="!"?"))"+(!this.isStart()||t||e?"":Pm)+yd+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&o?")":this.type==="*"&&o?")?":")".concat(this.type)),[u,gu(n),qe(this,gt,!!Z(this,gt)),Z(this,Zs)]}};ut=new WeakMap,gt=new WeakMap,Zs=new WeakMap,Re=new WeakMap,st=new WeakMap,ma=new WeakMap,$n=new WeakMap,fa=new WeakMap,Os=new WeakMap,Kn=new WeakMap,Vc=new WeakMap,Yn=new WeakSet,Mg=function(){if(this!==Z(this,ut))throw new Error("should only call on root");if(Z(this,fa))return this;let e;for(this.toString(),qe(this,fa,!0);e=Z(this,$n).pop();){if(e.type!=="!")continue;let t=e,s=Z(t,st);for(;s;){for(let a=Z(t,ma)+1;!s.type&&a<Z(s,Re).length;a++)for(const n of Z(e,Re)){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(Z(s,Re)[a])}t=s,s=Z(t,st)}}return this},ka=new WeakSet,mh=function(e,t,s,a){var b,v;let n=!1,o=!1,u=-1,h=!1;if(t.type===null){let w=s,y="";for(;w<e.length;){const k=e.charAt(w++);if(n||k==="\\")n=!n,y+=k;else if(o)w===u+1?k!=="^"&&k!=="!"||(h=!0):k!=="]"||w===u+2&&h||(o=!1),y+=k;else if(k!=="[")if(a.noext||!wd(k)||e.charAt(w)!=="(")y+=k;else{t.push(y),y="";const p=new Dt(k,t);w=pr(b=Dt,ka,mh).call(b,e,p,w,a),t.push(p)}else o=!0,u=w,h=!1,y+=k}return t.push(y),w}let c=s+1,i=new Dt(null,t);const f=[];let m="";for(;c<e.length;){const w=e.charAt(c++);if(n||w==="\\")n=!n,m+=w;else if(o)c===u+1?w!=="^"&&w!=="!"||(h=!0):w!=="]"||c===u+2&&h||(o=!1),m+=w;else if(w!=="[")if(wd(w)&&e.charAt(c)==="("){i.push(m),m="";const y=new Dt(w,i);i.push(y),c=pr(v=Dt,ka,mh).call(v,e,y,c,a)}else if(w!=="|"){if(w===")")return m===""&&Z(t,Re).length===0&&qe(t,Vc,!0),i.push(m),m="",t.push(...f,i),c;m+=w}else i.push(m),m="",f.push(i),i=new Dt(null,t);else o=!0,u=c,h=!1,m+=w}return t.type=null,qe(t,gt,void 0),qe(t,Re,[e.substring(s-1)]),c},$f=function(e){return Z(this,Re).map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[s,a,n,o]=t.toRegExpSource(e);return qe(this,Zs,Z(this,Zs)||o),s}).filter(t=>!(this.isStart()&&this.isEnd()&&!t)).join("|")},Hg=function(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=!1,n="",o=!1;for(let u=0;u<e.length;u++){const h=e.charAt(u);if(a)a=!1,n+=(Zy.has(h)?"\\":"")+h;else if(h!=="\\"){if(h==="["){const[c,i,f,m]=zy(e,u);if(f){n+=c,o=o||i,u+=f-1,t=t||m;continue}}h!=="*"?h!=="?"?n+=h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(n+=yp,t=!0):(n+=s&&e==="*"?vd:yd,t=!0)}else u===e.length-1?n+="\\\\":a=!0}return[n,gu(e),!!t,o]},qt(Dt,ka);let Zh=Dt;const Pt=function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Qh(e),!(!t.nocomment&&e.charAt(0)==="#")&&new em(e,t).match(r)},e0=/^\*+([^+@!?\*\[\(]*)$/,t0=r=>e=>!e.startsWith(".")&&e.endsWith(r),s0=r=>e=>e.endsWith(r),r0=r=>(r=r.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(r)),a0=r=>(r=r.toLowerCase(),e=>e.toLowerCase().endsWith(r)),n0=/^\*+\.\*+$/,i0=r=>!r.startsWith(".")&&r.includes("."),o0=r=>r!=="."&&r!==".."&&r.includes("."),u0=/^\.\*+$/,l0=r=>r!=="."&&r!==".."&&r.startsWith("."),c0=/^\*+$/,h0=r=>r.length!==0&&!r.startsWith("."),m0=r=>r.length!==0&&r!=="."&&r!=="..",f0=/^\?+([^+@!?\*\[\(]*)?$/,p0=r=>{let[e,t=""]=r;const s=Fg([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},d0=r=>{let[e,t=""]=r;const s=Jg([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},g0=r=>{let[e,t=""]=r;const s=Jg([e]);return t?a=>s(a)&&a.endsWith(t):s},w0=r=>{let[e,t=""]=r;const s=Fg([e]);return t?a=>s(a)&&a.endsWith(t):s},Fg=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&!s.startsWith(".")},Jg=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&s!=="."&&s!==".."},qg=typeof lt=="object"&&lt?typeof Vm=="object"&&Vm&&Vm.__MINIMATCH_TESTING_PLATFORM__||lt.platform:"posix";Pt.sep=qg==="win32"?"\\":"/";const ns=Symbol("globstar **");Pt.GLOBSTAR=ns,Pt.filter=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return t=>Pt(t,r,e)};const rs=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.assign({},r,e)};Pt.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return Pt;const e=Pt;return Object.assign(function(t,s){return e(t,s,rs(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))},{Minimatch:class extends e.Minimatch{constructor(t){super(t,rs(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}))}static defaults(t){return e.defaults(rs(r,t)).Minimatch}},AST:class extends e.AST{constructor(t,s){super(t,s,rs(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))}static fromGlob(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.AST.fromGlob(t,rs(r,s))}},unescape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.unescape(t,rs(r,s))},escape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.escape(t,rs(r,s))},filter:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.filter(t,rs(r,s))},defaults:t=>e.defaults(rs(r,t)),makeRe:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.makeRe(t,rs(r,s))},braceExpand:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.braceExpand(t,rs(r,s))},match:function(t,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e.match(t,s,rs(r,a))},sep:e.sep,GLOBSTAR:ns})};const Wg=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Qh(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:_y(r)};Pt.braceExpand=Wg,Pt.makeRe=function(r){return new em(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).makeRe()},Pt.match=function(r,e){const t=new em(e,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{});return r=r.filter(s=>t.match(s)),t.options.nonull&&!r.length&&r.push(e),r};const bd=/[?*]|[+@!]\(.*?\)|\[|\]/;class em{constructor(e){tt(this,"options");tt(this,"set");tt(this,"pattern");tt(this,"windowsPathsNoEscape");tt(this,"nonegate");tt(this,"negate");tt(this,"comment");tt(this,"empty");tt(this,"preserveMultipleSlashes");tt(this,"partial");tt(this,"globSet");tt(this,"globParts");tt(this,"nocase");tt(this,"isWindows");tt(this,"platform");tt(this,"windowsNoMagicRoot");tt(this,"regexp");let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Qh(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||qg,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#")return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=function(){return console.error(...arguments)}),this.debug(this.pattern,this.globSet);const s=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let a=this.globParts.map((n,o,u)=>{if(this.isWindows&&this.windowsNoMagicRoot){const h=!(n[0]!==""||n[1]!==""||n[2]!=="?"&&bd.test(n[2])||bd.test(n[3])),c=/^[a-z]:/i.test(n[0]);if(h)return[...n.slice(0,4),...n.slice(4).map(i=>this.parse(i))];if(c)return[n[0],...n.slice(1).map(i=>this.parse(i))]}return n.map(h=>this.parse(h))});if(this.debug(this.pattern,a),this.set=a.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){const o=this.set[n];o[0]===""&&o[1]===""&&this.globParts[n][2]==="?"&&typeof o[3]=="string"&&/^[a-z]:$/i.test(o[3])&&(o[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)e[s][a]==="**"&&(e[s][a]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let a=s;for(;t[a+1]==="**";)a++;a!==s&&t.splice(s,a-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,a)=>{const n=s[s.length-1];return a==="**"&&n==="**"?s:a===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(s.pop(),s):(s.push(a),s)},[])).length===0?[""]:t)}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let a=1;a<e.length-1;a++){const n=e[a];a===1&&n===""&&e[0]===""||n!=="."&&n!==""||(t=!0,e.splice(a,1),a--)}e[0]!=="."||e.length!==2||e[1]!=="."&&e[1]!==""||(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){const a=e[s-1];a&&a!=="."&&a!==".."&&a!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let a=-1;for(;(a=s.indexOf("**",a+1))!==-1;){let o=a;for(;s[o+1]==="**";)o++;o>a&&s.splice(a+1,o-a);let u=s[a+1];const h=s[a+2],c=s[a+3];if(u!==".."||!h||h==="."||h===".."||!c||c==="."||c==="..")continue;t=!0,s.splice(a,1);const i=s.slice(0);i[a]="**",e.push(i),a--}if(!this.preserveMultipleSlashes){for(let o=1;o<s.length-1;o++){const u=s[o];o===1&&u===""&&s[0]===""||u!=="."&&u!==""||(t=!0,s.splice(o,1),o--)}s[0]!=="."||s.length!==2||s[1]!=="."&&s[1]!==""||(t=!0,s.pop())}let n=0;for(;(n=s.indexOf("..",n+1))!==-1;){const o=s[n-1];if(o&&o!=="."&&o!==".."&&o!=="**"){t=!0;const u=n===1&&s[n+1]==="**"?["."]:[];s.splice(n-1,2,...u),s.length===0&&s.push(""),n-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){const a=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(a){e[t]=[],e[s]=a;break}}return e.filter(t=>t.length)}partsMatch(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=0,n=0,o=[],u="";for(;a<e.length&&n<t.length;)if(e[a]===t[n])o.push(u==="b"?t[n]:e[a]),a++,n++;else if(s&&e[a]==="**"&&t[n]===e[a+1])o.push(e[a]),a++;else if(s&&t[n]==="**"&&e[a]===t[n+1])o.push(t[n]),n++;else if(e[a]!=="*"||!t[n]||!this.options.dot&&t[n].startsWith(".")||t[n]==="**"){if(t[n]!=="*"||!e[a]||!this.options.dot&&e[a].startsWith(".")||e[a]==="**"||u==="a")return!1;u="b",o.push(t[n]),a++,n++}else{if(u==="b")return!1;u="a",o.push(e[a]),a++,n++}return e.length===t.length&&o}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let a=0;a<e.length&&e.charAt(a)==="!";a++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const a=this.options;if(this.isWindows){const w=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),y=!w&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),k=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),p=y?3:w?0:void 0,S=!k&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3])?3:k?0:void 0;if(typeof p=="number"&&typeof S=="number"){const[I,P]=[e[p],t[S]];I.toLowerCase()===P.toLowerCase()&&(t[S]=I,S>p?t=t.slice(S):p>S&&(e=e.slice(p)))}}const{optimizationLevel:n=1}=this.options;n>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var o=0,u=0,h=e.length,c=t.length;o<h&&u<c;o++,u++){this.debug("matchOne loop");var i=t[u],f=e[o];if(this.debug(t,i,f),i===!1)return!1;if(i===ns){this.debug("GLOBSTAR",[t,i,f]);var m=o,b=u+1;if(b===c){for(this.debug("** at the end");o<h;o++)if(e[o]==="."||e[o]===".."||!a.dot&&e[o].charAt(0)===".")return!1;return!0}for(;m<h;){var v=e[m];if(this.debug("\nglobstar while",e,m,t,b,v),this.matchOne(e.slice(m),t.slice(b),s))return this.debug("globstar found match!",m,h,v),!0;if(v==="."||v===".."||!a.dot&&v.charAt(0)==="."){this.debug("dot detected!",e,m,t,b);break}this.debug("globstar swallow a segment, and continue"),m++}return!(!s||(this.debug("\n>>> no match, partial?",e,m,t,b),m!==h))}let w;if(typeof i=="string"?(w=f===i,this.debug("string match",i,f,w)):(w=i.test(f),this.debug("pattern match",i,f,w)),!w)return!1}if(o===h&&u===c)return!0;if(o===h)return s;if(u===c)return o===h-1&&e[o]==="";throw new Error("wtf?")}braceExpand(){return Wg(this.pattern,this.options)}parse(e){Qh(e);const t=this.options;if(e==="**")return ns;if(e==="")return"";let s,a=null;(s=e.match(c0))?a=t.dot?m0:h0:(s=e.match(e0))?a=(t.nocase?t.dot?a0:r0:t.dot?s0:t0)(s[1]):(s=e.match(f0))?a=(t.nocase?t.dot?d0:p0:t.dot?g0:w0)(s):(s=e.match(n0))?a=t.dot?o0:i0:(s=e.match(u0))&&(a=l0);const n=Zh.fromGlob(e,this.options).toMMPattern();return a&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:a}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",a=new Set(t.nocase?["i"]:[]);let n=e.map(h=>{const c=h.map(i=>{if(i instanceof RegExp)for(const f of i.flags.split(""))a.add(f);return typeof i=="string"?i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):i===ns?ns:i._src});return c.forEach((i,f)=>{const m=c[f+1],b=c[f-1];i===ns&&b!==ns&&(b===void 0?m!==void 0&&m!==ns?c[f+1]="(?:\\/|"+s+"\\/)?"+m:c[f]=s:m===void 0?c[f-1]=b+"(?:\\/|"+s+")?":m!==ns&&(c[f-1]=b+"(?:\\/|\\/"+s+"\\/)"+m,c[f+1]=ns))}),c.filter(i=>i!==ns).join("/")}).join("|");const[o,u]=e.length>1?["(?:",")"]:["",""];n="^"+o+n+u+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...a].join(""))}catch(h){this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.partial;if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const s=this.options;this.isWindows&&(e=e.split("\\").join("/"));const a=this.slashSplit(e);this.debug(this.pattern,"split",a);const n=this.set;this.debug(this.pattern,"set",n);let o=a[a.length-1];if(!o)for(let u=a.length-2;!o&&u>=0;u--)o=a[u];for(let u=0;u<n.length;u++){const h=n[u];let c=a;if(s.matchBase&&h.length===1&&(c=[o]),this.matchOne(c,h,t))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(e){return Pt.defaults(e).Minimatch}}function vp(r){const e=new Error("".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"","Invalid response: ").concat(r.status," ").concat(r.statusText));return e.status=r.status,e.response=r,e}function pt(r,e){const{status:t}=e;if(t===401&&r.digest)return e;if(t>=400)throw vp(e);return e}function Qn(r,e){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?{data:e,headers:r.headers?Fy(r.headers):{},status:r.status,statusText:r.statusText}:e}Pt.AST=Zh,Pt.Minimatch=em,Pt.escape=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/[?*()[\]]/g,"[$&]"):r.replace(/[?*()[\]\\]/g,"\\$&")},Pt.unescape=gu;const y0=(Sd=function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ft({url:Me(r.remoteURL,Ke(e)),method:"COPY",headers:{Destination:Me(r.remoteURL,Ke(t)),Overwrite:s.overwrite===!1?"F":"T",Depth:s.shallow?"0":"infinity"}},r,s);return o=function(u){pt(r,u)},(n=mt(a,r))&&n.then||(n=Promise.resolve(n)),o?n.then(o):n;var n,o},function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];try{return Promise.resolve(Sd.apply(this,r))}catch(t){return Promise.reject(t)}});var Sd,bp=Ve(635),v0=Ve(829),Qs=Ve.n(v0),Po=function(r){return r.Array="array",r.Object="object",r.Original="original",r}(Po||{});function Uc(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Po.Original;const s=Qs().get(r,e);return t==="array"&&Array.isArray(s)===!1?[s]:t==="object"&&Array.isArray(s)?s[0]:s}function xc(r){return new Promise(e=>{e(function(t){const{multistatus:s}=t;if(s==="")return{multistatus:{response:[]}};if(!s)throw new Error("Invalid response: No root multistatus found");const a={multistatus:Array.isArray(s)?s[0]:s};return Qs().set(a,"multistatus.response",Uc(a,"multistatus.response",Po.Array)),Qs().set(a,"multistatus.response",Qs().get(a,"multistatus.response").map(n=>function(o){const u=Object.assign({},o);return u.status?Qs().set(u,"status",Uc(u,"status",Po.Object)):(Qs().set(u,"propstat",Uc(u,"propstat",Po.Object)),Qs().set(u,"propstat.prop",Uc(u,"propstat.prop",Po.Object))),u}(n))),a}(new bp.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",textNodeName:"text",ignoreAttributes:!1,removeNSPrefix:!0,numberParseOptions:{hex:!0,leadingZeros:!1},attributeValueProcessor:(t,s,a)=>s==="true"||s==="false"?s==="true":s,tagValueProcessor(t,s,a){if(!a.endsWith("propstat.prop.displayname"))return s}}).parse(r)))})}function gm(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const{getlastmodified:s=null,getcontentlength:a="0",resourcetype:n=null,getcontenttype:o=null,getetag:u=null}=r,h=n&&typeof n=="object"&&n.collection!==void 0?"directory":"file",c={filename:e,basename:Gh().basename(e),lastmod:s,size:parseInt(a,10),type:h,etag:typeof u=="string"?u.replace(/"/g,""):null};return h==="file"&&(c.mime=o&&typeof o=="string"?o.split(";")[0]:""),t&&(r.displayname!==void 0&&(r.displayname=String(r.displayname)),c.props=r),c}function _g(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=null;try{r.multistatus.response[0].propstat&&(s=r.multistatus.response[0])}catch(i){}if(!s)throw new Error("Failed getting item stat: bad response");const{propstat:{prop:a,status:n}}=s,[o,u,h]=n.split(" ",3),c=parseInt(u,10);if(c>=400){const i=new Error("Invalid response: ".concat(c," ").concat(h));throw i.status=c,i}return gm(a,bc(e),t)}function Gg(r){switch(String(r)){case"-3":return"unlimited";case"-2":case"-1":return"unknown";default:return parseInt(String(r),10)}}function Dm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Sp=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=ft({url:Me(r.remoteURL,Ke(e)),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,t);return Dm(mt(a,r),function(n){return pt(r,n),Dm(n.text(),function(o){return Dm(xc(o),function(u){const h=_g(u,e,s);return Qn(n,h,s)})})})});function zg(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const b0=Xg(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=function(n){if(!n||n==="/")return[];let o=n;const u=[];do u.push(o),o=Gh().dirname(o);while(o&&o!=="/");return u}(bc(e));s.sort((n,o)=>n.length>o.length?1:o.length>n.length?-1:0);let a=!1;return function(n,o,u){if(typeof n[Nd]=="function"){let w=function(y){try{for(;!(h=f.next()).done;)if((y=o(h.value))&&y.then){if(!Ed(y))return void y.then(w,i||(i=$t.bind(null,c=new Do,2)));y=y.v}c?$t(c,1,y):c=y}catch(k){$t(c||(c=new Do),2,k)}};var h,c,i,f=n[Nd]();if(w(),f.return){var m=function(y){try{h.done||f.return()}catch(k){}return y};if(c&&c.then)return c.then(m,function(y){throw m(y)});m()}return c}if(!("length"in n))throw new TypeError("Object is not iterable");for(var b=[],v=0;v<n.length;v++)b.push(n[v]);return function(w,y,k){var p,S,I=-1;return function P(x){try{for(;++I<w.length&&(!k||!k());)if((x=y(I))&&x.then){if(!Ed(x))return void x.then(P,S||(S=$t.bind(null,p=new Do,2)));x=x.v}p?$t(p,1,x):p=x}catch(T){$t(p||(p=new Do),2,T)}}(),p}(b,function(w){return o(b[w])},u)}(s,function(n){return o=function(){return function(h,c){try{var i=zg(Sp(r,n),function(f){if(f.type!=="directory")throw new Error("Path includes a file: ".concat(e))})}catch(f){return c(f)}return i&&i.then?i.then(void 0,c):i}(0,function(h){const c=h;return function(){if(c.status===404)return a=!0,Ad(Kf(r,n,Cs(kt({},t),{recursive:!1})));throw h}()})},(u=function(){if(a)return Ad(Kf(r,n,Cs(kt({},t),{recursive:!1})))}())&&u.then?u.then(o):o();var o,u},function(){return!1})});function Xg(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function S0(){}function Ad(r,e){return r&&r.then?r.then(S0):Promise.resolve()}const Nd=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function $t(r,e,t){if(!r.s){if(t instanceof Do){if(!t.s)return void(t.o=$t.bind(null,r,e));1&e&&(e=t.s),t=t.v}if(t&&t.then)return void t.then($t.bind(null,r,e),$t.bind(null,r,2));r.s=e,r.v=t;const s=r.o;s&&s(r)}}const Do=function(){function r(){}return r.prototype.then=function(e,t){const s=new r,a=this.s;if(a){const n=1&a?e:t;if(n){try{$t(s,1,n(this.v))}catch(o){$t(s,2,o)}return s}return this}return this.o=function(n){try{const o=n.v;1&n.s?$t(s,1,e?e(o):o):t?$t(s,1,t(o)):$t(s,2,o)}catch(o){$t(s,2,o)}},s},r}();function Ed(r){return r instanceof Do&&1&r.s}const Kf=Xg(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.recursive===!0)return b0(r,e,t);const s=ft({url:Me(r.remoteURL,(a=Ke(e),a.endsWith("/")?a:a+"/")),method:"MKCOL"},r,t);var a;return zg(mt(s,r),function(n){pt(r,n)})});var A0=Ve(388),kd=Ve.n(A0);const N0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s={};if(typeof t.range=="object"&&typeof t.range.start=="number"){let u="bytes=".concat(t.range.start,"-");typeof t.range.end=="number"&&(u="".concat(u).concat(t.range.end)),s.Range=u}const a=ft({url:Me(r.remoteURL,Ke(e)),method:"GET",headers:s},r,t);return o=function(u){if(pt(r,u),s.Range&&u.status!==206){const h=new Error("Invalid response code for partial request: ".concat(u.status));throw h.status=u.status,h}return t.callback&&setTimeout(()=>{t.callback(u)},0),u.body},(n=mt(a,r))&&n.then||(n=Promise.resolve(n)),o?n.then(o):n;var n,o}),E0=()=>{},k0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){t.url||(t.url=Me(r.remoteURL,Ke(e)));const s=ft(t,r,{});return n=function(o){return pt(r,o),o},(a=mt(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),I0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:Me(r.remoteURL,Ke(e)),method:"DELETE"},r,t);return n=function(o){pt(r,o)},(a=mt(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),C0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function(s,a){try{var n=(o=Sp(r,e,t),u=function(){return!0},h?u?u(o):o:(o&&o.then||(o=Promise.resolve(o)),u?o.then(u):o))}catch(c){return a(c)}var o,u,h;return n&&n.then?n.then(void 0,a):n}(0,function(s){if(s.status===404)return!1;throw s})});function Tm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const V0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:Me(r.remoteURL,Ke(e),"/"),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:t.deep?"infinity":"1"}},r,t);return Tm(mt(s,r),function(a){return pt(r,a),Tm(a.text(),function(n){if(!n)throw new Error("Failed parsing directory contents: Empty response");return Tm(xc(n),function(o){const u=cd(e);let h=function(c,i,f){let m=arguments.length>3&&arguments[3]!==void 0&&arguments[3],b=arguments.length>4&&arguments[4]!==void 0&&arguments[4];const v=Gh().join(i,"/"),{multistatus:{response:w}}=c,y=w.map(k=>{const p=function(I){try{return I.replace(/^https?:\/\/[^\/]+/,"")}catch(P){throw new Mt(P,"Failed normalising HREF")}}(k.href),{propstat:{prop:S}}=k;return gm(S,v==="/"?decodeURIComponent(bc(p)):bc(Gh().relative(decodeURIComponent(v),decodeURIComponent(p))),m)});return b?y:y.filter(k=>k.basename&&(k.type==="file"||k.filename!==f.replace(/\/$/,"")))}(o,cd(r.remoteBasePath||r.remotePath),u,t.details,t.includeSelf);return t.glob&&(h=function(c,i){return c.filter(f=>Pt(f.filename,i,{matchBase:!0}))}(h,t.glob)),Qn(a,h,t.details)})})})});function Ap(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const x0=Ap(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:Me(r.remoteURL,Ke(e)),method:"GET",headers:{Accept:"text/plain"},transformResponse:[P0]},r,t);return tm(mt(s,r),function(a){return pt(r,a),tm(a.text(),function(n){return Qn(a,n,t.details)})})});function tm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const B0=Ap(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:Me(r.remoteURL,Ke(e)),method:"GET"},r,t);return tm(mt(s,r),function(a){let n;return pt(r,a),function(o,u){var h=o();return h&&h.then?h.then(u):u()}(function(){return tm(a.arrayBuffer(),function(o){n=o})},function(){return Qn(a,n,t.details)})})}),O0=Ap(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{format:s="binary"}=t;if(s!=="binary"&&s!=="text")throw new Mt({info:{code:hr.InvalidOutputFormat}},"Invalid output format: ".concat(s));return s==="text"?x0(r,e,t):B0(r,e,t)}),P0=r=>r;function D0(r){return new bp.XMLBuilder({attributeNamePrefix:"@_",format:!0,ignoreAttributes:!1,suppressEmptyNode:!0}).build(Yg({lockinfo:{"@_xmlns:d":"DAV:",lockscope:{exclusive:{}},locktype:{write:{}},owner:{href:r}}},"d"))}function Yg(r,e){const t=kt({},r);for(const s in t)t.hasOwnProperty(s)&&(t[s]&&typeof t[s]=="object"&&s.indexOf(":")===-1?(t["".concat(e,":").concat(s)]=Yg(t[s],e),delete t[s]):/^@_/.test(s)===!1&&(t["".concat(e,":").concat(s)]=t[s],delete t[s]));return t}function Mf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}function Qg(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const T0=Qg(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ft({url:Me(r.remoteURL,Ke(e)),method:"UNLOCK",headers:{"Lock-Token":t}},r,s);return Mf(mt(a,r),function(n){if(pt(r,n),n.status!==204&&n.status!==200)throw vp(n)})}),R0=Qg(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{refreshToken:s,timeout:a=U0}=t,n={Accept:"text/plain,application/xml",Timeout:a};s&&(n.If=s);const o=ft({url:Me(r.remoteURL,Ke(e)),method:"LOCK",headers:n,data:D0(r.contactHref)},r,t);return Mf(mt(o,r),function(u){return pt(r,u),Mf(u.text(),function(h){const c=(m=h,new bp.XMLParser({removeNSPrefix:!0,parseAttributeValue:!0,parseTagValue:!0}).parse(m)),i=Qs().get(c,"prop.lockdiscovery.activelock.locktoken.href"),f=Qs().get(c,"prop.lockdiscovery.activelock.timeout");var m;if(!i)throw vp(u,"No lock token received: ");return{token:i,serverTimeout:f}})})}),U0="Infinite, Second-4100000000";function Rm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const L0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.path||"/",s=ft({url:Me(r.remoteURL,t),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,e);return Rm(mt(s,r),function(a){return pt(r,a),Rm(a.text(),function(n){return Rm(xc(n),function(o){const u=function(h){try{const[c]=h.multistatus.response,{propstat:{prop:{"quota-used-bytes":i,"quota-available-bytes":f}}}=c;return i!==void 0&&f!==void 0?{used:parseInt(String(i),10),available:Gg(f)}:null}catch(c){}return null}(o);return Qn(a,u,e.details)})})})});function Um(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const j0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=ft({url:Me(r.remoteURL,Ke(e)),method:"SEARCH",headers:{Accept:"text/plain,application/xml","Content-Type":r.headers["Content-Type"]||"application/xml; charset=utf-8"}},r,t);return Um(mt(a,r),function(n){return pt(r,n),Um(n.text(),function(o){return Um(xc(o),function(u){const h=function(c,i,f){const m={truncated:!1,results:[]};return m.truncated=c.multistatus.response.some(b=>{var v,w;return((w=(b.status||((v=b.propstat)==null?void 0:v.status)).split(" ",3))==null?void 0:w[1])==="507"&&b.href.replace(/\/$/,"").endsWith(Ke(i).replace(/\/$/,""))}),c.multistatus.response.forEach(b=>{if(b.propstat===void 0)return;const v=b.href.split("/").map(decodeURIComponent).join("/");m.results.push(gm(b.propstat.prop,v,f))}),m}(u,e,s);return Qn(n,h,s)})})})}),$0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=ft({url:Me(r.remoteURL,Ke(e)),method:"MOVE",headers:{Destination:Me(r.remoteURL,Ke(t)),Overwrite:s.overwrite===!1?"F":"T"}},r,s);return o=function(u){pt(r,u)},(n=mt(a,r))&&n.then||(n=Promise.resolve(n)),o?n.then(o):n;var n,o});var K0=Ve(172);const M0=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const{contentLength:a=!0,overwrite:n=!0}=s,o={"Content-Type":"application/octet-stream"};a===!1||(o["Content-Length"]=typeof a=="number"?"".concat(a):"".concat(function(i){if(jg(i))return i.byteLength;if($g(i))return i.length;if(typeof i=="string")return(0,K0.d)(i);throw new Mt({info:{code:hr.DataTypeNoLength}},"Cannot calculate data length: Invalid type")}(t))),n||(o["If-None-Match"]="*");const u=ft({url:Me(r.remoteURL,Ke(e)),method:"PUT",headers:o,data:t},r,s);return c=function(i){try{pt(r,i)}catch(f){const m=f;if(m.status!==412||n)throw m;return!1}return!0},(h=mt(u,r))&&h.then||(h=Promise.resolve(h)),c?h.then(c):h;var h,c}),Zg=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ft({url:Me(r.remoteURL,Ke(e)),method:"OPTIONS"},r,t);return n=function(o){var u,h;try{pt(r,o)}catch(c){throw c}return{compliance:((u=o.headers.get("DAV"))!=null?u:"").split(",").map(c=>c.trim()),server:(h=o.headers.get("Server"))!=null?h:""}},(a=mt(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n});function fc(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const H0=Np(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new Mt({info:{code:hr.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const o={"Content-Type":"application/octet-stream","Content-Length":""+(s-t+1),"Content-Range":"bytes ".concat(t,"-").concat(s,"/*")},u=ft({url:Me(r.remoteURL,Ke(e)),method:"PUT",headers:o,data:a},r,n);return fc(mt(u,r),function(h){pt(r,h)})});function Id(r,e){var t=r();return t&&t.then?t.then(e):e(t)}const F0=Np(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new Mt({info:{code:hr.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const o={"Content-Type":"application/x-sabredav-partialupdate","Content-Length":""+(s-t+1),"X-Update-Range":"bytes=".concat(t,"-").concat(s)},u=ft({url:Me(r.remoteURL,Ke(e)),method:"PATCH",headers:o,data:a},r,n);return fc(mt(u,r),function(h){pt(r,h)})});function Np(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const J0=Np(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};return fc(Zg(r,e,n),function(o){let u=!1;return Id(function(){if(o.compliance.includes("sabredav-partialupdate"))return fc(F0(r,e,t,s,a,n),function(h){return u=!0,h})},function(h){let c=!1;return u?h:Id(function(){if(o.server.includes("Apache")&&o.compliance.includes("<http://apache.org/dav/propset/fs/1>"))return fc(H0(r,e,t,s,a,n),function(i){return c=!0,i})},function(i){if(c)return i;throw new Mt({info:{code:hr.NotSupported}},"Not supported")})})})}),q0="https://github.com/perry-mitchell/webdav-client/blob/master/LOCK_CONTACT.md";function W0(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{authType:t=null,remoteBasePath:s,contactHref:a=q0,ha1:n,headers:o={},httpAgent:u,httpsAgent:h,password:c,token:i,username:f,withCredentials:m}=e;let b=t;b||(b=f||c?jt.Password:jt.None);const v={authType:b,remoteBasePath:s,contactHref:a,ha1:n,headers:Object.assign({},o),httpAgent:u,httpsAgent:h,password:c,remotePath:Ty(r),remoteURL:r,token:i,username:f,withCredentials:m};return Rg(v,f,c,i,n),{copyFile:(w,y,k)=>y0(v,w,y,k),createDirectory:(w,y)=>Kf(v,w,y),createReadStream:(w,y)=>function(k,p){let S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const I=new(kd()).PassThrough;return N0(k,p,S).then(P=>{P.pipe(I)}).catch(P=>{I.emit("error",P)}),I}(v,w,y),createWriteStream:(w,y,k)=>function(p,S){let I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:E0;const x=new(kd()).PassThrough,T={};I.overwrite===!1&&(T["If-None-Match"]="*");const B=ft({url:Me(p.remoteURL,Ke(S)),method:"PUT",headers:T,data:x,maxRedirects:0},p,I);return mt(B,p).then(V=>pt(p,V)).then(V=>{setTimeout(()=>{P(V)},0)}).catch(V=>{x.emit("error",V)}),x}(v,w,y,k),customRequest:(w,y)=>k0(v,w,y),deleteFile:(w,y)=>I0(v,w,y),exists:(w,y)=>C0(v,w,y),getDirectoryContents:(w,y)=>V0(v,w,y),getFileContents:(w,y)=>O0(v,w,y),getFileDownloadLink:w=>function(y,k){let p=Me(y.remoteURL,Ke(k));const S=/^https:/i.test(p)?"https":"http";switch(y.authType){case jt.None:break;case jt.Password:{const I=md(y.headers.Authorization.replace(/^Basic /i,"").trim());p=p.replace(/^https?:\/\//,"".concat(S,"://").concat(I,"@"));break}default:throw new Mt({info:{code:hr.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(y.authType))}return p}(v,w),getFileUploadLink:w=>function(y,k){let p="".concat(Me(y.remoteURL,Ke(k)),"?Content-Type=application/octet-stream");const S=/^https:/i.test(p)?"https":"http";switch(y.authType){case jt.None:break;case jt.Password:{const I=md(y.headers.Authorization.replace(/^Basic /i,"").trim());p=p.replace(/^https?:\/\//,"".concat(S,"://").concat(I,"@"));break}default:throw new Mt({info:{code:hr.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(y.authType))}return p}(v,w),getHeaders:()=>Object.assign({},v.headers),getQuota:w=>L0(v,w),lock:(w,y)=>R0(v,w,y),moveFile:(w,y,k)=>$0(v,w,y,k),putFileContents:(w,y,k)=>M0(v,w,y,k),partialUpdateFileContents:(w,y,k,p,S)=>J0(v,w,y,k,p,S),getDAVCompliance:w=>Zg(v,w),search:(w,y)=>j0(v,w,y),setHeaders:w=>{v.headers=Object.assign({},w)},stat:(w,y)=>Sp(v,w,y),unlock:(w,y,k)=>T0(v,w,y,k)}}fs.hT,fs.O4,fs.Kd,fs.YK;var _0=fs.UU,G0=fs.Gu,z0=fs.ky,X0=fs.h4;fs.ch,fs.hq,fs.i5;const Lo=xf().setApp("@nextcloud/files").detectUser().build();var ew=(r=>(r.Folder="folder",r.File="file",r))(ew||{}),tw=(r=>(r[r.NONE=0]="NONE",r[r.CREATE=4]="CREATE",r[r.READ=1]="READ",r[r.UPDATE=2]="UPDATE",r[r.DELETE=8]="DELETE",r[r.SHARE=16]="SHARE",r[r.ALL=31]="ALL",r))(tw||{});const sw=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],rw={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},Lm=function(r,e={nc:"http://nextcloud.org/ns"}){typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...sw],window._nc_dav_namespaces=kt({},rw));const t=kt(kt({},window._nc_dav_namespaces),e);if(window._nc_dav_properties.find(a=>a===r))return Lo.warn("".concat(r," already registered"),{prop:r}),!1;if(r.startsWith("<")||r.split(":").length!==2)return Lo.error("".concat(r," is not valid. See example: 'oc:fileid'"),{prop:r}),!1;const s=r.split(":")[0];return t[s]?(window._nc_dav_properties.push(r),window._nc_dav_namespaces=t,!0):(Lo.error("".concat(r," namespace unknown"),{prop:r,namespaces:t}),!1)},Y0=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...sw]),window._nc_dav_properties.map(r=>"<".concat(r," />")).join(" ")},Q0=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces=kt({},rw)),Object.keys(window._nc_dav_namespaces).map(r=>{var e;return"xmlns:".concat(r,'="').concat((e=window._nc_dav_namespaces)==null?void 0:e[r],'"')}).join(" ")},Z0=function(){return'<?xml version="1.0"?>\n		<d:propfind '.concat(Q0(),">\n			<d:prop>\n				").concat(Y0(),"\n			</d:prop>\n		</d:propfind>")};function e1(){var r;return Og()?"/files/".concat(ky()):"/files/".concat((r=pp())==null?void 0:r.uid)}e1();function t1(){const r=Xw("dav");return Og()?r.replace("remote.php","public.php"):r}const s1=t1(),r1=function(r=s1,e={}){const t=_0(r,{headers:e});function s(a){t.setHeaders(Cs(kt({},e),{"X-Requested-With":"XMLHttpRequest",requesttoken:a!=null?a:""}))}return Qw(s),s(Yw()),G0().patch("fetch",(a,n)=>{const o=n.headers;return o!=null&&o.method&&(n.method=o.method,delete o.method),fetch(a,n)}),t};var jm={},$m={exports:{}},Cd={},Vd;function a1(){return Vd||(Vd=1,function(r){Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},t={};t.byteLength=i,t.toByteArray=m,t.fromByteArray=w;for(var s=[],a=[],n=typeof Uint8Array<"u"?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,h=o.length;u<h;++u)s[u]=o[u],a[o.charCodeAt(u)]=u;a[45]=62,a[95]=63;function c(p){var S=p.length;if(S%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=p.indexOf("=");I===-1&&(I=S);var P=I===S?0:4-I%4;return[I,P]}function i(p){var S=c(p),I=S[0],P=S[1];return(I+P)*3/4-P}function f(p,S,I){return(S+I)*3/4-I}function m(p){var S,I=c(p),P=I[0],x=I[1],T=new n(f(p,P,x)),B=0,V=x>0?P-4:P,J;for(J=0;J<V;J+=4)S=a[p.charCodeAt(J)]<<18|a[p.charCodeAt(J+1)]<<12|a[p.charCodeAt(J+2)]<<6|a[p.charCodeAt(J+3)],T[B++]=S>>16&255,T[B++]=S>>8&255,T[B++]=S&255;return x===2&&(S=a[p.charCodeAt(J)]<<2|a[p.charCodeAt(J+1)]>>4,T[B++]=S&255),x===1&&(S=a[p.charCodeAt(J)]<<10|a[p.charCodeAt(J+1)]<<4|a[p.charCodeAt(J+2)]>>2,T[B++]=S>>8&255,T[B++]=S&255),T}function b(p){return s[p>>18&63]+s[p>>12&63]+s[p>>6&63]+s[p&63]}function v(p,S,I){for(var P,x=[],T=S;T<I;T+=3)P=(p[T]<<16&16711680)+(p[T+1]<<8&65280)+(p[T+2]&255),x.push(b(P));return x.join("")}function w(p){for(var S,I=p.length,P=I%3,x=[],T=16383,B=0,V=I-P;B<V;B+=T)x.push(v(p,B,B+T>V?V:B+T));return P===1?(S=p[I-1],x.push(s[S>>2]+s[S<<4&63]+"==")):P===2&&(S=(p[I-2]<<8)+p[I-1],x.push(s[S>>10]+s[S>>4&63]+s[S<<2&63]+"=")),x.join("")}var y={};y.read=function(p,S,I,P,x){var T,B,V=x*8-P-1,J=(1<<V)-1,F=J>>1,D=-7,j=I?x-1:0,te=I?-1:1,Y=p[S+j];for(j+=te,T=Y&(1<<-D)-1,Y>>=-D,D+=V;D>0;T=T*256+p[S+j],j+=te,D-=8);for(B=T&(1<<-D)-1,T>>=-D,D+=P;D>0;B=B*256+p[S+j],j+=te,D-=8);if(T===0)T=1-F;else{if(T===J)return B?NaN:(Y?-1:1)*(1/0);B=B+Math.pow(2,P),T=T-F}return(Y?-1:1)*B*Math.pow(2,T-P)},y.write=function(p,S,I,P,x,T){var B,V,J,F=T*8-x-1,D=(1<<F)-1,j=D>>1,te=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=P?0:T-1,oe=P?1:-1,ne=S<0||S===0&&1/S<0?1:0;for(S=Math.abs(S),isNaN(S)||S===1/0?(V=isNaN(S)?1:0,B=D):(B=Math.floor(Math.log(S)/Math.LN2),S*(J=Math.pow(2,-B))<1&&(B--,J*=2),B+j>=1?S+=te/J:S+=te*Math.pow(2,1-j),S*J>=2&&(B++,J/=2),B+j>=D?(V=0,B=D):B+j>=1?(V=(S*J-1)*Math.pow(2,x),B=B+j):(V=S*Math.pow(2,j-1)*Math.pow(2,x),B=0));x>=8;p[I+Y]=V&255,Y+=oe,V/=256,x-=8);for(B=B<<x|V,F+=x;F>0;p[I+Y]=B&255,Y+=oe,B/=256,F-=8);p[I+Y-oe]|=ne*128},function(p){const S=t,I=y,P=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;p.Buffer=D,p.SlowBuffer=ce,p.INSPECT_MAX_BYTES=50;const x=2147483647;p.kMaxLength=x;const{Uint8Array:T,ArrayBuffer:B,SharedArrayBuffer:V}=globalThis;D.TYPED_ARRAY_SUPPORT=J(),!D.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function J(){try{const l=new T(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,T.prototype),Object.setPrototypeOf(l,g),l.foo()===42}catch(l){return!1}}Object.defineProperty(D.prototype,"parent",{enumerable:!0,get:function(){if(D.isBuffer(this))return this.buffer}}),Object.defineProperty(D.prototype,"offset",{enumerable:!0,get:function(){if(D.isBuffer(this))return this.byteOffset}});function F(l){if(l>x)throw new RangeError('The value "'+l+'" is invalid for option "size"');const g=new T(l);return Object.setPrototypeOf(g,D.prototype),g}function D(l,g,N){if(typeof l=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return oe(l)}return j(l,g,N)}D.poolSize=8192;function j(l,g,N){if(typeof l=="string")return ne(l,g);if(B.isView(l))return ie(l);if(l==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l);if(Is(l,B)||l&&Is(l.buffer,B)||typeof V<"u"&&(Is(l,V)||l&&Is(l.buffer,V)))return re(l,g,N);if(typeof l=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const R=l.valueOf&&l.valueOf();if(R!=null&&R!==l)return D.from(R,g,N);const K=se(l);if(K)return K;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof l[Symbol.toPrimitive]=="function")return D.from(l[Symbol.toPrimitive]("string"),g,N);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l)}D.from=function(l,g,N){return j(l,g,N)},Object.setPrototypeOf(D.prototype,T.prototype),Object.setPrototypeOf(D,T);function te(l){if(typeof l!="number")throw new TypeError('"size" argument must be of type number');if(l<0)throw new RangeError('The value "'+l+'" is invalid for option "size"')}function Y(l,g,N){return te(l),l<=0?F(l):g!==void 0?typeof N=="string"?F(l).fill(g,N):F(l).fill(g):F(l)}D.alloc=function(l,g,N){return Y(l,g,N)};function oe(l){return te(l),F(l<0?0:ee(l)|0)}D.allocUnsafe=function(l){return oe(l)},D.allocUnsafeSlow=function(l){return oe(l)};function ne(l,g){if((typeof g!="string"||g==="")&&(g="utf8"),!D.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const N=pe(l,g)|0;let R=F(N);const K=R.write(l,g);return K!==N&&(R=R.slice(0,K)),R}function de(l){const g=l.length<0?0:ee(l.length)|0,N=F(g);for(let R=0;R<g;R+=1)N[R]=l[R]&255;return N}function ie(l){if(Is(l,T)){const g=new T(l);return re(g.buffer,g.byteOffset,g.byteLength)}return de(l)}function re(l,g,N){if(g<0||l.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(l.byteLength<g+(N||0))throw new RangeError('"length" is outside of buffer bounds');let R;return g===void 0&&N===void 0?R=new T(l):N===void 0?R=new T(l,g):R=new T(l,g,N),Object.setPrototypeOf(R,D.prototype),R}function se(l){if(D.isBuffer(l)){const g=ee(l.length)|0,N=F(g);return N.length===0||l.copy(N,0,0,g),N}if(l.length!==void 0)return typeof l.length!="number"||Nm(l.length)?F(0):de(l);if(l.type==="Buffer"&&Array.isArray(l.data))return de(l.data)}function ee(l){if(l>=x)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+x.toString(16)+" bytes");return l|0}function ce(l){return+l!=l&&(l=0),D.alloc(+l)}D.isBuffer=function(l){return l!=null&&l._isBuffer===!0&&l!==D.prototype},D.compare=function(l,g){if(Is(l,T)&&(l=D.from(l,l.offset,l.byteLength)),Is(g,T)&&(g=D.from(g,g.offset,g.byteLength)),!D.isBuffer(l)||!D.isBuffer(g))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(l===g)return 0;let N=l.length,R=g.length;for(let K=0,W=Math.min(N,R);K<W;++K)if(l[K]!==g[K]){N=l[K],R=g[K];break}return N<R?-1:R<N?1:0},D.isEncoding=function(l){switch(String(l).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},D.concat=function(l,g){if(!Array.isArray(l))throw new TypeError('"list" argument must be an Array of Buffers');if(l.length===0)return D.alloc(0);let N;if(g===void 0)for(g=0,N=0;N<l.length;++N)g+=l[N].length;const R=D.allocUnsafe(g);let K=0;for(N=0;N<l.length;++N){let W=l[N];if(Is(W,T))K+W.length>R.length?(D.isBuffer(W)||(W=D.from(W)),W.copy(R,K)):T.prototype.set.call(R,W,K);else if(D.isBuffer(W))W.copy(R,K);else throw new TypeError('"list" argument must be an Array of Buffers');K+=W.length}return R};function pe(l,g){if(D.isBuffer(l))return l.length;if(B.isView(l)||Is(l,B))return l.byteLength;if(typeof l!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof l);const N=l.length,R=arguments.length>2&&arguments[2]===!0;if(!R&&N===0)return 0;let K=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return N;case"utf8":case"utf-8":return Am(l).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N*2;case"hex":return N>>>1;case"base64":return Yp(l).length;default:if(K)return R?-1:Am(l).length;g=(""+g).toLowerCase(),K=!0}}D.byteLength=pe;function Ce(l,g,N){let R=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((N===void 0||N>this.length)&&(N=this.length),N<=0)||(N>>>=0,g>>>=0,N<=g))return"";for(l||(l="utf8");;)switch(l){case"hex":return Oc(this,g,N);case"utf8":case"utf-8":return bt(this,g,N);case"ascii":return ps(this,g,N);case"latin1":case"binary":return bm(this,g,N);case"base64":return Et(this,g,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Yo(this,g,N);default:if(R)throw new TypeError("Unknown encoding: "+l);l=(l+"").toLowerCase(),R=!0}}D.prototype._isBuffer=!0;function Fe(l,g,N){const R=l[g];l[g]=l[N],l[N]=R}D.prototype.swap16=function(){const l=this.length;if(l%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let g=0;g<l;g+=2)Fe(this,g,g+1);return this},D.prototype.swap32=function(){const l=this.length;if(l%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let g=0;g<l;g+=4)Fe(this,g,g+3),Fe(this,g+1,g+2);return this},D.prototype.swap64=function(){const l=this.length;if(l%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let g=0;g<l;g+=8)Fe(this,g,g+7),Fe(this,g+1,g+6),Fe(this,g+2,g+5),Fe(this,g+3,g+4);return this},D.prototype.toString=function(){const l=this.length;return l===0?"":arguments.length===0?bt(this,0,l):Ce.apply(this,arguments)},D.prototype.toLocaleString=D.prototype.toString,D.prototype.equals=function(l){if(!D.isBuffer(l))throw new TypeError("Argument must be a Buffer");return this===l?!0:D.compare(this,l)===0},D.prototype.inspect=function(){let l="";const g=p.INSPECT_MAX_BYTES;return l=this.toString("hex",0,g).replace(/(.{2})/g,"$1 ").trim(),this.length>g&&(l+=" ... "),"<Buffer "+l+">"},P&&(D.prototype[P]=D.prototype.inspect),D.prototype.compare=function(l,g,N,R,K){if(Is(l,T)&&(l=D.from(l,l.offset,l.byteLength)),!D.isBuffer(l))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof l);if(g===void 0&&(g=0),N===void 0&&(N=l?l.length:0),R===void 0&&(R=0),K===void 0&&(K=this.length),g<0||N>l.length||R<0||K>this.length)throw new RangeError("out of range index");if(R>=K&&g>=N)return 0;if(R>=K)return-1;if(g>=N)return 1;if(g>>>=0,N>>>=0,R>>>=0,K>>>=0,this===l)return 0;let W=K-R,Q=N-g;const Pe=Math.min(W,Q),St=this.slice(R,K),De=l.slice(g,N);for(let xe=0;xe<Pe;++xe)if(St[xe]!==De[xe]){W=St[xe],Q=De[xe];break}return W<Q?-1:Q<W?1:0};function C(l,g,N,R,K){if(l.length===0)return-1;if(typeof N=="string"?(R=N,N=0):N>2147483647?N=2147483647:N<-2147483648&&(N=-2147483648),N=+N,Nm(N)&&(N=K?0:l.length-1),N<0&&(N=l.length+N),N>=l.length){if(K)return-1;N=l.length-1}else if(N<0)if(K)N=0;else return-1;if(typeof g=="string"&&(g=D.from(g,R)),D.isBuffer(g))return g.length===0?-1:A(l,g,N,R,K);if(typeof g=="number")return g=g&255,typeof T.prototype.indexOf=="function"?K?T.prototype.indexOf.call(l,g,N):T.prototype.lastIndexOf.call(l,g,N):A(l,[g],N,R,K);throw new TypeError("val must be string, number or Buffer")}function A(l,g,N,R,K){let W=1,Q=l.length,Pe=g.length;if(R!==void 0&&(R=String(R).toLowerCase(),R==="ucs2"||R==="ucs-2"||R==="utf16le"||R==="utf-16le")){if(l.length<2||g.length<2)return-1;W=2,Q/=2,Pe/=2,N/=2}function St(xe,et){return W===1?xe[et]:xe.readUInt16BE(et*W)}let De;if(K){let xe=-1;for(De=N;De<Q;De++)if(St(l,De)===St(g,xe===-1?0:De-xe)){if(xe===-1&&(xe=De),De-xe+1===Pe)return xe*W}else xe!==-1&&(De-=De-xe),xe=-1}else for(N+Pe>Q&&(N=Q-Pe),De=N;De>=0;De--){let xe=!0;for(let et=0;et<Pe;et++)if(St(l,De+et)!==St(g,et)){xe=!1;break}if(xe)return De}return-1}D.prototype.includes=function(l,g,N){return this.indexOf(l,g,N)!==-1},D.prototype.indexOf=function(l,g,N){return C(this,l,g,N,!0)},D.prototype.lastIndexOf=function(l,g,N){return C(this,l,g,N,!1)};function $(l,g,N,R){N=Number(N)||0;const K=l.length-N;R?(R=Number(R),R>K&&(R=K)):R=K;const W=g.length;R>W/2&&(R=W/2);let Q;for(Q=0;Q<R;++Q){const Pe=parseInt(g.substr(Q*2,2),16);if(Nm(Pe))return Q;l[N+Q]=Pe}return Q}function U(l,g,N,R){return Pc(Am(g,l.length-N),l,N,R)}function ge(l,g,N,R){return Pc(Mw(g),l,N,R)}function ke(l,g,N,R){return Pc(Yp(g),l,N,R)}function he(l,g,N,R){return Pc(Hw(g,l.length-N),l,N,R)}D.prototype.write=function(l,g,N,R){if(g===void 0)R="utf8",N=this.length,g=0;else if(N===void 0&&typeof g=="string")R=g,N=this.length,g=0;else if(isFinite(g))g=g>>>0,isFinite(N)?(N=N>>>0,R===void 0&&(R="utf8")):(R=N,N=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const K=this.length-g;if((N===void 0||N>K)&&(N=K),l.length>0&&(N<0||g<0)||g>this.length)throw new RangeError("Attempt to write outside buffer bounds");R||(R="utf8");let W=!1;for(;;)switch(R){case"hex":return $(this,l,g,N);case"utf8":case"utf-8":return U(this,l,g,N);case"ascii":case"latin1":case"binary":return ge(this,l,g,N);case"base64":return ke(this,l,g,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return he(this,l,g,N);default:if(W)throw new TypeError("Unknown encoding: "+R);R=(""+R).toLowerCase(),W=!0}},D.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Et(l,g,N){return g===0&&N===l.length?S.fromByteArray(l):S.fromByteArray(l.slice(g,N))}function bt(l,g,N){N=Math.min(l.length,N);const R=[];let K=g;for(;K<N;){const W=l[K];let Q=null,Pe=W>239?4:W>223?3:W>191?2:1;if(K+Pe<=N){let St,De,xe,et;switch(Pe){case 1:W<128&&(Q=W);break;case 2:St=l[K+1],(St&192)===128&&(et=(W&31)<<6|St&63,et>127&&(Q=et));break;case 3:St=l[K+1],De=l[K+2],(St&192)===128&&(De&192)===128&&(et=(W&15)<<12|(St&63)<<6|De&63,et>2047&&(et<55296||et>57343)&&(Q=et));break;case 4:St=l[K+1],De=l[K+2],xe=l[K+3],(St&192)===128&&(De&192)===128&&(xe&192)===128&&(et=(W&15)<<18|(St&63)<<12|(De&63)<<6|xe&63,et>65535&&et<1114112&&(Q=et))}}Q===null?(Q=65533,Pe=1):Q>65535&&(Q-=65536,R.push(Q>>>10&1023|55296),Q=56320|Q&1023),R.push(Q),K+=Pe}return ot(R)}const js=4096;function ot(l){const g=l.length;if(g<=js)return String.fromCharCode.apply(String,l);let N="",R=0;for(;R<g;)N+=String.fromCharCode.apply(String,l.slice(R,R+=js));return N}function ps(l,g,N){let R="";N=Math.min(l.length,N);for(let K=g;K<N;++K)R+=String.fromCharCode(l[K]&127);return R}function bm(l,g,N){let R="";N=Math.min(l.length,N);for(let K=g;K<N;++K)R+=String.fromCharCode(l[K]);return R}function Oc(l,g,N){const R=l.length;(!g||g<0)&&(g=0),(!N||N<0||N>R)&&(N=R);let K="";for(let W=g;W<N;++W)K+=Fw[l[W]];return K}function Yo(l,g,N){const R=l.slice(g,N);let K="";for(let W=0;W<R.length-1;W+=2)K+=String.fromCharCode(R[W]+R[W+1]*256);return K}D.prototype.slice=function(l,g){const N=this.length;l=~~l,g=g===void 0?N:~~g,l<0?(l+=N,l<0&&(l=0)):l>N&&(l=N),g<0?(g+=N,g<0&&(g=0)):g>N&&(g=N),g<l&&(g=l);const R=this.subarray(l,g);return Object.setPrototypeOf(R,D.prototype),R};function Je(l,g,N){if(l%1!==0||l<0)throw new RangeError("offset is not uint");if(l+g>N)throw new RangeError("Trying to access beyond buffer length")}D.prototype.readUintLE=D.prototype.readUIntLE=function(l,g,N){l=l>>>0,g=g>>>0,N||Je(l,g,this.length);let R=this[l],K=1,W=0;for(;++W<g&&(K*=256);)R+=this[l+W]*K;return R},D.prototype.readUintBE=D.prototype.readUIntBE=function(l,g,N){l=l>>>0,g=g>>>0,N||Je(l,g,this.length);let R=this[l+--g],K=1;for(;g>0&&(K*=256);)R+=this[l+--g]*K;return R},D.prototype.readUint8=D.prototype.readUInt8=function(l,g){return l=l>>>0,g||Je(l,1,this.length),this[l]},D.prototype.readUint16LE=D.prototype.readUInt16LE=function(l,g){return l=l>>>0,g||Je(l,2,this.length),this[l]|this[l+1]<<8},D.prototype.readUint16BE=D.prototype.readUInt16BE=function(l,g){return l=l>>>0,g||Je(l,2,this.length),this[l]<<8|this[l+1]},D.prototype.readUint32LE=D.prototype.readUInt32LE=function(l,g){return l=l>>>0,g||Je(l,4,this.length),(this[l]|this[l+1]<<8|this[l+2]<<16)+this[l+3]*16777216},D.prototype.readUint32BE=D.prototype.readUInt32BE=function(l,g){return l=l>>>0,g||Je(l,4,this.length),this[l]*16777216+(this[l+1]<<16|this[l+2]<<8|this[l+3])},D.prototype.readBigUInt64LE=fr(function(l){l=l>>>0,ri(l,"offset");const g=this[l],N=this[l+7];(g===void 0||N===void 0)&&Qo(l,this.length-8);const R=g+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24,K=this[++l]+this[++l]*2**8+this[++l]*2**16+N*2**24;return BigInt(R)+(BigInt(K)<<BigInt(32))}),D.prototype.readBigUInt64BE=fr(function(l){l=l>>>0,ri(l,"offset");const g=this[l],N=this[l+7];(g===void 0||N===void 0)&&Qo(l,this.length-8);const R=g*2**24+this[++l]*2**16+this[++l]*2**8+this[++l],K=this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+N;return(BigInt(R)<<BigInt(32))+BigInt(K)}),D.prototype.readIntLE=function(l,g,N){l=l>>>0,g=g>>>0,N||Je(l,g,this.length);let R=this[l],K=1,W=0;for(;++W<g&&(K*=256);)R+=this[l+W]*K;return K*=128,R>=K&&(R-=Math.pow(2,8*g)),R},D.prototype.readIntBE=function(l,g,N){l=l>>>0,g=g>>>0,N||Je(l,g,this.length);let R=g,K=1,W=this[l+--R];for(;R>0&&(K*=256);)W+=this[l+--R]*K;return K*=128,W>=K&&(W-=Math.pow(2,8*g)),W},D.prototype.readInt8=function(l,g){return l=l>>>0,g||Je(l,1,this.length),this[l]&128?(255-this[l]+1)*-1:this[l]},D.prototype.readInt16LE=function(l,g){l=l>>>0,g||Je(l,2,this.length);const N=this[l]|this[l+1]<<8;return N&32768?N|4294901760:N},D.prototype.readInt16BE=function(l,g){l=l>>>0,g||Je(l,2,this.length);const N=this[l+1]|this[l]<<8;return N&32768?N|4294901760:N},D.prototype.readInt32LE=function(l,g){return l=l>>>0,g||Je(l,4,this.length),this[l]|this[l+1]<<8|this[l+2]<<16|this[l+3]<<24},D.prototype.readInt32BE=function(l,g){return l=l>>>0,g||Je(l,4,this.length),this[l]<<24|this[l+1]<<16|this[l+2]<<8|this[l+3]},D.prototype.readBigInt64LE=fr(function(l){l=l>>>0,ri(l,"offset");const g=this[l],N=this[l+7];(g===void 0||N===void 0)&&Qo(l,this.length-8);const R=this[l+4]+this[l+5]*2**8+this[l+6]*2**16+(N<<24);return(BigInt(R)<<BigInt(32))+BigInt(g+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24)}),D.prototype.readBigInt64BE=fr(function(l){l=l>>>0,ri(l,"offset");const g=this[l],N=this[l+7];(g===void 0||N===void 0)&&Qo(l,this.length-8);const R=(g<<24)+this[++l]*2**16+this[++l]*2**8+this[++l];return(BigInt(R)<<BigInt(32))+BigInt(this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+N)}),D.prototype.readFloatLE=function(l,g){return l=l>>>0,g||Je(l,4,this.length),I.read(this,l,!0,23,4)},D.prototype.readFloatBE=function(l,g){return l=l>>>0,g||Je(l,4,this.length),I.read(this,l,!1,23,4)},D.prototype.readDoubleLE=function(l,g){return l=l>>>0,g||Je(l,8,this.length),I.read(this,l,!0,52,8)},D.prototype.readDoubleBE=function(l,g){return l=l>>>0,g||Je(l,8,this.length),I.read(this,l,!1,52,8)};function Jt(l,g,N,R,K,W){if(!D.isBuffer(l))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>K||g<W)throw new RangeError('"value" argument is out of bounds');if(N+R>l.length)throw new RangeError("Index out of range")}D.prototype.writeUintLE=D.prototype.writeUIntLE=function(l,g,N,R){if(l=+l,g=g>>>0,N=N>>>0,!R){const Q=Math.pow(2,8*N)-1;Jt(this,l,g,N,Q,0)}let K=1,W=0;for(this[g]=l&255;++W<N&&(K*=256);)this[g+W]=l/K&255;return g+N},D.prototype.writeUintBE=D.prototype.writeUIntBE=function(l,g,N,R){if(l=+l,g=g>>>0,N=N>>>0,!R){const Q=Math.pow(2,8*N)-1;Jt(this,l,g,N,Q,0)}let K=N-1,W=1;for(this[g+K]=l&255;--K>=0&&(W*=256);)this[g+K]=l/W&255;return g+N},D.prototype.writeUint8=D.prototype.writeUInt8=function(l,g,N){return l=+l,g=g>>>0,N||Jt(this,l,g,1,255,0),this[g]=l&255,g+1},D.prototype.writeUint16LE=D.prototype.writeUInt16LE=function(l,g,N){return l=+l,g=g>>>0,N||Jt(this,l,g,2,65535,0),this[g]=l&255,this[g+1]=l>>>8,g+2},D.prototype.writeUint16BE=D.prototype.writeUInt16BE=function(l,g,N){return l=+l,g=g>>>0,N||Jt(this,l,g,2,65535,0),this[g]=l>>>8,this[g+1]=l&255,g+2},D.prototype.writeUint32LE=D.prototype.writeUInt32LE=function(l,g,N){return l=+l,g=g>>>0,N||Jt(this,l,g,4,4294967295,0),this[g+3]=l>>>24,this[g+2]=l>>>16,this[g+1]=l>>>8,this[g]=l&255,g+4},D.prototype.writeUint32BE=D.prototype.writeUInt32BE=function(l,g,N){return l=+l,g=g>>>0,N||Jt(this,l,g,4,4294967295,0),this[g]=l>>>24,this[g+1]=l>>>16,this[g+2]=l>>>8,this[g+3]=l&255,g+4};function Jp(l,g,N,R,K){Xp(g,R,K,l,N,7);let W=Number(g&BigInt(4294967295));l[N++]=W,W=W>>8,l[N++]=W,W=W>>8,l[N++]=W,W=W>>8,l[N++]=W;let Q=Number(g>>BigInt(32)&BigInt(4294967295));return l[N++]=Q,Q=Q>>8,l[N++]=Q,Q=Q>>8,l[N++]=Q,Q=Q>>8,l[N++]=Q,N}function qp(l,g,N,R,K){Xp(g,R,K,l,N,7);let W=Number(g&BigInt(4294967295));l[N+7]=W,W=W>>8,l[N+6]=W,W=W>>8,l[N+5]=W,W=W>>8,l[N+4]=W;let Q=Number(g>>BigInt(32)&BigInt(4294967295));return l[N+3]=Q,Q=Q>>8,l[N+2]=Q,Q=Q>>8,l[N+1]=Q,Q=Q>>8,l[N]=Q,N+8}D.prototype.writeBigUInt64LE=fr(function(l,g=0){return Jp(this,l,g,BigInt(0),BigInt("0xffffffffffffffff"))}),D.prototype.writeBigUInt64BE=fr(function(l,g=0){return qp(this,l,g,BigInt(0),BigInt("0xffffffffffffffff"))}),D.prototype.writeIntLE=function(l,g,N,R){if(l=+l,g=g>>>0,!R){const Pe=Math.pow(2,8*N-1);Jt(this,l,g,N,Pe-1,-Pe)}let K=0,W=1,Q=0;for(this[g]=l&255;++K<N&&(W*=256);)l<0&&Q===0&&this[g+K-1]!==0&&(Q=1),this[g+K]=(l/W>>0)-Q&255;return g+N},D.prototype.writeIntBE=function(l,g,N,R){if(l=+l,g=g>>>0,!R){const Pe=Math.pow(2,8*N-1);Jt(this,l,g,N,Pe-1,-Pe)}let K=N-1,W=1,Q=0;for(this[g+K]=l&255;--K>=0&&(W*=256);)l<0&&Q===0&&this[g+K+1]!==0&&(Q=1),this[g+K]=(l/W>>0)-Q&255;return g+N},D.prototype.writeInt8=function(l,g,N){return l=+l,g=g>>>0,N||Jt(this,l,g,1,127,-128),l<0&&(l=255+l+1),this[g]=l&255,g+1},D.prototype.writeInt16LE=function(l,g,N){return l=+l,g=g>>>0,N||Jt(this,l,g,2,32767,-32768),this[g]=l&255,this[g+1]=l>>>8,g+2},D.prototype.writeInt16BE=function(l,g,N){return l=+l,g=g>>>0,N||Jt(this,l,g,2,32767,-32768),this[g]=l>>>8,this[g+1]=l&255,g+2},D.prototype.writeInt32LE=function(l,g,N){return l=+l,g=g>>>0,N||Jt(this,l,g,4,2147483647,-2147483648),this[g]=l&255,this[g+1]=l>>>8,this[g+2]=l>>>16,this[g+3]=l>>>24,g+4},D.prototype.writeInt32BE=function(l,g,N){return l=+l,g=g>>>0,N||Jt(this,l,g,4,2147483647,-2147483648),l<0&&(l=4294967295+l+1),this[g]=l>>>24,this[g+1]=l>>>16,this[g+2]=l>>>8,this[g+3]=l&255,g+4},D.prototype.writeBigInt64LE=fr(function(l,g=0){return Jp(this,l,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),D.prototype.writeBigInt64BE=fr(function(l,g=0){return qp(this,l,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Wp(l,g,N,R,K,W){if(N+R>l.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("Index out of range")}function _p(l,g,N,R,K){return g=+g,N=N>>>0,K||Wp(l,g,N,4),I.write(l,g,N,R,23,4),N+4}D.prototype.writeFloatLE=function(l,g,N){return _p(this,l,g,!0,N)},D.prototype.writeFloatBE=function(l,g,N){return _p(this,l,g,!1,N)};function Gp(l,g,N,R,K){return g=+g,N=N>>>0,K||Wp(l,g,N,8),I.write(l,g,N,R,52,8),N+8}D.prototype.writeDoubleLE=function(l,g,N){return Gp(this,l,g,!0,N)},D.prototype.writeDoubleBE=function(l,g,N){return Gp(this,l,g,!1,N)},D.prototype.copy=function(l,g,N,R){if(!D.isBuffer(l))throw new TypeError("argument should be a Buffer");if(N||(N=0),!R&&R!==0&&(R=this.length),g>=l.length&&(g=l.length),g||(g=0),R>0&&R<N&&(R=N),R===N||l.length===0||this.length===0)return 0;if(g<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("Index out of range");if(R<0)throw new RangeError("sourceEnd out of bounds");R>this.length&&(R=this.length),l.length-g<R-N&&(R=l.length-g+N);const K=R-N;return this===l&&typeof T.prototype.copyWithin=="function"?this.copyWithin(g,N,R):T.prototype.set.call(l,this.subarray(N,R),g),K},D.prototype.fill=function(l,g,N,R){if(typeof l=="string"){if(typeof g=="string"?(R=g,g=0,N=this.length):typeof N=="string"&&(R=N,N=this.length),R!==void 0&&typeof R!="string")throw new TypeError("encoding must be a string");if(typeof R=="string"&&!D.isEncoding(R))throw new TypeError("Unknown encoding: "+R);if(l.length===1){const W=l.charCodeAt(0);(R==="utf8"&&W<128||R==="latin1")&&(l=W)}}else typeof l=="number"?l=l&255:typeof l=="boolean"&&(l=Number(l));if(g<0||this.length<g||this.length<N)throw new RangeError("Out of range index");if(N<=g)return this;g=g>>>0,N=N===void 0?this.length:N>>>0,l||(l=0);let K;if(typeof l=="number")for(K=g;K<N;++K)this[K]=l;else{const W=D.isBuffer(l)?l:D.from(l,R),Q=W.length;if(Q===0)throw new TypeError('The value "'+l+'" is invalid for argument "value"');for(K=0;K<N-g;++K)this[K+g]=W[K%Q]}return this};const si={};function Sm(l,g,N){si[l]=class extends N{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name="".concat(this.name," [").concat(l,"]"),this.stack,delete this.name}get code(){return l}set code(R){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:R,writable:!0})}toString(){return"".concat(this.name," [").concat(l,"]: ").concat(this.message)}}}Sm("ERR_BUFFER_OUT_OF_BOUNDS",function(l){return l?"".concat(l," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"},RangeError),Sm("ERR_INVALID_ARG_TYPE",function(l,g){return'The "'.concat(l,'" argument must be of type number. Received type ').concat(typeof g)},TypeError),Sm("ERR_OUT_OF_RANGE",function(l,g,N){let R='The value of "'.concat(l,'" is out of range.'),K=N;return Number.isInteger(N)&&Math.abs(N)>2**32?K=zp(String(N)):typeof N=="bigint"&&(K=String(N),(N>BigInt(2)**BigInt(32)||N<-(BigInt(2)**BigInt(32)))&&(K=zp(K)),K+="n"),R+=" It must be ".concat(g,". Received ").concat(K),R},RangeError);function zp(l){let g="",N=l.length;const R=l[0]==="-"?1:0;for(;N>=R+4;N-=3)g="_".concat(l.slice(N-3,N)).concat(g);return"".concat(l.slice(0,N)).concat(g)}function jw(l,g,N){ri(g,"offset"),(l[g]===void 0||l[g+N]===void 0)&&Qo(g,l.length-(N+1))}function Xp(l,g,N,R,K,W){if(l>N||l<g){const Q=typeof g=="bigint"?"n":"";let Pe;throw g===0||g===BigInt(0)?Pe=">= 0".concat(Q," and < 2").concat(Q," ** ").concat((W+1)*8).concat(Q):Pe=">= -(2".concat(Q," ** ").concat((W+1)*8-1).concat(Q,") and < 2 ** ").concat((W+1)*8-1).concat(Q),new si.ERR_OUT_OF_RANGE("value",Pe,l)}jw(R,K,W)}function ri(l,g){if(typeof l!="number")throw new si.ERR_INVALID_ARG_TYPE(g,"number",l)}function Qo(l,g,N){throw Math.floor(l)!==l?(ri(l,N),new si.ERR_OUT_OF_RANGE("offset","an integer",l)):g<0?new si.ERR_BUFFER_OUT_OF_BOUNDS:new si.ERR_OUT_OF_RANGE("offset",">= 0 and <= ".concat(g),l)}const $w=/[^+/0-9A-Za-z-_]/g;function Kw(l){if(l=l.split("=")[0],l=l.trim().replace($w,""),l.length<2)return"";for(;l.length%4!==0;)l=l+"=";return l}function Am(l,g){g=g||1/0;let N;const R=l.length;let K=null;const W=[];for(let Q=0;Q<R;++Q){if(N=l.charCodeAt(Q),N>55295&&N<57344){if(!K){if(N>56319){(g-=3)>-1&&W.push(239,191,189);continue}else if(Q+1===R){(g-=3)>-1&&W.push(239,191,189);continue}K=N;continue}if(N<56320){(g-=3)>-1&&W.push(239,191,189),K=N;continue}N=(K-55296<<10|N-56320)+65536}else K&&(g-=3)>-1&&W.push(239,191,189);if(K=null,N<128){if((g-=1)<0)break;W.push(N)}else if(N<2048){if((g-=2)<0)break;W.push(N>>6|192,N&63|128)}else if(N<65536){if((g-=3)<0)break;W.push(N>>12|224,N>>6&63|128,N&63|128)}else if(N<1114112){if((g-=4)<0)break;W.push(N>>18|240,N>>12&63|128,N>>6&63|128,N&63|128)}else throw new Error("Invalid code point")}return W}function Mw(l){const g=[];for(let N=0;N<l.length;++N)g.push(l.charCodeAt(N)&255);return g}function Hw(l,g){let N,R,K;const W=[];for(let Q=0;Q<l.length&&!((g-=2)<0);++Q)N=l.charCodeAt(Q),R=N>>8,K=N%256,W.push(K),W.push(R);return W}function Yp(l){return S.toByteArray(Kw(l))}function Pc(l,g,N,R){let K;for(K=0;K<R&&!(K+N>=g.length||K>=l.length);++K)g[K+N]=l[K];return K}function Is(l,g){return l instanceof g||l!=null&&l.constructor!=null&&l.constructor.name!=null&&l.constructor.name===g.name}function Nm(l){return l!==l}const Fw=function(){const l="0123456789abcdef",g=new Array(256);for(let N=0;N<16;++N){const R=N*16;for(let K=0;K<16;++K)g[R+K]=l[N]+l[K]}return g}();function fr(l){return typeof BigInt>"u"?Jw:l}function Jw(){throw new Error("BigInt not supported")}}(e);const k=e.Buffer;r.Blob=e.Blob,r.BlobOptions=e.BlobOptions,r.Buffer=e.Buffer,r.File=e.File,r.FileOptions=e.FileOptions,r.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,r.SlowBuffer=e.SlowBuffer,r.TranscodeEncoding=e.TranscodeEncoding,r.atob=e.atob,r.btoa=e.btoa,r.constants=e.constants,r.default=k,r.isAscii=e.isAscii,r.isUtf8=e.isUtf8,r.kMaxLength=e.kMaxLength,r.kStringMaxLength=e.kStringMaxLength,r.resolveObjectURL=e.resolveObjectURL,r.transcode=e.transcode}(Cd)),Cd}var xd;function n1(){return xd||(xd=1,function(r,e){var t=a1(),s=t.Buffer;function a(o,u){for(var h in o)u[h]=o[h]}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?r.exports=t:(a(t,e),e.Buffer=n);function n(o,u,h){return s(o,u,h)}n.prototype=Object.create(s.prototype),a(s,n),n.from=function(o,u,h){if(typeof o=="number")throw new TypeError("Argument must not be a number");return s(o,u,h)},n.alloc=function(o,u,h){if(typeof o!="number")throw new TypeError("Argument must be a number");var c=s(o);return u!==void 0?typeof h=="string"?c.fill(u,h):c.fill(u):c.fill(0),c},n.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return s(o)},n.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(o)}}($m,$m.exports)),$m.exports}var Bd;function i1(){if(Bd)return jm;Bd=1;var r=n1().Buffer,e=r.isEncoding||function(k){switch(k=""+k,k&&k.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(k){if(!k)return"utf8";for(var p;;)switch(k){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return k;default:if(p)return;k=(""+k).toLowerCase(),p=!0}}function s(k){var p=t(k);if(typeof p!="string"&&(r.isEncoding===e||!e(k)))throw new Error("Unknown encoding: "+k);return p||k}jm.StringDecoder=a;function a(k){this.encoding=s(k);var p;switch(this.encoding){case"utf16le":this.text=f,this.end=m,p=4;break;case"utf8":this.fillLast=h,p=4;break;case"base64":this.text=b,this.end=v,p=3;break;default:this.write=w,this.end=y;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(p)}a.prototype.write=function(k){if(k.length===0)return"";var p,S;if(this.lastNeed){if(p=this.fillLast(k),p===void 0)return"";S=this.lastNeed,this.lastNeed=0}else S=0;return S<k.length?p?p+this.text(k,S):this.text(k,S):p||""},a.prototype.end=i,a.prototype.text=c,a.prototype.fillLast=function(k){if(this.lastNeed<=k.length)return k.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);k.copy(this.lastChar,this.lastTotal-this.lastNeed,0,k.length),this.lastNeed-=k.length};function n(k){return k<=127?0:k>>5===6?2:k>>4===14?3:k>>3===30?4:k>>6===2?-1:-2}function o(k,p,S){var I=p.length-1;if(I<S)return 0;var P=n(p[I]);return P>=0?(P>0&&(k.lastNeed=P-1),P):--I<S||P===-2?0:(P=n(p[I]),P>=0?(P>0&&(k.lastNeed=P-2),P):--I<S||P===-2?0:(P=n(p[I]),P>=0?(P>0&&(P===2?P=0:k.lastNeed=P-3),P):0))}function u(k,p,S){if((p[0]&192)!==128)return k.lastNeed=0,"";if(k.lastNeed>1&&p.length>1){if((p[1]&192)!==128)return k.lastNeed=1,"";if(k.lastNeed>2&&p.length>2&&(p[2]&192)!==128)return k.lastNeed=2,""}}function h(k){var p=this.lastTotal-this.lastNeed,S=u(this,k);if(S!==void 0)return S;if(this.lastNeed<=k.length)return k.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);k.copy(this.lastChar,p,0,k.length),this.lastNeed-=k.length}function c(k,p){var S=o(this,k,p);if(!this.lastNeed)return k.toString("utf8",p);this.lastTotal=S;var I=k.length-(S-this.lastNeed);return k.copy(this.lastChar,0,I),k.toString("utf8",p,I)}function i(k){var p=k&&k.length?this.write(k):"";return this.lastNeed?p+"":p}function f(k,p){if((k.length-p)%2===0){var S=k.toString("utf16le",p);if(S){var I=S.charCodeAt(S.length-1);if(I>=55296&&I<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=k[k.length-2],this.lastChar[1]=k[k.length-1],S.slice(0,-1)}return S}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=k[k.length-1],k.toString("utf16le",p,k.length-1)}function m(k){var p=k&&k.length?this.write(k):"";if(this.lastNeed){var S=this.lastTotal-this.lastNeed;return p+this.lastChar.toString("utf16le",0,S)}return p}function b(k,p){var S=(k.length-p)%3;return S===0?k.toString("base64",p):(this.lastNeed=3-S,this.lastTotal=3,S===1?this.lastChar[0]=k[k.length-1]:(this.lastChar[0]=k[k.length-2],this.lastChar[1]=k[k.length-1]),k.toString("base64",p,k.length-S))}function v(k){var p=k&&k.length?this.write(k):"";return this.lastNeed?p+this.lastChar.toString("base64",0,3-this.lastNeed):p}function w(k){return k.toString(this.encoding)}function y(k){return k&&k.length?this.write(k):""}return jm}var o1=i1();const u1=Zw(o1);var Km={},Ep=(r=>(r.DEFAULT="default",r.HIDDEN="hidden",r))(Ep||{});class l1{constructor(e){tt(this,"_action");this.validateAction(e),this._action=e}get id(){return this._action.id}get displayName(){return this._action.displayName}get title(){return this._action.title}get iconSvgInline(){return this._action.iconSvgInline}get enabled(){return this._action.enabled}get exec(){return this._action.exec}get execBatch(){return this._action.execBatch}get hotkey(){return this._action.hotkey}get order(){return this._action.order}get parent(){return this._action.parent}get default(){return this._action.default}get destructive(){return this._action.destructive}get inline(){return this._action.inline}get renderInline(){return this._action.renderInline}validateAction(e){if(!e.id||typeof e.id!="string")throw new Error("Invalid id");if(!e.displayName||typeof e.displayName!="function")throw new Error("Invalid displayName function");if("title"in e&&typeof e.title!="function")throw new Error("Invalid title function");if(!e.iconSvgInline||typeof e.iconSvgInline!="function")throw new Error("Invalid iconSvgInline function");if(!e.exec||typeof e.exec!="function")throw new Error("Invalid exec function");if("enabled"in e&&typeof e.enabled!="function")throw new Error("Invalid enabled function");if("execBatch"in e&&typeof e.execBatch!="function")throw new Error("Invalid execBatch function");if("order"in e&&typeof e.order!="number")throw new Error("Invalid order");if(e.destructive!==void 0&&typeof e.destructive!="boolean")throw new Error("Invalid destructive flag");if("parent"in e&&typeof e.parent!="string")throw new Error("Invalid parent");if(e.default&&!Object.values(Ep).includes(e.default))throw new Error("Invalid default");if("inline"in e&&typeof e.inline!="function")throw new Error("Invalid inline function");if("renderInline"in e&&typeof e.renderInline!="function")throw new Error("Invalid renderInline function");if("hotkey"in e&&e.hotkey!==void 0){if(typeof e.hotkey!="object")throw new Error("Invalid hotkey configuration");if(typeof e.hotkey.key!="string"||!e.hotkey.key)throw new Error("Missing or invalid hotkey key");if(typeof e.hotkey.description!="string"||!e.hotkey.description)throw new Error("Missing or invalid hotkey description")}}}const c1=function(r){if(typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],Lo.debug("FileActions initialized")),window._nc_fileactions.find(e=>e.id===r.id)){Lo.error("FileAction ".concat(r.id," already registered"),{action:r});return}window._nc_fileactions.push(r)},h1=function(){return typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],Lo.debug("FileActions initialized")),window._nc_fileactions};var Od,Pd;function aw(){return Pd||(Pd=1,Od=typeof lt=="object"&&Km&&Km.NODE_DEBUG&&/\bsemver\b/i.test(Km.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{}),Od}var Mm,Dd;function nw(){if(Dd)return Mm;Dd=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,s=16,a=e-6;return Mm={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Mm}var Hm={exports:{}},Td;function m1(){return Td||(Td=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:a}=nw(),n=aw();e=r.exports={};const o=e.re=[],u=e.safeRe=[],h=e.src=[],c=e.safeSrc=[],i=e.t={};let f=0;const m="[a-zA-Z0-9-]",b=[["\\s",1],["\\d",a],[m,s]],v=y=>{for(const[k,p]of b)y=y.split("".concat(k,"*")).join("".concat(k,"{0,").concat(p,"}")).split("".concat(k,"+")).join("".concat(k,"{1,").concat(p,"}"));return y},w=(y,k,p)=>{const S=v(k),I=f++;n(y,I,k),i[y]=I,h[I]=k,c[I]=S,o[I]=new RegExp(k,p?"g":void 0),u[I]=new RegExp(S,p?"g":void 0)};w("NUMERICIDENTIFIER","0|[1-9]\\d*"),w("NUMERICIDENTIFIERLOOSE","\\d+"),w("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-]".concat(m,"*")),w("MAINVERSION","(".concat(h[i.NUMERICIDENTIFIER],")\\.(").concat(h[i.NUMERICIDENTIFIER],")\\.(").concat(h[i.NUMERICIDENTIFIER],")")),w("MAINVERSIONLOOSE","(".concat(h[i.NUMERICIDENTIFIERLOOSE],")\\.(").concat(h[i.NUMERICIDENTIFIERLOOSE],")\\.(").concat(h[i.NUMERICIDENTIFIERLOOSE],")")),w("PRERELEASEIDENTIFIER","(?:".concat(h[i.NONNUMERICIDENTIFIER],"|").concat(h[i.NUMERICIDENTIFIER],")")),w("PRERELEASEIDENTIFIERLOOSE","(?:".concat(h[i.NONNUMERICIDENTIFIER],"|").concat(h[i.NUMERICIDENTIFIERLOOSE],")")),w("PRERELEASE","(?:-(".concat(h[i.PRERELEASEIDENTIFIER],"(?:\\.").concat(h[i.PRERELEASEIDENTIFIER],")*))")),w("PRERELEASELOOSE","(?:-?(".concat(h[i.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(h[i.PRERELEASEIDENTIFIERLOOSE],")*))")),w("BUILDIDENTIFIER","".concat(m,"+")),w("BUILD","(?:\\+(".concat(h[i.BUILDIDENTIFIER],"(?:\\.").concat(h[i.BUILDIDENTIFIER],")*))")),w("FULLPLAIN","v?".concat(h[i.MAINVERSION]).concat(h[i.PRERELEASE],"?").concat(h[i.BUILD],"?")),w("FULL","^".concat(h[i.FULLPLAIN],"$")),w("LOOSEPLAIN","[v=\\s]*".concat(h[i.MAINVERSIONLOOSE]).concat(h[i.PRERELEASELOOSE],"?").concat(h[i.BUILD],"?")),w("LOOSE","^".concat(h[i.LOOSEPLAIN],"$")),w("GTLT","((?:<|>)?=?)"),w("XRANGEIDENTIFIERLOOSE","".concat(h[i.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),w("XRANGEIDENTIFIER","".concat(h[i.NUMERICIDENTIFIER],"|x|X|\\*")),w("XRANGEPLAIN","[v=\\s]*(".concat(h[i.XRANGEIDENTIFIER],")(?:\\.(").concat(h[i.XRANGEIDENTIFIER],")(?:\\.(").concat(h[i.XRANGEIDENTIFIER],")(?:").concat(h[i.PRERELEASE],")?").concat(h[i.BUILD],"?)?)?")),w("XRANGEPLAINLOOSE","[v=\\s]*(".concat(h[i.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(h[i.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(h[i.XRANGEIDENTIFIERLOOSE],")(?:").concat(h[i.PRERELEASELOOSE],")?").concat(h[i.BUILD],"?)?)?")),w("XRANGE","^".concat(h[i.GTLT],"\\s*").concat(h[i.XRANGEPLAIN],"$")),w("XRANGELOOSE","^".concat(h[i.GTLT],"\\s*").concat(h[i.XRANGEPLAINLOOSE],"$")),w("COERCEPLAIN","(^|[^\\d])(\\d{1,".concat(t,"})(?:\\.(\\d{1,").concat(t,"}))?(?:\\.(\\d{1,").concat(t,"}))?")),w("COERCE","".concat(h[i.COERCEPLAIN],"(?:$|[^\\d])")),w("COERCEFULL",h[i.COERCEPLAIN]+"(?:".concat(h[i.PRERELEASE],")?(?:").concat(h[i.BUILD],")?(?:$|[^\\d])")),w("COERCERTL",h[i.COERCE],!0),w("COERCERTLFULL",h[i.COERCEFULL],!0),w("LONETILDE","(?:~>?)"),w("TILDETRIM","(\\s*)".concat(h[i.LONETILDE],"\\s+"),!0),e.tildeTrimReplace="$1~",w("TILDE","^".concat(h[i.LONETILDE]).concat(h[i.XRANGEPLAIN],"$")),w("TILDELOOSE","^".concat(h[i.LONETILDE]).concat(h[i.XRANGEPLAINLOOSE],"$")),w("LONECARET","(?:\\^)"),w("CARETTRIM","(\\s*)".concat(h[i.LONECARET],"\\s+"),!0),e.caretTrimReplace="$1^",w("CARET","^".concat(h[i.LONECARET]).concat(h[i.XRANGEPLAIN],"$")),w("CARETLOOSE","^".concat(h[i.LONECARET]).concat(h[i.XRANGEPLAINLOOSE],"$")),w("COMPARATORLOOSE","^".concat(h[i.GTLT],"\\s*(").concat(h[i.LOOSEPLAIN],")$|^$")),w("COMPARATOR","^".concat(h[i.GTLT],"\\s*(").concat(h[i.FULLPLAIN],")$|^$")),w("COMPARATORTRIM","(\\s*)".concat(h[i.GTLT],"\\s*(").concat(h[i.LOOSEPLAIN],"|").concat(h[i.XRANGEPLAIN],")"),!0),e.comparatorTrimReplace="$1$2$3",w("HYPHENRANGE","^\\s*(".concat(h[i.XRANGEPLAIN],")\\s+-\\s+(").concat(h[i.XRANGEPLAIN],")\\s*$")),w("HYPHENRANGELOOSE","^\\s*(".concat(h[i.XRANGEPLAINLOOSE],")\\s+-\\s+(").concat(h[i.XRANGEPLAINLOOSE],")\\s*$")),w("STAR","(<|>)?=?\\s*\\*"),w("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),w("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Hm,Hm.exports)),Hm.exports}var Fm,Rd;function f1(){if(Rd)return Fm;Rd=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return Fm=t=>t?typeof t!="object"?r:t:e,Fm}var Jm,Ud;function p1(){if(Ud)return Jm;Ud=1;const r=/^[0-9]+$/,e=(t,s)=>{if(typeof t=="number"&&typeof s=="number")return t===s?0:t<s?-1:1;const a=r.test(t),n=r.test(s);return a&&n&&(t=+t,s=+s),t===s?0:a&&!n?-1:n&&!a?1:t<s?-1:1};return Jm={compareIdentifiers:e,rcompareIdentifiers:(t,s)=>e(s,t)},Jm}var qm,Ld;function iw(){if(Ld)return qm;Ld=1;const r=aw(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=nw(),{safeRe:s,t:a}=m1(),n=f1(),{compareIdentifiers:o}=p1();class u{constructor(c,i){if(i=n(i),c instanceof u){if(c.loose===!!i.loose&&c.includePrerelease===!!i.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError('Invalid version. Must be a string. Got type "'.concat(typeof c,'".'));if(c.length>e)throw new TypeError("version is longer than ".concat(e," characters"));r("SemVer",c,i),this.options=i,this.loose=!!i.loose,this.includePrerelease=!!i.includePrerelease;const f=c.trim().match(i.loose?s[a.LOOSE]:s[a.FULL]);if(!f)throw new TypeError("Invalid Version: ".concat(c));if(this.raw=c,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(m=>{if(/^[0-9]+$/.test(m)){const b=+m;if(b>=0&&b<t)return b}return m}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}toString(){return this.version}compare(c){if(r("SemVer.compare",this.version,this.options,c),!(c instanceof u)){if(typeof c=="string"&&c===this.version)return 0;c=new u(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof u||(c=new u(c,this.options)),this.major<c.major?-1:this.major>c.major?1:this.minor<c.minor?-1:this.minor>c.minor?1:this.patch<c.patch?-1:this.patch>c.patch?1:0}comparePre(c){if(c instanceof u||(c=new u(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let i=0;do{const f=this.prerelease[i],m=c.prerelease[i];if(r("prerelease compare",i,f,m),f===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(f===void 0)return-1;if(f!==m)return o(f,m)}while(++i)}compareBuild(c){c instanceof u||(c=new u(c,this.options));let i=0;do{const f=this.build[i],m=c.build[i];if(r("build compare",i,f,m),f===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(f===void 0)return-1;if(f!==m)return o(f,m)}while(++i)}inc(c,i,f){if(c.startsWith("pre")){if(!i&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(i){const m="-".concat(i).match(this.options.loose?s[a.PRERELEASELOOSE]:s[a.PRERELEASE]);if(!m||m[1]!==i)throw new Error("invalid identifier: ".concat(i))}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",i,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",i,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",i,f),this.inc("pre",i,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",i,f),this.inc("pre",i,f);break;case"release":if(this.prerelease.length===0)throw new Error("version ".concat(this.raw," is not a prerelease"));this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const m=Number(f)?1:0;if(this.prerelease.length===0)this.prerelease=[m];else{let b=this.prerelease.length;for(;--b>=0;)typeof this.prerelease[b]=="number"&&(this.prerelease[b]++,b=-2);if(b===-1){if(i===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(m)}}if(i){let b=[i,m];f===!1&&(b=[i]),o(this.prerelease[0],i)===0?isNaN(this.prerelease[1])&&(this.prerelease=b):this.prerelease=b}break}default:throw new Error("invalid increment argument: ".concat(c))}return this.raw=this.format(),this.build.length&&(this.raw+="+".concat(this.build.join("."))),this}}return qm=u,qm}var Wm,jd;function d1(){if(jd)return Wm;jd=1;const r=iw();return Wm=(e,t)=>new r(e,t).major,Wm}d1();var _m,$d;function g1(){if($d)return _m;$d=1;const r=iw();return _m=(e,t,s=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(a){if(!s)return null;throw a}},_m}var Gm,Kd;function w1(){if(Kd)return Gm;Kd=1;const r=g1();return Gm=(e,t)=>{const s=r(e,t);return s?s.version:null},Gm}w1();var Md={},Hd;function y1(){return Hd||(Hd=1,function(r){(function(e){e.parser=function(C,A){return new s(C,A)},e.SAXParser=s,e.SAXStream=i,e.createStream=c,e.MAX_BUFFER_LENGTH=64*1024;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function s(C,A){if(!(this instanceof s))return new s(C,A);var $=this;n($),$.q=$.c="",$.bufferCheckPosition=e.MAX_BUFFER_LENGTH,$.opt=A||{},$.opt.lowercase=$.opt.lowercase||$.opt.lowercasetags,$.looseCase=$.opt.lowercase?"toLowerCase":"toUpperCase",$.tags=[],$.closed=$.closedRoot=$.sawRoot=!1,$.tag=$.error=null,$.strict=!!C,$.noscript=!!(C||$.opt.noscript),$.state=V.BEGIN,$.strictEntities=$.opt.strictEntities,$.ENTITIES=$.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),$.attribList=[],$.opt.xmlns&&($.ns=Object.create(w)),$.opt.unquotedAttributeValues===void 0&&($.opt.unquotedAttributeValues=!C),$.trackPosition=$.opt.position!==!1,$.trackPosition&&($.position=$.line=$.column=0),F($,"onready")}Object.create||(Object.create=function(C){function A(){}A.prototype=C;var $=new A;return $}),Object.keys||(Object.keys=function(C){var A=[];for(var $ in C)C.hasOwnProperty($)&&A.push($);return A});function a(C){for(var A=Math.max(e.MAX_BUFFER_LENGTH,10),$=0,U=0,ge=t.length;U<ge;U++){var ke=C[t[U]].length;if(ke>A)switch(t[U]){case"textNode":j(C);break;case"cdata":D(C,"oncdata",C.cdata),C.cdata="";break;case"script":D(C,"onscript",C.script),C.script="";break;default:Y(C,"Max buffer length exceeded: "+t[U])}$=Math.max($,ke)}var he=e.MAX_BUFFER_LENGTH-$;C.bufferCheckPosition=he+C.position}function n(C){for(var A=0,$=t.length;A<$;A++)C[t[A]]=""}function o(C){j(C),C.cdata!==""&&(D(C,"oncdata",C.cdata),C.cdata=""),C.script!==""&&(D(C,"onscript",C.script),C.script="")}s.prototype={end:function(){oe(this)},write:Fe,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){o(this)}};var u;try{u=require("stream").Stream}catch(C){u=function(){}}u||(u=function(){});var h=e.EVENTS.filter(function(C){return C!=="error"&&C!=="end"});function c(C,A){return new i(C,A)}function i(C,A){if(!(this instanceof i))return new i(C,A);u.apply(this),this._parser=new s(C,A),this.writable=!0,this.readable=!0;var $=this;this._parser.onend=function(){$.emit("end")},this._parser.onerror=function(U){$.emit("error",U),$._parser.error=null},this._decoder=null,h.forEach(function(U){Object.defineProperty($,"on"+U,{get:function(){return $._parser["on"+U]},set:function(ge){if(!ge)return $.removeAllListeners(U),$._parser["on"+U]=ge,ge;$.on(U,ge)},enumerable:!0,configurable:!1})})}i.prototype=Object.create(u.prototype,{constructor:{value:i}}),i.prototype.write=function(C){if(typeof Im=="function"&&typeof Im.isBuffer=="function"&&Im.isBuffer(C)){if(!this._decoder){var A=u1.StringDecoder;this._decoder=new A("utf8")}C=this._decoder.write(C)}return this._parser.write(C.toString()),this.emit("data",C),!0},i.prototype.end=function(C){return C&&C.length&&this.write(C),this._parser.end(),!0},i.prototype.on=function(C,A){var $=this;return!$._parser["on"+C]&&h.indexOf(C)!==-1&&($._parser["on"+C]=function(){var U=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);U.splice(0,0,C),$.emit.apply($,U)}),u.prototype.on.call($,C,A)};var f="[CDATA[",m="DOCTYPE",b="http://www.w3.org/XML/1998/namespace",v="http://www.w3.org/2000/xmlns/",w={xml:b,xmlns:v},y=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,k=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,p=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,S=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function I(C){return C===" "||C==="\n"||C==="\r"||C==="	"}function P(C){return C==='"'||C==="'"}function x(C){return C===">"||I(C)}function T(C,A){return C.test(A)}function B(C,A){return!T(C,A)}var V=0;e.STATE={BEGIN:V++,BEGIN_WHITESPACE:V++,TEXT:V++,TEXT_ENTITY:V++,OPEN_WAKA:V++,SGML_DECL:V++,SGML_DECL_QUOTED:V++,DOCTYPE:V++,DOCTYPE_QUOTED:V++,DOCTYPE_DTD:V++,DOCTYPE_DTD_QUOTED:V++,COMMENT_STARTING:V++,COMMENT:V++,COMMENT_ENDING:V++,COMMENT_ENDED:V++,CDATA:V++,CDATA_ENDING:V++,CDATA_ENDING_2:V++,PROC_INST:V++,PROC_INST_BODY:V++,PROC_INST_ENDING:V++,OPEN_TAG:V++,OPEN_TAG_SLASH:V++,ATTRIB:V++,ATTRIB_NAME:V++,ATTRIB_NAME_SAW_WHITE:V++,ATTRIB_VALUE:V++,ATTRIB_VALUE_QUOTED:V++,ATTRIB_VALUE_CLOSED:V++,ATTRIB_VALUE_UNQUOTED:V++,ATTRIB_VALUE_ENTITY_Q:V++,ATTRIB_VALUE_ENTITY_U:V++,CLOSE_TAG:V++,CLOSE_TAG_SAW_WHITE:V++,SCRIPT:V++,SCRIPT_ENDING:V++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(C){var A=e.ENTITIES[C],$=typeof A=="number"?String.fromCharCode(A):A;e.ENTITIES[C]=$});for(var J in e.STATE)e.STATE[e.STATE[J]]=J;V=e.STATE;function F(C,A,$){C[A]&&C[A]($)}function D(C,A,$){C.textNode&&j(C),F(C,A,$)}function j(C){C.textNode=te(C.opt,C.textNode),C.textNode&&F(C,"ontext",C.textNode),C.textNode=""}function te(C,A){return C.trim&&(A=A.trim()),C.normalize&&(A=A.replace(/\s+/g," ")),A}function Y(C,A){return j(C),C.trackPosition&&(A+="\nLine: "+C.line+"\nColumn: "+C.column+"\nChar: "+C.c),A=new Error(A),C.error=A,F(C,"onerror",A),C}function oe(C){return C.sawRoot&&!C.closedRoot&&ne(C,"Unclosed root tag"),C.state!==V.BEGIN&&C.state!==V.BEGIN_WHITESPACE&&C.state!==V.TEXT&&Y(C,"Unexpected end"),j(C),C.c="",C.closed=!0,F(C,"onend"),s.call(C,C.strict,C.opt),C}function ne(C,A){if(typeof C!="object"||!(C instanceof s))throw new Error("bad call to strictFail");C.strict&&Y(C,A)}function de(C){C.strict||(C.tagName=C.tagName[C.looseCase]());var A=C.tags[C.tags.length-1]||C,$=C.tag={name:C.tagName,attributes:{}};C.opt.xmlns&&($.ns=A.ns),C.attribList.length=0,D(C,"onopentagstart",$)}function ie(C,A){var $=C.indexOf(":"),U=$<0?["",C]:C.split(":"),ge=U[0],ke=U[1];return A&&C==="xmlns"&&(ge="xmlns",ke=""),{prefix:ge,local:ke}}function re(C){if(C.strict||(C.attribName=C.attribName[C.looseCase]()),C.attribList.indexOf(C.attribName)!==-1||C.tag.attributes.hasOwnProperty(C.attribName)){C.attribName=C.attribValue="";return}if(C.opt.xmlns){var A=ie(C.attribName,!0),$=A.prefix,U=A.local;if($==="xmlns")if(U==="xml"&&C.attribValue!==b)ne(C,"xml: prefix must be bound to "+b+"\nActual: "+C.attribValue);else if(U==="xmlns"&&C.attribValue!==v)ne(C,"xmlns: prefix must be bound to "+v+"\nActual: "+C.attribValue);else{var ge=C.tag,ke=C.tags[C.tags.length-1]||C;ge.ns===ke.ns&&(ge.ns=Object.create(ke.ns)),ge.ns[U]=C.attribValue}C.attribList.push([C.attribName,C.attribValue])}else C.tag.attributes[C.attribName]=C.attribValue,D(C,"onattribute",{name:C.attribName,value:C.attribValue});C.attribName=C.attribValue=""}function se(C,A){if(C.opt.xmlns){var $=C.tag,U=ie(C.tagName);$.prefix=U.prefix,$.local=U.local,$.uri=$.ns[U.prefix]||"",$.prefix&&!$.uri&&(ne(C,"Unbound namespace prefix: "+JSON.stringify(C.tagName)),$.uri=U.prefix);var ge=C.tags[C.tags.length-1]||C;$.ns&&ge.ns!==$.ns&&Object.keys($.ns).forEach(function(Je){D(C,"onopennamespace",{prefix:Je,uri:$.ns[Je]})});for(var ke=0,he=C.attribList.length;ke<he;ke++){var Et=C.attribList[ke],bt=Et[0],js=Et[1],ot=ie(bt,!0),ps=ot.prefix,bm=ot.local,Oc=ps===""?"":$.ns[ps]||"",Yo={name:bt,value:js,prefix:ps,local:bm,uri:Oc};ps&&ps!=="xmlns"&&!Oc&&(ne(C,"Unbound namespace prefix: "+JSON.stringify(ps)),Yo.uri=ps),C.tag.attributes[bt]=Yo,D(C,"onattribute",Yo)}C.attribList.length=0}C.tag.isSelfClosing=!!A,C.sawRoot=!0,C.tags.push(C.tag),D(C,"onopentag",C.tag),A||(!C.noscript&&C.tagName.toLowerCase()==="script"?C.state=V.SCRIPT:C.state=V.TEXT,C.tag=null,C.tagName=""),C.attribName=C.attribValue="",C.attribList.length=0}function ee(C){if(!C.tagName){ne(C,"Weird empty close tag."),C.textNode+="</>",C.state=V.TEXT;return}if(C.script){if(C.tagName!=="script"){C.script+="</"+C.tagName+">",C.tagName="",C.state=V.SCRIPT;return}D(C,"onscript",C.script),C.script=""}var A=C.tags.length,$=C.tagName;C.strict||($=$[C.looseCase]());for(var U=$;A--;){var ge=C.tags[A];if(ge.name!==U)ne(C,"Unexpected close tag");else break}if(A<0){ne(C,"Unmatched closing tag: "+C.tagName),C.textNode+="</"+C.tagName+">",C.state=V.TEXT;return}C.tagName=$;for(var ke=C.tags.length;ke-- >A;){var he=C.tag=C.tags.pop();C.tagName=C.tag.name,D(C,"onclosetag",C.tagName);var Et={};for(var bt in he.ns)Et[bt]=he.ns[bt];var js=C.tags[C.tags.length-1]||C;C.opt.xmlns&&he.ns!==js.ns&&Object.keys(he.ns).forEach(function(ot){var ps=he.ns[ot];D(C,"onclosenamespace",{prefix:ot,uri:ps})})}A===0&&(C.closedRoot=!0),C.tagName=C.attribValue=C.attribName="",C.attribList.length=0,C.state=V.TEXT}function ce(C){var A=C.entity,$=A.toLowerCase(),U,ge="";return C.ENTITIES[A]?C.ENTITIES[A]:C.ENTITIES[$]?C.ENTITIES[$]:(A=$,A.charAt(0)==="#"&&(A.charAt(1)==="x"?(A=A.slice(2),U=parseInt(A,16),ge=U.toString(16)):(A=A.slice(1),U=parseInt(A,10),ge=U.toString(10))),A=A.replace(/^0+/,""),isNaN(U)||ge.toLowerCase()!==A?(ne(C,"Invalid character entity"),"&"+C.entity+";"):String.fromCodePoint(U))}function pe(C,A){A==="<"?(C.state=V.OPEN_WAKA,C.startTagPosition=C.position):I(A)||(ne(C,"Non-whitespace before first tag."),C.textNode=A,C.state=V.TEXT)}function Ce(C,A){var $="";return A<C.length&&($=C.charAt(A)),$}function Fe(C){var A=this;if(this.error)throw this.error;if(A.closed)return Y(A,"Cannot write after close. Assign an onready handler.");if(C===null)return oe(A);typeof C=="object"&&(C=C.toString());for(var $=0,U="";U=Ce(C,$++),A.c=U,!!U;)switch(A.trackPosition&&(A.position++,U==="\n"?(A.line++,A.column=0):A.column++),A.state){case V.BEGIN:if(A.state=V.BEGIN_WHITESPACE,U==="\uFEFF")continue;pe(A,U);continue;case V.BEGIN_WHITESPACE:pe(A,U);continue;case V.TEXT:if(A.sawRoot&&!A.closedRoot){for(var ge=$-1;U&&U!=="<"&&U!=="&";)U=Ce(C,$++),U&&A.trackPosition&&(A.position++,U==="\n"?(A.line++,A.column=0):A.column++);A.textNode+=C.substring(ge,$-1)}U==="<"&&!(A.sawRoot&&A.closedRoot&&!A.strict)?(A.state=V.OPEN_WAKA,A.startTagPosition=A.position):(!I(U)&&(!A.sawRoot||A.closedRoot)&&ne(A,"Text data outside of root node."),U==="&"?A.state=V.TEXT_ENTITY:A.textNode+=U);continue;case V.SCRIPT:U==="<"?A.state=V.SCRIPT_ENDING:A.script+=U;continue;case V.SCRIPT_ENDING:U==="/"?A.state=V.CLOSE_TAG:(A.script+="<"+U,A.state=V.SCRIPT);continue;case V.OPEN_WAKA:if(U==="!")A.state=V.SGML_DECL,A.sgmlDecl="";else if(!I(U))if(T(y,U))A.state=V.OPEN_TAG,A.tagName=U;else if(U==="/")A.state=V.CLOSE_TAG,A.tagName="";else if(U==="?")A.state=V.PROC_INST,A.procInstName=A.procInstBody="";else{if(ne(A,"Unencoded <"),A.startTagPosition+1<A.position){var ke=A.position-A.startTagPosition;U=new Array(ke).join(" ")+U}A.textNode+="<"+U,A.state=V.TEXT}continue;case V.SGML_DECL:if(A.sgmlDecl+U==="--"){A.state=V.COMMENT,A.comment="",A.sgmlDecl="";continue}A.doctype&&A.doctype!==!0&&A.sgmlDecl?(A.state=V.DOCTYPE_DTD,A.doctype+="<!"+A.sgmlDecl+U,A.sgmlDecl=""):(A.sgmlDecl+U).toUpperCase()===f?(D(A,"onopencdata"),A.state=V.CDATA,A.sgmlDecl="",A.cdata=""):(A.sgmlDecl+U).toUpperCase()===m?(A.state=V.DOCTYPE,(A.doctype||A.sawRoot)&&ne(A,"Inappropriately located doctype declaration"),A.doctype="",A.sgmlDecl=""):U===">"?(D(A,"onsgmldeclaration",A.sgmlDecl),A.sgmlDecl="",A.state=V.TEXT):(P(U)&&(A.state=V.SGML_DECL_QUOTED),A.sgmlDecl+=U);continue;case V.SGML_DECL_QUOTED:U===A.q&&(A.state=V.SGML_DECL,A.q=""),A.sgmlDecl+=U;continue;case V.DOCTYPE:U===">"?(A.state=V.TEXT,D(A,"ondoctype",A.doctype),A.doctype=!0):(A.doctype+=U,U==="["?A.state=V.DOCTYPE_DTD:P(U)&&(A.state=V.DOCTYPE_QUOTED,A.q=U));continue;case V.DOCTYPE_QUOTED:A.doctype+=U,U===A.q&&(A.q="",A.state=V.DOCTYPE);continue;case V.DOCTYPE_DTD:U==="]"?(A.doctype+=U,A.state=V.DOCTYPE):U==="<"?(A.state=V.OPEN_WAKA,A.startTagPosition=A.position):P(U)?(A.doctype+=U,A.state=V.DOCTYPE_DTD_QUOTED,A.q=U):A.doctype+=U;continue;case V.DOCTYPE_DTD_QUOTED:A.doctype+=U,U===A.q&&(A.state=V.DOCTYPE_DTD,A.q="");continue;case V.COMMENT:U==="-"?A.state=V.COMMENT_ENDING:A.comment+=U;continue;case V.COMMENT_ENDING:U==="-"?(A.state=V.COMMENT_ENDED,A.comment=te(A.opt,A.comment),A.comment&&D(A,"oncomment",A.comment),A.comment=""):(A.comment+="-"+U,A.state=V.COMMENT);continue;case V.COMMENT_ENDED:U!==">"?(ne(A,"Malformed comment"),A.comment+="--"+U,A.state=V.COMMENT):A.doctype&&A.doctype!==!0?A.state=V.DOCTYPE_DTD:A.state=V.TEXT;continue;case V.CDATA:U==="]"?A.state=V.CDATA_ENDING:A.cdata+=U;continue;case V.CDATA_ENDING:U==="]"?A.state=V.CDATA_ENDING_2:(A.cdata+="]"+U,A.state=V.CDATA);continue;case V.CDATA_ENDING_2:U===">"?(A.cdata&&D(A,"oncdata",A.cdata),D(A,"onclosecdata"),A.cdata="",A.state=V.TEXT):U==="]"?A.cdata+="]":(A.cdata+="]]"+U,A.state=V.CDATA);continue;case V.PROC_INST:U==="?"?A.state=V.PROC_INST_ENDING:I(U)?A.state=V.PROC_INST_BODY:A.procInstName+=U;continue;case V.PROC_INST_BODY:if(!A.procInstBody&&I(U))continue;U==="?"?A.state=V.PROC_INST_ENDING:A.procInstBody+=U;continue;case V.PROC_INST_ENDING:U===">"?(D(A,"onprocessinginstruction",{name:A.procInstName,body:A.procInstBody}),A.procInstName=A.procInstBody="",A.state=V.TEXT):(A.procInstBody+="?"+U,A.state=V.PROC_INST_BODY);continue;case V.OPEN_TAG:T(k,U)?A.tagName+=U:(de(A),U===">"?se(A):U==="/"?A.state=V.OPEN_TAG_SLASH:(I(U)||ne(A,"Invalid character in tag name"),A.state=V.ATTRIB));continue;case V.OPEN_TAG_SLASH:U===">"?(se(A,!0),ee(A)):(ne(A,"Forward-slash in opening tag not followed by >"),A.state=V.ATTRIB);continue;case V.ATTRIB:if(I(U))continue;U===">"?se(A):U==="/"?A.state=V.OPEN_TAG_SLASH:T(y,U)?(A.attribName=U,A.attribValue="",A.state=V.ATTRIB_NAME):ne(A,"Invalid attribute name");continue;case V.ATTRIB_NAME:U==="="?A.state=V.ATTRIB_VALUE:U===">"?(ne(A,"Attribute without value"),A.attribValue=A.attribName,re(A),se(A)):I(U)?A.state=V.ATTRIB_NAME_SAW_WHITE:T(k,U)?A.attribName+=U:ne(A,"Invalid attribute name");continue;case V.ATTRIB_NAME_SAW_WHITE:if(U==="=")A.state=V.ATTRIB_VALUE;else{if(I(U))continue;ne(A,"Attribute without value"),A.tag.attributes[A.attribName]="",A.attribValue="",D(A,"onattribute",{name:A.attribName,value:""}),A.attribName="",U===">"?se(A):T(y,U)?(A.attribName=U,A.state=V.ATTRIB_NAME):(ne(A,"Invalid attribute name"),A.state=V.ATTRIB)}continue;case V.ATTRIB_VALUE:if(I(U))continue;P(U)?(A.q=U,A.state=V.ATTRIB_VALUE_QUOTED):(A.opt.unquotedAttributeValues||Y(A,"Unquoted attribute value"),A.state=V.ATTRIB_VALUE_UNQUOTED,A.attribValue=U);continue;case V.ATTRIB_VALUE_QUOTED:if(U!==A.q){U==="&"?A.state=V.ATTRIB_VALUE_ENTITY_Q:A.attribValue+=U;continue}re(A),A.q="",A.state=V.ATTRIB_VALUE_CLOSED;continue;case V.ATTRIB_VALUE_CLOSED:I(U)?A.state=V.ATTRIB:U===">"?se(A):U==="/"?A.state=V.OPEN_TAG_SLASH:T(y,U)?(ne(A,"No whitespace between attributes"),A.attribName=U,A.attribValue="",A.state=V.ATTRIB_NAME):ne(A,"Invalid attribute name");continue;case V.ATTRIB_VALUE_UNQUOTED:if(!x(U)){U==="&"?A.state=V.ATTRIB_VALUE_ENTITY_U:A.attribValue+=U;continue}re(A),U===">"?se(A):A.state=V.ATTRIB;continue;case V.CLOSE_TAG:if(A.tagName)U===">"?ee(A):T(k,U)?A.tagName+=U:A.script?(A.script+="</"+A.tagName,A.tagName="",A.state=V.SCRIPT):(I(U)||ne(A,"Invalid tagname in closing tag"),A.state=V.CLOSE_TAG_SAW_WHITE);else{if(I(U))continue;B(y,U)?A.script?(A.script+="</"+U,A.state=V.SCRIPT):ne(A,"Invalid tagname in closing tag."):A.tagName=U}continue;case V.CLOSE_TAG_SAW_WHITE:if(I(U))continue;U===">"?ee(A):ne(A,"Invalid characters in closing tag");continue;case V.TEXT_ENTITY:case V.ATTRIB_VALUE_ENTITY_Q:case V.ATTRIB_VALUE_ENTITY_U:var he,Et;switch(A.state){case V.TEXT_ENTITY:he=V.TEXT,Et="textNode";break;case V.ATTRIB_VALUE_ENTITY_Q:he=V.ATTRIB_VALUE_QUOTED,Et="attribValue";break;case V.ATTRIB_VALUE_ENTITY_U:he=V.ATTRIB_VALUE_UNQUOTED,Et="attribValue";break}if(U===";"){var bt=ce(A);A.opt.unparsedEntities&&!Object.values(e.XML_ENTITIES).includes(bt)?(A.entity="",A.state=he,A.write(bt)):(A[Et]+=bt,A.entity="",A.state=he)}else T(A.entity.length?S:p,U)?A.entity+=U:(ne(A,"Invalid character in entity name"),A[Et]+="&"+A.entity+U,A.entity="",A.state=he);continue;default:throw new Error(A,"Unknown state: "+A.state)}return A.position>=A.bufferCheckPosition&&a(A),A}String.fromCodePoint||function(){var C=String.fromCharCode,A=Math.floor,$=function(){var U=16384,ge=[],ke,he,Et=-1,bt=arguments.length;if(!bt)return"";for(var js="";++Et<bt;){var ot=Number(arguments[Et]);if(!isFinite(ot)||ot<0||ot>1114111||A(ot)!==ot)throw RangeError("Invalid code point: "+ot);ot<=65535?ge.push(ot):(ot-=65536,ke=(ot>>10)+55296,he=ot%1024+56320,ge.push(ke,he)),(Et+1===bt||ge.length>U)&&(js+=C.apply(null,ge),ge.length=0)}return js};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:$,configurable:!0,writable:!0}):String.fromCodePoint=$}()})(r)}(Md)),Md}y1();function v1(r){return typeof r=="function"?r:Array.isArray(r)?e=>{for(const t of r)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}const b1="\n";function S1(r,e){let t="";return e.format&&e.indentBy.length>0&&(t=b1),ow(r,e,"",t)}function ow(r,e,t,s){let a="",n=!1;for(let o=0;o<r.length;o++){const u=r[o],h=A1(u);if(h===void 0)continue;let c="";if(t.length===0?c=h:c="".concat(t,".").concat(h),h===e.textNodeName){let v=u[h];N1(c,e)||(v=e.tagValueProcessor(h,v),v=uw(v,e)),n&&(a+=s),a+=v,n=!1;continue}else if(h===e.cdataPropName){n&&(a+=s),a+="<![CDATA[".concat(u[h][0][e.textNodeName],"]]>"),n=!1;continue}else if(h===e.commentPropName){a+=s+"<!--".concat(u[h][0][e.textNodeName],"-->"),n=!0;continue}else if(h[0]==="?"){const v=Fd(u[":@"],e),w=h==="?xml"?"":s;let y=u[h][0][e.textNodeName];y=y.length!==0?" "+y:"",a+=w+"<".concat(h).concat(y).concat(v,"?>"),n=!0;continue}let i=s;i!==""&&(i+=e.indentBy);const f=Fd(u[":@"],e),m=s+"<".concat(h).concat(f),b=ow(u[h],e,c,i);e.unpairedTags.indexOf(h)!==-1?e.suppressUnpairedNode?a+=m+">":a+=m+"/>":(!b||b.length===0)&&e.suppressEmptyNode?a+=m+"/>":b&&b.endsWith(">")?a+=m+">".concat(b).concat(s,"</").concat(h,">"):(a+=m+">",b&&s!==""&&(b.includes("/>")||b.includes("</"))?a+=s+e.indentBy+b+s:a+=b,a+="</".concat(h,">")),n=!0}return a}function A1(r){const e=Object.keys(r);for(let t=0;t<e.length;t++){const s=e[t];if(r.hasOwnProperty(s)&&s!==":@")return s}}function Fd(r,e){let t="";if(r&&!e.ignoreAttributes)for(let s in r){if(!r.hasOwnProperty(s))continue;let a=e.attributeValueProcessor(s,r[s]);a=uw(a,e),a===!0&&e.suppressBooleanAttributes?t+=" ".concat(s.substr(e.attributeNamePrefix.length)):t+=" ".concat(s.substr(e.attributeNamePrefix.length),'="').concat(a,'"')}return t}function N1(r,e){r=r.substr(0,r.length-e.textNodeName.length-1);let t=r.substr(r.lastIndexOf(".")+1);for(let s in e.stopNodes)if(e.stopNodes[s]===r||e.stopNodes[s]==="*."+t)return!0;return!1}function uw(r,e){if(r&&r.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const s=e.entities[t];r=r.replace(s.regex,s.val)}return r}const E1={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function pa(r){this.options=Object.assign({},E1,r),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=v1(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=C1),this.processTextOrObjNode=k1,this.options.format?(this.indentate=I1,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}pa.prototype.build=function(r){return this.options.preserveOrder?S1(r,this.options):(Array.isArray(r)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(r={[this.options.arrayNodeName]:r}),this.j2x(r,0,[]).val)},pa.prototype.j2x=function(r,e,t){let s="",a="";const n=t.join(".");for(let o in r)if(Object.prototype.hasOwnProperty.call(r,o))if(typeof r[o]>"u")this.isAttribute(o)&&(a+="");else if(r[o]===null)this.isAttribute(o)||o===this.options.cdataPropName?a+="":o[0]==="?"?a+=this.indentate(e)+"<"+o+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+o+"/"+this.tagEndChar;else if(r[o]instanceof Date)a+=this.buildTextValNode(r[o],o,"",e);else if(typeof r[o]!="object"){const u=this.isAttribute(o);if(u&&!this.ignoreAttributesFn(u,n))s+=this.buildAttrPairStr(u,""+r[o]);else if(!u)if(o===this.options.textNodeName){let h=this.options.tagValueProcessor(o,""+r[o]);a+=this.replaceEntitiesValue(h)}else a+=this.buildTextValNode(r[o],o,"",e)}else if(Array.isArray(r[o])){const u=r[o].length;let h="",c="";for(let i=0;i<u;i++){const f=r[o][i];if(!(typeof f>"u"))if(f===null)o[0]==="?"?a+=this.indentate(e)+"<"+o+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+o+"/"+this.tagEndChar;else if(typeof f=="object")if(this.options.oneListGroup){const m=this.j2x(f,e+1,t.concat(o));h+=m.val,this.options.attributesGroupName&&f.hasOwnProperty(this.options.attributesGroupName)&&(c+=m.attrStr)}else h+=this.processTextOrObjNode(f,o,e,t);else if(this.options.oneListGroup){let m=this.options.tagValueProcessor(o,f);m=this.replaceEntitiesValue(m),h+=m}else h+=this.buildTextValNode(f,o,"",e)}this.options.oneListGroup&&(h=this.buildObjectNode(h,o,c,e)),a+=h}else if(this.options.attributesGroupName&&o===this.options.attributesGroupName){const u=Object.keys(r[o]),h=u.length;for(let c=0;c<h;c++)s+=this.buildAttrPairStr(u[c],""+r[o][u[c]])}else a+=this.processTextOrObjNode(r[o],o,e,t);return{attrStr:s,val:a}},pa.prototype.buildAttrPairStr=function(r,e){return e=this.options.attributeValueProcessor(r,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+r:" "+r+'="'+e+'"'};function k1(r,e,t,s){const a=this.j2x(r,t+1,s.concat(e));return r[this.options.textNodeName]!==void 0&&Object.keys(r).length===1?this.buildTextValNode(r[this.options.textNodeName],e,a.attrStr,t):this.buildObjectNode(a.val,e,a.attrStr,t)}pa.prototype.buildObjectNode=function(r,e,t,s){if(r==="")return e[0]==="?"?this.indentate(s)+"<"+e+t+"?"+this.tagEndChar:this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let a="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",a=""),(t||t==="")&&r.indexOf("<")===-1?this.indentate(s)+"<"+e+t+n+">"+r+a:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(s)+"<!--".concat(r,"-->")+this.newLine:this.indentate(s)+"<"+e+t+n+this.tagEndChar+r+this.indentate(s)+a}},pa.prototype.closeTag=function(r){let e="";return this.options.unpairedTags.indexOf(r)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e="></".concat(r),e},pa.prototype.buildTextValNode=function(r,e,t,s){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(s)+"<![CDATA[".concat(r,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(s)+"<!--".concat(r,"-->")+this.newLine;if(e[0]==="?")return this.indentate(s)+"<"+e+t+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(e,r);return a=this.replaceEntitiesValue(a),a===""?this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(s)+"<"+e+t+">"+a+"</"+e+this.tagEndChar}},pa.prototype.replaceEntitiesValue=function(r){if(r&&r.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];r=r.replace(t.regex,t.val)}return r};function I1(r){return this.options.indentBy.repeat(r)}function C1(r){return r.startsWith(this.options.attributeNamePrefix)&&r!==this.options.textNodeName?r.substr(this.attrPrefixLen):!1}function fh(r){return r.users!==void 0}const V1=r=>r===null?xf().setApp("end_to_end_encryption").build():xf().setApp("end_to_end_encryption").setUid(r.uid).build(),ht=V1(pp());class Le{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let s=0;s<t;s++)this.view[s]=e.charCodeAt(s)}toString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)s+=String.fromCharCode(this.view[a]);return s}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const s=new Map;s.set("0",0),s.set("1",1),s.set("2",2),s.set("3",3),s.set("4",4),s.set("5",5),s.set("6",6),s.set("7",7),s.set("8",8),s.set("9",9),s.set("A",10),s.set("a",10),s.set("B",11),s.set("b",11),s.set("C",12),s.set("c",12),s.set("D",13),s.set("d",13),s.set("E",14),s.set("e",14),s.set("F",15),s.set("f",15);let a=0,n=0;for(let o=0;o<t;o++)o%2?(n|=s.get(e.charAt(o)),this.view[a]=n,a++):n=s.get(e.charAt(o))<<4}toHexString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){const n=this.view[a].toString(16).toUpperCase();s=s+(n.length==1?"0":"")+n}return s}copy(e=0,t=this.length-e){if(!e&&!this.length)return new Le;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Le({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new Le;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Le({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),s=new Uint8Array(t);e>this._view.length?s.set(this._view):s.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,s=e.length,a=e._view.subarray();this.realloc(t+s),this._view.set(a,t)}insert(e,t=0,s=this.length-t){return t>this.length-1?!1:(s>this.length-t&&(s=this.length-t),s>e.length&&(s=e.length),s==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,s),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,s,a){const{start:n,length:o,backward:u}=this.prepareFindParameters(t,s,a),h=e.length;if(h>o)return-1;const c=[];for(let i=0;i<h;i++)c.push(e.view[i]);for(let i=0;i<=o-h;i++){let f=!0;const m=u?n-h-i:n+i;for(let b=0;b<h;b++)if(this.view[b+m]!=c[b]){f=!1;break}if(f)return u?n-h-i:n+h+i}return-1}findFirstIn(e,t,s,a){const{start:n,length:o,backward:u}=this.prepareFindParameters(t,s,a),h={id:-1,position:u?0:n+o,length:0};for(let c=0;c<e.length;c++){const i=this.findPattern(e[c],n,o,u);if(i!=-1){let f=!1;const m=e[c].length;u?i-m>=h.position-h.length&&(f=!0):i-m<=h.position-h.length&&(f=!0),f&&(h.position=i,h.id=c,h.length=m)}}return h}findAllIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const o=[];let u={id:-1,position:a};do{const h=u.position;if(u=this.findFirstIn(e,u.position,n),u.id==-1)break;n-=u.position-h,o.push({id:u.id,position:u.position})}while(!0);return o}findAllPatternIn(e,t,s){const{start:a,length:n}=this.prepareFindParameters(t,s),o=[],u=e.length;if(u>n)return-1;const h=Array.from(e.view);for(let c=0;c<=n-u;c++){let i=!0;const f=a+c;for(let m=0;m<u;m++)if(this.view[m+f]!=h[m]){i=!1;break}i&&(o.push(a+u+c),c+=u-1)}return o}findFirstNotIn(e,t,s,a){let{start:n,length:o,backward:u}=this.prepareFindParameters(t,s,a);const h={left:{id:-1,position:n},right:{id:-1,position:0},value:new Le};let c=o;for(;c>0;){if(h.right=this.findFirstIn(e,u?n-o+c:n+o-c,c,u),h.right.id==-1){o=c,u?n-=o:n=h.left.position,h.value=new Le({buffer:this._buffer.slice(n,n+o)});break}if(h.right.position!=(u?h.left.position-e[h.right.id].length:h.left.position+e[h.right.id].length)){u?(n=h.right.position+e[h.right.id].length,o=h.left.position-h.right.position-e[h.right.id].length):(n=h.left.position,o=h.right.position-h.left.position-e[h.right.id].length),h.value=new Le({buffer:this._buffer.slice(n,n+o)});break}h.left=h.right,c-=e[h.right.id].length}if(u){const i=h.right;h.right=h.left,h.left=i}return h}findAllNotIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const o=[];let u={left:{id:-1,position:a},right:{id:-1,position:a},value:new Le};do{const h=u.right.position;u=this.findFirstNotIn(e,u.right.position,n),n-=u.right.position-h,o.push({left:{id:u.left.id,position:u.left.position},right:{id:u.right.id,position:u.right.position},value:u.value})}while(u.right.id!=-1);return o}findFirstSequence(e,t,s,a){let{start:n,length:o,backward:u}=this.prepareFindParameters(t,s,a);const h=this.skipNotPatterns(e,n,o,u);if(h==-1)return{position:-1,value:new Le};const c=this.skipPatterns(e,h,o-(u?n-h:h-n),u);u?(n=c,o=h-c):(n=h,o=c-h);const i=new Le({buffer:this._buffer.slice(n,n+o)});return{position:c,value:i}}findAllSequences(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const o=[];let u={position:a,value:new Le};do{const h=u.position;u=this.findFirstSequence(e,u.position,n),u.position!=-1&&(n-=u.position-h,o.push({position:u.position,value:u.value}))}while(u.position!=-1);return o}findPairedPatterns(e,t,s,a){const n=[];if(e.isEqual(t))return n;const{start:o,length:u}=this.prepareFindParameters(s,a);let h=0;const c=this.findAllPatternIn(e,o,u);if(!Array.isArray(c)||c.length==0)return n;const i=this.findAllPatternIn(t,o,u);if(!Array.isArray(i)||i.length==0)return n;for(;h<c.length&&i.length!=0;){if(c[0]==i[0]){n.push({left:c[0],right:i[0]}),c.splice(0,1),i.splice(0,1);continue}if(c[h]>i[0])break;for(;c[h]<i[0]&&(h++,!(h>=c.length)););n.push({left:c[h-1],right:i[0]}),c.splice(h-1,1),i.splice(0,1),h=0}return n.sort((f,m)=>f.left-m.left),n}findPairedArrays(e,t,s,a){const{start:n,length:o}=this.prepareFindParameters(s,a),u=[];let h=0;const c=this.findAllIn(e,n,o);if(c.length==0)return u;const i=this.findAllIn(t,n,o);if(i.length==0)return u;for(;h<c.length&&i.length!=0;){if(c[0].position==i[0].position){u.push({left:c[0],right:i[0]}),c.splice(0,1),i.splice(0,1);continue}if(c[h].position>i[0].position)break;for(;c[h].position<i[0].position&&(h++,!(h>=c.length)););u.push({left:c[h-1],right:i[0]}),c.splice(h-1,1),i.splice(0,1),h=0}return u.sort((f,m)=>f.left.position-m.left.position),u}replacePattern(e,t,s,a,n=null){let o=[],u;const h={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:c,length:i}=this.prepareFindParameters(s,a);if(n==null){if(o=this.findAllIn([e],c,i),o.length==0)return h}else o=n;h.searchPatternPositions.push(...Array.from(o,v=>v.position));const f=e.length-t.length,m=new ArrayBuffer(this.view.length-o.length*f),b=new Uint8Array(m);for(b.set(new Uint8Array(this.buffer,0,c)),u=0;u<o.length;u++){const v=u==0?c:o[u-1].position;b.set(new Uint8Array(this.buffer,v,o[u].position-e.length-v),v-u*f),b.set(t.view,o[u].position-e.length-u*f),h.replacePatternPositions.push(o[u].position-e.length-u*f)}return u--,b.set(new Uint8Array(this.buffer,o[u].position,this.length-o[u].position),o[u].position-e.length+t.length-u*f),this.buffer=m,this.view=new Uint8Array(this.buffer),h.status=1,h}skipPatterns(e,t,s,a){const{start:n,length:o,backward:u}=this.prepareFindParameters(t,s,a);let h=n;for(let c=0;c<e.length;c++){const i=e[c].length,f=u?h-i:h;let m=!0;for(let b=0;b<i;b++)if(this.view[b+f]!=e[c].view[b]){m=!1;break}if(m){if(c=-1,u){if(h-=i,h<=0)return h}else if(h+=i,h>=n+o)return h}}return h}skipNotPatterns(e,t,s,a){const{start:n,length:o,backward:u}=this.prepareFindParameters(t,s,a);let h=-1;for(let c=0;c<o;c++){for(let i=0;i<e.length;i++){const f=e[i].length,m=u?n-c-f:n+c;let b=!0;for(let v=0;v<f;v++)if(this.view[v+m]!=e[i].view[v]){b=!1;break}if(b){h=u?n-c:n+c;break}}if(h!=-1)break}return h}prepareFindParameters(e=null,t=null,s=!1){return e===null&&(e=s?this.length:0),e>this.length&&(e=this.length),s?(t===null&&(t=e),t>e&&(t=e)):(t===null&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:s}}}const x1=16777216;class Sa{constructor(e={}){this._stream=new Le,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new Le({view:e.view}):"buffer"in e?this.stream=new Le({buffer:e.buffer}):"string"in e?this.stream=new Le({string:e.string}):"hexstring"in e?this.stream=new Le({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new Le,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findPattern(e,this.start,this.length,this.backward);if(s==-1)return s;if(this.backward){if(s<this.start-e.length-t)return-1}else if(s>this.start+e.length+t)return-1;return this.start=s,s}findFirstIn(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(s.id==-1)return s;if(this.backward){if(s.position<this.start-e[s.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(s.position>this.start+e[s.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=s.position,s}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(t==null||t>this._length)&&(t=this._length);const s=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(s.left.id==-1&&s.right.id==-1)return s;if(this.backward){if(s.right.id!=-1&&s.right.position<this._start-e[s.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Le}}else if(s.left.id!=-1&&s.left.position>this._start+e[s.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Le};return this.backward?s.left.id==-1?this.start=0:this.start=s.left.position:s.right.id==-1?this.start=this._start+this._length:this.start=s.right.position,s}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,s=null){(t==null||t>this._length)&&(t=this._length),(s==null||s>t)&&(s=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(a.value.length==0)return a;if(this.backward){if(a.position<this._start-a.value.length-s)return{position:-1,value:new Le}}else if(a.position>this._start+a.value.length+s)return{position:-1,value:new Le};return this.start=a.position,a}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right<this.start-t.length-s)return[]}else if(n[0].left>this.start+e.length+s)return[]}return n}findPairedArrays(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-s)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+s)return[]}return n}replacePattern(e,t){const s=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,s,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return t==-1?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),s=new Uint8Array(t.buffer);this.stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[2],this._stream.view[this._start+1]=s[1],this._stream.view[this._start+2]=s[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);this._length<e&&(e=this._length);let s;if(this.backward){const a=this._stream.view.subarray(this._length-e,this._length);s=new Uint8Array(e);for(let n=0;n<e;n++)s[e-1-n]=a[n]}else s=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),s}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),s=32768;return t&s?-(s-(t^s)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:t[0]*x1+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),s=2147483648;return t&s?-(s-(t^s)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+Sa.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}Sa.APPEND_BLOCK=1e3;function B1(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function lw(r,...e){if(!B1(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Jd(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function O1(r,e){lw(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const zm=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Vs=(r,e)=>r<<32-e|r>>>e,Xm=(r,e)=>r<<e|r>>>32-e>>>0;function P1(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function cw(r){return typeof r=="string"&&(r=P1(r)),lw(r),r}class D1{clone(){return this._cloneInto()}}function wm(r){const e=s=>r().update(cw(s)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function T1(r,e,t,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,s);const a=BigInt(32),n=BigInt(4294967295),o=Number(t>>a&n),u=Number(t&n),h=s?4:0,c=s?0:4;r.setUint32(e+h,o,s),r.setUint32(e+c,u,s)}const hw=(r,e,t)=>r&e^~r&t,mw=(r,e,t)=>r&e^r&t^e&t;class kp extends D1{constructor(e,t,s,a){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=zm(this.buffer)}update(e){Jd(this);const{view:t,buffer:s,blockLen:a}=this;e=cw(e);const n=e.length;for(let o=0;o<n;){const u=Math.min(a-this.pos,n-o);if(u===a){const h=zm(e);for(;a<=n-o;o+=a)this.process(h,o);continue}s.set(e.subarray(o,o+u),this.pos),this.pos+=u,o+=u,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Jd(this),O1(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:a,isLE:n}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>a-o&&(this.process(s,0),o=0);for(let f=o;f<a;f++)t[f]=0;T1(s,a-8,BigInt(this.length*8),n),this.process(s,0);const u=zm(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=h/4,i=this.get();if(c>i.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)u.setUint32(4*f,i[f],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:a,finished:n,destroyed:o,pos:u}=this;return e.length=a,e.pos=u,e.finished=n,e.destroyed=o,a%t&&e.buffer.set(s),e}}const su=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),dr=new Uint32Array(80);let R1=class extends kp{constructor(){super(64,20,8,!1),this.A=su[0]|0,this.B=su[1]|0,this.C=su[2]|0,this.D=su[3]|0,this.E=su[4]|0}get(){const{A:r,B:e,C:t,D:s,E:a}=this;return[r,e,t,s,a]}set(r,e,t,s,a){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0}process(r,e){for(let u=0;u<16;u++,e+=4)dr[u]=r.getUint32(e,!1);for(let u=16;u<80;u++)dr[u]=Xm(dr[u-3]^dr[u-8]^dr[u-14]^dr[u-16],1);let{A:t,B:s,C:a,D:n,E:o}=this;for(let u=0;u<80;u++){let h,c;u<20?(h=hw(s,a,n),c=1518500249):u<40?(h=s^a^n,c=1859775393):u<60?(h=mw(s,a,n),c=2400959708):(h=s^a^n,c=3395469782);const i=Xm(t,5)+h+o+c+dr[u]|0;o=n,n=a,a=Xm(s,30),s=t,t=i}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,o=o+this.E|0,this.set(t,s,a,n,o)}roundClean(){dr.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}};const U1=wm(()=>new R1),L1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),gr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),wr=new Uint32Array(64);let j1=class extends kp{constructor(){super(64,32,8,!1),this.A=gr[0]|0,this.B=gr[1]|0,this.C=gr[2]|0,this.D=gr[3]|0,this.E=gr[4]|0,this.F=gr[5]|0,this.G=gr[6]|0,this.H=gr[7]|0}get(){const{A:r,B:e,C:t,D:s,E:a,F:n,G:o,H:u}=this;return[r,e,t,s,a,n,o,u]}set(r,e,t,s,a,n,o,u){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0,this.F=n|0,this.G=o|0,this.H=u|0}process(r,e){for(let i=0;i<16;i++,e+=4)wr[i]=r.getUint32(e,!1);for(let i=16;i<64;i++){const f=wr[i-15],m=wr[i-2],b=Vs(f,7)^Vs(f,18)^f>>>3,v=Vs(m,17)^Vs(m,19)^m>>>10;wr[i]=v+wr[i-7]+b+wr[i-16]|0}let{A:t,B:s,C:a,D:n,E:o,F:u,G:h,H:c}=this;for(let i=0;i<64;i++){const f=Vs(o,6)^Vs(o,11)^Vs(o,25),m=c+f+hw(o,u,h)+L1[i]+wr[i]|0,b=(Vs(t,2)^Vs(t,13)^Vs(t,22))+mw(t,s,a)|0;c=h,h=u,u=o,o=n+m|0,n=a,a=s,s=t,t=m+b|0}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,o=o+this.E|0,u=u+this.F|0,h=h+this.G|0,c=c+this.H|0,this.set(t,s,a,n,o,u,h,c)}roundClean(){wr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const $1=wm(()=>new j1),Lc=BigInt(2**32-1),Hf=BigInt(32);function fw(r,e=!1){return e?{h:Number(r&Lc),l:Number(r>>Hf&Lc)}:{h:Number(r>>Hf&Lc)|0,l:Number(r&Lc)|0}}function K1(r,e=!1){let t=new Uint32Array(r.length),s=new Uint32Array(r.length);for(let a=0;a<r.length;a++){const{h:n,l:o}=fw(r[a],e);[t[a],s[a]]=[n,o]}return[t,s]}const M1=(r,e)=>BigInt(r>>>0)<<Hf|BigInt(e>>>0),H1=(r,e,t)=>r>>>t,F1=(r,e,t)=>r<<32-t|e>>>t,J1=(r,e,t)=>r>>>t|e<<32-t,q1=(r,e,t)=>r<<32-t|e>>>t,W1=(r,e,t)=>r<<64-t|e>>>t-32,_1=(r,e,t)=>r>>>t-32|e<<64-t,G1=(r,e)=>e,z1=(r,e)=>r,X1=(r,e,t)=>r<<t|e>>>32-t,Y1=(r,e,t)=>e<<t|r>>>32-t,Q1=(r,e,t)=>e<<t-32|r>>>64-t,Z1=(r,e,t)=>r<<t-32|e>>>64-t;function ev(r,e,t,s){const a=(e>>>0)+(s>>>0);return{h:r+t+(a/2**32|0)|0,l:a|0}}const tv=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),sv=(r,e,t,s)=>e+t+s+(r/2**32|0)|0,rv=(r,e,t,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0),av=(r,e,t,s,a)=>e+t+s+a+(r/2**32|0)|0,nv=(r,e,t,s,a)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0)+(a>>>0),iv=(r,e,t,s,a,n)=>e+t+s+a+n+(r/2**32|0)|0,we={fromBig:fw,split:K1,toBig:M1,shrSH:H1,shrSL:F1,rotrSH:J1,rotrSL:q1,rotrBH:W1,rotrBL:_1,rotr32H:G1,rotr32L:z1,rotlSH:X1,rotlSL:Y1,rotlBH:Q1,rotlBL:Z1,add:ev,add3L:tv,add3H:sv,add4L:rv,add4H:av,add5H:iv,add5L:nv},[ov,uv]=we.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),yr=new Uint32Array(80),vr=new Uint32Array(80);let pw=class extends kp{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:r,Al:e,Bh:t,Bl:s,Ch:a,Cl:n,Dh:o,Dl:u,Eh:h,El:c,Fh:i,Fl:f,Gh:m,Gl:b,Hh:v,Hl:w}=this;return[r,e,t,s,a,n,o,u,h,c,i,f,m,b,v,w]}set(r,e,t,s,a,n,o,u,h,c,i,f,m,b,v,w){this.Ah=r|0,this.Al=e|0,this.Bh=t|0,this.Bl=s|0,this.Ch=a|0,this.Cl=n|0,this.Dh=o|0,this.Dl=u|0,this.Eh=h|0,this.El=c|0,this.Fh=i|0,this.Fl=f|0,this.Gh=m|0,this.Gl=b|0,this.Hh=v|0,this.Hl=w|0}process(r,e){for(let p=0;p<16;p++,e+=4)yr[p]=r.getUint32(e),vr[p]=r.getUint32(e+=4);for(let p=16;p<80;p++){const S=yr[p-15]|0,I=vr[p-15]|0,P=we.rotrSH(S,I,1)^we.rotrSH(S,I,8)^we.shrSH(S,I,7),x=we.rotrSL(S,I,1)^we.rotrSL(S,I,8)^we.shrSL(S,I,7),T=yr[p-2]|0,B=vr[p-2]|0,V=we.rotrSH(T,B,19)^we.rotrBH(T,B,61)^we.shrSH(T,B,6),J=we.rotrSL(T,B,19)^we.rotrBL(T,B,61)^we.shrSL(T,B,6),F=we.add4L(x,J,vr[p-7],vr[p-16]),D=we.add4H(F,P,V,yr[p-7],yr[p-16]);yr[p]=D|0,vr[p]=F|0}let{Ah:t,Al:s,Bh:a,Bl:n,Ch:o,Cl:u,Dh:h,Dl:c,Eh:i,El:f,Fh:m,Fl:b,Gh:v,Gl:w,Hh:y,Hl:k}=this;for(let p=0;p<80;p++){const S=we.rotrSH(i,f,14)^we.rotrSH(i,f,18)^we.rotrBH(i,f,41),I=we.rotrSL(i,f,14)^we.rotrSL(i,f,18)^we.rotrBL(i,f,41),P=i&m^~i&v,x=f&b^~f&w,T=we.add5L(k,I,x,uv[p],vr[p]),B=we.add5H(T,y,S,P,ov[p],yr[p]),V=T|0,J=we.rotrSH(t,s,28)^we.rotrBH(t,s,34)^we.rotrBH(t,s,39),F=we.rotrSL(t,s,28)^we.rotrBL(t,s,34)^we.rotrBL(t,s,39),D=t&a^t&o^a&o,j=s&n^s&u^n&u;y=v|0,k=w|0,v=m|0,w=b|0,m=i|0,b=f|0,{h:i,l:f}=we.add(h|0,c|0,B|0,V|0),h=o|0,c=u|0,o=a|0,u=n|0,a=t|0,n=s|0;const te=we.add3L(V,F,j);t=we.add3H(te,B,J,D),s=te|0}({h:t,l:s}=we.add(this.Ah|0,this.Al|0,t|0,s|0)),{h:a,l:n}=we.add(this.Bh|0,this.Bl|0,a|0,n|0),{h:o,l:u}=we.add(this.Ch|0,this.Cl|0,o|0,u|0),{h,l:c}=we.add(this.Dh|0,this.Dl|0,h|0,c|0),{h:i,l:f}=we.add(this.Eh|0,this.El|0,i|0,f|0),{h:m,l:b}=we.add(this.Fh|0,this.Fl|0,m|0,b|0),{h:v,l:w}=we.add(this.Gh|0,this.Gl|0,v|0,w|0),{h:y,l:k}=we.add(this.Hh|0,this.Hl|0,y|0,k|0),this.set(t,s,a,n,o,u,h,c,i,f,m,b,v,w,y,k)}roundClean(){yr.fill(0),vr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},lv=class extends pw{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}};const cv=wm(()=>new pw),hv=wm(()=>new lv),Ye=new ArrayBuffer(0),E="";class Ne extends TypeError{constructor(){super(...arguments),this.name=Ne.NAME}static isType(e,t){if(typeof t=="string"){if(t==="Array"&&Array.isArray(e)||t==="ArrayBuffer"&&e instanceof ArrayBuffer||t==="ArrayBufferView"&&ArrayBuffer.isView(e)||typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...s){for(const n of s)if(this.isType(e,n))return;const a=s.map(n=>n instanceof Function&&"name"in n?n.name:"".concat(n));throw new Ne("Parameter '".concat(t,"' is not of type ").concat(a.length>1?"(".concat(a.join(" or "),")"):a[0]))}}Ne.NAME="ArgumentError";class ve extends TypeError{static assert(...e){let t=null,s,a;typeof e[0]=="string"?(t=e[0],s=e[1],a=e.slice(2)):(s=e[0],a=e.slice(1)),Ne.assert(s,"parameters","object");for(const n of a)if(s[n]==null)throw new ve(n,t)}static assertEmpty(e,t,s){if(e==null)throw new ve(t,s)}constructor(e,t=null,s){super(),this.name=ve.NAME,this.field=e,t&&(this.target=t),s?this.message=s:this.message="Absent mandatory parameter '".concat(e,"' ").concat(t?" in '".concat(t,"'"):E)}}ve.NAME="ParameterError";class q extends Error{static assertSchema(e,t){if(!e.verified)throw new Error("Object's schema was not verified against input data for ".concat(t))}static assert(e,t){if(e.offset===-1)throw new q("Error during parsing of ASN.1 data. Data is not correct for '".concat(t,"'."))}constructor(e){super(e),this.name="AsnError"}}class _{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=Xe(e);q.assert(t,this.name);try{return new this({schema:t.result})}catch(s){throw new q("Cannot create '".concat(this.CLASS_NAME,"' from ASN.1 object"))}}static defaultValues(e){throw new Error("Invalid member name for ".concat(this.CLASS_NAME," class: ").concat(e))}static schema(e={}){throw new Error("Method '".concat(this.CLASS_NAME,".schema' should be overridden"))}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch(s){t=this.toSchema(!0)}return Ae.ToString(t.toBER(),e)}}_.CLASS_NAME="PkiObject";function oa(r){let e=!1,t=E;const s=r.trim();for(let a=0;a<s.length;a++)s.charCodeAt(a)===32?e===!1&&(e=!0):(e&&(t+=" ",e=!1),t+=s[a]);return t.toLowerCase()}const ru="type",Ym="value";class da extends _{constructor(e={}){super(),this.type=d(e,ru,da.defaultValues(ru)),this.value=d(e,Ym,da.defaultValues(Ym)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ru:return E;case Ym:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.type||E}),new le({name:t.value||E})]})}fromSchema(e){G(e,[ru,"typeValue"]);const t=z(e,e,da.schema({names:{type:ru,value:"typeValue"}}));q.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new O({value:[new ae({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return Object.keys(this.value).length!==0?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[_h.blockName(),Rf.blockName(),Tf.blockName(),ch.blockName(),tr.blockName(),Df.blockName(),py.blockName(),Vg.blockName(),dy.blockName(),gy.blockName(),wy.blockName(),yy.blockName()];if(e instanceof ArrayBuffer)return Be.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===da.blockName()){if(this.type!==e.type)return!1;const s=[!1,!1],a=this.value.constructor.blockName();for(const n of t)a===n&&(s[0]=!0),e.value.constructor.blockName()===n&&(s[1]=!0);if(s[0]!==s[1])return!1;if(s[0]&&s[1]){const n=oa(this.value.valueBlock.value),o=oa(e.value.valueBlock.value);if(n.localeCompare(o)!==0)return!1}else if(!Be.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}da.CLASS_NAME="AttributeTypeAndValue";const Va="typesAndValues",jc="valueBeforeDecode",qd="RDN";class Ee extends _{constructor(e={}){super(),this.typesAndValues=d(e,Va,Ee.defaultValues(Va)),this.valueBeforeDecode=d(e,jc,Ee.defaultValues(jc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Va:return[];case jc:return Ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Va:return t.length===0;case jc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.repeatedSequence||E,value:new nt({value:[new me({name:t.repeatedSet||E,value:da.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){G(e,[qd,Va]);const t=z(e,e,Ee.schema({names:{blockName:qd,repeatedSet:Va}}));q.assertSchema(t,this.className),Va in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,s=>new da({schema:s}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(this.valueBeforeDecode.byteLength===0)return new O({value:[new nt({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=Xe(this.valueBeforeDecode);if(q.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof O))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof Ee){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,s]of this.typesAndValues.entries())if(s.isEqual(e.typesAndValues[t])===!1)return!1;return!0}return e instanceof ArrayBuffer?yc(this.valueBeforeDecode,e):!1}}Ee.CLASS_NAME="RelativeDistinguishedNames";const wu="type",yu="value";function mv(r={},e=!1){const t=d(r,"names",{});return new O({optional:e,value:[new L({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:t.country_name||E,value:[new je({value:[new ch,new tr]})]}),new L({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:t.administration_domain_name||E,value:[new je({value:[new ch,new tr]})]}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:t.network_address||E,isHexOnly:!0}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:t.terminal_identifier||E,isHexOnly:!0}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:t.private_domain_name||E,value:[new je({value:[new ch,new tr]})]}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:t.organization_name||E,isHexOnly:!0}),new ue({optional:!0,name:t.numeric_user_identifier||E,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new L({optional:!0,name:t.personal_name||E,idBlock:{tagClass:3,tagNumber:5},value:[new ue({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new ue({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new L({optional:!0,name:t.organizational_unit_names||E,idBlock:{tagClass:3,tagNumber:6},value:[new me({value:new tr})]})]})}function fv(r=!1){return new O({optional:r,value:[new tr,new tr]})}function pv(r=!1){return new nt({optional:r,value:[new ue({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new le]})]})}class Se extends _{constructor(e={}){super(),this.type=d(e,wu,Se.defaultValues(wu)),this.value=d(e,yu,Se.defaultValues(yu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wu:return 9;case yu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wu:return t===Se.defaultValues(e);case yu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new je({value:[new L({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||E,value:[new ae,new L({idBlock:{tagClass:3,tagNumber:0},value:[new le]})]}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:1}}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:2}}),new L({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||E,value:[mv(t.builtInStandardAttributes||{},!1),fv(!0),pv(!0)]}),new L({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||E,value:[Ee.schema(t.directoryName||{})]}),new L({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||E,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new je({value:[new Df,new tr,new Tf,new _h,new Rf]})]}),new L({idBlock:{tagClass:3,tagNumber:1},value:[new je({value:[new Df,new tr,new Tf,new _h,new Rf]})]})]}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:6}}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:7}}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){G(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=z(e,e,Se.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(q.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=t.result.blockName;break;case 1:case 2:case 6:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=22;const a=s.toBER(!1),n=Xe(a);q.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value}break;case 3:this.value=t.result.blockName;break;case 4:this.value=new Ee({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new X({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=6;const a=s.toBER(!1),n=Xe(a);q.assert(n,"GeneralName registeredID"),this.value=n.result.valueBlock.toString()}break}}toSchema(){switch(this.type){case 0:case 3:case 5:return new L({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new Vg({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new L({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new ae({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return Se.schema()}}toJSON(){const e={type:this.type,value:E};if(typeof this.value=="string")e.value=this.value;else try{e.value=this.value.toJSON()}catch(t){}return e}}Se.CLASS_NAME="GeneralName";const vu="accessMethod",bu="accessLocation",dv=[vu,bu];class Mn extends _{constructor(e={}){super(),this.accessMethod=d(e,vu,Mn.defaultValues(vu)),this.accessLocation=d(e,bu,Mn.defaultValues(bu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vu:return E;case bu:return new Se;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.accessMethod||E}),Se.schema(t.accessLocation||{})]})}fromSchema(e){G(e,dv);const t=z(e,e,Mn.schema({names:{accessMethod:vu,accessLocation:{names:{blockName:bu}}}}));q.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new Se({schema:t.result.accessLocation})}toSchema(){return new O({value:[new ae({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}Mn.CLASS_NAME="AccessDescription";const Nr="seconds",Er="millis",kr="micros";class Qt extends _{constructor(e={}){super(),Nr in e&&(this.seconds=d(e,Nr,Qt.defaultValues(Nr))),Er in e&&(this.millis=d(e,Er,Qt.defaultValues(Er))),kr in e&&(this.micros=d(e,kr,Qt.defaultValues(kr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nr:case Er:case kr:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Nr:case Er:case kr:return t===Qt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,optional:!0,value:[new H({optional:!0,name:t.seconds||E}),new ue({name:t.millis||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new ue({name:t.micros||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){G(e,[Nr,Er,kr]);const t=z(e,e,Qt.schema({names:{seconds:Nr,millis:Er,micros:kr}}));if(q.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const s=new H({valueHex:t.result.millis.valueBlock.valueHex});this.millis=s.valueBlock.valueDec}if("micros"in t.result){const s=new H({valueHex:t.result.micros.valueBlock.valueHex});this.micros=s.valueBlock.valueDec}}toSchema(){const e=[];if(this.seconds!==void 0&&e.push(new H({value:this.seconds})),this.millis!==void 0){const t=new H({value:this.millis});e.push(new ue({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(this.micros!==void 0){const t=new H({value:this.micros});e.push(new ue({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new O({value:e})}toJSON(){const e={};return this.seconds!==void 0&&(e.seconds=this.seconds),this.millis!==void 0&&(e.millis=this.millis),this.micros!==void 0&&(e.micros=this.micros),e}}Qt.CLASS_NAME="Accuracy";const $c="algorithmId",au="algorithmParams",dw="algorithm",Ff="params",gv=[dw,Ff];class M extends _{constructor(e={}){super(),this.algorithmId=d(e,$c,M.defaultValues($c)),au in e&&(this.algorithmParams=d(e,au,M.defaultValues(au))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $c:return E;case au:return new le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $c:return t===E;case au:return t instanceof le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,optional:t.optional||!1,value:[new ae({name:t.algorithmIdentifier||E}),new le({name:t.algorithmParams||E,optional:!0})]})}fromSchema(e){G(e,gv);const t=z(e,e,M.schema({names:{algorithmIdentifier:dw,algorithmParams:Ff}}));q.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),Ff in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new ae({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof le)&&e.push(this.algorithmParams),new O({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof le)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return!(e instanceof M)||this.algorithmId!==e.algorithmId?!1:this.algorithmParams?e.algorithmParams?JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!1:!e.algorithmParams}}M.CLASS_NAME="AlgorithmIdentifier";const hi="altNames",wv=[hi];class qo extends _{constructor(e={}){super(),this.altNames=d(e,hi,qo.defaultValues(hi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hi:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.altNames||E,value:Se.schema()})]})}fromSchema(e){G(e,wv);const t=z(e,e,qo.schema({names:{altNames:hi}}));q.assertSchema(t,this.className),hi in t.result&&(this.altNames=Array.from(t.result.altNames,s=>new Se({schema:s})))}toSchema(){return new O({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}qo.CLASS_NAME="AltName";const mi="type",fi="values",yv=[mi,fi];class Oe extends _{constructor(e={}){super(),this.type=d(e,mi,Oe.defaultValues(mi)),this.values=d(e,fi,Oe.defaultValues(fi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mi:return E;case fi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mi:return t===E;case fi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.type||E}),new nt({name:t.setName||E,value:[new me({name:t.values||E,value:new le})]})]})}fromSchema(e){G(e,yv);const t=z(e,e,Oe.schema({names:{type:mi,values:fi}}));q.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new O({value:[new ae({value:this.type}),new nt({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}Oe.CLASS_NAME="Attribute";const Su="notBeforeTime",Au="notAfterTime",vv=[Su,Au];class Ns extends _{constructor(e={}){super(),this.notBeforeTime=d(e,Su,Ns.defaultValues(Su)),this.notAfterTime=d(e,Au,Ns.defaultValues(Au)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Su:case Au:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new $e({name:t.notBeforeTime||E}),new $e({name:t.notAfterTime||E})]})}fromSchema(e){G(e,vv);const t=z(e,e,Ns.schema({names:{notBeforeTime:Su,notAfterTime:Au}}));q.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new O({value:[new $e({valueDate:this.notBeforeTime}),new $e({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}Ns.CLASS_NAME="AttCertValidityPeriod";const nu="names",Wd="generalNames";class it extends _{constructor(e={}){super(),this.names=d(e,nu,it.defaultValues(nu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"names":return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,nu,{});return new O({optional:t,name:s.blockName||E,value:[new me({name:s.generalNames||E,value:Se.schema()})]})}fromSchema(e){G(e,[nu,Wd]);const t=z(e,e,it.schema({names:{blockName:nu,generalNames:Wd}}));q.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,s=>new Se({schema:s}))}toSchema(){return new O({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}it.CLASS_NAME="GeneralNames";const bv="2.5.29.9",Sv="2.5.29.14",Av="2.5.29.15",Nv="2.5.29.16",gw="2.5.29.17",ww="2.5.29.18",Ip="2.5.29.19",Ev="2.5.29.20",kv="2.5.29.27",Iv="2.5.29.21",Cv="2.5.29.24",yw="2.5.29.28",vw="2.5.29.29",bw="2.5.29.30",Sw="2.5.29.31",Cp="2.5.29.46",Aw="2.5.29.32",as="2.5.29.32.0",Vv="1.3.6.1.4.1.311.21.10",Nw="2.5.29.33",Vp="2.5.29.35",Ew="2.5.29.36",xv="2.5.29.37",Bv="2.5.29.54",xp="1.3.6.1.5.5.7.1.1",Ov="1.3.6.1.5.5.7.1.11",Pv="1.3.6.1.4.1.11129.2.4.2",Dv="1.3.6.1.4.1.311.21.7",Tv="1.3.6.1.4.1.311.21.1",Rv="1.3.6.1.5.5.7.1.3",Bp="1.2.840.113549.1.7.1",kw="1.2.840.113549.1.7.2",Iw="1.2.840.113549.1.7.3",Cw="1.2.840.113549.1.7.6",Uv="1.2.840.113549.1.9.16.1.4",_d="1.2.840.113549.1.9.22.1",Lv="1.2.840.113549.1.9.22.2",Gd="1.2.840.113549.1.9.22.3",zd="1.2.840.113549.1.9.23.1",jv="1.3.6.1.5.5.7",$v="".concat(jv,".48"),ph="".concat($v,".1.1"),Da="keyIdentifier",Ta="authorityCertIssuer",Ra="authorityCertSerialNumber",Kv=[Da,Ta,Ra];class ga extends _{constructor(e={}){super(),Da in e&&(this.keyIdentifier=d(e,Da,ga.defaultValues(Da))),Ta in e&&(this.authorityCertIssuer=d(e,Ta,ga.defaultValues(Ta))),Ra in e&&(this.authorityCertSerialNumber=d(e,Ra,ga.defaultValues(Ra))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Da:return new X;case Ta:return[];case Ra:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ue({name:t.keyIdentifier||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new me({name:t.authorityCertIssuer||E,value:Se.schema()})]}),new ue({name:t.authorityCertSerialNumber||E,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){G(e,Kv);const t=z(e,e,ga.schema({names:{keyIdentifier:Da,authorityCertIssuer:Ta,authorityCertSerialNumber:Ra}}));q.assertSchema(t,this.className),Da in t.result&&(this.keyIdentifier=new X({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),Ta in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,s=>new Se({schema:s}))),Ra in t.result&&(this.authorityCertSerialNumber=new H({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new ue({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new ue({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new O({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}ga.CLASS_NAME="AuthorityKeyIdentifier";const xa="pathLenConstraint",Ba="cA";class Hn extends _{constructor(e={}){super(),this.cA=d(e,Ba,!1),xa in e&&(this.pathLenConstraint=d(e,xa,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ba:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new Ia({optional:!0,name:t.cA||E}),new H({optional:!0,name:t.pathLenConstraint||E})]})}fromSchema(e){G(e,[Ba,xa]);const t=z(e,e,Hn.schema({names:{cA:Ba,pathLenConstraint:xa}}));q.assertSchema(t,this.className),Ba in t.result&&(this.cA=t.result.cA.valueBlock.value),xa in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==Hn.defaultValues(Ba)&&e.push(new Ia({value:this.cA})),xa in this&&(this.pathLenConstraint instanceof H?e.push(this.pathLenConstraint):e.push(new H({value:this.pathLenConstraint}))),new O({value:e})}toJSON(){const e={};return this.cA!==Hn.defaultValues(Ba)&&(e.cA=this.cA),xa in this&&(this.pathLenConstraint instanceof H?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}Hn.CLASS_NAME="BasicConstraints";const Qm="certificateIndex",Zm="keyIndex";class Sc extends _{constructor(e={}){super(),this.certificateIndex=d(e,Qm,Sc.defaultValues(Qm)),this.keyIndex=d(e,Zm,Sc.defaultValues(Zm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qm:case Zm:return 0;default:return super.defaultValues(e)}}static schema(){return new H}fromSchema(e){if(e.constructor.blockName()!==H.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const s=new Uint8Array(t);switch(!0){case t.byteLength<4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(s,4-t.byteLength),t=f.slice(0)}break;case t.byteLength>4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(s.slice(0,4)),t=f.slice(0)}break}const a=t.slice(0,2),n=new Uint8Array(a);let o=n[0];n[0]=n[1],n[1]=o;const u=new Uint16Array(a);this.keyIndex=u[0];const h=t.slice(2),c=new Uint8Array(h);o=c[0],c[0]=c[1],c[1]=o;const i=new Uint16Array(h);this.certificateIndex=i[0]}toSchema(){const e=new ArrayBuffer(2),t=new Uint16Array(e);t[0]=this.certificateIndex;const s=new Uint8Array(e);let a=s[0];s[0]=s[1],s[1]=a;const n=new ArrayBuffer(2),o=new Uint16Array(n);o[0]=this.keyIndex;const u=new Uint8Array(n);return a=u[0],u[0]=u[1],u[1]=a,new H({valueHex:Uo(n,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}Sc.CLASS_NAME="CAVersion";const Nu="policyQualifierId",Eu="qualifier",Mv=[Nu,Eu];class Fn extends _{constructor(e={}){super(),this.policyQualifierId=d(e,Nu,Fn.defaultValues(Nu)),this.qualifier=d(e,Eu,Fn.defaultValues(Eu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nu:return E;case Eu:return new le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.policyQualifierId||E}),new le({name:t.qualifier||E})]})}fromSchema(e){G(e,Mv);const t=z(e,e,Fn.schema({names:{policyQualifierId:Nu,qualifier:Eu}}));q.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new O({value:[new ae({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}Fn.CLASS_NAME="PolicyQualifierInfo";const ku="policyIdentifier",Ua="policyQualifiers",Hv=[ku,Ua];class Jn extends _{constructor(e={}){super(),this.policyIdentifier=d(e,ku,Jn.defaultValues(ku)),Ua in e&&(this.policyQualifiers=d(e,Ua,Jn.defaultValues(Ua))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ku:return E;case Ua:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.policyIdentifier||E}),new O({optional:!0,value:[new me({name:t.policyQualifiers||E,value:Fn.schema()})]})]})}fromSchema(e){G(e,Hv);const t=z(e,e,Jn.schema({names:{policyIdentifier:ku,policyQualifiers:Ua}}));q.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),Ua in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,s=>new Fn({schema:s})))}toSchema(){const e=[];return e.push(new ae({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new O({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}Jn.CLASS_NAME="PolicyInformation";const Iu="certificatePolicies",Fv=[Iu];class Wo extends _{constructor(e={}){super(),this.certificatePolicies=d(e,Iu,Wo.defaultValues(Iu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Iu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.certificatePolicies||E,value:Jn.schema()})]})}fromSchema(e){G(e,Fv);const t=z(e,e,Wo.schema({names:{certificatePolicies:Iu}}));q.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,s=>new Jn({schema:s}))}toSchema(){return new O({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}Wo.CLASS_NAME="CertificatePolicies";const Cu="templateID",Ks="templateMajorVersion",Ms="templateMinorVersion",Jv=[Cu,Ks,Ms];class To extends _{constructor(e={}){super(),this.templateID=d(e,Cu,To.defaultValues(Cu)),Ks in e&&(this.templateMajorVersion=d(e,Ks,To.defaultValues(Ks))),Ms in e&&(this.templateMinorVersion=d(e,Ms,To.defaultValues(Ms))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cu:return E;case Ks:case Ms:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.templateID||E}),new H({name:t.templateMajorVersion||E,optional:!0}),new H({name:t.templateMinorVersion||E,optional:!0})]})}fromSchema(e){G(e,Jv);const t=z(e,e,To.schema({names:{templateID:Cu,templateMajorVersion:Ks,templateMinorVersion:Ms}}));q.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),Ks in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),Ms in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new ae({value:this.templateID})),Ks in this&&e.push(new H({value:this.templateMajorVersion})),Ms in this&&e.push(new H({value:this.templateMinorVersion})),new O({value:e})}toJSON(){const e={templateID:this.templateID};return Ks in this&&(e.templateMajorVersion=this.templateMajorVersion),Ms in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}const La="distributionPoint",Vw="distributionPointNames",ja="reasons",$a="cRLIssuer",xw="cRLIssuerNames",qv=[La,Vw,ja,$a,xw];class wa extends _{constructor(e={}){super(),La in e&&(this.distributionPoint=d(e,La,wa.defaultValues(La))),ja in e&&(this.reasons=d(e,ja,wa.defaultValues(ja))),$a in e&&(this.cRLIssuer=d(e,$a,wa.defaultValues($a))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case La:return[];case ja:return new ye;case $a:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new je({value:[new L({name:t.distributionPoint||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:t.distributionPointNames||E,value:Se.schema()})]}),new L({name:t.distributionPoint||E,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Ee.schema().valueBlock.value})]})]}),new ue({name:t.reasons||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new L({name:t.cRLIssuer||E,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new me({name:t.cRLIssuerNames||E,value:Se.schema()})]})]})}fromSchema(e){G(e,qv);const t=z(e,e,wa.schema({names:{distributionPoint:La,distributionPointNames:Vw,reasons:ja,cRLIssuer:$a,cRLIssuerNames:xw}}));q.assertSchema(t,this.className),La in t.result&&(t.result.distributionPoint.idBlock.tagNumber===0&&(this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new Se({schema:s}))),t.result.distributionPoint.idBlock.tagNumber===1&&(this.distributionPoint=new Ee({schema:new O({value:t.result.distributionPoint.valueBlock.value})}))),ja in t.result&&(this.reasons=new ye({valueHex:t.result.reasons.valueBlock.valueHex})),$a in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,s=>new Se({schema:s})))}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new L({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):t=new L({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new ue({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new L({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}wa.CLASS_NAME="DistributionPoint";const Vu="distributionPoints",Wv=[Vu];class _o extends _{constructor(e={}){super(),this.distributionPoints=d(e,Vu,_o.defaultValues(Vu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.distributionPoints||E,value:wa.schema()})]})}fromSchema(e){G(e,Wv);const t=z(e,e,_o.schema({names:{distributionPoints:Vu}}));q.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,s=>new wa({schema:s}))}toSchema(){return new O({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}_o.CLASS_NAME="CRLDistributionPoints";const xu="keyPurposes",_v=[xu];class Ac extends _{constructor(e={}){super(),this.keyPurposes=d(e,xu,Ac.defaultValues(xu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.keyPurposes||E,value:new ae})]})}fromSchema(e){G(e,_v);const t=z(e,e,Ac.schema({names:{keyPurposes:xu}}));q.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,s=>s.valueBlock.toString())}toSchema(){return new O({value:Array.from(this.keyPurposes,e=>new ae({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}Ac.CLASS_NAME="ExtKeyUsage";const iu="accessDescriptions";class Go extends _{constructor(e={}){super(),this.accessDescriptions=d(e,iu,Go.defaultValues(iu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.accessDescriptions||E,value:Mn.schema()})]})}fromSchema(e){G(e,[iu]);const t=z(e,e,Go.schema({names:{accessDescriptions:iu}}));q.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,s=>new Mn({schema:s}))}toSchema(){return new O({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}Go.CLASS_NAME="InfoAccess";const Ka="distributionPoint",Bw="distributionPointNames",Ir="onlyContainsUserCerts",Cr="onlyContainsCACerts",Vr="onlySomeReasons",xr="indirectCRL",Br="onlyContainsAttributeCerts",Gv=[Ka,Bw,Ir,Cr,Vr,xr,Br];class dt extends _{constructor(e={}){super(),Ka in e&&(this.distributionPoint=d(e,Ka,dt.defaultValues(Ka))),this.onlyContainsUserCerts=d(e,Ir,dt.defaultValues(Ir)),this.onlyContainsCACerts=d(e,Cr,dt.defaultValues(Cr)),Vr in e&&(this.onlySomeReasons=d(e,Vr,dt.defaultValues(Vr))),this.indirectCRL=d(e,xr,dt.defaultValues(xr)),this.onlyContainsAttributeCerts=d(e,Br,dt.defaultValues(Br)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ka:return[];case Ir:return!1;case Cr:return!1;case Vr:return 0;case xr:return!1;case Br:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new je({value:[new L({name:t.distributionPoint||E,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:t.distributionPointNames||E,value:Se.schema()})]}),new L({name:t.distributionPoint||E,idBlock:{tagClass:3,tagNumber:1},value:Ee.schema().valueBlock.value})]})]}),new ue({name:t.onlyContainsUserCerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new ue({name:t.onlyContainsCACerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new ue({name:t.onlySomeReasons||E,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new ue({name:t.indirectCRL||E,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new ue({name:t.onlyContainsAttributeCerts||E,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){G(e,Gv);const t=z(e,e,dt.schema({names:{distributionPoint:Ka,distributionPointNames:Bw,onlyContainsUserCerts:Ir,onlyContainsCACerts:Cr,onlySomeReasons:Vr,indirectCRL:xr,onlyContainsAttributeCerts:Br}}));if(q.assertSchema(t,this.className),Ka in t.result)switch(!0){case t.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new Se({schema:s}));break;case t.result.distributionPoint.idBlock.tagNumber===1:this.distributionPoint=new Ee({schema:new O({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(Ir in t.result){const s=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=s[0]!==0}if(Cr in t.result){const s=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=s[0]!==0}if(Vr in t.result){const s=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=s[0]}if(xr in t.result){const s=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=s[0]!==0}if(Br in t.result){const s=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=s[0]!==0}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new L({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==dt.defaultValues(Ir)&&e.push(new ue({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==dt.defaultValues(Cr)&&e.push(new ue({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),this.onlySomeReasons!==void 0){const t=new ArrayBuffer(1),s=new Uint8Array(t);s[0]=this.onlySomeReasons,e.push(new ue({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==dt.defaultValues(xr)&&e.push(new ue({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==dt.defaultValues(Br)&&e.push(new ue({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new O({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==dt.defaultValues(Ir)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==dt.defaultValues(Cr)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),Vr in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==dt.defaultValues(xr)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==dt.defaultValues(Br)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}dt.CLASS_NAME="IssuingDistributionPoint";const Bu="base",pi="minimum",Or="maximum",zv=[Bu,pi,Or];class Ds extends _{constructor(e={}){super(),this.base=d(e,Bu,Ds.defaultValues(Bu)),this.minimum=d(e,pi,Ds.defaultValues(pi)),Or in e&&(this.maximum=d(e,Or,Ds.defaultValues(Or))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bu:return new Se;case pi:return 0;case Or:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Se.schema(t.base||{}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:t.minimum||E})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new H({name:t.maximum||E})]})]})}fromSchema(e){G(e,zv);const t=z(e,e,Ds.schema({names:{base:{names:{blockName:Bu}},minimum:pi,maximum:Or}}));q.assertSchema(t,this.className),this.base=new Se({schema:t.result.base}),pi in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),Or in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),this.minimum!==0){let t=0;this.minimum instanceof H?t=this.minimum:t=new H({value:this.minimum}),e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(Or in this){let t=0;this.maximum instanceof H?t=this.maximum:t=new H({value:this.maximum}),e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new O({value:e})}toJSON(){const e={base:this.base.toJSON()};return this.minimum!==0&&(typeof this.minimum=="number"?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),this.maximum!==void 0&&(typeof this.maximum=="number"?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}Ds.CLASS_NAME="GeneralSubtree";const Ma="permittedSubtrees",Ha="excludedSubtrees",Xv=[Ma,Ha];class jo extends _{constructor(e={}){super(),Ma in e&&(this.permittedSubtrees=d(e,Ma,jo.defaultValues(Ma))),Ha in e&&(this.excludedSubtrees=d(e,Ha,jo.defaultValues(Ha))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ma:case Ha:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:t.permittedSubtrees||E,value:Ds.schema()})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new me({name:t.excludedSubtrees||E,value:Ds.schema()})]})]})}fromSchema(e){G(e,Xv);const t=z(e,e,jo.schema({names:{permittedSubtrees:Ma,excludedSubtrees:Ha}}));q.assertSchema(t,this.className),Ma in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,s=>new Ds({schema:s}))),Ha in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,s=>new Ds({schema:s})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}jo.CLASS_NAME="NameConstraints";const Hs="requireExplicitPolicy",Fs="inhibitPolicyMapping",Yv=[Hs,Fs];class $o extends _{constructor(e={}){super(),Hs in e&&(this.requireExplicitPolicy=d(e,Hs,$o.defaultValues(Hs))),Fs in e&&(this.inhibitPolicyMapping=d(e,Fs,$o.defaultValues(Fs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hs:return 0;case Fs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ue({name:t.requireExplicitPolicy||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new ue({name:t.inhibitPolicyMapping||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){G(e,Yv);const t=z(e,e,$o.schema({names:{requireExplicitPolicy:Hs,inhibitPolicyMapping:Fs}}));if(q.assertSchema(t,this.className),Hs in t.result){const s=t.result.requireExplicitPolicy;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=Xe(a);q.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(Fs in t.result){const s=t.result.inhibitPolicyMapping;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=Xe(a);q.assert(n,"Integer"),this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if(Hs in this){const t=new H({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(Fs in this){const t=new H({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new O({value:e})}toJSON(){const e={};return Hs in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),Fs in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}$o.CLASS_NAME="PolicyConstraints";const Ou="issuerDomainPolicy",Pu="subjectDomainPolicy",Qv=[Ou,Pu];class qn extends _{constructor(e={}){super(),this.issuerDomainPolicy=d(e,Ou,qn.defaultValues(Ou)),this.subjectDomainPolicy=d(e,Pu,qn.defaultValues(Pu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ou:return E;case Pu:return E;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.issuerDomainPolicy||E}),new ae({name:t.subjectDomainPolicy||E})]})}fromSchema(e){G(e,Qv);const t=z(e,e,qn.schema({names:{issuerDomainPolicy:Ou,subjectDomainPolicy:Pu}}));q.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new O({value:[new ae({value:this.issuerDomainPolicy}),new ae({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}qn.CLASS_NAME="PolicyMapping";const Du="mappings",Zv=[Du];class Nc extends _{constructor(e={}){super(),this.mappings=d(e,Du,Nc.defaultValues(Du)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Du:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.mappings||E,value:qn.schema()})]})}fromSchema(e){G(e,Zv);const t=z(e,e,Nc.schema({names:{mappings:Du}}));q.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,s=>new qn({schema:s}))}toSchema(){return new O({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}Nc.CLASS_NAME="PolicyMappings";const Pr="notBefore",Dr="notAfter",eb=[Pr,Dr];class Ko extends _{constructor(e={}){super(),Pr in e&&(this.notBefore=d(e,Pr,Ko.defaultValues(Pr))),Dr in e&&(this.notAfter=d(e,Dr,Ko.defaultValues(Dr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pr:return new Date;case Dr:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ue({name:t.notBefore||E,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new ue({name:t.notAfter||E,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){G(e,eb);const t=z(e,e,Ko.schema({names:{notBefore:Pr,notAfter:Dr}}));if(q.assertSchema(t,this.className),Pr in t.result){const s=new $e;s.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=s.toDate()}if(Dr in t.result){const s=new $e({valueHex:t.result.notAfter.valueBlock.valueHex});s.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=s.toDate()}}toSchema(){const e=[];return Pr in this&&e.push(new ue({idBlock:{tagClass:3,tagNumber:0},valueHex:new $e({valueDate:this.notBefore}).valueBlock.valueHexView})),Dr in this&&e.push(new ue({idBlock:{tagClass:3,tagNumber:1},valueHex:new $e({valueDate:this.notAfter}).valueBlock.valueHexView})),new O({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}Ko.CLASS_NAME="PrivateKeyUsagePeriod";const di="id",Js="type",gi="values",tb=[di,Js],sb=[gi];class Wn extends _{constructor(e={}){super(),this.id=d(e,di,Wn.defaultValues(di)),Js in e&&(this.type=d(e,Js,Wn.defaultValues(Js))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case di:return E;case Js:return new at;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case di:return t===E;case Js:return t instanceof at;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.id||E}),new le({name:t.type||E,optional:!0})]})}fromSchema(e){G(e,tb);const t=z(e,e,Wn.schema({names:{id:di,type:Js}}));q.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),Js in t.result&&(this.type=t.result.type)}toSchema(){const e=[new ae({value:this.id})];return Js in this&&e.push(this.type),new O({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}Wn.CLASS_NAME="QCStatement";class Ec extends _{constructor(e={}){super(),this.values=d(e,gi,Ec.defaultValues(gi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case gi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.values||E,value:Wn.schema(t.value||{})})]})}fromSchema(e){G(e,sb);const t=z(e,e,Ec.schema({names:{values:gi}}));q.assertSchema(t,this.className),this.values=Array.from(t.result.values,s=>new Wn({schema:s}))}toSchema(){return new O({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}Ec.CLASS_NAME="QCStatements";var Oa;class Aa{static register(e,t,s){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:s}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}Oa=Aa,Aa.namedCurves={},Oa.register("P-256","1.2.840.10045.3.1.7",32),Oa.register("P-384","1.3.132.0.34",48),Oa.register("P-521","1.3.132.0.35",66),Oa.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),Oa.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),Oa.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const Kc="x",Mc="y",Hc="namedCurve";class Kt extends _{constructor(e={}){super(),this.x=d(e,Kc,Kt.defaultValues(Kc)),this.y=d(e,Mc,Kt.defaultValues(Mc)),this.namedCurve=d(e,Hc,Kt.defaultValues(Hc)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Kc:case Mc:return Ye;case Hc:return E;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Kc:case Mc:return t instanceof ArrayBuffer&&yc(t,Kt.defaultValues(e));case Hc:return typeof t=="string"&&t===Kt.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new Wh}fromSchema(e){const t=Be.toUint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");const s=Aa.find(this.namedCurve);if(!s)throw new Error("Incorrect curve OID: ".concat(this.namedCurve));const a=s.size;if(t.byteLength!==a*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=s.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,a*2+1).buffer}toSchema(){return new Wh({data:Uo(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=Aa.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:Of(qh(this.x),!0,!0,!1),y:Of(qh(this.y),!0,!0,!1)}}fromJSON(e){ve.assert("json",e,"crv","x","y");let t=0;const s=Aa.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=Fo(wc(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const o=new Uint8Array(this.x),u=new Uint8Array(a);o.set(u,1)}else this.x=a.slice(0,t);const n=Fo(wc(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const o=new Uint8Array(this.y),u=new Uint8Array(n);o.set(u,1)}else this.y=n.slice(0,t)}}Kt.CLASS_NAME="ECPublicKey";const Tu="modulus",Ru="publicExponent",rb=[Tu,Ru];class _n extends _{constructor(e={}){super(),this.modulus=d(e,Tu,_n.defaultValues(Tu)),this.publicExponent=d(e,Ru,_n.defaultValues(Ru)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tu:return new H;case Ru:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.modulus||E}),new H({name:t.publicExponent||E})]})}fromSchema(e){G(e,rb);const t=z(e,e,_n.schema({names:{modulus:Tu,publicExponent:Ru}}));q.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new O({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:Ae.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ae.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){ve.assert("json",e,"n","e");const t=Fo(wc(e.n,!0));this.modulus=new H({valueHex:t.slice(0,Math.pow(2,fy(t.byteLength)))}),this.publicExponent=new H({valueHex:Fo(wc(e.e,!0)).slice(0,3)})}}_n.CLASS_NAME="RSAPublicKey";const Uu="algorithm",Lu="subjectPublicKey",ab=[Uu,Lu];class Ft extends _{get parsedKey(){if(this._parsedKey===void 0){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===ae.blockName())try{this._parsedKey=new Kt({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":{const e=Xe(this.subjectPublicKey.valueBlock.valueHexView);if(e.offset!==-1)try{this._parsedKey=new _n({schema:e.result})}catch(t){}}break}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=d(e,Uu,Ft.defaultValues(Uu)),this.subjectPublicKey=d(e,Lu,Ft.defaultValues(Lu));const t=d(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uu:return new M;case Lu:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.algorithm||{}),new ye({name:t.subjectPublicKey||E})]})}fromSchema(e){G(e,ab);const t=z(e,e,Ft.schema({names:{algorithm:{names:{blockName:Uu}},subjectPublicKey:Lu}}));q.assertSchema(t,this.className),this.algorithm=new M({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new O({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Kt({json:e}),this.algorithm=new M({algorithmId:"1.2.840.10045.2.1",algorithmParams:new ae({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new _n({json:e}),this.algorithm=new M({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new at});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.subjectPublicKey=new ye({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=fe(!0)){try{if(!e)throw new Error("Need to provide publicKey input parameter");const s=await t.exportKey("spki",e),a=Xe(s);try{this.fromSchema(a.result)}catch(n){throw new Error("Error during initializing object from schema")}}catch(s){const a=s instanceof Error?s.message:"".concat(s);throw new Error("Error during exporting public key: ".concat(a))}}}Ft.CLASS_NAME="PublicKeyInfo";const wi="version",yi="privateKey",ds="namedCurve",Tr="publicKey",nb=[wi,yi,ds,Tr];class is extends _{constructor(e={}){super(),this.version=d(e,wi,is.defaultValues(wi)),this.privateKey=d(e,yi,is.defaultValues(yi)),ds in e&&(this.namedCurve=d(e,ds,is.defaultValues(ds))),Tr in e&&(this.publicKey=d(e,Tr,is.defaultValues(Tr))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wi:return 1;case yi:return new X;case ds:return E;case Tr:return new Kt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wi:return t===is.defaultValues(e);case yi:return t.isEqual(is.defaultValues(e));case ds:return t===E;case Tr:return Kt.compareWithDefault(ds,t.namedCurve)&&Kt.compareWithDefault("x",t.x)&&Kt.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new X({name:t.privateKey||E}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ae({name:t.namedCurve||E})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ye({name:t.publicKey||E})]})]})}fromSchema(e){G(e,nb);const t=z(e,e,is.schema({names:{version:wi,privateKey:yi,namedCurve:ds,publicKey:Tr}}));if(q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,ds in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),Tr in t.result){const s={schema:t.result.publicKey.valueBlock.valueHex};ds in this&&(s.namedCurve=this.namedCurve),this.publicKey=new Kt(s)}}toSchema(){const e=[new H({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[new ae({value:this.namedCurve})]})),this.publicKey&&e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[new ye({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new O({value:e})}toJSON(){if(!this.namedCurve||is.compareWithDefault(ds,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=Aa.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:Ae.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const s=this.publicKey.toJSON();t.x=s.x,t.y=s.y}return t}fromJSON(e){ve.assert("json",e,"crv","d");let t=0;const s=Aa.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=Ae.FromBase64Url(e.d);if(a.byteLength<t){const n=new ArrayBuffer(t),o=new Uint8Array(n),u=new Uint8Array(a);o.set(u,1),this.privateKey=new X({valueHex:n})}else this.privateKey=new X({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new Kt({json:e}))}}is.CLASS_NAME="ECPrivateKey";const ju="prime",$u="exponent",Ku="coefficient",ib=[ju,$u,Ku];class sr extends _{constructor(e={}){super(),this.prime=d(e,ju,sr.defaultValues(ju)),this.exponent=d(e,$u,sr.defaultValues($u)),this.coefficient=d(e,Ku,sr.defaultValues(Ku)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ju:return new H;case $u:return new H;case Ku:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.prime||E}),new H({name:t.exponent||E}),new H({name:t.coefficient||E})]})}fromSchema(e){G(e,ib);const t=z(e,e,sr.schema({names:{prime:ju,exponent:$u,coefficient:Ku}}));q.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new O({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:Ae.ToBase64Url(this.prime.valueBlock.valueHexView),d:Ae.ToBase64Url(this.exponent.valueBlock.valueHexView),t:Ae.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){ve.assert("json",e,"r","d","r"),this.prime=new H({valueHex:Ae.FromBase64Url(e.r)}),this.exponent=new H({valueHex:Ae.FromBase64Url(e.d)}),this.coefficient=new H({valueHex:Ae.FromBase64Url(e.t)})}}sr.CLASS_NAME="OtherPrimeInfo";const Mu="version",Hu="modulus",Fu="publicExponent",Ju="privateExponent",qu="prime1",Wu="prime2",_u="exponent1",Gu="exponent2",zu="coefficient",Fa="otherPrimeInfos",ob=[Mu,Hu,Fu,Ju,qu,Wu,_u,Gu,zu,Fa];class Tt extends _{constructor(e={}){super(),this.version=d(e,Mu,Tt.defaultValues(Mu)),this.modulus=d(e,Hu,Tt.defaultValues(Hu)),this.publicExponent=d(e,Fu,Tt.defaultValues(Fu)),this.privateExponent=d(e,Ju,Tt.defaultValues(Ju)),this.prime1=d(e,qu,Tt.defaultValues(qu)),this.prime2=d(e,Wu,Tt.defaultValues(Wu)),this.exponent1=d(e,_u,Tt.defaultValues(_u)),this.exponent2=d(e,Gu,Tt.defaultValues(Gu)),this.coefficient=d(e,zu,Tt.defaultValues(zu)),Fa in e&&(this.otherPrimeInfos=d(e,Fa,Tt.defaultValues(Fa))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mu:return 0;case Hu:return new H;case Fu:return new H;case Ju:return new H;case qu:return new H;case Wu:return new H;case _u:return new H;case Gu:return new H;case zu:return new H;case Fa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new H({name:t.modulus||E}),new H({name:t.publicExponent||E}),new H({name:t.privateExponent||E}),new H({name:t.prime1||E}),new H({name:t.prime2||E}),new H({name:t.exponent1||E}),new H({name:t.exponent2||E}),new H({name:t.coefficient||E}),new O({optional:!0,value:[new me({name:t.otherPrimeInfosName||E,value:sr.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){G(e,ob);const t=z(e,e,Tt.schema({names:{version:Mu,modulus:Hu,publicExponent:Fu,privateExponent:Ju,prime1:qu,prime2:Wu,exponent1:_u,exponent2:Gu,coefficient:zu,otherPrimeInfo:{names:{blockName:Fa}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),Fa in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,s=>new sr({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new O({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={n:Ae.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ae.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:Ae.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:Ae.ToBase64Url(this.prime1.valueBlock.valueHexView),q:Ae.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:Ae.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:Ae.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:Ae.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){ve.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new H({valueHex:Ae.FromBase64Url(e.n)}),this.publicExponent=new H({valueHex:Ae.FromBase64Url(e.e)}),this.privateExponent=new H({valueHex:Ae.FromBase64Url(e.d)}),this.prime1=new H({valueHex:Ae.FromBase64Url(e.p)}),this.prime2=new H({valueHex:Ae.FromBase64Url(e.q)}),this.exponent1=new H({valueHex:Ae.FromBase64Url(e.dp)}),this.exponent2=new H({valueHex:Ae.FromBase64Url(e.dq)}),this.coefficient=new H({valueHex:Ae.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new sr({json:t})))}}Tt.CLASS_NAME="RSAPrivateKey";const Xu="version",Yu="privateKeyAlgorithm",Qu="privateKey",Ja="attributes",Fc="parsedKey",ub=[Xu,Yu,Qu,Ja];class us extends _{constructor(e={}){super(),this.version=d(e,Xu,us.defaultValues(Xu)),this.privateKeyAlgorithm=d(e,Yu,us.defaultValues(Yu)),this.privateKey=d(e,Qu,us.defaultValues(Qu)),Ja in e&&(this.attributes=d(e,Ja,us.defaultValues(Ja))),Fc in e&&(this.parsedKey=d(e,Fc,us.defaultValues(Fc))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xu:return 0;case Yu:return new M;case Qu:return new X;case Ja:return[];case Fc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),M.schema(t.privateKeyAlgorithm||{}),new X({name:t.privateKey||E}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:t.attributes||E,value:Oe.schema()})]})]})}fromSchema(e){G(e,ub);const t=z(e,e,us.schema({names:{version:Xu,privateKeyAlgorithm:{names:{blockName:Yu}},privateKey:Qu,attributes:Ja}}));switch(q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new M({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,Ja in t.result&&(this.attributes=Array.from(t.result.attributes,s=>new Oe({schema:s}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const s=Xe(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new Tt({schema:s.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof ae){const s=Xe(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new is({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:s.result}))}break}}toSchema(){const e=[new H({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new O({value:e})}toJSON(){if(!this.parsedKey){const s={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(s.attributes=Array.from(this.attributes,a=>a.toJSON())),s}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new is({json:e}),this.privateKeyAlgorithm=new M({algorithmId:"1.2.840.10045.2.1",algorithmParams:new ae({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Tt({json:e}),this.privateKeyAlgorithm=new M({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new at});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.privateKey=new X({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}us.CLASS_NAME="PrivateKeyInfo";const vi="contentType",bi="contentEncryptionAlgorithm",qa="encryptedContent",lb=[vi,bi,qa],Xd=1024;class We extends _{constructor(e={}){if(super(),this.contentType=d(e,vi,We.defaultValues(vi)),this.contentEncryptionAlgorithm=d(e,bi,We.defaultValues(bi)),qa in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4&&this.encryptedContent.idBlock.isConstructed===!1&&!e.disableSplit)){const t=new X({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const o=new Uint8Array(a,s,s+Xd>a.byteLength?a.byteLength-s:Xd),u=new ArrayBuffer(o.length),h=new Uint8Array(u);for(let c=0;c<h.length;c++)h[c]=o[c];t.valueBlock.value.push(new X({valueHex:u})),n-=o.length,s+=o.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vi:return E;case bi:return new M;case qa:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vi:return t===E;case bi:return t.algorithmId===E&&!("algorithmParams"in t);case qa:return t.isEqual(We.defaultValues(qa));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.contentType||E}),M.schema(t.contentEncryptionAlgorithm||{}),new je({value:[new L({name:t.encryptedContent||E,idBlock:{tagClass:3,tagNumber:0},value:[new me({value:new X})]}),new ue({name:t.encryptedContent||E,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){G(e,lb);const t=z(e,e,We.schema({names:{contentType:vi,contentEncryptionAlgorithm:{names:{blockName:bi}},encryptedContent:qa}}));q.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new M({schema:t.result.contentEncryptionAlgorithm}),qa in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new ae({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const s=this.encryptedContent;s.idBlock.tagClass=3,s.idBlock.tagNumber=0,s.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(s)}return new O({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return X.prototype.getValue.call(this.encryptedContent)}}We.CLASS_NAME="EncryptedContentInfo";const Rr="hashAlgorithm",Ur="maskGenAlgorithm",Lr="saltLength",jr="trailerField",cb=[Rr,Ur,Lr,jr];class wt extends _{constructor(e={}){super(),this.hashAlgorithm=d(e,Rr,wt.defaultValues(Rr)),this.maskGenAlgorithm=d(e,Ur,wt.defaultValues(Ur)),this.saltLength=d(e,Lr,wt.defaultValues(Lr)),this.trailerField=d(e,jr,wt.defaultValues(jr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rr:return new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new at});case Ur:return new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new at}).toSchema()});case Lr:return 20;case jr:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[M.schema(t.hashAlgorithm||{})]}),new L({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[M.schema(t.maskGenAlgorithm||{})]}),new L({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new H({name:t.saltLength||E})]}),new L({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new H({name:t.trailerField||E})]})]})}fromSchema(e){G(e,cb);const t=z(e,e,wt.schema({names:{hashAlgorithm:{names:{blockName:Rr}},maskGenAlgorithm:{names:{blockName:Ur}},saltLength:Lr,trailerField:jr}}));q.assertSchema(t,this.className),Rr in t.result&&(this.hashAlgorithm=new M({schema:t.result.hashAlgorithm})),Ur in t.result&&(this.maskGenAlgorithm=new M({schema:t.result.maskGenAlgorithm})),Lr in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),jr in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(wt.defaultValues(Rr))||e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(wt.defaultValues(Ur))||e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==wt.defaultValues(Lr)&&e.push(new L({idBlock:{tagClass:3,tagNumber:2},value:[new H({value:this.saltLength})]})),this.trailerField!==wt.defaultValues(jr)&&e.push(new L({idBlock:{tagClass:3,tagNumber:3},value:[new H({value:this.trailerField})]})),new O({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(wt.defaultValues(Rr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(wt.defaultValues(Ur))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==wt.defaultValues(Lr)&&(e.saltLength=this.saltLength),this.trailerField!==wt.defaultValues(jr)&&(e.trailerField=this.trailerField),e}}wt.CLASS_NAME="RSASSAPSSParams";const Si="salt",Zu="iterationCount",gs="keyLength",qs="prf",hb=[Si,Zu,gs,qs];class Ot extends _{constructor(e={}){super(),this.salt=d(e,Si,Ot.defaultValues(Si)),this.iterationCount=d(e,Zu,Ot.defaultValues(Zu)),gs in e&&(this.keyLength=d(e,gs,Ot.defaultValues(gs))),qs in e&&(this.prf=d(e,qs,Ot.defaultValues(qs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Si:return{};case Zu:return-1;case gs:return 0;case qs:return new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new at});default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new je({value:[new X({name:t.saltPrimitive||E}),M.schema(t.saltConstructed||{})]}),new H({name:t.iterationCount||E}),new H({name:t.keyLength||E,optional:!0}),M.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){G(e,hb);const t=z(e,e,Ot.schema({names:{saltPrimitive:Si,saltConstructed:{names:{blockName:Si}},iterationCount:Zu,keyLength:gs,prf:{names:{blockName:qs,optional:!0}}}}));q.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,gs in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),qs in t.result&&(this.prf=new M({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new H({value:this.iterationCount})),gs in this&&Ot.defaultValues(gs)!==this.keyLength&&e.push(new H({value:this.keyLength})),this.prf&&Ot.defaultValues(qs).isEqual(this.prf)===!1&&e.push(this.prf.toSchema()),new O({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return gs in this&&Ot.defaultValues(gs)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&Ot.defaultValues(qs).isEqual(this.prf)===!1&&(e.prf=this.prf.toJSON()),e}}Ot.CLASS_NAME="PBKDF2Params";const el="keyDerivationFunc",tl="encryptionScheme",mb=[el,tl];class Gn extends _{constructor(e={}){super(),this.keyDerivationFunc=d(e,el,Gn.defaultValues(el)),this.encryptionScheme=d(e,tl,Gn.defaultValues(tl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case el:return new M;case tl:return new M;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.keyDerivationFunc||{}),M.schema(t.encryptionScheme||{})]})}fromSchema(e){G(e,mb);const t=z(e,e,Gn.schema({names:{keyDerivationFunc:{names:{blockName:el}},encryptionScheme:{names:{blockName:tl}}}}));q.assertSchema(t,this.className),this.keyDerivationFunc=new M({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new M({schema:t.result.encryptionScheme})}toSchema(){return new O({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}Gn.CLASS_NAME="PBES2Params";class fb{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=d(e,"name",E)}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){return this.crypto.getRandomValues(e)}}async function Yd(r,e,t,s,a){let n,o,u;switch(r.toUpperCase()){case"SHA-1":n=20,o=64,u=U1;break;case"SHA-256":n=32,o=64,u=$1;break;case"SHA-384":n=48,o=128,u=hv;break;case"SHA-512":n=64,o=128,u=cv;break;default:throw new Error("Unsupported hashing algorithm")}const h=new Uint8Array(t);let c=new TextDecoder().decode(t);new TextEncoder().encode(c).some((S,I)=>S!==h[I])&&(c=String.fromCharCode(...h));const i=new Uint8Array(c.length*2+2),f=new DataView(i.buffer);for(let S=0;S<c.length;S++)f.setUint16(S*2,c.charCodeAt(S),!1);f.setUint16(c.length*2,0,!1);const m=new Uint8Array(o).fill(3),b=new Uint8Array(s),v=new Uint8Array(o*Math.ceil(b.length/o)).map((S,I)=>b[I%b.length]),w=new Uint8Array(o*Math.ceil(i.length/o)).map((S,I)=>i[I%i.length]);let y=new Uint8Array(v.length+w.length);y.set(v),y.set(w,v.length);const k=Math.ceil((e>>3)/n),p=[];for(let S=0;S<k;S++){let I=new Uint8Array(m.length+y.length);I.set(m),I.set(y,m.length);for(let B=0;B<a;B++)I=u(I);const P=new Uint8Array(o).map((B,V)=>I[V%I.length]),x=Math.ceil(b.length/o)+Math.ceil(i.length/o),T=[];for(let B=0;B<x;B++){const V=Array.from(y.slice(B*o,(B+1)*o));let J=511;for(let F=P.length-1;F>=0;F--)J>>=8,J+=P[F]+(V[F]||0),V[F]=J&255;T.push(...V)}y=new Uint8Array(T),p.push(...I)}return new Uint8Array(p.slice(0,e>>3)).buffer}function Ow(r){const e=typeof r=="string"?{name:r}:r;return"hash"in e?Cs(kt({},e),{hash:Ow(e.hash)}):e}class kc extends fb{async importKey(e,t,s,a,n){var o,u,h,c,i,f;let m={};const b=Ow(s);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,s,a,n);case"spki":{const v=Xe(Be.toArrayBuffer(t));q.assert(v,"keyData");const w=new Ft;try{w.fromSchema(v.result)}catch(y){throw new Ne("Incorrect keyData")}switch(b.name.toUpperCase()){case"RSA-PSS":{if(!b.hash)throw new ve("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(b.hash.name.toUpperCase()){case"SHA-1":m.alg="PS1";break;case"SHA-256":m.alg="PS256";break;case"SHA-384":m.alg="PS384";break;case"SHA-512":m.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(b.hash.name.toUpperCase()))}}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],m.kty="RSA",m.ext=a,m.key_ops=n,w.algorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect public key algorithm: ".concat(w.algorithm.algorithmId));if(!m.alg){if(!b.hash)throw new ve("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(b.hash.name.toUpperCase()){case"SHA-1":m.alg="RS1";break;case"SHA-256":m.alg="RS256";break;case"SHA-384":m.alg="RS384";break;case"SHA-512":m.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(b.hash.name.toUpperCase()))}}const y=w.toJSON();Object.assign(m,y)}break;case"ECDSA":n=["verify"];case"ECDH":{if(m={kty:"EC",ext:a,key_ops:n},w.algorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect public key algorithm: ".concat(w.algorithm.algorithmId));const y=w.toJSON();Object.assign(m,y)}break;case"RSA-OAEP":{if(m.kty="RSA",m.ext=a,m.key_ops=n,this.name.toLowerCase()==="safari")m.alg="RSA-OAEP";else{if(!b.hash)throw new ve("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(b.hash.name.toUpperCase()){case"SHA-1":m.alg="RSA-OAEP";break;case"SHA-256":m.alg="RSA-OAEP-256";break;case"SHA-384":m.alg="RSA-OAEP-384";break;case"SHA-512":m.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat(b.hash.name.toUpperCase()))}}const y=w.toJSON();Object.assign(m,y)}break;case"RSAES-PKCS1-V1_5":{m.kty="RSA",m.ext=a,m.key_ops=n,m.alg="PS1";const y=w.toJSON();Object.assign(m,y)}break;default:throw new Error("Incorrect algorithm name: ".concat(b.name.toUpperCase()))}}break;case"pkcs8":{const v=new us,w=Xe(Be.toArrayBuffer(t));q.assert(w,"keyData");try{v.fromSchema(w.result)}catch(y){throw new Error("Incorrect keyData")}if(!v.parsedKey)throw new Error("Incorrect keyData");switch(b.name.toUpperCase()){case"RSA-PSS":switch((o=b.hash)===null||o===void 0?void 0:o.name.toUpperCase()){case"SHA-1":m.alg="PS1";break;case"SHA-256":m.alg="PS256";break;case"SHA-384":m.alg="PS384";break;case"SHA-512":m.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((u=b.hash)===null||u===void 0?void 0:u.name.toUpperCase()))}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],m.kty="RSA",m.ext=a,m.key_ops=n,v.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect private key algorithm: ".concat(v.privateKeyAlgorithm.algorithmId));if(!("alg"in m))switch((h=b.hash)===null||h===void 0?void 0:h.name.toUpperCase()){case"SHA-1":m.alg="RS1";break;case"SHA-256":m.alg="RS256";break;case"SHA-384":m.alg="RS384";break;case"SHA-512":m.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((c=b.hash)===null||c===void 0?void 0:c.name.toUpperCase()))}const y=v.toJSON();Object.assign(m,y)}break;case"ECDSA":n=["sign"];case"ECDH":{if(m={kty:"EC",ext:a,key_ops:n},v.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect algorithm: ".concat(v.privateKeyAlgorithm.algorithmId));const y=v.toJSON();Object.assign(m,y)}break;case"RSA-OAEP":{if(m.kty="RSA",m.ext=a,m.key_ops=n,this.name.toLowerCase()==="safari")m.alg="RSA-OAEP";else switch((i=b.hash)===null||i===void 0?void 0:i.name.toUpperCase()){case"SHA-1":m.alg="RSA-OAEP";break;case"SHA-256":m.alg="RSA-OAEP-256";break;case"SHA-384":m.alg="RSA-OAEP-384";break;case"SHA-512":m.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat((f=b.hash)===null||f===void 0?void 0:f.name.toUpperCase()))}const y=v.toJSON();Object.assign(m,y)}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],m.kty="RSA",m.ext=a,m.key_ops=n,m.alg="PS1";const y=v.toJSON();Object.assign(m,y)}break;default:throw new Error("Incorrect algorithm name: ".concat(b.name.toUpperCase()))}}break;case"jwk":m=t;break;default:throw new Error("Incorrect format: ".concat(e))}if(this.name.toLowerCase()==="safari")try{return this.subtle.importKey("jwk",Fo(JSON.stringify(m)),s,a,n)}catch(v){return this.subtle.importKey("jwk",m,s,a,n)}return this.subtle.importKey("jwk",m,s,a,n)}async exportKey(e,t){let s=await this.subtle.exportKey("jwk",t);switch(this.name.toLowerCase()==="safari"&&s instanceof ArrayBuffer&&(s=JSON.parse(qh(s))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{const a=new Ft;try{a.fromJSON(s)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new us;try{a.fromJSON(s)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return s;default:throw new Error("Incorrect format: ".concat(e))}}async convert(e,t,s,a,n,o){if(e.toLowerCase()===t.toLowerCase())return s;const u=await this.importKey(e,s,a,n,o);return this.exportKey(t,u)}getAlgorithmByOID(e,t=!1,s){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error("Unsupported algorithm identifier ".concat(s?"for ".concat(s," "):E,": ").concat(e));return{}}getOIDByAlgorithm(e,t=!1,s){let a=E;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11";break}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35";break}if(!a&&t)throw new Error("Unsupported algorithm ".concat(s?"for ".concat(s," "):E,": ").concat(e.name));return a}getAlgorithmParameters(e,t){let s={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":s={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":s={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":s={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":s={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":s={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":s={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":s={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":s={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return s}getHashAlgorithm(e){let t=E;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const s=new wt({schema:e.algorithmParams});if(s.hashAlgorithm){const a=this.getAlgorithmByOID(s.hashAlgorithm.algorithmId);if("name"in a)t=a.name;else return E}else t="SHA-1"}catch(s){}break}return t}async encryptEncryptedContentInfo(e){ve.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),s=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),n=new ArrayBuffer(16),o=new Uint8Array(n);this.getRandomValues(o);const u=new ArrayBuffer(64),h=new Uint8Array(u);this.getRandomValues(h);const c=new Uint8Array(e.contentToEncrypt),i=new Ot({salt:new X({valueHex:u}),iterationCount:e.iterationCount,prf:new M({algorithmId:a,algorithmParams:new at})}),f=new Uint8Array(e.password),m=await this.importKey("raw",f,"PBKDF2",!1,["deriveKey"]),b=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:h,iterations:e.iterationCount},m,e.contentEncryptionAlgorithm,!1,["encrypt"]),v=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:o},b,c),w=new Gn({keyDerivationFunc:new M({algorithmId:s,algorithmParams:i.toSchema()}),encryptionScheme:new M({algorithmId:t,algorithmParams:new X({valueHex:n})})});return new We({contentType:e.contentType,contentEncryptionAlgorithm:new M({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:w.toSchema()}),encryptedContent:new X({valueHex:v})})}async decryptEncryptedContentInfo(e){if(ve.assert(e,"password","encryptedContentInfo"),e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")throw new Error('Unknown "contentEncryptionAlgorithm": '.concat(e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId));let t;try{t=new Gn({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(v){throw new Error('Incorrectly encoded "pbes2Parameters"')}let s;try{s=new Ot({schema:t.keyDerivationFunc.algorithmParams})}catch(v){throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),n=t.encryptionScheme.algorithmParams.valueBlock.valueHex,o=new Uint8Array(n),u=s.salt.valueBlock.valueHex,h=new Uint8Array(u),c=s.iterationCount;let i="SHA-1";s.prf&&(i=this.getAlgorithmByOID(s.prf.algorithmId,!0).hash.name);const f=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),m=await this.deriveKey({name:"PBKDF2",hash:{name:i},salt:h,iterations:c},f,a,!1,["decrypt"]),b=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:o},m,b)}async stampDataWithPassword(e){if(!(e instanceof Object))throw new Error('Parameters must have type "Object"');ve.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp");let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Yd(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["sign"]);return this.sign(s,n,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){ve.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Yd(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["verify"]);return this.verify(s,n,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");const s=new M,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const n=a.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?n.hash.name=e.algorithm.hash.name:n.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":s.algorithmId=this.getOIDByAlgorithm(n,!0);break;case"RSA-PSS":{switch(n.hash.name.toUpperCase()){case"SHA-256":n.saltLength=32;break;case"SHA-384":n.saltLength=48;break;case"SHA-512":n.saltLength=64;break}const o={};if(n.hash.name.toUpperCase()!=="SHA-1"){const h=this.getOIDByAlgorithm({name:n.hash.name},!0,"hashAlgorithm");o.hashAlgorithm=new M({algorithmId:h,algorithmParams:new at}),o.maskGenAlgorithm=new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:o.hashAlgorithm.toSchema()})}n.saltLength!==20&&(o.saltLength=n.saltLength);const u=new wt(o);s.algorithmId="1.2.840.113549.1.1.10",s.algorithmParams=u.toSchema()}break;default:throw new Error("Unsupported signature algorithm: ".concat(e.algorithm.name))}return{signatureAlgorithm:s,parameters:a}}async signWithPrivateKey(e,t,s){const a=await this.sign(s.algorithm,t,e);return s.algorithm.name==="ECDSA"?db(a):a}fillPublicKeyParameters(e,t){const s={},a=this.getHashAlgorithm(t);if(a===E)throw new Error("Unsupported signature algorithm: ".concat(t.algorithmId));let n;t.algorithmId==="1.2.840.113549.1.1.10"?n=t.algorithmId:n=e.algorithm.algorithmId;const o=this.getAlgorithmByOID(n,!0);if(s.algorithm=this.getAlgorithmParameters(o.name,"importKey"),"hash"in s.algorithm.algorithm&&(s.algorithm.algorithm.hash.name=a),o.name==="ECDSA"){const u=e.algorithm;if(!u.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const h=u.algorithmParams;if("idBlock"in u.algorithmParams&&!(h.idBlock.tagClass===1&&h.idBlock.tagNumber===6))throw new Error("Incorrect type for ECDSA public key parameters");const c=this.getAlgorithmByOID(h.valueBlock.toString(),!0);s.algorithm.algorithm.namedCurve=c.name}return s}async getPublicKey(e,t,s){s||(s=this.fillPublicKeyParameters(e,t));const a=e.toSchema().toBER(!1);return this.importKey("spki",a,s.algorithm.algorithm,!0,s.algorithm.usages)}async verifyWithPublicKey(e,t,s,a,n){let o;if(n){const c={};let i;a.algorithmId==="1.2.840.113549.1.1.10"?i=a.algorithmId:i=s.algorithm.algorithmId;const f=this.getAlgorithmByOID(i,!0);if(c.algorithm=this.getAlgorithmParameters(f.name,"importKey"),"hash"in c.algorithm.algorithm&&(c.algorithm.algorithm.hash.name=n),f.name==="ECDSA"){let m=!1;if("algorithmParams"in s.algorithm&&"idBlock"in s.algorithm.algorithmParams&&s.algorithm.algorithmParams.idBlock.tagClass===1&&s.algorithm.algorithmParams.idBlock.tagNumber===6&&(m=!0),m===!1)throw new Error("Incorrect type for ECDSA public key parameters");const b=this.getAlgorithmByOID(s.algorithm.algorithmParams.valueBlock.toString(),!0);c.algorithm.algorithm.namedCurve=b.name}o=await this.getPublicKey(s,null,c)}else{if(n=this.getHashAlgorithm(a),!n)throw new Error("Unsupported signature algorithm: ".concat(a.algorithmId));o=await this.getPublicKey(s,a)}const u=this.getAlgorithmParameters(o.algorithm.name,"verify");"hash"in u.algorithm&&(u.algorithm.hash.name=n);let h=t.valueBlock.valueHexView;if(o.algorithm.name==="ECDSA"){const c=Aa.find(o.algorithm.namedCurve);if(!c)throw new Error("Unsupported named curve in use");const i=Xe(h);q.assert(i,"Signature value"),h=gb(i.result,c.size)}if(o.algorithm.name==="RSA-PSS"){const c=new wt({schema:a.algorithmParams});"saltLength"in c?u.algorithm.saltLength=c.saltLength:u.algorithm.saltLength=20;let i="SHA-1";"hashAlgorithm"in c&&(i=this.getAlgorithmByOID(c.hashAlgorithm.algorithmId,!0).name),u.algorithm.hash.name=i}return this.verify(u.algorithm,o,h,e)}}let Pw={name:"none",crypto:null};function Qd(r){return!!(r&&typeof r=="object"&&"crypto"in r)}function Zd(r,...e){let t=null;if(e.length<2)e.length?t=e[0]:t=typeof self<"u"&&self.crypto?new kc({name:"browser",crypto:self.crypto}):null;else{const s=e[0],a=e[1];Qd(a)?t=a:Qd(s)?t=s:"subtle"in s&&"getRandomValues"in s&&(t=new kc({crypto:s}))}if(typeof lt<"u"&&"pid"in lt&&typeof _t<"u"&&typeof window>"u"){if(typeof _t[lt.pid]>"u")_t[lt.pid]={};else if(typeof _t[lt.pid]!="object")throw new Error("Name global.".concat(lt.pid," already exists and it is not an object"));if(typeof _t[lt.pid].pkijs>"u")_t[lt.pid].pkijs={};else if(typeof _t[lt.pid].pkijs!="object")throw new Error("Name global.".concat(lt.pid,".pkijs already exists and it is not an object"));_t[lt.pid].pkijs.engine={name:r,crypto:t}}else Pw={name:r,crypto:t}}function pb(){if(typeof lt<"u"&&"pid"in lt&&typeof _t<"u"&&typeof window>"u"){let r;try{r=_t[lt.pid].pkijs.engine}catch(e){throw new Error("Please call 'setEngine' before call to 'getEngine'")}return r}return Pw}function fe(r=!1){const e=pb();if(!e.crypto&&r)throw new Error("Unable to create WebCrypto object");return e.crypto}function db(r){if(r.byteLength%2!==0)return Ye;const e=r.byteLength/2,t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(r,0,e));const s=new H({valueHex:t}),a=new ArrayBuffer(e);new Uint8Array(a).set(new Uint8Array(r,e,e));const n=new H({valueHex:a});return new O({value:[s.convertToDER(),n.convertToDER()]}).toBER(!1)}function gb(r,e){if(!(r instanceof O&&r.valueBlock.value.length===2&&r.valueBlock.value[0]instanceof H&&r.valueBlock.value[1]instanceof H))return Ye;const t=r.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,s=r.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,a=new Uint8Array(e*2);return a.set(t,e-t.byteLength),a.set(s,2*e-s.byteLength),a.buffer}async function wb(r,e,t,s,a){switch(r.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new Ne("Unknown hash function: ".concat(r))}if(Ne.assert(e,"zBuffer","ArrayBuffer"),e.byteLength===0)throw new Ne("'zBuffer' has zero length, error");if(Ne.assert(s,"SharedInfo","ArrayBuffer"),t>255)throw new Ne("Please set 'Counter' argument to value less or equal to 255");const n=new ArrayBuffer(4),o=new Uint8Array(n);o[0]=0,o[1]=0,o[2]=0,o[3]=t;let u=Ye;u=Uo(u,e),u=Uo(u,n),u=Uo(u,s);const h=await a.digest({name:r},u);return{counter:t,result:h}}async function eg(r,e,t,s,a=fe(!0)){let n=0,o=1;switch(r.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:throw new Ne("Unknown hash function: ".concat(r))}if(Ne.assert(e,"Zbuffer","ArrayBuffer"),e.byteLength===0)throw new Ne("'Zbuffer' has zero length, error");Ne.assert(s,"SharedInfo","ArrayBuffer");const u=t/n;Math.floor(u)>0&&(o=Math.floor(u),u-o>0&&o++);const h=[];for(let m=1;m<=o;m++)h.push(await wb(r,e,m,s,a));let c=Ye,i=1,f=!0;for(;f;){f=!1;for(const m of h)if(m.counter===i){c=Uo(c,m.result),f=!0;break}i++}if(t>>=3,c.byteLength>t){const m=new ArrayBuffer(t),b=new Uint8Array(m),v=new Uint8Array(c);for(let w=0;w<t;w++)b[w]=v[w];return m}return c}const ef="version",tf="logID",sf="extensions",rf="timestamp",af="hashAlgorithm",nf="signatureAlgorithm",of="signature",tg="none",sg="md5",rg="sha1",ag="sha224",ng="sha256",ig="sha384",og="sha512",ug="anonymous",lg="rsa",cg="dsa",hg="ecdsa";class Bs extends _{constructor(e={}){super(),this.version=d(e,ef,Bs.defaultValues(ef)),this.logID=d(e,tf,Bs.defaultValues(tf)),this.timestamp=d(e,rf,Bs.defaultValues(rf)),this.extensions=d(e,sf,Bs.defaultValues(sf)),this.hashAlgorithm=d(e,af,Bs.defaultValues(af)),this.signatureAlgorithm=d(e,nf,Bs.defaultValues(nf)),this.signature=d(e,of,Bs.defaultValues(of)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ef:return 0;case tf:case sf:return Ye;case rf:return new Date(0);case af:case nf:return E;case of:return new le;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof Wh))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new Sa({stream:new Le({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(vy(new Uint8Array(e.getBlock(8)),8));const s=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(s)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=tg;break;case 1:this.hashAlgorithm=sg;break;case 2:this.hashAlgorithm=rg;break;case 3:this.hashAlgorithm=ag;break;case 4:this.hashAlgorithm=ng;break;case 5:this.hashAlgorithm=ig;break;case 6:this.hashAlgorithm=og;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=ug;break;case 1:this.signatureAlgorithm=lg;break;case 2:this.signatureAlgorithm=cg;break;case 3:this.signatureAlgorithm=hg;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16(),n=new Uint8Array(e.getBlock(a)).buffer.slice(0),o=Xe(n);if(q.assert(o,"SignedCertificateTimestamp"),this.signature=o.result,t!==47+s+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new Wh({data:e.stream.buffer})}toStream(){const e=new Sa;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),s=new Uint8Array(t),a=sd(this.timestamp.valueOf(),8);s.set(new Uint8Array(a),8-a.byteLength),e.appendView(s),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions));let n;switch(this.hashAlgorithm.toLowerCase()){case tg:n=0;break;case sg:n=1;break;case rg:n=2;break;case ag:n=3;break;case ng:n=4;break;case ig:n=5;break;case og:n=6;break;default:throw new Error("Incorrect data for hashAlgorithm: ".concat(this.hashAlgorithm))}e.appendChar(n);let o;switch(this.signatureAlgorithm.toLowerCase()){case ug:o=0;break;case lg:o=1;break;case cg:o=2;break;case hg:o=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: ".concat(this.signatureAlgorithm))}e.appendChar(o);const u=this.signature.toBER(!1);return e.appendUint16(u.byteLength),e.appendView(new Uint8Array(u)),e}toJSON(){return{version:this.version,logID:rd(this.logID),timestamp:this.timestamp,extensions:rd(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,s=0,a=fe(!0)){const n=Of(qh(this.logID));let o=null;const u=new Sa;for(const b of e)if(b.log_id===n){o=b.key;break}if(!o)throw new Error("Public key not found for CT with logId: ".concat(n));const h=Fo(wc(o)),c=Ft.fromBER(h);u.appendChar(0),u.appendChar(0);const i=new ArrayBuffer(8),f=new Uint8Array(i),m=sd(this.timestamp.valueOf(),8);return f.set(new Uint8Array(m),8-m.byteLength),u.appendView(f),u.appendUint16(s),s===0&&u.appendUint24(t.byteLength),u.appendView(new Uint8Array(t)),u.appendUint16(this.extensions.byteLength),this.extensions.byteLength!==0&&u.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(u.buffer.slice(0,u.length),new X({valueHex:this.signature.toBER(!1)}),c,{algorithmId:E},"SHA-256")}}Bs.CLASS_NAME="SignedCertificateTimestamp";const Jc="timestamps";class ym extends _{constructor(e={}){super(),this.timestamps=d(e,Jc,ym.defaultValues(Jc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Jc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){var t;const s=d(e,"names",{});return(t=s.optional)!==null&&t!==void 0||(s.optional=!1),new X({name:s.blockName||"SignedCertificateTimestampList",optional:s.optional})}fromSchema(e){if(!(e instanceof X))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new Sa({stream:new Le({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new Bs({stream:t}))}toSchema(){const e=new Sa;let t=0;const s=[];for(const a of this.timestamps){const n=a.toStream();s.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const a of s)e.appendView(a.stream.view);return new X({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}ym.CLASS_NAME="SignedCertificateTimestampList";const sl="attributes",yb=[sl];class Ic extends _{constructor(e={}){super(),this.attributes=d(e,sl,Ic.defaultValues(sl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.attributes||E,value:Oe.schema()})]})}fromSchema(e){G(e,yb);const t=z(e,e,Ic.schema({names:{attributes:sl}}));q.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,s=>new Oe({schema:s}))}toSchema(){return new O({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}Ic.CLASS_NAME="SubjectDirectoryAttributes";class Te{static getItems(){return this.types||(this.types={},Te.register(gw,"SubjectAltName",qo),Te.register(ww,"IssuerAltName",qo),Te.register(Vp,"AuthorityKeyIdentifier",ga),Te.register(Ip,"BasicConstraints",Hn),Te.register(Tv,"MicrosoftCaVersion",Sc),Te.register(Aw,"CertificatePolicies",Wo),Te.register(Vv,"CertificatePoliciesMicrosoft",Wo),Te.register(Dv,"MicrosoftCertTemplateV2",To),Te.register(Sw,"CRLDistributionPoints",_o),Te.register(Cp,"FreshestCRL",_o),Te.register(xv,"ExtKeyUsage",Ac),Te.register(vw,"CertificateIssuer",it),Te.register(xp,"AuthorityInfoAccess",Go),Te.register(Ov,"SubjectInfoAccess",Go),Te.register(yw,"IssuingDistributionPoint",dt),Te.register(bw,"NameConstraints",jo),Te.register(Ew,"PolicyConstraints",$o),Te.register(Nw,"PolicyMappings",Nc),Te.register(Nv,"PrivateKeyUsagePeriod",Ko),Te.register(Rv,"QCStatements",Ec),Te.register(Pv,"SignedCertificateTimestampList",ym),Te.register(bv,"SubjectDirectoryAttributes",Ic)),this.types}static fromBER(e,t){const s=Xe(t);if(s.offset===-1)return null;const a=this.find(e);if(a)try{return new a.type({schema:s.result})}catch(n){const o=new a.type;return o.parsingError="Incorrectly formatted value of extension ".concat(a.name," (").concat(e,")"),o}return s.result}static find(e){return this.getItems()[e]||null}static register(e,t,s){this.getItems()[e]={name:t,type:s}}}const rl="extnID",$r="critical",al="extnValue",qc="parsedValue",vb=[rl,$r,al];class _e extends _{get parsedValue(){if(this._parsedValue===void 0){const e=Te.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=d(e,rl,_e.defaultValues(rl)),this.critical=d(e,$r,_e.defaultValues($r)),al in e?this.extnValue=new X({valueHex:e.extnValue}):this.extnValue=_e.defaultValues(al),qc in e&&(this.parsedValue=d(e,qc,_e.defaultValues(qc))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rl:return E;case $r:return!1;case al:return new X;case qc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.extnID||E}),new Ia({name:t.critical||E,optional:!0}),new X({name:t.extnValue||E})]})}fromSchema(e){G(e,vb);const t=z(e,e,_e.schema({names:{extnID:rl,critical:$r,extnValue:al}}));q.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),$r in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new ae({value:this.extnID})),this.critical!==_e.defaultValues($r)&&e.push(new Ia({value:this.critical})),e.push(this.extnValue),new O({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==_e.defaultValues($r)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}_e.CLASS_NAME="Extension";const nl="extensions",bb=[nl];class Qe extends _{constructor(e={}){super(),this.extensions=d(e,nl,Qe.defaultValues(nl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nl:return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,"names",{});return new O({optional:t,name:s.blockName||E,value:[new me({name:s.extensions||E,value:_e.schema(s.extension||{})})]})}fromSchema(e){G(e,bb);const t=z(e,e,Qe.schema({names:{extensions:nl}}));q.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,s=>new _e({schema:s}))}toSchema(){return new O({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}Qe.CLASS_NAME="Extensions";const il="issuer",ol="serialNumber",Wa="issuerUID",Sb=[il,ol,Wa];class Ht extends _{constructor(e={}){super(),this.issuer=d(e,il,Ht.defaultValues(il)),this.serialNumber=d(e,ol,Ht.defaultValues(ol)),Wa in e&&(this.issuerUID=d(e,Wa,Ht.defaultValues(Wa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case il:return new it;case ol:return new H;case Wa:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[it.schema(t.issuer||{}),new H({name:t.serialNumber||E}),new ye({optional:!0,name:t.issuerUID||E})]})}fromSchema(e){G(e,Sb);const t=z(e,e,Ht.schema({names:{issuer:{names:{blockName:il}},serialNumber:ol,issuerUID:Wa}}));q.assertSchema(t,this.className),this.issuer=new it({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,Wa in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new O({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}Ht.CLASS_NAME="IssuerSerial";const ul="version",_a="baseCertificateID",Ga="subjectName",ll="issuer",cl="signature",hl="serialNumber",ml="attrCertValidityPeriod",fl="attributes",za="issuerUniqueID",Xa="extensions",Ab=[ul,_a,Ga,ll,cl,hl,ml,fl,za,Xa];class xt extends _{constructor(e={}){super(),this.version=d(e,ul,xt.defaultValues(ul)),_a in e&&(this.baseCertificateID=d(e,_a,xt.defaultValues(_a))),Ga in e&&(this.subjectName=d(e,Ga,xt.defaultValues(Ga))),this.issuer=d(e,ll,xt.defaultValues(ll)),this.signature=d(e,cl,xt.defaultValues(cl)),this.serialNumber=d(e,hl,xt.defaultValues(hl)),this.attrCertValidityPeriod=d(e,ml,xt.defaultValues(ml)),this.attributes=d(e,fl,xt.defaultValues(fl)),za in e&&(this.issuerUniqueID=d(e,za,xt.defaultValues(za))),Xa in e&&(this.extensions=d(e,Xa,xt.defaultValues(Xa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ul:return 0;case _a:return new Ht;case Ga:return new it;case ll:return new it;case cl:return new M;case hl:return new H;case ml:return new Ns;case fl:return[];case za:return new ye;case Xa:return new Qe;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new je({value:[new L({name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Ht.schema().valueBlock.value}),new L({name:t.subjectName||E,idBlock:{tagClass:3,tagNumber:1},value:it.schema().valueBlock.value})]}),it.schema({names:{blockName:t.issuer||E}}),M.schema(t.signature||{}),new H({name:t.serialNumber||E}),Ns.schema(t.attrCertValidityPeriod||{}),new O({name:t.attributes||E,value:[new me({value:Oe.schema()})]}),new ye({optional:!0,name:t.issuerUniqueID||E}),Qe.schema(t.extensions||{},!0)]})}fromSchema(e){G(e,Ab);const t=z(e,e,xt.schema({names:{version:ul,baseCertificateID:_a,subjectName:Ga,issuer:ll,signature:{names:{blockName:cl}},serialNumber:hl,attrCertValidityPeriod:{names:{blockName:ml}},attributes:fl,issuerUniqueID:za,extensions:{names:{blockName:Xa}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,_a in t.result&&(this.baseCertificateID=new Ht({schema:new O({value:t.result.baseCertificateID.valueBlock.value})})),Ga in t.result&&(this.subjectName=new it({schema:new O({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new M({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new Ns({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new Oe({schema:s})),za in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),Xa in t.result&&(this.extensions=new Qe({schema:t.result.extensions}))}toSchema(){const e=new O({value:[new H({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new O({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}xt.CLASS_NAME="AttributeCertificateInfoV1";const pl="acinfo",dl="signatureAlgorithm",gl="signatureValue",Nb=[pl,gl,dl];class rr extends _{constructor(e={}){super(),this.acinfo=d(e,pl,rr.defaultValues(pl)),this.signatureAlgorithm=d(e,dl,rr.defaultValues(dl)),this.signatureValue=d(e,gl,rr.defaultValues(gl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pl:return new xt;case dl:return new M;case gl:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[xt.schema(t.acinfo||{}),M.schema(t.signatureAlgorithm||{}),new ye({name:t.signatureValue||E})]})}fromSchema(e){G(e,Nb);const t=z(e,e,rr.schema({names:{acinfo:{names:{blockName:pl}},signatureAlgorithm:{names:{blockName:dl}},signatureValue:gl}}));q.assertSchema(t,this.className),this.acinfo=new xt({schema:t.result.acinfo}),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new O({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}rr.CLASS_NAME="AttributeCertificateV1";const wl="digestedObjectType",Ya="otherObjectTypeID",yl="digestAlgorithm",vl="objectDigest",Eb=[wl,Ya,yl,vl];class es extends _{constructor(e={}){super(),this.digestedObjectType=d(e,wl,es.defaultValues(wl)),Ya in e&&(this.otherObjectTypeID=d(e,Ya,es.defaultValues(Ya))),this.digestAlgorithm=d(e,yl,es.defaultValues(yl)),this.objectDigest=d(e,vl,es.defaultValues(vl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wl:return new vc;case Ya:return new ae;case yl:return new M;case vl:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new vc({name:t.digestedObjectType||E}),new ae({optional:!0,name:t.otherObjectTypeID||E}),M.schema(t.digestAlgorithm||{}),new ye({name:t.objectDigest||E})]})}fromSchema(e){G(e,Eb);const t=z(e,e,es.schema({names:{digestedObjectType:wl,otherObjectTypeID:Ya,digestAlgorithm:{names:{blockName:yl}},objectDigest:vl}}));q.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,Ya in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new M({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new O({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}es.CLASS_NAME="ObjectDigestInfo";const Qa="issuerName",Za="baseCertificateID",en="objectDigestInfo",kb=[Qa,Za,en];class ya extends _{constructor(e={}){super(),Qa in e&&(this.issuerName=d(e,Qa,ya.defaultValues(Qa))),Za in e&&(this.baseCertificateID=d(e,Za,ya.defaultValues(Za))),en in e&&(this.objectDigestInfo=d(e,en,ya.defaultValues(en))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qa:return new it;case Za:return new Ht;case en:return new es;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[it.schema({names:{blockName:t.issuerName}},!0),new L({optional:!0,name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Ht.schema().valueBlock.value}),new L({optional:!0,name:t.objectDigestInfo||E,idBlock:{tagClass:3,tagNumber:1},value:es.schema().valueBlock.value})]})}fromSchema(e){G(e,kb);const t=z(e,e,ya.schema({names:{issuerName:Qa,baseCertificateID:Za,objectDigestInfo:en}}));q.assertSchema(t,this.className),Qa in t.result&&(this.issuerName=new it({schema:t.result.issuerName})),Za in t.result&&(this.baseCertificateID=new Ht({schema:new O({value:t.result.baseCertificateID.valueBlock.value})})),en in t.result&&(this.objectDigestInfo=new es({schema:new O({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new O;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}ya.CLASS_NAME="V2Form";const tn="baseCertificateID",sn="entityName",rn="objectDigestInfo",Ib=[tn,sn,rn];class ar extends _{constructor(e={}){super(),tn in e&&(this.baseCertificateID=d(e,tn,ar.defaultValues(tn))),sn in e&&(this.entityName=d(e,sn,ar.defaultValues(sn))),rn in e&&(this.objectDigestInfo=d(e,rn,ar.defaultValues(rn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tn:return new Ht;case sn:return new it;case rn:return new es;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({optional:!0,name:t.baseCertificateID||E,idBlock:{tagClass:3,tagNumber:0},value:Ht.schema().valueBlock.value}),new L({optional:!0,name:t.entityName||E,idBlock:{tagClass:3,tagNumber:1},value:it.schema().valueBlock.value}),new L({optional:!0,name:t.objectDigestInfo||E,idBlock:{tagClass:3,tagNumber:2},value:es.schema().valueBlock.value})]})}fromSchema(e){G(e,Ib);const t=z(e,e,ar.schema({names:{baseCertificateID:tn,entityName:sn,objectDigestInfo:rn}}));q.assertSchema(t,this.className),tn in t.result&&(this.baseCertificateID=new Ht({schema:new O({value:t.result.baseCertificateID.valueBlock.value})})),sn in t.result&&(this.entityName=new it({schema:new O({value:t.result.entityName.valueBlock.value})})),rn in t.result&&(this.objectDigestInfo=new es({schema:new O({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new O;return this.baseCertificateID&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new L({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}ar.CLASS_NAME="Holder";const bl="version",Sl="holder",Al="issuer",Nl="signature",El="serialNumber",kl="attrCertValidityPeriod",Il="attributes",an="issuerUniqueID",nn="extensions",Cb=[bl,Sl,Al,Nl,El,kl,Il,an,nn];class Rt extends _{constructor(e={}){super(),this.version=d(e,bl,Rt.defaultValues(bl)),this.holder=d(e,Sl,Rt.defaultValues(Sl)),this.issuer=d(e,Al,Rt.defaultValues(Al)),this.signature=d(e,Nl,Rt.defaultValues(Nl)),this.serialNumber=d(e,El,Rt.defaultValues(El)),this.attrCertValidityPeriod=d(e,kl,Rt.defaultValues(kl)),this.attributes=d(e,Il,Rt.defaultValues(Il)),an in e&&(this.issuerUniqueID=d(e,an,Rt.defaultValues(an))),nn in e&&(this.extensions=d(e,nn,Rt.defaultValues(nn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bl:return 1;case Sl:return new ar;case Al:return{};case Nl:return new M;case El:return new H;case kl:return new Ns;case Il:return[];case an:return new ye;case nn:return new Qe;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),ar.schema(t.holder||{}),new je({value:[it.schema({names:{blockName:t.issuer||E}}),new L({name:t.issuer||E,idBlock:{tagClass:3,tagNumber:0},value:ya.schema().valueBlock.value})]}),M.schema(t.signature||{}),new H({name:t.serialNumber||E}),Ns.schema(t.attrCertValidityPeriod||{}),new O({name:t.attributes||E,value:[new me({value:Oe.schema()})]}),new ye({optional:!0,name:t.issuerUniqueID||E}),Qe.schema(t.extensions||{},!0)]})}fromSchema(e){G(e,Cb);const t=z(e,e,Rt.schema({names:{version:bl,holder:{names:{blockName:Sl}},issuer:Al,signature:{names:{blockName:Nl}},serialNumber:El,attrCertValidityPeriod:{names:{blockName:kl}},attributes:Il,issuerUniqueID:an,extensions:{names:{blockName:nn}}}}));switch(q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new ar({schema:t.result.holder}),t.result.issuer.idBlock.tagClass){case 3:this.issuer=new ya({schema:new O({value:t.result.issuer.valueBlock.value})});break;case 1:default:throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2")}this.signature=new M({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new Ns({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new Oe({schema:s})),an in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),nn in t.result&&(this.extensions=new Qe({schema:t.result.extensions}))}toSchema(){const e=new O({value:[new H({value:this.version}),this.holder.toSchema(),new L({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new O({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}Rt.CLASS_NAME="AttributeCertificateInfoV2";const Cl="acinfo",Vl="signatureAlgorithm",xl="signatureValue",Vb=[Cl,Vl,xl];class ts extends _{constructor(e={}){super(),this.acinfo=d(e,Cl,ts.defaultValues(Cl)),this.signatureAlgorithm=d(e,Vl,ts.defaultValues(Vl)),this.signatureValue=d(e,xl,ts.defaultValues(xl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cl:return new Rt;case Vl:return new M;case xl:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Rt.schema(t.acinfo||{}),M.schema(t.signatureAlgorithm||{}),new ye({name:t.signatureValue||E})]})}fromSchema(e){G(e,Vb);const t=z(e,e,ts.schema({names:{acinfo:{names:{blockName:Cl}},signatureAlgorithm:{names:{blockName:Vl}},signatureValue:xl}}));q.assertSchema(t,this.className),this.acinfo=new Rt({schema:t.result.acinfo}),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new O({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}ts.CLASS_NAME="AttributeCertificateV2";const on="contentType",Ai="content",xb=[on,Ai];class Ie extends _{constructor(e={}){super(),this.contentType=d(e,on,Ie.defaultValues(on)),this.content=d(e,Ai,Ie.defaultValues(Ai)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case on:return E;case Ai:return new le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case on:return typeof t=="string"&&t===this.defaultValues(on);case Ai:return t instanceof le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return"optional"in t||(t.optional=!1),new O({name:t.blockName||"ContentInfo",optional:t.optional,value:[new ae({name:t.contentType||on}),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.content||Ai})]})]})}fromSchema(e){G(e,xb);const t=z(e,e,Ie.schema());q.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new O({value:[new ae({value:this.contentType}),new L({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof le||(e.content=this.content.toJSON()),e}}Ie.CLASS_NAME="ContentInfo",Ie.DATA=Bp,Ie.SIGNED_DATA=kw,Ie.ENVELOPED_DATA=Iw,Ie.ENCRYPTED_DATA=Cw;const uf="type",lf="value",Jf="utcTimeName",qf="generalTimeName",Bb=[Jf,qf];var mg;(function(r){r[r.UTCTime=0]="UTCTime",r[r.GeneralizedTime=1]="GeneralizedTime",r[r.empty=2]="empty"})(mg||(mg={}));class ze extends _{constructor(e={}){super(),this.type=d(e,uf,ze.defaultValues(uf)),this.value=d(e,lf,ze.defaultValues(lf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uf:return 0;case lf:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,"names",{});return new je({optional:t,value:[new Pf({name:s.utcTimeName||E}),new $e({name:s.generalTimeName||E})]})}fromSchema(e){G(e,Bb);const t=z(e,e,ze.schema({names:{utcTimeName:Jf,generalTimeName:qf}}));q.assertSchema(t,this.className),Jf in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),qf in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return this.type===0?new Pf({valueDate:this.value}):this.type===1?new $e({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}ze.CLASS_NAME="Time";const cf="tbs",Kr="version",dh="serialNumber",gh="signature",wh="issuer",yh="notBefore",vh="notAfter",bh="subject",Sh="subjectPublicKeyInfo",Bl="issuerUniqueID",Ol="subjectUniqueID",Pl="extensions",Dl="signatureAlgorithm",Tl="signatureValue",ss="tbsCertificate",sm="".concat(ss,".").concat(Kr),Op="".concat(ss,".").concat(dh),Pp="".concat(ss,".").concat(gh),Dp="".concat(ss,".").concat(wh),rm="".concat(ss,".").concat(yh),am="".concat(ss,".").concat(vh),Tp="".concat(ss,".").concat(bh),Rp="".concat(ss,".").concat(Sh),nm="".concat(ss,".").concat(Bl),im="".concat(ss,".").concat(Ol),pc="".concat(ss,".").concat(Pl),Ob=[ss,sm,Op,Pp,Dp,rm,am,Tp,Rp,nm,im,pc,Dl,Tl];function Pb(r={}){const e=d(r,"names",{});return new O({name:e.blockName||ss,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:e.tbsCertificateVersion||sm})]}),new H({name:e.tbsCertificateSerialNumber||Op}),M.schema(e.signature||{names:{blockName:Pp}}),Ee.schema(e.issuer||{names:{blockName:Dp}}),new O({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[ze.schema(e.notBefore||{names:{utcTimeName:rm,generalTimeName:rm}}),ze.schema(e.notAfter||{names:{utcTimeName:am,generalTimeName:am}})]}),Ee.schema(e.subject||{names:{blockName:Tp}}),Ft.schema(e.subjectPublicKeyInfo||{names:{blockName:Rp}}),new ue({name:e.tbsCertificateIssuerUniqueID||nm,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new ue({name:e.tbsCertificateSubjectUniqueID||im,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Qe.schema(e.extensions||{names:{blockName:pc}})]})]})}class be extends _{get tbs(){return Be.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,cf,be.defaultValues(cf))),this.version=d(e,Kr,be.defaultValues(Kr)),this.serialNumber=d(e,dh,be.defaultValues(dh)),this.signature=d(e,gh,be.defaultValues(gh)),this.issuer=d(e,wh,be.defaultValues(wh)),this.notBefore=d(e,yh,be.defaultValues(yh)),this.notAfter=d(e,vh,be.defaultValues(vh)),this.subject=d(e,bh,be.defaultValues(bh)),this.subjectPublicKeyInfo=d(e,Sh,be.defaultValues(Sh)),Bl in e&&(this.issuerUniqueID=d(e,Bl,be.defaultValues(Bl))),Ol in e&&(this.subjectUniqueID=d(e,Ol,be.defaultValues(Ol))),Pl in e&&(this.extensions=d(e,Pl,be.defaultValues(Pl))),this.signatureAlgorithm=d(e,Dl,be.defaultValues(Dl)),this.signatureValue=d(e,Tl,be.defaultValues(Tl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cf:return Ye;case Kr:return 0;case dh:return new H;case gh:return new M;case wh:return new Ee;case yh:return new ze;case vh:return new ze;case bh:return new Ee;case Sh:return new Ft;case Bl:return Ye;case Ol:return Ye;case Pl:return[];case Dl:return new M;case Tl:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Pb(t.tbsCertificate),M.schema(t.signatureAlgorithm||{names:{blockName:Dl}}),new ye({name:t.signatureValue||Tl})]})}fromSchema(e){G(e,Ob);const t=z(e,e,be.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:pc}}}}}}));q.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,sm in t.result&&(this.version=t.result[sm].valueBlock.valueDec),this.serialNumber=t.result[Op],this.signature=new M({schema:t.result[Pp]}),this.issuer=new Ee({schema:t.result[Dp]}),this.notBefore=new ze({schema:t.result[rm]}),this.notAfter=new ze({schema:t.result[am]}),this.subject=new Ee({schema:t.result[Tp]}),this.subjectPublicKeyInfo=new Ft({schema:t.result[Rp]}),nm in t.result&&(this.issuerUniqueID=t.result[nm].valueBlock.valueHex),im in t.result&&(this.subjectUniqueID=t.result[im].valueBlock.valueHex),pc in t.result&&(this.extensions=Array.from(t.result[pc],s=>new _e({schema:s}))),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return Kr in this&&this.version!==be.defaultValues(Kr)&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new O({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new ue({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new ue({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new O({value:Array.from(this.extensions,t=>t.toSchema())})]})),new O({value:e})}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return be.schema().value[0];const s=Xe(this.tbsView);q.assert(s,"TBS Certificate"),t=s.result}else t=this.encodeTBS();return new O({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Kr in this&&this.version!==be.defaultValues(Kr)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=Ae.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=Ae.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async getPublicKey(e,t=fe(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=fe(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",s=fe(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const o=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ye({valueHex:o})}async verify(e,t=fe(!0)){let s;if(e?s=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(s=this.subjectPublicKeyInfo),!(s instanceof Ft))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}be.CLASS_NAME="Certificate";function Dw(r,e=null){if(e&&r.issuer.isEqual(e.issuer)&&r.serialNumber.isEqual(e.serialNumber))return null;let t=!1;if(r.extensions){for(const s of r.extensions)if(s.extnID===Ip&&s.parsedValue instanceof Hn&&s.parsedValue.cA){t=!0;break}}return t?r:null}const Ni="certId",Ei="certValue",ai="parsedValue",Db=[Ni,Ei];class Un extends _{constructor(e={}){super(),this.certId=d(e,Ni,Un.defaultValues(Ni)),this.certValue=d(e,Ei,Un.defaultValues(Ei)),ai in e&&(this.parsedValue=d(e,ai,Un.defaultValues(ai))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ni:return E;case Ei:return new le;case ai:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ni:return t===E;case Ei:return t instanceof le;case ai:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.id||"id"}),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.value||"value"})]})]})}fromSchema(e){G(e,Db);const t=z(e,e,Un.schema({names:{id:Ni,value:Ei}}));q.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const s=this.certValue.valueBlock.valueHexView;switch(this.certId){case _d:try{this.parsedValue=be.fromBER(s)}catch(a){ts.fromBER(s)}break;case Gd:this.parsedValue=ts.fromBER(s);break;case Lv:default:throw new Error("Incorrect CERT_ID value in CertBag: ".concat(this.certId))}}toSchema(){return ai in this&&("acinfo"in this.parsedValue?this.certId=Gd:this.certId=_d,this.certValue=new X({valueHex:this.parsedValue.toSchema().toBER(!1)})),new O({value:[new ae({value:this.certId}),new L({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}Un.CLASS_NAME="CertBag";const Rl="userCertificate",ki="revocationDate",un="crlEntryExtensions",Tb=[Rl,ki,un];class Ln extends _{constructor(e={}){super(),this.userCertificate=d(e,Rl,Ln.defaultValues(Rl)),this.revocationDate=d(e,ki,Ln.defaultValues(ki)),un in e&&(this.crlEntryExtensions=d(e,un,Ln.defaultValues(un))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rl:return new H;case ki:return new ze;case un:return new Qe;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.userCertificate||Rl}),ze.schema({names:{utcTimeName:t.revocationDate||ki,generalTimeName:t.revocationDate||ki}}),Qe.schema({names:{blockName:t.crlEntryExtensions||un}},!0)]})}fromSchema(e){G(e,Tb);const t=z(e,e,Ln.schema());q.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new ze({schema:t.result.revocationDate}),un in t.result&&(this.crlEntryExtensions=new Qe({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new O({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}Ln.CLASS_NAME="RevokedCertificate";const hf="tbs",ou="version",mf="signature",ff="issuer",pf="thisUpdate",Wc="nextUpdate",_c="revokedCertificates",Gc="crlExtensions",Ul="signatureAlgorithm",Ll="signatureValue",mr="tbsCertList",om="".concat(mr,".version"),Up="".concat(mr,".signature"),Lp="".concat(mr,".issuer"),um="".concat(mr,".thisUpdate"),Cc="".concat(mr,".nextUpdate"),lm="".concat(mr,".revokedCertificates"),cm="".concat(mr,".extensions"),Rb=[mr,om,Up,Lp,um,Cc,lm,cm,Ul,Ll];function Ub(r={}){const e=d(r,"names",{});return new O({name:e.blockName||mr,value:[new H({optional:!0,name:e.tbsCertListVersion||om,value:2}),M.schema(e.signature||{names:{blockName:Up}}),Ee.schema(e.issuer||{names:{blockName:Lp}}),ze.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:um,generalTimeName:um}}),ze.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:Cc,generalTimeName:Cc}},!0),new O({optional:!0,value:[new me({name:e.tbsCertListRevokedCertificates||lm,value:new O({value:[new H,ze.schema(),Qe.schema({},!0)]})})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Qe.schema(e.crlExtensions||{names:{blockName:cm}})]})]})}const Lb=[Vp,ww,Ev,kv,yw,Cp,xp,Iv,Cv,vw];class rt extends _{get tbs(){return Be.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,hf,rt.defaultValues(hf))),this.version=d(e,ou,rt.defaultValues(ou)),this.signature=d(e,mf,rt.defaultValues(mf)),this.issuer=d(e,ff,rt.defaultValues(ff)),this.thisUpdate=d(e,pf,rt.defaultValues(pf)),Wc in e&&(this.nextUpdate=d(e,Wc,rt.defaultValues(Wc))),_c in e&&(this.revokedCertificates=d(e,_c,rt.defaultValues(_c))),Gc in e&&(this.crlExtensions=d(e,Gc,rt.defaultValues(Gc))),this.signatureAlgorithm=d(e,Ul,rt.defaultValues(Ul)),this.signatureValue=d(e,Ll,rt.defaultValues(Ll)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hf:return Ye;case ou:return 0;case mf:return new M;case ff:return new Ee;case pf:return new ze;case Wc:return new ze;case _c:return[];case Gc:return new Qe;case Ul:return new M;case Ll:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||"CertificateList",value:[Ub(e),M.schema(t.signatureAlgorithm||{names:{blockName:Ul}}),new ye({name:t.signatureValue||Ll})]})}fromSchema(e){G(e,Rb);const t=z(e,e,rt.schema());q.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,om in t.result&&(this.version=t.result[om].valueBlock.valueDec),this.signature=new M({schema:t.result[Up]}),this.issuer=new Ee({schema:t.result[Lp]}),this.thisUpdate=new ze({schema:t.result[um]}),Cc in t.result&&(this.nextUpdate=new ze({schema:t.result[Cc]})),lm in t.result&&(this.revokedCertificates=Array.from(t.result[lm],s=>new Ln({schema:s}))),cm in t.result&&(this.crlExtensions=new Qe({schema:t.result[cm]})),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==rt.defaultValues(ou)&&e.push(new H({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new O({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new O({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return rt.schema();const s=Xe(this.tbsView);q.assert(s,"TBS Certificate Revocation List"),t=s.result}return new O({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==rt.defaultValues(ou)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",s=fe(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),{parameters:n}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const o=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ye({valueHex:o})}async verify(e={},t=fe(!0)){let s;if(e.issuerCertificate&&(s=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(s=e.publicKeyInfo),!s)throw new Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(const a of this.crlExtensions.extensions)if(a.critical&&!Lb.includes(a.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}rt.CLASS_NAME="CertificateRevocationList";const Ii="crlId",Ci="crlValue",uu="parsedValue",jb=[Ii,Ci];class jn extends _{constructor(e={}){super(),this.crlId=d(e,Ii,jn.defaultValues(Ii)),this.crlValue=d(e,Ci,jn.defaultValues(Ci)),uu in e&&(this.parsedValue=d(e,uu,jn.defaultValues(uu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ii:return E;case Ci:return new le;case uu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ii:return t===E;case Ci:return t instanceof le;case uu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.id||"id"}),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.value||"value"})]})]})}fromSchema(e){G(e,jb);const t=z(e,e,jn.schema({names:{id:Ii,value:Ci}}));switch(q.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId){case zd:this.parsedValue=rt.fromBER(this.certValue.valueBlock.valueHex);break;default:throw new Error("Incorrect CRL_ID value in CRLBag: ".concat(this.crlId))}}toSchema(){return this.parsedValue&&(this.crlId=zd,this.crlValue=new X({valueHex:this.parsedValue.toSchema().toBER(!1)})),new O({value:[new ae({value:this.crlId}),new L({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}jn.CLASS_NAME="CRLBag";const Vi="version",xi="encryptedContentInfo",Mr="unprotectedAttrs",$b=[Vi,xi,Mr];class Ts extends _{constructor(e={}){super(),this.version=d(e,Vi,Ts.defaultValues(Vi)),this.encryptedContentInfo=d(e,xi,Ts.defaultValues(xi)),Mr in e&&(this.unprotectedAttrs=d(e,Mr,Ts.defaultValues(Mr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vi:return 0;case xi:return new We;case Mr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vi:return t===0;case xi:return We.compareWithDefault("contentType",t.contentType)&&We.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&We.compareWithDefault("encryptedContent",t.encryptedContent);case Mr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),We.schema(t.encryptedContentInfo||{}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new me({name:t.unprotectedAttrs||E,value:Oe.schema()})]})]})}fromSchema(e){G(e,$b);const t=z(e,e,Ts.schema({names:{version:Vi,encryptedContentInfo:{names:{blockName:xi}},unprotectedAttrs:Mr}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new We({schema:t.result.encryptedContentInfo}),Mr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new Oe({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}async encrypt(e,t=fe(!0)){Ne.assert(e,"parameters","object");const s=Cs(kt({},e),{contentType:"1.2.840.113549.1.7.1"});this.encryptedContentInfo=await t.encryptEncryptedContentInfo(s)}async decrypt(e,t=fe(!0)){Ne.assert(e,"parameters","object");const s=Cs(kt({},e),{encryptedContentInfo:this.encryptedContentInfo});return t.decryptEncryptedContentInfo(s)}}Ts.CLASS_NAME="EncryptedData";const ln="encryptionAlgorithm",Hr="encryptedData",lu="parsedValue",Kb=[ln,Hr];class ca extends _{constructor(e={}){super(),this.encryptionAlgorithm=d(e,ln,ca.defaultValues(ln)),this.encryptedData=d(e,Hr,ca.defaultValues(Hr)),lu in e&&(this.parsedValue=d(e,lu,ca.defaultValues(lu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ln:return new M;case Hr:return new X;case lu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ln:return M.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Hr:return t.isEqual(ca.defaultValues(e));case lu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.encryptionAlgorithm||{names:{blockName:ln}}),new je({value:[new X({name:t.encryptedData||Hr}),new X({idBlock:{isConstructed:!0},name:t.encryptedData||Hr})]})]})}fromSchema(e){G(e,Kb);const t=z(e,e,ca.schema({names:{encryptionAlgorithm:{names:{blockName:ln}},encryptedData:Hr}}));q.assertSchema(t,this.className),this.encryptionAlgorithm=new M({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new O({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=fe(!0)){const s=await new Ts({encryptedContentInfo:new We({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}).decrypt(e,t);this.parsedValue=us.fromBER(s)}async makeInternalValues(e,t=fe(!0)){if(!this.parsedValue)throw new Error('Please initialize "parsedValue" first');const s=new Ts,a=Cs(kt({},e),{contentToEncrypt:this.parsedValue.toSchema().toBER(!1)});if(await s.encrypt(a,t),!s.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=s.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=s.encryptedContentInfo.encryptedContent}}ca.CLASS_NAME="PKCS8ShroudedKeyBag";const Bi="secretTypeId",Oi="secretValue",Mb=[Bi,Oi];class Mo extends _{constructor(e={}){super(),this.secretTypeId=d(e,Bi,Mo.defaultValues(Bi)),this.secretValue=d(e,Oi,Mo.defaultValues(Oi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bi:return E;case Oi:return new le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bi:return t===E;case Oi:return t instanceof le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.id||"id"}),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.value||"value"})]})]})}fromSchema(e){G(e,Mb);const t=z(e,e,Mo.schema({names:{id:Bi,value:Oi}}));q.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new O({value:[new ae({value:this.secretTypeId}),new L({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}Mo.CLASS_NAME="SecretBag";class ua{static getItems(){return this.items||(this.items={},ua.register("1.2.840.113549.1.12.10.1.1",us),ua.register("1.2.840.113549.1.12.10.1.2",ca),ua.register("1.2.840.113549.1.12.10.1.3",Un),ua.register("1.2.840.113549.1.12.10.1.4",jn),ua.register("1.2.840.113549.1.12.10.1.5",Mo),ua.register("1.2.840.113549.1.12.10.1.6",nr)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}const cn="bagId",hn="bagValue",Ws="bagAttributes",Hb=[cn,hn,Ws];class va extends _{constructor(e={}){super(),this.bagId=d(e,cn,va.defaultValues(cn)),this.bagValue=d(e,hn,va.defaultValues(hn)),Ws in e&&(this.bagAttributes=d(e,Ws,va.defaultValues(Ws))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cn:return E;case hn:return new le;case Ws:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cn:return t===E;case hn:return t instanceof le;case Ws:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.bagId||cn}),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.bagValue||hn})]}),new nt({optional:!0,value:[new me({name:t.bagAttributes||Ws,value:Oe.schema()})]})]})}fromSchema(e){G(e,Hb);const t=z(e,e,va.schema({names:{bagId:cn,bagValue:hn,bagAttributes:Ws}}));q.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const s=ua.find(this.bagId);if(!s)throw new Error("Invalid BAG_ID for SafeBag: ".concat(this.bagId));this.bagValue=new s({schema:t.result.bagValue}),Ws in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new Oe({schema:a})))}toSchema(){const e=[new ae({value:this.bagId}),new L({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new nt({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}va.CLASS_NAME="SafeBag";const ni="safeBags";class nr extends _{constructor(e={}){super(),this.safeBags=d(e,ni,nr.defaultValues(ni)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ni:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ni:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.safeBags||E,value:va.schema()})]})}fromSchema(e){G(e,[ni]);const t=z(e,e,nr.schema({names:{safeBags:ni}}));q.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,s=>new va({schema:s}))}toSchema(){return new O({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}nr.CLASS_NAME="SafeContents";const jl="otherCertFormat",$l="otherCert",Fb=[jl,$l];class Na extends _{constructor(e={}){super(),this.otherCertFormat=d(e,jl,Na.defaultValues(jl)),this.otherCert=d(e,$l,Na.defaultValues($l)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case jl:return E;case $l:return new le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.otherCertFormat||jl}),new le({name:t.otherCert||$l})]})}fromSchema(e){G(e,Fb);const t=z(e,e,Na.schema());q.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new O({value:[new ae({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof le||(e.otherCert=this.otherCert.toJSON()),e}}const Kl="certificates",Jb=[Kl];class Rs extends _{constructor(e={}){super(),this.certificates=d(e,Kl,Rs.defaultValues(Kl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Kl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new nt({name:t.blockName||E,value:[new me({name:t.certificates||Kl,value:new je({value:[be.schema(),new L({idBlock:{tagClass:3,tagNumber:0},value:[new le]}),new L({idBlock:{tagClass:3,tagNumber:1},value:[new O]}),new L({idBlock:{tagClass:3,tagNumber:2},value:ts.schema().valueBlock.value}),new L({idBlock:{tagClass:3,tagNumber:3},value:Na.schema().valueBlock.value})]})})]})}fromSchema(e){G(e,Jb);const t=z(e,e,Rs.schema());q.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],s=>{const a=s.idBlock.tagNumber;if(s.idBlock.tagClass===1)return new be({schema:s});const n=new O({value:s.valueBlock.value});switch(a){case 1:return n.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec===1?new ts({schema:n}):new rr({schema:n});case 2:return new ts({schema:n});case 3:return new Na({schema:n})}return s})}toSchema(){return new nt({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof be:return e.toSchema();case e instanceof rr:return new L({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof ts:return new L({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof Na:return new L({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}Rs.CLASS_NAME="CertificateSet";const Ml="otherRevInfoFormat",Hl="otherRevInfo",qb=[Ml,Hl];class ur extends _{constructor(e={}){super(),this.otherRevInfoFormat=d(e,Ml,ur.defaultValues(Ml)),this.otherRevInfo=d(e,Hl,ur.defaultValues(Hl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ml:return E;case Hl:return new le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.otherRevInfoFormat||Ml}),new le({name:t.otherRevInfo||Hl})]})}fromSchema(e){G(e,qb);const t=z(e,e,ur.schema());q.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new O({value:[new ae({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof le||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}ur.CLASS_NAME="OtherRevocationInfoFormat";const Fl="crls",df="otherRevocationInfos",Wb=[Fl];class lr extends _{constructor(e={}){super(),this.crls=d(e,Fl,lr.defaultValues(Fl)),this.otherRevocationInfos=d(e,df,lr.defaultValues(df)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fl:return[];case df:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new nt({name:t.blockName||E,value:[new me({name:t.crls||E,value:new je({value:[rt.schema(),new L({idBlock:{tagClass:3,tagNumber:1},value:[new ae,new le]})]})})]})}fromSchema(e){G(e,Wb);const t=z(e,e,lr.schema({names:{crls:Fl}}));if(q.assertSchema(t,this.className),t.result.crls)for(const s of t.result.crls)s.idBlock.tagClass===1?this.crls.push(new rt({schema:s})):this.otherRevocationInfos.push(new ur({schema:s}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const s=t.toSchema();return s.idBlock.tagClass=3,s.idBlock.tagNumber=1,s})),new nt({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}lr.CLASS_NAME="RevocationInfoChoices";const Jl="certs",mn="crls",_b=[Jl,mn];class zn extends _{constructor(e={}){super(),this.crls=d(e,mn,zn.defaultValues(mn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jl:return new Rs;case mn:return new lr;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Jl:return t.certificates.length===0;case mn:return t.crls.length===0&&t.otherRevocationInfos.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({name:t.certs||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Rs.schema().valueBlock.value}),new L({name:t.crls||E,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:lr.schema().valueBlock.value})]})}fromSchema(e){G(e,_b);const t=z(e,e,zn.schema({names:{certs:Jl,crls:mn}}));q.assertSchema(t,this.className),Jl in t.result&&(this.certs=new Rs({schema:new nt({value:t.result.certs.valueBlock.value})})),mn in t.result&&(this.crls=new lr({schema:new nt({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new O({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}zn.CLASS_NAME="OriginatorInfo";const ql="issuer",Wl="serialNumber",Gb=[ql,Wl];class Ze extends _{constructor(e={}){super(),this.issuer=d(e,ql,Ze.defaultValues(ql)),this.serialNumber=d(e,Wl,Ze.defaultValues(Wl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ql:return new Ee;case Wl:return new H;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Ee.schema(t.issuer||{}),new H({name:t.serialNumber||E})]})}fromSchema(e){G(e,Gb);const t=z(e,e,Ze.schema({names:{issuer:{names:{blockName:ql}},serialNumber:Wl}}));q.assertSchema(t,this.className),this.issuer=new Ee({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new O({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}Ze.CLASS_NAME="IssuerAndSerialNumber";const zc="variant",cu="value",zb=["blockName"];class Ho extends _{constructor(e={}){super(),this.variant=d(e,zc,Ho.defaultValues(zc)),cu in e&&(this.value=d(e,cu,Ho.defaultValues(cu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zc:return-1;case cu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zc:return t===-1;case cu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new je({value:[Ze.schema({names:{blockName:t.blockName||E}}),new ue({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){G(e,zb);const t=z(e,e,Ho.schema({names:{blockName:"blockName"}}));q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ze({schema:t.result.blockName})):(this.variant=2,this.value=new X({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof Ze))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof X))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new ue({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new le}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&this.value&&(e.value=this.value.toJSON()),e}}Ho.CLASS_NAME="RecipientIdentifier";const fn="version",Pi="rid",Di="keyEncryptionAlgorithm",Ti="encryptedKey",Xc="recipientCertificate",Xb=[fn,Pi,Di,Ti];class Xt extends _{constructor(e={}){super(),this.version=d(e,fn,Xt.defaultValues(fn)),this.rid=d(e,Pi,Xt.defaultValues(Pi)),this.keyEncryptionAlgorithm=d(e,Di,Xt.defaultValues(Di)),this.encryptedKey=d(e,Ti,Xt.defaultValues(Ti)),this.recipientCertificate=d(e,Xc,Xt.defaultValues(Xc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fn:return-1;case Pi:return{};case Di:return new M;case Ti:return new X;case Xc:return new be;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fn:return t===Xt.defaultValues(fn);case Pi:return Object.keys(t).length===0;case Di:case Ti:return t.isEqual(Xt.defaultValues(e));case Xc:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),Ho.schema(t.rid||{}),M.schema(t.keyEncryptionAlgorithm||{}),new X({name:t.encryptedKey||E})]})}fromSchema(e){G(e,Xb);const t=z(e,e,Xt.schema({names:{version:fn,rid:{names:{blockName:Pi}},keyEncryptionAlgorithm:{names:{blockName:Di}},encryptedKey:Ti}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,t.result.rid.idBlock.tagClass===3?this.rid=new X({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new Ze({schema:t.result.rid}),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof Ze?(this.version=0,e.push(new H({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new H({value:this.version})),e.push(new ue({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new O({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Xt.CLASS_NAME="KeyTransRecipientInfo";const Ri="algorithm",Ui="publicKey",Yb=[Ri,Ui];class ir extends _{constructor(e={}){super(),this.algorithm=d(e,Ri,ir.defaultValues(Ri)),this.publicKey=d(e,Ui,ir.defaultValues(Ui)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ri:return new M;case Ui:return new ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ri:case Ui:return t.isEqual(ir.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.algorithm||{}),new ye({name:t.publicKey||E})]})}fromSchema(e){G(e,Yb);const t=z(e,e,ir.schema({names:{algorithm:{names:{blockName:Ri}},publicKey:Ui}}));q.assertSchema(t,this.className),this.algorithm=new M({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new O({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}ir.CLASS_NAME="OriginatorPublicKey";const Yc="variant",hu="value",Qb=["blockName"];class cr extends _{constructor(e={}){super(),this.variant=d(e,Yc,cr.defaultValues(Yc)),hu in e&&(this.value=d(e,hu,cr.defaultValues(hu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yc:return-1;case hu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yc:return t===-1;case hu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new je({value:[Ze.schema({names:{blockName:t.blockName||E}}),new ue({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||E}),new L({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||E,value:ir.schema().valueBlock.value})]})}fromSchema(e){G(e,Qb);const t=z(e,e,cr.schema({names:{blockName:"blockName"}}));q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ze({schema:t.result.blockName})):t.result.blockName.idBlock.tagNumber===0?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new ir({schema:new O({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new le}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2||this.variant===3)&&(e.value=this.value.toJSON()),e}}cr.CLASS_NAME="OriginatorIdentifierOrKey";const Li="keyAttrId",xs="keyAttr",Zb=[Li,xs];class Es extends _{constructor(e={}){super(),this.keyAttrId=d(e,Li,Es.defaultValues(Li)),xs in e&&(this.keyAttr=d(e,xs,Es.defaultValues(xs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Li:return E;case xs:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Li:return typeof t=="string"&&t===E;case xs:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({optional:t.optional||!0,name:t.blockName||E,value:[new ae({name:t.keyAttrId||E}),new le({optional:!0,name:t.keyAttr||E})]})}fromSchema(e){G(e,Zb);const t=z(e,e,Es.schema({names:{keyAttrId:Li,keyAttr:xs}}));q.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),xs in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new ae({value:this.keyAttrId})),xs in this&&e.push(this.keyAttr),new O({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return xs in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}Es.CLASS_NAME="OtherKeyAttribute";const pn="subjectKeyIdentifier",Fr="date",Jr="other",eS=[pn,Fr,Jr];class Ps extends _{constructor(e={}){super(),this.subjectKeyIdentifier=d(e,pn,Ps.defaultValues(pn)),Fr in e&&(this.date=d(e,Fr,Ps.defaultValues(Fr))),Jr in e&&(this.other=d(e,Jr,Ps.defaultValues(Jr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pn:return new X;case Fr:return new $e;case Jr:return new Es;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case pn:return t.isEqual(Ps.defaultValues(pn));case Fr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Jr:return t.keyAttrId===E&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new X({name:t.subjectKeyIdentifier||E}),new $e({optional:!0,name:t.date||E}),Es.schema(t.other||{})]})}fromSchema(e){G(e,eS);const t=z(e,e,Ps.schema({names:{subjectKeyIdentifier:pn,date:Fr,other:{names:{blockName:Jr}}}}));q.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,Fr in t.result&&(this.date=t.result.date),Jr in t.result&&(this.other=new Es({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new O({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}Ps.CLASS_NAME="RecipientKeyIdentifier";const Qc="variant",Zc="value",tS=["blockName"];class Us extends _{constructor(e={}){super(),this.variant=d(e,Qc,Us.defaultValues(Qc)),this.value=d(e,Zc,Us.defaultValues(Zc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qc:return-1;case Zc:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qc:return t===-1;case Zc:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new je({value:[Ze.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||E}}),new L({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:0},value:Ps.schema(t.rKeyId||{names:{blockName:t.blockName||E}}).valueBlock.value})]})}fromSchema(e){G(e,tS);const t=z(e,e,Us.schema({names:{blockName:"blockName"}}));q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ze({schema:t.result.blockName})):(this.variant=2,this.value=new Ps({schema:new O({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new L({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new le}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&(e.value=this.value.toJSON()),e}}Us.CLASS_NAME="KeyAgreeRecipientIdentifier";const ji="rid",dn="encryptedKey",sS=[ji,dn];class or extends _{constructor(e={}){super(),this.rid=d(e,ji,or.defaultValues(ji)),this.encryptedKey=d(e,dn,or.defaultValues(dn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ji:return new Us;case dn:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ji:return t.variant===-1&&!("value"in t);case dn:return t.isEqual(or.defaultValues(dn));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Us.schema(t.rid||{}),new X({name:t.encryptedKey||E})]})}fromSchema(e){G(e,sS);const t=z(e,e,or.schema({names:{rid:{names:{blockName:ji}},encryptedKey:dn}}));q.assertSchema(t,this.className),this.rid=new Us({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new O({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}or.CLASS_NAME="RecipientEncryptedKey";const eh="encryptedKeys",Tw="RecipientEncryptedKeys",rS=[Tw];class Ea extends _{constructor(e={}){super(),this.encryptedKeys=d(e,eh,Ea.defaultValues(eh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eh:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case eh:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.RecipientEncryptedKeys||E,value:or.schema()})]})}fromSchema(e){G(e,rS);const t=z(e,e,Ea.schema({names:{RecipientEncryptedKeys:Tw}}));q.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,s=>new or({schema:s}))}toSchema(){return new O({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}Ea.CLASS_NAME="RecipientEncryptedKeys";const $i="version",Ki="originator",_s="ukm",Mi="keyEncryptionAlgorithm",Hi="recipientEncryptedKeys",th="recipientCertificate",sh="recipientPublicKey",aS=[$i,Ki,_s,Mi,Hi];class Wt extends _{constructor(e={}){super(),this.version=d(e,$i,Wt.defaultValues($i)),this.originator=d(e,Ki,Wt.defaultValues(Ki)),_s in e&&(this.ukm=d(e,_s,Wt.defaultValues(_s))),this.keyEncryptionAlgorithm=d(e,Mi,Wt.defaultValues(Mi)),this.recipientEncryptedKeys=d(e,Hi,Wt.defaultValues(Hi)),this.recipientCertificate=d(e,th,Wt.defaultValues(th)),this.recipientPublicKey=d(e,sh,Wt.defaultValues(sh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $i:return 0;case Ki:return new cr;case _s:return new X;case Mi:return new M;case Hi:return new Ea;case th:return new be;case sh:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $i:return t===0;case Ki:return t.variant===-1&&!("value"in t);case _s:return t.isEqual(Wt.defaultValues(_s));case Mi:return t.algorithmId===E&&!("algorithmParams"in t);case Hi:return t.encryptedKeys.length===0;case th:return!1;case sh:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new L({idBlock:{tagClass:3,tagNumber:0},value:[cr.schema(t.originator||{})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new X({name:t.ukm||E})]}),M.schema(t.keyEncryptionAlgorithm||{}),Ea.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){G(e,aS);const t=z(e,e,Wt.schema({names:{version:$i,originator:{names:{blockName:Ki}},ukm:_s,keyEncryptionAlgorithm:{names:{blockName:Mi}},recipientEncryptedKeys:{names:{blockName:Hi}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new cr({schema:t.result.originator}),_s in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new Ea({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new O({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}Wt.CLASS_NAME="KeyAgreeRecipientInfo";const gn="keyIdentifier",qr="date",Wr="other",nS=[gn,qr,Wr];class Ss extends _{constructor(e={}){super(),this.keyIdentifier=d(e,gn,Ss.defaultValues(gn)),qr in e&&(this.date=d(e,qr,Ss.defaultValues(qr))),Wr in e&&(this.other=d(e,Wr,Ss.defaultValues(Wr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gn:return new X;case qr:return new $e;case Wr:return new Es;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case gn:return t.isEqual(Ss.defaultValues(gn));case qr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Wr:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new X({name:t.keyIdentifier||E}),new $e({optional:!0,name:t.date||E}),Es.schema(t.other||{})]})}fromSchema(e){G(e,nS);const t=z(e,e,Ss.schema({names:{keyIdentifier:gn,date:qr,other:{names:{blockName:Wr}}}}));q.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,qr in t.result&&(this.date=t.result.date),Wr in t.result&&(this.other=new Es({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new O({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}Ss.CLASS_NAME="KEKIdentifier";const Fi="version",Ji="kekid",qi="keyEncryptionAlgorithm",wn="encryptedKey",rh="preDefinedKEK",iS=[Fi,Ji,qi,wn];class Yt extends _{constructor(e={}){super(),this.version=d(e,Fi,Yt.defaultValues(Fi)),this.kekid=d(e,Ji,Yt.defaultValues(Ji)),this.keyEncryptionAlgorithm=d(e,qi,Yt.defaultValues(qi)),this.encryptedKey=d(e,wn,Yt.defaultValues(wn)),this.preDefinedKEK=d(e,rh,Yt.defaultValues(rh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fi:return 0;case Ji:return new Ss;case qi:return new M;case wn:return new X;case rh:return Ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===Yt.defaultValues(Fi);case Ji:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case qi:return t.algorithmId===E&&!("algorithmParams"in t);case wn:return t.isEqual(Yt.defaultValues(wn));case rh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),Ss.schema(t.kekid||{}),M.schema(t.keyEncryptionAlgorithm||{}),new X({name:t.encryptedKey||E})]})}fromSchema(e){G(e,iS);const t=z(e,e,Yt.schema({names:{version:Fi,kekid:{names:{blockName:Ji}},keyEncryptionAlgorithm:{names:{blockName:qi}},encryptedKey:wn}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new Ss({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new O({value:[new H({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Yt.CLASS_NAME="KEKRecipientInfo";const Wi="version",_r="keyDerivationAlgorithm",_i="keyEncryptionAlgorithm",yn="encryptedKey",ah="password",oS=[Wi,_r,_i,yn];class os extends _{constructor(e={}){super(),this.version=d(e,Wi,os.defaultValues(Wi)),_r in e&&(this.keyDerivationAlgorithm=d(e,_r,os.defaultValues(_r))),this.keyEncryptionAlgorithm=d(e,_i,os.defaultValues(_i)),this.encryptedKey=d(e,yn,os.defaultValues(yn)),this.password=d(e,ah,os.defaultValues(ah)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wi:return-1;case _r:return new M;case _i:return new M;case yn:return new X;case ah:return Ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wi:return t===-1;case _r:case _i:return t.algorithmId===E&&!("algorithmParams"in t);case yn:return t.isEqual(os.defaultValues(yn));case ah:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new L({name:t.keyDerivationAlgorithm||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:M.schema().valueBlock.value}),M.schema(t.keyEncryptionAlgorithm||{}),new X({name:t.encryptedKey||E})]})}fromSchema(e){G(e,oS);const t=z(e,e,os.schema({names:{version:Wi,keyDerivationAlgorithm:_r,keyEncryptionAlgorithm:{names:{blockName:_i}},encryptedKey:yn}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,_r in t.result&&(this.keyDerivationAlgorithm=new M({schema:new O({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new M({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new H({value:this.version})),this.keyDerivationAlgorithm&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new O({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}os.CLASS_NAME="PasswordRecipientInfo";const Gi="oriType",vn="oriValue",uS=[Gi,vn];class ba extends _{constructor(e={}){super(),this.oriType=d(e,Gi,ba.defaultValues(Gi)),this.oriValue=d(e,vn,ba.defaultValues(vn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gi:return E;case vn:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Gi:return t===E;case vn:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.oriType||E}),new le({name:t.oriValue||E})]})}fromSchema(e){G(e,uS);const t=z(e,e,ba.schema({names:{oriType:Gi,oriValue:vn}}));q.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new O({value:[new ae({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return ba.compareWithDefault(vn,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}ba.CLASS_NAME="OtherRecipientInfo";const nh="variant",mu="value",lS=["blockName"];class ls extends _{constructor(e={}){super(),this.variant=d(e,nh,ls.defaultValues(nh)),mu in e&&(this.value=d(e,mu,ls.defaultValues(mu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nh:return-1;case mu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nh:return t===ls.defaultValues(e);case mu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new je({value:[Xt.schema({names:{blockName:t.blockName||E}}),new L({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:1},value:Wt.schema().valueBlock.value}),new L({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:2},value:Yt.schema().valueBlock.value}),new L({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:3},value:os.schema().valueBlock.value}),new L({name:t.blockName||E,idBlock:{tagClass:3,tagNumber:4},value:ba.schema().valueBlock.value})]})}fromSchema(e){G(e,lS);const t=z(e,e,ls.schema({names:{blockName:"blockName"}}));if(q.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1)this.variant=1,this.value=new Xt({schema:t.result.blockName});else{const s=new O({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new Wt({schema:s});break;case 2:this.variant=3,this.value=new Yt({schema:s});break;case 3:this.variant=4,this.value=new os({schema:s});break;case 4:this.variant=5,this.value=new ba({schema:s});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){ve.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new le}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}ls.CLASS_NAME="RecipientInfo";const Gr="hashAlgorithm",zr="maskGenAlgorithm",Xr="pSourceAlgorithm",cS=[Gr,zr,Xr];class Ut extends _{constructor(e={}){super(),this.hashAlgorithm=d(e,Gr,Ut.defaultValues(Gr)),this.maskGenAlgorithm=d(e,zr,Ut.defaultValues(zr)),this.pSourceAlgorithm=d(e,Xr,Ut.defaultValues(Xr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gr:return new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new at});case zr:return new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new M({algorithmId:"1.3.14.3.2.26",algorithmParams:new at}).toSchema()});case Xr:return new M({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new X({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new L({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[M.schema(t.hashAlgorithm||{})]}),new L({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[M.schema(t.maskGenAlgorithm||{})]}),new L({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[M.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){G(e,cS);const t=z(e,e,Ut.schema({names:{hashAlgorithm:{names:{blockName:Gr}},maskGenAlgorithm:{names:{blockName:zr}},pSourceAlgorithm:{names:{blockName:Xr}}}}));q.assertSchema(t,this.className),Gr in t.result&&(this.hashAlgorithm=new M({schema:t.result.hashAlgorithm})),zr in t.result&&(this.maskGenAlgorithm=new M({schema:t.result.maskGenAlgorithm})),Xr in t.result&&(this.pSourceAlgorithm=new M({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Ut.defaultValues(Gr))||e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Ut.defaultValues(zr))||e.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(Ut.defaultValues(Xr))||e.push(new L({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new O({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Ut.defaultValues(Gr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Ut.defaultValues(zr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(Ut.defaultValues(Xr))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}Ut.CLASS_NAME="RSAESOAEPParams";const zi="keyInfo",Yr="entityUInfo",Xi="suppPubInfo",hS=[zi,Yr,Xi];class er extends _{constructor(e={}){super(),this.keyInfo=d(e,zi,er.defaultValues(zi)),Yr in e&&(this.entityUInfo=d(e,Yr,er.defaultValues(Yr))),this.suppPubInfo=d(e,Xi,er.defaultValues(Xi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zi:return new M;case Yr:return new X;case Xi:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zi:case Yr:case Xi:return t.isEqual(er.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.keyInfo||{}),new L({name:t.entityUInfo||E,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new X]}),new L({name:t.suppPubInfo||E,idBlock:{tagClass:3,tagNumber:2},value:[new X]})]})}fromSchema(e){G(e,hS);const t=z(e,e,er.schema({names:{keyInfo:{names:{blockName:zi}},entityUInfo:Yr,suppPubInfo:Xi}}));q.assertSchema(t,this.className),this.keyInfo=new M({schema:t.result.keyInfo}),Yr in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new L({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new O({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}er.CLASS_NAME="ECCCMSSharedInfo";const Yi="version",Qr="originatorInfo",Qi="recipientInfos",Zi="encryptedContentInfo",Zr="unprotectedAttrs",mS=[Yi,Qr,Qi,Zi,Zr],fg={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},fS={"P-256":256,"P-384":384,"P-521":528};class vs extends _{constructor(e={}){super(),this.version=d(e,Yi,vs.defaultValues(Yi)),Qr in e&&(this.originatorInfo=d(e,Qr,vs.defaultValues(Qr))),this.recipientInfos=d(e,Qi,vs.defaultValues(Qi)),this.encryptedContentInfo=d(e,Zi,vs.defaultValues(Zi)),Zr in e&&(this.unprotectedAttrs=d(e,Zr,vs.defaultValues(Zr))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yi:return 0;case Qr:return new zn;case Qi:return[];case Zi:return new We;case Zr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yi:return t===vs.defaultValues(e);case Qr:return t.certs.certificates.length===0&&t.crls.crls.length===0;case Qi:case Zr:return t.length===0;case Zi:return We.compareWithDefault("contentType",t.contentType)&&We.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&We.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||E}),new L({name:t.originatorInfo||E,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:zn.schema().valueBlock.value}),new nt({value:[new me({name:t.recipientInfos||E,value:ls.schema()})]}),We.schema(t.encryptedContentInfo||{}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new me({name:t.unprotectedAttrs||E,value:Oe.schema()})]})]})}fromSchema(e){G(e,mS);const t=z(e,e,vs.schema({names:{version:Yi,originatorInfo:Qr,recipientInfos:Qi,encryptedContentInfo:{names:{blockName:Zi}},unprotectedAttrs:Zr}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Qr in t.result&&(this.originatorInfo=new zn({schema:new O({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,s=>new ls({schema:s})),this.encryptedContentInfo=new We({schema:t.result.encryptedContentInfo}),Zr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new Oe({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),this.originatorInfo&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new nt({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,s,a=fe(!0)){const n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},fg,t||{});if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549")!==-1)s=1;else if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045")!==-1)s=2;else throw new Error("Unknown type of certificate's public key: ".concat(e.subjectPublicKeyInfo.algorithm.algorithmId));switch(s){case 1:{let o,u;if(n.useOAEP===!0){o=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const c=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),i=new M({algorithmId:c,algorithmParams:new at});u=new Ut({hashAlgorithm:i,maskGenAlgorithm:new M({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:i.toSchema()})}).toSchema()}else{if(o=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),o===E)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");u=new at}const h=new Xt({version:0,rid:new Ze({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new M({algorithmId:o,algorithmParams:u}),recipientCertificate:e});this.recipientInfos.push(new ls({variant:1,value:h}))}break;case 2:{const o=new Us({variant:1,value:new Ze({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(o,n,{recipientCertificate:e},a)}break;default:throw new Error('Unknown "variant" value: '.concat(s))}return!0}addRecipientByPreDefinedData(e,t={},s,a=fe(!0)){if(Ne.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const n=new ArrayBuffer(16),o=new Uint8Array(n);a.getRandomValues(o),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),t.iterationCount===void 0&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new at),s){case 1:{const n=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),o=new Yt({version:4,kekid:new Ss({keyIdentifier:new X({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new M({algorithmId:n,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new ls({variant:3,value:o}))}break;case 2:{const n=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),o=new ArrayBuffer(64),u=new Uint8Array(o);a.getRandomValues(u);const h=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),c=new Ot({salt:new X({valueHex:o}),iterationCount:t.iterationCount,prf:new M({algorithmId:h,algorithmParams:new at})}),i=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),f=new os({version:0,keyDerivationAlgorithm:new M({algorithmId:n,algorithmParams:c.toSchema()}),keyEncryptionAlgorithm:new M({algorithmId:i,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new ls({variant:4,value:f}))}break;default:throw new Error('Unknown value for "variant": '.concat(s))}}addRecipientByKeyIdentifier(e,t,s,a=fe(!0)){const n=Object.assign({},fg,s||{}),o=new Us({variant:2,value:new Ps({subjectKeyIdentifier:new X({valueHex:t})})});this._addKeyAgreeRecipientInfo(o,n,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,s,a=fe(!0)){const n=new or({rid:e}),o=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),u=new M({algorithmId:o}),h=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),c=new ArrayBuffer(64),i=new Uint8Array(c);a.getRandomValues(i);const f={version:3,ukm:new X({valueHex:c}),keyEncryptionAlgorithm:new M({algorithmId:h,algorithmParams:u.toSchema()}),recipientEncryptedKeys:new Ea({encryptedKeys:[n]})},m=new Wt(Object.assign(f,s));this.recipientInfos.push(new ls({variant:2,value:m}))}async encrypt(e,t,s=fe(!0)){const a=new ArrayBuffer(16),n=new Uint8Array(a);s.getRandomValues(n);const o=new Uint8Array(t),u=s.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),h=await s.generateKey(e,!0,["encrypt"]),c=await s.encrypt({name:e.name,iv:n},h,o),i=await s.exportKey("raw",h);this.version=2,this.encryptedContentInfo=new We({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new M({algorithmId:u,algorithmParams:new X({valueHex:a})}),encryptedContent:new X({valueHex:c})});const f=async y=>{const k=this.recipientInfos[y].value;let p,S;if(k.recipientPublicKey)p=k.recipientPublicKey.algorithm.namedCurve,S=k.recipientPublicKey;else if(k.recipientCertificate){const ie=k.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(ie.constructor.blockName()!==ae.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(y));switch(ie.valueBlock.toString()){case"1.2.840.10045.3.1.7":p="P-256";break;case"1.3.132.0.34":p="P-384";break;case"1.3.132.0.35":p="P-521";break;default:throw new Error("Incorrect curve OID for index ".concat(y))}S=await k.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:p},usages:[]}},s)}else throw new Error("Unsupported RecipientInfo");const I=fS[p],P=await s.generateKey({name:"ECDH",namedCurve:p},!0,["deriveBits"]),x=await s.exportKey("spki",P.publicKey),T=await s.deriveBits({name:"ECDH",public:S},P.privateKey,I),B=new M({schema:k.keyEncryptionAlgorithm.algorithmParams}),V=s.getAlgorithmByOID(B.algorithmId,!0,"aesKWAlgorithm");let J=V.length;const F=new ArrayBuffer(4),D=new Uint8Array(F);for(let ie=3;ie>=0;ie--)D[ie]=J,J>>=8;const j=new er({keyInfo:new M({algorithmId:B.algorithmId}),entityUInfo:k.ukm,suppPubInfo:new X({valueHex:F})}).toSchema().toBER(!1),te=s.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),Y=await eg(te.kdf,T,V.length,j,s),oe=await s.importKey("raw",Y,{name:"AES-KW"},!0,["wrapKey"]),ne=await s.wrapKey("raw",h,oe,{name:"AES-KW"}),de=new cr;return de.variant=3,de.value=ir.fromBER(x),k.originator=de,k.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new X({valueHex:ne}),{ecdhPrivateKey:P.privateKey}},m=async y=>{const k=this.recipientInfos[y].value,p=s.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(p.name==="RSA-OAEP"){const S=k.keyEncryptionAlgorithm.algorithmParams,I=new Ut({schema:S});if(p.hash=s.getAlgorithmByOID(I.hashAlgorithm.algorithmId),!("name"in p.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(I.hashAlgorithm.algorithmId))}try{const S=await k.recipientCertificate.getPublicKey({algorithm:{algorithm:p,usages:["encrypt","wrapKey"]}},s),I=await s.encrypt(S.algorithm,S,i);k.encryptedKey=new X({valueHex:I})}catch(S){}},b=async y=>{const k=this.recipientInfos[y].value,p=s.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),S=await s.importKey("raw",new Uint8Array(k.preDefinedKEK),p,!0,["wrapKey"]),I=await s.wrapKey("raw",h,S,p);k.encryptedKey=new X({valueHex:I})},v=async y=>{const k=this.recipientInfos[y].value;let p;if(!k.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!k.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{p=new Ot({schema:k.keyDerivationAlgorithm.algorithmParams})}catch(F){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const S=new Uint8Array(k.password),I=await s.importKey("raw",S,"PBKDF2",!1,["deriveKey"]),P=s.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let x="SHA-1";p.prf&&(x=s.getAlgorithmByOID(p.prf.algorithmId,!0,"prfAlgorithm").hash.name);const T=new Uint8Array(p.salt.valueBlock.valueHex),B=p.iterationCount,V=await s.deriveKey({name:"PBKDF2",hash:{name:x},salt:T,iterations:B},I,P,!0,["wrapKey"]),J=await s.wrapKey("raw",h,V,P);k.encryptedKey=new X({valueHex:J})},w=[];for(let y=0;y<this.recipientInfos.length;y++)switch(this.recipientInfos[y].variant){case 1:w.push(await m(y));break;case 2:w.push(await f(y));break;case 3:w.push(await b(y));break;case 4:w.push(await v(y));break;default:throw new Error("Unknown recipient type in array with index ".concat(y))}return w}async decrypt(e,t,s=fe(!0)){const a=t||{};if(e+1>this.recipientInfos.length)throw new Error('Maximum value for "index" is: '.concat(this.recipientInfos.length-1));const n=async w=>{const y=this.recipientInfos[w].value;let k,p,S;const I=y.originator;if(a.recipientCertificate){const Y=a.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(Y.constructor.blockName()!==ae.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(w));k=Y.valueBlock.toString()}else if(I.value.algorithm.algorithmParams){const Y=I.value.algorithm.algorithmParams;if(Y.constructor.blockName()!==ae.blockName())throw new Error("Incorrect originator for index ".concat(w));k=Y.valueBlock.toString()}else throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(k){case"1.2.840.10045.3.1.7":p="P-256",S=256;break;case"1.3.132.0.34":p="P-384",S=384;break;case"1.3.132.0.35":p="P-521",S=528;break;default:throw new Error("Incorrect curve OID for index ".concat(w))}let P,x=s;Be.isBufferSource(a.recipientPrivateKey)?P=await s.importKey("pkcs8",a.recipientPrivateKey,{name:"ECDH",namedCurve:p},!0,["deriveBits"]):(P=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(x=a.crypto.subtle)),"algorithmParams"in I.value.algorithm||(I.value.algorithm.algorithmParams=new ae({value:k}));const T=I.value.toSchema().toBER(!1),B=await s.importKey("spki",T,{name:"ECDH",namedCurve:p},!0,[]),V=await x.deriveBits({name:"ECDH",public:B},P,S);async function J(Y){Y=Y||!1;const oe=new M({schema:y.keyEncryptionAlgorithm.algorithmParams}),ne=s.getAlgorithmByOID(oe.algorithmId,!0,"kwAlgorithm");let de=ne.length;const ie=new ArrayBuffer(4),re=new Uint8Array(ie);for(let pe=3;pe>=0;pe--)re[pe]=de,de>>=8;const se={algorithmId:oe.algorithmId};Y&&(se.algorithmParams=new at);const ee=new er({keyInfo:new M(se),entityUInfo:y.ukm,suppPubInfo:new X({valueHex:ie})}).toSchema().toBER(!1),ce=s.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!ce.name)throw new Error("Incorrect OID for key encryption algorithm: ".concat(y.keyEncryptionAlgorithm.algorithmId));return eg(ce.kdf,V,ne.length,ee,s)}const F=await J(),D=async Y=>s.importKey("raw",Y,{name:"AES-KW"},!0,["unwrapKey"]),j=await D(F),te=async Y=>{const oe=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,ne=s.getAlgorithmByOID(oe,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",y.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,Y,{name:"AES-KW"},ne,!0,["decrypt"])};try{return await te(j)}catch(Y){const oe=await J(!0),ne=await D(oe);return te(ne)}},o=async w=>{const y=this.recipientInfos[w].value;if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const k=s.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(k.name==="RSA-OAEP"){const T=y.keyEncryptionAlgorithm.algorithmParams,B=new Ut({schema:T});if(k.hash=s.getAlgorithmByOID(B.hashAlgorithm.algorithmId),!("name"in k.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(B.hashAlgorithm.algorithmId))}let p,S=s;Be.isBufferSource(a.recipientPrivateKey)?p=await s.importKey("pkcs8",a.recipientPrivateKey,k,!0,["decrypt"]):(p=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(S=a.crypto.subtle));const I=await S.decrypt(p.algorithm,p,y.encryptedKey.valueBlock.valueHexView),P=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,x=s.getAlgorithmByOID(P,!0,"contentEncryptionAlgorithm");if(!("name"in x))throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(P));return s.importKey("raw",I,x,!0,["decrypt"])},u=async w=>{const y=this.recipientInfos[w].value;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const k=s.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),p=await s.importKey("raw",a.preDefinedData,k,!0,["unwrapKey"]),S=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,I=s.getAlgorithmByOID(S,!0,"contentEncryptionAlgorithm");if(!I.name)throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(S));return s.unwrapKey("raw",y.encryptedKey.valueBlock.valueHexView,p,k,I,!0,["decrypt"])},h=async w=>{const y=this.recipientInfos[w].value;let k;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!y.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!y.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{k=new Ot({schema:y.keyDerivationAlgorithm.algorithmParams})}catch(J){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const p=await s.importKey("raw",a.preDefinedData,"PBKDF2",!1,["deriveKey"]),S=s.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),I=k.prf?s.getAlgorithmByOID(k.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",P=new Uint8Array(k.salt.valueBlock.valueHex),x=k.iterationCount,T=await s.deriveKey({name:"PBKDF2",hash:{name:I},salt:P,iterations:x},p,S,!0,["unwrapKey"]),B=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,V=s.getAlgorithmByOID(B,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",y.encryptedKey.valueBlock.valueHexView,T,S,V,!0,["decrypt"])};let c;switch(this.recipientInfos[e].variant){case 1:c=await o(e);break;case 2:c=await n(e);break;case 3:c=await u(e);break;case 4:c=await h(e);break;default:throw new Error("Unknown recipient type in array with index ".concat(e))}const i=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,f=s.getAlgorithmByOID(i,!0,"contentEncryptionAlgorithm"),m=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,b=new Uint8Array(m);if(!this.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const v=this.encryptedContentInfo.getEncryptedContent();return s.decrypt({name:f.name,iv:b},c,v)}}vs.CLASS_NAME="EnvelopedData";const ii="safeContents",fu="parsedValue",pg="contentInfos";class Xn extends _{constructor(e={}){super(),this.safeContents=d(e,ii,Xn.defaultValues(ii)),fu in e&&(this.parsedValue=d(e,fu,Xn.defaultValues(fu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ii:return[];case fu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ii:return t.length===0;case fu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new me({name:t.contentInfos||E,value:Ie.schema()})]})}fromSchema(e){G(e,[pg]);const t=z(e,e,Xn.schema({names:{contentInfos:pg}}));q.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,s=>new Ie({schema:s}))}toSchema(){return new O({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=fe(!0)){if(ve.assert(e,ii),Ne.assert(e.safeContents,ii,"Array"),e.safeContents.length!==this.safeContents.length)throw new Ne('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');this.parsedValue={safeContents:[]};for(const[s,a]of this.safeContents.entries()){const n=e.safeContents[s],o="parameters.safeContents[".concat(s,"]");switch(a.contentType){case Bp:{Ne.assert(a.content,"this.safeContents[j].content",X);const u=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:nr.fromBER(u)})}break;case Iw:{const u=new vs({schema:a.content});ve.assert(o,n,"recipientCertificate","recipientKey");const h=n,c=h.recipientCertificate,i=h.recipientKey,f=await u.decrypt(0,{recipientCertificate:c,recipientPrivateKey:i},t);this.parsedValue.safeContents.push({privacyMode:2,value:nr.fromBER(f)})}break;case Cw:{const u=new Ts({schema:a.content});ve.assert(o,n,"password");const h=n.password,c=await u.decrypt({password:h},t);this.parsedValue.safeContents.push({privacyMode:1,value:nr.fromBER(c)})}break;default:throw new Error('Unknown "contentType" for AuthenticatedSafe: " '.concat(a.contentType))}}}async makeInternalValues(e,t=fe(!0)){if(!this.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(Ne.assert(this.parsedValue,"this.parsedValue","object"),Ne.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),Ne.assert(e,"parameters","object"),ve.assert(e,"safeContents"),Ne.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new Ne('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');this.safeContents=[];for(const[s,a]of this.parsedValue.safeContents.entries())switch(ve.assert("content",a,"privacyMode","value"),Ne.assert(a.value,"content.value",nr),a.privacyMode){case 0:{const n=a.value.toSchema().toBER(!1);this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.1",content:new X({valueHex:n})}))}break;case 1:{const n=new Ts,o=e.safeContents[s];o.contentToEncrypt=a.value.toSchema().toBER(!1),await n.encrypt(o,t),this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.6",content:n.toSchema()}))}break;case 2:{const n=new vs,o=a.value.toSchema().toBER(!1),u=e.safeContents[s];switch(ve.assert("parameters.safeContents[".concat(s,"]"),u,"encryptingCertificate","encryptionAlgorithm"),!0){case u.encryptionAlgorithm.name.toLowerCase()==="aes-cbc":case u.encryptionAlgorithm.name.toLowerCase()==="aes-gcm":break;default:throw new Error('Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": '.concat(u.encryptionAlgorithm))}switch(!0){case u.encryptionAlgorithm.length===128:case u.encryptionAlgorithm.length===192:case u.encryptionAlgorithm.length===256:break;default:throw new Error('Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": '.concat(u.encryptionAlgorithm.length))}const h=u.encryptionAlgorithm;n.addRecipientByCertificate(u.encryptingCertificate,{},void 0,t),await n.encrypt(h,o,t),this.safeContents.push(new Ie({contentType:"1.2.840.113549.1.7.3",content:n.toSchema()}))}break;default:throw new Error('Incorrect value for "content.privacyMode": '.concat(a.privacyMode))}return this}}Xn.CLASS_NAME="AuthenticatedSafe";const bn="hashAlgorithm",eo="issuerNameHash",to="issuerKeyHash",Sn="serialNumber",pS=[bn,eo,to,Sn];class Ge extends _{static async create(e,t,s=fe(!0)){const a=new Ge;return await a.createForCertificate(e,t,s),a}constructor(e={}){super(),this.hashAlgorithm=d(e,bn,Ge.defaultValues(bn)),this.issuerNameHash=d(e,eo,Ge.defaultValues(eo)),this.issuerKeyHash=d(e,to,Ge.defaultValues(to)),this.serialNumber=d(e,Sn,Ge.defaultValues(Sn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bn:return new M;case eo:case to:return new X;case Sn:return new H;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bn:return t.algorithmId===E&&!("algorithmParams"in t);case eo:case to:case Sn:return t.isEqual(Ge.defaultValues(Sn));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||E}}),new X({name:t.issuerNameHash||E}),new X({name:t.issuerKeyHash||E}),new H({name:t.serialNumber||E})]})}fromSchema(e){G(e,pS);const t=z(e,e,Ge.schema({names:{hashAlgorithm:bn,issuerNameHash:eo,issuerKeyHash:to,serialNumber:Sn}}));q.assertSchema(t,this.className),this.hashAlgorithm=new M({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new O({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!Be.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!Be.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,s=fe(!0)){ve.assert(t,bn,"issuerCertificate");const a=s.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new M({algorithmId:a,algorithmParams:new at});const n=t.issuerCertificate;this.serialNumber=e.serialNumber;const o=await s.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1));this.issuerNameHash=new X({valueHex:o});const u=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,h=await s.digest({name:t.hashAlgorithm},u);this.issuerKeyHash=new X({valueHex:h})}}Ge.CLASS_NAME="CertID";const so="certID",ro="certStatus",ao="thisUpdate",ea="nextUpdate",An="singleExtensions",dS=[so,ro,ao,ea,An];class bs extends _{constructor(e={}){super(),this.certID=d(e,so,bs.defaultValues(so)),this.certStatus=d(e,ro,bs.defaultValues(ro)),this.thisUpdate=d(e,ao,bs.defaultValues(ao)),ea in e&&(this.nextUpdate=d(e,ea,bs.defaultValues(ea))),An in e&&(this.singleExtensions=d(e,An,bs.defaultValues(An))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case so:return new Ge;case ro:return{};case ao:case ea:return new Date(0,0,0);case An:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case so:return Ge.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Ge.compareWithDefault("issuerNameHash",t.issuerNameHash)&&Ge.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&Ge.compareWithDefault("serialNumber",t.serialNumber);case ro:return Object.keys(t).length===0;case ao:case ea:return t===bs.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Ge.schema(t.certID||{}),new je({value:[new ue({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:0}}),new L({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:1},value:[new $e,new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new vc]})]}),new ue({name:t.certStatus||E,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new $e({name:t.thisUpdate||E}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $e({name:t.nextUpdate||E})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Qe.schema(t.singleExtensions||{})]})]})}fromSchema(e){G(e,dS);const t=z(e,e,bs.schema({names:{certID:{names:{blockName:so}},certStatus:ro,thisUpdate:ao,nextUpdate:ea,singleExtensions:{names:{blockName:An}}}}));q.assertSchema(t,this.className),this.certID=new Ge({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),ea in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),An in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,s=>new _e({schema:s})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new $e({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[new $e({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new O({value:Array.from(this.singleExtensions,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}bs.CLASS_NAME="SingleResponse";const ih="tbs",Nn="version",_l="responderID",Gl="producedAt",zl="responses",no="responseExtensions",Zn="ResponseData",Ah="".concat(Zn,".").concat(Nn),io="".concat(Zn,".").concat(_l),Wf="".concat(Zn,".").concat(Gl),_f="".concat(Zn,".").concat(zl),Nh="".concat(Zn,".").concat(no),gS=[Zn,Ah,io,Wf,_f,Nh];class ct extends _{get tbs(){return Be.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,ih,ct.defaultValues(ih))),Nn in e&&(this.version=d(e,Nn,ct.defaultValues(Nn))),this.responderID=d(e,_l,ct.defaultValues(_l)),this.producedAt=d(e,Gl,ct.defaultValues(Gl)),this.responses=d(e,zl,ct.defaultValues(zl)),no in e&&(this.responseExtensions=d(e,no,ct.defaultValues(no))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nn:return 0;case ih:return Ye;case _l:return{};case Gl:return new Date(0,0,0);case zl:case no:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ih:return t.byteLength===0;case _l:return Object.keys(t).length===0;case Gl:return t===ct.defaultValues(e);case zl:case no:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||Zn,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:t.version||Ah})]}),new je({value:[new L({name:t.responderID||io,idBlock:{tagClass:3,tagNumber:1},value:[Ee.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new L({name:t.responderID||io,idBlock:{tagClass:3,tagNumber:2},value:[new X({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new $e({name:t.producedAt||Wf}),new O({value:[new me({name:_f,value:bs.schema(t.response||{})})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Qe.schema(t.extensions||{names:{blockName:Nh}})]})]})}fromSchema(e){G(e,gS);const t=z(e,e,ct.schema());q.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,Ah in t.result&&(this.version=t.result[Ah].valueBlock.valueDec),t.result[io].idBlock.tagNumber===1?this.responderID=new Ee({schema:t.result[io].valueBlock.value[0]}):this.responderID=t.result[io].valueBlock.value[0],this.producedAt=t.result[Wf].toDate(),this.responses=Array.from(t.result[_f],s=>new bs({schema:s})),Nh in t.result&&(this.responseExtensions=Array.from(t.result[Nh].valueBlock.value,s=>new _e({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return ct.schema();const s=Xe(this.tbsView);q.assert(s,"TBS Response Data"),t=s.result}else{const s=[];Nn in this&&s.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[new H({value:this.version})]})),this.responderID instanceof Ee?s.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):s.push(new L({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),s.push(new $e({valueDate:this.producedAt})),s.push(new O({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&s.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[new O({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new O({value:s})}return t}toJSON(){const e={};return Nn in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}ct.CLASS_NAME="ResponseData";const gf="trustedCerts",wf="certs",yf="crls",vf="ocsps",bf="checkDate",Sf="findOrigin",Af="findIssuer";var Dn;(function(r){r[r.unknown=-1]="unknown",r[r.success=0]="success",r[r.noRevocation=11]="noRevocation",r[r.noPath=60]="noPath",r[r.noValidPath=97]="noValidPath"})(Dn||(Dn={}));class ha extends Error{constructor(e,t){super(t),this.name=ha.NAME,this.code=e,this.message=t}}ha.NAME="ChainValidationError";function wS(r,e){for(let t=0;t<e.length;t++)if(Be.isEqual(r.tbsView,e[t].tbsView))return!0;return!1}class vm{constructor(e={}){this.trustedCerts=d(e,gf,this.defaultValues(gf)),this.certs=d(e,wf,this.defaultValues(wf)),this.crls=d(e,yf,this.defaultValues(yf)),this.ocsps=d(e,vf,this.defaultValues(vf)),this.checkDate=d(e,bf,this.defaultValues(bf)),this.findOrigin=d(e,Sf,this.defaultValues(Sf)),this.findIssuer=d(e,Af,this.defaultValues(Af))}static defaultFindOrigin(e,t){e.tbsView.byteLength===0&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));for(const s of t.certs)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),Be.isEqual(e.tbsView,s.tbsView))return"Intermediate Certificates";for(const s of t.trustedCerts)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),Be.isEqual(e.tbsView,s.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,s=fe(!0)){const a=[];let n=null,o=null,u=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,s))return[e]}catch(c){}if(e.extensions){for(const c of e.extensions)if(c.extnID===Vp&&c.parsedValue instanceof ga){c.parsedValue.keyIdentifier?n=c.parsedValue.keyIdentifier:(c.parsedValue.authorityCertIssuer&&(o=c.parsedValue.authorityCertIssuer),c.parsedValue.authorityCertSerialNumber&&(u=c.parsedValue.authorityCertSerialNumber));break}}function h(c){if(n!==null&&c.extensions){let f=!1;for(const m of c.extensions)if(m.extnID===Sv&&m.parsedValue){f=!0,Be.isEqual(m.parsedValue.valueBlock.valueHex,n.valueBlock.valueHexView)&&a.push(c);break}if(f)return}let i=!1;u!==null&&(i=c.serialNumber.isEqual(u)),o!==null?c.subject.isEqual(o)&&i&&a.push(c):e.issuer.isEqual(c.subject)&&a.push(c)}for(const c of t.trustedCerts)h(c);for(const c of t.certs)h(c);for(let c=a.length-1;c>=0;c--)try{await e.verify(a[c],s)===!1&&a.splice(c,1)}catch(i){a.splice(c,1)}return a}defaultValues(e){switch(e){case gf:return[];case wf:return[];case yf:return[];case vf:return[];case bf:return new Date;case Sf:return vm.defaultFindOrigin;case Af:return this.defaultFindIssuer;default:throw new Error("Invalid member name for CertificateChainValidationEngine class: ".concat(e))}}async sort(e=!1,t=fe(!0)){const s=[],a=async(v,w)=>{const y=[];function k(S){let I=!0;for(let P=0;P<S.length;P++){for(let x=0;x<S.length;x++)if(x!==P&&S[P]===S[x]){I=!1;break}if(!I)break}return I}if(wS(v,this.trustedCerts))return[[v]];const p=await this.findIssuer(v,this,w);if(p.length===0)throw new Error("No valid certificate paths found");for(let S=0;S<p.length;S++){if(Be.isEqual(p[S].tbsView,v.tbsView)){y.push([p[S]]);continue}const I=await a(p[S],w);for(let P=0;P<I.length;P++){const x=I[P].slice();x.splice(0,0,p[S]),k(x)?y.push(x):y.push(I[P])}}return y},n=async v=>{const w=[],y=[],k=[];if(w.push(...s.filter(p=>v.issuer.isEqual(p.subject))),w.length===0)return{status:1,statusMessage:"No certificate's issuers"};if(y.push(...this.crls.filter(p=>p.issuer.isEqual(v.issuer))),y.length===0)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let p=0;p<y.length;p++){const S=y[p];if(!(S.nextUpdate&&S.nextUpdate.value<this.checkDate))for(let I=0;I<w.length;I++)try{if(await y[p].verify({issuerCertificate:w[I]},t)){k.push({crl:y[p],certificate:w[I]});break}}catch(P){}}return k.length?{status:0,statusMessage:E,result:k}:{status:3,statusMessage:"No valid CRLs found"}},o=async(v,w)=>{const y=t.getAlgorithmByOID(v.signatureAlgorithm.algorithmId);if(!y.name||!y.hash)return 1;for(let k=0;k<this.ocsps.length;k++){const p=await this.ocsps[k].getCertificateStatus(v,w,t);if(p.isForCertificate)return p.status===0?0:1}return 2};async function u(v,w=!1){let y=!1,k=!1,p=!1,S=!1;if(v.extensions){for(let I=0;I<v.extensions.length;I++){const P=v.extensions[I];if(P.critical&&!P.parsedValue)return{result:!1,resultCode:6,resultMessage:"Unable to parse critical certificate extension: ".concat(P.extnID)};if(P.extnID===Av){p=!0;const x=new Uint8Array(P.parsedValue.valueBlock.valueHex);(x[0]&4)===4&&(k=!0),(x[0]&2)===2&&(S=!0)}P.extnID===Ip&&"cA"in P.parsedValue&&P.parsedValue.cA===!0&&(y=!0)}if(k===!0&&y===!1)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(p===!0&&y===!0&&k===!1)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(y===!0&&p===!0&&w&&S===!1)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return y===!1?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:E}}const h=async(v,w)=>{for(let y=0;y<v.length;y++)if(v[y].notBefore.value>w||v[y].notAfter.value<w)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(v.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let y=v.length-2;y>=0;y--)if(v[y].issuer.isEqual(v[y].subject)===!1&&v[y].issuer.isEqual(v[y+1].subject)===!1)return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(this.crls.length!==0||this.ocsps.length!==0)for(let y=0;y<v.length-1;y++){let k=2,p={status:0,statusMessage:E};if(this.ocsps.length!==0)switch(k=await o(v[y],v[y+1]),k){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(this.crls.length!==0){if(p=await n(v[y]),p.status===0&&p.result)for(let S=0;S<p.result.length;S++){if(p.result[S].crl.isCertificateRevoked(v[y]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if((await u(p.result[S].certificate,!0)).result===!1)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(e===!1)throw new ha(Dn.noRevocation,"No revocation values found for one of certificates: ".concat(p.statusMessage))}else if(k===2)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(k===2&&p.status===2&&e){const S=v[y+1];let I=!1;if(S.extensions)for(const P of S.extensions)switch(P.extnID){case Sw:case Cp:case xp:I=!0;break}if(I)throw new ha(Dn.noRevocation,"No revocation values found for one of certificates: ".concat(p.statusMessage))}}for(const[y,k]of v.entries())if(y&&!(await u(k)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}};s.push(...this.trustedCerts),s.push(...this.certs);for(let v=0;v<s.length;v++)for(let w=0;w<s.length;w++)if(v!==w&&Be.isEqual(s[v].tbsView,s[w].tbsView)){s.splice(w,1),v=0;break}const c=s[s.length-1];let i;const f=[c];if(i=await a(c,t),i.length===0)throw new ha(Dn.noPath,"Unable to find certificate path");for(let v=i.length-1;v>=0;v--){let w=!1;for(let y=0;y<i[v].length;y++){const k=i[v][y];for(let p=0;p<this.trustedCerts.length;p++)if(Be.isEqual(k.tbsView,this.trustedCerts[p].tbsView)){w=!0;break}if(w)break}w||i.splice(v,1)}if(i.length===0)throw new ha(Dn.noValidPath,"No valid certificate paths found");let m=i[0].length,b=0;for(let v=0;v<i.length;v++)i[v].length<m&&(m=i[v].length,b=v);for(let v=0;v<i[b].length;v++)f.push(i[b][v]);if(i=await h(f,this.checkDate),i.result===!1)throw i;return f}async verify(e={},t=fe(!0)){function s(h,c){const i=oa(h),f=oa(c),m=i.split("."),b=f.split("."),v=m.length,w=b.length;if(v===0||w===0||v<w)return!1;for(let y=0;y<v;y++)if(m[y].length===0)return!1;for(let y=0;y<w;y++)if(b[y].length===0){if(y===0){if(w===1)return!1;continue}return!1}for(let y=0;y<w;y++)if(b[w-1-y].length!==0&&m[v-1-y].localeCompare(b[w-1-y])!==0)return!1;return!0}function a(h,c){const i=oa(h),f=oa(c),m=i.split("@"),b=f.split("@");if(m.length===0||b.length===0||m.length<b.length)return!1;if(b.length===1){if(s(m[1],b[0])){const v=m[1].split("."),w=b[0].split(".");return w[0].length===0?!0:v.length===w.length}return!1}return i.localeCompare(f)===0}function n(h,c){let i=oa(h);const f=oa(c),m=i.split("/");if(f.split("/").length>1)return!1;if(m.length>1){for(let b=0;b<m.length;b++)if(m[b].length>0&&m[b].charAt(m[b].length-1)!==":"){i=m[b].split(":")[0];break}}if(s(i,f)){const b=i.split("."),v=f.split(".");return v[0].length===0?!0:b.length===v.length}return!1}function o(h,c){const i=h.valueBlock.valueHexView,f=c.valueBlock.valueHexView;if(i.length===4&&f.length===8){for(let m=0;m<4;m++)if((i[m]^f[m])&f[m+4])return!1;return!0}if(i.length===16&&f.length===32){for(let m=0;m<16;m++)if((i[m]^f[m])&f[m+16])return!1;return!0}return!1}function u(h,c){if(h.typesAndValues.length===0||c.typesAndValues.length===0)return!0;if(h.typesAndValues.length<c.typesAndValues.length)return!1;let i=!0,f=0;for(let m=0;m<c.typesAndValues.length;m++){let b=!1;for(let v=f;v<h.typesAndValues.length;v++)if(b=h.typesAndValues[v].isEqual(c.typesAndValues[m]),h.typesAndValues[v].type===c.typesAndValues[m].type&&(i=i&&b),b===!0)if(f===0||f===v){f=v+1;break}else return!1;if(b===!1)return!1}return f===0?!1:i}try{if(this.certs.length===0)throw new Error("Empty certificate array");const h=e.passedWhenNotRevValues||!1,c=e.initialPolicySet||[as],i=e.initialExplicitPolicy||!1,f=e.initialPolicyMappingInhibit||!1,m=e.initialInhibitPolicy||!1,b=e.initialPermittedSubtreesSet||[],v=e.initialExcludedSubtreesSet||[],w=e.initialRequiredNameForms||[];let y=i,k=f,p=m;const S=[!1,!1,!1];let I=0,P=0,x=0,T=b,B=v;const V=w;let J=1;this.certs=await this.sort(h,t);const F=[];F.push(as);const D=[],j=new Array(this.certs.length-1);for(let re=0;re<this.certs.length-1;re++)j[re]=!0;D.push(j);const te=new Array(this.certs.length-1),Y=new Array(this.certs.length-1);let oe=y?this.certs.length-1:-1;for(let re=this.certs.length-2;re>=0;re--,J++){const se=this.certs[re];if(se.extensions){for(let ee=0;ee<se.extensions.length;ee++){const ce=se.extensions[ee];if(ce.extnID===Aw){Y[re]=ce.parsedValue;for(let pe=0;pe<F.length;pe++)if(F[pe]===as){delete D[pe][re];break}for(let pe=0;pe<ce.parsedValue.certificatePolicies.length;pe++){let Ce=-1;const Fe=ce.parsedValue.certificatePolicies[pe].policyIdentifier;for(let C=0;C<F.length;C++)if(Fe===F[C]){Ce=C;break}if(Ce===-1){F.push(Fe);const C=new Array(this.certs.length-1);C[re]=!0,D.push(C)}else D[Ce][re]=!0}}if(ce.extnID===Nw){if(k)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};te[re]=ce.parsedValue}ce.extnID===Ew&&y===!1&&(ce.parsedValue.requireExplicitPolicy===0?(y=!0,oe=re):S[0]===!1?(S[0]=!0,I=ce.parsedValue.requireExplicitPolicy):I=I>ce.parsedValue.requireExplicitPolicy?ce.parsedValue.requireExplicitPolicy:I,ce.parsedValue.inhibitPolicyMapping===0?k=!0:S[1]===!1?(S[1]=!0,P=ce.parsedValue.inhibitPolicyMapping+1):P=P>ce.parsedValue.inhibitPolicyMapping+1?ce.parsedValue.inhibitPolicyMapping+1:P),ce.extnID===Bv&&p===!1&&(ce.parsedValue.valueBlock.valueDec===0?p=!0:S[2]===!1?(S[2]=!0,x=ce.parsedValue.valueBlock.valueDec):x=x>ce.parsedValue.valueBlock.valueDec?ce.parsedValue.valueBlock.valueDec:x)}if(p===!0){let ee=-1;for(let ce=0;ce<F.length;ce++)if(F[ce]===as){ee=ce;break}ee!==-1&&delete D[0][re]}y===!1&&S[0]===!0&&(I--,I===0&&(y=!0,oe=re,S[0]=!1)),k===!1&&S[1]===!0&&(P--,P===0&&(k=!0,S[1]=!1)),p===!1&&S[2]===!0&&(x--,x===0&&(p=!0,S[2]=!1))}}for(let re=0;re<this.certs.length-1;re++)if(re<this.certs.length-2&&typeof te[re+1]<"u")for(let se=0;se<te[re+1].mappings.length;se++){if(te[re+1].mappings[se].issuerDomainPolicy===as||te[re+1].mappings[se].subjectDomainPolicy===as)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let ee=-1,ce=-1;for(let pe=0;pe<F.length;pe++)F[pe]===te[re+1].mappings[se].issuerDomainPolicy&&(ee=pe),F[pe]===te[re+1].mappings[se].subjectDomainPolicy&&(ce=pe);typeof D[ee][re]<"u"&&delete D[ee][re];for(let pe=0;pe<Y[re].certificatePolicies.length;pe++)if(te[re+1].mappings[se].subjectDomainPolicy===Y[re].certificatePolicies[pe].policyIdentifier&&ee!==-1&&ce!==-1)for(let Ce=0;Ce<=re;Ce++)typeof D[ce][Ce]<"u"&&(D[ee][Ce]=!0,delete D[ce][Ce])}for(let re=0;re<F.length;re++)if(F[re]===as)for(let se=0;se<oe;se++)delete D[re][se];const ne=[];for(let re=0;re<D.length;re++){let se=!0;for(let ee=0;ee<this.certs.length-1;ee++){let ce=!1;if(ee<oe&&F[re]===as&&F.length>1){se=!1;break}if(typeof D[re][ee]>"u"){if(ee>=oe){for(let pe=0;pe<F.length;pe++)if(F[pe]===as){D[pe][ee]===!0&&(ce=!0);break}}if(!ce){se=!1;break}}}se===!0&&ne.push(F[re])}let de=[];if(c.length===1&&c[0]===as&&y===!1)de=c;else if(ne.length===1&&ne[0]===as)de=c;else for(let re=0;re<ne.length;re++)for(let se=0;se<c.length;se++)if(c[se]===ne[re]||c[se]===as){de.push(ne[re]);break}const ie={result:de.length>0,resultCode:0,resultMessage:de.length>0?E:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:ne,userConstrPolicies:de,explicitPolicyIndicator:y,policyMappings:te,certificatePath:this.certs};if(de.length===0||ie.result===!1)return ie;J=1;for(let re=this.certs.length-2;re>=0;re--,J++){const se=this.certs[re];let ee=[],ce=[],pe=[];if(se.extensions)for(let A=0;A<se.extensions.length;A++){const $=se.extensions[A];$.extnID===bw&&("permittedSubtrees"in $.parsedValue&&(ce=ce.concat($.parsedValue.permittedSubtrees)),"excludedSubtrees"in $.parsedValue&&(pe=pe.concat($.parsedValue.excludedSubtrees))),$.extnID===gw&&(ee=ee.concat($.parsedValue.altNames))}let Ce=V.length<=0;for(let A=0;A<V.length;A++)switch(V[A].base.type){case 4:{if(V[A].base.value.typesAndValues.length!==se.subject.typesAndValues.length)continue;Ce=!0;for(let $=0;$<se.subject.typesAndValues.length;$++)if(se.subject.typesAndValues[$].type!==V[A].base.value.typesAndValues[$].type){Ce=!1;break}if(Ce===!0)break}break;default:}if(Ce===!1)throw ie.result=!1,ie.resultCode=21,ie.resultMessage="No necessary name form found",ie;const Fe=[[],[],[],[],[]];for(let A=0;A<T.length;A++)switch(T[A].base.type){case 1:Fe[0].push(T[A]);break;case 2:Fe[1].push(T[A]);break;case 4:Fe[2].push(T[A]);break;case 6:Fe[3].push(T[A]);break;case 7:Fe[4].push(T[A]);break;default:}for(let A=0;A<5;A++){let $=!1,U=!1;const ge=Fe[A];for(let ke=0;ke<ge.length;ke++){switch(A){case 0:if(ee.length>0)for(let he=0;he<ee.length;he++)ee[he].type===1&&(U=!0,$=$||a(ee[he].value,ge[ke].base.value));else for(let he=0;he<se.subject.typesAndValues.length;he++)(se.subject.typesAndValues[he].type==="1.2.840.113549.1.9.1"||se.subject.typesAndValues[he].type==="0.9.2342.19200300.100.1.3")&&(U=!0,$=$||a(se.subject.typesAndValues[he].value.valueBlock.value,ge[ke].base.value));break;case 1:if(ee.length>0)for(let he=0;he<ee.length;he++)ee[he].type===2&&(U=!0,$=$||s(ee[he].value,ge[ke].base.value));break;case 2:U=!0,$=u(se.subject,ge[ke].base.value);break;case 3:if(ee.length>0)for(let he=0;he<ee.length;he++)ee[he].type===6&&(U=!0,$=$||n(ee[he].value,ge[ke].base.value));break;case 4:if(ee.length>0)for(let he=0;he<ee.length;he++)ee[he].type===7&&(U=!0,$=$||o(ee[he].value,ge[ke].base.value));break;default:}if($)break}if($===!1&&ge.length>0&&U)throw ie.result=!1,ie.resultCode=41,ie.resultMessage='Failed to meet "permitted sub-trees" name constraint',ie}let C=!1;for(let A=0;A<B.length;A++){switch(B[A].base.type){case 1:if(ee.length>=0)for(let $=0;$<ee.length;$++)ee[$].type===1&&(C=C||a(ee[$].value,B[A].base.value));else for(let $=0;$<se.subject.typesAndValues.length;$++)(se.subject.typesAndValues[$].type==="1.2.840.113549.1.9.1"||se.subject.typesAndValues[$].type==="0.9.2342.19200300.100.1.3")&&(C=C||a(se.subject.typesAndValues[$].value.valueBlock.value,B[A].base.value));break;case 2:if(ee.length>0)for(let $=0;$<ee.length;$++)ee[$].type===2&&(C=C||s(ee[$].value,B[A].base.value));break;case 4:C=C||u(se.subject,B[A].base.value);break;case 6:if(ee.length>0)for(let $=0;$<ee.length;$++)ee[$].type===6&&(C=C||n(ee[$].value,B[A].base.value));break;case 7:if(ee.length>0)for(let $=0;$<ee.length;$++)ee[$].type===7&&(C=C||o(ee[$].value,B[A].base.value));break;default:}if(C)break}if(C===!0)throw ie.result=!1,ie.resultCode=42,ie.resultMessage='Failed to meet "excluded sub-trees" name constraint',ie;T=T.concat(ce),B=B.concat(pe)}return ie}catch(h){return h instanceof Error?h instanceof ha?{result:!1,resultCode:h.code,resultMessage:h.message,error:h}:{result:!1,resultCode:Dn.unknown,resultMessage:h.message,error:h}:h&&typeof h=="object"&&"resultMessage"in h?h:{result:!1,resultCode:-1,resultMessage:"".concat(h)}}}}const Eh="tbsResponseData",Xl="signatureAlgorithm",Yl="signature",oo="certs",Bc="BasicOCSPResponse",Gf="".concat(Bc,".").concat(Eh),zf="".concat(Bc,".").concat(Xl),Xf="".concat(Bc,".").concat(Yl),kh="".concat(Bc,".").concat(oo),yS=[Gf,zf,Xf,kh];class cs extends _{constructor(e={}){super(),this.tbsResponseData=d(e,Eh,cs.defaultValues(Eh)),this.signatureAlgorithm=d(e,Xl,cs.defaultValues(Xl)),this.signature=d(e,Yl,cs.defaultValues(Yl)),oo in e&&(this.certs=d(e,oo,cs.defaultValues(oo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Eh:return new ct;case Xl:return new M;case Yl:return new ye;case oo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let s=ct.compareWithDefault("tbs",t.tbs)&&ct.compareWithDefault("responderID",t.responderID)&&ct.compareWithDefault("producedAt",t.producedAt)&&ct.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(s=s&&ct.compareWithDefault("responseExtensions",t.responseExtensions)),s}case Xl:return t.algorithmId===E&&!("algorithmParams"in t);case Yl:return t.isEqual(cs.defaultValues(e));case oo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||Bc,value:[ct.schema(t.tbsResponseData||{names:{blockName:Gf}}),M.schema(t.signatureAlgorithm||{names:{blockName:zf}}),new ye({name:t.signature||Xf}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:[new me({name:kh,value:be.schema(t.certs||{})})]})]})]})}fromSchema(e){G(e,yS);const t=z(e,e,cs.schema());q.assertSchema(t,this.className),this.tbsResponseData=new ct({schema:t.result[Gf]}),this.signatureAlgorithm=new M({schema:t.result[zf]}),this.signature=t.result[Xf],kh in t.result&&(this.certs=Array.from(t.result[kh],s=>new be({schema:s})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[new O({value:Array.from(this.certs,t=>t.toSchema())})]})),new O({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}async getCertificateStatus(e,t,s=fe(!0)){const a={isForCertificate:!1,status:2},n={},o=[];for(const u of this.tbsResponseData.responses){const h=s.getAlgorithmByOID(u.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!n[h.name]){n[h.name]=1;const c=new Ge;o.push(c),await c.createForCertificate(e,{hashAlgorithm:h.name,issuerCertificate:t},s)}}for(const u of this.tbsResponseData.responses)for(const h of o)if(u.certID.isEqual(h)){a.isForCertificate=!0;try{switch(u.certStatus.idBlock.isConstructed){case!0:u.certStatus.idBlock.tagNumber===1&&(a.status=1);break;case!1:switch(u.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2;break;default:}break;default:}}catch(c){}return a}return a}async sign(e,t="SHA-1",s=fe(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters.algorithm;if(!("name"in n))throw new Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());const o=await s.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:n});this.signature=new ye({valueHex:o})}async verify(e={},t=fe(!0)){let s=null,a=-1;const n=e.trustedCerts||[];if(!this.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof Ee:for(const[u,h]of this.certs.entries())if(h.subject.isEqual(this.tbsResponseData.responderID)){a=u;break}break;case this.tbsResponseData.responderID instanceof X:for(const[u,h]of this.certs.entries()){const c=await t.digest({name:"sha-1"},h.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(yc(c,this.tbsResponseData.responderID.valueBlock.valueHex)){a=u;break}}break;default:throw new Error("Wrong value for responderID")}if(a===-1)throw new Error("Correct certificate was not found in OCSP response");s=this.certs[a];const o=[s];for(const u of this.certs){const h=await Dw(u,s);h&&o.push(h)}if(!(await new vm({certs:o,trustedCerts:n}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}cs.CLASS_NAME="BasicOCSPResponse";const Nf="tbs",Ef="version",kf="subject",If="subjectPublicKeyInfo",oi="attributes",Ql="signatureAlgorithm",Zl="signatureValue",zo="CertificationRequestInfo",jp="".concat(zo,".version"),$p="".concat(zo,".subject"),Kp="".concat(zo,".subjectPublicKeyInfo"),hm="".concat(zo,".attributes"),vS=[zo,jp,$p,Kp,hm,Ql,Zl];function bS(r={}){const e=d(r,"names",{});return new O({name:e.CertificationRequestInfo||zo,value:[new H({name:e.CertificationRequestInfoVersion||jp}),Ee.schema(e.subject||{names:{blockName:$p}}),Ft.schema({names:{blockName:Kp}}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({optional:!0,name:e.CertificationRequestInfoAttributes||hm,value:Oe.schema(e.attributes||{})})]})]})}class ys extends _{get tbs(){return Be.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,Nf,ys.defaultValues(Nf))),this.version=d(e,Ef,ys.defaultValues(Ef)),this.subject=d(e,kf,ys.defaultValues(kf)),this.subjectPublicKeyInfo=d(e,If,ys.defaultValues(If)),oi in e&&(this.attributes=d(e,oi,ys.defaultValues(oi))),this.signatureAlgorithm=d(e,Ql,ys.defaultValues(Ql)),this.signatureValue=d(e,Zl,ys.defaultValues(Zl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nf:return Ye;case Ef:return 0;case kf:return new Ee;case If:return new Ft;case oi:return[];case Ql:return new M;case Zl:return new ye;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({value:[bS(t.certificationRequestInfo||{}),new O({name:t.signatureAlgorithm||Ql,value:[new ae,new le({optional:!0})]}),new ye({name:t.signatureValue||Zl})]})}fromSchema(e){G(e,vS);const t=z(e,e,ys.schema());q.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[jp].valueBlock.valueDec,this.subject=new Ee({schema:t.result[$p]}),this.subjectPublicKeyInfo=new Ft({schema:t.result[Kp]}),hm in t.result&&(this.attributes=Array.from(t.result[hm],s=>new Oe({schema:s}))),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new H({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return oi in this&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new O({value:e})}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return ys.schema();const s=Xe(this.tbsView);q.assert(s,"PKCS#10 Certificate Request"),t=s.result}else t=this.encodeTBS();return new O({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ae.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return oi in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}async sign(e,t="SHA-1",s=fe(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const o=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ye({valueHex:o})}async verify(e=fe(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=fe(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}ys.CLASS_NAME="CertificationRequest";const En="digestAlgorithm",kn="digest",SS=[En,kn];class ms extends _{constructor(e={}){super(),this.digestAlgorithm=d(e,En,ms.defaultValues(En)),this.digest=d(e,kn,ms.defaultValues(kn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case En:return new M;case kn:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case En:return M.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case kn:return t.isEqual(ms.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.digestAlgorithm||{names:{blockName:En}}),new X({name:t.digest||kn})]})}fromSchema(e){G(e,SS);const t=z(e,e,ms.schema({names:{digestAlgorithm:{names:{blockName:En}},digest:kn}}));q.assertSchema(t,this.className),this.digestAlgorithm=new M({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new O({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}ms.CLASS_NAME="DigestInfo";const uo="eContentType",ws="eContent",AS=[uo,ws];class Gt extends _{constructor(e={}){if(super(),this.eContentType=d(e,uo,Gt.defaultValues(uo)),ws in e&&(this.eContent=d(e,ws,Gt.defaultValues(ws)),this.eContent.idBlock.tagClass===1&&this.eContent.idBlock.tagNumber===4&&this.eContent.idBlock.isConstructed===!1)){const t=new X({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const o=new Uint8Array(a,s,s+65536>a.byteLength?a.byteLength-s:65536),u=new ArrayBuffer(o.length),h=new Uint8Array(u);for(let c=0;c<h.length;c++)h[c]=o[c];t.valueBlock.value.push(new X({valueHex:u})),n-=o.length,s+=o.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uo:return E;case ws:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uo:return t===E;case ws:return t.idBlock.tagClass===1&&t.idBlock.tagNumber===4?t.isEqual(Gt.defaultValues(ws)):!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.eContentType||E}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new le({name:t.eContent||E})]})]})}fromSchema(e){G(e,AS);const t=z(e,e,Gt.schema({names:{eContentType:uo,eContent:ws}}));q.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),ws in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new ae({value:this.eContentType})),this.eContent&&Gt.compareWithDefault(ws,this.eContent)===!1&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new O({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&Gt.compareWithDefault(ws,this.eContent)===!1&&(e.eContent=this.eContent.toJSON()),e}}Gt.CLASS_NAME="EncapsulatedContentInfo";const In="mac",Cn="macSalt",Gs="iterations",NS=[In,Cn,Gs];class Lt extends _{constructor(e={}){super(),this.mac=d(e,In,Lt.defaultValues(In)),this.macSalt=d(e,Cn,Lt.defaultValues(Cn)),Gs in e&&(this.iterations=d(e,Gs,Lt.defaultValues(Gs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case In:return new ms;case Cn:return new X;case Gs:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case In:return ms.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&ms.compareWithDefault("digest",t.digest);case Cn:return t.isEqual(Lt.defaultValues(e));case Gs:return t===Lt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,optional:t.optional||!0,value:[ms.schema(t.mac||{names:{blockName:In}}),new X({name:t.macSalt||Cn}),new H({optional:!0,name:t.iterations||Gs})]})}fromSchema(e){G(e,NS);const t=z(e,e,Lt.schema({names:{mac:{names:{blockName:In}},macSalt:Cn,iterations:Gs}}));q.assertSchema(t,this.className),this.mac=new ms({schema:t.result.mac}),this.macSalt=t.result.macSalt,Gs in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return this.iterations!==void 0&&e.push(new H({value:this.iterations})),new O({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return this.iterations!==void 0&&(e.iterations=this.iterations),e}}Lt.CLASS_NAME="MacData";const Tn="hashAlgorithm",Rn="hashedMessage",ES=[Tn,Rn];class Nt extends _{static async create(e,t,s=fe(!0)){const a=s.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),n=await s.digest(e,t);return new Nt({hashAlgorithm:new M({algorithmId:a,algorithmParams:new at}),hashedMessage:new X({valueHex:n})})}constructor(e={}){super(),this.hashAlgorithm=d(e,Tn,Nt.defaultValues(Tn)),this.hashedMessage=d(e,Rn,Nt.defaultValues(Rn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tn:return new M;case Rn:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Tn:return t.algorithmId===E&&!("algorithmParams"in t);case Rn:return t.isEqual(Nt.defaultValues(e))===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.hashAlgorithm||{}),new X({name:t.hashedMessage||E})]})}fromSchema(e){G(e,ES);const t=z(e,e,Nt.schema({names:{hashAlgorithm:{names:{blockName:Tn}},hashedMessage:Rn}}));q.assertSchema(t,this.className),this.hashAlgorithm=new M({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new O({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}Nt.CLASS_NAME="MessageImprint";const lo="reqCert",ta="singleRequestExtensions",kS=[lo,ta];let mm=class ec extends _{constructor(e={}){super(),this.reqCert=d(e,lo,ec.defaultValues(lo)),ta in e&&(this.singleRequestExtensions=d(e,ta,ec.defaultValues(ta))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lo:return new Ge;case ta:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case lo:return t.isEqual(ec.defaultValues(e));case ta:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[Ge.schema(t.reqCert||{}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[_e.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||E}})]})]})}fromSchema(e){G(e,kS);const t=z(e,e,ec.schema({names:{reqCert:{names:{blockName:lo}},extensions:{names:{blockName:ta}}}}));q.assertSchema(t,this.className),this.reqCert=new Ge({schema:t.result.reqCert}),ta in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,s=>new _e({schema:s})))}toSchema(){const e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:Array.from(this.singleRequestExtensions,t=>t.toSchema())})]})),new O({value:e})}toJSON(){const e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,t=>t.toJSON())),e}};mm.CLASS_NAME="Request";const oh="tbs",co="version",ho="requestorName",uh="requestList",mo="requestExtensions",Xo="TBSRequest",Ih="".concat(Xo,".").concat(co),Ch="".concat(Xo,".").concat(ho),Yf="".concat(Xo,".requests"),Vh="".concat(Xo,".").concat(mo),IS=[Xo,Ih,Ch,Yf,Vh];class vt extends _{get tbs(){return Be.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,oh,vt.defaultValues(oh))),co in e&&(this.version=d(e,co,vt.defaultValues(co))),ho in e&&(this.requestorName=d(e,ho,vt.defaultValues(ho))),this.requestList=d(e,uh,vt.defaultValues(uh)),mo in e&&(this.requestExtensions=d(e,mo,vt.defaultValues(mo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oh:return Ye;case co:return 0;case ho:return new Se;case uh:case mo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oh:return t.byteLength===0;case co:return t===vt.defaultValues(e);case ho:return t.type===Se.defaultValues("type")&&Object.keys(t.value).length===0;case uh:case mo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||Xo,value:[new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new H({name:t.TBSRequestVersion||Ih})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Se.schema(t.requestorName||{names:{blockName:Ch}})]}),new O({name:t.requestList||"TBSRequest.requestList",value:[new me({name:t.requests||Yf,value:mm.schema(t.requestNames||{})})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[Qe.schema(t.extensions||{names:{blockName:t.requestExtensions||Vh}})]})]})}fromSchema(e){G(e,IS);const t=z(e,e,vt.schema());q.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,Ih in t.result&&(this.version=t.result[Ih].valueBlock.valueDec),Ch in t.result&&(this.requestorName=new Se({schema:t.result[Ch]})),this.requestList=Array.from(t.result[Yf],s=>new mm({schema:s})),Vh in t.result&&(this.requestExtensions=Array.from(t.result[Vh].valueBlock.value,s=>new _e({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return vt.schema();const s=Xe(this.tbsView);if(q.assert(s,"TBS Request"),!(s.result instanceof O))throw new Error("ASN.1 result should be SEQUENCE");t=s.result}else{const s=[];this.version!==void 0&&s.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[new H({value:this.version})]})),this.requestorName&&s.push(new L({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),s.push(new O({value:Array.from(this.requestList,a=>a.toSchema())})),this.requestExtensions&&s.push(new L({idBlock:{tagClass:3,tagNumber:2},value:[new O({value:Array.from(this.requestExtensions,a=>a.toSchema())})]})),t=new O({value:s})}return t}toJSON(){const e={};return this.version!=null&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,t=>t.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,t=>t.toJSON())),e}}vt.CLASS_NAME="TBSRequest";const ui="signatureAlgorithm",li="signature",br="certs";class Zt extends _{constructor(e={}){super(),this.signatureAlgorithm=d(e,ui,Zt.defaultValues(ui)),this.signature=d(e,li,Zt.defaultValues(li)),br in e&&(this.certs=d(e,br,Zt.defaultValues(br))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ui:return new M;case li:return new ye;case br:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ui:return t.algorithmId===E&&!("algorithmParams"in t);case li:return t.isEqual(Zt.defaultValues(e));case br:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[M.schema(t.signatureAlgorithm||{}),new ye({name:t.signature||E}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:[new me({name:t.certs||E,value:be.schema({})})]})]})]})}fromSchema(e){G(e,[ui,li,br]);const t=z(e,e,Zt.schema({names:{signatureAlgorithm:{names:{blockName:ui}},signature:li,certs:br}}));q.assertSchema(t,this.className),this.signatureAlgorithm=new M({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,br in t.result&&(this.certs=Array.from(t.result.certs,s=>new be({schema:s})))}toSchema(){const e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new O({value:Array.from(this.certs,t=>t.toSchema())})]})),new O({value:e})}toJSON(){const e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}}Zt.CLASS_NAME="Signature";const fo="tbsRequest",sa="optionalSignature",CS=[fo,sa];class dc extends _{constructor(e={}){super(),this.tbsRequest=d(e,fo,dc.defaultValues(fo)),sa in e&&(this.optionalSignature=d(e,sa,dc.defaultValues(sa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fo:return new vt;case sa:return new Zt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fo:return vt.compareWithDefault("tbs",t.tbs)&&vt.compareWithDefault("version",t.version)&&vt.compareWithDefault("requestorName",t.requestorName)&&vt.compareWithDefault("requestList",t.requestList)&&vt.compareWithDefault("requestExtensions",t.requestExtensions);case sa:return Zt.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&Zt.compareWithDefault("signature",t.signature)&&Zt.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||"OCSPRequest",value:[vt.schema(t.tbsRequest||{names:{blockName:fo}}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Zt.schema(t.optionalSignature||{names:{blockName:sa}})]})]})}fromSchema(e){G(e,CS);const t=z(e,e,dc.schema());q.assertSchema(t,this.className),this.tbsRequest=new vt({schema:t.result.tbsRequest}),sa in t.result&&(this.optionalSignature=new Zt({schema:t.result.optionalSignature}))}toSchema(e=!1){const t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new O({value:t})}toJSON(){const e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,s=fe(!0)){const a=new Ge;await a.createForCertificate(e,t,s),this.tbsRequest.requestList.push(new mm({reqCert:a}))}async sign(e,t="SHA-1",s=fe(!0)){if(ve.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw new Error('Need to create "optionalSignature" field before signing');const a=await s.getSignatureParameters(e,t),n=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;const o=this.tbsRequest.toSchema(!0).toBER(!1),u=await s.signWithPrivateKey(o,e,n);this.optionalSignature.signature=new ye({valueHex:u})}verify(){}}dc.CLASS_NAME="OCSPRequest";const po="responseType",go="response",VS=[po,go];class As extends _{constructor(e={}){super(),this.responseType=d(e,po,As.defaultValues(po)),this.response=d(e,go,As.defaultValues(go)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case po:return E;case go:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case po:return t===E;case go:return t.isEqual(As.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new ae({name:t.responseType||E}),new X({name:t.response||E})]})}fromSchema(e){G(e,VS);const t=z(e,e,As.schema({names:{responseType:po,response:go}}));q.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new O({value:[new ae({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}As.CLASS_NAME="ResponseBytes";const ci="responseStatus",$s="responseBytes";class Ro extends _{constructor(e={}){super(),this.responseStatus=d(e,ci,Ro.defaultValues(ci)),$s in e&&(this.responseBytes=d(e,$s,Ro.defaultValues($s))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ci:return new vc;case $s:return new As;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ci:return t.isEqual(Ro.defaultValues(e));case $s:return As.compareWithDefault("responseType",t.responseType)&&As.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||"OCSPResponse",value:[new vc({name:t.responseStatus||ci}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[As.schema(t.responseBytes||{names:{blockName:$s}})]})]})}fromSchema(e){G(e,[ci,$s]);const t=z(e,e,Ro.schema());q.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,$s in t.result&&(this.responseBytes=new As({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new O({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,s=fe(!0)){let a;const n={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==ph)return n;try{const o=Xe(this.responseBytes.response.valueBlock.valueHexView);q.assert(o,"Basic OCSP response"),a=new cs({schema:o.result})}catch(o){return n}return a.getCertificateStatus(e,t,s)}async sign(e,t,s=fe(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===ph)return cs.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,s);throw new Error("Unknown ResponseBytes type: ".concat(((a=this.responseBytes)===null||a===void 0?void 0:a.responseType)||"Unknown"))}async verify(e=null,t=fe(!0)){var s;if(!($s in this))throw new Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===ph){const a=cs.fromBER(this.responseBytes.response.valueBlock.valueHexView);return e!==null&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw new Error("Unknown ResponseBytes type: ".concat(((s=this.responseBytes)===null||s===void 0?void 0:s.responseType)||"Unknown"))}}Ro.CLASS_NAME="OCSPResponse";const Pa="type",zs="attributes",lh="encodedValue",xS=[zs];class Ue extends _{constructor(e={}){super(),this.type=d(e,Pa,Ue.defaultValues(Pa)),this.attributes=d(e,zs,Ue.defaultValues(zs)),this.encodedValue=d(e,lh,Ue.defaultValues(lh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pa:return-1;case zs:return[];case lh:return Ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pa:return t===Ue.defaultValues(Pa);case zs:return t.length===0;case lh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new L({name:t.blockName||E,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new me({name:t.attributes||E,value:Oe.schema()})]})}fromSchema(e){G(e,xS);const t=z(e,e,Ue.schema({names:{tagNumber:this.type,attributes:zs}}));q.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=Be.toArrayBuffer(t.result.valueBeforeDecodeView);const s=new Uint8Array(this.encodedValue);if(s[0]=49,!(zs in t.result)){if(this.type===0)throw new Error("Wrong structure of SignedUnsignedAttributes");return}this.attributes=Array.from(t.result.attributes,a=>new Oe({schema:a}))}toSchema(){if(Ue.compareWithDefault(Pa,this.type)||Ue.compareWithDefault(zs,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new L({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(Ue.compareWithDefault(Pa,this.type)||Ue.compareWithDefault(zs,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}Ue.CLASS_NAME="SignedAndUnsignedAttributes";const wo="version",Vn="sid",yo="digestAlgorithm",ra="signedAttrs",vo="signatureAlgorithm",tc="signature",aa="unsignedAttrs",Ca="SignerInfo",Qf="".concat(Ca,".").concat(wo),sc="".concat(Ca,".").concat(Vn),Zf="".concat(Ca,".").concat(yo),xh="".concat(Ca,".").concat(ra),ep="".concat(Ca,".").concat(vo),tp="".concat(Ca,".").concat(tc),Bh="".concat(Ca,".").concat(aa),BS=[Qf,sc,Zf,xh,ep,tp,Bh];class He extends _{constructor(e={}){super(),this.version=d(e,wo,He.defaultValues(wo)),this.sid=d(e,Vn,He.defaultValues(Vn)),this.digestAlgorithm=d(e,yo,He.defaultValues(yo)),ra in e&&(this.signedAttrs=d(e,ra,He.defaultValues(ra))),this.signatureAlgorithm=d(e,vo,He.defaultValues(vo)),this.signature=d(e,tc,He.defaultValues(tc)),aa in e&&(this.unsignedAttrs=d(e,aa,He.defaultValues(aa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wo:return 0;case Vn:return new le;case yo:return new M;case ra:return new Ue({type:0});case vo:return new M;case tc:return new X;case aa:return new Ue({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wo:return He.defaultValues(wo)===t;case Vn:return t instanceof le;case yo:return t instanceof M?t.isEqual(He.defaultValues(yo)):!1;case ra:return Ue.compareWithDefault("type",t.type)&&Ue.compareWithDefault("attributes",t.attributes)&&Ue.compareWithDefault("encodedValue",t.encodedValue);case vo:return t instanceof M?t.isEqual(He.defaultValues(vo)):!1;case tc:case aa:return Ue.compareWithDefault("type",t.type)&&Ue.compareWithDefault("attributes",t.attributes)&&Ue.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:Ca,value:[new H({name:t.version||Qf}),new je({value:[Ze.schema(t.sidSchema||{names:{blockName:sc}}),new je({value:[new L({optional:!0,name:t.sid||sc,idBlock:{tagClass:3,tagNumber:0},value:[new X]}),new ue({optional:!0,name:t.sid||sc,idBlock:{tagClass:3,tagNumber:0}})]})]}),M.schema(t.digestAlgorithm||{names:{blockName:Zf}}),Ue.schema(t.signedAttrs||{names:{blockName:xh,tagNumber:0}}),M.schema(t.signatureAlgorithm||{names:{blockName:ep}}),new X({name:t.signature||tp}),Ue.schema(t.unsignedAttrs||{names:{blockName:Bh,tagNumber:1}})]})}fromSchema(e){G(e,BS);const t=z(e,e,He.schema());q.assertSchema(t,this.className),this.version=t.result[Qf].valueBlock.valueDec;const s=t.result[sc];s.idBlock.tagClass===1?this.sid=new Ze({schema:s}):this.sid=s,this.digestAlgorithm=new M({schema:t.result[Zf]}),xh in t.result&&(this.signedAttrs=new Ue({type:0,schema:t.result[xh]})),this.signatureAlgorithm=new M({schema:t.result[ep]}),this.signature=t.result[tp],Bh in t.result&&(this.unsignedAttrs=new Ue({type:1,schema:t.result[Bh]}))}toSchema(){if(He.compareWithDefault(Vn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new H({value:this.version})),this.sid instanceof Ze?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&He.compareWithDefault(ra,this.signedAttrs)===!1&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&He.compareWithDefault(aa,this.unsignedAttrs)===!1&&e.push(this.unsignedAttrs.toSchema()),new O({value:e})}toJSON(){if(He.compareWithDefault(Vn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof le||(e.sid=this.sid.toJSON()),this.signedAttrs&&He.compareWithDefault(ra,this.signedAttrs)===!1&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&He.compareWithDefault(aa,this.unsignedAttrs)===!1&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}He.CLASS_NAME="SignerInfo";const rc="version",ac="policy",nc="messageImprint",ic="serialNumber",oc="genTime",xn="ordering",Bn="nonce",bo="accuracy",So="tsa",Ao="extensions",ks="TSTInfo",sp="".concat(ks,".").concat(rc),rp="".concat(ks,".").concat(ac),ap="".concat(ks,".").concat(nc),np="".concat(ks,".").concat(ic),ip="".concat(ks,".").concat(oc),Oh="".concat(ks,".").concat(bo),Ph="".concat(ks,".").concat(xn),Dh="".concat(ks,".").concat(Bn),Th="".concat(ks,".").concat(So),Rh="".concat(ks,".").concat(Ao),OS=[sp,rp,ap,np,ip,Oh,Ph,Dh,Th,Rh];class Vt extends _{constructor(e={}){super(),this.version=d(e,rc,Vt.defaultValues(rc)),this.policy=d(e,ac,Vt.defaultValues(ac)),this.messageImprint=d(e,nc,Vt.defaultValues(nc)),this.serialNumber=d(e,ic,Vt.defaultValues(ic)),this.genTime=d(e,oc,Vt.defaultValues(oc)),bo in e&&(this.accuracy=d(e,bo,Vt.defaultValues(bo))),xn in e&&(this.ordering=d(e,xn,Vt.defaultValues(xn))),Bn in e&&(this.nonce=d(e,Bn,Vt.defaultValues(Bn))),So in e&&(this.tsa=d(e,So,Vt.defaultValues(So))),Ao in e&&(this.extensions=d(e,Ao,Vt.defaultValues(Ao))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rc:return 0;case ac:return E;case nc:return new Nt;case ic:return new H;case oc:return new Date(0,0,0);case bo:return new Qt;case xn:return!1;case Bn:return new H;case So:return new Se;case Ao:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case rc:case ac:case oc:case xn:return t===Vt.defaultValues(xn);case nc:return Nt.compareWithDefault(Tn,t.hashAlgorithm)&&Nt.compareWithDefault(Rn,t.hashedMessage);case ic:case Bn:return t.isEqual(Vt.defaultValues(Bn));case bo:return Qt.compareWithDefault(Nr,t.seconds)&&Qt.compareWithDefault(Er,t.millis)&&Qt.compareWithDefault(kr,t.micros);case So:return Se.compareWithDefault(wu,t.type)&&Se.compareWithDefault(yu,t.value);case Ao:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||ks,value:[new H({name:t.version||sp}),new ae({name:t.policy||rp}),Nt.schema(t.messageImprint||{names:{blockName:ap}}),new H({name:t.serialNumber||np}),new $e({name:t.genTime||ip}),Qt.schema(t.accuracy||{names:{blockName:Oh}}),new Ia({name:t.ordering||Ph,optional:!0}),new H({name:t.nonce||Dh,optional:!0}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Se.schema(t.tsa||{names:{blockName:Th}})]}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new me({name:t.extensions||Rh,value:_e.schema(t.extension||{})})]})]})}fromSchema(e){G(e,OS);const t=z(e,e,Vt.schema());q.assertSchema(t,this.className),this.version=t.result[sp].valueBlock.valueDec,this.policy=t.result[rp].valueBlock.toString(),this.messageImprint=new Nt({schema:t.result[ap]}),this.serialNumber=t.result[np],this.genTime=t.result[ip].toDate(),Oh in t.result&&(this.accuracy=new Qt({schema:t.result[Oh]})),Ph in t.result&&(this.ordering=t.result[Ph].valueBlock.value),Dh in t.result&&(this.nonce=t.result[Dh]),Th in t.result&&(this.tsa=new Se({schema:t.result[Th]})),Rh in t.result&&(this.extensions=Array.from(t.result[Rh],s=>new _e({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(new ae({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new $e({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),this.ordering!==void 0&&e.push(new Ia({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),this.ordering!==void 0&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async verify(e,t=fe(!0)){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const s=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),n=await t.digest(a.name,new Uint8Array(s));return Be.isEqual(n,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}Vt.CLASS_NAME="TSTInfo";const No="version",uc="digestAlgorithms",lc="encapContentInfo",Eo="certificates",ko="crls",cc="signerInfos",pu="ocsps",ei="SignedData",op="".concat(ei,".").concat(No),Uh="".concat(ei,".").concat(uc),up="".concat(ei,".").concat(lc),Lh="".concat(ei,".").concat(Eo),jh="".concat(ei,".").concat(ko),$h="".concat(ei,".").concat(cc),PS=[op,Uh,up,Lh,jh,$h];class Ct extends Error{constructor({message:e,code:t=0,date:s=new Date,signatureVerified:a=null,signerCertificate:n=null,signerCertificateVerified:o=null,timestampSerial:u=null,certificatePath:h=[]}){super(e),this.name="SignedDataVerifyError",this.date=s,this.code=t,this.timestampSerial=u,this.signatureVerified=a,this.signerCertificate=n,this.signerCertificateVerified=o,this.certificatePath=h}}class yt extends _{constructor(e={}){super(),this.version=d(e,No,yt.defaultValues(No)),this.digestAlgorithms=d(e,uc,yt.defaultValues(uc)),this.encapContentInfo=d(e,lc,yt.defaultValues(lc)),Eo in e&&(this.certificates=d(e,Eo,yt.defaultValues(Eo))),ko in e&&(this.crls=d(e,ko,yt.defaultValues(ko))),pu in e&&(this.ocsps=d(e,pu,yt.defaultValues(pu))),this.signerInfos=d(e,cc,yt.defaultValues(cc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case No:return 0;case uc:return[];case lc:return new Gt;case Eo:return[];case ko:return[];case pu:return[];case cc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case No:return t===yt.defaultValues(No);case lc:return Gt.compareWithDefault("eContentType",t.eContentType)&&Gt.compareWithDefault("eContent",t.eContent);case uc:case Eo:case ko:case pu:case cc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return t.optional===void 0&&(t.optional=!1),new O({name:t.blockName||ei,optional:t.optional,value:[new H({name:t.version||op}),new nt({value:[new me({name:t.digestAlgorithms||Uh,value:M.schema()})]}),Gt.schema(t.encapContentInfo||{names:{blockName:up}}),new L({name:t.certificates||Lh,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Rs.schema().valueBlock.value}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:lr.schema(t.crls||{names:{crls:jh}}).valueBlock.value}),new nt({value:[new me({name:t.signerInfos||$h,value:He.schema()})]})]})}fromSchema(e){G(e,PS);const t=z(e,e,yt.schema());if(q.assertSchema(t,this.className),this.version=t.result[op].valueBlock.valueDec,Uh in t.result&&(this.digestAlgorithms=Array.from(t.result[Uh],s=>new M({schema:s}))),this.encapContentInfo=new Gt({schema:t.result[up]}),Lh in t.result){const s=new Rs({schema:new nt({value:t.result[Lh].valueBlock.value})});this.certificates=s.certificates.slice(0)}jh in t.result&&(this.crls=Array.from(t.result[jh],s=>s.idBlock.tagClass===1?new rt({schema:s}):(s.idBlock.tagClass=1,s.idBlock.tagNumber=16,new ur({schema:s})))),$h in t.result&&(this.signerInfos=Array.from(t.result[$h],s=>new He({schema:s})))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof Na)||this.crls&&this.crls.length&&this.crls.some(s=>s instanceof ur)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof ts)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof rr)||this.signerInfos.some(s=>s.version===3)||this.encapContentInfo.eContentType!==yt.ID_DATA?this.version=3:this.version=1,t.push(new H({value:this.version})),t.push(new nt({value:Array.from(this.digestAlgorithms,s=>s.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const s=new Rs({certificates:this.certificates}).toSchema();t.push(new L({idBlock:{tagClass:3,tagNumber:0},value:s.valueBlock.value}))}return this.crls&&t.push(new L({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,s=>{if(s instanceof ur){const a=s.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return s.toSchema(e)})})),t.push(new nt({value:Array.from(this.signerInfos,s=>s.toSchema())})),new O({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}async verify({signer:e=-1,data:t=Ye,trustedCerts:s=[],checkDate:a=new Date,checkChain:n=!1,passedWhenNotRevValues:o=!1,extendedMode:u=!1,findOrigin:h=null,findIssuer:c=null}={},i=fe(!0)){let f=null,m=null;try{let b=Ye,v=E,w=[];const y=this.signerInfos[e];if(!y)throw new Ct({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new Ct({date:a,code:2,message:"No certificates attached to this signed data"});if(y.sid instanceof Ze){for(const I of this.certificates)if(I instanceof be&&I.issuer.isEqual(y.sid.issuer)&&I.serialNumber.isEqual(y.sid.serialNumber)){f=I;break}}else{const I=y.sid,P=I.idBlock.isConstructed?I.valueBlock.value[0].valueBlock.valueHex:I.valueBlock.valueHex;for(const x of this.certificates){if(!(x instanceof be))continue;const T=await i.digest({name:"sha-1"},x.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(yc(T,P)){f=x;break}}}if(!f)throw new Ct({date:a,code:3,message:"Unable to find signer certificate"});if(this.encapContentInfo.eContentType===Uv){if(!this.encapContentInfo.eContent)throw new Ct({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0});let I;try{I=Vt.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch(P){throw new Ct({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0})}if(a=I.genTime,m=I.serialNumber.valueBlock.valueHexView.slice(),t.byteLength===0)throw new Ct({date:a,code:4,message:"Missed detached data input array"});if(!await I.verify({data:t},i))throw new Ct({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0})}if(n){const I=this.certificates.filter(B=>B instanceof be&&!!Dw(B,f)),P={checkDate:a,certs:I,trustedCerts:s};c&&(P.findIssuer=c),h&&(P.findOrigin=h);const x=new vm(P);if(x.certs.push(f),this.crls)for(const B of this.crls)"thisUpdate"in B?x.crls.push(B):B.otherRevInfoFormat===ph&&x.ocsps.push(new cs({schema:B.otherRevInfo}));this.ocsps&&x.ocsps.push(...this.ocsps);const T=await x.verify({passedWhenNotRevValues:o},i).catch(B=>{throw new Ct({date:a,code:5,message:"Validation of signer's certificate failed with error: ".concat(B instanceof Object?B.resultMessage:B),signerCertificate:f,signerCertificateVerified:!1})});if(T.certificatePath&&(w=T.certificatePath),!T.result)throw new Ct({date:a,code:5,message:"Validation of signer's certificate failed: ".concat(T.resultMessage),signerCertificate:f,signerCertificateVerified:!1})}const k=i.getAlgorithmByOID(y.digestAlgorithm.algorithmId);if(!("name"in k))throw new Ct({date:a,code:7,message:"Unsupported signature algorithm: ".concat(y.digestAlgorithm.algorithmId),signerCertificate:f,signerCertificateVerified:!0});v=k.name;const p=this.encapContentInfo.eContent;if(p)p.idBlock.tagClass===1&&p.idBlock.tagNumber===4?t=p.getValue():t=p.valueBlock.valueBeforeDecodeView;else if(t.byteLength===0)throw new Ct({date:a,code:8,message:"Missed detached data input array",signerCertificate:f,signerCertificateVerified:!0});if(y.signedAttrs){let I=!1,P=!1;for(const x of y.signedAttrs.attributes)if(x.type==="1.2.840.113549.1.9.3"&&(I=!0),x.type==="1.2.840.113549.1.9.4"&&(P=!0,b=x.values[0].valueBlock.valueHex),I&&P)break;if(I===!1)throw new Ct({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:f,signerCertificateVerified:!0});if(P===!1)throw new Ct({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:f,signerCertificateVerified:!0})}if(y.signedAttrs){const I=await i.digest(v,new Uint8Array(t));if(!yc(I,b))throw new Ct({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0});t=y.signedAttrs.encodedValue}const S=y.signatureAlgorithm.algorithmId==="1.2.840.113549.1.1.1"?await i.verifyWithPublicKey(t,y.signature,f.subjectPublicKeyInfo,y.signatureAlgorithm,v):await i.verifyWithPublicKey(t,y.signature,f.subjectPublicKeyInfo,y.signatureAlgorithm);return u?{date:a,code:14,message:E,signatureVerified:S,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0,certificatePath:w}:S}catch(b){throw b instanceof Ct?b:new Ct({date:a,code:15,message:"Error during verification: ".concat(b instanceof Error?b.message:b),signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0})}}async sign(e,t,s="SHA-1",a=Ye,n=fe(!0)){var o;if(!e)throw new Error("Need to provide a private key for signing");const u=this.signerInfos[t];if(!u)throw new RangeError("SignerInfo index is out of range");!(!((o=u.signedAttrs)===null||o===void 0)&&o.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(s=e.algorithm.hash.name);const h=n.getOIDByAlgorithm({name:s},!0,"hashAlgorithm");this.digestAlgorithms.filter(m=>m.algorithmId===h).length===0&&this.digestAlgorithms.push(new M({algorithmId:h,algorithmParams:new at})),u.digestAlgorithm=new M({algorithmId:h,algorithmParams:new at});const c=await n.getSignatureParameters(e,s),i=c.parameters;if(u.signatureAlgorithm=c.signatureAlgorithm,u.signedAttrs)if(u.signedAttrs.encodedValue.byteLength!==0)a=u.signedAttrs.encodedValue;else{a=u.signedAttrs.toSchema().toBER();const m=Be.toUint8Array(a);m[0]=49}else{const m=this.encapContentInfo.eContent;if(m)m.idBlock.tagClass===1&&m.idBlock.tagNumber===4?a=m.getValue():a=m.valueBlock.valueBeforeDecodeView;else if(a.byteLength===0)throw new Error("Missed detached data input array")}const f=await n.signWithPrivateKey(a,e,i);u.signature=new X({valueHex:f})}}yt.CLASS_NAME="SignedData",yt.ID_DATA=Bp;const On="version",Pn="authSafe",Xs="macData",du="parsedValue",DS=[On,Pn,Xs];class la extends _{constructor(e={}){super(),this.version=d(e,On,la.defaultValues(On)),this.authSafe=d(e,Pn,la.defaultValues(Pn)),Xs in e&&(this.macData=d(e,Xs,la.defaultValues(Xs))),du in e&&(this.parsedValue=d(e,du,la.defaultValues(du))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case On:return 3;case Pn:return new Ie;case Xs:return new Lt;case du:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case On:return t===la.defaultValues(e);case Pn:return Ie.compareWithDefault("contentType",t.contentType)&&Ie.compareWithDefault("content",t.content);case Xs:return Lt.compareWithDefault("mac",t.mac)&&Lt.compareWithDefault("macSalt",t.macSalt)&&Lt.compareWithDefault("iterations",t.iterations);case du:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.version||On}),Ie.schema(t.authSafe||{names:{blockName:Pn}}),Lt.schema(t.macData||{names:{blockName:Xs,optional:!0}})]})}fromSchema(e){G(e,DS);const t=z(e,e,la.schema({names:{version:On,authSafe:{names:{blockName:Pn}},macData:{names:{blockName:Xs}}}}));q.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new Ie({schema:t.result.authSafe}),Xs in t.result&&(this.macData=new Lt({schema:t.result.macData}))}toSchema(){const e=[new H({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new O({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=fe(!0)){if(Ne.assert(e,"parameters","object"),!this.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(ve.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),ve.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new ve("iterations");ve.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),ve.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),ve.assertEmpty(e.password,"password");const s=new ArrayBuffer(64),a=new Uint8Array(s);t.getRandomValues(a);const n=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new Ie({contentType:Ie.DATA,content:new X({valueHex:n})});const o=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:s,iterationCount:e.iterations,contentToStamp:n});this.macData=new Lt({mac:new ms({digestAlgorithm:new M({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new X({valueHex:o})}),macSalt:new X({valueHex:s}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new ve("signingCertificate");ve.assertEmpty(e.privateKey,"privateKey"),ve.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const s=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new yt({version:1,encapContentInfo:new Gt({eContentType:"1.2.840.113549.1.7.1",eContent:new X({valueHex:s})}),certificates:[e.signingCertificate]}),n=await t.digest({name:e.hashAlgorithm},new Uint8Array(s)),o=[];o.push(new Oe({type:"1.2.840.113549.1.9.3",values:[new ae({value:"1.2.840.113549.1.7.1"})]})),o.push(new Oe({type:"1.2.840.113549.1.9.5",values:[new Pf({valueDate:new Date})]})),o.push(new Oe({type:"1.2.840.113549.1.9.4",values:[new X({valueHex:n})]})),a.signerInfos.push(new He({version:1,sid:new Ze({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new Ue({type:0,attributes:o})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new Ie({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw new Error('Parameter "integrityMode" has unknown value: '.concat(this.parsedValue.integrityMode))}}async parseInternalValues(e,t=fe(!0)){switch(Ne.assert(e,"parameters","object"),e.checkIntegrity===void 0&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case Ie.DATA:{ve.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,Ne.assert(this.authSafe.content,"authSafe.content",X);const s=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=Xn.fromBER(s),e.checkIntegrity){if(!this.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:Be.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:s,signatureToVerify:Be.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case Ie.SIGNED_DATA:{this.parsedValue.integrityMode=1;const s=new yt({schema:this.authSafe.content}),a=s.encapContentInfo.eContent;ve.assert(a,"eContent","cmsSigned.encapContentInfo"),Ne.assert(a,"eContent",X);const n=a.getValue();if(this.parsedValue.authenticatedSafe=Xn.fromBER(n),!await s.verify({signer:0,checkChain:!1},t))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error('Incorrect value for "this.authSafe.contentType": '.concat(this.authSafe.contentType))}}}la.CLASS_NAME="PFX";const Io="status",na="statusStrings",ia="failInfo",TS=[Io,na,ia];var dg;(function(r){r[r.granted=0]="granted",r[r.grantedWithMods=1]="grantedWithMods",r[r.rejection=2]="rejection",r[r.waiting=3]="waiting",r[r.revocationWarning=4]="revocationWarning",r[r.revocationNotification=5]="revocationNotification"})(dg||(dg={}));class hs extends _{constructor(e={}){super(),this.status=d(e,Io,hs.defaultValues(Io)),na in e&&(this.statusStrings=d(e,na,hs.defaultValues(na))),ia in e&&(this.failInfo=d(e,ia,hs.defaultValues(ia))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Io:return 2;case na:return[];case ia:return new ye;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Io:return t===hs.defaultValues(e);case na:return t.length===0;case ia:return t.isEqual(hs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||E,value:[new H({name:t.status||E}),new O({optional:!0,value:[new me({name:t.statusStrings||E,value:new _h})]}),new ye({name:t.failInfo||E,optional:!0})]})}fromSchema(e){G(e,TS);const t=z(e,e,hs.schema({names:{status:Io,statusStrings:na,failInfo:ia}}));q.assertSchema(t,this.className);const s=t.result.status;if(s.valueBlock.isHexOnly===!0||s.valueBlock.valueDec<0||s.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=s.valueBlock.valueDec,na in t.result&&(this.statusStrings=t.result.statusStrings),ia in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){const e=[];return e.push(new H({value:this.status})),this.statusStrings&&e.push(new O({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new O({value:e})}toJSON(){const e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,t=>t.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}hs.CLASS_NAME="PKIStatusInfo";const hc="version",mc="messageImprint",Co="reqPolicy",Vo="nonce",Ys="certReq",xo="extensions",ti="TimeStampReq",lp="".concat(ti,".").concat(hc),cp="".concat(ti,".").concat(mc),Kh="".concat(ti,".").concat(Co),Mh="".concat(ti,".").concat(Vo),Hh="".concat(ti,".").concat(Ys),Fh="".concat(ti,".").concat(xo),RS=[lp,cp,Kh,Mh,Hh,Fh];class zt extends _{constructor(e={}){super(),this.version=d(e,hc,zt.defaultValues(hc)),this.messageImprint=d(e,mc,zt.defaultValues(mc)),Co in e&&(this.reqPolicy=d(e,Co,zt.defaultValues(Co))),Vo in e&&(this.nonce=d(e,Vo,zt.defaultValues(Vo))),Ys in e&&(this.certReq=d(e,Ys,zt.defaultValues(Ys))),xo in e&&(this.extensions=d(e,xo,zt.defaultValues(xo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hc:return 0;case mc:return new Nt;case Co:return E;case Vo:return new H;case Ys:return!1;case xo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hc:case Co:case Ys:return t===zt.defaultValues(e);case mc:return Nt.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Nt.compareWithDefault("hashedMessage",t.hashedMessage);case Vo:return t.isEqual(zt.defaultValues(e));case xo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||ti,value:[new H({name:t.version||lp}),Nt.schema(t.messageImprint||{names:{blockName:cp}}),new ae({name:t.reqPolicy||Kh,optional:!0}),new H({name:t.nonce||Mh,optional:!0}),new Ia({name:t.certReq||Hh,optional:!0}),new L({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:t.extensions||Fh,value:_e.schema()})]})]})}fromSchema(e){G(e,RS);const t=z(e,e,zt.schema());q.assertSchema(t,this.className),this.version=t.result[lp].valueBlock.valueDec,this.messageImprint=new Nt({schema:t.result[cp]}),Kh in t.result&&(this.reqPolicy=t.result[Kh].valueBlock.toString()),Mh in t.result&&(this.nonce=t.result[Mh]),Hh in t.result&&(this.certReq=t.result[Hh].valueBlock.value),Fh in t.result&&(this.extensions=Array.from(t.result[Fh],s=>new _e({schema:s})))}toSchema(){const e=[];return e.push(new H({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new ae({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),Ys in this&&zt.compareWithDefault(Ys,this.certReq)===!1&&e.push(new Ia({value:this.certReq})),this.extensions&&e.push(new L({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,t=>t.toSchema())})),new O({value:e})}toJSON(){const e={version:this.version,messageImprint:this.messageImprint.toJSON()};return this.reqPolicy!==void 0&&(e.reqPolicy=this.reqPolicy),this.nonce!==void 0&&(e.nonce=this.nonce.toJSON()),this.certReq!==void 0&&zt.compareWithDefault(Ys,this.certReq)===!1&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}}zt.CLASS_NAME="TimeStampReq";const Bo="status",Oo="timeStampToken",Mp="TimeStampResp",hp="".concat(Mp,".").concat(Bo),Jh="".concat(Mp,".").concat(Oo),US=[hp,Jh];class gc extends _{constructor(e={}){super(),this.status=d(e,Bo,gc.defaultValues(Bo)),Oo in e&&(this.timeStampToken=d(e,Oo,gc.defaultValues(Oo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bo:return new hs;case Oo:return new Ie;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bo:return hs.compareWithDefault(Bo,t.status)&&!("statusStrings"in t)&&!("failInfo"in t);case Oo:return t.contentType===E&&t.content instanceof le;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||Mp,value:[hs.schema(t.status||{names:{blockName:hp}}),Ie.schema(t.timeStampToken||{names:{blockName:Jh,optional:!0}})]})}fromSchema(e){G(e,US);const t=z(e,e,gc.schema());q.assertSchema(t,this.className),this.status=new hs({schema:t.result[hp]}),Jh in t.result&&(this.timeStampToken=new Ie({schema:t.result[Jh]}))}toSchema(){const e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new O({value:e})}toJSON(){const e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,s=fe(!0)){return this.assertContentType(),new yt({schema:this.timeStampToken.content}).sign(e,0,t,void 0,s)}async verify(e={signer:0,trustedCerts:[],data:Ye},t=fe(!0)){return this.assertContentType(),new yt({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==kw)throw new Error("Wrong format of timeStampToken: ".concat(this.timeStampToken.contentType))}}gc.CLASS_NAME="TimeStampResp";function LS(){if(typeof self<"u"){if("crypto"in self){let r="webcrypto";"webkitSubtle"in self.crypto&&(r="safari"),Zd(r,new kc({name:r,crypto}))}}else if(typeof crypto<"u"&&"webcrypto"in crypto){const r="NodeJS ^15",e=crypto.webcrypto;Zd(r,new kc({name:r,crypto:e}))}}LS();function jS(r){return String.fromCharCode(...r)}function Rw(r){return Uint8Array.from(r,e=>e.charCodeAt(0))}function $S(r){return Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")}function Ls(r){return Rw(atob(r))}function Hp(r){const e=r.replace(/-----BEGIN ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/-----END ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/\n/g,"");return Ls(e)}var KS=Object.defineProperty,MS=Object.defineProperties,HS=Object.getOwnPropertyDescriptors,gg=Object.getOwnPropertySymbols,FS=Object.prototype.hasOwnProperty,JS=Object.prototype.propertyIsEnumerable,wg=(r,e,t)=>e in r?KS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mp=(r,e)=>{for(var t in e||(e={}))FS.call(e,t)&&wg(r,t,e[t]);if(gg)for(var t of gg(e))JS.call(e,t)&&wg(r,t,e[t]);return r},yg=(r,e)=>MS(r,HS(e));async function Fp(r,e,t={}){return await self.crypto.subtle.decrypt(mp({name:"AES-GCM"},t),e,r)}async function qS(r,e){return await self.crypto.subtle.decrypt({name:"RSA-OAEP"},e,r)}async function Uw(r){return await self.crypto.subtle.importKey("raw",r,{name:"AES-GCM",length:128},!0,["decrypt","encrypt"])}async function WS(r,e){return await self.crypto.subtle.importKey("spki",r,{name:"RSASSA-PKCS1-v1_5",hash:e},!0,["verify"])}async function _S(r){return await self.crypto.subtle.importKey("pkcs8",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])}async function GS(r){return new Uint8Array(await self.crypto.subtle.exportKey("raw",r))}async function zS(r){const e=await self.crypto.subtle.digest("SHA-256",r);return $S(new Uint8Array(e))}async function XS(r,e){const t=new by(r),s=await WS(Hp(e),t.signatureAlgorithm.hash.name);return t.verify({publicKey:s},YS())}function YS(){return yg(mp({},self.crypto),{subtle:yg(mp({},self.crypto.subtle),{async verify(r,e,t,s){return self.crypto.subtle.verify(r,e,new Uint8Array(t),new Uint8Array(s))}})})}async function QS(r,e,t){const s=Ie.fromBER(e),a=new yt({schema:s.content}),n=a.signerInfos[0].sid.issuer.typesAndValues.find(({type:h})=>h==="2.5.4.3").value.valueBlock.value,o=t.find(({userId:h})=>h===n);if(o===void 0)throw new Error("Signer not found in the users array");const u=be.fromBER(Hp(o.certificate));return await a.verify({signer:0,trustedCerts:[u],data:r,checkChain:!0},eA())}class ZS extends kc{verify(e,t,s,a){return super.verify(e,t,s,new Uint8Array(a))}}function eA(){return new ZS({crypto:self.crypto})}var tA=Object.defineProperty,vg=Object.getOwnPropertySymbols,sA=Object.prototype.hasOwnProperty,rA=Object.prototype.propertyIsEnumerable,bg=(r,e,t)=>e in r?tA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,aA=(r,e)=>{for(var t in e||(e={}))sA.call(e,t)&&bg(r,t,e[t]);if(vg)for(var t of vg(e))rA.call(e,t)&&bg(r,t,e[t]);return r};async function nA(r,e){ht.debug("Decrypting private key",{privateKeyInfo:r,mnemonic:e});const t=await Promise.all([await Cf(e,r.salt,{hash:"SHA-256",iterations:6e5}),await Cf(e,r.salt,{hash:"SHA-1",iterations:1024}),await Cf(e,r.salt,{hash:"SHA-1",iterations:6e5})]);for(const s of t)try{const a=await Fp(r.encryptedPrivateKey,s,{iv:r.iv,tagLength:128}),n=atob(jS(new Uint8Array(a)));return _S(Hp(n))}catch(a){}throw new Error("Failed to decrypt private key")}async function Cf(r,e,t){const s=await crypto.subtle.importKey("raw",new TextEncoder().encode(r.replaceAll(" ","")),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey(aA({name:"PBKDF2",salt:e},t),s,{name:"AES-GCM",length:256},!0,["decrypt","encrypt"])}const Sg="apps/end_to_end_encryption/api/v2",Lw={PrivateKey:Sg+"/private-key",ServerKey:Sg+"/server-key"};async function iA(){const r=(await Ig.get(Cg(Lw.PrivateKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["private-key"],[e,t,s]=r.split("|");return{encryptedPrivateKey:Ls(e),iv:Ls(t),salt:Ls(s)}}async function oA(){return await(await Ig.get(Cg(Lw.ServerKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["public-key"]}const uA={name:"AlertCircleOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var lA=function(){var r=this,e=r._self._c;return e("span",r._b({staticClass:"material-design-icon alert-circle-outline-icon",attrs:{"aria-hidden":r.title?null:"true","aria-label":r.title,role:"img"},on:{click:function(t){return r.$emit("click",t)}}},"span",r.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:r.fillColor,width:r.size,height:r.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z"}},[r.title?e("title",[r._v(r._s(r.title))]):r._e()])])])},cA=[],hA=pm(uA,lA,cA,!1,null,null);const mA=hA.exports,fA={name:"CheckIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var pA=function(){var r=this,e=r._self._c;return e("span",r._b({staticClass:"material-design-icon check-icon",attrs:{"aria-hidden":r.title?null:"true","aria-label":r.title,role:"img"},on:{click:function(t){return r.$emit("click",t)}}},"span",r.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:r.fillColor,width:r.size,height:r.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}},[r.title?e("title",[r._v(r._s(r.title))]):r._e()])])])},dA=[],gA=pm(fA,pA,dA,!1,null,null);const wA=gA.exports,yA={name:"NcInputField",components:{NcButton:ey,AlertCircle:mA,Check:wA},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:{value:{type:[String,Number],default:void 0},modelValue:{type:[String,Number],default:void 0},type:{type:String,default:"text",validator:r=>["text","password","email","tel","url","search","number"].includes(r)},label:{type:String,default:void 0},labelOutside:{type:Boolean,default:!1},placeholder:{type:String,default:void 0},showTrailingButton:{type:Boolean,default:!1},trailingButtonLabel:{type:String,default:""},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1},helperText:{type:String,default:""},disabled:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},inputClass:{type:[Object,String],default:""}},emits:["update:value","update:modelValue","update:model-value","trailing-button-click"],setup(){const r=xg("value","update:value",!0);return{isLegacy32:ed,model:r}},computed:{computedId(){return this.$attrs.id&&this.$attrs.id!==""?this.$attrs.id:this.inputName},inputName(){return"input"+sy()},hasTrailingIcon(){return this.success},computedPlaceholder(){if(this.placeholder)return this.placeholder;if(this.label)return ed?this.label:""},isValidLabel(){const r=this.label||this.labelOutside;return r||ty.warn("You need to add a label to the NcInputField component. Either use the prop label or use an external one, as per the example in the documentation."),r},ariaDescribedby(){const r=[];return this.helperText.length>0&&r.push("".concat(this.inputName,"-helper-text")),this.$attrs["aria-describedby"]&&r.push(this.$attrs["aria-describedby"]),r.join(" ")||null}},methods:{focus(){this.$refs.input.focus()},select(){this.$refs.input.select()},handleInput(r){const e=this.type==="number"&&typeof this.model=="number"?parseFloat(r.target.value,10):r.target.value;this.model=e},handleTrailingButtonClick(r){this.$emit("trailing-button-click",r)}}};var vA=function(){var t;var r=this,e=r._self._c;return e("div",{staticClass:"input-field",class:{"input-field--disabled":r.disabled,"input-field--error":r.error,"input-field--label-outside":r.labelOutside||!r.isValidLabel,"input-field--leading-icon":!!r.$scopedSlots.icon||!!r.$scopedSlots.default||!!r.$slots.default,"input-field--success":r.success,"input-field--trailing-icon":r.showTrailingButton||r.hasTrailingIcon,"input-field--pill":r.pill,"input-field--legacy":r.isLegacy32}},[e("div",{staticClass:"input-field__main-wrapper"},[e("input",r._g(r._b({ref:"input",staticClass:"input-field__input",class:[r.inputClass,{"input-field__input--success":r.success,"input-field__input--error":r.error}],attrs:{id:r.computedId,type:r.type,disabled:r.disabled,placeholder:r.computedPlaceholder,"aria-describedby":r.ariaDescribedby,"aria-live":"polite"},domProps:{value:(t=r.model)==null?void 0:t.toString()},on:{input:r.handleInput}},"input",r.$attrs,!1),r.$listeners)),!r.labelOutside&&r.isValidLabel?e("label",{staticClass:"input-field__label",attrs:{for:r.computedId}},[r._v(" "+r._s(r.label)+" ")]):r._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:!!r.$scopedSlots.icon||!!r.$scopedSlots.default||!!r.$slots.default,expression:"!!$scopedSlots.icon || !!$scopedSlots.default || !!$slots.default"}],staticClass:"input-field__icon input-field__icon--leading"},[r._t("icon",function(){return[r._t("default")]})],2),r.showTrailingButton?e("NcButton",{staticClass:"input-field__trailing-button",attrs:{"aria-label":r.trailingButtonLabel,disabled:r.disabled,variant:"tertiary-no-background"},on:{click:r.handleTrailingButtonClick},scopedSlots:r._u([{key:"icon",fn:function(){return[r._t("trailing-button-icon")]},proxy:!0}],null,!0)}):r.success||r.error?e("div",{staticClass:"input-field__icon input-field__icon--trailing"},[r.success?e("Check",{staticStyle:{color:"var(--color-success-text)"},attrs:{size:20}}):r.error?e("AlertCircle",{staticStyle:{color:"var(--color-error-text)"},attrs:{size:20}}):r._e()],1):r._e()],1),r.helperText.length>0?e("p",{staticClass:"input-field__helper-text-message",class:{"input-field__helper-text-message--error":r.error,"input-field__helper-text-message--success":r.success},attrs:{id:"".concat(r.inputName,"-helper-text")}},[r.success?e("Check",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):r.error?e("AlertCircle",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):r._e(),r._v(" "+r._s(r.helperText)+" ")],1):r._e()])},bA=[],SA=pm(yA,vA,bA,!1,null,"ab8d7671");const fp=SA.exports;ry(ny,ay);const AA=new Set(Object.keys(fp.props)),NA={name:"NcTextField",components:{NcIconSvgWrapper:iy,NcInputField:fp},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:Cs(kt({" ":{}},fp.props),{trailingButtonLabel:{type:String,default:""},trailingButtonIcon:{type:String,default:"close",validator:r=>["close","arrowEnd","arrowRight","undo"].includes(r)}}),emits:["update:value","update:modelValue","update:model-value"],setup(){return{model:xg("value","update:value"),mdiArrowRight:ly,mdiClose:uy,mdiUndo:oy}},computed:{isArrow(){return this.trailingButtonIcon==="arrowEnd"||this.trailingButtonIcon==="arrowRight"},propsAndAttrsToForward(){const r={arrowEnd:Dc("Save changes"),arrowRight:Dc("Save changes"),close:Dc("Clear text"),undo:Dc("Undo changes")};return Cs(kt(kt({},this.$attrs),Object.fromEntries(Object.entries(this.$props).filter(([e])=>AA.has(e)))),{trailingButtonLabel:this.trailingButtonLabel||r[this.trailingButtonIcon]})}},methods:{focus(){this.$refs.inputField.focus()},select(){this.$refs.inputField.select()}}};var EA=function(){var r=this,e=r._self._c;return e("NcInputField",r._g(r._b({ref:"inputField",scopedSlots:r._u([r.$scopedSlots.icon||r.$slots.default||r.$scopedSlots.default?{key:"icon",fn:function(){return[r._t("icon",function(){return[r._t("default")]})]},proxy:!0}:null,r.type!=="search"?{key:"trailing-button-icon",fn:function(){return[r.isArrow?e("NcIconSvgWrapper",{attrs:{directional:"",path:r.mdiArrowRight}}):e("NcIconSvgWrapper",{attrs:{path:r.trailingButtonIcon==="undo"?r.mdiUndo:r.mdiClose}})]},proxy:!0}:null],null,!0)},"NcInputField",r.propsAndAttrsToForward,!1),r.$listeners))},kA=[],IA=pm(NA,EA,kA,!1,null,null);const CA=IA.exports,VA=cy({__name:"MnemonicPromptDialog",emits:["close"],setup(r,{emit:e}){const t=Cm(),s=Cm(""),a=Cm(!1),n=td(()=>a.value===!0&&s.value.trim().split(/\s+/g).length===12);function o(){e("close",s.value)}const u=td(()=>[{label:Bf("end_to_en_encryption","Submit"),nativeType:"submit",type:"primary",disabled:!n.value,callback:o}]);return{__sfc:!0,emit:e,dialogRef:t,mnemonic:s,confirmToggle:a,isFormValid:n,submit:o,buttons:u,t:Bf,NcDialog:Ny,NcTextField:CA,NcNoteCard:Ay,NcCheckboxRadioSwitch:Sy}}});var xA=function(){var r=this,e=r._self._c,t=r._self._setupProxy;return e(t.NcDialog,{ref:"dialogRef",attrs:{name:t.t("end_to_end_encryption","Enter your 12 words mnemonic"),buttons:t.buttons,"is-form":!0},on:{submit:t.submit}},[e(t.NcNoteCard,{attrs:{type:"warning","show-alert":!0,heading:t.t("end_to_end_encryption","Decrypting your files in the browser can weaken security")}},[r._v(" "+r._s(t.t("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" "),e(t.NcCheckboxRadioSwitch,{attrs:{required:!0,"data-cy-e2ee-mnemonic-prompt":"i_understand_the_risks",type:"switch"},model:{value:t.confirmToggle,callback:function(s){t.confirmToggle=s},expression:"confirmToggle"}},[r._v(" "+r._s(t.t("end_to_end_encryption","I understand the risks"))+" ")])],1),e(t.NcTextField,{attrs:{value:t.mnemonic,required:"true",pattern:"^(\\w+\\s+){11}\\w+$",label:t.t("end_to_end_encryption","Mnemonic"),autofocus:!0},on:{"update:value":function(s){t.mnemonic=s}}})],1)},BA=[],OA=hy(VA,xA,BA,!1,null,null);const PA=OA.exports;async function DA(){const r=Promise.withResolvers();return Ey(PA,void 0,e=>{e!==void 0?r.resolve(e):r.reject()}),r.promise}async function TA(r,e){ht.debug("Decrypting metadata info",{metadata:r});const[t,s]=r.metadata.ciphertext.split("|"),a=await Fp(Ls(t),e,{iv:Ls(s)}),n=JSON.parse(await LA(a));return RA(n,r),await UA(n,e),n}function RA(r,e){var t,s;if(((t=r.keyChecksums)==null?void 0:t.length)!==((s=e.users)==null?void 0:s.length))throw new Error("Key checksums length does not match users length")}async function UA(r,e){if(r.keyChecksums===void 0)return;const t=await GS(e),s=await zS(t);if(!r.keyChecksums.includes(s))throw new Error("Key checksum is not in keyChecksums")}async function LA(r){const e=new ReadableStream({start(t){t.enqueue(new Uint8Array(r)),t.close()}}).pipeThrough(new DecompressionStream("gzip"));return await new Response(e).text()}async function jA(r,e,t){var s;ht.debug("Getting metadata private key",{metadata:r,userId:e});const a=(s=r.users)==null?void 0:s.find(u=>u.userId===e);if(!a)throw new Error("User not found in metadata");const n=Ls(a.encryptedMetadataKey),o=await qS(n,t);return await Uw(new Uint8Array(o))}async function Ag(r,e,t){const s=JSON.stringify(r,(n,o)=>{if(n!=="filedrop")return o}),a=await QS(Rw(btoa(s)),Ls(e),t.users);if(!a)throw new Error("Metadata signature verification failed");return a}async function $A(r,e){const t=r.users.map(async({userId:s,certificate:a})=>{const n=await XS(a,e);if(!n)throw new Error("Certificate verification failed for user ".concat(s));return n});return await Promise.all(t)}const KA=r1(),Bt={_userPrivateKey:void 0,_serverPublicKey:void 0,_metadataCache:{},async getUserPrivateKey(){var r;return(r=this._userPrivateKey)!=null||(this._userPrivateKey=await nA(await iA(),await DA())),this._userPrivateKey},async getServerPublicKeyPEM(){var r;return(r=this._serverPublicKey)!=null||(this._serverPublicKey=await oA()),this._serverPublicKey},async getMetadata(r){if(this._metadataCache[r])return ht.debug("Found metadata in cache",{path:r,state:Bt}),this._metadataCache[r];if(ht.debug("Fetching PROPFIND for metadata",{path:r,state:Bt}),await KA.stat(decodeURI(r).replace("remote.php/dav/",""),{details:!0,data:Z0()}),this._metadataCache[r])return ht.debug("Found metadata in cache after PROPFIND",{path:r,state:Bt}),this._metadataCache[r];throw new Error("Could not find metadata for ".concat(r))},async setMetadata(r,e,t){const s=JSON.parse(e);fh(s)?(await Ag(s,t,s),await $A(s,await this.getServerPublicKeyPEM())):await Ag(s,t,await this.getRootMetadata(Jo.dirname(r))),this._metadataCache[r]=s,ht.debug("Added metadata in cache",{path:r,state:Bt})},async getMetadataInfo(r){const e=await this.getMetadata(r),t=await this.getRootMetadata(r),s=pp();if(s===null)throw new Error("No user logged in");return TA(e,await jA(t,s.uid,await Bt.getUserPrivateKey()))},async getRootMetadata(r){const e=Object.entries(Bt._metadataCache).filter(([t])=>r.startsWith(t)).map(([,t])=>t).find(t=>fh(t));if(e)return ht.debug("Found root metadata in cache",{path:r,state:Bt}),e;for(ht.debug("Looking for root metadata",{path:r,state:Bt});r!=="/";){const t=await Bt.getMetadata(r);if(fh(t))return ht.debug("Fetched root metadata",{path:r,state:Bt}),t;r=Jo.dirname(r)}throw new Error("Found no root metadata for ".concat(r))}};var MA=Object.defineProperty,HA=Object.defineProperties,FA=Object.getOwnPropertyDescriptors,Ng=Object.getOwnPropertySymbols,JA=Object.prototype.hasOwnProperty,qA=Object.prototype.propertyIsEnumerable,Eg=(r,e,t)=>e in r?MA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,WA=(r,e)=>{for(var t in e||(e={}))JA.call(e,t)&&Eg(r,t,e[t]);if(Ng)for(var t of Ng(e))qA.call(e,t)&&Eg(r,t,e[t]);return r},_A=(r,e)=>HA(r,FA(e));let fm;function GA(){fm=window.fetch,ht.debug("Setting up WebDAV decryption proxy"),window.fetch=async(r,e={})=>{let t=new Request(r,e);if(!(t.url.includes("/remote.php/dav/files/")&&(t.method==="GET"||t.method==="PROPFIND")))return fm(t);ht.debug("Proxying ".concat(t.method," ").concat(t.url),{request:t});const s=new Headers(t.headers);switch(s.set("X-E2EE-SUPPORTED","true"),t=new Request(t,{headers:s}),t.method){case"PROPFIND":return XA(t);case"GET":default:return zA(t)}}}async function zA(r){const e=new URL(r.url).pathname,t=fm(r);try{const s=await Bt.getMetadataInfo(Jo.dirname(e)),a=s.files[Jo.basename(r.url)];if(a===void 0)throw ht.debug("Could not find file in metadata",{path:e,metadataInfo:s}),new Error("Could not find file in metadata");return await YA(await t,a)}catch(s){return await t}}async function XA(r){var e;ht.debug("Fetching raw PROPFIND",{request:r});const t=await fm(r),s=new URL(r.url).pathname,a=await t.text(),n=await X0(a),o=z0(n,s,!0);if(((e=o.props)==null?void 0:e["e2ee-is-encrypted"])!==1)return ht.debug("Node is not e2ee",{xml:n}),new Response(a,t);if(o.type==="directory"){const u=o.props["e2ee-metadata"],h=o.props["e2ee-metadata-signature"];u!==void 0&&h!==void 0&&await Bt.setMetadata(s,u,h);const c=await Bt.getMetadata(s),i=await Bt.getMetadataInfo(s);if(fh(c))Vf(n,s,i);else{const f=await Bt.getMetadataInfo(Jo.dirname(s));Vf(n,s,i,f)}}else if(o.type==="file"){const u=await Bt.getMetadataInfo(Jo.dirname(s));if(u===void 0)return ht.debug("Cannot find metadata for parent folder",{path:s}),new Response(a,t);Vf(n,s,void 0,u)}return new Response(new pa().build(n),t)}function Vf(r,e,t,s){ht.debug("Updating PROPFIND info",{path:e,decryptedMetadata:t,decryptedParentMetadata:s,xml:r}),r.multistatus.response.forEach(a=>{if(a.propstat===void 0)return;const n=a.href===e?s:t,o=a.propstat.prop.displayname;let u=o;n!==void 0&&(n.files[o]?(u=n.files[o].filename,a.propstat.prop.getcontenttype=n.files[o].mimetype):n.folders[o]&&(u=n.folders[o],a.propstat.prop.getcontenttype="httpd/unix-directory")),a.propstat.prop.displayname=u,a.propstat.prop.permissions=a.propstat.prop.permissions.replace(/(R)|(D)|(N)|(V)|(W)|(CK)/g,"")})}async function YA(r,e){ht.debug("Decrypting encrypted file",{response:r,fileEncryptionInfo:e});const t=await Fp(new Uint8Array(await r.arrayBuffer()),await Uw(Ls(e.key)),{iv:Ls(e.nonce)}),s=new Headers(r.headers);return s.set("Content-Type",e.mimetype),new Response(t,_A(WA({},r),{headers:s}))}const QA='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-arrow-down" viewBox="0 0 24 24"><path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" /></svg>';function ZA(r){if((r.permissions&tw.READ)===0)return!1;if(r.attributes["share-attributes"]){const e=JSON.parse(r.attributes["share-attributes"]||"[]").find(({scope:t,key:s})=>t==="permissions"&&s==="download");if(e!==void 0)return e.value===!0}return!0}async function eN([r]){const e=await(await fetch(r.encodedSource)).arrayBuffer(),t=new Blob([e],{type:r.mime}),s=document.createElement("a");s.href=window.URL.createObjectURL(t),s.download=r.displayname,s.click()}const tN=new l1({id:"download_unencrypted",default:Ep.DEFAULT,displayName:()=>Bf("files","Download unencrypted"),iconSvgInline:()=>QA,enabled(r){return r.length!==1||r.some(e=>e.attributes["e2ee-is-encrypted"]!==1)||r.some(e=>!e.isDavRessource)||r.some(e=>e.type!==ew.File)?!1:r.every(ZA)},async exec(r){return eN([r]),null},order:30}),sN=my("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1});sN.e2eeInBrowserEnabled&&(GA(),Lm("nc:e2ee-is-encrypted",{nc:"http://nextcloud.org/ns"}),Lm("nc:e2ee-metadata",{nc:"http://nextcloud.org/ns"}),Lm("nc:e2ee-metadata-signature",{nc:"http://nextcloud.org/ns"}),c1(tN),kg("download"),kg("move-copy"));function kg(r){ht.debug("Inhibiting ".concat(r," actions for e2ee files"));const e=h1().find(s=>s.id===r),t=e._action.enabled;e._action.enabled=(s,a)=>s.some(n=>n.attributes["e2ee-is-encrypted"]===1)?!1:t(s,a)}
//# sourceMappingURL=end_to_end_encryption-files.mjs.map
