(function(){"use strict";try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode("/*!\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */.toastify.dialogs{min-width:200px;background:none;background-color:var(--color-main-background);color:var(--color-main-text);box-shadow:0 0 6px 0 var(--color-box-shadow);padding:0 12px;margin-top:45px;position:fixed;z-index:10100;border-radius:var(--border-radius);display:flex;align-items:center;min-height:50px}.toastify.dialogs .toast-loader-container,.toastify.dialogs .toast-undo-container{display:flex;align-items:center;width:100%}.toastify.dialogs .toast-undo-button,.toastify.dialogs .toast-close{position:static;overflow:hidden;box-sizing:border-box;min-width:44px;height:100%;padding:12px;white-space:nowrap;background-repeat:no-repeat;background-position:center;background-color:transparent;min-height:0}.toastify.dialogs .toast-undo-button.toast-close,.toastify.dialogs .toast-close.toast-close{text-indent:0;opacity:.4;border:none;min-height:44px;margin-left:10px;font-size:0}.toastify.dialogs .toast-undo-button.toast-close:before,.toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\");content:\" \";filter:var(--background-invert-if-dark);display:inline-block;width:16px;height:16px}.toastify.dialogs .toast-undo-button.toast-undo-button,.toastify.dialogs .toast-close.toast-undo-button{height:calc(100% - 6px);margin:3px 3px 3px 12px}.toastify.dialogs .toast-undo-button:hover,.toastify.dialogs .toast-undo-button:focus,.toastify.dialogs .toast-undo-button:active,.toastify.dialogs .toast-close:hover,.toastify.dialogs .toast-close:focus,.toastify.dialogs .toast-close:active{cursor:pointer;opacity:1}.toastify.dialogs.toastify-top{right:10px}.toastify.dialogs.toast-with-click{cursor:pointer}.toastify.dialogs.toast-error{border-left:3px solid var(--color-error)}.toastify.dialogs.toast-info{border-left:3px solid var(--color-primary)}.toastify.dialogs.toast-warning{border-left:3px solid var(--color-warning)}.toastify.dialogs.toast-success,.toastify.dialogs.toast-undo{border-left:3px solid var(--color-success)}.toastify.dialogs.toast-loading{border-left:3px solid var(--color-primary)}.toastify.dialogs.toast-loading .toast-loader{display:inline-block;width:20px;height:20px;animation:rotate var(--animation-duration, .8s) linear infinite;margin-left:auto}.theme--dark .toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill:%23fff;fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\")}.nc-generic-dialog .dialog__actions{justify-content:space-between;min-width:calc(100% - 12px)}/*!\n * SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */._file-picker__file-icon_19mjt_9{width:32px;height:32px;min-width:32px;min-height:32px;background-repeat:no-repeat;background-size:contain;display:flex;justify-content:center}tr.file-picker__row[data-v-15187afc]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-15187afc]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-15187afc]{padding:0 2px}tr.file-picker__row td[data-v-15187afc]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-15187afc]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-15187afc]{padding-inline:2px 0}@keyframes gradient-15187afc{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}.loading-row .row-checkbox[data-v-15187afc]{text-align:center!important}.loading-row span[data-v-15187afc]{display:inline-block;height:24px;background:linear-gradient(to right,var(--color-background-darker),var(--color-text-maxcontrast),var(--color-background-darker));background-size:600px 100%;border-radius:var(--border-radius);animation:gradient-15187afc 12s ease infinite}.loading-row .row-wrapper[data-v-15187afc]{display:inline-flex;align-items:center}.loading-row .row-checkbox span[data-v-15187afc]{width:24px}.loading-row .row-name span[data-v-15187afc]:last-of-type{margin-inline-start:6px;width:130px}.loading-row .row-size span[data-v-15187afc]{width:80px}.loading-row .row-modified span[data-v-15187afc]{width:90px}/*!\n* SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n* SPDX-License-Identifier: AGPL-3.0-or-later\n*/tr.file-picker__row[data-v-cb12dccb]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-cb12dccb]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-cb12dccb]{padding:0 2px}tr.file-picker__row td[data-v-cb12dccb]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-cb12dccb]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-cb12dccb]{padding-inline:2px 0}.file-picker__row--selected[data-v-cb12dccb]{background-color:var(--color-background-dark)}.file-picker__row[data-v-cb12dccb]:hover{background-color:var(--color-background-hover)}.file-picker__name-container[data-v-cb12dccb]{display:flex;justify-content:start;align-items:center;height:100%}.file-picker__file-name[data-v-cb12dccb]{padding-inline-start:6px;min-width:0;overflow:hidden;text-overflow:ellipsis}.file-picker__file-extension[data-v-cb12dccb]{color:var(--color-text-maxcontrast);min-width:fit-content}.file-picker__header-preview[data-v-006fdbd0]{width:22px;height:32px;flex:0 0 auto}.file-picker__files[data-v-006fdbd0]{margin:2px;margin-inline-start:12px;overflow:scroll auto}.file-picker__files table[data-v-006fdbd0]{width:100%;max-height:100%;table-layout:fixed}.file-picker__files th[data-v-006fdbd0]{position:-webkit-sticky;position:sticky;z-index:1;top:0;background-color:var(--color-main-background);padding:2px}.file-picker__files th .header-wrapper[data-v-006fdbd0]{display:flex}.file-picker__files th.row-checkbox[data-v-006fdbd0]{width:44px}.file-picker__files th.row-name[data-v-006fdbd0]{width:230px}.file-picker__files th.row-size[data-v-006fdbd0]{width:100px}.file-picker__files th.row-modified[data-v-006fdbd0]{width:120px}.file-picker__files th[data-v-006fdbd0]:not(.row-size) .button-vue__wrapper{justify-content:start;flex-direction:row-reverse}.file-picker__files th[data-v-006fdbd0]:not(.row-size) .button-vue{padding-inline:16px 4px}.file-picker__files th.row-size[data-v-006fdbd0] .button-vue__wrapper{justify-content:end}.file-picker__files th[data-v-006fdbd0] .button-vue__wrapper{color:var(--color-text-maxcontrast)}.file-picker__files th[data-v-006fdbd0] .button-vue__wrapper .button-vue__text{font-weight:400}.file-picker__breadcrumbs[data-v-b357227a]{flex-grow:0!important}.file-picker__side[data-v-b42054b8]{display:flex;flex-direction:column;align-items:stretch;gap:.5rem;min-width:200px;padding:2px;margin-block-start:7px;overflow:auto}.file-picker__side[data-v-b42054b8] .button-vue__wrapper{justify-content:start}.file-picker__filter-input[data-v-b42054b8]{margin-block:7px;max-width:260px}@media (max-width: 736px){.file-picker__side[data-v-b42054b8]{flex-direction:row;min-width:unset}}@media (max-width: 512px){.file-picker__side[data-v-b42054b8]{flex-direction:row;min-width:unset}.file-picker__filter-input[data-v-b42054b8]{max-width:unset}}.file-picker__navigation{padding-inline:8px 2px}.file-picker__navigation,.file-picker__navigation *{box-sizing:border-box}.file-picker__navigation .v-select.select{min-width:220px}@media (min-width: 513px) and (max-width: 736px){.file-picker__navigation{gap:11px}}@media (max-width: 512px){.file-picker__navigation{flex-direction:column-reverse!important}}.file-picker__view[data-v-20b719ba]{height:50px;display:flex;justify-content:start;align-items:center}.file-picker__view h3[data-v-20b719ba]{font-weight:700;height:fit-content;margin:0}.file-picker__main[data-v-20b719ba]{box-sizing:border-box;width:100%;display:flex;flex-direction:column;min-height:0;flex:1;padding-inline:2px}.file-picker__main *[data-v-20b719ba]{box-sizing:border-box}[data-v-20b719ba] .file-picker{height:min(80vh,800px)!important}@media (max-width: 512px){[data-v-20b719ba] .file-picker{height:calc(100% - 16px - var(--default-clickable-area))!important}}[data-v-20b719ba] .file-picker__content{display:flex;flex-direction:column;overflow:hidden}.material-design-icon[data-v-8f3abf17]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.input-field[data-v-8f3abf17]{--input-border-radius: var(--border-radius-element, var(--border-radius-large));--input-padding-start: var(--border-radius-large);--input-padding-end: var(--border-radius-large);position:relative;width:100%;margin-block-start:6px}.input-field--disabled[data-v-8f3abf17]{opacity:.4;filter:saturate(.4)}.input-field--label-outside[data-v-8f3abf17]{margin-block-start:0}.input-field--leading-icon[data-v-8f3abf17]{--input-padding-start: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--trailing-icon[data-v-8f3abf17]{--input-padding-end: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--pill[data-v-8f3abf17]{--input-border-radius: var(--border-radius-pill)}.input-field__main-wrapper[data-v-8f3abf17]{height:var(--default-clickable-area);position:relative}.input-field__input[data-v-8f3abf17]{--input-border-width-offset: calc(var(--border-width-input-focused, 2px) - var(--border-width-input, 2px));background-color:var(--color-main-background);color:var(--color-main-text);border:var(--border-width-input, 2px) solid var(--color-border-maxcontrast);border-radius:var(--input-border-radius);cursor:pointer;-webkit-appearance:textfield!important;-moz-appearance:textfield!important;appearance:textfield!important;font-size:var(--default-font-size);text-overflow:ellipsis;height:calc(var(--default-clickable-area) - 2 * var(--input-border-width-offset))!important;width:100%;padding-inline:calc(var(--input-padding-start) + var(--input-border-width-offset)) calc(var(--input-padding-end) + var(--input-border-width-offset));padding-block:var(--input-border-width-offset)}.input-field__input[data-v-8f3abf17]::placeholder{color:var(--color-text-maxcontrast)}.input-field__input[data-v-8f3abf17]:active:not([disabled]),.input-field__input[data-v-8f3abf17]:hover:not([disabled]),.input-field__input[data-v-8f3abf17]:focus:not([disabled]){border-color:var(--color-main-text);border-width:var(--border-width-input-focused, 2px);box-shadow:0 0 0 2px var(--color-main-background)!important;--input-border-width-offset: 0px}.input-field__input:focus+.input-field__label[data-v-8f3abf17],.input-field__input:hover:not(:placeholder-shown)+.input-field__label[data-v-8f3abf17]{color:var(--color-main-text)}.input-field__input[data-v-8f3abf17]:focus{cursor:text}.input-field__input[data-v-8f3abf17]:disabled{cursor:default}.input-field__input[data-v-8f3abf17]:focus-visible{box-shadow:unset!important}.input-field__input--success[data-v-8f3abf17]{border-color:var(--color-success)!important}.input-field__input--success[data-v-8f3abf17]:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field__input--error[data-v-8f3abf17],.input-field__input[data-v-8f3abf17]:user-invalid{border-color:var(--color-error)!important}.input-field__input--error[data-v-8f3abf17]:focus-visible,.input-field__input[data-v-8f3abf17]:user-invalid:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field:not(.input-field--label-outside) .input-field__input[data-v-8f3abf17]:not(:focus)::placeholder{opacity:0}.input-field__label[data-v-8f3abf17]{--input-label-font-size: var(--default-font-size);position:absolute;margin-inline:var(--input-padding-start) var(--input-padding-end);max-width:fit-content;font-size:var(--input-label-font-size);inset-block-start:calc((var(--default-clickable-area) - 1lh) / 2);inset-inline:var(--border-width-input-focused, 2px);color:var(--color-text-maxcontrast);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;pointer-events:none;transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick),background-color var(--animation-quick) var(--animation-slow)}.input-field__input:focus+.input-field__label[data-v-8f3abf17],.input-field__input:not(:placeholder-shown)+.input-field__label[data-v-8f3abf17]{--input-label-font-size: 13px;line-height:1.5;inset-block-start:calc(-1.5 * var(--input-label-font-size) / 2);font-weight:500;border-radius:var(--default-grid-baseline) var(--default-grid-baseline) 0 0;background-color:var(--color-main-background);padding-inline:var(--default-grid-baseline);margin-inline:calc(var(--input-padding-start) - var(--default-grid-baseline)) calc(var(--input-padding-end) - var(--default-grid-baseline));transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick)}.input-field__icon[data-v-8f3abf17]{position:absolute;height:var(--default-clickable-area);width:var(--default-clickable-area);display:flex;align-items:center;justify-content:center;opacity:.7;inset-block-end:0}.input-field__icon--leading[data-v-8f3abf17]{inset-inline-start:0px}.input-field__icon--trailing[data-v-8f3abf17]{inset-inline-end:0px}.input-field__trailing-button[data-v-8f3abf17]{--button-size: calc(var(--default-clickable-area) - 2 * var(--border-width-input-focused, 2px)) !important;--button-radius: calc(var(--input-border-radius) - var(--border-width-input-focused, 2px))}.input-field__trailing-button.button-vue[data-v-8f3abf17]{position:absolute;top:var(--border-width-input-focused, 2px);inset-inline-end:var(--border-width-input-focused, 2px)}.input-field__trailing-button.button-vue[data-v-8f3abf17]:focus-visible{box-shadow:none!important}.input-field__helper-text-message[data-v-8f3abf17]{padding-block:4px;padding-inline:var(--border-radius-large);display:flex;align-items:center;color:var(--color-text-maxcontrast)}.input-field__helper-text-message__icon[data-v-8f3abf17]{margin-inline-end:8px}.input-field__helper-text-message--error[data-v-8f3abf17]{color:var(--color-error-text)}.input-field__helper-text-message--success[data-v-8f3abf17]{color:var(--color-success-text)}")),document.head.appendChild(i)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
var yw=Object.defineProperty,vw=Object.defineProperties;var bw=Object.getOwnPropertyDescriptors;var kp=Object.getOwnPropertySymbols;var Aw=Object.prototype.hasOwnProperty,Sw=Object.prototype.propertyIsEnumerable;var Cp=r=>{throw TypeError(r)};var Gh=(r,e,t)=>e in r?yw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,nt=(r,e)=>{for(var t in e||(e={}))Aw.call(e,t)&&Gh(r,t,e[t]);if(kp)for(var t of kp(e))Sw.call(e,t)&&Gh(r,t,e[t]);return r},ns=(r,e)=>vw(r,bw(e));var Ue=(r,e,t)=>Gh(r,typeof e!="symbol"?e+"":e,t),zh=(r,e,t)=>e.has(r)||Cp("Cannot "+t);var J=(r,e,t)=>(zh(r,e,"read from private field"),t?t.call(r):e.get(r)),kt=(r,e,t)=>e.has(r)?Cp("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Be=(r,e,t,s)=>(zh(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),Ws=(r,e,t)=>(zh(r,e,"access private method"),t);import{p as We,g as Et,l as Wf,a as of,b as Gf,U as Nw,c as kw,o as Cw,d as ng,v as ig,n as Hh,N as Ew,G as xw,r as Iw,t as Vw,e as Bw,C as Pw,f as Xh,h as Ow,i as _h,j as Ep,k as lf,m as Dw,q as bo}from"./_plugin-vue2_normalizer-9gLeDtwc.chunk.mjs";import{f as Re,B as ge,s as Ao,a as yh,O as H,N as Me,g as d,S as E,I as R,C as O,R as ee,c as $,b as U,d as W,e as ae,h as Ne,A as Y,P as _,i as he,j as Je,k as Wu,n as Tw,l as Gu,m as vh,u as mo,t as uf,G as ke,o as aa,U as cf,T as hf,p as Os,q as mf,r as bh,v as ff,w as og,x as jc,V as Rw,y as Lw,z as jw,D as $w,E as Uw,F as zu,H as Kw,J as xp,K as Ip,X as Hw,L as Mw}from"./ArrowRight-CY2b9hgN-Dzd_b1Fr.chunk.mjs";import{N as Jw,a as Fw,b as qw,s as Ww}from"./NcCheckboxRadioSwitch-Di9rSADK-B10_bolA.chunk.mjs";import{C as Gw}from"./Check-BkThHPH7-B_LwpGir.chunk.mjs";import{u as lg}from"./useModelMigration-EhAWvqDD-BT-BcXLu.chunk.mjs";function Zs(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Vp(r,e,t){zw(r,e),e.set(r,t)}function zw(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function rt(r,e){var t=ug(r,e,"get");return Xw(r,t)}function Xw(r,e){return e.get?e.get.call(r):e.value}function Bp(r,e,t){var s=ug(r,e,"set");return _w(r,s,t),t}function ug(r,e,t){if(!e.has(r))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(r)}function _w(r,e,t){if(e.set)e.set.call(r,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}var Yw=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",it=new WeakMap,Io=new WeakMap;class Mh{constructor(e){var{executor:t=()=>{},internals:s=Xf(),promise:a=new Promise((n,u)=>t(n,u,o=>{s.onCancelList.push(o)}))}=e;Vp(this,it,{writable:!0,value:void 0}),Vp(this,Io,{writable:!0,value:void 0}),Zs(this,Yw,"CancelablePromise"),this.cancel=this.cancel.bind(this),Bp(this,it,s),Bp(this,Io,a||new Promise((n,u)=>t(n,u,o=>{s.onCancelList.push(o)})))}then(e,t){return $c(rt(this,Io).then(ic(e,rt(this,it)),ic(t,rt(this,it))),rt(this,it))}catch(e){return $c(rt(this,Io).catch(ic(e,rt(this,it))),rt(this,it))}finally(e,t){return t&&rt(this,it).onCancelList.push(e),$c(rt(this,Io).finally(ic(()=>{if(e)return t&&(rt(this,it).onCancelList=rt(this,it).onCancelList.filter(s=>s!==e)),e()},rt(this,it))),rt(this,it))}cancel(){rt(this,it).isCanceled=!0;var e=rt(this,it).onCancelList;rt(this,it).onCancelList=[];for(var t of e)if(typeof t=="function")try{t()}catch(s){console.error(s)}}isCanceled(){return rt(this,it).isCanceled===!0}}class er extends Mh{constructor(e){super({executor:e})}}Zs(er,"all",function(r){return oc(r,Promise.all(r))}),Zs(er,"allSettled",function(r){return oc(r,Promise.allSettled(r))}),Zs(er,"any",function(r){return oc(r,Promise.any(r))}),Zs(er,"race",function(r){return oc(r,Promise.race(r))}),Zs(er,"resolve",function(r){return Pp(Promise.resolve(r))}),Zs(er,"reject",function(r){return Pp(Promise.reject(r))}),Zs(er,"isCancelable",zf);function Pp(r){return $c(r,Xf())}function zf(r){return r instanceof er||r instanceof Mh}function ic(r,e){if(r)return t=>{if(!e.isCanceled){var s=r(t);return zf(s)&&e.onCancelList.push(s.cancel),s}return t}}function $c(r,e){return new Mh({internals:e,promise:r})}function oc(r,e){var t=Xf();return t.onCancelList.push(()=>{for(var s of r)zf(s)&&s.cancel()}),new Mh({internals:t,promise:e})}function Xf(){return{isCanceled:!1,onCancelList:[]}}var Yh={},Qw={2:r=>{function e(a,n,u){a instanceof RegExp&&(a=t(a,u)),n instanceof RegExp&&(n=t(n,u));var o=s(a,n,u);return o&&{start:o[0],end:o[1],pre:u.slice(0,o[0]),body:u.slice(o[0]+a.length,o[1]),post:u.slice(o[1]+n.length)}}function t(a,n){var u=n.match(a);return u?u[0]:null}function s(a,n,u){var o,l,i,c,m,h=u.indexOf(a),g=u.indexOf(n,h+1),p=h;if(h>=0&&g>0){for(o=[],i=u.length;p>=0&&!m;)p==h?(o.push(p),h=u.indexOf(a,p+1)):o.length==1?m=[o.pop(),g]:((l=o.pop())<i&&(i=l,c=g),g=u.indexOf(n,p+1)),p=h<g&&h>=0?h:g;o.length&&(m=[i,c])}return m}r.exports=e,e.range=s},101:function(r,e,t){var s;r=t.nmd(r),function(a){var n=(r&&r.exports,typeof Et=="object"&&Et);n.global!==n&&n.window;var u=function(m){this.message=m};(u.prototype=new Error).name="InvalidCharacterError";var o=function(m){throw new u(m)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=/[\t\n\f\r ]/g,c={encode:function(m){m=String(m),/[^\0-\xFF]/.test(m)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var h,g,p,y,w=m.length%3,b="",f=-1,v=m.length-w;++f<v;)h=m.charCodeAt(f)<<16,g=m.charCodeAt(++f)<<8,p=m.charCodeAt(++f),b+=l.charAt((y=h+g+p)>>18&63)+l.charAt(y>>12&63)+l.charAt(y>>6&63)+l.charAt(63&y);return w==2?(h=m.charCodeAt(f)<<8,g=m.charCodeAt(++f),b+=l.charAt((y=h+g)>>10)+l.charAt(y>>4&63)+l.charAt(y<<2&63)+"="):w==1&&(y=m.charCodeAt(f),b+=l.charAt(y>>2)+l.charAt(y<<4&63)+"=="),b},decode:function(m){var h=(m=String(m).replace(i,"")).length;h%4==0&&(h=(m=m.replace(/==?$/,"")).length),(h%4==1||/[^+a-zA-Z0-9/]/.test(m))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var g,p,y=0,w="",b=-1;++b<h;)p=l.indexOf(m.charAt(b)),g=y%4?64*g+p:p,y++%4&&(w+=String.fromCharCode(255&g>>(-2*y&6)));return w},version:"1.0.0"};(s=function(){return c}.call(e,t,e,r))===void 0||(r.exports=s)}()},172:(r,e)=>{e.d=function(t){if(!t)return 0;for(var s=(t=t.toString()).length,a=t.length;a--;){var n=t.charCodeAt(a);56320<=n&&n<=57343&&a--,127<n&&n<=2047?s++:2047<n&&n<=65535&&(s+=2)}return s}},526:r=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var s=[],a=0;a<t.length;a++)s.push(255&t.charCodeAt(a));return s},bytesToString:function(t){for(var s=[],a=0;a<t.length;a++)s.push(String.fromCharCode(t[a]));return s.join("")}}};r.exports=e},298:r=>{var e,t;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(s,a){return s<<a|s>>>32-a},rotr:function(s,a){return s<<32-a|s>>>a},endian:function(s){if(s.constructor==Number)return 16711935&t.rotl(s,8)|4278255360&t.rotl(s,24);for(var a=0;a<s.length;a++)s[a]=t.endian(s[a]);return s},randomBytes:function(s){for(var a=[];s>0;s--)a.push(Math.floor(256*Math.random()));return a},bytesToWords:function(s){for(var a=[],n=0,u=0;n<s.length;n++,u+=8)a[u>>>5]|=s[n]<<24-u%32;return a},wordsToBytes:function(s){for(var a=[],n=0;n<32*s.length;n+=8)a.push(s[n>>>5]>>>24-n%32&255);return a},bytesToHex:function(s){for(var a=[],n=0;n<s.length;n++)a.push((s[n]>>>4).toString(16)),a.push((15&s[n]).toString(16));return a.join("")},hexToBytes:function(s){for(var a=[],n=0;n<s.length;n+=2)a.push(parseInt(s.substr(n,2),16));return a},bytesToBase64:function(s){for(var a=[],n=0;n<s.length;n+=3)for(var u=s[n]<<16|s[n+1]<<8|s[n+2],o=0;o<4;o++)8*n+6*o<=8*s.length?a.push(e.charAt(u>>>6*(3-o)&63)):a.push("=");return a.join("")},base64ToBytes:function(s){s=s.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],n=0,u=0;n<s.length;u=++n%4)u!=0&&a.push((e.indexOf(s.charAt(n-1))&Math.pow(2,-2*u+8)-1)<<2*u|e.indexOf(s.charAt(n))>>>6-2*u);return a}},r.exports=t},635:(r,e,t)=>{const s=t(31),a=t(338),n=t(221);r.exports={XMLParser:a,XMLValidator:s,XMLBuilder:n}},118:r=>{r.exports=function(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const s of e)if(typeof s=="string"&&t===s||s instanceof RegExp&&s.test(t))return!0}:()=>!1}},705:(r,e)=>{const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",s="["+t+"]["+t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",a=new RegExp("^"+s+"$");e.isExist=function(n){return n!==void 0},e.isEmptyObject=function(n){return Object.keys(n).length===0},e.merge=function(n,u,o){if(u){const l=Object.keys(u),i=l.length;for(let c=0;c<i;c++)n[l[c]]=o==="strict"?[u[l[c]]]:u[l[c]]}},e.getValue=function(n){return e.isExist(n)?n:""},e.isName=function(n){return a.exec(n)!=null},e.getAllMatches=function(n,u){const o=[];let l=u.exec(n);for(;l;){const i=[];i.startIndex=u.lastIndex-l[0].length;const c=l.length;for(let m=0;m<c;m++)i.push(l[m]);o.push(i),l=u.exec(n)}return o},e.nameRegexp=s},31:(r,e,t)=>{const s=t(705),a={allowBooleanAttributes:!1,unpairedTags:[]};function n(f){return f===" "||f==="	"||f==="\n"||f==="\r"}function u(f,v){const k=v;for(;v<f.length;v++)if(!(f[v]!="?"&&f[v]!=" ")){const N=f.substr(k,v-k);if(v>5&&N==="xml")return p("InvalidXml","XML declaration allowed only at the start of the document.",w(f,v));if(f[v]=="?"&&f[v+1]==">"){v++;break}}return v}function o(f,v){if(f.length>v+5&&f[v+1]==="-"&&f[v+2]==="-"){for(v+=3;v<f.length;v++)if(f[v]==="-"&&f[v+1]==="-"&&f[v+2]===">"){v+=2;break}}else if(f.length>v+8&&f[v+1]==="D"&&f[v+2]==="O"&&f[v+3]==="C"&&f[v+4]==="T"&&f[v+5]==="Y"&&f[v+6]==="P"&&f[v+7]==="E"){let k=1;for(v+=8;v<f.length;v++)if(f[v]==="<")k++;else if(f[v]===">"&&(k--,k===0))break}else if(f.length>v+9&&f[v+1]==="["&&f[v+2]==="C"&&f[v+3]==="D"&&f[v+4]==="A"&&f[v+5]==="T"&&f[v+6]==="A"&&f[v+7]==="["){for(v+=8;v<f.length;v++)if(f[v]==="]"&&f[v+1]==="]"&&f[v+2]===">"){v+=2;break}}return v}e.validate=function(f,v){v=Object.assign({},a,v);const k=[];let N=!1,S=!1;f[0]==="\uFEFF"&&(f=f.substr(1));for(let C=0;C<f.length;C++)if(f[C]==="<"&&f[C+1]==="?"){if(C+=2,C=u(f,C),C.err)return C}else{if(f[C]!=="<"){if(n(f[C]))continue;return p("InvalidChar","char '"+f[C]+"' is not expected.",w(f,C))}{let I=C;if(C++,f[C]==="!"){C=o(f,C);continue}{let P=!1;f[C]==="/"&&(P=!0,C++);let B="";for(;C<f.length&&f[C]!==">"&&f[C]!==" "&&f[C]!=="	"&&f[C]!=="\n"&&f[C]!=="\r";C++)B+=f[C];if(B=B.trim(),B[B.length-1]==="/"&&(B=B.substring(0,B.length-1),C--),x=B,!s.isName(x)){let K;return K=B.trim().length===0?"Invalid space after '<'.":"Tag '"+B+"' is an invalid name.",p("InvalidTag",K,w(f,C))}const D=c(f,C);if(D===!1)return p("InvalidAttr","Attributes for '"+B+"' have open quote.",w(f,C));let V=D.value;if(C=D.index,V[V.length-1]==="/"){const K=C-V.length;V=V.substring(0,V.length-1);const M=h(V,v);if(M!==!0)return p(M.err.code,M.err.msg,w(f,K+M.err.line));N=!0}else if(P){if(!D.tagClosed)return p("InvalidTag","Closing tag '"+B+"' doesn't have proper closing.",w(f,C));if(V.trim().length>0)return p("InvalidTag","Closing tag '"+B+"' can't have attributes or invalid starting.",w(f,I));if(k.length===0)return p("InvalidTag","Closing tag '"+B+"' has not been opened.",w(f,I));{const K=k.pop();if(B!==K.tagName){let M=w(f,K.tagStartPos);return p("InvalidTag","Expected closing tag '"+K.tagName+"' (opened in line "+M.line+", col "+M.col+") instead of closing tag '"+B+"'.",w(f,I))}k.length==0&&(S=!0)}}else{const K=h(V,v);if(K!==!0)return p(K.err.code,K.err.msg,w(f,C-V.length+K.err.line));if(S===!0)return p("InvalidXml","Multiple possible root nodes found.",w(f,C));v.unpairedTags.indexOf(B)!==-1||k.push({tagName:B,tagStartPos:I}),N=!0}for(C++;C<f.length;C++)if(f[C]==="<"){if(f[C+1]==="!"){C++,C=o(f,C);continue}if(f[C+1]!=="?")break;if(C=u(f,++C),C.err)return C}else if(f[C]==="&"){const K=g(f,C);if(K==-1)return p("InvalidChar","char '&' is not expected.",w(f,C));C=K}else if(S===!0&&!n(f[C]))return p("InvalidXml","Extra text at the end",w(f,C));f[C]==="<"&&C--}}}var x;return N?k.length==1?p("InvalidTag","Unclosed tag '"+k[0].tagName+"'.",w(f,k[0].tagStartPos)):!(k.length>0)||p("InvalidXml","Invalid '"+JSON.stringify(k.map(C=>C.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):p("InvalidXml","Start tag expected.",1)};const l='"',i="'";function c(f,v){let k="",N="",S=!1;for(;v<f.length;v++){if(f[v]===l||f[v]===i)N===""?N=f[v]:N!==f[v]||(N="");else if(f[v]===">"&&N===""){S=!0;break}k+=f[v]}return N===""&&{value:k,index:v,tagClosed:S}}const m=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function h(f,v){const k=s.getAllMatches(f,m),N={};for(let S=0;S<k.length;S++){if(k[S][1].length===0)return p("InvalidAttr","Attribute '"+k[S][2]+"' has no space in starting.",b(k[S]));if(k[S][3]!==void 0&&k[S][4]===void 0)return p("InvalidAttr","Attribute '"+k[S][2]+"' is without value.",b(k[S]));if(k[S][3]===void 0&&!v.allowBooleanAttributes)return p("InvalidAttr","boolean attribute '"+k[S][2]+"' is not allowed.",b(k[S]));const x=k[S][2];if(!y(x))return p("InvalidAttr","Attribute '"+x+"' is an invalid name.",b(k[S]));if(N.hasOwnProperty(x))return p("InvalidAttr","Attribute '"+x+"' is repeated.",b(k[S]));N[x]=1}return!0}function g(f,v){if(f[++v]===";")return-1;if(f[v]==="#")return function(N,S){let x=/\d/;for(N[S]==="x"&&(S++,x=/[\da-fA-F]/);S<N.length;S++){if(N[S]===";")return S;if(!N[S].match(x))break}return-1}(f,++v);let k=0;for(;v<f.length;v++,k++)if(!(f[v].match(/\w/)&&k<20)){if(f[v]===";")break;return-1}return v}function p(f,v,k){return{err:{code:f,msg:v,line:k.line||k,col:k.col}}}function y(f){return s.isName(f)}function w(f,v){const k=f.substring(0,v).split(/\r?\n/);return{line:k.length,col:k[k.length-1].length+1}}function b(f){return f.startIndex+f[1].length}},221:(r,e,t)=>{const s=t(87),a=t(118),n={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(c,m){return m},attributeValueProcessor:function(c,m){return m},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function u(c){this.options=Object.assign({},n,c),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=a(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=i),this.processTextOrObjNode=o,this.options.format?(this.indentate=l,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function o(c,m,h,g){const p=this.j2x(c,h+1,g.concat(m));return c[this.options.textNodeName]!==void 0&&Object.keys(c).length===1?this.buildTextValNode(c[this.options.textNodeName],m,p.attrStr,h):this.buildObjectNode(p.val,m,p.attrStr,h)}function l(c){return this.options.indentBy.repeat(c)}function i(c){return!(!c.startsWith(this.options.attributeNamePrefix)||c===this.options.textNodeName)&&c.substr(this.attrPrefixLen)}u.prototype.build=function(c){return this.options.preserveOrder?s(c,this.options):(Array.isArray(c)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(c={[this.options.arrayNodeName]:c}),this.j2x(c,0,[]).val)},u.prototype.j2x=function(c,m,h){let g="",p="";const y=h.join(".");for(let w in c)if(Object.prototype.hasOwnProperty.call(c,w))if(c[w]===void 0)this.isAttribute(w)&&(p+="");else if(c[w]===null)this.isAttribute(w)?p+="":w[0]==="?"?p+=this.indentate(m)+"<"+w+"?"+this.tagEndChar:p+=this.indentate(m)+"<"+w+"/"+this.tagEndChar;else if(c[w]instanceof Date)p+=this.buildTextValNode(c[w],w,"",m);else if(typeof c[w]!="object"){const b=this.isAttribute(w);if(b&&!this.ignoreAttributesFn(b,y))g+=this.buildAttrPairStr(b,""+c[w]);else if(!b)if(w===this.options.textNodeName){let f=this.options.tagValueProcessor(w,""+c[w]);p+=this.replaceEntitiesValue(f)}else p+=this.buildTextValNode(c[w],w,"",m)}else if(Array.isArray(c[w])){const b=c[w].length;let f="",v="";for(let k=0;k<b;k++){const N=c[w][k];if(N!==void 0)if(N===null)w[0]==="?"?p+=this.indentate(m)+"<"+w+"?"+this.tagEndChar:p+=this.indentate(m)+"<"+w+"/"+this.tagEndChar;else if(typeof N=="object")if(this.options.oneListGroup){const S=this.j2x(N,m+1,h.concat(w));f+=S.val,this.options.attributesGroupName&&N.hasOwnProperty(this.options.attributesGroupName)&&(v+=S.attrStr)}else f+=this.processTextOrObjNode(N,w,m,h);else if(this.options.oneListGroup){let S=this.options.tagValueProcessor(w,N);S=this.replaceEntitiesValue(S),f+=S}else f+=this.buildTextValNode(N,w,"",m)}this.options.oneListGroup&&(f=this.buildObjectNode(f,w,v,m)),p+=f}else if(this.options.attributesGroupName&&w===this.options.attributesGroupName){const b=Object.keys(c[w]),f=b.length;for(let v=0;v<f;v++)g+=this.buildAttrPairStr(b[v],""+c[w][b[v]])}else p+=this.processTextOrObjNode(c[w],w,m,h);return{attrStr:g,val:p}},u.prototype.buildAttrPairStr=function(c,m){return m=this.options.attributeValueProcessor(c,""+m),m=this.replaceEntitiesValue(m),this.options.suppressBooleanAttributes&&m==="true"?" "+c:" "+c+'="'+m+'"'},u.prototype.buildObjectNode=function(c,m,h,g){if(c==="")return m[0]==="?"?this.indentate(g)+"<"+m+h+"?"+this.tagEndChar:this.indentate(g)+"<"+m+h+this.closeTag(m)+this.tagEndChar;{let p="</"+m+this.tagEndChar,y="";return m[0]==="?"&&(y="?",p=""),!h&&h!==""||c.indexOf("<")!==-1?this.options.commentPropName!==!1&&m===this.options.commentPropName&&y.length===0?this.indentate(g)+"<!--".concat(c,"-->")+this.newLine:this.indentate(g)+"<"+m+h+y+this.tagEndChar+c+this.indentate(g)+p:this.indentate(g)+"<"+m+h+y+">"+c+p}},u.prototype.closeTag=function(c){let m="";return this.options.unpairedTags.indexOf(c)!==-1?this.options.suppressUnpairedNode||(m="/"):m=this.options.suppressEmptyNode?"/":"></".concat(c),m},u.prototype.buildTextValNode=function(c,m,h,g){if(this.options.cdataPropName!==!1&&m===this.options.cdataPropName)return this.indentate(g)+"<![CDATA[".concat(c,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&m===this.options.commentPropName)return this.indentate(g)+"<!--".concat(c,"-->")+this.newLine;if(m[0]==="?")return this.indentate(g)+"<"+m+h+"?"+this.tagEndChar;{let p=this.options.tagValueProcessor(m,c);return p=this.replaceEntitiesValue(p),p===""?this.indentate(g)+"<"+m+h+this.closeTag(m)+this.tagEndChar:this.indentate(g)+"<"+m+h+">"+p+"</"+m+this.tagEndChar}},u.prototype.replaceEntitiesValue=function(c){if(c&&c.length>0&&this.options.processEntities)for(let m=0;m<this.options.entities.length;m++){const h=this.options.entities[m];c=c.replace(h.regex,h.val)}return c},r.exports=u},87:r=>{function e(u,o,l,i){let c="",m=!1;for(let h=0;h<u.length;h++){const g=u[h],p=t(g);if(p===void 0)continue;let y="";if(y=l.length===0?p:"".concat(l,".").concat(p),p===o.textNodeName){let v=g[p];a(y,o)||(v=o.tagValueProcessor(p,v),v=n(v,o)),m&&(c+=i),c+=v,m=!1;continue}if(p===o.cdataPropName){m&&(c+=i),c+="<![CDATA[".concat(g[p][0][o.textNodeName],"]]>"),m=!1;continue}if(p===o.commentPropName){c+=i+"<!--".concat(g[p][0][o.textNodeName],"-->"),m=!0;continue}if(p[0]==="?"){const v=s(g[":@"],o),k=p==="?xml"?"":i;let N=g[p][0][o.textNodeName];N=N.length!==0?" "+N:"",c+=k+"<".concat(p).concat(N).concat(v,"?>"),m=!0;continue}let w=i;w!==""&&(w+=o.indentBy);const b=i+"<".concat(p).concat(s(g[":@"],o)),f=e(g[p],o,y,w);o.unpairedTags.indexOf(p)!==-1?o.suppressUnpairedNode?c+=b+">":c+=b+"/>":f&&f.length!==0||!o.suppressEmptyNode?f&&f.endsWith(">")?c+=b+">".concat(f).concat(i,"</").concat(p,">"):(c+=b+">",f&&i!==""&&(f.includes("/>")||f.includes("</"))?c+=i+o.indentBy+f+i:c+=f,c+="</".concat(p,">")):c+=b+"/>",m=!0}return c}function t(u){const o=Object.keys(u);for(let l=0;l<o.length;l++){const i=o[l];if(u.hasOwnProperty(i)&&i!==":@")return i}}function s(u,o){let l="";if(u&&!o.ignoreAttributes)for(let i in u){if(!u.hasOwnProperty(i))continue;let c=o.attributeValueProcessor(i,u[i]);c=n(c,o),c===!0&&o.suppressBooleanAttributes?l+=" ".concat(i.substr(o.attributeNamePrefix.length)):l+=" ".concat(i.substr(o.attributeNamePrefix.length),'="').concat(c,'"')}return l}function a(u,o){let l=(u=u.substr(0,u.length-o.textNodeName.length-1)).substr(u.lastIndexOf(".")+1);for(let i in o.stopNodes)if(o.stopNodes[i]===u||o.stopNodes[i]==="*."+l)return!0;return!1}function n(u,o){if(u&&u.length>0&&o.processEntities)for(let l=0;l<o.entities.length;l++){const i=o.entities[l];u=u.replace(i.regex,i.val)}return u}r.exports=function(u,o){let l="";return o.format&&o.indentBy.length>0&&(l="\n"),e(u,o,"",l)}},193:(r,e,t)=>{const s=t(705);function a(m,h){let g="";for(;h<m.length&&m[h]!=="'"&&m[h]!=='"';h++)g+=m[h];if(g=g.trim(),g.indexOf(" ")!==-1)throw new Error("External entites are not supported");const p=m[h++];let y="";for(;h<m.length&&m[h]!==p;h++)y+=m[h];return[g,y,h]}function n(m,h){return m[h+1]==="!"&&m[h+2]==="-"&&m[h+3]==="-"}function u(m,h){return m[h+1]==="!"&&m[h+2]==="E"&&m[h+3]==="N"&&m[h+4]==="T"&&m[h+5]==="I"&&m[h+6]==="T"&&m[h+7]==="Y"}function o(m,h){return m[h+1]==="!"&&m[h+2]==="E"&&m[h+3]==="L"&&m[h+4]==="E"&&m[h+5]==="M"&&m[h+6]==="E"&&m[h+7]==="N"&&m[h+8]==="T"}function l(m,h){return m[h+1]==="!"&&m[h+2]==="A"&&m[h+3]==="T"&&m[h+4]==="T"&&m[h+5]==="L"&&m[h+6]==="I"&&m[h+7]==="S"&&m[h+8]==="T"}function i(m,h){return m[h+1]==="!"&&m[h+2]==="N"&&m[h+3]==="O"&&m[h+4]==="T"&&m[h+5]==="A"&&m[h+6]==="T"&&m[h+7]==="I"&&m[h+8]==="O"&&m[h+9]==="N"}function c(m){if(s.isName(m))return m;throw new Error("Invalid entity name ".concat(m))}r.exports=function(m,h){const g={};if(m[h+3]!=="O"||m[h+4]!=="C"||m[h+5]!=="T"||m[h+6]!=="Y"||m[h+7]!=="P"||m[h+8]!=="E")throw new Error("Invalid Tag instead of DOCTYPE");{h+=9;let p=1,y=!1,w=!1,b="";for(;h<m.length;h++)if(m[h]!=="<"||w)if(m[h]===">"){if(w?m[h-1]==="-"&&m[h-2]==="-"&&(w=!1,p--):p--,p===0)break}else m[h]==="["?y=!0:b+=m[h];else{if(y&&u(m,h)){let f,v;h+=7,[f,v,h]=a(m,h+1),v.indexOf("&")===-1&&(g[c(f)]={regx:RegExp("&".concat(f,";"),"g"),val:v})}else if(y&&o(m,h))h+=8;else if(y&&l(m,h))h+=8;else if(y&&i(m,h))h+=9;else{if(!n)throw new Error("Invalid DOCTYPE");w=!0}p++,b=""}if(p!==0)throw new Error("Unclosed DOCTYPE")}return{entities:g,i:h}}},63:(r,e)=>{const t={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,a){return a},attributeValueProcessor:function(s,a){return a},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,a,n){return s}};e.buildOptions=function(s){return Object.assign({},t,s)},e.defaultOptions=t},299:(r,e,t)=>{const s=t(705),a=t(365),n=t(193),u=t(494),o=t(118);function l(S){const x=Object.keys(S);for(let C=0;C<x.length;C++){const I=x[C];this.lastEntities[I]={regex:new RegExp("&"+I+";","g"),val:S[I]}}}function i(S,x,C,I,P,B,D){if(S!==void 0&&(this.options.trimValues&&!I&&(S=S.trim()),S.length>0)){D||(S=this.replaceEntitiesValue(S));const V=this.options.tagValueProcessor(x,S,C,P,B);return V==null?S:typeof V!=typeof S||V!==S?V:this.options.trimValues||S.trim()===S?N(S,this.options.parseTagValue,this.options.numberParseOptions):S}}function c(S){if(this.options.removeNSPrefix){const x=S.split(":"),C=S.charAt(0)==="/"?"/":"";if(x[0]==="xmlns")return"";x.length===2&&(S=C+x[1])}return S}const m=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function h(S,x,C){if(this.options.ignoreAttributes!==!0&&typeof S=="string"){const I=s.getAllMatches(S,m),P=I.length,B={};for(let D=0;D<P;D++){const V=this.resolveNameSpace(I[D][1]);if(this.ignoreAttributesFn(V,x))continue;let K=I[D][4],M=this.options.attributeNamePrefix+V;if(V.length)if(this.options.transformAttributeName&&(M=this.options.transformAttributeName(M)),M==="__proto__"&&(M="#__proto__"),K!==void 0){this.options.trimValues&&(K=K.trim()),K=this.replaceEntitiesValue(K);const Q=this.options.attributeValueProcessor(V,K,x);B[M]=Q==null?K:typeof Q!=typeof K||Q!==K?Q:N(K,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(B[M]=!0)}if(!Object.keys(B).length)return;if(this.options.attributesGroupName){const D={};return D[this.options.attributesGroupName]=B,D}return B}}const g=function(S){S=S.replace(/\r\n?/g,"\n");const x=new a("!xml");let C=x,I="",P="";for(let B=0;B<S.length;B++)if(S[B]==="<")if(S[B+1]==="/"){const D=f(S,">",B,"Closing Tag is not closed.");let V=S.substring(B+2,D).trim();if(this.options.removeNSPrefix){const Q=V.indexOf(":");Q!==-1&&(V=V.substr(Q+1))}this.options.transformTagName&&(V=this.options.transformTagName(V)),C&&(I=this.saveTextToParentTag(I,C,P));const K=P.substring(P.lastIndexOf(".")+1);if(V&&this.options.unpairedTags.indexOf(V)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(V,">"));let M=0;K&&this.options.unpairedTags.indexOf(K)!==-1?(M=P.lastIndexOf(".",P.lastIndexOf(".")-1),this.tagsNodeStack.pop()):M=P.lastIndexOf("."),P=P.substring(0,M),C=this.tagsNodeStack.pop(),I="",B=D}else if(S[B+1]==="?"){let D=v(S,B,!1,"?>");if(!D)throw new Error("Pi Tag is not closed.");if(I=this.saveTextToParentTag(I,C,P),!(this.options.ignoreDeclaration&&D.tagName==="?xml"||this.options.ignorePiTags)){const V=new a(D.tagName);V.add(this.options.textNodeName,""),D.tagName!==D.tagExp&&D.attrExpPresent&&(V[":@"]=this.buildAttributesMap(D.tagExp,P,D.tagName)),this.addChild(C,V,P)}B=D.closeIndex+1}else if(S.substr(B+1,3)==="!--"){const D=f(S,"-->",B+4,"Comment is not closed.");if(this.options.commentPropName){const V=S.substring(B+4,D-2);I=this.saveTextToParentTag(I,C,P),C.add(this.options.commentPropName,[{[this.options.textNodeName]:V}])}B=D}else if(S.substr(B+1,2)==="!D"){const D=n(S,B);this.docTypeEntities=D.entities,B=D.i}else if(S.substr(B+1,2)==="!["){const D=f(S,"]]>",B,"CDATA is not closed.")-2,V=S.substring(B+9,D);I=this.saveTextToParentTag(I,C,P);let K=this.parseTextData(V,C.tagname,P,!0,!1,!0,!0);K==null&&(K=""),this.options.cdataPropName?C.add(this.options.cdataPropName,[{[this.options.textNodeName]:V}]):C.add(this.options.textNodeName,K),B=D+2}else{let D=v(S,B,this.options.removeNSPrefix),V=D.tagName;const K=D.rawTagName;let M=D.tagExp,Q=D.attrExpPresent,ne=D.closeIndex;this.options.transformTagName&&(V=this.options.transformTagName(V)),C&&I&&C.tagname!=="!xml"&&(I=this.saveTextToParentTag(I,C,P,!1));const Z=C;if(Z&&this.options.unpairedTags.indexOf(Z.tagname)!==-1&&(C=this.tagsNodeStack.pop(),P=P.substring(0,P.lastIndexOf("."))),V!==x.tagname&&(P+=P?"."+V:V),this.isItStopNode(this.options.stopNodes,P,V)){let z="";if(M.length>0&&M.lastIndexOf("/")===M.length-1)V[V.length-1]==="/"?(V=V.substr(0,V.length-1),P=P.substr(0,P.length-1),M=V):M=M.substr(0,M.length-1),B=D.closeIndex;else if(this.options.unpairedTags.indexOf(V)!==-1)B=D.closeIndex;else{const G=this.readStopNodeData(S,K,ne+1);if(!G)throw new Error("Unexpected end of ".concat(K));B=G.i,z=G.tagContent}const q=new a(V);V!==M&&Q&&(q[":@"]=this.buildAttributesMap(M,P,V)),z&&(z=this.parseTextData(z,V,P,!0,Q,!0,!0)),P=P.substr(0,P.lastIndexOf(".")),q.add(this.options.textNodeName,z),this.addChild(C,q,P)}else{if(M.length>0&&M.lastIndexOf("/")===M.length-1){V[V.length-1]==="/"?(V=V.substr(0,V.length-1),P=P.substr(0,P.length-1),M=V):M=M.substr(0,M.length-1),this.options.transformTagName&&(V=this.options.transformTagName(V));const z=new a(V);V!==M&&Q&&(z[":@"]=this.buildAttributesMap(M,P,V)),this.addChild(C,z,P),P=P.substr(0,P.lastIndexOf("."))}else{const z=new a(V);this.tagsNodeStack.push(C),V!==M&&Q&&(z[":@"]=this.buildAttributesMap(M,P,V)),this.addChild(C,z,P),C=z}I="",B=ne}}else I+=S[B];return x.child};function p(S,x,C){const I=this.options.updateTag(x.tagname,C,x[":@"]);I===!1||(typeof I=="string"&&(x.tagname=I),S.addChild(x))}const y=function(S){if(this.options.processEntities){for(let x in this.docTypeEntities){const C=this.docTypeEntities[x];S=S.replace(C.regx,C.val)}for(let x in this.lastEntities){const C=this.lastEntities[x];S=S.replace(C.regex,C.val)}if(this.options.htmlEntities)for(let x in this.htmlEntities){const C=this.htmlEntities[x];S=S.replace(C.regex,C.val)}S=S.replace(this.ampEntity.regex,this.ampEntity.val)}return S};function w(S,x,C,I){return S&&(I===void 0&&(I=Object.keys(x.child).length===0),(S=this.parseTextData(S,x.tagname,C,!1,!!x[":@"]&&Object.keys(x[":@"]).length!==0,I))!==void 0&&S!==""&&x.add(this.options.textNodeName,S),S=""),S}function b(S,x,C){const I="*."+C;for(const P in S){const B=S[P];if(I===B||x===B)return!0}return!1}function f(S,x,C,I){const P=S.indexOf(x,C);if(P===-1)throw new Error(I);return P+x.length-1}function v(S,x,C){const I=function(Q,ne){let Z,z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",q="";for(let G=ne;G<Q.length;G++){let F=Q[G];if(Z)F===Z&&(Z="");else if(F==='"'||F==="'")Z=F;else if(F===z[0]){if(!z[1])return{data:q,index:G};if(Q[G+1]===z[1])return{data:q,index:G}}else F==="	"&&(F=" ");q+=F}}(S,x+1,arguments.length>3&&arguments[3]!==void 0?arguments[3]:">");if(!I)return;let P=I.data;const B=I.index,D=P.search(/\s/);let V=P,K=!0;D!==-1&&(V=P.substring(0,D),P=P.substring(D+1).trimStart());const M=V;if(C){const Q=V.indexOf(":");Q!==-1&&(V=V.substr(Q+1),K=V!==I.data.substr(Q+1))}return{tagName:V,tagExp:P,closeIndex:B,attrExpPresent:K,rawTagName:M}}function k(S,x,C){const I=C;let P=1;for(;C<S.length;C++)if(S[C]==="<")if(S[C+1]==="/"){const B=f(S,">",C,"".concat(x," is not closed"));if(S.substring(C+2,B).trim()===x&&(P--,P===0))return{tagContent:S.substring(I,C),i:B};C=B}else if(S[C+1]==="?")C=f(S,"?>",C+1,"StopNode is not closed.");else if(S.substr(C+1,3)==="!--")C=f(S,"-->",C+3,"StopNode is not closed.");else if(S.substr(C+1,2)==="![")C=f(S,"]]>",C,"StopNode is not closed.")-2;else{const B=v(S,C,">");B&&((B&&B.tagName)===x&&B.tagExp[B.tagExp.length-1]!=="/"&&P++,C=B.closeIndex)}}function N(S,x,C){if(x&&typeof S=="string"){const I=S.trim();return I==="true"||I!=="false"&&u(S,C)}return s.isExist(S)?S:""}r.exports=class{constructor(S){this.options=S,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(x,C)=>String.fromCharCode(Number.parseInt(C,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(x,C)=>String.fromCharCode(Number.parseInt(C,16))}},this.addExternalEntities=l,this.parseXml=g,this.parseTextData=i,this.resolveNameSpace=c,this.buildAttributesMap=h,this.isItStopNode=b,this.replaceEntitiesValue=y,this.readStopNodeData=k,this.saveTextToParentTag=w,this.addChild=p,this.ignoreAttributesFn=o(this.options.ignoreAttributes)}}},338:(r,e,t)=>{const{buildOptions:s}=t(63),a=t(299),{prettify:n}=t(728),u=t(31);r.exports=class{constructor(o){this.externalEntities={},this.options=s(o)}parse(o,l){if(typeof o!="string"){if(!o.toString)throw new Error("XML data is accepted in String or Bytes[] form.");o=o.toString()}if(l){l===!0&&(l={});const m=u.validate(o,l);if(m!==!0)throw Error("".concat(m.err.msg,":").concat(m.err.line,":").concat(m.err.col))}const i=new a(this.options);i.addExternalEntities(this.externalEntities);const c=i.parseXml(o);return this.options.preserveOrder||c===void 0?c:n(c,this.options)}addEntity(o,l){if(l.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(o.indexOf("&")!==-1||o.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(l==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[o]=l}}},728:(r,e)=>{function t(u,o,l){let i;const c={};for(let m=0;m<u.length;m++){const h=u[m],g=s(h);let p="";if(p=l===void 0?g:l+"."+g,g===o.textNodeName)i===void 0?i=h[g]:i+=""+h[g];else{if(g===void 0)continue;if(h[g]){let y=t(h[g],o,p);const w=n(y,o);h[":@"]?a(y,h[":@"],p,o):Object.keys(y).length!==1||y[o.textNodeName]===void 0||o.alwaysCreateTextNode?Object.keys(y).length===0&&(o.alwaysCreateTextNode?y[o.textNodeName]="":y=""):y=y[o.textNodeName],c[g]!==void 0&&c.hasOwnProperty(g)?(Array.isArray(c[g])||(c[g]=[c[g]]),c[g].push(y)):o.isArray(g,p,w)?c[g]=[y]:c[g]=y}}}return typeof i=="string"?i.length>0&&(c[o.textNodeName]=i):i!==void 0&&(c[o.textNodeName]=i),c}function s(u){const o=Object.keys(u);for(let l=0;l<o.length;l++){const i=o[l];if(i!==":@")return i}}function a(u,o,l,i){if(o){const c=Object.keys(o),m=c.length;for(let h=0;h<m;h++){const g=c[h];i.isArray(g,l+"."+g,!0,!0)?u[g]=[o[g]]:u[g]=o[g]}}}function n(u,o){const{textNodeName:l}=o,i=Object.keys(u).length;return i===0||!(i!==1||!u[l]&&typeof u[l]!="boolean"&&u[l]!==0)}e.prettify=function(u,o){return t(u,o)}},365:r=>{r.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},135:r=>{function e(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}r.exports=function(t){return t!=null&&(e(t)||function(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&e(s.slice(0,0))}(t)||!!t._isBuffer)}},542:(r,e,t)=>{(function(){var s=t(298),a=t(526).utf8,n=t(135),u=t(526).bin,o=function(l,i){l.constructor==String?l=i&&i.encoding==="binary"?u.stringToBytes(l):a.stringToBytes(l):n(l)?l=Array.prototype.slice.call(l,0):Array.isArray(l)||l.constructor===Uint8Array||(l=l.toString());for(var c=s.bytesToWords(l),m=8*l.length,h=1732584193,g=-271733879,p=-1732584194,y=271733878,w=0;w<c.length;w++)c[w]=16711935&(c[w]<<8|c[w]>>>24)|4278255360&(c[w]<<24|c[w]>>>8);c[m>>>5]|=128<<m%32,c[14+(m+64>>>9<<4)]=m;var b=o._ff,f=o._gg,v=o._hh,k=o._ii;for(w=0;w<c.length;w+=16){var N=h,S=g,x=p,C=y;h=b(h,g,p,y,c[w+0],7,-680876936),y=b(y,h,g,p,c[w+1],12,-389564586),p=b(p,y,h,g,c[w+2],17,606105819),g=b(g,p,y,h,c[w+3],22,-1044525330),h=b(h,g,p,y,c[w+4],7,-176418897),y=b(y,h,g,p,c[w+5],12,1200080426),p=b(p,y,h,g,c[w+6],17,-1473231341),g=b(g,p,y,h,c[w+7],22,-45705983),h=b(h,g,p,y,c[w+8],7,1770035416),y=b(y,h,g,p,c[w+9],12,-1958414417),p=b(p,y,h,g,c[w+10],17,-42063),g=b(g,p,y,h,c[w+11],22,-1990404162),h=b(h,g,p,y,c[w+12],7,1804603682),y=b(y,h,g,p,c[w+13],12,-40341101),p=b(p,y,h,g,c[w+14],17,-1502002290),h=f(h,g=b(g,p,y,h,c[w+15],22,1236535329),p,y,c[w+1],5,-165796510),y=f(y,h,g,p,c[w+6],9,-1069501632),p=f(p,y,h,g,c[w+11],14,643717713),g=f(g,p,y,h,c[w+0],20,-373897302),h=f(h,g,p,y,c[w+5],5,-701558691),y=f(y,h,g,p,c[w+10],9,38016083),p=f(p,y,h,g,c[w+15],14,-660478335),g=f(g,p,y,h,c[w+4],20,-405537848),h=f(h,g,p,y,c[w+9],5,568446438),y=f(y,h,g,p,c[w+14],9,-1019803690),p=f(p,y,h,g,c[w+3],14,-187363961),g=f(g,p,y,h,c[w+8],20,1163531501),h=f(h,g,p,y,c[w+13],5,-1444681467),y=f(y,h,g,p,c[w+2],9,-51403784),p=f(p,y,h,g,c[w+7],14,1735328473),h=v(h,g=f(g,p,y,h,c[w+12],20,-1926607734),p,y,c[w+5],4,-378558),y=v(y,h,g,p,c[w+8],11,-2022574463),p=v(p,y,h,g,c[w+11],16,1839030562),g=v(g,p,y,h,c[w+14],23,-35309556),h=v(h,g,p,y,c[w+1],4,-1530992060),y=v(y,h,g,p,c[w+4],11,1272893353),p=v(p,y,h,g,c[w+7],16,-155497632),g=v(g,p,y,h,c[w+10],23,-1094730640),h=v(h,g,p,y,c[w+13],4,681279174),y=v(y,h,g,p,c[w+0],11,-358537222),p=v(p,y,h,g,c[w+3],16,-722521979),g=v(g,p,y,h,c[w+6],23,76029189),h=v(h,g,p,y,c[w+9],4,-640364487),y=v(y,h,g,p,c[w+12],11,-421815835),p=v(p,y,h,g,c[w+15],16,530742520),h=k(h,g=v(g,p,y,h,c[w+2],23,-995338651),p,y,c[w+0],6,-198630844),y=k(y,h,g,p,c[w+7],10,1126891415),p=k(p,y,h,g,c[w+14],15,-1416354905),g=k(g,p,y,h,c[w+5],21,-57434055),h=k(h,g,p,y,c[w+12],6,1700485571),y=k(y,h,g,p,c[w+3],10,-1894986606),p=k(p,y,h,g,c[w+10],15,-1051523),g=k(g,p,y,h,c[w+1],21,-2054922799),h=k(h,g,p,y,c[w+8],6,1873313359),y=k(y,h,g,p,c[w+15],10,-30611744),p=k(p,y,h,g,c[w+6],15,-1560198380),g=k(g,p,y,h,c[w+13],21,1309151649),h=k(h,g,p,y,c[w+4],6,-145523070),y=k(y,h,g,p,c[w+11],10,-1120210379),p=k(p,y,h,g,c[w+2],15,718787259),g=k(g,p,y,h,c[w+9],21,-343485551),h=h+N>>>0,g=g+S>>>0,p=p+x>>>0,y=y+C>>>0}return s.endian([h,g,p,y])};o._ff=function(l,i,c,m,h,g,p){var y=l+(i&c|~i&m)+(h>>>0)+p;return(y<<g|y>>>32-g)+i},o._gg=function(l,i,c,m,h,g,p){var y=l+(i&m|c&~m)+(h>>>0)+p;return(y<<g|y>>>32-g)+i},o._hh=function(l,i,c,m,h,g,p){var y=l+(i^c^m)+(h>>>0)+p;return(y<<g|y>>>32-g)+i},o._ii=function(l,i,c,m,h,g,p){var y=l+(c^(i|~m))+(h>>>0)+p;return(y<<g|y>>>32-g)+i},o._blocksize=16,o._digestsize=16,r.exports=function(l,i){if(l==null)throw new Error("Illegal argument "+l);var c=s.wordsToBytes(o(l,i));return i&&i.asBytes?c:i&&i.asString?u.bytesToString(c):s.bytesToHex(c)}})()},285:(r,e,t)=>{var s=t(2);r.exports=function(b){return b?(b.substr(0,2)==="{}"&&(b="\\{\\}"+b.substr(2)),w(function(f){return f.split("\\\\").join(a).split("\\{").join(n).split("\\}").join(u).split("\\,").join(o).split("\\.").join(l)}(b),!0).map(c)):[]};var a="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",u="\0CLOSE"+Math.random()+"\0",o="\0COMMA"+Math.random()+"\0",l="\0PERIOD"+Math.random()+"\0";function i(b){return parseInt(b,10)==b?parseInt(b,10):b.charCodeAt(0)}function c(b){return b.split(a).join("\\").split(n).join("{").split(u).join("}").split(o).join(",").split(l).join(".")}function m(b){if(!b)return[""];var f=[],v=s("{","}",b);if(!v)return b.split(",");var k=v.pre,N=v.body,S=v.post,x=k.split(",");x[x.length-1]+="{"+N+"}";var C=m(S);return S.length&&(x[x.length-1]+=C.shift(),x.push.apply(x,C)),f.push.apply(f,x),f}function h(b){return"{"+b+"}"}function g(b){return/^-?0\d/.test(b)}function p(b,f){return b<=f}function y(b,f){return b>=f}function w(b,f){var v=[],k=s("{","}",b);if(!k)return[b];var N=k.pre,S=k.post.length?w(k.post,!1):[""];if(/\$$/.test(k.pre))for(var x=0;x<S.length;x++){var C=N+"{"+k.body+"}"+S[x];v.push(C)}else{var I,P,B=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(k.body),D=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(k.body),V=B||D,K=k.body.indexOf(",")>=0;if(!V&&!K)return k.post.match(/,.*\}/)?w(b=k.pre+"{"+k.body+u+k.post):[b];if(V)I=k.body.split(/\.\./);else if((I=m(k.body)).length===1&&(I=w(I[0],!1).map(h)).length===1)return S.map(function(Gt){return k.pre+I[0]+Gt});if(V){var M=i(I[0]),Q=i(I[1]),ne=Math.max(I[0].length,I[1].length),Z=I.length==3?Math.abs(i(I[2])):1,z=p;Q<M&&(Z*=-1,z=y);var q=I.some(g);P=[];for(var G=M;z(G,Q);G+=Z){var F;if(D)(F=String.fromCharCode(G))==="\\"&&(F="");else if(F=String(G),q){var se=ne-F.length;if(se>0){var oe=new Array(se+1).join("0");F=G<0?"-"+oe+F.slice(1):oe+F}}P.push(F)}}else{P=[];for(var xe=0;xe<I.length;xe++)P.push.apply(P,w(I[xe],!1))}for(xe=0;xe<P.length;xe++)for(x=0;x<S.length;x++)C=N+P[xe]+S[x],(!f||V||C)&&v.push(C)}return v}},829:r=>{function e(i){return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},e(i)}function t(i){var c=typeof Map=="function"?new Map:void 0;return t=function(m){if(m===null||(h=m,Function.toString.call(h).indexOf("[native code]")===-1))return m;var h;if(typeof m!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(m))return c.get(m);c.set(m,g)}function g(){return s(m,arguments,n(this).constructor)}return g.prototype=Object.create(m.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),a(g,m)},t(i)}function s(i,c,m){return s=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(h){return!1}}()?Reflect.construct:function(h,g,p){var y=[null];y.push.apply(y,g);var w=new(Function.bind.apply(h,y));return p&&a(w,p.prototype),w},s.apply(null,arguments)}function a(i,c){return a=Object.setPrototypeOf||function(m,h){return m.__proto__=h,m},a(i,c)}function n(i){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},n(i)}var u=function(i){function c(m){var h;return function(g,p){if(!(g instanceof p))throw new TypeError("Cannot call a class as a function")}(this,c),(h=function(g,p){return!p||e(p)!=="object"&&typeof p!="function"?function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(g):p}(this,n(c).call(this,m))).name="ObjectPrototypeMutationError",h}return function(m,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(h&&h.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),h&&a(m,h)}(c,i),c}(t(Error));function o(i,c){for(var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},h=c.split("."),g=h.length,p=function(b){var f=h[b];if(!i)return{v:void 0};if(f==="+"){if(Array.isArray(i))return{v:i.map(function(k,N){var S=h.slice(b+1);return S.length>0?o(k,S.join("."),m):m(i,N,h,b)})};var v=h.slice(0,b).join(".");throw new Error("Object at wildcard (".concat(v,") is not an array"))}i=m(i,f,h,b)},y=0;y<g;y++){var w=p(y);if(e(w)==="object")return w.v}return i}function l(i,c){return i.length===c+1}r.exports={set:function(i,c,m){if(e(i)!="object"||i===null||c===void 0)return i;if(typeof c=="number")return i[c]=m,i[c];try{return o(i,c,function(h,g,p,y){if(h===Reflect.getPrototypeOf({}))throw new u("Attempting to mutate Object.prototype");if(!h[g]){var w=Number.isInteger(Number(p[y+1])),b=p[y+1]==="+";h[g]=w||b?[]:{}}return l(p,y)&&(h[g]=m),h[g]})}catch(h){if(h instanceof u)throw h;return i}},get:function(i,c){if(e(i)!="object"||i===null||c===void 0)return i;if(typeof c=="number")return i[c];try{return o(i,c,function(m,h){return m[h]})}catch(m){return i}},has:function(i,c){var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e(i)!="object"||i===null||c===void 0)return!1;if(typeof c=="number")return c in i;try{var h=!1;return o(i,c,function(g,p,y,w){if(!l(y,w))return g&&g[p];h=m.own?g.hasOwnProperty(p):p in g}),h}catch(g){return!1}},hasOwn:function(i,c,m){return this.has(i,c,m||{own:!0})},isIn:function(i,c,m){var h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(e(i)!="object"||i===null||c===void 0)return!1;try{var g=!1,p=!1;return o(i,c,function(y,w,b,f){return g=g||y===m||!!y&&y[w]===m,p=l(b,f)&&e(y)==="object"&&w in y,y&&y[w]}),h.validPath?g&&p:g}catch(y){return!1}},ObjectPrototypeMutationError:u}},47:(r,e,t)=>{var s=t(410),a=function(i){return typeof i=="string"};function n(i,c){for(var m=[],h=0;h<i.length;h++){var g=i[h];g&&g!=="."&&(g===".."?m.length&&m[m.length-1]!==".."?m.pop():c&&m.push(".."):m.push(g))}return m}var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o={};function l(i){return u.exec(i).slice(1)}o.resolve=function(){for(var i="",c=!1,m=arguments.length-1;m>=-1&&!c;m--){var h=m>=0?arguments[m]:We.cwd();if(!a(h))throw new TypeError("Arguments to path.resolve must be strings");h&&(i=h+"/"+i,c=h.charAt(0)==="/")}return(c?"/":"")+(i=n(i.split("/"),!c).join("/"))||"."},o.normalize=function(i){var c=o.isAbsolute(i),m=i.substr(-1)==="/";return(i=n(i.split("/"),!c).join("/"))||c||(i="."),i&&m&&(i+="/"),(c?"/":"")+i},o.isAbsolute=function(i){return i.charAt(0)==="/"},o.join=function(){for(var i="",c=0;c<arguments.length;c++){var m=arguments[c];if(!a(m))throw new TypeError("Arguments to path.join must be strings");m&&(i+=i?"/"+m:m)}return o.normalize(i)},o.relative=function(i,c){function m(f){for(var v=0;v<f.length&&f[v]==="";v++);for(var k=f.length-1;k>=0&&f[k]==="";k--);return v>k?[]:f.slice(v,k+1)}i=o.resolve(i).substr(1),c=o.resolve(c).substr(1);for(var h=m(i.split("/")),g=m(c.split("/")),p=Math.min(h.length,g.length),y=p,w=0;w<p;w++)if(h[w]!==g[w]){y=w;break}var b=[];for(w=y;w<h.length;w++)b.push("..");return(b=b.concat(g.slice(y))).join("/")},o._makeLong=function(i){return i},o.dirname=function(i){var c=l(i),m=c[0],h=c[1];return m||h?(h&&(h=h.substr(0,h.length-1)),m+h):"."},o.basename=function(i,c){var m=l(i)[2];return c&&m.substr(-1*c.length)===c&&(m=m.substr(0,m.length-c.length)),m},o.extname=function(i){return l(i)[3]},o.format=function(i){if(!s.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var c=i.root||"";if(!a(c))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+o.sep:"")+(i.base||"")},o.parse=function(i){if(!a(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var c=l(i);if(!c||c.length!==4)throw new TypeError("Invalid path '"+i+"'");return c[1]=c[1]||"",c[2]=c[2]||"",c[3]=c[3]||"",{root:c[0],dir:c[0]+c[1].slice(0,c[1].length-1),base:c[2],ext:c[3],name:c[2].slice(0,c[2].length-c[3].length)}},o.sep="/",o.delimiter=":",r.exports=o},647:(r,e)=>{var t=Object.prototype.hasOwnProperty;function s(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch(u){return null}}function a(n){try{return encodeURIComponent(n)}catch(u){return null}}e.stringify=function(n,u){u=u||"";var o,l,i=[];for(l in typeof u!="string"&&(u="?"),n)if(t.call(n,l)){if((o=n[l])||o!=null&&!isNaN(o)||(o=""),l=a(l),o=a(o),l===null||o===null)continue;i.push(l+"="+o)}return i.length?u+i.join("&"):""},e.parse=function(n){for(var u,o=/([^=?#&]+)=?([^&]*)/g,l={};u=o.exec(n);){var i=s(u[1]),c=s(u[2]);i===null||c===null||i in l||(l[i]=c)}return l}},670:r=>{r.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}},494:r=>{const e=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const s={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};r.exports=function(a){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n=Object.assign({},s,n),!a||typeof a!="string")return a;let u=a.trim();if(n.skipLike!==void 0&&n.skipLike.test(u))return a;if(n.hex&&e.test(u))return Number.parseInt(u,16);{const l=t.exec(u);if(l){const i=l[1],c=l[2];let m=((o=l[3])&&o.indexOf(".")!==-1&&((o=o.replace(/0+$/,""))==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substr(0,o.length-1))),o);const h=l[4]||l[6];if(!n.leadingZeros&&c.length>0&&i&&u[2]!=="."||!n.leadingZeros&&c.length>0&&!i&&u[1]!==".")return a;{const g=Number(u),p=""+g;return p.search(/[eE]/)!==-1||h?n.eNotation?g:a:u.indexOf(".")!==-1?p==="0"&&m===""||p===m||i&&p==="-"+m?g:a:c?m===p||i+m===p?g:a:u===p||u===i+p?g:a}}return a}var o}},737:(r,e,t)=>{var s=t(670),a=t(647),n=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,u=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,l=/:\d+$/,i=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,c=/^[a-zA-Z]:/;function m(f){return(f||"").toString().replace(n,"")}var h=[["#","hash"],["?","query"],function(f,v){return y(v.protocol)?f.replace(/\\/g,"/"):f},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],g={hash:1,query:1};function p(f){var v,k=(typeof window<"u"?window:typeof Et<"u"?Et:typeof self<"u"?self:{}).location||{},N={},S=typeof(f=f||k);if(f.protocol==="blob:")N=new b(unescape(f.pathname),{});else if(S==="string")for(v in N=new b(f,{}),g)delete N[v];else if(S==="object"){for(v in f)v in g||(N[v]=f[v]);N.slashes===void 0&&(N.slashes=o.test(f.href))}return N}function y(f){return f==="file:"||f==="ftp:"||f==="http:"||f==="https:"||f==="ws:"||f==="wss:"}function w(f,v){f=(f=m(f)).replace(u,""),v=v||{};var k,N=i.exec(f),S=N[1]?N[1].toLowerCase():"",x=!!N[2],C=!!N[3],I=0;return x?C?(k=N[2]+N[3]+N[4],I=N[2].length+N[3].length):(k=N[2]+N[4],I=N[2].length):C?(k=N[3]+N[4],I=N[3].length):k=N[4],S==="file:"?I>=2&&(k=k.slice(2)):y(S)?k=N[4]:S?x&&(k=k.slice(2)):I>=2&&y(v.protocol)&&(k=N[4]),{protocol:S,slashes:x||y(S),slashesCount:I,rest:k}}function b(f,v,k){if(f=(f=m(f)).replace(u,""),!(this instanceof b))return new b(f,v,k);var N,S,x,C,I,P,B=h.slice(),D=typeof v,V=this,K=0;for(D!=="object"&&D!=="string"&&(k=v,v=null),k&&typeof k!="function"&&(k=a.parse),N=!(S=w(f||"",v=p(v))).protocol&&!S.slashes,V.slashes=S.slashes||N&&v.slashes,V.protocol=S.protocol||v.protocol||"",f=S.rest,(S.protocol==="file:"&&(S.slashesCount!==2||c.test(f))||!S.slashes&&(S.protocol||S.slashesCount<2||!y(V.protocol)))&&(B[3]=[/(.*)/,"pathname"]);K<B.length;K++)typeof(C=B[K])!="function"?(x=C[0],P=C[1],x!=x?V[P]=f:typeof x=="string"?~(I=x==="@"?f.lastIndexOf(x):f.indexOf(x))&&(typeof C[2]=="number"?(V[P]=f.slice(0,I),f=f.slice(I+C[2])):(V[P]=f.slice(I),f=f.slice(0,I))):(I=x.exec(f))&&(V[P]=I[1],f=f.slice(0,I.index)),V[P]=V[P]||N&&C[3]&&v[P]||"",C[4]&&(V[P]=V[P].toLowerCase())):f=C(f,V);k&&(V.query=k(V.query)),N&&v.slashes&&V.pathname.charAt(0)!=="/"&&(V.pathname!==""||v.pathname!=="")&&(V.pathname=function(M,Q){if(M==="")return Q;for(var ne=(Q||"/").split("/").slice(0,-1).concat(M.split("/")),Z=ne.length,z=ne[Z-1],q=!1,G=0;Z--;)ne[Z]==="."?ne.splice(Z,1):ne[Z]===".."?(ne.splice(Z,1),G++):G&&(Z===0&&(q=!0),ne.splice(Z,1),G--);return q&&ne.unshift(""),z!=="."&&z!==".."||ne.push(""),ne.join("/")}(V.pathname,v.pathname)),V.pathname.charAt(0)!=="/"&&y(V.protocol)&&(V.pathname="/"+V.pathname),s(V.port,V.protocol)||(V.host=V.hostname,V.port=""),V.username=V.password="",V.auth&&(~(I=V.auth.indexOf(":"))?(V.username=V.auth.slice(0,I),V.username=encodeURIComponent(decodeURIComponent(V.username)),V.password=V.auth.slice(I+1),V.password=encodeURIComponent(decodeURIComponent(V.password))):V.username=encodeURIComponent(decodeURIComponent(V.auth)),V.auth=V.password?V.username+":"+V.password:V.username),V.origin=V.protocol!=="file:"&&y(V.protocol)&&V.host?V.protocol+"//"+V.host:"null",V.href=V.toString()}b.prototype={set:function(f,v,k){var N=this;switch(f){case"query":typeof v=="string"&&v.length&&(v=(k||a.parse)(v)),N[f]=v;break;case"port":N[f]=v,s(v,N.protocol)?v&&(N.host=N.hostname+":"+v):(N.host=N.hostname,N[f]="");break;case"hostname":N[f]=v,N.port&&(v+=":"+N.port),N.host=v;break;case"host":N[f]=v,l.test(v)?(v=v.split(":"),N.port=v.pop(),N.hostname=v.join(":")):(N.hostname=v,N.port="");break;case"protocol":N.protocol=v.toLowerCase(),N.slashes=!k;break;case"pathname":case"hash":if(v){var S=f==="pathname"?"/":"#";N[f]=v.charAt(0)!==S?S+v:v}else N[f]=v;break;case"username":case"password":N[f]=encodeURIComponent(v);break;case"auth":var x=v.indexOf(":");~x?(N.username=v.slice(0,x),N.username=encodeURIComponent(decodeURIComponent(N.username)),N.password=v.slice(x+1),N.password=encodeURIComponent(decodeURIComponent(N.password))):N.username=encodeURIComponent(decodeURIComponent(v))}for(var C=0;C<h.length;C++){var I=h[C];I[4]&&(N[I[1]]=N[I[1]].toLowerCase())}return N.auth=N.password?N.username+":"+N.password:N.username,N.origin=N.protocol!=="file:"&&y(N.protocol)&&N.host?N.protocol+"//"+N.host:"null",N.href=N.toString(),N},toString:function(f){f&&typeof f=="function"||(f=a.stringify);var v,k=this,N=k.host,S=k.protocol;S&&S.charAt(S.length-1)!==":"&&(S+=":");var x=S+(k.protocol&&k.slashes||y(k.protocol)?"//":"");return k.username?(x+=k.username,k.password&&(x+=":"+k.password),x+="@"):k.password?(x+=":"+k.password,x+="@"):k.protocol!=="file:"&&y(k.protocol)&&!N&&k.pathname!=="/"&&(x+="@"),(N[N.length-1]===":"||l.test(k.hostname)&&!k.port)&&(N+=":"),x+=N+k.pathname,(v=typeof k.query=="object"?f(k.query):k.query)&&(x+=v.charAt(0)!=="?"?"?"+v:v),k.hash&&(x+=k.hash),x}},b.extractProtocol=w,b.location=p,b.trimLeft=m,b.qs=a,r.exports=b},410:()=>{},388:()=>{},805:()=>{},345:()=>{},800:()=>{}},Op={};function de(r){var e=Op[r];if(e!==void 0)return e.exports;var t=Op[r]={id:r,loaded:!1,exports:{}};return Qw[r].call(t.exports,t,t.exports,de),t.loaded=!0,t.exports}de.n=r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return de.d(e,{a:e}),e},de.d=(r,e)=>{for(var t in e)de.o(e,t)&&!de.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},de.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),de.nmd=r=>(r.paths=[],r.children||(r.children=[]),r);var Wt={};de.d(Wt,{hT:()=>yt,O4:()=>Ms,Kd:()=>oy,YK:()=>ly,UU:()=>pv,Gu:()=>fg,ky:()=>kg,h4:()=>ac,ch:()=>Jh,hq:()=>Pn,i5:()=>Cg});var Zw=de(737),ey=de.n(Zw);function Qh(r){if(!pf(r))throw new Error("Parameter was not an error")}function pf(r){return!!r&&typeof r=="object"&&(e=r,Object.prototype.toString.call(e)==="[object Error]")||r instanceof Error;var e}class At extends Error{constructor(e,t){const s=[...arguments],{options:a,shortMessage:n}=function(o){let l,i="";if(o.length===0)l={};else if(pf(o[0]))l={cause:o[0]},i=o.slice(1).join(" ")||"";else if(o[0]&&typeof o[0]=="object")l=Object.assign({},o[0]),i=o.slice(1).join(" ")||"";else{if(typeof o[0]!="string")throw new Error("Invalid arguments passed to Layerr");l={},i=i=o.join(" ")||""}return{options:l,shortMessage:i}}(s);let u=n;if(a.cause&&(u="".concat(u,": ").concat(a.cause.message)),super(u),this.message=u,a.name&&typeof a.name=="string"?this.name=a.name:this.name="Layerr",a.cause&&Object.defineProperty(this,"_cause",{value:a.cause}),Object.defineProperty(this,"_info",{value:{}}),a.info&&typeof a.info=="object"&&Object.assign(this._info,a.info),Error.captureStackTrace){const o=a.constructorOpt||this.constructor;Error.captureStackTrace(this,o)}}static cause(e){return Qh(e),e._cause&&pf(e._cause)?e._cause:null}static fullStack(e){var s;Qh(e);const t=At.cause(e);return t?"".concat(e.stack,"\ncaused by: ").concat(At.fullStack(t)):(s=e.stack)!=null?s:""}static info(e){Qh(e);const t={},s=At.cause(e);return s&&Object.assign(t,At.info(s)),e._info&&Object.assign(t,e._info),t}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e="".concat(e,": ").concat(this.message)),e}}var ty=de(47),Ah=de.n(ty);const Dp="__PATH_SEPARATOR_POSIX__",Tp="__PATH_SEPARATOR_WINDOWS__";function Ce(r){try{const e=r.replace(/\//g,Dp).replace(/\\\\/g,Tp);return encodeURIComponent(e).split(Tp).join("\\\\").split(Dp).join("/")}catch(e){throw new At(e,"Failed encoding path")}}function Rp(r){return r.startsWith("/")?r:"/"+r}function Xu(r){let e=r;return e[0]!=="/"&&(e="/"+e),/^.+\/$/.test(e)&&(e=e.substr(0,e.length-1)),e}function sy(r){let e=new(ey())(r).pathname;return e.length<=0&&(e="/"),Xu(e)}function Ee(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return function(){return function(s){var a=[];if(s.length===0)return"";if(typeof s[0]!="string")throw new TypeError("Url must be a string. Received "+s[0]);if(s[0].match(/^[^/:]+:\/*$/)&&s.length>1){var n=s.shift();s[0]=n+s[0]}s[0].match(/^file:\/\/\//)?s[0]=s[0].replace(/^([^/:]+):\/*/,"$1:///"):s[0]=s[0].replace(/^([^/:]+):\/*/,"$1://");for(var u=0;u<s.length;u++){var o=s[u];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(u>0&&(o=o.replace(/^[\/]+/,"")),o=u<s.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),a.push(o))}var l=a.join("/"),i=(l=l.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return i.shift()+(i.length>0?"?":"")+i.join("&")}(typeof arguments[0]=="object"?arguments[0]:[].slice.call(arguments))}(e.reduce((s,a,n)=>((n===0||a!=="/"||a==="/"&&s[s.length-1]!=="/")&&s.push(a),s),[]))}var ry=de(542),Vo=de.n(ry);const ay="abcdef0123456789";function Lp(r,e){const t=r.url.replace("//",""),s=t.indexOf("/")==-1?"/":t.slice(t.indexOf("/")),a=r.method?r.method.toUpperCase():"GET",n=!!/(^|,)\s*auth\s*($|,)/.test(e.qop)&&"auth",u="00000000".concat(e.nc).slice(-8),o=function(h,g,p,y,w,b,f){const v=f||Vo()("".concat(g,":").concat(p,":").concat(y));return h&&h.toLowerCase()==="md5-sess"?Vo()("".concat(v,":").concat(w,":").concat(b)):v}(e.algorithm,e.username,e.realm,e.password,e.nonce,e.cnonce,e.ha1),l=Vo()("".concat(a,":").concat(s)),i=n?Vo()("".concat(o,":").concat(e.nonce,":").concat(u,":").concat(e.cnonce,":").concat(n,":").concat(l)):Vo()("".concat(o,":").concat(e.nonce,":").concat(l)),c={username:e.username,realm:e.realm,nonce:e.nonce,uri:s,qop:n,response:i,nc:u,cnonce:e.cnonce,algorithm:e.algorithm,opaque:e.opaque},m=[];for(const h in c)c[h]&&(h==="qop"||h==="nc"||h==="algorithm"?m.push("".concat(h,"=").concat(c[h])):m.push("".concat(h,'="').concat(c[h],'"')));return"Digest ".concat(m.join(", "))}function cg(r){return(r.headers&&r.headers.get("www-authenticate")||"").split(/\s/)[0].toLowerCase()==="digest"}var ny=de(101),hg=de.n(ny);function jp(r){return hg().decode(r)}function $p(r,e){var t;return"Basic ".concat((t="".concat(r,":").concat(e),hg().encode(t)))}const Sh=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:typeof window<"u"?window:globalThis,iy=Sh.fetch.bind(Sh),oy=Sh.Request,ly=Sh.Response;let yt=function(r){return r.Auto="auto",r.Digest="digest",r.None="none",r.Password="password",r.Token="token",r}({}),Ms=function(r){return r.DataTypeNoLength="data-type-no-length",r.InvalidAuthType="invalid-auth-type",r.InvalidOutputFormat="invalid-output-format",r.LinkUnsupportedAuthType="link-unsupported-auth",r.InvalidUpdateRange="invalid-update-range",r.NotSupported="not-supported",r}({});function mg(r,e,t,s,a){switch(r.authType){case yt.Auto:e&&t&&(r.headers.Authorization=$p(e,t));break;case yt.Digest:r.digest=function(u,o,l){return{username:u,password:o,ha1:l,nc:0,algorithm:"md5",hasDigestAuth:!1}}(e,t,a);break;case yt.None:break;case yt.Password:r.headers.Authorization=$p(e,t);break;case yt.Token:r.headers.Authorization="".concat((n=s).token_type," ").concat(n.access_token);break;default:throw new At({info:{code:Ms.InvalidAuthType}},"Invalid auth type: ".concat(r.authType))}var n}de(345),de(800);const Up="@@HOTPATCHER",uy=()=>{};function Zh(r){return{original:r,methods:[r],final:!1}}class cy{constructor(){this._configuration={registry:{},getEmptyAction:"null"},this.__type__=Up}get configuration(){return this._configuration}get getEmptyAction(){return this.configuration.getEmptyAction}set getEmptyAction(e){this.configuration.getEmptyAction=e}control(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e||e.__type__!==Up)throw new Error("Failed taking control of target HotPatcher instance: Invalid type or object");return Object.keys(e.configuration.registry).forEach(s=>{this.configuration.registry.hasOwnProperty(s)?t&&(this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])):this.configuration.registry[s]=Object.assign({},e.configuration.registry[s])}),e._configuration=this.configuration,this}execute(e){const t=this.get(e)||uy;for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];return t(...a)}get(e){const t=this.configuration.registry[e];if(!t)switch(this.getEmptyAction){case"null":return null;case"throw":throw new Error("Failed handling method request: No method provided for override: ".concat(e));default:throw new Error("Failed handling request which resulted in an empty method: Invalid empty-action specified: ".concat(this.getEmptyAction))}return function(){for(var s=arguments.length,a=new Array(s),n=0;n<s;n++)a[n]=arguments[n];if(a.length===0)throw new Error("Failed creating sequence: No functions provided");return function(){for(var u=arguments.length,o=new Array(u),l=0;l<u;l++)o[l]=arguments[l];let i=o;const c=this;for(;a.length>0;)i=[a.shift().apply(c,i)];return i[0]}}(...t.methods)}isPatched(e){return!!this.configuration.registry[e]}patch(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{chain:a=!1}=s;if(this.configuration.registry[e]&&this.configuration.registry[e].final)throw new Error("Failed patching '".concat(e,"': Method marked as being final"));if(typeof t!="function")throw new Error("Failed patching '".concat(e,"': Provided method is not a function"));if(a)this.configuration.registry[e]?this.configuration.registry[e].methods.push(t):this.configuration.registry[e]=Zh(t);else if(this.isPatched(e)){const{original:n}=this.configuration.registry[e];this.configuration.registry[e]=Object.assign(Zh(t),{original:n})}else this.configuration.registry[e]=Zh(t);return this}patchInline(e,t){this.isPatched(e)||this.patch(e,t);for(var s=arguments.length,a=new Array(s>2?s-2:0),n=2;n<s;n++)a[n-2]=arguments[n];return this.execute(e,...a)}plugin(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return s.forEach(n=>{this.patch(e,n,{chain:!0})}),this}restore(e){if(!this.isPatched(e))throw new Error("Failed restoring method: No method present for key: ".concat(e));if(typeof this.configuration.registry[e].original!="function")throw new Error("Failed restoring method: Original method not found or of invalid type for key: ".concat(e));return this.configuration.registry[e].methods=[this.configuration.registry[e].original],this}setFinal(e){if(!this.configuration.registry.hasOwnProperty(e))throw new Error("Failed marking '".concat(e,"' as final: No method found for key"));return this.configuration.registry[e].final=!0,this}}let em=null;function fg(){return em||(em=new cy),em}function Nh(r){return function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(r)?Object.assign({},r):Object.setPrototypeOf(Object.assign({},r),Object.getPrototypeOf(r))}function Kp(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let s=null,a=[...e];for(;a.length>0;){const n=a.shift();s=s?pg(s,n):Nh(n)}return s}function pg(r,e){const t=Nh(r);return Object.keys(e).forEach(s=>{t.hasOwnProperty(s)?Array.isArray(e[s])?t[s]=Array.isArray(t[s])?[...t[s],...e[s]]:[...e[s]]:typeof e[s]=="object"&&e[s]?t[s]=typeof t[s]=="object"&&t[s]?pg(t[s],e[s]):Nh(e[s]):t[s]=e[s]:t[s]=e[s]}),t}function hy(r){const e={};for(const t of r.keys())e[t]=r.get(t);return e}function df(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(e.length===0)return{};const s={};return e.reduce((a,n)=>(Object.keys(n).forEach(u=>{const o=u.toLowerCase();s.hasOwnProperty(o)?a[s[o]]=n[u]:(s[o]=u,a[u]=n[u])}),a),{})}de(805);const my=typeof ArrayBuffer=="function",{toString:fy}=Object.prototype;function dg(r){return my&&(r instanceof ArrayBuffer||fy.call(r)==="[object ArrayBuffer]")}function gg(r){return r!=null&&r.constructor!=null&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function _f(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function gf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const wg=_f(function(r){const e=r._digest;return delete r._digest,e.hasDigestAuth&&(r=Kp(r,{headers:{Authorization:Lp(r,e)}})),gf(kh(r),function(t){let s=!1;return a=function(u){return s?u:t},(n=function(){if(t.status==401)return e.hasDigestAuth=function(u,o){if(!cg(u))return!1;const l=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;for(;;){const i=u.headers&&u.headers.get("www-authenticate")||"",c=l.exec(i);if(!c)break;o[c[1]]=c[2]||c[3]}return o.nc+=1,o.cnonce=function(){let i="";for(let c=0;c<32;++c)i="".concat(i).concat(ay[Math.floor(16*Math.random())]);return i}(),!0}(t,e),function(){if(e.hasDigestAuth)return gf(kh(r=Kp(r,{headers:{Authorization:Lp(r,e)}})),function(u){return u.status==401?e.hasDigestAuth=!1:e.nc++,s=!0,u})}();e.nc++}())&&n.then?n.then(a):a(n);var a,n})}),py=_f(function(r,e){return gf(kh(r),function(t){return t.ok?(e.authType=yt.Password,t):t.status==401&&cg(t)?(e.authType=yt.Digest,mg(e,e.username,e.password,void 0,void 0),r._digest=e.digest,wg(r)):t})}),Xe=_f(function(r,e){return e.authType===yt.Auto?py(r,e):r._digest?wg(r):kh(r)});function _e(r,e,t){const s=Nh(r);return s.headers=df(e.headers,s.headers||{},t.headers||{}),t.data!==void 0&&(s.data=t.data),t.signal&&(s.signal=t.signal),e.httpAgent&&(s.httpAgent=e.httpAgent),e.httpsAgent&&(s.httpsAgent=e.httpsAgent),e.digest&&(s._digest=e.digest),typeof e.withCredentials=="boolean"&&(s.withCredentials=e.withCredentials),s}function kh(r){const e=fg();return e.patchInline("request",t=>e.patchInline("fetch",iy,t.url,function(s){let a={};const n={method:s.method};if(s.headers&&(a=df(a,s.headers)),s.data!==void 0){const[u,o]=function(l){if(typeof l=="string")return[l,{}];if(gg(l))return[l,{}];if(dg(l))return[l,{}];if(l&&typeof l=="object")return[JSON.stringify(l),{"content-type":"application/json"}];throw new Error("Unable to convert request body: Unexpected body type: "+typeof l)}(s.data);n.body=u,a=df(a,o)}return s.signal&&(n.signal=s.signal),s.withCredentials&&(n.credentials="include"),n.headers=a,n}(t)),r)}var dy=de(285);const Ch=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>65536)throw new TypeError("pattern is too long")},gy={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Bo=r=>r.replace(/[[\]\\-]/g,"\\$&"),Hp=r=>r.join(""),wy=(r,e)=>{const t=e;if(r.charAt(t)!=="[")throw new Error("not in a brace expression");const s=[],a=[];let n=t+1,u=!1,o=!1,l=!1,i=!1,c=t,m="";e:for(;n<r.length;){const y=r.charAt(n);if(y!=="!"&&y!=="^"||n!==t+1){if(y==="]"&&u&&!l){c=n+1;break}if(u=!0,y!=="\\"||l){if(y==="["&&!l){for(const[w,[b,f,v]]of Object.entries(gy))if(r.startsWith(w,n)){if(m)return["$.",!1,r.length-t,!0];n+=w.length,v?a.push(b):s.push(b),o=o||f;continue e}}l=!1,m?(y>m?s.push(Bo(m)+"-"+Bo(y)):y===m&&s.push(Bo(y)),m="",n++):r.startsWith("-]",n+1)?(s.push(Bo(y+"-")),n+=2):r.startsWith("-",n+1)?(m=y,n+=2):(s.push(Bo(y)),n++)}else l=!0,n++}else i=!0,n++}if(c<n)return["",!1,0,!1];if(!s.length&&!a.length)return["$.",!1,r.length-t,!0];if(a.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!i)return[(h=s[0].length===2?s[0].slice(-1):s[0],h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,c-t,!1];var h;const g="["+(i?"^":"")+Hp(s)+"]",p="["+(i?"":"^")+Hp(a)+"]";return[s.length&&a.length?"("+g+"|"+p+")":s.length?g:p,o,c-t,!0]},qo=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/\[([^\/\\])\]/g,"$1"):r.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1")},yy=new Set(["!","?","+","*","@"]),Mp=r=>yy.has(r),tm="(?!\\.)",vy=new Set(["[","."]),by=new Set(["..","."]),Ay=new Set("().*{}+?[]^$\\!"),Yf="[^/]",Jp=Yf+"*?",Fp=Yf+"+?";var qe,Ze,Bs,be,Ke,Fr,yn,qr,us,vn,rc,Bn,yg,ra,Uc,wf,vg;const ft=class ft{constructor(e,t){kt(this,Bn);Ue(this,"type");kt(this,qe);kt(this,Ze);kt(this,Bs,!1);kt(this,be,[]);kt(this,Ke);kt(this,Fr);kt(this,yn);kt(this,qr,!1);kt(this,us);kt(this,vn);kt(this,rc,!1);let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.type=e,e&&Be(this,Ze,!0),Be(this,Ke,t),Be(this,qe,J(this,Ke)?J(J(this,Ke),qe):this),Be(this,us,J(this,qe)===this?s:J(J(this,qe),us)),Be(this,yn,J(this,qe)===this?[]:J(J(this,qe),yn)),e!=="!"||J(J(this,qe),qr)||J(this,yn).push(this),Be(this,Fr,J(this,Ke)?J(J(this,Ke),be).length:0)}get hasMagic(){if(J(this,Ze)!==void 0)return J(this,Ze);for(const e of J(this,be))if(typeof e!="string"&&(e.type||e.hasMagic))return Be(this,Ze,!0);return J(this,Ze)}toString(){return J(this,vn)!==void 0?J(this,vn):this.type?Be(this,vn,this.type+"("+J(this,be).map(e=>String(e)).join("|")+")"):Be(this,vn,J(this,be).map(e=>String(e)).join(""))}push(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];for(const a of t)if(a!==""){if(typeof a!="string"&&!(a instanceof ft&&J(a,Ke)===this))throw new Error("invalid part: "+a);J(this,be).push(a)}}toJSON(){var t;const e=this.type===null?J(this,be).slice().map(s=>typeof s=="string"?s:s.toJSON()):[this.type,...J(this,be).map(s=>s.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===J(this,qe)||J(J(this,qe),qr)&&((t=J(this,Ke))==null?void 0:t.type)==="!")&&e.push({}),e}isStart(){var t;if(J(this,qe)===this)return!0;if(!((t=J(this,Ke))!=null&&t.isStart()))return!1;if(J(this,Fr)===0)return!0;const e=J(this,Ke);for(let s=0;s<J(this,Fr);s++){const a=J(e,be)[s];if(!(a instanceof ft&&a.type==="!"))return!1}return!0}isEnd(){var t,s,a;if(J(this,qe)===this||((t=J(this,Ke))==null?void 0:t.type)==="!")return!0;if(!((s=J(this,Ke))!=null&&s.isEnd()))return!1;if(!this.type)return(a=J(this,Ke))==null?void 0:a.isEnd();const e=J(this,Ke)?J(J(this,Ke),be).length:0;return J(this,Fr)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new ft(this.type,e);for(const s of J(this,be))t.copyIn(s);return t}static fromGlob(e){var a;let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new ft(null,void 0,t);return Ws(a=ft,ra,Uc).call(a,e,s,0,t),s}toMMPattern(){if(this!==J(this,qe))return J(this,qe).toMMPattern();const e=this.toString(),[t,s,a,n]=this.toRegExpSource();if(!(a||J(this,Ze)||J(this,us).nocase&&!J(this,us).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return s;const u=(J(this,us).nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp("^".concat(t,"$"),u),{_src:t,_glob:e})}get options(){return J(this,us)}toRegExpSource(e){var l;const t=e!=null?e:!!J(this,us).dot;if(J(this,qe)===this&&Ws(this,Bn,yg).call(this),!this.type){const i=this.isStart()&&this.isEnd(),c=J(this,be).map(g=>{var f;const[p,y,w,b]=typeof g=="string"?Ws(f=ft,ra,vg).call(f,g,J(this,Ze),i):g.toRegExpSource(e);return Be(this,Ze,J(this,Ze)||w),Be(this,Bs,J(this,Bs)||b),p}).join("");let m="";if(this.isStart()&&typeof J(this,be)[0]=="string"&&(J(this,be).length!==1||!by.has(J(this,be)[0]))){const g=vy,p=t&&g.has(c.charAt(0))||c.startsWith("\\.")&&g.has(c.charAt(2))||c.startsWith("\\.\\.")&&g.has(c.charAt(4)),y=!t&&!e&&g.has(c.charAt(0));m=p?"(?!(?:^|/)\\.\\.?(?:$|/))":y?tm:""}let h="";return this.isEnd()&&J(J(this,qe),qr)&&((l=J(this,Ke))==null?void 0:l.type)==="!"&&(h="(?:$|\\/)"),[m+c+h,qo(c),Be(this,Ze,!!J(this,Ze)),J(this,Bs)]}const s=this.type==="*"||this.type==="+",a=this.type==="!"?"(?:(?!(?:":"(?:";let n=Ws(this,Bn,wf).call(this,t);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){const i=this.toString();return Be(this,be,[i]),this.type=null,Be(this,Ze,void 0),[i,qo(this.toString()),!1,!1]}let u=!s||e||t?"":Ws(this,Bn,wf).call(this,!0);u===n&&(u=""),u&&(n="(?:".concat(n,")(?:").concat(u,")*?"));let o="";return o=this.type==="!"&&J(this,rc)?(this.isStart()&&!t?tm:"")+Fp:a+n+(this.type==="!"?"))"+(!this.isStart()||t||e?"":tm)+Jp+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&u?")":this.type==="*"&&u?")?":")".concat(this.type)),[o,qo(n),Be(this,Ze,!!J(this,Ze)),J(this,Bs)]}};qe=new WeakMap,Ze=new WeakMap,Bs=new WeakMap,be=new WeakMap,Ke=new WeakMap,Fr=new WeakMap,yn=new WeakMap,qr=new WeakMap,us=new WeakMap,vn=new WeakMap,rc=new WeakMap,Bn=new WeakSet,yg=function(){if(this!==J(this,qe))throw new Error("should only call on root");if(J(this,qr))return this;let e;for(this.toString(),Be(this,qr,!0);e=J(this,yn).pop();){if(e.type!=="!")continue;let t=e,s=J(t,Ke);for(;s;){for(let a=J(t,Fr)+1;!s.type&&a<J(s,be).length;a++)for(const n of J(e,be)){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(J(s,be)[a])}t=s,s=J(t,Ke)}}return this},ra=new WeakSet,Uc=function(e,t,s,a){var g,p;let n=!1,u=!1,o=-1,l=!1;if(t.type===null){let y=s,w="";for(;y<e.length;){const b=e.charAt(y++);if(n||b==="\\")n=!n,w+=b;else if(u)y===o+1?b!=="^"&&b!=="!"||(l=!0):b!=="]"||y===o+2&&l||(u=!1),w+=b;else if(b!=="[")if(a.noext||!Mp(b)||e.charAt(y)!=="(")w+=b;else{t.push(w),w="";const f=new ft(b,t);y=Ws(g=ft,ra,Uc).call(g,e,f,y,a),t.push(f)}else u=!0,o=y,l=!1,w+=b}return t.push(w),y}let i=s+1,c=new ft(null,t);const m=[];let h="";for(;i<e.length;){const y=e.charAt(i++);if(n||y==="\\")n=!n,h+=y;else if(u)i===o+1?y!=="^"&&y!=="!"||(l=!0):y!=="]"||i===o+2&&l||(u=!1),h+=y;else if(y!=="[")if(Mp(y)&&e.charAt(i)==="("){c.push(h),h="";const w=new ft(y,c);c.push(w),i=Ws(p=ft,ra,Uc).call(p,e,w,i,a)}else if(y!=="|"){if(y===")")return h===""&&J(t,be).length===0&&Be(t,rc,!0),c.push(h),h="",t.push(...m,c),i;h+=y}else c.push(h),h="",m.push(c),c=new ft(null,t);else u=!0,o=i,l=!1,h+=y}return t.type=null,Be(t,Ze,void 0),Be(t,be,[e.substring(s-1)]),i},wf=function(e){return J(this,be).map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[s,a,n,u]=t.toRegExpSource(e);return Be(this,Bs,J(this,Bs)||u),s}).filter(t=>!(this.isStart()&&this.isEnd()&&!t)).join("|")},vg=function(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=!1,n="",u=!1;for(let o=0;o<e.length;o++){const l=e.charAt(o);if(a)a=!1,n+=(Ay.has(l)?"\\":"")+l;else if(l!=="\\"){if(l==="["){const[i,c,m,h]=wy(e,o);if(m){n+=i,u=u||c,o+=m-1,t=t||h;continue}}l!=="*"?l!=="?"?n+=l.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(n+=Yf,t=!0):(n+=s&&e==="*"?Fp:Jp,t=!0)}else o===e.length-1?n+="\\\\":a=!0}return[n,qo(e),!!t,u]},kt(ft,ra);let Eh=ft;const mt=function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Ch(e),!(!t.nocomment&&e.charAt(0)==="#")&&new xh(e,t).match(r)},Sy=/^\*+([^+@!?\*\[\(]*)$/,Ny=r=>e=>!e.startsWith(".")&&e.endsWith(r),ky=r=>e=>e.endsWith(r),Cy=r=>(r=r.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(r)),Ey=r=>(r=r.toLowerCase(),e=>e.toLowerCase().endsWith(r)),xy=/^\*+\.\*+$/,Iy=r=>!r.startsWith(".")&&r.includes("."),Vy=r=>r!=="."&&r!==".."&&r.includes("."),By=/^\.\*+$/,Py=r=>r!=="."&&r!==".."&&r.startsWith("."),Oy=/^\*+$/,Dy=r=>r.length!==0&&!r.startsWith("."),Ty=r=>r.length!==0&&r!=="."&&r!=="..",Ry=/^\?+([^+@!?\*\[\(]*)?$/,Ly=r=>{let[e,t=""]=r;const s=bg([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},jy=r=>{let[e,t=""]=r;const s=Ag([e]);return t?(t=t.toLowerCase(),a=>s(a)&&a.toLowerCase().endsWith(t)):s},$y=r=>{let[e,t=""]=r;const s=Ag([e]);return t?a=>s(a)&&a.endsWith(t):s},Uy=r=>{let[e,t=""]=r;const s=bg([e]);return t?a=>s(a)&&a.endsWith(t):s},bg=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&!s.startsWith(".")},Ag=r=>{let[e]=r;const t=e.length;return s=>s.length===t&&s!=="."&&s!==".."},Sg=typeof We=="object"&&We?typeof Yh=="object"&&Yh&&Yh.__MINIMATCH_TESTING_PLATFORM__||We.platform:"posix";mt.sep=Sg==="win32"?"\\":"/";const $t=Symbol("globstar **");mt.GLOBSTAR=$t,mt.filter=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return t=>mt(t,r,e)};const Lt=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.assign({},r,e)};mt.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return mt;const e=mt;return Object.assign(function(t,s){return e(t,s,Lt(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))},{Minimatch:class extends e.Minimatch{constructor(t){super(t,Lt(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}))}static defaults(t){return e.defaults(Lt(r,t)).Minimatch}},AST:class extends e.AST{constructor(t,s){super(t,s,Lt(r,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))}static fromGlob(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.AST.fromGlob(t,Lt(r,s))}},unescape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.unescape(t,Lt(r,s))},escape:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.escape(t,Lt(r,s))},filter:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.filter(t,Lt(r,s))},defaults:t=>e.defaults(Lt(r,t)),makeRe:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.makeRe(t,Lt(r,s))},braceExpand:function(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.braceExpand(t,Lt(r,s))},match:function(t,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e.match(t,s,Lt(r,a))},sep:e.sep,GLOBSTAR:$t})};const Ng=function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ch(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:dy(r)};mt.braceExpand=Ng,mt.makeRe=function(r){return new xh(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).makeRe()},mt.match=function(r,e){const t=new xh(e,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{});return r=r.filter(s=>t.match(s)),t.options.nonull&&!r.length&&r.push(e),r};const qp=/[?*]|[+@!]\(.*?\)|\[|\]/;class xh{constructor(e){Ue(this,"options");Ue(this,"set");Ue(this,"pattern");Ue(this,"windowsPathsNoEscape");Ue(this,"nonegate");Ue(this,"negate");Ue(this,"comment");Ue(this,"empty");Ue(this,"preserveMultipleSlashes");Ue(this,"partial");Ue(this,"globSet");Ue(this,"globParts");Ue(this,"nocase");Ue(this,"isWindows");Ue(this,"platform");Ue(this,"windowsNoMagicRoot");Ue(this,"regexp");let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ch(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||Sg,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#")return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=function(){return console.error(...arguments)}),this.debug(this.pattern,this.globSet);const s=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let a=this.globParts.map((n,u,o)=>{if(this.isWindows&&this.windowsNoMagicRoot){const l=!(n[0]!==""||n[1]!==""||n[2]!=="?"&&qp.test(n[2])||qp.test(n[3])),i=/^[a-z]:/i.test(n[0]);if(l)return[...n.slice(0,4),...n.slice(4).map(c=>this.parse(c))];if(i)return[n[0],...n.slice(1).map(c=>this.parse(c))]}return n.map(l=>this.parse(l))});if(this.debug(this.pattern,a),this.set=a.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){const u=this.set[n];u[0]===""&&u[1]===""&&this.globParts[n][2]==="?"&&typeof u[3]=="string"&&/^[a-z]:$/i.test(u[3])&&(u[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)e[s][a]==="**"&&(e[s][a]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let s=-1;for(;(s=t.indexOf("**",s+1))!==-1;){let a=s;for(;t[a+1]==="**";)a++;a!==s&&t.splice(s,a-s)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((s,a)=>{const n=s[s.length-1];return a==="**"&&n==="**"?s:a===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(s.pop(),s):(s.push(a),s)},[])).length===0?[""]:t)}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let a=1;a<e.length-1;a++){const n=e[a];a===1&&n===""&&e[0]===""||n!=="."&&n!==""||(t=!0,e.splice(a,1),a--)}e[0]!=="."||e.length!==2||e[1]!=="."&&e[1]!==""||(t=!0,e.pop())}let s=0;for(;(s=e.indexOf("..",s+1))!==-1;){const a=e[s-1];a&&a!=="."&&a!==".."&&a!=="**"&&(t=!0,e.splice(s-1,2),s-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let s of e){let a=-1;for(;(a=s.indexOf("**",a+1))!==-1;){let u=a;for(;s[u+1]==="**";)u++;u>a&&s.splice(a+1,u-a);let o=s[a+1];const l=s[a+2],i=s[a+3];if(o!==".."||!l||l==="."||l===".."||!i||i==="."||i==="..")continue;t=!0,s.splice(a,1);const c=s.slice(0);c[a]="**",e.push(c),a--}if(!this.preserveMultipleSlashes){for(let u=1;u<s.length-1;u++){const o=s[u];u===1&&o===""&&s[0]===""||o!=="."&&o!==""||(t=!0,s.splice(u,1),u--)}s[0]!=="."||s.length!==2||s[1]!=="."&&s[1]!==""||(t=!0,s.pop())}let n=0;for(;(n=s.indexOf("..",n+1))!==-1;){const u=s[n-1];if(u&&u!=="."&&u!==".."&&u!=="**"){t=!0;const o=n===1&&s[n+1]==="**"?["."]:[];s.splice(n-1,2,...o),s.length===0&&s.push(""),n-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let s=t+1;s<e.length;s++){const a=this.partsMatch(e[t],e[s],!this.preserveMultipleSlashes);if(a){e[t]=[],e[s]=a;break}}return e.filter(t=>t.length)}partsMatch(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=0,n=0,u=[],o="";for(;a<e.length&&n<t.length;)if(e[a]===t[n])u.push(o==="b"?t[n]:e[a]),a++,n++;else if(s&&e[a]==="**"&&t[n]===e[a+1])u.push(e[a]),a++;else if(s&&t[n]==="**"&&e[a]===t[n+1])u.push(t[n]),n++;else if(e[a]!=="*"||!t[n]||!this.options.dot&&t[n].startsWith(".")||t[n]==="**"){if(t[n]!=="*"||!e[a]||!this.options.dot&&e[a].startsWith(".")||e[a]==="**"||o==="a")return!1;o="b",u.push(t[n]),a++,n++}else{if(o==="b")return!1;o="a",u.push(e[a]),a++,n++}return e.length===t.length&&u}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let a=0;a<e.length&&e.charAt(a)==="!";a++)t=!t,s++;s&&(this.pattern=e.slice(s)),this.negate=t}matchOne(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const a=this.options;if(this.isWindows){const y=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),w=!y&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),b=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),f=w?3:y?0:void 0,v=!b&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3])?3:b?0:void 0;if(typeof f=="number"&&typeof v=="number"){const[k,N]=[e[f],t[v]];k.toLowerCase()===N.toLowerCase()&&(t[v]=k,v>f?t=t.slice(v):f>v&&(e=e.slice(f)))}}const{optimizationLevel:n=1}=this.options;n>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var u=0,o=0,l=e.length,i=t.length;u<l&&o<i;u++,o++){this.debug("matchOne loop");var c=t[o],m=e[u];if(this.debug(t,c,m),c===!1)return!1;if(c===$t){this.debug("GLOBSTAR",[t,c,m]);var h=u,g=o+1;if(g===i){for(this.debug("** at the end");u<l;u++)if(e[u]==="."||e[u]===".."||!a.dot&&e[u].charAt(0)===".")return!1;return!0}for(;h<l;){var p=e[h];if(this.debug("\nglobstar while",e,h,t,g,p),this.matchOne(e.slice(h),t.slice(g),s))return this.debug("globstar found match!",h,l,p),!0;if(p==="."||p===".."||!a.dot&&p.charAt(0)==="."){this.debug("dot detected!",e,h,t,g);break}this.debug("globstar swallow a segment, and continue"),h++}return!(!s||(this.debug("\n>>> no match, partial?",e,h,t,g),h!==l))}let y;if(typeof c=="string"?(y=m===c,this.debug("string match",c,m,y)):(y=c.test(m),this.debug("pattern match",c,m,y)),!y)return!1}if(u===l&&o===i)return!0;if(u===l)return s;if(o===i)return u===l-1&&e[u]==="";throw new Error("wtf?")}braceExpand(){return Ng(this.pattern,this.options)}parse(e){Ch(e);const t=this.options;if(e==="**")return $t;if(e==="")return"";let s,a=null;(s=e.match(Oy))?a=t.dot?Ty:Dy:(s=e.match(Sy))?a=(t.nocase?t.dot?Ey:Cy:t.dot?ky:Ny)(s[1]):(s=e.match(Ry))?a=(t.nocase?t.dot?jy:Ly:t.dot?$y:Uy)(s):(s=e.match(xy))?a=t.dot?Vy:Iy:(s=e.match(By))&&(a=Py);const n=Eh.fromGlob(e,this.options).toMMPattern();return a&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:a}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",a=new Set(t.nocase?["i"]:[]);let n=e.map(l=>{const i=l.map(c=>{if(c instanceof RegExp)for(const m of c.flags.split(""))a.add(m);return typeof c=="string"?c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):c===$t?$t:c._src});return i.forEach((c,m)=>{const h=i[m+1],g=i[m-1];c===$t&&g!==$t&&(g===void 0?h!==void 0&&h!==$t?i[m+1]="(?:\\/|"+s+"\\/)?"+h:i[m]=s:h===void 0?i[m-1]=g+"(?:\\/|"+s+")?":h!==$t&&(i[m-1]=g+"(?:\\/|\\/"+s+"\\/)"+h,i[m+1]=$t))}),i.filter(c=>c!==$t).join("/")}).join("|");const[u,o]=e.length>1?["(?:",")"]:["",""];n="^"+u+n+o+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...a].join(""))}catch(l){this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.partial;if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const s=this.options;this.isWindows&&(e=e.split("\\").join("/"));const a=this.slashSplit(e);this.debug(this.pattern,"split",a);const n=this.set;this.debug(this.pattern,"set",n);let u=a[a.length-1];if(!u)for(let o=a.length-2;!u&&o>=0;o--)u=a[o];for(let o=0;o<n.length;o++){const l=n[o];let i=a;if(s.matchBase&&l.length===1&&(i=[u]),this.matchOne(i,l,t))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(e){return mt.defaults(e).Minimatch}}function Qf(r){const e=new Error("".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"","Invalid response: ").concat(r.status," ").concat(r.statusText));return e.status=r.status,e.response=r,e}function Ye(r,e){const{status:t}=e;if(t===401&&r.digest)return e;if(t>=400)throw Qf(e);return e}function Pn(r,e){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?{data:e,headers:r.headers?hy(r.headers):{},status:r.status,statusText:r.statusText}:e}mt.AST=Eh,mt.Minimatch=xh,mt.escape=function(r){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?r.replace(/[?*()[\]]/g,"[$&]"):r.replace(/[?*()[\]\\]/g,"\\$&")},mt.unescape=qo;const Ky=(Wp=function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=_e({url:Ee(r.remoteURL,Ce(e)),method:"COPY",headers:{Destination:Ee(r.remoteURL,Ce(t)),Overwrite:s.overwrite===!1?"F":"T",Depth:s.shallow?"0":"infinity"}},r,s);return u=function(o){Ye(r,o)},(n=Xe(a,r))&&n.then||(n=Promise.resolve(n)),u?n.then(u):n;var n,u},function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];try{return Promise.resolve(Wp.apply(this,r))}catch(t){return Promise.reject(t)}});var Wp,Zf=de(635),Hy=de(829),Vs=de.n(Hy),lo=function(r){return r.Array="array",r.Object="object",r.Original="original",r}(lo||{});function lc(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:lo.Original;const s=Vs().get(r,e);return t==="array"&&Array.isArray(s)===!1?[s]:t==="object"&&Array.isArray(s)?s[0]:s}function ac(r){return new Promise(e=>{e(function(t){const{multistatus:s}=t;if(s==="")return{multistatus:{response:[]}};if(!s)throw new Error("Invalid response: No root multistatus found");const a={multistatus:Array.isArray(s)?s[0]:s};return Vs().set(a,"multistatus.response",lc(a,"multistatus.response",lo.Array)),Vs().set(a,"multistatus.response",Vs().get(a,"multistatus.response").map(n=>function(u){const o=Object.assign({},u);return o.status?Vs().set(o,"status",lc(o,"status",lo.Object)):(Vs().set(o,"propstat",lc(o,"propstat",lo.Object)),Vs().set(o,"propstat.prop",lc(o,"propstat.prop",lo.Object))),o}(n))),a}(new Zf.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",textNodeName:"text",ignoreAttributes:!1,removeNSPrefix:!0,numberParseOptions:{hex:!0,leadingZeros:!1},attributeValueProcessor:(t,s,a)=>s==="true"||s==="false"?s==="true":s,tagValueProcessor(t,s,a){if(!a.endsWith("propstat.prop.displayname"))return s}}).parse(r)))})}function Jh(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const{getlastmodified:s=null,getcontentlength:a="0",resourcetype:n=null,getcontenttype:u=null,getetag:o=null}=r,l=n&&typeof n=="object"&&n.collection!==void 0?"directory":"file",i={filename:e,basename:Ah().basename(e),lastmod:s,size:parseInt(a,10),type:l,etag:typeof o=="string"?o.replace(/"/g,""):null};return l==="file"&&(i.mime=u&&typeof u=="string"?u.split(";")[0]:""),t&&(r.displayname!==void 0&&(r.displayname=String(r.displayname)),i.props=r),i}function kg(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=null;try{r.multistatus.response[0].propstat&&(s=r.multistatus.response[0])}catch(c){}if(!s)throw new Error("Failed getting item stat: bad response");const{propstat:{prop:a,status:n}}=s,[u,o,l]=n.split(" ",3),i=parseInt(o,10);if(i>=400){const c=new Error("Invalid response: ".concat(i," ").concat(l));throw c.status=i,c}return Jh(a,Xu(e),t)}function Cg(r){switch(String(r)){case"-3":return"unlimited";case"-2":case"-1":return"unknown";default:return parseInt(String(r),10)}}function sm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const ep=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=_e({url:Ee(r.remoteURL,Ce(e)),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,t);return sm(Xe(a,r),function(n){return Ye(r,n),sm(n.text(),function(u){return sm(ac(u),function(o){const l=kg(o,e,s);return Pn(n,l,s)})})})});function Eg(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const My=xg(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=function(n){if(!n||n==="/")return[];let u=n;const o=[];do o.push(u),u=Ah().dirname(u);while(u&&u!=="/");return o}(Xu(e));s.sort((n,u)=>n.length>u.length?1:u.length>n.length?-1:0);let a=!1;return function(n,u,o){if(typeof n[zp]=="function"){let y=function(w){try{for(;!(l=m.next()).done;)if((w=u(l.value))&&w.then){if(!Xp(w))return void w.then(y,c||(c=vt.bind(null,i=new uo,2)));w=w.v}i?vt(i,1,w):i=w}catch(b){vt(i||(i=new uo),2,b)}};var l,i,c,m=n[zp]();if(y(),m.return){var h=function(w){try{l.done||m.return()}catch(b){}return w};if(i&&i.then)return i.then(h,function(w){throw h(w)});h()}return i}if(!("length"in n))throw new TypeError("Object is not iterable");for(var g=[],p=0;p<n.length;p++)g.push(n[p]);return function(y,w,b){var f,v,k=-1;return function N(S){try{for(;++k<y.length&&(!b||!b());)if((S=w(k))&&S.then){if(!Xp(S))return void S.then(N,v||(v=vt.bind(null,f=new uo,2)));S=S.v}f?vt(f,1,S):f=S}catch(x){vt(f||(f=new uo),2,x)}}(),f}(g,function(y){return u(g[y])},o)}(s,function(n){return u=function(){return function(l,i){try{var c=Eg(ep(r,n),function(m){if(m.type!=="directory")throw new Error("Path includes a file: ".concat(e))})}catch(m){return i(m)}return c&&c.then?c.then(void 0,i):c}(0,function(l){const i=l;return function(){if(i.status===404)return a=!0,Gp(yf(r,n,ns(nt({},t),{recursive:!1})));throw l}()})},(o=function(){if(a)return Gp(yf(r,n,ns(nt({},t),{recursive:!1})))}())&&o.then?o.then(u):u();var u,o},function(){return!1})});function xg(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}function Jy(){}function Gp(r,e){return r&&r.then?r.then(Jy):Promise.resolve()}const zp=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function vt(r,e,t){if(!r.s){if(t instanceof uo){if(!t.s)return void(t.o=vt.bind(null,r,e));1&e&&(e=t.s),t=t.v}if(t&&t.then)return void t.then(vt.bind(null,r,e),vt.bind(null,r,2));r.s=e,r.v=t;const s=r.o;s&&s(r)}}const uo=function(){function r(){}return r.prototype.then=function(e,t){const s=new r,a=this.s;if(a){const n=1&a?e:t;if(n){try{vt(s,1,n(this.v))}catch(u){vt(s,2,u)}return s}return this}return this.o=function(n){try{const u=n.v;1&n.s?vt(s,1,e?e(u):u):t?vt(s,1,t(u)):vt(s,2,u)}catch(u){vt(s,2,u)}},s},r}();function Xp(r){return r instanceof uo&&1&r.s}const yf=xg(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.recursive===!0)return My(r,e,t);const s=_e({url:Ee(r.remoteURL,(a=Ce(e),a.endsWith("/")?a:a+"/")),method:"MKCOL"},r,t);var a;return Eg(Xe(s,r),function(n){Ye(r,n)})});var Fy=de(388),_p=de.n(Fy);const qy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s={};if(typeof t.range=="object"&&typeof t.range.start=="number"){let o="bytes=".concat(t.range.start,"-");typeof t.range.end=="number"&&(o="".concat(o).concat(t.range.end)),s.Range=o}const a=_e({url:Ee(r.remoteURL,Ce(e)),method:"GET",headers:s},r,t);return u=function(o){if(Ye(r,o),s.Range&&o.status!==206){const l=new Error("Invalid response code for partial request: ".concat(o.status));throw l.status=o.status,l}return t.callback&&setTimeout(()=>{t.callback(o)},0),o.body},(n=Xe(a,r))&&n.then||(n=Promise.resolve(n)),u?n.then(u):n;var n,u}),Wy=()=>{},Gy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){t.url||(t.url=Ee(r.remoteURL,Ce(e)));const s=_e(t,r,{});return n=function(u){return Ye(r,u),u},(a=Xe(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),zy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=_e({url:Ee(r.remoteURL,Ce(e)),method:"DELETE"},r,t);return n=function(u){Ye(r,u)},(a=Xe(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),Xy=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function(s,a){try{var n=(u=ep(r,e,t),o=function(){return!0},l?o?o(u):u:(u&&u.then||(u=Promise.resolve(u)),o?u.then(o):u))}catch(i){return a(i)}var u,o,l;return n&&n.then?n.then(void 0,a):n}(0,function(s){if(s.status===404)return!1;throw s})});function rm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const _y=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=_e({url:Ee(r.remoteURL,Ce(e),"/"),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:t.deep?"infinity":"1"}},r,t);return rm(Xe(s,r),function(a){return Ye(r,a),rm(a.text(),function(n){if(!n)throw new Error("Failed parsing directory contents: Empty response");return rm(ac(n),function(u){const o=Rp(e);let l=function(i,c,m){let h=arguments.length>3&&arguments[3]!==void 0&&arguments[3],g=arguments.length>4&&arguments[4]!==void 0&&arguments[4];const p=Ah().join(c,"/"),{multistatus:{response:y}}=i,w=y.map(b=>{const f=function(k){try{return k.replace(/^https?:\/\/[^\/]+/,"")}catch(N){throw new At(N,"Failed normalising HREF")}}(b.href),{propstat:{prop:v}}=b;return Jh(v,p==="/"?decodeURIComponent(Xu(f)):Xu(Ah().relative(decodeURIComponent(p),decodeURIComponent(f))),h)});return g?w:w.filter(b=>b.basename&&(b.type==="file"||b.filename!==m.replace(/\/$/,"")))}(u,Rp(r.remoteBasePath||r.remotePath),o,t.details,t.includeSelf);return t.glob&&(l=function(i,c){return i.filter(m=>mt(m.filename,c,{matchBase:!0}))}(l,t.glob)),Pn(a,l,t.details)})})})});function tp(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const Yy=tp(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=_e({url:Ee(r.remoteURL,Ce(e)),method:"GET",headers:{Accept:"text/plain"},transformResponse:[ev]},r,t);return Ih(Xe(s,r),function(a){return Ye(r,a),Ih(a.text(),function(n){return Pn(a,n,t.details)})})});function Ih(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const Qy=tp(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=_e({url:Ee(r.remoteURL,Ce(e)),method:"GET"},r,t);return Ih(Xe(s,r),function(a){let n;return Ye(r,a),function(u,o){var l=u();return l&&l.then?l.then(o):o()}(function(){return Ih(a.arrayBuffer(),function(u){n=u})},function(){return Pn(a,n,t.details)})})}),Zy=tp(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{format:s="binary"}=t;if(s!=="binary"&&s!=="text")throw new At({info:{code:Ms.InvalidOutputFormat}},"Invalid output format: ".concat(s));return s==="text"?Yy(r,e,t):Qy(r,e,t)}),ev=r=>r;function tv(r){return new Zf.XMLBuilder({attributeNamePrefix:"@_",format:!0,ignoreAttributes:!1,suppressEmptyNode:!0}).build(Ig({lockinfo:{"@_xmlns:d":"DAV:",lockscope:{exclusive:{}},locktype:{write:{}},owner:{href:r}}},"d"))}function Ig(r,e){const t=nt({},r);for(const s in t)t.hasOwnProperty(s)&&(t[s]&&typeof t[s]=="object"&&s.indexOf(":")===-1?(t["".concat(e,":").concat(s)]=Ig(t[s],e),delete t[s]):/^@_/.test(s)===!1&&(t["".concat(e,":").concat(s)]=t[s],delete t[s]));return t}function vf(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}function Vg(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const sv=Vg(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=_e({url:Ee(r.remoteURL,Ce(e)),method:"UNLOCK",headers:{"Lock-Token":t}},r,s);return vf(Xe(a,r),function(n){if(Ye(r,n),n.status!==204&&n.status!==200)throw Qf(n)})}),rv=Vg(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{refreshToken:s,timeout:a=av}=t,n={Accept:"text/plain,application/xml",Timeout:a};s&&(n.If=s);const u=_e({url:Ee(r.remoteURL,Ce(e)),method:"LOCK",headers:n,data:tv(r.contactHref)},r,t);return vf(Xe(u,r),function(o){return Ye(r,o),vf(o.text(),function(l){const i=(h=l,new Zf.XMLParser({removeNSPrefix:!0,parseAttributeValue:!0,parseTagValue:!0}).parse(h)),c=Vs().get(i,"prop.lockdiscovery.activelock.locktoken.href"),m=Vs().get(i,"prop.lockdiscovery.activelock.timeout");var h;if(!c)throw Qf(o,"No lock token received: ");return{token:c,serverTimeout:m}})})}),av="Infinite, Second-4100000000";function am(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const nv=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.path||"/",s=_e({url:Ee(r.remoteURL,t),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},r,e);return am(Xe(s,r),function(a){return Ye(r,a),am(a.text(),function(n){return am(ac(n),function(u){const o=function(l){try{const[i]=l.multistatus.response,{propstat:{prop:{"quota-used-bytes":c,"quota-available-bytes":m}}}=i;return c!==void 0&&m!==void 0?{used:parseInt(String(c),10),available:Cg(m)}:null}catch(i){}return null}(u);return Pn(a,o,e.details)})})})});function nm(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const iv=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:s=!1}=t,a=_e({url:Ee(r.remoteURL,Ce(e)),method:"SEARCH",headers:{Accept:"text/plain,application/xml","Content-Type":r.headers["Content-Type"]||"application/xml; charset=utf-8"}},r,t);return nm(Xe(a,r),function(n){return Ye(r,n),nm(n.text(),function(u){return nm(ac(u),function(o){const l=function(i,c,m){const h={truncated:!1,results:[]};return h.truncated=i.multistatus.response.some(g=>{var p,y;return((y=(g.status||((p=g.propstat)==null?void 0:p.status)).split(" ",3))==null?void 0:y[1])==="507"&&g.href.replace(/\/$/,"").endsWith(Ce(c).replace(/\/$/,""))}),i.multistatus.response.forEach(g=>{if(g.propstat===void 0)return;const p=g.href.split("/").map(decodeURIComponent).join("/");h.results.push(Jh(g.propstat.prop,p,m))}),h}(o,e,s);return Pn(n,l,s)})})})}),ov=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=_e({url:Ee(r.remoteURL,Ce(e)),method:"MOVE",headers:{Destination:Ee(r.remoteURL,Ce(t)),Overwrite:s.overwrite===!1?"F":"T"}},r,s);return u=function(o){Ye(r,o)},(n=Xe(a,r))&&n.then||(n=Promise.resolve(n)),u?n.then(u):n;var n,u});var lv=de(172);const uv=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const{contentLength:a=!0,overwrite:n=!0}=s,u={"Content-Type":"application/octet-stream"};a===!1||(u["Content-Length"]=typeof a=="number"?"".concat(a):"".concat(function(c){if(dg(c))return c.byteLength;if(gg(c))return c.length;if(typeof c=="string")return(0,lv.d)(c);throw new At({info:{code:Ms.DataTypeNoLength}},"Cannot calculate data length: Invalid type")}(t))),n||(u["If-None-Match"]="*");const o=_e({url:Ee(r.remoteURL,Ce(e)),method:"PUT",headers:u,data:t},r,s);return i=function(c){try{Ye(r,c)}catch(m){const h=m;if(h.status!==412||n)throw h;return!1}return!0},(l=Xe(o,r))&&l.then||(l=Promise.resolve(l)),i?l.then(i):l;var l,i}),Bg=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}(function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=_e({url:Ee(r.remoteURL,Ce(e)),method:"OPTIONS"},r,t);return n=function(u){var o,l;try{Ye(r,u)}catch(i){throw i}return{compliance:((o=u.headers.get("DAV"))!=null?o:"").split(",").map(i=>i.trim()),server:(l=u.headers.get("Server"))!=null?l:""}},(a=Xe(s,r))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n});function Mu(r,e,t){return t?e?e(r):r:(r&&r.then||(r=Promise.resolve(r)),e?r.then(e):r)}const cv=sp(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new At({info:{code:Ms.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const u={"Content-Type":"application/octet-stream","Content-Length":""+(s-t+1),"Content-Range":"bytes ".concat(t,"-").concat(s,"/*")},o=_e({url:Ee(r.remoteURL,Ce(e)),method:"PUT",headers:u,data:a},r,n);return Mu(Xe(o,r),function(l){Ye(r,l)})});function Yp(r,e){var t=r();return t&&t.then?t.then(e):e(t)}const hv=sp(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>s||t<0)throw new At({info:{code:Ms.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const u={"Content-Type":"application/x-sabredav-partialupdate","Content-Length":""+(s-t+1),"X-Update-Range":"bytes=".concat(t,"-").concat(s)},o=_e({url:Ee(r.remoteURL,Ce(e)),method:"PATCH",headers:u,data:a},r,n);return Mu(Xe(o,r),function(l){Ye(r,l)})});function sp(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(r.apply(this,e))}catch(s){return Promise.reject(s)}}}const mv=sp(function(r,e,t,s,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};return Mu(Bg(r,e,n),function(u){let o=!1;return Yp(function(){if(u.compliance.includes("sabredav-partialupdate"))return Mu(hv(r,e,t,s,a,n),function(l){return o=!0,l})},function(l){let i=!1;return o?l:Yp(function(){if(u.server.includes("Apache")&&u.compliance.includes("<http://apache.org/dav/propset/fs/1>"))return Mu(cv(r,e,t,s,a,n),function(c){return i=!0,c})},function(c){if(i)return c;throw new At({info:{code:Ms.NotSupported}},"Not supported")})})})}),fv="https://github.com/perry-mitchell/webdav-client/blob/master/LOCK_CONTACT.md";function pv(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{authType:t=null,remoteBasePath:s,contactHref:a=fv,ha1:n,headers:u={},httpAgent:o,httpsAgent:l,password:i,token:c,username:m,withCredentials:h}=e;let g=t;g||(g=m||i?yt.Password:yt.None);const p={authType:g,remoteBasePath:s,contactHref:a,ha1:n,headers:Object.assign({},u),httpAgent:o,httpsAgent:l,password:i,remotePath:sy(r),remoteURL:r,token:c,username:m,withCredentials:h};return mg(p,m,i,c,n),{copyFile:(y,w,b)=>Ky(p,y,w,b),createDirectory:(y,w)=>yf(p,y,w),createReadStream:(y,w)=>function(b,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const k=new(_p()).PassThrough;return qy(b,f,v).then(N=>{N.pipe(k)}).catch(N=>{k.emit("error",N)}),k}(p,y,w),createWriteStream:(y,w,b)=>function(f,v){let k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},N=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Wy;const S=new(_p()).PassThrough,x={};k.overwrite===!1&&(x["If-None-Match"]="*");const C=_e({url:Ee(f.remoteURL,Ce(v)),method:"PUT",headers:x,data:S,maxRedirects:0},f,k);return Xe(C,f).then(I=>Ye(f,I)).then(I=>{setTimeout(()=>{N(I)},0)}).catch(I=>{S.emit("error",I)}),S}(p,y,w,b),customRequest:(y,w)=>Gy(p,y,w),deleteFile:(y,w)=>zy(p,y,w),exists:(y,w)=>Xy(p,y,w),getDirectoryContents:(y,w)=>_y(p,y,w),getFileContents:(y,w)=>Zy(p,y,w),getFileDownloadLink:y=>function(w,b){let f=Ee(w.remoteURL,Ce(b));const v=/^https:/i.test(f)?"https":"http";switch(w.authType){case yt.None:break;case yt.Password:{const k=jp(w.headers.Authorization.replace(/^Basic /i,"").trim());f=f.replace(/^https?:\/\//,"".concat(v,"://").concat(k,"@"));break}default:throw new At({info:{code:Ms.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(w.authType))}return f}(p,y),getFileUploadLink:y=>function(w,b){let f="".concat(Ee(w.remoteURL,Ce(b)),"?Content-Type=application/octet-stream");const v=/^https:/i.test(f)?"https":"http";switch(w.authType){case yt.None:break;case yt.Password:{const k=jp(w.headers.Authorization.replace(/^Basic /i,"").trim());f=f.replace(/^https?:\/\//,"".concat(v,"://").concat(k,"@"));break}default:throw new At({info:{code:Ms.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(w.authType))}return f}(p,y),getHeaders:()=>Object.assign({},p.headers),getQuota:y=>nv(p,y),lock:(y,w)=>rv(p,y,w),moveFile:(y,w,b)=>ov(p,y,w,b),putFileContents:(y,w,b)=>uv(p,y,w,b),partialUpdateFileContents:(y,w,b,f,v)=>mv(p,y,w,b,f,v),getDAVCompliance:y=>Bg(p,y),search:(y,w)=>iv(p,y,w),setHeaders:y=>{p.headers=Object.assign({},y)},stat:(y,w)=>ep(p,y,w),unlock:(y,w,b)=>sv(p,y,w,b)}}Wt.hT,Wt.O4,Wt.Kd,Wt.YK;var dv=Wt.UU,gv=Wt.Gu,wv=Wt.ky,yv=Wt.h4;Wt.ch,Wt.hq,Wt.i5;function Pg(){var r;return(r=Wf("files_sharing","isPublic",null))!=null?r:document.querySelector('input#isPublic[type="hidden"][name="isPublic"][value="1"]')!==null}function vv(){var r,e,t;return(t=(e=Wf("files_sharing","sharingToken",null))!=null?e:(r=document.querySelector('input#sharingToken[type="hidden"]'))==null?void 0:r.value)!=null?t:null}const fo=of().setApp("@nextcloud/files").detectUser().build();var Og=(r=>(r[r.NONE=0]="NONE",r[r.CREATE=4]="CREATE",r[r.READ=1]="READ",r[r.UPDATE=2]="UPDATE",r[r.DELETE=8]="DELETE",r[r.SHARE=16]="SHARE",r[r.ALL=31]="ALL",r))(Og||{}),Dg=(r=>(r.Folder="folder",r.File="file",r))(Dg||{});const Tg=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],Rg={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},im=function(r,e={nc:"http://nextcloud.org/ns"}){typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...Tg],window._nc_dav_namespaces=nt({},Rg));const t=nt(nt({},window._nc_dav_namespaces),e);if(window._nc_dav_properties.find(a=>a===r))return fo.warn("".concat(r," already registered"),{prop:r}),!1;if(r.startsWith("<")||r.split(":").length!==2)return fo.error("".concat(r," is not valid. See example: 'oc:fileid'"),{prop:r}),!1;const s=r.split(":")[0];return t[s]?(window._nc_dav_properties.push(r),window._nc_dav_namespaces=t,!0):(fo.error("".concat(r," namespace unknown"),{prop:r,namespaces:t}),!1)},bv=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...Tg]),window._nc_dav_properties.map(r=>"<".concat(r," />")).join(" ")},Av=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces=nt({},Rg)),Object.keys(window._nc_dav_namespaces).map(r=>{var e;return"xmlns:".concat(r,'="').concat((e=window._nc_dav_namespaces)==null?void 0:e[r],'"')}).join(" ")},Sv=function(){return'<?xml version="1.0"?>\n		<d:propfind '.concat(Av(),">\n			<d:prop>\n				").concat(bv(),"\n			</d:prop>\n		</d:propfind>")};function Nv(){var r;return Pg()?"/files/".concat(vv()):"/files/".concat((r=Gf())==null?void 0:r.uid)}Nv();function kv(){const r=Nw("dav");return Pg()?r.replace("remote.php","public.php"):r}const Cv=kv(),Ev=function(r=Cv,e={}){const t=dv(r,{headers:e});function s(a){t.setHeaders(ns(nt({},e),{"X-Requested-With":"XMLHttpRequest",requesttoken:a!=null?a:""}))}return Cw(s),s(kw()),gv().patch("fetch",(a,n)=>{const u=n.headers;return u!=null&&u.method&&(n.method=u.method,delete u.method),fetch(a,n)}),t};var om={},rp=(r=>(r.DEFAULT="default",r.HIDDEN="hidden",r))(rp||{});class xv{constructor(e){Ue(this,"_action");this.validateAction(e),this._action=e}get id(){return this._action.id}get displayName(){return this._action.displayName}get title(){return this._action.title}get iconSvgInline(){return this._action.iconSvgInline}get enabled(){return this._action.enabled}get exec(){return this._action.exec}get execBatch(){return this._action.execBatch}get order(){return this._action.order}get parent(){return this._action.parent}get default(){return this._action.default}get destructive(){return this._action.destructive}get inline(){return this._action.inline}get renderInline(){return this._action.renderInline}validateAction(e){if(!e.id||typeof e.id!="string")throw new Error("Invalid id");if(!e.displayName||typeof e.displayName!="function")throw new Error("Invalid displayName function");if("title"in e&&typeof e.title!="function")throw new Error("Invalid title function");if(!e.iconSvgInline||typeof e.iconSvgInline!="function")throw new Error("Invalid iconSvgInline function");if(!e.exec||typeof e.exec!="function")throw new Error("Invalid exec function");if("enabled"in e&&typeof e.enabled!="function")throw new Error("Invalid enabled function");if("execBatch"in e&&typeof e.execBatch!="function")throw new Error("Invalid execBatch function");if("order"in e&&typeof e.order!="number")throw new Error("Invalid order");if(e.destructive!==void 0&&typeof e.destructive!="boolean")throw new Error("Invalid destructive flag");if("parent"in e&&typeof e.parent!="string")throw new Error("Invalid parent");if(e.default&&!Object.values(rp).includes(e.default))throw new Error("Invalid default");if("inline"in e&&typeof e.inline!="function")throw new Error("Invalid inline function");if("renderInline"in e&&typeof e.renderInline!="function")throw new Error("Invalid renderInline function")}}const Iv=function(r){if(typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],fo.debug("FileActions initialized")),window._nc_fileactions.find(e=>e.id===r.id)){fo.error("FileAction ".concat(r.id," already registered"),{action:r});return}window._nc_fileactions.push(r)},Vv=function(){return typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],fo.debug("FileActions initialized")),window._nc_fileactions};var lm={},Qp={},Zp;function ap(){return Zp||(Zp=1,function(r){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+e+"]["+t+"]*",a=new RegExp("^"+s+"$"),n=function(o,l){const i=[];let c=l.exec(o);for(;c;){const m=[];m.startIndex=l.lastIndex-c[0].length;const h=c.length;for(let g=0;g<h;g++)m.push(c[g]);i.push(m),c=l.exec(o)}return i},u=function(o){const l=a.exec(o);return!(l===null||typeof l>"u")};r.isExist=function(o){return typeof o<"u"},r.isEmptyObject=function(o){return Object.keys(o).length===0},r.merge=function(o,l,i){if(l){const c=Object.keys(l),m=c.length;for(let h=0;h<m;h++)i==="strict"?o[c[h]]=[l[c[h]]]:o[c[h]]=l[c[h]]}},r.getValue=function(o){return r.isExist(o)?o:""},r.isName=u,r.getAllMatches=n,r.nameRegexp=s}(Qp)),Qp}var ed;function Lg(){if(ed)return lm;ed=1;const r=ap(),e={allowBooleanAttributes:!1,unpairedTags:[]};lm.validate=function(b,f){f=Object.assign({},e,f);const v=[];let k=!1,N=!1;b[0]==="\uFEFF"&&(b=b.substr(1));for(let S=0;S<b.length;S++)if(b[S]==="<"&&b[S+1]==="?"){if(S+=2,S=s(b,S),S.err)return S}else if(b[S]==="<"){let x=S;if(S++,b[S]==="!"){S=a(b,S);continue}else{let C=!1;b[S]==="/"&&(C=!0,S++);let I="";for(;S<b.length&&b[S]!==">"&&b[S]!==" "&&b[S]!=="	"&&b[S]!=="\n"&&b[S]!=="\r";S++)I+=b[S];if(I=I.trim(),I[I.length-1]==="/"&&(I=I.substring(0,I.length-1),S--),!p(I)){let D;return I.trim().length===0?D="Invalid space after '<'.":D="Tag '"+I+"' is an invalid name.",h("InvalidTag",D,y(b,S))}const P=o(b,S);if(P===!1)return h("InvalidAttr","Attributes for '"+I+"' have open quote.",y(b,S));let B=P.value;if(S=P.index,B[B.length-1]==="/"){const D=S-B.length;B=B.substring(0,B.length-1);const V=i(B,f);if(V===!0)k=!0;else return h(V.err.code,V.err.msg,y(b,D+V.err.line))}else if(C)if(P.tagClosed){if(B.trim().length>0)return h("InvalidTag","Closing tag '"+I+"' can't have attributes or invalid starting.",y(b,x));if(v.length===0)return h("InvalidTag","Closing tag '"+I+"' has not been opened.",y(b,x));{const D=v.pop();if(I!==D.tagName){let V=y(b,D.tagStartPos);return h("InvalidTag","Expected closing tag '"+D.tagName+"' (opened in line "+V.line+", col "+V.col+") instead of closing tag '"+I+"'.",y(b,x))}v.length==0&&(N=!0)}}else return h("InvalidTag","Closing tag '"+I+"' doesn't have proper closing.",y(b,S));else{const D=i(B,f);if(D!==!0)return h(D.err.code,D.err.msg,y(b,S-B.length+D.err.line));if(N===!0)return h("InvalidXml","Multiple possible root nodes found.",y(b,S));f.unpairedTags.indexOf(I)!==-1||v.push({tagName:I,tagStartPos:x}),k=!0}for(S++;S<b.length;S++)if(b[S]==="<")if(b[S+1]==="!"){S++,S=a(b,S);continue}else if(b[S+1]==="?"){if(S=s(b,++S),S.err)return S}else break;else if(b[S]==="&"){const D=m(b,S);if(D==-1)return h("InvalidChar","char '&' is not expected.",y(b,S));S=D}else if(N===!0&&!t(b[S]))return h("InvalidXml","Extra text at the end",y(b,S));b[S]==="<"&&S--}}else{if(t(b[S]))continue;return h("InvalidChar","char '"+b[S]+"' is not expected.",y(b,S))}if(k){if(v.length==1)return h("InvalidTag","Unclosed tag '"+v[0].tagName+"'.",y(b,v[0].tagStartPos));if(v.length>0)return h("InvalidXml","Invalid '"+JSON.stringify(v.map(S=>S.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return h("InvalidXml","Start tag expected.",1);return!0};function t(b){return b===" "||b==="	"||b==="\n"||b==="\r"}function s(b,f){const v=f;for(;f<b.length;f++)if(b[f]=="?"||b[f]==" "){const k=b.substr(v,f-v);if(f>5&&k==="xml")return h("InvalidXml","XML declaration allowed only at the start of the document.",y(b,f));if(b[f]=="?"&&b[f+1]==">"){f++;break}else continue}return f}function a(b,f){if(b.length>f+5&&b[f+1]==="-"&&b[f+2]==="-"){for(f+=3;f<b.length;f++)if(b[f]==="-"&&b[f+1]==="-"&&b[f+2]===">"){f+=2;break}}else if(b.length>f+8&&b[f+1]==="D"&&b[f+2]==="O"&&b[f+3]==="C"&&b[f+4]==="T"&&b[f+5]==="Y"&&b[f+6]==="P"&&b[f+7]==="E"){let v=1;for(f+=8;f<b.length;f++)if(b[f]==="<")v++;else if(b[f]===">"&&(v--,v===0))break}else if(b.length>f+9&&b[f+1]==="["&&b[f+2]==="C"&&b[f+3]==="D"&&b[f+4]==="A"&&b[f+5]==="T"&&b[f+6]==="A"&&b[f+7]==="["){for(f+=8;f<b.length;f++)if(b[f]==="]"&&b[f+1]==="]"&&b[f+2]===">"){f+=2;break}}return f}const n='"',u="'";function o(b,f){let v="",k="",N=!1;for(;f<b.length;f++){if(b[f]===n||b[f]===u)k===""?k=b[f]:k!==b[f]||(k="");else if(b[f]===">"&&k===""){N=!0;break}v+=b[f]}return k!==""?!1:{value:v,index:f,tagClosed:N}}const l=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function i(b,f){const v=r.getAllMatches(b,l),k={};for(let N=0;N<v.length;N++){if(v[N][1].length===0)return h("InvalidAttr","Attribute '"+v[N][2]+"' has no space in starting.",w(v[N]));if(v[N][3]!==void 0&&v[N][4]===void 0)return h("InvalidAttr","Attribute '"+v[N][2]+"' is without value.",w(v[N]));if(v[N][3]===void 0&&!f.allowBooleanAttributes)return h("InvalidAttr","boolean attribute '"+v[N][2]+"' is not allowed.",w(v[N]));const S=v[N][2];if(!g(S))return h("InvalidAttr","Attribute '"+S+"' is an invalid name.",w(v[N]));if(!k.hasOwnProperty(S))k[S]=1;else return h("InvalidAttr","Attribute '"+S+"' is repeated.",w(v[N]))}return!0}function c(b,f){let v=/\d/;for(b[f]==="x"&&(f++,v=/[\da-fA-F]/);f<b.length;f++){if(b[f]===";")return f;if(!b[f].match(v))break}return-1}function m(b,f){if(f++,b[f]===";")return-1;if(b[f]==="#")return f++,c(b,f);let v=0;for(;f<b.length;f++,v++)if(!(b[f].match(/\w/)&&v<20)){if(b[f]===";")break;return-1}return f}function h(b,f,v){return{err:{code:b,msg:f,line:v.line||v,col:v.col}}}function g(b){return r.isName(b)}function p(b){return r.isName(b)}function y(b,f){const v=b.substring(0,f).split(/\r?\n/);return{line:v.length,col:v[v.length-1].length+1}}function w(b){return b.startIndex+b[1].length}return lm}var uc={},td;function Bv(){if(td)return uc;td=1;const r={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,s){return s},attributeValueProcessor:function(t,s){return s},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,s,a){return t}},e=function(t){return Object.assign({},r,t)};return uc.buildOptions=e,uc.defaultOptions=r,uc}var um,sd;function Pv(){if(sd)return um;sd=1;class r{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,s){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:s})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}return um=r,um}var cm,rd;function Ov(){if(rd)return cm;rd=1;const r=ap();function e(l,i){const c={};if(l[i+3]==="O"&&l[i+4]==="C"&&l[i+5]==="T"&&l[i+6]==="Y"&&l[i+7]==="P"&&l[i+8]==="E"){i=i+9;let m=1,h=!1,g=!1,p="";for(;i<l.length;i++)if(l[i]==="<"&&!g){if(h&&s(l,i)){i+=7;let y,w;[y,w,i]=t(l,i+1),w.indexOf("&")===-1&&(c[o(y)]={regx:RegExp("&".concat(y,";"),"g"),val:w})}else h&&a(l,i)||h&&n(l,i)?i+=8:h&&u(l,i)?i+=9:g=!0;m++,p=""}else if(l[i]===">"){if(g?l[i-1]==="-"&&l[i-2]==="-"&&(g=!1,m--):m--,m===0)break}else l[i]==="["?h=!0:p+=l[i];if(m!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:c,i}}function t(l,i){let c="";for(;i<l.length&&l[i]!=="'"&&l[i]!=='"';i++)c+=l[i];if(c=c.trim(),c.indexOf(" ")!==-1)throw new Error("External entites are not supported");const m=l[i++];let h="";for(;i<l.length&&l[i]!==m;i++)h+=l[i];return[c,h,i]}function s(l,i){return l[i+1]==="!"&&l[i+2]==="E"&&l[i+3]==="N"&&l[i+4]==="T"&&l[i+5]==="I"&&l[i+6]==="T"&&l[i+7]==="Y"}function a(l,i){return l[i+1]==="!"&&l[i+2]==="E"&&l[i+3]==="L"&&l[i+4]==="E"&&l[i+5]==="M"&&l[i+6]==="E"&&l[i+7]==="N"&&l[i+8]==="T"}function n(l,i){return l[i+1]==="!"&&l[i+2]==="A"&&l[i+3]==="T"&&l[i+4]==="T"&&l[i+5]==="L"&&l[i+6]==="I"&&l[i+7]==="S"&&l[i+8]==="T"}function u(l,i){return l[i+1]==="!"&&l[i+2]==="N"&&l[i+3]==="O"&&l[i+4]==="T"&&l[i+5]==="A"&&l[i+6]==="T"&&l[i+7]==="I"&&l[i+8]==="O"&&l[i+9]==="N"}function o(l){if(r.isName(l))return l;throw new Error("Invalid entity name ".concat(l))}return cm=e,cm}var hm,ad;function Dv(){if(ad)return hm;ad=1;const r=/^[-+]?0x[a-fA-F0-9]+$/,e=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const t={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function s(n,u={}){if(u=Object.assign({},t,u),!n||typeof n!="string")return n;let o=n.trim();if(u.skipLike!==void 0&&u.skipLike.test(o))return n;if(u.hex&&r.test(o))return Number.parseInt(o,16);{const l=e.exec(o);if(l){const i=l[1],c=l[2];let m=a(l[3]);const h=l[4]||l[6];if(!u.leadingZeros&&c.length>0&&i&&o[2]!=="."||!u.leadingZeros&&c.length>0&&!i&&o[1]!==".")return n;{const g=Number(o),p=""+g;return p.search(/[eE]/)!==-1||h?u.eNotation?g:n:o.indexOf(".")!==-1?p==="0"&&m===""||p===m||i&&p==="-"+m?g:n:c?m===p||i+m===p?g:n:o===p||o===i+p?g:n}}else return n}}function a(n){return n&&n.indexOf(".")!==-1&&(n=n.replace(/0+$/,""),n==="."?n="0":n[0]==="."?n="0"+n:n[n.length-1]==="."&&(n=n.substr(0,n.length-1))),n}return hm=s,hm}var mm,nd;function jg(){if(nd)return mm;nd=1;function r(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const s of e)if(typeof s=="string"&&t===s||s instanceof RegExp&&s.test(t))return!0}:()=>!1}return mm=r,mm}var fm,id;function Tv(){if(id)return fm;id=1;const r=ap(),e=Pv(),t=Ov(),s=Dv(),a=jg();class n{constructor(S){this.options=S,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(x,C)=>String.fromCharCode(Number.parseInt(C,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(x,C)=>String.fromCharCode(Number.parseInt(C,16))}},this.addExternalEntities=u,this.parseXml=m,this.parseTextData=o,this.resolveNameSpace=l,this.buildAttributesMap=c,this.isItStopNode=y,this.replaceEntitiesValue=g,this.readStopNodeData=v,this.saveTextToParentTag=p,this.addChild=h,this.ignoreAttributesFn=a(this.options.ignoreAttributes)}}function u(N){const S=Object.keys(N);for(let x=0;x<S.length;x++){const C=S[x];this.lastEntities[C]={regex:new RegExp("&"+C+";","g"),val:N[C]}}}function o(N,S,x,C,I,P,B){if(N!==void 0&&(this.options.trimValues&&!C&&(N=N.trim()),N.length>0)){B||(N=this.replaceEntitiesValue(N));const D=this.options.tagValueProcessor(S,N,x,I,P);return D==null?N:typeof D!=typeof N||D!==N?D:this.options.trimValues?k(N,this.options.parseTagValue,this.options.numberParseOptions):N.trim()===N?k(N,this.options.parseTagValue,this.options.numberParseOptions):N}}function l(N){if(this.options.removeNSPrefix){const S=N.split(":"),x=N.charAt(0)==="/"?"/":"";if(S[0]==="xmlns")return"";S.length===2&&(N=x+S[1])}return N}const i=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function c(N,S,x){if(this.options.ignoreAttributes!==!0&&typeof N=="string"){const C=r.getAllMatches(N,i),I=C.length,P={};for(let B=0;B<I;B++){const D=this.resolveNameSpace(C[B][1]);if(this.ignoreAttributesFn(D,S))continue;let V=C[B][4],K=this.options.attributeNamePrefix+D;if(D.length)if(this.options.transformAttributeName&&(K=this.options.transformAttributeName(K)),K==="__proto__"&&(K="#__proto__"),V!==void 0){this.options.trimValues&&(V=V.trim()),V=this.replaceEntitiesValue(V);const M=this.options.attributeValueProcessor(D,V,S);M==null?P[K]=V:typeof M!=typeof V||M!==V?P[K]=M:P[K]=k(V,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(P[K]=!0)}if(!Object.keys(P).length)return;if(this.options.attributesGroupName){const B={};return B[this.options.attributesGroupName]=P,B}return P}}const m=function(N){N=N.replace(/\r\n?/g,"\n");const S=new e("!xml");let x=S,C="",I="";for(let P=0;P<N.length;P++)if(N[P]==="<")if(N[P+1]==="/"){const B=b(N,">",P,"Closing Tag is not closed.");let D=N.substring(P+2,B).trim();if(this.options.removeNSPrefix){const M=D.indexOf(":");M!==-1&&(D=D.substr(M+1))}this.options.transformTagName&&(D=this.options.transformTagName(D)),x&&(C=this.saveTextToParentTag(C,x,I));const V=I.substring(I.lastIndexOf(".")+1);if(D&&this.options.unpairedTags.indexOf(D)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(D,">"));let K=0;V&&this.options.unpairedTags.indexOf(V)!==-1?(K=I.lastIndexOf(".",I.lastIndexOf(".")-1),this.tagsNodeStack.pop()):K=I.lastIndexOf("."),I=I.substring(0,K),x=this.tagsNodeStack.pop(),C="",P=B}else if(N[P+1]==="?"){let B=f(N,P,!1,"?>");if(!B)throw new Error("Pi Tag is not closed.");if(C=this.saveTextToParentTag(C,x,I),!(this.options.ignoreDeclaration&&B.tagName==="?xml"||this.options.ignorePiTags)){const D=new e(B.tagName);D.add(this.options.textNodeName,""),B.tagName!==B.tagExp&&B.attrExpPresent&&(D[":@"]=this.buildAttributesMap(B.tagExp,I,B.tagName)),this.addChild(x,D,I)}P=B.closeIndex+1}else if(N.substr(P+1,3)==="!--"){const B=b(N,"-->",P+4,"Comment is not closed.");if(this.options.commentPropName){const D=N.substring(P+4,B-2);C=this.saveTextToParentTag(C,x,I),x.add(this.options.commentPropName,[{[this.options.textNodeName]:D}])}P=B}else if(N.substr(P+1,2)==="!D"){const B=t(N,P);this.docTypeEntities=B.entities,P=B.i}else if(N.substr(P+1,2)==="!["){const B=b(N,"]]>",P,"CDATA is not closed.")-2,D=N.substring(P+9,B);C=this.saveTextToParentTag(C,x,I);let V=this.parseTextData(D,x.tagname,I,!0,!1,!0,!0);V==null&&(V=""),this.options.cdataPropName?x.add(this.options.cdataPropName,[{[this.options.textNodeName]:D}]):x.add(this.options.textNodeName,V),P=B+2}else{let B=f(N,P,this.options.removeNSPrefix),D=B.tagName;const V=B.rawTagName;let K=B.tagExp,M=B.attrExpPresent,Q=B.closeIndex;this.options.transformTagName&&(D=this.options.transformTagName(D)),x&&C&&x.tagname!=="!xml"&&(C=this.saveTextToParentTag(C,x,I,!1));const ne=x;if(ne&&this.options.unpairedTags.indexOf(ne.tagname)!==-1&&(x=this.tagsNodeStack.pop(),I=I.substring(0,I.lastIndexOf("."))),D!==S.tagname&&(I+=I?"."+D:D),this.isItStopNode(this.options.stopNodes,I,D)){let Z="";if(K.length>0&&K.lastIndexOf("/")===K.length-1)D[D.length-1]==="/"?(D=D.substr(0,D.length-1),I=I.substr(0,I.length-1),K=D):K=K.substr(0,K.length-1),P=B.closeIndex;else if(this.options.unpairedTags.indexOf(D)!==-1)P=B.closeIndex;else{const q=this.readStopNodeData(N,V,Q+1);if(!q)throw new Error("Unexpected end of ".concat(V));P=q.i,Z=q.tagContent}const z=new e(D);D!==K&&M&&(z[":@"]=this.buildAttributesMap(K,I,D)),Z&&(Z=this.parseTextData(Z,D,I,!0,M,!0,!0)),I=I.substr(0,I.lastIndexOf(".")),z.add(this.options.textNodeName,Z),this.addChild(x,z,I)}else{if(K.length>0&&K.lastIndexOf("/")===K.length-1){D[D.length-1]==="/"?(D=D.substr(0,D.length-1),I=I.substr(0,I.length-1),K=D):K=K.substr(0,K.length-1),this.options.transformTagName&&(D=this.options.transformTagName(D));const Z=new e(D);D!==K&&M&&(Z[":@"]=this.buildAttributesMap(K,I,D)),this.addChild(x,Z,I),I=I.substr(0,I.lastIndexOf("."))}else{const Z=new e(D);this.tagsNodeStack.push(x),D!==K&&M&&(Z[":@"]=this.buildAttributesMap(K,I,D)),this.addChild(x,Z,I),x=Z}C="",P=Q}}else C+=N[P];return S.child};function h(N,S,x){const C=this.options.updateTag(S.tagname,x,S[":@"]);C===!1||(typeof C=="string"&&(S.tagname=C),N.addChild(S))}const g=function(N){if(this.options.processEntities){for(let S in this.docTypeEntities){const x=this.docTypeEntities[S];N=N.replace(x.regx,x.val)}for(let S in this.lastEntities){const x=this.lastEntities[S];N=N.replace(x.regex,x.val)}if(this.options.htmlEntities)for(let S in this.htmlEntities){const x=this.htmlEntities[S];N=N.replace(x.regex,x.val)}N=N.replace(this.ampEntity.regex,this.ampEntity.val)}return N};function p(N,S,x,C){return N&&(C===void 0&&(C=Object.keys(S.child).length===0),N=this.parseTextData(N,S.tagname,x,!1,S[":@"]?Object.keys(S[":@"]).length!==0:!1,C),N!==void 0&&N!==""&&S.add(this.options.textNodeName,N),N=""),N}function y(N,S,x){const C="*."+x;for(const I in N){const P=N[I];if(C===P||S===P)return!0}return!1}function w(N,S,x=">"){let C,I="";for(let P=S;P<N.length;P++){let B=N[P];if(C)B===C&&(C="");else if(B==='"'||B==="'")C=B;else if(B===x[0])if(x[1]){if(N[P+1]===x[1])return{data:I,index:P}}else return{data:I,index:P};else B==="	"&&(B=" ");I+=B}}function b(N,S,x,C){const I=N.indexOf(S,x);if(I===-1)throw new Error(C);return I+S.length-1}function f(N,S,x,C=">"){const I=w(N,S+1,C);if(!I)return;let P=I.data;const B=I.index,D=P.search(/\s/);let V=P,K=!0;D!==-1&&(V=P.substring(0,D),P=P.substring(D+1).trimStart());const M=V;if(x){const Q=V.indexOf(":");Q!==-1&&(V=V.substr(Q+1),K=V!==I.data.substr(Q+1))}return{tagName:V,tagExp:P,closeIndex:B,attrExpPresent:K,rawTagName:M}}function v(N,S,x){const C=x;let I=1;for(;x<N.length;x++)if(N[x]==="<")if(N[x+1]==="/"){const P=b(N,">",x,"".concat(S," is not closed"));if(N.substring(x+2,P).trim()===S&&(I--,I===0))return{tagContent:N.substring(C,x),i:P};x=P}else if(N[x+1]==="?")x=b(N,"?>",x+1,"StopNode is not closed.");else if(N.substr(x+1,3)==="!--")x=b(N,"-->",x+3,"StopNode is not closed.");else if(N.substr(x+1,2)==="![")x=b(N,"]]>",x,"StopNode is not closed.")-2;else{const P=f(N,x,">");P&&((P&&P.tagName)===S&&P.tagExp[P.tagExp.length-1]!=="/"&&I++,x=P.closeIndex)}}function k(N,S,x){if(S&&typeof N=="string"){const C=N.trim();return C==="true"?!0:C==="false"?!1:s(N,x)}else return r.isExist(N)?N:""}return fm=n,fm}var pm={},od;function Rv(){if(od)return pm;od=1;function r(n,u){return e(n,u)}function e(n,u,o){let l;const i={};for(let c=0;c<n.length;c++){const m=n[c],h=t(m);let g="";if(o===void 0?g=h:g=o+"."+h,h===u.textNodeName)l===void 0?l=m[h]:l+=""+m[h];else{if(h===void 0)continue;if(m[h]){let p=e(m[h],u,g);const y=a(p,u);m[":@"]?s(p,m[":@"],g,u):Object.keys(p).length===1&&p[u.textNodeName]!==void 0&&!u.alwaysCreateTextNode?p=p[u.textNodeName]:Object.keys(p).length===0&&(u.alwaysCreateTextNode?p[u.textNodeName]="":p=""),i[h]!==void 0&&i.hasOwnProperty(h)?(Array.isArray(i[h])||(i[h]=[i[h]]),i[h].push(p)):u.isArray(h,g,y)?i[h]=[p]:i[h]=p}}}return typeof l=="string"?l.length>0&&(i[u.textNodeName]=l):l!==void 0&&(i[u.textNodeName]=l),i}function t(n){const u=Object.keys(n);for(let o=0;o<u.length;o++){const l=u[o];if(l!==":@")return l}}function s(n,u,o,l){if(u){const i=Object.keys(u),c=i.length;for(let m=0;m<c;m++){const h=i[m];l.isArray(h,o+"."+h,!0,!0)?n[h]=[u[h]]:n[h]=u[h]}}}function a(n,u){const{textNodeName:o}=u,l=Object.keys(n).length;return!!(l===0||l===1&&(n[o]||typeof n[o]=="boolean"||n[o]===0))}return pm.prettify=r,pm}var dm,ld;function Lv(){if(ld)return dm;ld=1;const{buildOptions:r}=Bv(),e=Tv(),{prettify:t}=Rv(),s=Lg();class a{constructor(u){this.externalEntities={},this.options=r(u)}parse(u,o){if(typeof u!="string")if(u.toString)u=u.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(o){o===!0&&(o={});const c=s.validate(u,o);if(c!==!0)throw Error("".concat(c.err.msg,":").concat(c.err.line,":").concat(c.err.col))}const l=new e(this.options);l.addExternalEntities(this.externalEntities);const i=l.parseXml(u);return this.options.preserveOrder||i===void 0?i:t(i,this.options)}addEntity(u,o){if(o.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(u.indexOf("&")!==-1||u.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(o==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[u]=o}}return dm=a,dm}var gm,ud;function jv(){if(ud)return gm;ud=1;const r="\n";function e(o,l){let i="";return l.format&&l.indentBy.length>0&&(i=r),t(o,l,"",i)}function t(o,l,i,c){let m="",h=!1;for(let g=0;g<o.length;g++){const p=o[g],y=s(p);if(y===void 0)continue;let w="";if(i.length===0?w=y:w="".concat(i,".").concat(y),y===l.textNodeName){let N=p[y];n(w,l)||(N=l.tagValueProcessor(y,N),N=u(N,l)),h&&(m+=c),m+=N,h=!1;continue}else if(y===l.cdataPropName){h&&(m+=c),m+="<![CDATA[".concat(p[y][0][l.textNodeName],"]]>"),h=!1;continue}else if(y===l.commentPropName){m+=c+"<!--".concat(p[y][0][l.textNodeName],"-->"),h=!0;continue}else if(y[0]==="?"){const N=a(p[":@"],l),S=y==="?xml"?"":c;let x=p[y][0][l.textNodeName];x=x.length!==0?" "+x:"",m+=S+"<".concat(y).concat(x).concat(N,"?>"),h=!0;continue}let b=c;b!==""&&(b+=l.indentBy);const f=a(p[":@"],l),v=c+"<".concat(y).concat(f),k=t(p[y],l,w,b);l.unpairedTags.indexOf(y)!==-1?l.suppressUnpairedNode?m+=v+">":m+=v+"/>":(!k||k.length===0)&&l.suppressEmptyNode?m+=v+"/>":k&&k.endsWith(">")?m+=v+">".concat(k).concat(c,"</").concat(y,">"):(m+=v+">",k&&c!==""&&(k.includes("/>")||k.includes("</"))?m+=c+l.indentBy+k+c:m+=k,m+="</".concat(y,">")),h=!0}return m}function s(o){const l=Object.keys(o);for(let i=0;i<l.length;i++){const c=l[i];if(o.hasOwnProperty(c)&&c!==":@")return c}}function a(o,l){let i="";if(o&&!l.ignoreAttributes)for(let c in o){if(!o.hasOwnProperty(c))continue;let m=l.attributeValueProcessor(c,o[c]);m=u(m,l),m===!0&&l.suppressBooleanAttributes?i+=" ".concat(c.substr(l.attributeNamePrefix.length)):i+=" ".concat(c.substr(l.attributeNamePrefix.length),'="').concat(m,'"')}return i}function n(o,l){o=o.substr(0,o.length-l.textNodeName.length-1);let i=o.substr(o.lastIndexOf(".")+1);for(let c in l.stopNodes)if(l.stopNodes[c]===o||l.stopNodes[c]==="*."+i)return!0;return!1}function u(o,l){if(o&&o.length>0&&l.processEntities)for(let i=0;i<l.entities.length;i++){const c=l.entities[i];o=o.replace(c.regex,c.val)}return o}return gm=e,gm}var wm,cd;function $v(){if(cd)return wm;cd=1;const r=jv(),e=jg(),t={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(o,l){return l},attributeValueProcessor:function(o,l){return l},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function s(o){this.options=Object.assign({},t,o),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=e(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=u),this.processTextOrObjNode=a,this.options.format?(this.indentate=n,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}s.prototype.build=function(o){return this.options.preserveOrder?r(o,this.options):(Array.isArray(o)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(o={[this.options.arrayNodeName]:o}),this.j2x(o,0,[]).val)},s.prototype.j2x=function(o,l,i){let c="",m="";const h=i.join(".");for(let g in o)if(Object.prototype.hasOwnProperty.call(o,g))if(typeof o[g]>"u")this.isAttribute(g)&&(m+="");else if(o[g]===null)this.isAttribute(g)?m+="":g[0]==="?"?m+=this.indentate(l)+"<"+g+"?"+this.tagEndChar:m+=this.indentate(l)+"<"+g+"/"+this.tagEndChar;else if(o[g]instanceof Date)m+=this.buildTextValNode(o[g],g,"",l);else if(typeof o[g]!="object"){const p=this.isAttribute(g);if(p&&!this.ignoreAttributesFn(p,h))c+=this.buildAttrPairStr(p,""+o[g]);else if(!p)if(g===this.options.textNodeName){let y=this.options.tagValueProcessor(g,""+o[g]);m+=this.replaceEntitiesValue(y)}else m+=this.buildTextValNode(o[g],g,"",l)}else if(Array.isArray(o[g])){const p=o[g].length;let y="",w="";for(let b=0;b<p;b++){const f=o[g][b];if(!(typeof f>"u"))if(f===null)g[0]==="?"?m+=this.indentate(l)+"<"+g+"?"+this.tagEndChar:m+=this.indentate(l)+"<"+g+"/"+this.tagEndChar;else if(typeof f=="object")if(this.options.oneListGroup){const v=this.j2x(f,l+1,i.concat(g));y+=v.val,this.options.attributesGroupName&&f.hasOwnProperty(this.options.attributesGroupName)&&(w+=v.attrStr)}else y+=this.processTextOrObjNode(f,g,l,i);else if(this.options.oneListGroup){let v=this.options.tagValueProcessor(g,f);v=this.replaceEntitiesValue(v),y+=v}else y+=this.buildTextValNode(f,g,"",l)}this.options.oneListGroup&&(y=this.buildObjectNode(y,g,w,l)),m+=y}else if(this.options.attributesGroupName&&g===this.options.attributesGroupName){const p=Object.keys(o[g]),y=p.length;for(let w=0;w<y;w++)c+=this.buildAttrPairStr(p[w],""+o[g][p[w]])}else m+=this.processTextOrObjNode(o[g],g,l,i);return{attrStr:c,val:m}},s.prototype.buildAttrPairStr=function(o,l){return l=this.options.attributeValueProcessor(o,""+l),l=this.replaceEntitiesValue(l),this.options.suppressBooleanAttributes&&l==="true"?" "+o:" "+o+'="'+l+'"'};function a(o,l,i,c){const m=this.j2x(o,i+1,c.concat(l));return o[this.options.textNodeName]!==void 0&&Object.keys(o).length===1?this.buildTextValNode(o[this.options.textNodeName],l,m.attrStr,i):this.buildObjectNode(m.val,l,m.attrStr,i)}s.prototype.buildObjectNode=function(o,l,i,c){if(o==="")return l[0]==="?"?this.indentate(c)+"<"+l+i+"?"+this.tagEndChar:this.indentate(c)+"<"+l+i+this.closeTag(l)+this.tagEndChar;{let m="</"+l+this.tagEndChar,h="";return l[0]==="?"&&(h="?",m=""),(i||i==="")&&o.indexOf("<")===-1?this.indentate(c)+"<"+l+i+h+">"+o+m:this.options.commentPropName!==!1&&l===this.options.commentPropName&&h.length===0?this.indentate(c)+"<!--".concat(o,"-->")+this.newLine:this.indentate(c)+"<"+l+i+h+this.tagEndChar+o+this.indentate(c)+m}},s.prototype.closeTag=function(o){let l="";return this.options.unpairedTags.indexOf(o)!==-1?this.options.suppressUnpairedNode||(l="/"):this.options.suppressEmptyNode?l="/":l="></".concat(o),l},s.prototype.buildTextValNode=function(o,l,i,c){if(this.options.cdataPropName!==!1&&l===this.options.cdataPropName)return this.indentate(c)+"<![CDATA[".concat(o,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&l===this.options.commentPropName)return this.indentate(c)+"<!--".concat(o,"-->")+this.newLine;if(l[0]==="?")return this.indentate(c)+"<"+l+i+"?"+this.tagEndChar;{let m=this.options.tagValueProcessor(l,o);return m=this.replaceEntitiesValue(m),m===""?this.indentate(c)+"<"+l+i+this.closeTag(l)+this.tagEndChar:this.indentate(c)+"<"+l+i+">"+m+"</"+l+this.tagEndChar}},s.prototype.replaceEntitiesValue=function(o){if(o&&o.length>0&&this.options.processEntities)for(let l=0;l<this.options.entities.length;l++){const i=this.options.entities[l];o=o.replace(i.regex,i.val)}return o};function n(o){return this.options.indentBy.repeat(o)}function u(o){return o.startsWith(this.options.attributeNamePrefix)&&o!==this.options.textNodeName?o.substr(this.attrPrefixLen):!1}return wm=s,wm}var ym,hd;function Uv(){if(hd)return ym;hd=1;const r=Lg(),e=Lv(),t=$v();return ym={XMLParser:e,XMLValidator:r,XMLBuilder:t},ym}Uv();var md,fd;function $g(){return fd||(fd=1,md=typeof We=="object"&&om&&om.NODE_DEBUG&&/\bsemver\b/i.test(om.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{}),md}var vm,pd;function Ug(){if(pd)return vm;pd=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,s=16,a=e-6;return vm={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},vm}var bm={exports:{}},dd;function Kv(){return dd||(dd=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:a}=Ug(),n=$g();e=r.exports={};const u=e.re=[],o=e.safeRe=[],l=e.src=[],i=e.t={};let c=0;const m="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",a],[m,s]],g=y=>{for(const[w,b]of h)y=y.split("".concat(w,"*")).join("".concat(w,"{0,").concat(b,"}")).split("".concat(w,"+")).join("".concat(w,"{1,").concat(b,"}"));return y},p=(y,w,b)=>{const f=g(w),v=c++;n(y,v,w),i[y]=v,l[v]=w,u[v]=new RegExp(w,b?"g":void 0),o[v]=new RegExp(f,b?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-]".concat(m,"*")),p("MAINVERSION","(".concat(l[i.NUMERICIDENTIFIER],")\\.(").concat(l[i.NUMERICIDENTIFIER],")\\.(").concat(l[i.NUMERICIDENTIFIER],")")),p("MAINVERSIONLOOSE","(".concat(l[i.NUMERICIDENTIFIERLOOSE],")\\.(").concat(l[i.NUMERICIDENTIFIERLOOSE],")\\.(").concat(l[i.NUMERICIDENTIFIERLOOSE],")")),p("PRERELEASEIDENTIFIER","(?:".concat(l[i.NUMERICIDENTIFIER],"|").concat(l[i.NONNUMERICIDENTIFIER],")")),p("PRERELEASEIDENTIFIERLOOSE","(?:".concat(l[i.NUMERICIDENTIFIERLOOSE],"|").concat(l[i.NONNUMERICIDENTIFIER],")")),p("PRERELEASE","(?:-(".concat(l[i.PRERELEASEIDENTIFIER],"(?:\\.").concat(l[i.PRERELEASEIDENTIFIER],")*))")),p("PRERELEASELOOSE","(?:-?(".concat(l[i.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(l[i.PRERELEASEIDENTIFIERLOOSE],")*))")),p("BUILDIDENTIFIER","".concat(m,"+")),p("BUILD","(?:\\+(".concat(l[i.BUILDIDENTIFIER],"(?:\\.").concat(l[i.BUILDIDENTIFIER],")*))")),p("FULLPLAIN","v?".concat(l[i.MAINVERSION]).concat(l[i.PRERELEASE],"?").concat(l[i.BUILD],"?")),p("FULL","^".concat(l[i.FULLPLAIN],"$")),p("LOOSEPLAIN","[v=\\s]*".concat(l[i.MAINVERSIONLOOSE]).concat(l[i.PRERELEASELOOSE],"?").concat(l[i.BUILD],"?")),p("LOOSE","^".concat(l[i.LOOSEPLAIN],"$")),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE","".concat(l[i.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),p("XRANGEIDENTIFIER","".concat(l[i.NUMERICIDENTIFIER],"|x|X|\\*")),p("XRANGEPLAIN","[v=\\s]*(".concat(l[i.XRANGEIDENTIFIER],")(?:\\.(").concat(l[i.XRANGEIDENTIFIER],")(?:\\.(").concat(l[i.XRANGEIDENTIFIER],")(?:").concat(l[i.PRERELEASE],")?").concat(l[i.BUILD],"?)?)?")),p("XRANGEPLAINLOOSE","[v=\\s]*(".concat(l[i.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(l[i.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(l[i.XRANGEIDENTIFIERLOOSE],")(?:").concat(l[i.PRERELEASELOOSE],")?").concat(l[i.BUILD],"?)?)?")),p("XRANGE","^".concat(l[i.GTLT],"\\s*").concat(l[i.XRANGEPLAIN],"$")),p("XRANGELOOSE","^".concat(l[i.GTLT],"\\s*").concat(l[i.XRANGEPLAINLOOSE],"$")),p("COERCEPLAIN","(^|[^\\d])(\\d{1,".concat(t,"})(?:\\.(\\d{1,").concat(t,"}))?(?:\\.(\\d{1,").concat(t,"}))?")),p("COERCE","".concat(l[i.COERCEPLAIN],"(?:$|[^\\d])")),p("COERCEFULL",l[i.COERCEPLAIN]+"(?:".concat(l[i.PRERELEASE],")?(?:").concat(l[i.BUILD],")?(?:$|[^\\d])")),p("COERCERTL",l[i.COERCE],!0),p("COERCERTLFULL",l[i.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM","(\\s*)".concat(l[i.LONETILDE],"\\s+"),!0),e.tildeTrimReplace="$1~",p("TILDE","^".concat(l[i.LONETILDE]).concat(l[i.XRANGEPLAIN],"$")),p("TILDELOOSE","^".concat(l[i.LONETILDE]).concat(l[i.XRANGEPLAINLOOSE],"$")),p("LONECARET","(?:\\^)"),p("CARETTRIM","(\\s*)".concat(l[i.LONECARET],"\\s+"),!0),e.caretTrimReplace="$1^",p("CARET","^".concat(l[i.LONECARET]).concat(l[i.XRANGEPLAIN],"$")),p("CARETLOOSE","^".concat(l[i.LONECARET]).concat(l[i.XRANGEPLAINLOOSE],"$")),p("COMPARATORLOOSE","^".concat(l[i.GTLT],"\\s*(").concat(l[i.LOOSEPLAIN],")$|^$")),p("COMPARATOR","^".concat(l[i.GTLT],"\\s*(").concat(l[i.FULLPLAIN],")$|^$")),p("COMPARATORTRIM","(\\s*)".concat(l[i.GTLT],"\\s*(").concat(l[i.LOOSEPLAIN],"|").concat(l[i.XRANGEPLAIN],")"),!0),e.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE","^\\s*(".concat(l[i.XRANGEPLAIN],")\\s+-\\s+(").concat(l[i.XRANGEPLAIN],")\\s*$")),p("HYPHENRANGELOOSE","^\\s*(".concat(l[i.XRANGEPLAINLOOSE],")\\s+-\\s+(").concat(l[i.XRANGEPLAINLOOSE],")\\s*$")),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(bm,bm.exports)),bm.exports}var Am,gd;function Hv(){if(gd)return Am;gd=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return Am=t=>t?typeof t!="object"?r:t:e,Am}var Sm,wd;function Mv(){if(wd)return Sm;wd=1;const r=/^[0-9]+$/,e=(t,s)=>{const a=r.test(t),n=r.test(s);return a&&n&&(t=+t,s=+s),t===s?0:a&&!n?-1:n&&!a?1:t<s?-1:1};return Sm={compareIdentifiers:e,rcompareIdentifiers:(t,s)=>e(s,t)},Sm}var Nm,yd;function Kg(){if(yd)return Nm;yd=1;const r=$g(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Ug(),{safeRe:s,t:a}=Kv(),n=Hv(),{compareIdentifiers:u}=Mv();class o{constructor(i,c){if(c=n(c),i instanceof o){if(i.loose===!!c.loose&&i.includePrerelease===!!c.includePrerelease)return i;i=i.version}else if(typeof i!="string")throw new TypeError('Invalid version. Must be a string. Got type "'.concat(typeof i,'".'));if(i.length>e)throw new TypeError("version is longer than ".concat(e," characters"));r("SemVer",i,c),this.options=c,this.loose=!!c.loose,this.includePrerelease=!!c.includePrerelease;const m=i.trim().match(c.loose?s[a.LOOSE]:s[a.FULL]);if(!m)throw new TypeError("Invalid Version: ".concat(i));if(this.raw=i,this.major=+m[1],this.minor=+m[2],this.patch=+m[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");m[4]?this.prerelease=m[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const g=+h;if(g>=0&&g<t)return g}return h}):this.prerelease=[],this.build=m[5]?m[5].split("."):[],this.format()}format(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}toString(){return this.version}compare(i){if(r("SemVer.compare",this.version,this.options,i),!(i instanceof o)){if(typeof i=="string"&&i===this.version)return 0;i=new o(i,this.options)}return i.version===this.version?0:this.compareMain(i)||this.comparePre(i)}compareMain(i){return i instanceof o||(i=new o(i,this.options)),u(this.major,i.major)||u(this.minor,i.minor)||u(this.patch,i.patch)}comparePre(i){if(i instanceof o||(i=new o(i,this.options)),this.prerelease.length&&!i.prerelease.length)return-1;if(!this.prerelease.length&&i.prerelease.length)return 1;if(!this.prerelease.length&&!i.prerelease.length)return 0;let c=0;do{const m=this.prerelease[c],h=i.prerelease[c];if(r("prerelease compare",c,m,h),m===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(m===void 0)return-1;if(m!==h)return u(m,h)}while(++c)}compareBuild(i){i instanceof o||(i=new o(i,this.options));let c=0;do{const m=this.build[c],h=i.build[c];if(r("build compare",c,m,h),m===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(m===void 0)return-1;if(m!==h)return u(m,h)}while(++c)}inc(i,c,m){switch(i){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",c,m);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",c,m);break;case"prepatch":this.prerelease.length=0,this.inc("patch",c,m),this.inc("pre",c,m);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",c,m),this.inc("pre",c,m);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(m)?1:0;if(!c&&m===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[h];else{let g=this.prerelease.length;for(;--g>=0;)typeof this.prerelease[g]=="number"&&(this.prerelease[g]++,g=-2);if(g===-1){if(c===this.prerelease.join(".")&&m===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(c){let g=[c,h];m===!1&&(g=[c]),u(this.prerelease[0],c)===0?isNaN(this.prerelease[1])&&(this.prerelease=g):this.prerelease=g}break}default:throw new Error("invalid increment argument: ".concat(i))}return this.raw=this.format(),this.build.length&&(this.raw+="+".concat(this.build.join("."))),this}}return Nm=o,Nm}var km,vd;function Jv(){if(vd)return km;vd=1;const r=Kg();return km=(e,t,s=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(a){if(!s)return null;throw a}},km}var Cm,bd;function Fv(){if(bd)return Cm;bd=1;const r=Jv();return Cm=(e,t)=>{const s=r(e,t);return s?s.version:null},Cm}Fv();var Em,Ad;function qv(){if(Ad)return Em;Ad=1;const r=Kg();return Em=(e,t)=>new r(e,t).major,Em}qv();function Wv(r){return typeof r=="function"?r:Array.isArray(r)?e=>{for(const t of r)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}const Gv="\n";function zv(r,e){let t="";return e.format&&e.indentBy.length>0&&(t=Gv),Hg(r,e,"",t)}function Hg(r,e,t,s){let a="",n=!1;for(let u=0;u<r.length;u++){const o=r[u],l=Xv(o);if(l===void 0)continue;let i="";if(t.length===0?i=l:i="".concat(t,".").concat(l),l===e.textNodeName){let p=o[l];_v(i,e)||(p=e.tagValueProcessor(l,p),p=Mg(p,e)),n&&(a+=s),a+=p,n=!1;continue}else if(l===e.cdataPropName){n&&(a+=s),a+="<![CDATA[".concat(o[l][0][e.textNodeName],"]]>"),n=!1;continue}else if(l===e.commentPropName){a+=s+"<!--".concat(o[l][0][e.textNodeName],"-->"),n=!0;continue}else if(l[0]==="?"){const p=Sd(o[":@"],e),y=l==="?xml"?"":s;let w=o[l][0][e.textNodeName];w=w.length!==0?" "+w:"",a+=y+"<".concat(l).concat(w).concat(p,"?>"),n=!0;continue}let c=s;c!==""&&(c+=e.indentBy);const m=Sd(o[":@"],e),h=s+"<".concat(l).concat(m),g=Hg(o[l],e,i,c);e.unpairedTags.indexOf(l)!==-1?e.suppressUnpairedNode?a+=h+">":a+=h+"/>":(!g||g.length===0)&&e.suppressEmptyNode?a+=h+"/>":g&&g.endsWith(">")?a+=h+">".concat(g).concat(s,"</").concat(l,">"):(a+=h+">",g&&s!==""&&(g.includes("/>")||g.includes("</"))?a+=s+e.indentBy+g+s:a+=g,a+="</".concat(l,">")),n=!0}return a}function Xv(r){const e=Object.keys(r);for(let t=0;t<e.length;t++){const s=e[t];if(r.hasOwnProperty(s)&&s!==":@")return s}}function Sd(r,e){let t="";if(r&&!e.ignoreAttributes)for(let s in r){if(!r.hasOwnProperty(s))continue;let a=e.attributeValueProcessor(s,r[s]);a=Mg(a,e),a===!0&&e.suppressBooleanAttributes?t+=" ".concat(s.substr(e.attributeNamePrefix.length)):t+=" ".concat(s.substr(e.attributeNamePrefix.length),'="').concat(a,'"')}return t}function _v(r,e){r=r.substr(0,r.length-e.textNodeName.length-1);let t=r.substr(r.lastIndexOf(".")+1);for(let s in e.stopNodes)if(e.stopNodes[s]===r||e.stopNodes[s]==="*."+t)return!0;return!1}function Mg(r,e){if(r&&r.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const s=e.entities[t];r=r.replace(s.regex,s.val)}return r}const Yv={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Wr(r){this.options=Object.assign({},Yv,r),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=Wv(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=eb),this.processTextOrObjNode=Qv,this.options.format?(this.indentate=Zv,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Wr.prototype.build=function(r){return this.options.preserveOrder?zv(r,this.options):(Array.isArray(r)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(r={[this.options.arrayNodeName]:r}),this.j2x(r,0,[]).val)},Wr.prototype.j2x=function(r,e,t){let s="",a="";const n=t.join(".");for(let u in r)if(Object.prototype.hasOwnProperty.call(r,u))if(typeof r[u]>"u")this.isAttribute(u)&&(a+="");else if(r[u]===null)this.isAttribute(u)||u===this.options.cdataPropName?a+="":u[0]==="?"?a+=this.indentate(e)+"<"+u+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+u+"/"+this.tagEndChar;else if(r[u]instanceof Date)a+=this.buildTextValNode(r[u],u,"",e);else if(typeof r[u]!="object"){const o=this.isAttribute(u);if(o&&!this.ignoreAttributesFn(o,n))s+=this.buildAttrPairStr(o,""+r[u]);else if(!o)if(u===this.options.textNodeName){let l=this.options.tagValueProcessor(u,""+r[u]);a+=this.replaceEntitiesValue(l)}else a+=this.buildTextValNode(r[u],u,"",e)}else if(Array.isArray(r[u])){const o=r[u].length;let l="",i="";for(let c=0;c<o;c++){const m=r[u][c];if(!(typeof m>"u"))if(m===null)u[0]==="?"?a+=this.indentate(e)+"<"+u+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+u+"/"+this.tagEndChar;else if(typeof m=="object")if(this.options.oneListGroup){const h=this.j2x(m,e+1,t.concat(u));l+=h.val,this.options.attributesGroupName&&m.hasOwnProperty(this.options.attributesGroupName)&&(i+=h.attrStr)}else l+=this.processTextOrObjNode(m,u,e,t);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(u,m);h=this.replaceEntitiesValue(h),l+=h}else l+=this.buildTextValNode(m,u,"",e)}this.options.oneListGroup&&(l=this.buildObjectNode(l,u,i,e)),a+=l}else if(this.options.attributesGroupName&&u===this.options.attributesGroupName){const o=Object.keys(r[u]),l=o.length;for(let i=0;i<l;i++)s+=this.buildAttrPairStr(o[i],""+r[u][o[i]])}else a+=this.processTextOrObjNode(r[u],u,e,t);return{attrStr:s,val:a}},Wr.prototype.buildAttrPairStr=function(r,e){return e=this.options.attributeValueProcessor(r,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+r:" "+r+'="'+e+'"'};function Qv(r,e,t,s){const a=this.j2x(r,t+1,s.concat(e));return r[this.options.textNodeName]!==void 0&&Object.keys(r).length===1?this.buildTextValNode(r[this.options.textNodeName],e,a.attrStr,t):this.buildObjectNode(a.val,e,a.attrStr,t)}Wr.prototype.buildObjectNode=function(r,e,t,s){if(r==="")return e[0]==="?"?this.indentate(s)+"<"+e+t+"?"+this.tagEndChar:this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let a="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",a=""),(t||t==="")&&r.indexOf("<")===-1?this.indentate(s)+"<"+e+t+n+">"+r+a:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(s)+"<!--".concat(r,"-->")+this.newLine:this.indentate(s)+"<"+e+t+n+this.tagEndChar+r+this.indentate(s)+a}},Wr.prototype.closeTag=function(r){let e="";return this.options.unpairedTags.indexOf(r)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e="></".concat(r),e},Wr.prototype.buildTextValNode=function(r,e,t,s){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(s)+"<![CDATA[".concat(r,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(s)+"<!--".concat(r,"-->")+this.newLine;if(e[0]==="?")return this.indentate(s)+"<"+e+t+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(e,r);return a=this.replaceEntitiesValue(a),a===""?this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(s)+"<"+e+t+">"+a+"</"+e+this.tagEndChar}},Wr.prototype.replaceEntitiesValue=function(r){if(r&&r.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];r=r.replace(t.regex,t.val)}return r};function Zv(r){return this.options.indentBy.repeat(r)}function eb(r){return r.startsWith(this.options.attributeNamePrefix)&&r!==this.options.textNodeName?r.substr(this.attrPrefixLen):!1}function Kc(r){return r.users!==void 0}const tb=r=>r===null?of().setApp("end_to_end_encryption").build():of().setApp("end_to_end_encryption").setUid(r.uid).build(),ze=tb(Gf());class Se{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let s=0;s<t;s++)this.view[s]=e.charCodeAt(s)}toString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)s+=String.fromCharCode(this.view[a]);return s}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const s=new Map;s.set("0",0),s.set("1",1),s.set("2",2),s.set("3",3),s.set("4",4),s.set("5",5),s.set("6",6),s.set("7",7),s.set("8",8),s.set("9",9),s.set("A",10),s.set("a",10),s.set("B",11),s.set("b",11),s.set("C",12),s.set("c",12),s.set("D",13),s.set("d",13),s.set("E",14),s.set("e",14),s.set("F",15),s.set("f",15);let a=0,n=0;for(let u=0;u<t;u++)u%2?(n|=s.get(e.charAt(u)),this.view[a]=n,a++):n=s.get(e.charAt(u))<<4}toHexString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){const n=this.view[a].toString(16).toUpperCase();s=s+(n.length==1?"0":"")+n}return s}copy(e=0,t=this.length-e){if(!e&&!this.length)return new Se;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Se({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new Se;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Se({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),s=new Uint8Array(t);e>this._view.length?s.set(this._view):s.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,s=e.length,a=e._view.subarray();this.realloc(t+s),this._view.set(a,t)}insert(e,t=0,s=this.length-t){return t>this.length-1?!1:(s>this.length-t&&(s=this.length-t),s>e.length&&(s=e.length),s==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,s),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,s,a){const{start:n,length:u,backward:o}=this.prepareFindParameters(t,s,a),l=e.length;if(l>u)return-1;const i=[];for(let c=0;c<l;c++)i.push(e.view[c]);for(let c=0;c<=u-l;c++){let m=!0;const h=o?n-l-c:n+c;for(let g=0;g<l;g++)if(this.view[g+h]!=i[g]){m=!1;break}if(m)return o?n-l-c:n+l+c}return-1}findFirstIn(e,t,s,a){const{start:n,length:u,backward:o}=this.prepareFindParameters(t,s,a),l={id:-1,position:o?0:n+u,length:0};for(let i=0;i<e.length;i++){const c=this.findPattern(e[i],n,u,o);if(c!=-1){let m=!1;const h=e[i].length;o?c-h>=l.position-l.length&&(m=!0):c-h<=l.position-l.length&&(m=!0),m&&(l.position=c,l.id=i,l.length=h)}}return l}findAllIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const u=[];let o={id:-1,position:a};do{const l=o.position;if(o=this.findFirstIn(e,o.position,n),o.id==-1)break;n-=o.position-l,u.push({id:o.id,position:o.position})}while(!0);return u}findAllPatternIn(e,t,s){const{start:a,length:n}=this.prepareFindParameters(t,s),u=[],o=e.length;if(o>n)return-1;const l=Array.from(e.view);for(let i=0;i<=n-o;i++){let c=!0;const m=a+i;for(let h=0;h<o;h++)if(this.view[h+m]!=l[h]){c=!1;break}c&&(u.push(a+o+i),i+=o-1)}return u}findFirstNotIn(e,t,s,a){let{start:n,length:u,backward:o}=this.prepareFindParameters(t,s,a);const l={left:{id:-1,position:n},right:{id:-1,position:0},value:new Se};let i=u;for(;i>0;){if(l.right=this.findFirstIn(e,o?n-u+i:n+u-i,i,o),l.right.id==-1){u=i,o?n-=u:n=l.left.position,l.value=new Se({buffer:this._buffer.slice(n,n+u)});break}if(l.right.position!=(o?l.left.position-e[l.right.id].length:l.left.position+e[l.right.id].length)){o?(n=l.right.position+e[l.right.id].length,u=l.left.position-l.right.position-e[l.right.id].length):(n=l.left.position,u=l.right.position-l.left.position-e[l.right.id].length),l.value=new Se({buffer:this._buffer.slice(n,n+u)});break}l.left=l.right,i-=e[l.right.id].length}if(o){const c=l.right;l.right=l.left,l.left=c}return l}findAllNotIn(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const u=[];let o={left:{id:-1,position:a},right:{id:-1,position:a},value:new Se};do{const l=o.right.position;o=this.findFirstNotIn(e,o.right.position,n),n-=o.right.position-l,u.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(o.right.id!=-1);return u}findFirstSequence(e,t,s,a){let{start:n,length:u,backward:o}=this.prepareFindParameters(t,s,a);const l=this.skipNotPatterns(e,n,u,o);if(l==-1)return{position:-1,value:new Se};const i=this.skipPatterns(e,l,u-(o?n-l:l-n),o);o?(n=i,u=l-i):(n=l,u=i-l);const c=new Se({buffer:this._buffer.slice(n,n+u)});return{position:i,value:c}}findAllSequences(e,t,s){let{start:a,length:n}=this.prepareFindParameters(t,s);const u=[];let o={position:a,value:new Se};do{const l=o.position;o=this.findFirstSequence(e,o.position,n),o.position!=-1&&(n-=o.position-l,u.push({position:o.position,value:o.value}))}while(o.position!=-1);return u}findPairedPatterns(e,t,s,a){const n=[];if(e.isEqual(t))return n;const{start:u,length:o}=this.prepareFindParameters(s,a);let l=0;const i=this.findAllPatternIn(e,u,o);if(!Array.isArray(i)||i.length==0)return n;const c=this.findAllPatternIn(t,u,o);if(!Array.isArray(c)||c.length==0)return n;for(;l<i.length&&c.length!=0;){if(i[0]==c[0]){n.push({left:i[0],right:c[0]}),i.splice(0,1),c.splice(0,1);continue}if(i[l]>c[0])break;for(;i[l]<c[0]&&(l++,!(l>=i.length)););n.push({left:i[l-1],right:c[0]}),i.splice(l-1,1),c.splice(0,1),l=0}return n.sort((m,h)=>m.left-h.left),n}findPairedArrays(e,t,s,a){const{start:n,length:u}=this.prepareFindParameters(s,a),o=[];let l=0;const i=this.findAllIn(e,n,u);if(i.length==0)return o;const c=this.findAllIn(t,n,u);if(c.length==0)return o;for(;l<i.length&&c.length!=0;){if(i[0].position==c[0].position){o.push({left:i[0],right:c[0]}),i.splice(0,1),c.splice(0,1);continue}if(i[l].position>c[0].position)break;for(;i[l].position<c[0].position&&(l++,!(l>=i.length)););o.push({left:i[l-1],right:c[0]}),i.splice(l-1,1),c.splice(0,1),l=0}return o.sort((m,h)=>m.left.position-h.left.position),o}replacePattern(e,t,s,a,n=null){let u=[],o;const l={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:i,length:c}=this.prepareFindParameters(s,a);if(n==null){if(u=this.findAllIn([e],i,c),u.length==0)return l}else u=n;l.searchPatternPositions.push(...Array.from(u,p=>p.position));const m=e.length-t.length,h=new ArrayBuffer(this.view.length-u.length*m),g=new Uint8Array(h);for(g.set(new Uint8Array(this.buffer,0,i)),o=0;o<u.length;o++){const p=o==0?i:u[o-1].position;g.set(new Uint8Array(this.buffer,p,u[o].position-e.length-p),p-o*m),g.set(t.view,u[o].position-e.length-o*m),l.replacePatternPositions.push(u[o].position-e.length-o*m)}return o--,g.set(new Uint8Array(this.buffer,u[o].position,this.length-u[o].position),u[o].position-e.length+t.length-o*m),this.buffer=h,this.view=new Uint8Array(this.buffer),l.status=1,l}skipPatterns(e,t,s,a){const{start:n,length:u,backward:o}=this.prepareFindParameters(t,s,a);let l=n;for(let i=0;i<e.length;i++){const c=e[i].length,m=o?l-c:l;let h=!0;for(let g=0;g<c;g++)if(this.view[g+m]!=e[i].view[g]){h=!1;break}if(h){if(i=-1,o){if(l-=c,l<=0)return l}else if(l+=c,l>=n+u)return l}}return l}skipNotPatterns(e,t,s,a){const{start:n,length:u,backward:o}=this.prepareFindParameters(t,s,a);let l=-1;for(let i=0;i<u;i++){for(let c=0;c<e.length;c++){const m=e[c].length,h=o?n-i-m:n+i;let g=!0;for(let p=0;p<m;p++)if(this.view[p+h]!=e[c].view[p]){g=!1;break}if(g){l=o?n-i:n+i;break}}if(l!=-1)break}return l}prepareFindParameters(e=null,t=null,s=!1){return e===null&&(e=s?this.length:0),e>this.length&&(e=this.length),s?(t===null&&(t=e),t>e&&(t=e)):(t===null&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:s}}}const sb=16777216;class Zr{constructor(e={}){this._stream=new Se,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new Se({view:e.view}):"buffer"in e?this.stream=new Se({buffer:e.buffer}):"string"in e?this.stream=new Se({string:e.string}):"hexstring"in e?this.stream=new Se({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new Se,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findPattern(e,this.start,this.length,this.backward);if(s==-1)return s;if(this.backward){if(s<this.start-e.length-t)return-1}else if(s>this.start+e.length+t)return-1;return this.start=s,s}findFirstIn(e,t=null){(t==null||t>this.length)&&(t=this.length);const s=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(s.id==-1)return s;if(this.backward){if(s.position<this.start-e[s.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(s.position>this.start+e[s.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=s.position,s}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(t==null||t>this._length)&&(t=this._length);const s=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(s.left.id==-1&&s.right.id==-1)return s;if(this.backward){if(s.right.id!=-1&&s.right.position<this._start-e[s.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Se}}else if(s.left.id!=-1&&s.left.position>this._start+e[s.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Se};return this.backward?s.left.id==-1?this.start=0:this.start=s.left.position:s.right.id==-1?this.start=this._start+this._length:this.start=s.right.position,s}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,s=null){(t==null||t>this._length)&&(t=this._length),(s==null||s>t)&&(s=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(a.value.length==0)return a;if(this.backward){if(a.position<this._start-a.value.length-s)return{position:-1,value:new Se}}else if(a.position>this._start+a.value.length+s)return{position:-1,value:new Se};return this.start=a.position,a}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right<this.start-t.length-s)return[]}else if(n[0].left>this.start+e.length+s)return[]}return n}findPairedArrays(e,t,s=null){(s==null||s>this.length)&&(s=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-s)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+s)return[]}return n}replacePattern(e,t){const s=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,s,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return t==-1?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),s=new Uint8Array(t.buffer);this.stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[2],this._stream.view[this._start+1]=s[1],this._stream.view[this._start+2]=s[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[1],this._stream.view[this._start+1]=s[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),s=new Uint8Array(t.buffer);this._stream.view[this._start]=s[3],this._stream.view[this._start+1]=s[2],this._stream.view[this._start+2]=s[1],this._stream.view[this._start+3]=s[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);this._length<e&&(e=this._length);let s;if(this.backward){const a=this._stream.view.subarray(this._length-e,this._length);s=new Uint8Array(e);for(let n=0;n<e;n++)s[e-1-n]=a[n]}else s=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),s}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),s=32768;return t&s?-(s-(t^s)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:t[0]*sb+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),s=2147483648;return t&s?-(s-(t^s)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+Zr.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}Zr.APPEND_BLOCK=1e3;function rb(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Jg(r,...e){if(!rb(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Nd(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function ab(r,e){Jg(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const xm=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),is=(r,e)=>r<<32-e|r>>>e,Im=(r,e)=>r<<e|r>>>32-e>>>0;function nb(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Fg(r){return typeof r=="string"&&(r=nb(r)),Jg(r),r}class ib{clone(){return this._cloneInto()}}function Fh(r){const e=s=>r().update(Fg(s)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function ob(r,e,t,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,s);const a=BigInt(32),n=BigInt(4294967295),u=Number(t>>a&n),o=Number(t&n),l=s?4:0,i=s?0:4;r.setUint32(e+l,u,s),r.setUint32(e+i,o,s)}const qg=(r,e,t)=>r&e^~r&t,Wg=(r,e,t)=>r&e^r&t^e&t;class np extends ib{constructor(e,t,s,a){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=xm(this.buffer)}update(e){Nd(this);const{view:t,buffer:s,blockLen:a}=this;e=Fg(e);const n=e.length;for(let u=0;u<n;){const o=Math.min(a-this.pos,n-u);if(o===a){const l=xm(e);for(;a<=n-u;u+=a)this.process(l,u);continue}s.set(e.subarray(u,u+o),this.pos),this.pos+=o,u+=o,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Nd(this),ab(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:a,isLE:n}=this;let{pos:u}=this;t[u++]=128,this.buffer.subarray(u).fill(0),this.padOffset>a-u&&(this.process(s,0),u=0);for(let m=u;m<a;m++)t[m]=0;ob(s,a-8,BigInt(this.length*8),n),this.process(s,0);const o=xm(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const i=l/4,c=this.get();if(i>c.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<i;m++)o.setUint32(4*m,c[m],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:a,finished:n,destroyed:u,pos:o}=this;return e.length=a,e.pos=o,e.finished=n,e.destroyed=u,a%t&&e.buffer.set(s),e}}const Po=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),Gs=new Uint32Array(80);let lb=class extends np{constructor(){super(64,20,8,!1),this.A=Po[0]|0,this.B=Po[1]|0,this.C=Po[2]|0,this.D=Po[3]|0,this.E=Po[4]|0}get(){const{A:r,B:e,C:t,D:s,E:a}=this;return[r,e,t,s,a]}set(r,e,t,s,a){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0}process(r,e){for(let o=0;o<16;o++,e+=4)Gs[o]=r.getUint32(e,!1);for(let o=16;o<80;o++)Gs[o]=Im(Gs[o-3]^Gs[o-8]^Gs[o-14]^Gs[o-16],1);let{A:t,B:s,C:a,D:n,E:u}=this;for(let o=0;o<80;o++){let l,i;o<20?(l=qg(s,a,n),i=1518500249):o<40?(l=s^a^n,i=1859775393):o<60?(l=Wg(s,a,n),i=2400959708):(l=s^a^n,i=3395469782);const c=Im(t,5)+l+u+i+Gs[o]|0;u=n,n=a,a=Im(s,30),s=t,t=c}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,u=u+this.E|0,this.set(t,s,a,n,u)}roundClean(){Gs.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}};const ub=Fh(()=>new lb),cb=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),zs=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Xs=new Uint32Array(64);let hb=class extends np{constructor(){super(64,32,8,!1),this.A=zs[0]|0,this.B=zs[1]|0,this.C=zs[2]|0,this.D=zs[3]|0,this.E=zs[4]|0,this.F=zs[5]|0,this.G=zs[6]|0,this.H=zs[7]|0}get(){const{A:r,B:e,C:t,D:s,E:a,F:n,G:u,H:o}=this;return[r,e,t,s,a,n,u,o]}set(r,e,t,s,a,n,u,o){this.A=r|0,this.B=e|0,this.C=t|0,this.D=s|0,this.E=a|0,this.F=n|0,this.G=u|0,this.H=o|0}process(r,e){for(let c=0;c<16;c++,e+=4)Xs[c]=r.getUint32(e,!1);for(let c=16;c<64;c++){const m=Xs[c-15],h=Xs[c-2],g=is(m,7)^is(m,18)^m>>>3,p=is(h,17)^is(h,19)^h>>>10;Xs[c]=p+Xs[c-7]+g+Xs[c-16]|0}let{A:t,B:s,C:a,D:n,E:u,F:o,G:l,H:i}=this;for(let c=0;c<64;c++){const m=is(u,6)^is(u,11)^is(u,25),h=i+m+qg(u,o,l)+cb[c]+Xs[c]|0,g=(is(t,2)^is(t,13)^is(t,22))+Wg(t,s,a)|0;i=l,l=o,o=u,u=n+h|0,n=a,a=s,s=t,t=h+g|0}t=t+this.A|0,s=s+this.B|0,a=a+this.C|0,n=n+this.D|0,u=u+this.E|0,o=o+this.F|0,l=l+this.G|0,i=i+this.H|0,this.set(t,s,a,n,u,o,l,i)}roundClean(){Xs.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const mb=Fh(()=>new hb),cc=BigInt(2**32-1),bf=BigInt(32);function Gg(r,e=!1){return e?{h:Number(r&cc),l:Number(r>>bf&cc)}:{h:Number(r>>bf&cc)|0,l:Number(r&cc)|0}}function fb(r,e=!1){let t=new Uint32Array(r.length),s=new Uint32Array(r.length);for(let a=0;a<r.length;a++){const{h:n,l:u}=Gg(r[a],e);[t[a],s[a]]=[n,u]}return[t,s]}const pb=(r,e)=>BigInt(r>>>0)<<bf|BigInt(e>>>0),db=(r,e,t)=>r>>>t,gb=(r,e,t)=>r<<32-t|e>>>t,wb=(r,e,t)=>r>>>t|e<<32-t,yb=(r,e,t)=>r<<32-t|e>>>t,vb=(r,e,t)=>r<<64-t|e>>>t-32,bb=(r,e,t)=>r>>>t-32|e<<64-t,Ab=(r,e)=>e,Sb=(r,e)=>r,Nb=(r,e,t)=>r<<t|e>>>32-t,kb=(r,e,t)=>e<<t|r>>>32-t,Cb=(r,e,t)=>e<<t-32|r>>>64-t,Eb=(r,e,t)=>r<<t-32|e>>>64-t;function xb(r,e,t,s){const a=(e>>>0)+(s>>>0);return{h:r+t+(a/2**32|0)|0,l:a|0}}const Ib=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Vb=(r,e,t,s)=>e+t+s+(r/2**32|0)|0,Bb=(r,e,t,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0),Pb=(r,e,t,s,a)=>e+t+s+a+(r/2**32|0)|0,Ob=(r,e,t,s,a)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0)+(a>>>0),Db=(r,e,t,s,a,n)=>e+t+s+a+n+(r/2**32|0)|0,re={fromBig:Gg,split:fb,toBig:pb,shrSH:db,shrSL:gb,rotrSH:wb,rotrSL:yb,rotrBH:vb,rotrBL:bb,rotr32H:Ab,rotr32L:Sb,rotlSH:Nb,rotlSL:kb,rotlBH:Cb,rotlBL:Eb,add:xb,add3L:Ib,add3H:Vb,add4L:Bb,add4H:Pb,add5H:Db,add5L:Ob},[Tb,Rb]=re.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),_s=new Uint32Array(80),Ys=new Uint32Array(80);let zg=class extends np{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:r,Al:e,Bh:t,Bl:s,Ch:a,Cl:n,Dh:u,Dl:o,Eh:l,El:i,Fh:c,Fl:m,Gh:h,Gl:g,Hh:p,Hl:y}=this;return[r,e,t,s,a,n,u,o,l,i,c,m,h,g,p,y]}set(r,e,t,s,a,n,u,o,l,i,c,m,h,g,p,y){this.Ah=r|0,this.Al=e|0,this.Bh=t|0,this.Bl=s|0,this.Ch=a|0,this.Cl=n|0,this.Dh=u|0,this.Dl=o|0,this.Eh=l|0,this.El=i|0,this.Fh=c|0,this.Fl=m|0,this.Gh=h|0,this.Gl=g|0,this.Hh=p|0,this.Hl=y|0}process(r,e){for(let f=0;f<16;f++,e+=4)_s[f]=r.getUint32(e),Ys[f]=r.getUint32(e+=4);for(let f=16;f<80;f++){const v=_s[f-15]|0,k=Ys[f-15]|0,N=re.rotrSH(v,k,1)^re.rotrSH(v,k,8)^re.shrSH(v,k,7),S=re.rotrSL(v,k,1)^re.rotrSL(v,k,8)^re.shrSL(v,k,7),x=_s[f-2]|0,C=Ys[f-2]|0,I=re.rotrSH(x,C,19)^re.rotrBH(x,C,61)^re.shrSH(x,C,6),P=re.rotrSL(x,C,19)^re.rotrBL(x,C,61)^re.shrSL(x,C,6),B=re.add4L(S,P,Ys[f-7],Ys[f-16]),D=re.add4H(B,N,I,_s[f-7],_s[f-16]);_s[f]=D|0,Ys[f]=B|0}let{Ah:t,Al:s,Bh:a,Bl:n,Ch:u,Cl:o,Dh:l,Dl:i,Eh:c,El:m,Fh:h,Fl:g,Gh:p,Gl:y,Hh:w,Hl:b}=this;for(let f=0;f<80;f++){const v=re.rotrSH(c,m,14)^re.rotrSH(c,m,18)^re.rotrBH(c,m,41),k=re.rotrSL(c,m,14)^re.rotrSL(c,m,18)^re.rotrBL(c,m,41),N=c&h^~c&p,S=m&g^~m&y,x=re.add5L(b,k,S,Rb[f],Ys[f]),C=re.add5H(x,w,v,N,Tb[f],_s[f]),I=x|0,P=re.rotrSH(t,s,28)^re.rotrBH(t,s,34)^re.rotrBH(t,s,39),B=re.rotrSL(t,s,28)^re.rotrBL(t,s,34)^re.rotrBL(t,s,39),D=t&a^t&u^a&u,V=s&n^s&o^n&o;w=p|0,b=y|0,p=h|0,y=g|0,h=c|0,g=m|0,{h:c,l:m}=re.add(l|0,i|0,C|0,I|0),l=u|0,i=o|0,u=a|0,o=n|0,a=t|0,n=s|0;const K=re.add3L(I,B,V);t=re.add3H(K,C,P,D),s=K|0}({h:t,l:s}=re.add(this.Ah|0,this.Al|0,t|0,s|0)),{h:a,l:n}=re.add(this.Bh|0,this.Bl|0,a|0,n|0),{h:u,l:o}=re.add(this.Ch|0,this.Cl|0,u|0,o|0),{h:l,l:i}=re.add(this.Dh|0,this.Dl|0,l|0,i|0),{h:c,l:m}=re.add(this.Eh|0,this.El|0,c|0,m|0),{h,l:g}=re.add(this.Fh|0,this.Fl|0,h|0,g|0),{h:p,l:y}=re.add(this.Gh|0,this.Gl|0,p|0,y|0),{h:w,l:b}=re.add(this.Hh|0,this.Hl|0,w|0,b|0),this.set(t,s,a,n,u,o,l,i,c,m,h,g,p,y,w,b)}roundClean(){_s.fill(0),Ys.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Lb=class extends zg{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}};const jb=Fh(()=>new zg),$b=Fh(()=>new Lb),Le=new ArrayBuffer(0),A="";class me extends TypeError{constructor(){super(...arguments),this.name=me.NAME}static isType(e,t){if(typeof t=="string"){if(t==="Array"&&Array.isArray(e)||t==="ArrayBuffer"&&e instanceof ArrayBuffer||t==="ArrayBufferView"&&ArrayBuffer.isView(e)||typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...s){for(const n of s)if(this.isType(e,n))return;const a=s.map(n=>n instanceof Function&&"name"in n?n.name:"".concat(n));throw new me("Parameter '".concat(t,"' is not of type ").concat(a.length>1?"(".concat(a.join(" or "),")"):a[0]))}}me.NAME="ArgumentError";class ie extends TypeError{static assert(...e){let t=null,s,a;typeof e[0]=="string"?(t=e[0],s=e[1],a=e.slice(2)):(s=e[0],a=e.slice(1)),me.assert(s,"parameters","object");for(const n of a)if(s[n]==null)throw new ie(n,t)}static assertEmpty(e,t,s){if(e==null)throw new ie(t,s)}constructor(e,t=null,s){super(),this.name=ie.NAME,this.field=e,t&&(this.target=t),s?this.message=s:this.message="Absent mandatory parameter '".concat(e,"' ").concat(t?" in '".concat(t,"'"):A)}}ie.NAME="ParameterError";class L extends Error{static assertSchema(e,t){if(!e.verified)throw new Error("Object's schema was not verified against input data for ".concat(t))}static assert(e,t){if(e.offset===-1)throw new L("Error during parsing of ASN.1 data. Data is not correct for '".concat(t,"'."))}constructor(e){super(e),this.name="AsnError"}}class j{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=Re(e);L.assert(t,this.name);try{return new this({schema:t.result})}catch(s){throw new L("Cannot create '".concat(this.CLASS_NAME,"' from ASN.1 object"))}}static defaultValues(e){throw new Error("Invalid member name for ".concat(this.CLASS_NAME," class: ").concat(e))}static schema(e={}){throw new Error("Method '".concat(this.CLASS_NAME,".schema' should be overridden"))}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch(s){t=this.toSchema(!0)}return he.ToString(t.toBER(),e)}}j.CLASS_NAME="PkiObject";function Ur(r){let e=!1,t=A;const s=r.trim();for(let a=0;a<s.length;a++)s.charCodeAt(a)===32?e===!1&&(e=!0):(e&&(t+=" ",e=!1),t+=s[a]);return t.toLowerCase()}const Oo="type",Vm="value";class Gr extends j{constructor(e={}){super(),this.type=d(e,Oo,Gr.defaultValues(Oo)),this.value=d(e,Vm,Gr.defaultValues(Vm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oo:return A;case Vm:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.type||A}),new Y({name:t.value||A})]})}fromSchema(e){$(e,[Oo,"typeValue"]);const t=U(e,e,Gr.schema({names:{type:Oo,value:"typeValue"}}));L.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new E({value:[new W({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return Object.keys(this.value).length!==0?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[bh.blockName(),ff.blockName(),mf.blockName(),jc.blockName(),Os.blockName(),hf.blockName(),Rw.blockName(),og.blockName(),Lw.blockName(),jw.blockName(),$w.blockName(),Uw.blockName()];if(e instanceof ArrayBuffer)return ge.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===Gr.blockName()){if(this.type!==e.type)return!1;const s=[!1,!1],a=this.value.constructor.blockName();for(const n of t)a===n&&(s[0]=!0),e.value.constructor.blockName()===n&&(s[1]=!0);if(s[0]!==s[1])return!1;if(s[0]&&s[1]){const n=Ur(this.value.valueBlock.value),u=Ur(e.value.valueBlock.value);if(n.localeCompare(u)!==0)return!1}else if(!ge.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}Gr.CLASS_NAME="AttributeTypeAndValue";const oa="typesAndValues",hc="valueBeforeDecode",kd="RDN";class fe extends j{constructor(e={}){super(),this.typesAndValues=d(e,oa,fe.defaultValues(oa)),this.valueBeforeDecode=d(e,hc,fe.defaultValues(hc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oa:return[];case hc:return Le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oa:return t.length===0;case hc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.repeatedSequence||A,value:new Je({value:[new ee({name:t.repeatedSet||A,value:Gr.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){$(e,[kd,oa]);const t=U(e,e,fe.schema({names:{blockName:kd,repeatedSet:oa}}));L.assertSchema(t,this.className),oa in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,s=>new Gr({schema:s}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(this.valueBeforeDecode.byteLength===0)return new E({value:[new Je({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=Re(this.valueBeforeDecode);if(L.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof E))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof fe){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,s]of this.typesAndValues.entries())if(s.isEqual(e.typesAndValues[t])===!1)return!1;return!0}return e instanceof ArrayBuffer?Gu(this.valueBeforeDecode,e):!1}}fe.CLASS_NAME="RelativeDistinguishedNames";const Wo="type",Go="value";function Ub(r={},e=!1){const t=d(r,"names",{});return new E({optional:e,value:[new O({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:t.country_name||A,value:[new Ne({value:[new jc,new Os]})]}),new O({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:t.administration_domain_name||A,value:[new Ne({value:[new jc,new Os]})]}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:t.network_address||A,isHexOnly:!0}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:t.terminal_identifier||A,isHexOnly:!0}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:t.private_domain_name||A,value:[new Ne({value:[new jc,new Os]})]}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:t.organization_name||A,isHexOnly:!0}),new _({optional:!0,name:t.numeric_user_identifier||A,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new O({optional:!0,name:t.personal_name||A,idBlock:{tagClass:3,tagNumber:5},value:[new _({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new O({optional:!0,name:t.organizational_unit_names||A,idBlock:{tagClass:3,tagNumber:6},value:[new ee({value:new Os})]})]})}function Kb(r=!1){return new E({optional:r,value:[new Os,new Os]})}function Hb(r=!1){return new Je({optional:r,value:[new _({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Y]})]})}class ue extends j{constructor(e={}){super(),this.type=d(e,Wo,ue.defaultValues(Wo)),this.value=d(e,Go,ue.defaultValues(Go)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wo:return 9;case Go:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wo:return t===ue.defaultValues(e);case Go:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Ne({value:[new O({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||A,value:[new W,new O({idBlock:{tagClass:3,tagNumber:0},value:[new Y]})]}),new _({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:1}}),new _({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:2}}),new O({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||A,value:[Ub(t.builtInStandardAttributes||{},!1),Kb(!0),Hb(!0)]}),new O({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||A,value:[fe.schema(t.directoryName||{})]}),new O({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||A,value:[new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ne({value:[new hf,new Os,new mf,new bh,new ff]})]}),new O({idBlock:{tagClass:3,tagNumber:1},value:[new Ne({value:[new hf,new Os,new mf,new bh,new ff]})]})]}),new _({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:6}}),new _({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:7}}),new _({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){$(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=U(e,e,ue.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(L.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=t.result.blockName;break;case 1:case 2:case 6:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=22;const a=s.toBER(!1),n=Re(a);L.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value}break;case 3:this.value=t.result.blockName;break;case 4:this.value=new fe({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new H({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const s=t.result.blockName;s.idBlock.tagClass=1,s.idBlock.tagNumber=6;const a=s.toBER(!1),n=Re(a);L.assert(n,"GeneralName registeredID"),this.value=n.result.valueBlock.toString()}break}}toSchema(){switch(this.type){case 0:case 3:case 5:return new O({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new og({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new O({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new W({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return ue.schema()}}toJSON(){const e={type:this.type,value:A};if(typeof this.value=="string")e.value=this.value;else try{e.value=this.value.toJSON()}catch(t){}return e}}ue.CLASS_NAME="GeneralName";const zo="accessMethod",Xo="accessLocation",Mb=[zo,Xo];class bn extends j{constructor(e={}){super(),this.accessMethod=d(e,zo,bn.defaultValues(zo)),this.accessLocation=d(e,Xo,bn.defaultValues(Xo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zo:return A;case Xo:return new ue;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.accessMethod||A}),ue.schema(t.accessLocation||{})]})}fromSchema(e){$(e,Mb);const t=U(e,e,bn.schema({names:{accessMethod:zo,accessLocation:{names:{blockName:Xo}}}}));L.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new ue({schema:t.result.accessLocation})}toSchema(){return new E({value:[new W({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}bn.CLASS_NAME="AccessDescription";const tr="seconds",sr="millis",rr="micros";class Pt extends j{constructor(e={}){super(),tr in e&&(this.seconds=d(e,tr,Pt.defaultValues(tr))),sr in e&&(this.millis=d(e,sr,Pt.defaultValues(sr))),rr in e&&(this.micros=d(e,rr,Pt.defaultValues(rr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tr:case sr:case rr:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case tr:case sr:case rr:return t===Pt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,optional:!0,value:[new R({optional:!0,name:t.seconds||A}),new _({name:t.millis||A,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new _({name:t.micros||A,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){$(e,[tr,sr,rr]);const t=U(e,e,Pt.schema({names:{seconds:tr,millis:sr,micros:rr}}));if(L.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const s=new R({valueHex:t.result.millis.valueBlock.valueHex});this.millis=s.valueBlock.valueDec}if("micros"in t.result){const s=new R({valueHex:t.result.micros.valueBlock.valueHex});this.micros=s.valueBlock.valueDec}}toSchema(){const e=[];if(this.seconds!==void 0&&e.push(new R({value:this.seconds})),this.millis!==void 0){const t=new R({value:this.millis});e.push(new _({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(this.micros!==void 0){const t=new R({value:this.micros});e.push(new _({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new E({value:e})}toJSON(){const e={};return this.seconds!==void 0&&(e.seconds=this.seconds),this.millis!==void 0&&(e.millis=this.millis),this.micros!==void 0&&(e.micros=this.micros),e}}Pt.CLASS_NAME="Accuracy";const mc="algorithmId",Do="algorithmParams",Xg="algorithm",Af="params",Jb=[Xg,Af];class T extends j{constructor(e={}){super(),this.algorithmId=d(e,mc,T.defaultValues(mc)),Do in e&&(this.algorithmParams=d(e,Do,T.defaultValues(Do))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mc:return A;case Do:return new Y;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mc:return t===A;case Do:return t instanceof Y;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,optional:t.optional||!1,value:[new W({name:t.algorithmIdentifier||A}),new Y({name:t.algorithmParams||A,optional:!0})]})}fromSchema(e){$(e,Jb);const t=U(e,e,T.schema({names:{algorithmIdentifier:Xg,algorithmParams:Af}}));L.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),Af in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new W({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof Y)&&e.push(this.algorithmParams),new E({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof Y)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return!(e instanceof T)||this.algorithmId!==e.algorithmId?!1:this.algorithmParams?e.algorithmParams?JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!1:!e.algorithmParams}}T.CLASS_NAME="AlgorithmIdentifier";const Mn="altNames",Fb=[Mn];class So extends j{constructor(e={}){super(),this.altNames=d(e,Mn,So.defaultValues(Mn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mn:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.altNames||A,value:ue.schema()})]})}fromSchema(e){$(e,Fb);const t=U(e,e,So.schema({names:{altNames:Mn}}));L.assertSchema(t,this.className),Mn in t.result&&(this.altNames=Array.from(t.result.altNames,s=>new ue({schema:s})))}toSchema(){return new E({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}So.CLASS_NAME="AltName";const Jn="type",Fn="values",qb=[Jn,Fn];class we extends j{constructor(e={}){super(),this.type=d(e,Jn,we.defaultValues(Jn)),this.values=d(e,Fn,we.defaultValues(Fn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jn:return A;case Fn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Jn:return t===A;case Fn:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.type||A}),new Je({name:t.setName||A,value:[new ee({name:t.values||A,value:new Y})]})]})}fromSchema(e){$(e,qb);const t=U(e,e,we.schema({names:{type:Jn,values:Fn}}));L.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new E({value:[new W({value:this.type}),new Je({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}we.CLASS_NAME="Attribute";const _o="notBeforeTime",Yo="notAfterTime",Wb=[_o,Yo];class ss extends j{constructor(e={}){super(),this.notBeforeTime=d(e,_o,ss.defaultValues(_o)),this.notAfterTime=d(e,Yo,ss.defaultValues(Yo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _o:case Yo:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ke({name:t.notBeforeTime||A}),new ke({name:t.notAfterTime||A})]})}fromSchema(e){$(e,Wb);const t=U(e,e,ss.schema({names:{notBeforeTime:_o,notAfterTime:Yo}}));L.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new E({value:[new ke({valueDate:this.notBeforeTime}),new ke({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}ss.CLASS_NAME="AttCertValidityPeriod";const To="names",Cd="generalNames";class Fe extends j{constructor(e={}){super(),this.names=d(e,To,Fe.defaultValues(To)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"names":return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,To,{});return new E({optional:t,name:s.blockName||A,value:[new ee({name:s.generalNames||A,value:ue.schema()})]})}fromSchema(e){$(e,[To,Cd]);const t=U(e,e,Fe.schema({names:{blockName:To,generalNames:Cd}}));L.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,s=>new ue({schema:s}))}toSchema(){return new E({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}Fe.CLASS_NAME="GeneralNames";const Gb="2.5.29.9",zb="2.5.29.14",Xb="2.5.29.15",_b="2.5.29.16",_g="2.5.29.17",Yg="2.5.29.18",ip="2.5.29.19",Yb="2.5.29.20",Qb="2.5.29.27",Zb="2.5.29.21",e0="2.5.29.24",Qg="2.5.29.28",Zg="2.5.29.29",ew="2.5.29.30",tw="2.5.29.31",op="2.5.29.46",sw="2.5.29.32",jt="2.5.29.32.0",t0="1.3.6.1.4.1.311.21.10",rw="2.5.29.33",lp="2.5.29.35",aw="2.5.29.36",s0="2.5.29.37",r0="2.5.29.54",up="1.3.6.1.5.5.7.1.1",a0="1.3.6.1.5.5.7.1.11",n0="1.3.6.1.4.1.11129.2.4.2",i0="1.3.6.1.4.1.311.21.7",o0="1.3.6.1.4.1.311.21.1",l0="1.3.6.1.5.5.7.1.3",cp="1.2.840.113549.1.7.1",nw="1.2.840.113549.1.7.2",iw="1.2.840.113549.1.7.3",ow="1.2.840.113549.1.7.6",u0="1.2.840.113549.1.9.16.1.4",Ed="1.2.840.113549.1.9.22.1",c0="1.2.840.113549.1.9.22.2",xd="1.2.840.113549.1.9.22.3",Id="1.2.840.113549.1.9.23.1",h0="1.3.6.1.5.5.7",m0="".concat(h0,".48"),Hc="".concat(m0,".1.1"),ma="keyIdentifier",fa="authorityCertIssuer",pa="authorityCertSerialNumber",f0=[ma,fa,pa];class zr extends j{constructor(e={}){super(),ma in e&&(this.keyIdentifier=d(e,ma,zr.defaultValues(ma))),fa in e&&(this.authorityCertIssuer=d(e,fa,zr.defaultValues(fa))),pa in e&&(this.authorityCertSerialNumber=d(e,pa,zr.defaultValues(pa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ma:return new H;case fa:return[];case pa:return new R;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new _({name:t.keyIdentifier||A,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ee({name:t.authorityCertIssuer||A,value:ue.schema()})]}),new _({name:t.authorityCertSerialNumber||A,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){$(e,f0);const t=U(e,e,zr.schema({names:{keyIdentifier:ma,authorityCertIssuer:fa,authorityCertSerialNumber:pa}}));L.assertSchema(t,this.className),ma in t.result&&(this.keyIdentifier=new H({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),fa in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,s=>new ue({schema:s}))),pa in t.result&&(this.authorityCertSerialNumber=new R({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new _({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new O({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new _({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new E({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}zr.CLASS_NAME="AuthorityKeyIdentifier";const la="pathLenConstraint",ua="cA";class An extends j{constructor(e={}){super(),this.cA=d(e,ua,!1),la in e&&(this.pathLenConstraint=d(e,la,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ua:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new aa({optional:!0,name:t.cA||A}),new R({optional:!0,name:t.pathLenConstraint||A})]})}fromSchema(e){$(e,[ua,la]);const t=U(e,e,An.schema({names:{cA:ua,pathLenConstraint:la}}));L.assertSchema(t,this.className),ua in t.result&&(this.cA=t.result.cA.valueBlock.value),la in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==An.defaultValues(ua)&&e.push(new aa({value:this.cA})),la in this&&(this.pathLenConstraint instanceof R?e.push(this.pathLenConstraint):e.push(new R({value:this.pathLenConstraint}))),new E({value:e})}toJSON(){const e={};return this.cA!==An.defaultValues(ua)&&(e.cA=this.cA),la in this&&(this.pathLenConstraint instanceof R?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}An.CLASS_NAME="BasicConstraints";const Bm="certificateIndex",Pm="keyIndex";class _u extends j{constructor(e={}){super(),this.certificateIndex=d(e,Bm,_u.defaultValues(Bm)),this.keyIndex=d(e,Pm,_u.defaultValues(Pm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bm:case Pm:return 0;default:return super.defaultValues(e)}}static schema(){return new R}fromSchema(e){if(e.constructor.blockName()!==R.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const s=new Uint8Array(t);switch(!0){case t.byteLength<4:{const m=new ArrayBuffer(4);new Uint8Array(m).set(s,4-t.byteLength),t=m.slice(0)}break;case t.byteLength>4:{const m=new ArrayBuffer(4);new Uint8Array(m).set(s.slice(0,4)),t=m.slice(0)}break}const a=t.slice(0,2),n=new Uint8Array(a);let u=n[0];n[0]=n[1],n[1]=u;const o=new Uint16Array(a);this.keyIndex=o[0];const l=t.slice(2),i=new Uint8Array(l);u=i[0],i[0]=i[1],i[1]=u;const c=new Uint16Array(l);this.certificateIndex=c[0]}toSchema(){const e=new ArrayBuffer(2),t=new Uint16Array(e);t[0]=this.certificateIndex;const s=new Uint8Array(e);let a=s[0];s[0]=s[1],s[1]=a;const n=new ArrayBuffer(2),u=new Uint16Array(n);u[0]=this.keyIndex;const o=new Uint8Array(n);return a=o[0],o[0]=o[1],o[1]=a,new R({valueHex:mo(n,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}_u.CLASS_NAME="CAVersion";const Qo="policyQualifierId",Zo="qualifier",p0=[Qo,Zo];class Sn extends j{constructor(e={}){super(),this.policyQualifierId=d(e,Qo,Sn.defaultValues(Qo)),this.qualifier=d(e,Zo,Sn.defaultValues(Zo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qo:return A;case Zo:return new Y;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.policyQualifierId||A}),new Y({name:t.qualifier||A})]})}fromSchema(e){$(e,p0);const t=U(e,e,Sn.schema({names:{policyQualifierId:Qo,qualifier:Zo}}));L.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new E({value:[new W({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}Sn.CLASS_NAME="PolicyQualifierInfo";const el="policyIdentifier",da="policyQualifiers",d0=[el,da];class Nn extends j{constructor(e={}){super(),this.policyIdentifier=d(e,el,Nn.defaultValues(el)),da in e&&(this.policyQualifiers=d(e,da,Nn.defaultValues(da))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case el:return A;case da:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.policyIdentifier||A}),new E({optional:!0,value:[new ee({name:t.policyQualifiers||A,value:Sn.schema()})]})]})}fromSchema(e){$(e,d0);const t=U(e,e,Nn.schema({names:{policyIdentifier:el,policyQualifiers:da}}));L.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),da in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,s=>new Sn({schema:s})))}toSchema(){const e=[];return e.push(new W({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new E({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}Nn.CLASS_NAME="PolicyInformation";const tl="certificatePolicies",g0=[tl];class No extends j{constructor(e={}){super(),this.certificatePolicies=d(e,tl,No.defaultValues(tl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.certificatePolicies||A,value:Nn.schema()})]})}fromSchema(e){$(e,g0);const t=U(e,e,No.schema({names:{certificatePolicies:tl}}));L.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,s=>new Nn({schema:s}))}toSchema(){return new E({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}No.CLASS_NAME="CertificatePolicies";const sl="templateID",ws="templateMajorVersion",ys="templateMinorVersion",w0=[sl,ws,ys];class co extends j{constructor(e={}){super(),this.templateID=d(e,sl,co.defaultValues(sl)),ws in e&&(this.templateMajorVersion=d(e,ws,co.defaultValues(ws))),ys in e&&(this.templateMinorVersion=d(e,ys,co.defaultValues(ys))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sl:return A;case ws:case ys:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.templateID||A}),new R({name:t.templateMajorVersion||A,optional:!0}),new R({name:t.templateMinorVersion||A,optional:!0})]})}fromSchema(e){$(e,w0);const t=U(e,e,co.schema({names:{templateID:sl,templateMajorVersion:ws,templateMinorVersion:ys}}));L.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),ws in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),ys in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new W({value:this.templateID})),ws in this&&e.push(new R({value:this.templateMajorVersion})),ys in this&&e.push(new R({value:this.templateMinorVersion})),new E({value:e})}toJSON(){const e={templateID:this.templateID};return ws in this&&(e.templateMajorVersion=this.templateMajorVersion),ys in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}const ga="distributionPoint",lw="distributionPointNames",wa="reasons",ya="cRLIssuer",uw="cRLIssuerNames",y0=[ga,lw,wa,ya,uw];class Xr extends j{constructor(e={}){super(),ga in e&&(this.distributionPoint=d(e,ga,Xr.defaultValues(ga))),wa in e&&(this.reasons=d(e,wa,Xr.defaultValues(wa))),ya in e&&(this.cRLIssuer=d(e,ya,Xr.defaultValues(ya))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ga:return[];case wa:return new ae;case ya:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ne({value:[new O({name:t.distributionPoint||A,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ee({name:t.distributionPointNames||A,value:ue.schema()})]}),new O({name:t.distributionPoint||A,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:fe.schema().valueBlock.value})]})]}),new _({name:t.reasons||A,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new O({name:t.cRLIssuer||A,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new ee({name:t.cRLIssuerNames||A,value:ue.schema()})]})]})}fromSchema(e){$(e,y0);const t=U(e,e,Xr.schema({names:{distributionPoint:ga,distributionPointNames:lw,reasons:wa,cRLIssuer:ya,cRLIssuerNames:uw}}));L.assertSchema(t,this.className),ga in t.result&&(t.result.distributionPoint.idBlock.tagNumber===0&&(this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new ue({schema:s}))),t.result.distributionPoint.idBlock.tagNumber===1&&(this.distributionPoint=new fe({schema:new E({value:t.result.distributionPoint.valueBlock.value})}))),wa in t.result&&(this.reasons=new ae({valueHex:t.result.reasons.valueBlock.valueHex})),ya in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,s=>new ue({schema:s})))}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new O({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):t=new O({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new _({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new O({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}Xr.CLASS_NAME="DistributionPoint";const rl="distributionPoints",v0=[rl];class ko extends j{constructor(e={}){super(),this.distributionPoints=d(e,rl,ko.defaultValues(rl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.distributionPoints||A,value:Xr.schema()})]})}fromSchema(e){$(e,v0);const t=U(e,e,ko.schema({names:{distributionPoints:rl}}));L.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,s=>new Xr({schema:s}))}toSchema(){return new E({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}ko.CLASS_NAME="CRLDistributionPoints";const al="keyPurposes",b0=[al];class Yu extends j{constructor(e={}){super(),this.keyPurposes=d(e,al,Yu.defaultValues(al)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case al:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.keyPurposes||A,value:new W})]})}fromSchema(e){$(e,b0);const t=U(e,e,Yu.schema({names:{keyPurposes:al}}));L.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,s=>s.valueBlock.toString())}toSchema(){return new E({value:Array.from(this.keyPurposes,e=>new W({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}Yu.CLASS_NAME="ExtKeyUsage";const Ro="accessDescriptions";class Co extends j{constructor(e={}){super(),this.accessDescriptions=d(e,Ro,Co.defaultValues(Ro)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ro:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.accessDescriptions||A,value:bn.schema()})]})}fromSchema(e){$(e,[Ro]);const t=U(e,e,Co.schema({names:{accessDescriptions:Ro}}));L.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,s=>new bn({schema:s}))}toSchema(){return new E({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}Co.CLASS_NAME="InfoAccess";const va="distributionPoint",cw="distributionPointNames",ar="onlyContainsUserCerts",nr="onlyContainsCACerts",ir="onlySomeReasons",or="indirectCRL",lr="onlyContainsAttributeCerts",A0=[va,cw,ar,nr,ir,or,lr];class Qe extends j{constructor(e={}){super(),va in e&&(this.distributionPoint=d(e,va,Qe.defaultValues(va))),this.onlyContainsUserCerts=d(e,ar,Qe.defaultValues(ar)),this.onlyContainsCACerts=d(e,nr,Qe.defaultValues(nr)),ir in e&&(this.onlySomeReasons=d(e,ir,Qe.defaultValues(ir))),this.indirectCRL=d(e,or,Qe.defaultValues(or)),this.onlyContainsAttributeCerts=d(e,lr,Qe.defaultValues(lr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case va:return[];case ar:return!1;case nr:return!1;case ir:return 0;case or:return!1;case lr:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ne({value:[new O({name:t.distributionPoint||A,idBlock:{tagClass:3,tagNumber:0},value:[new ee({name:t.distributionPointNames||A,value:ue.schema()})]}),new O({name:t.distributionPoint||A,idBlock:{tagClass:3,tagNumber:1},value:fe.schema().valueBlock.value})]})]}),new _({name:t.onlyContainsUserCerts||A,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new _({name:t.onlyContainsCACerts||A,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new _({name:t.onlySomeReasons||A,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new _({name:t.indirectCRL||A,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new _({name:t.onlyContainsAttributeCerts||A,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){$(e,A0);const t=U(e,e,Qe.schema({names:{distributionPoint:va,distributionPointNames:cw,onlyContainsUserCerts:ar,onlyContainsCACerts:nr,onlySomeReasons:ir,indirectCRL:or,onlyContainsAttributeCerts:lr}}));if(L.assertSchema(t,this.className),va in t.result)switch(!0){case t.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(t.result.distributionPointNames,s=>new ue({schema:s}));break;case t.result.distributionPoint.idBlock.tagNumber===1:this.distributionPoint=new fe({schema:new E({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(ar in t.result){const s=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=s[0]!==0}if(nr in t.result){const s=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=s[0]!==0}if(ir in t.result){const s=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=s[0]}if(or in t.result){const s=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=s[0]!==0}if(lr in t.result){const s=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=s[0]!==0}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new O({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,s=>s.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==Qe.defaultValues(ar)&&e.push(new _({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==Qe.defaultValues(nr)&&e.push(new _({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),this.onlySomeReasons!==void 0){const t=new ArrayBuffer(1),s=new Uint8Array(t);s[0]=this.onlySomeReasons,e.push(new _({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==Qe.defaultValues(or)&&e.push(new _({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==Qe.defaultValues(lr)&&e.push(new _({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new E({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==Qe.defaultValues(ar)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==Qe.defaultValues(nr)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),ir in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==Qe.defaultValues(or)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==Qe.defaultValues(lr)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}Qe.CLASS_NAME="IssuingDistributionPoint";const nl="base",qn="minimum",ur="maximum",S0=[nl,qn,ur];class hs extends j{constructor(e={}){super(),this.base=d(e,nl,hs.defaultValues(nl)),this.minimum=d(e,qn,hs.defaultValues(qn)),ur in e&&(this.maximum=d(e,ur,hs.defaultValues(ur))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nl:return new ue;case qn:return 0;case ur:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[ue.schema(t.base||{}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new R({name:t.minimum||A})]}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new R({name:t.maximum||A})]})]})}fromSchema(e){$(e,S0);const t=U(e,e,hs.schema({names:{base:{names:{blockName:nl}},minimum:qn,maximum:ur}}));L.assertSchema(t,this.className),this.base=new ue({schema:t.result.base}),qn in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),ur in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),this.minimum!==0){let t=0;this.minimum instanceof R?t=this.minimum:t=new R({value:this.minimum}),e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(ur in this){let t=0;this.maximum instanceof R?t=this.maximum:t=new R({value:this.maximum}),e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new E({value:e})}toJSON(){const e={base:this.base.toJSON()};return this.minimum!==0&&(typeof this.minimum=="number"?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),this.maximum!==void 0&&(typeof this.maximum=="number"?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}hs.CLASS_NAME="GeneralSubtree";const ba="permittedSubtrees",Aa="excludedSubtrees",N0=[ba,Aa];class po extends j{constructor(e={}){super(),ba in e&&(this.permittedSubtrees=d(e,ba,po.defaultValues(ba))),Aa in e&&(this.excludedSubtrees=d(e,Aa,po.defaultValues(Aa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ba:case Aa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ee({name:t.permittedSubtrees||A,value:hs.schema()})]}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ee({name:t.excludedSubtrees||A,value:hs.schema()})]})]})}fromSchema(e){$(e,N0);const t=U(e,e,po.schema({names:{permittedSubtrees:ba,excludedSubtrees:Aa}}));L.assertSchema(t,this.className),ba in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,s=>new hs({schema:s}))),Aa in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,s=>new hs({schema:s})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new O({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}po.CLASS_NAME="NameConstraints";const vs="requireExplicitPolicy",bs="inhibitPolicyMapping",k0=[vs,bs];class go extends j{constructor(e={}){super(),vs in e&&(this.requireExplicitPolicy=d(e,vs,go.defaultValues(vs))),bs in e&&(this.inhibitPolicyMapping=d(e,bs,go.defaultValues(bs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vs:return 0;case bs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new _({name:t.requireExplicitPolicy||A,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new _({name:t.inhibitPolicyMapping||A,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){$(e,k0);const t=U(e,e,go.schema({names:{requireExplicitPolicy:vs,inhibitPolicyMapping:bs}}));if(L.assertSchema(t,this.className),vs in t.result){const s=t.result.requireExplicitPolicy;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=Re(a);L.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(bs in t.result){const s=t.result.inhibitPolicyMapping;s.idBlock.tagClass=1,s.idBlock.tagNumber=2;const a=s.toBER(!1),n=Re(a);L.assert(n,"Integer"),this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if(vs in this){const t=new R({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(bs in this){const t=new R({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new E({value:e})}toJSON(){const e={};return vs in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),bs in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}go.CLASS_NAME="PolicyConstraints";const il="issuerDomainPolicy",ol="subjectDomainPolicy",C0=[il,ol];class kn extends j{constructor(e={}){super(),this.issuerDomainPolicy=d(e,il,kn.defaultValues(il)),this.subjectDomainPolicy=d(e,ol,kn.defaultValues(ol)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case il:return A;case ol:return A;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.issuerDomainPolicy||A}),new W({name:t.subjectDomainPolicy||A})]})}fromSchema(e){$(e,C0);const t=U(e,e,kn.schema({names:{issuerDomainPolicy:il,subjectDomainPolicy:ol}}));L.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new E({value:[new W({value:this.issuerDomainPolicy}),new W({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}kn.CLASS_NAME="PolicyMapping";const ll="mappings",E0=[ll];class Qu extends j{constructor(e={}){super(),this.mappings=d(e,ll,Qu.defaultValues(ll)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ll:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.mappings||A,value:kn.schema()})]})}fromSchema(e){$(e,E0);const t=U(e,e,Qu.schema({names:{mappings:ll}}));L.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,s=>new kn({schema:s}))}toSchema(){return new E({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}Qu.CLASS_NAME="PolicyMappings";const cr="notBefore",hr="notAfter",x0=[cr,hr];class wo extends j{constructor(e={}){super(),cr in e&&(this.notBefore=d(e,cr,wo.defaultValues(cr))),hr in e&&(this.notAfter=d(e,hr,wo.defaultValues(hr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cr:return new Date;case hr:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new _({name:t.notBefore||A,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new _({name:t.notAfter||A,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){$(e,x0);const t=U(e,e,wo.schema({names:{notBefore:cr,notAfter:hr}}));if(L.assertSchema(t,this.className),cr in t.result){const s=new ke;s.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=s.toDate()}if(hr in t.result){const s=new ke({valueHex:t.result.notAfter.valueBlock.valueHex});s.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=s.toDate()}}toSchema(){const e=[];return cr in this&&e.push(new _({idBlock:{tagClass:3,tagNumber:0},valueHex:new ke({valueDate:this.notBefore}).valueBlock.valueHexView})),hr in this&&e.push(new _({idBlock:{tagClass:3,tagNumber:1},valueHex:new ke({valueDate:this.notAfter}).valueBlock.valueHexView})),new E({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}wo.CLASS_NAME="PrivateKeyUsagePeriod";const Wn="id",As="type",Gn="values",I0=[Wn,As],V0=[Gn];class Cn extends j{constructor(e={}){super(),this.id=d(e,Wn,Cn.defaultValues(Wn)),As in e&&(this.type=d(e,As,Cn.defaultValues(As))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wn:return A;case As:return new Me;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wn:return t===A;case As:return t instanceof Me;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.id||A}),new Y({name:t.type||A,optional:!0})]})}fromSchema(e){$(e,I0);const t=U(e,e,Cn.schema({names:{id:Wn,type:As}}));L.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),As in t.result&&(this.type=t.result.type)}toSchema(){const e=[new W({value:this.id})];return As in this&&e.push(this.type),new E({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}Cn.CLASS_NAME="QCStatement";class Zu extends j{constructor(e={}){super(),this.values=d(e,Gn,Zu.defaultValues(Gn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Gn:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.values||A,value:Cn.schema(t.value||{})})]})}fromSchema(e){$(e,V0);const t=U(e,e,Zu.schema({names:{values:Gn}}));L.assertSchema(t,this.className),this.values=Array.from(t.result.values,s=>new Cn({schema:s}))}toSchema(){return new E({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}Zu.CLASS_NAME="QCStatements";var ca;class ea{static register(e,t,s){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:s}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}ca=ea,ea.namedCurves={},ca.register("P-256","1.2.840.10045.3.1.7",32),ca.register("P-384","1.3.132.0.34",48),ca.register("P-521","1.3.132.0.35",66),ca.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),ca.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),ca.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const fc="x",pc="y",dc="namedCurve";class bt extends j{constructor(e={}){super(),this.x=d(e,fc,bt.defaultValues(fc)),this.y=d(e,pc,bt.defaultValues(pc)),this.namedCurve=d(e,dc,bt.defaultValues(dc)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fc:case pc:return Le;case dc:return A;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fc:case pc:return t instanceof ArrayBuffer&&Gu(t,bt.defaultValues(e));case dc:return typeof t=="string"&&t===bt.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new vh}fromSchema(e){const t=ge.toUint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");const s=ea.find(this.namedCurve);if(!s)throw new Error("Incorrect curve OID: ".concat(this.namedCurve));const a=s.size;if(t.byteLength!==a*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=s.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,a*2+1).buffer}toSchema(){return new vh({data:mo(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=ea.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:uf(yh(this.x),!0,!0,!1),y:uf(yh(this.y),!0,!0,!1)}}fromJSON(e){ie.assert("json",e,"crv","x","y");let t=0;const s=ea.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=Ao(Wu(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const u=new Uint8Array(this.x),o=new Uint8Array(a);u.set(o,1)}else this.x=a.slice(0,t);const n=Ao(Wu(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const u=new Uint8Array(this.y),o=new Uint8Array(n);u.set(o,1)}else this.y=n.slice(0,t)}}bt.CLASS_NAME="ECPublicKey";const ul="modulus",cl="publicExponent",B0=[ul,cl];class En extends j{constructor(e={}){super(),this.modulus=d(e,ul,En.defaultValues(ul)),this.publicExponent=d(e,cl,En.defaultValues(cl)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ul:return new R;case cl:return new R;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.modulus||A}),new R({name:t.publicExponent||A})]})}fromSchema(e){$(e,B0);const t=U(e,e,En.schema({names:{modulus:ul,publicExponent:cl}}));L.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new E({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:he.ToBase64Url(this.modulus.valueBlock.valueHexView),e:he.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){ie.assert("json",e,"n","e");const t=Ao(Wu(e.n,!0));this.modulus=new R({valueHex:t.slice(0,Math.pow(2,Tw(t.byteLength)))}),this.publicExponent=new R({valueHex:Ao(Wu(e.e,!0)).slice(0,3)})}}En.CLASS_NAME="RSAPublicKey";const hl="algorithm",ml="subjectPublicKey",P0=[hl,ml];class Nt extends j{get parsedKey(){if(this._parsedKey===void 0){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===W.blockName())try{this._parsedKey=new bt({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":{const e=Re(this.subjectPublicKey.valueBlock.valueHexView);if(e.offset!==-1)try{this._parsedKey=new En({schema:e.result})}catch(t){}}break}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=d(e,hl,Nt.defaultValues(hl)),this.subjectPublicKey=d(e,ml,Nt.defaultValues(ml));const t=d(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hl:return new T;case ml:return new ae;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[T.schema(t.algorithm||{}),new ae({name:t.subjectPublicKey||A})]})}fromSchema(e){$(e,P0);const t=U(e,e,Nt.schema({names:{algorithm:{names:{blockName:hl}},subjectPublicKey:ml}}));L.assertSchema(t,this.className),this.algorithm=new T({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new E({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new bt({json:e}),this.algorithm=new T({algorithmId:"1.2.840.10045.2.1",algorithmParams:new W({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new En({json:e}),this.algorithm=new T({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Me});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.subjectPublicKey=new ae({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=te(!0)){try{if(!e)throw new Error("Need to provide publicKey input parameter");const s=await t.exportKey("spki",e),a=Re(s);try{this.fromSchema(a.result)}catch(n){throw new Error("Error during initializing object from schema")}}catch(s){const a=s instanceof Error?s.message:"".concat(s);throw new Error("Error during exporting public key: ".concat(a))}}}Nt.CLASS_NAME="PublicKeyInfo";const zn="version",Xn="privateKey",zt="namedCurve",mr="publicKey",O0=[zn,Xn,zt,mr];class Ut extends j{constructor(e={}){super(),this.version=d(e,zn,Ut.defaultValues(zn)),this.privateKey=d(e,Xn,Ut.defaultValues(Xn)),zt in e&&(this.namedCurve=d(e,zt,Ut.defaultValues(zt))),mr in e&&(this.publicKey=d(e,mr,Ut.defaultValues(mr))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zn:return 1;case Xn:return new H;case zt:return A;case mr:return new bt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zn:return t===Ut.defaultValues(e);case Xn:return t.isEqual(Ut.defaultValues(e));case zt:return t===A;case mr:return bt.compareWithDefault(zt,t.namedCurve)&&bt.compareWithDefault("x",t.x)&&bt.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),new H({name:t.privateKey||A}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new W({name:t.namedCurve||A})]}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ae({name:t.publicKey||A})]})]})}fromSchema(e){$(e,O0);const t=U(e,e,Ut.schema({names:{version:zn,privateKey:Xn,namedCurve:zt,publicKey:mr}}));if(L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,zt in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),mr in t.result){const s={schema:t.result.publicKey.valueBlock.valueHex};zt in this&&(s.namedCurve=this.namedCurve),this.publicKey=new bt(s)}}toSchema(){const e=[new R({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[new W({value:this.namedCurve})]})),this.publicKey&&e.push(new O({idBlock:{tagClass:3,tagNumber:1},value:[new ae({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new E({value:e})}toJSON(){if(!this.namedCurve||Ut.compareWithDefault(zt,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=ea.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:he.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const s=this.publicKey.toJSON();t.x=s.x,t.y=s.y}return t}fromJSON(e){ie.assert("json",e,"crv","d");let t=0;const s=ea.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);const a=he.FromBase64Url(e.d);if(a.byteLength<t){const n=new ArrayBuffer(t),u=new Uint8Array(n),o=new Uint8Array(a);u.set(o,1),this.privateKey=new H({valueHex:n})}else this.privateKey=new H({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new bt({json:e}))}}Ut.CLASS_NAME="ECPrivateKey";const fl="prime",pl="exponent",dl="coefficient",D0=[fl,pl,dl];class Ds extends j{constructor(e={}){super(),this.prime=d(e,fl,Ds.defaultValues(fl)),this.exponent=d(e,pl,Ds.defaultValues(pl)),this.coefficient=d(e,dl,Ds.defaultValues(dl)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fl:return new R;case pl:return new R;case dl:return new R;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.prime||A}),new R({name:t.exponent||A}),new R({name:t.coefficient||A})]})}fromSchema(e){$(e,D0);const t=U(e,e,Ds.schema({names:{prime:fl,exponent:pl,coefficient:dl}}));L.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new E({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:he.ToBase64Url(this.prime.valueBlock.valueHexView),d:he.ToBase64Url(this.exponent.valueBlock.valueHexView),t:he.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){ie.assert("json",e,"r","d","r"),this.prime=new R({valueHex:he.FromBase64Url(e.r)}),this.exponent=new R({valueHex:he.FromBase64Url(e.d)}),this.coefficient=new R({valueHex:he.FromBase64Url(e.t)})}}Ds.CLASS_NAME="OtherPrimeInfo";const gl="version",wl="modulus",yl="publicExponent",vl="privateExponent",bl="prime1",Al="prime2",Sl="exponent1",Nl="exponent2",kl="coefficient",Sa="otherPrimeInfos",T0=[gl,wl,yl,vl,bl,Al,Sl,Nl,kl,Sa];class pt extends j{constructor(e={}){super(),this.version=d(e,gl,pt.defaultValues(gl)),this.modulus=d(e,wl,pt.defaultValues(wl)),this.publicExponent=d(e,yl,pt.defaultValues(yl)),this.privateExponent=d(e,vl,pt.defaultValues(vl)),this.prime1=d(e,bl,pt.defaultValues(bl)),this.prime2=d(e,Al,pt.defaultValues(Al)),this.exponent1=d(e,Sl,pt.defaultValues(Sl)),this.exponent2=d(e,Nl,pt.defaultValues(Nl)),this.coefficient=d(e,kl,pt.defaultValues(kl)),Sa in e&&(this.otherPrimeInfos=d(e,Sa,pt.defaultValues(Sa))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gl:return 0;case wl:return new R;case yl:return new R;case vl:return new R;case bl:return new R;case Al:return new R;case Sl:return new R;case Nl:return new R;case kl:return new R;case Sa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),new R({name:t.modulus||A}),new R({name:t.publicExponent||A}),new R({name:t.privateExponent||A}),new R({name:t.prime1||A}),new R({name:t.prime2||A}),new R({name:t.exponent1||A}),new R({name:t.exponent2||A}),new R({name:t.coefficient||A}),new E({optional:!0,value:[new ee({name:t.otherPrimeInfosName||A,value:Ds.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){$(e,T0);const t=U(e,e,pt.schema({names:{version:gl,modulus:wl,publicExponent:yl,privateExponent:vl,prime1:bl,prime2:Al,exponent1:Sl,exponent2:Nl,coefficient:kl,otherPrimeInfo:{names:{blockName:Sa}}}}));L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),Sa in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,s=>new Ds({schema:s})))}toSchema(){const e=[];return e.push(new R({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new E({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={n:he.ToBase64Url(this.modulus.valueBlock.valueHexView),e:he.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:he.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:he.ToBase64Url(this.prime1.valueBlock.valueHexView),q:he.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:he.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:he.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:he.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){ie.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new R({valueHex:he.FromBase64Url(e.n)}),this.publicExponent=new R({valueHex:he.FromBase64Url(e.e)}),this.privateExponent=new R({valueHex:he.FromBase64Url(e.d)}),this.prime1=new R({valueHex:he.FromBase64Url(e.p)}),this.prime2=new R({valueHex:he.FromBase64Url(e.q)}),this.exponent1=new R({valueHex:he.FromBase64Url(e.dp)}),this.exponent2=new R({valueHex:he.FromBase64Url(e.dq)}),this.coefficient=new R({valueHex:he.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new Ds({json:t})))}}pt.CLASS_NAME="RSAPrivateKey";const Cl="version",El="privateKeyAlgorithm",xl="privateKey",Na="attributes",gc="parsedKey",R0=[Cl,El,xl,Na];class Ht extends j{constructor(e={}){super(),this.version=d(e,Cl,Ht.defaultValues(Cl)),this.privateKeyAlgorithm=d(e,El,Ht.defaultValues(El)),this.privateKey=d(e,xl,Ht.defaultValues(xl)),Na in e&&(this.attributes=d(e,Na,Ht.defaultValues(Na))),gc in e&&(this.parsedKey=d(e,gc,Ht.defaultValues(gc))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cl:return 0;case El:return new T;case xl:return new H;case Na:return[];case gc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),T.schema(t.privateKeyAlgorithm||{}),new H({name:t.privateKey||A}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ee({name:t.attributes||A,value:we.schema()})]})]})}fromSchema(e){$(e,R0);const t=U(e,e,Ht.schema({names:{version:Cl,privateKeyAlgorithm:{names:{blockName:El}},privateKey:xl,attributes:Na}}));switch(L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new T({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,Na in t.result&&(this.attributes=Array.from(t.result.attributes,s=>new we({schema:s}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const s=Re(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new pt({schema:s.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof W){const s=Re(this.privateKey.valueBlock.valueHexView);s.offset!==-1&&(this.parsedKey=new Ut({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:s.result}))}break}}toSchema(){const e=[new R({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new E({value:e})}toJSON(){if(!this.parsedKey){const s={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(s.attributes=Array.from(this.attributes,a=>a.toJSON())),s}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Ut({json:e}),this.privateKeyAlgorithm=new T({algorithmId:"1.2.840.10045.2.1",algorithmParams:new W({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new pt({json:e}),this.privateKeyAlgorithm=new T({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Me});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.privateKey=new H({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}Ht.CLASS_NAME="PrivateKeyInfo";const _n="contentType",Yn="contentEncryptionAlgorithm",ka="encryptedContent",L0=[_n,Yn,ka],Vd=1024;class Pe extends j{constructor(e={}){if(super(),this.contentType=d(e,_n,Pe.defaultValues(_n)),this.contentEncryptionAlgorithm=d(e,Yn,Pe.defaultValues(Yn)),ka in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4&&this.encryptedContent.idBlock.isConstructed===!1&&!e.disableSplit)){const t=new H({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const u=new Uint8Array(a,s,s+Vd>a.byteLength?a.byteLength-s:Vd),o=new ArrayBuffer(u.length),l=new Uint8Array(o);for(let i=0;i<l.length;i++)l[i]=u[i];t.valueBlock.value.push(new H({valueHex:o})),n-=u.length,s+=u.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _n:return A;case Yn:return new T;case ka:return new H;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case _n:return t===A;case Yn:return t.algorithmId===A&&!("algorithmParams"in t);case ka:return t.isEqual(Pe.defaultValues(ka));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.contentType||A}),T.schema(t.contentEncryptionAlgorithm||{}),new Ne({value:[new O({name:t.encryptedContent||A,idBlock:{tagClass:3,tagNumber:0},value:[new ee({value:new H})]}),new _({name:t.encryptedContent||A,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){$(e,L0);const t=U(e,e,Pe.schema({names:{contentType:_n,contentEncryptionAlgorithm:{names:{blockName:Yn}},encryptedContent:ka}}));L.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new T({schema:t.result.contentEncryptionAlgorithm}),ka in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new W({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const s=this.encryptedContent;s.idBlock.tagClass=3,s.idBlock.tagNumber=0,s.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(s)}return new E({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return H.prototype.getValue.call(this.encryptedContent)}}Pe.CLASS_NAME="EncryptedContentInfo";const fr="hashAlgorithm",pr="maskGenAlgorithm",dr="saltLength",gr="trailerField",j0=[fr,pr,dr,gr];class et extends j{constructor(e={}){super(),this.hashAlgorithm=d(e,fr,et.defaultValues(fr)),this.maskGenAlgorithm=d(e,pr,et.defaultValues(pr)),this.saltLength=d(e,dr,et.defaultValues(dr)),this.trailerField=d(e,gr,et.defaultValues(gr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fr:return new T({algorithmId:"1.3.14.3.2.26",algorithmParams:new Me});case pr:return new T({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new T({algorithmId:"1.3.14.3.2.26",algorithmParams:new Me}).toSchema()});case dr:return 20;case gr:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new O({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[T.schema(t.hashAlgorithm||{})]}),new O({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[T.schema(t.maskGenAlgorithm||{})]}),new O({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new R({name:t.saltLength||A})]}),new O({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new R({name:t.trailerField||A})]})]})}fromSchema(e){$(e,j0);const t=U(e,e,et.schema({names:{hashAlgorithm:{names:{blockName:fr}},maskGenAlgorithm:{names:{blockName:pr}},saltLength:dr,trailerField:gr}}));L.assertSchema(t,this.className),fr in t.result&&(this.hashAlgorithm=new T({schema:t.result.hashAlgorithm})),pr in t.result&&(this.maskGenAlgorithm=new T({schema:t.result.maskGenAlgorithm})),dr in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),gr in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(et.defaultValues(fr))||e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(et.defaultValues(pr))||e.push(new O({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==et.defaultValues(dr)&&e.push(new O({idBlock:{tagClass:3,tagNumber:2},value:[new R({value:this.saltLength})]})),this.trailerField!==et.defaultValues(gr)&&e.push(new O({idBlock:{tagClass:3,tagNumber:3},value:[new R({value:this.trailerField})]})),new E({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(et.defaultValues(fr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(et.defaultValues(pr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==et.defaultValues(dr)&&(e.saltLength=this.saltLength),this.trailerField!==et.defaultValues(gr)&&(e.trailerField=this.trailerField),e}}et.CLASS_NAME="RSASSAPSSParams";const Qn="salt",Il="iterationCount",Xt="keyLength",Ss="prf",$0=[Qn,Il,Xt,Ss];class ht extends j{constructor(e={}){super(),this.salt=d(e,Qn,ht.defaultValues(Qn)),this.iterationCount=d(e,Il,ht.defaultValues(Il)),Xt in e&&(this.keyLength=d(e,Xt,ht.defaultValues(Xt))),Ss in e&&(this.prf=d(e,Ss,ht.defaultValues(Ss))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qn:return{};case Il:return-1;case Xt:return 0;case Ss:return new T({algorithmId:"1.3.14.3.2.26",algorithmParams:new Me});default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new Ne({value:[new H({name:t.saltPrimitive||A}),T.schema(t.saltConstructed||{})]}),new R({name:t.iterationCount||A}),new R({name:t.keyLength||A,optional:!0}),T.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){$(e,$0);const t=U(e,e,ht.schema({names:{saltPrimitive:Qn,saltConstructed:{names:{blockName:Qn}},iterationCount:Il,keyLength:Xt,prf:{names:{blockName:Ss,optional:!0}}}}));L.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,Xt in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),Ss in t.result&&(this.prf=new T({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new R({value:this.iterationCount})),Xt in this&&ht.defaultValues(Xt)!==this.keyLength&&e.push(new R({value:this.keyLength})),this.prf&&ht.defaultValues(Ss).isEqual(this.prf)===!1&&e.push(this.prf.toSchema()),new E({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return Xt in this&&ht.defaultValues(Xt)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&ht.defaultValues(Ss).isEqual(this.prf)===!1&&(e.prf=this.prf.toJSON()),e}}ht.CLASS_NAME="PBKDF2Params";const Vl="keyDerivationFunc",Bl="encryptionScheme",U0=[Vl,Bl];class xn extends j{constructor(e={}){super(),this.keyDerivationFunc=d(e,Vl,xn.defaultValues(Vl)),this.encryptionScheme=d(e,Bl,xn.defaultValues(Bl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vl:return new T;case Bl:return new T;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[T.schema(t.keyDerivationFunc||{}),T.schema(t.encryptionScheme||{})]})}fromSchema(e){$(e,U0);const t=U(e,e,xn.schema({names:{keyDerivationFunc:{names:{blockName:Vl}},encryptionScheme:{names:{blockName:Bl}}}}));L.assertSchema(t,this.className),this.keyDerivationFunc=new T({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new T({schema:t.result.encryptionScheme})}toSchema(){return new E({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}xn.CLASS_NAME="PBES2Params";class K0{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=d(e,"name",A)}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){return this.crypto.getRandomValues(e)}}async function Bd(r,e,t,s,a){let n,u,o;switch(r.toUpperCase()){case"SHA-1":n=20,u=64,o=ub;break;case"SHA-256":n=32,u=64,o=mb;break;case"SHA-384":n=48,u=128,o=$b;break;case"SHA-512":n=64,u=128,o=jb;break;default:throw new Error("Unsupported hashing algorithm")}const l=new Uint8Array(t);let i=new TextDecoder().decode(t);new TextEncoder().encode(i).some((v,k)=>v!==l[k])&&(i=String.fromCharCode(...l));const c=new Uint8Array(i.length*2+2),m=new DataView(c.buffer);for(let v=0;v<i.length;v++)m.setUint16(v*2,i.charCodeAt(v),!1);m.setUint16(i.length*2,0,!1);const h=new Uint8Array(u).fill(3),g=new Uint8Array(s),p=new Uint8Array(u*Math.ceil(g.length/u)).map((v,k)=>g[k%g.length]),y=new Uint8Array(u*Math.ceil(c.length/u)).map((v,k)=>c[k%c.length]);let w=new Uint8Array(p.length+y.length);w.set(p),w.set(y,p.length);const b=Math.ceil((e>>3)/n),f=[];for(let v=0;v<b;v++){let k=new Uint8Array(h.length+w.length);k.set(h),k.set(w,h.length);for(let C=0;C<a;C++)k=o(k);const N=new Uint8Array(u).map((C,I)=>k[I%k.length]),S=Math.ceil(g.length/u)+Math.ceil(c.length/u),x=[];for(let C=0;C<S;C++){const I=Array.from(w.slice(C*u,(C+1)*u));let P=511;for(let B=N.length-1;B>=0;B--)P>>=8,P+=N[B]+(I[B]||0),I[B]=P&255;x.push(...I)}w=new Uint8Array(x),f.push(...k)}return new Uint8Array(f.slice(0,e>>3)).buffer}function hw(r){const e=typeof r=="string"?{name:r}:r;return"hash"in e?ns(nt({},e),{hash:hw(e.hash)}):e}class ec extends K0{async importKey(e,t,s,a,n){var u,o,l,i,c,m;let h={};const g=hw(s);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,s,a,n);case"spki":{const p=Re(ge.toArrayBuffer(t));L.assert(p,"keyData");const y=new Nt;try{y.fromSchema(p.result)}catch(w){throw new me("Incorrect keyData")}switch(g.name.toUpperCase()){case"RSA-PSS":{if(!g.hash)throw new ie("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(g.hash.name.toUpperCase()){case"SHA-1":h.alg="PS1";break;case"SHA-256":h.alg="PS256";break;case"SHA-384":h.alg="PS384";break;case"SHA-512":h.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(g.hash.name.toUpperCase()))}}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],h.kty="RSA",h.ext=a,h.key_ops=n,y.algorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect public key algorithm: ".concat(y.algorithm.algorithmId));if(!h.alg){if(!g.hash)throw new ie("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(g.hash.name.toUpperCase()){case"SHA-1":h.alg="RS1";break;case"SHA-256":h.alg="RS256";break;case"SHA-384":h.alg="RS384";break;case"SHA-512":h.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(g.hash.name.toUpperCase()))}}const w=y.toJSON();Object.assign(h,w)}break;case"ECDSA":n=["verify"];case"ECDH":{if(h={kty:"EC",ext:a,key_ops:n},y.algorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect public key algorithm: ".concat(y.algorithm.algorithmId));const w=y.toJSON();Object.assign(h,w)}break;case"RSA-OAEP":{if(h.kty="RSA",h.ext=a,h.key_ops=n,this.name.toLowerCase()==="safari")h.alg="RSA-OAEP";else{if(!g.hash)throw new ie("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(g.hash.name.toUpperCase()){case"SHA-1":h.alg="RSA-OAEP";break;case"SHA-256":h.alg="RSA-OAEP-256";break;case"SHA-384":h.alg="RSA-OAEP-384";break;case"SHA-512":h.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat(g.hash.name.toUpperCase()))}}const w=y.toJSON();Object.assign(h,w)}break;case"RSAES-PKCS1-V1_5":{h.kty="RSA",h.ext=a,h.key_ops=n,h.alg="PS1";const w=y.toJSON();Object.assign(h,w)}break;default:throw new Error("Incorrect algorithm name: ".concat(g.name.toUpperCase()))}}break;case"pkcs8":{const p=new Ht,y=Re(ge.toArrayBuffer(t));L.assert(y,"keyData");try{p.fromSchema(y.result)}catch(w){throw new Error("Incorrect keyData")}if(!p.parsedKey)throw new Error("Incorrect keyData");switch(g.name.toUpperCase()){case"RSA-PSS":switch((u=g.hash)===null||u===void 0?void 0:u.name.toUpperCase()){case"SHA-1":h.alg="PS1";break;case"SHA-256":h.alg="PS256";break;case"SHA-384":h.alg="PS384";break;case"SHA-512":h.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((o=g.hash)===null||o===void 0?void 0:o.name.toUpperCase()))}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],h.kty="RSA",h.ext=a,h.key_ops=n,p.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect private key algorithm: ".concat(p.privateKeyAlgorithm.algorithmId));if(!("alg"in h))switch((l=g.hash)===null||l===void 0?void 0:l.name.toUpperCase()){case"SHA-1":h.alg="RS1";break;case"SHA-256":h.alg="RS256";break;case"SHA-384":h.alg="RS384";break;case"SHA-512":h.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((i=g.hash)===null||i===void 0?void 0:i.name.toUpperCase()))}const w=p.toJSON();Object.assign(h,w)}break;case"ECDSA":n=["sign"];case"ECDH":{if(h={kty:"EC",ext:a,key_ops:n},p.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect algorithm: ".concat(p.privateKeyAlgorithm.algorithmId));const w=p.toJSON();Object.assign(h,w)}break;case"RSA-OAEP":{if(h.kty="RSA",h.ext=a,h.key_ops=n,this.name.toLowerCase()==="safari")h.alg="RSA-OAEP";else switch((c=g.hash)===null||c===void 0?void 0:c.name.toUpperCase()){case"SHA-1":h.alg="RSA-OAEP";break;case"SHA-256":h.alg="RSA-OAEP-256";break;case"SHA-384":h.alg="RSA-OAEP-384";break;case"SHA-512":h.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat((m=g.hash)===null||m===void 0?void 0:m.name.toUpperCase()))}const w=p.toJSON();Object.assign(h,w)}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],h.kty="RSA",h.ext=a,h.key_ops=n,h.alg="PS1";const w=p.toJSON();Object.assign(h,w)}break;default:throw new Error("Incorrect algorithm name: ".concat(g.name.toUpperCase()))}}break;case"jwk":h=t;break;default:throw new Error("Incorrect format: ".concat(e))}if(this.name.toLowerCase()==="safari")try{return this.subtle.importKey("jwk",Ao(JSON.stringify(h)),s,a,n)}catch(p){return this.subtle.importKey("jwk",h,s,a,n)}return this.subtle.importKey("jwk",h,s,a,n)}async exportKey(e,t){let s=await this.subtle.exportKey("jwk",t);switch(this.name.toLowerCase()==="safari"&&s instanceof ArrayBuffer&&(s=JSON.parse(yh(s))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{const a=new Nt;try{a.fromJSON(s)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new Ht;try{a.fromJSON(s)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return s;default:throw new Error("Incorrect format: ".concat(e))}}async convert(e,t,s,a,n,u){if(e.toLowerCase()===t.toLowerCase())return s;const o=await this.importKey(e,s,a,n,u);return this.exportKey(t,o)}getAlgorithmByOID(e,t=!1,s){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error("Unsupported algorithm identifier ".concat(s?"for ".concat(s," "):A,": ").concat(e));return{}}getOIDByAlgorithm(e,t=!1,s){let a=A;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11";break}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35";break}if(!a&&t)throw new Error("Unsupported algorithm ".concat(s?"for ".concat(s," "):A,": ").concat(e.name));return a}getAlgorithmParameters(e,t){let s={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":s={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":s={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":s={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":s={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":s={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":s={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":s={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":s={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":s={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return s}getHashAlgorithm(e){let t=A;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const s=new et({schema:e.algorithmParams});if(s.hashAlgorithm){const a=this.getAlgorithmByOID(s.hashAlgorithm.algorithmId);if("name"in a)t=a.name;else return A}else t="SHA-1"}catch(s){}break}return t}async encryptEncryptedContentInfo(e){ie.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),s=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),n=new ArrayBuffer(16),u=new Uint8Array(n);this.getRandomValues(u);const o=new ArrayBuffer(64),l=new Uint8Array(o);this.getRandomValues(l);const i=new Uint8Array(e.contentToEncrypt),c=new ht({salt:new H({valueHex:o}),iterationCount:e.iterationCount,prf:new T({algorithmId:a,algorithmParams:new Me})}),m=new Uint8Array(e.password),h=await this.importKey("raw",m,"PBKDF2",!1,["deriveKey"]),g=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:l,iterations:e.iterationCount},h,e.contentEncryptionAlgorithm,!1,["encrypt"]),p=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:u},g,i),y=new xn({keyDerivationFunc:new T({algorithmId:s,algorithmParams:c.toSchema()}),encryptionScheme:new T({algorithmId:t,algorithmParams:new H({valueHex:n})})});return new Pe({contentType:e.contentType,contentEncryptionAlgorithm:new T({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:y.toSchema()}),encryptedContent:new H({valueHex:p})})}async decryptEncryptedContentInfo(e){if(ie.assert(e,"password","encryptedContentInfo"),e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")throw new Error('Unknown "contentEncryptionAlgorithm": '.concat(e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId));let t;try{t=new xn({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(p){throw new Error('Incorrectly encoded "pbes2Parameters"')}let s;try{s=new ht({schema:t.keyDerivationFunc.algorithmParams})}catch(p){throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),n=t.encryptionScheme.algorithmParams.valueBlock.valueHex,u=new Uint8Array(n),o=s.salt.valueBlock.valueHex,l=new Uint8Array(o),i=s.iterationCount;let c="SHA-1";s.prf&&(c=this.getAlgorithmByOID(s.prf.algorithmId,!0).hash.name);const m=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),h=await this.deriveKey({name:"PBKDF2",hash:{name:c},salt:l,iterations:i},m,a,!1,["decrypt"]),g=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:u},h,g)}async stampDataWithPassword(e){if(!(e instanceof Object))throw new Error('Parameters must have type "Object"');ie.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp");let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Bd(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["sign"]);return this.sign(s,n,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){ie.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Bd(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),s,!1,["verify"]);return this.verify(s,n,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");const s=new T,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const n=a.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?n.hash.name=e.algorithm.hash.name:n.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":s.algorithmId=this.getOIDByAlgorithm(n,!0);break;case"RSA-PSS":{switch(n.hash.name.toUpperCase()){case"SHA-256":n.saltLength=32;break;case"SHA-384":n.saltLength=48;break;case"SHA-512":n.saltLength=64;break}const u={};if(n.hash.name.toUpperCase()!=="SHA-1"){const l=this.getOIDByAlgorithm({name:n.hash.name},!0,"hashAlgorithm");u.hashAlgorithm=new T({algorithmId:l,algorithmParams:new Me}),u.maskGenAlgorithm=new T({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:u.hashAlgorithm.toSchema()})}n.saltLength!==20&&(u.saltLength=n.saltLength);const o=new et(u);s.algorithmId="1.2.840.113549.1.1.10",s.algorithmParams=o.toSchema()}break;default:throw new Error("Unsupported signature algorithm: ".concat(e.algorithm.name))}return{signatureAlgorithm:s,parameters:a}}async signWithPrivateKey(e,t,s){const a=await this.sign(s.algorithm,t,e);return s.algorithm.name==="ECDSA"?M0(a):a}fillPublicKeyParameters(e,t){const s={},a=this.getHashAlgorithm(t);if(a===A)throw new Error("Unsupported signature algorithm: ".concat(t.algorithmId));let n;t.algorithmId==="1.2.840.113549.1.1.10"?n=t.algorithmId:n=e.algorithm.algorithmId;const u=this.getAlgorithmByOID(n,!0);if(s.algorithm=this.getAlgorithmParameters(u.name,"importKey"),"hash"in s.algorithm.algorithm&&(s.algorithm.algorithm.hash.name=a),u.name==="ECDSA"){const o=e.algorithm;if(!o.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const l=o.algorithmParams;if("idBlock"in o.algorithmParams&&!(l.idBlock.tagClass===1&&l.idBlock.tagNumber===6))throw new Error("Incorrect type for ECDSA public key parameters");const i=this.getAlgorithmByOID(l.valueBlock.toString(),!0);s.algorithm.algorithm.namedCurve=i.name}return s}async getPublicKey(e,t,s){s||(s=this.fillPublicKeyParameters(e,t));const a=e.toSchema().toBER(!1);return this.importKey("spki",a,s.algorithm.algorithm,!0,s.algorithm.usages)}async verifyWithPublicKey(e,t,s,a,n){let u;if(n){const i={};let c;a.algorithmId==="1.2.840.113549.1.1.10"?c=a.algorithmId:c=s.algorithm.algorithmId;const m=this.getAlgorithmByOID(c,!0);if(i.algorithm=this.getAlgorithmParameters(m.name,"importKey"),"hash"in i.algorithm.algorithm&&(i.algorithm.algorithm.hash.name=n),m.name==="ECDSA"){let h=!1;if("algorithmParams"in s.algorithm&&"idBlock"in s.algorithm.algorithmParams&&s.algorithm.algorithmParams.idBlock.tagClass===1&&s.algorithm.algorithmParams.idBlock.tagNumber===6&&(h=!0),h===!1)throw new Error("Incorrect type for ECDSA public key parameters");const g=this.getAlgorithmByOID(s.algorithm.algorithmParams.valueBlock.toString(),!0);i.algorithm.algorithm.namedCurve=g.name}u=await this.getPublicKey(s,null,i)}else{if(n=this.getHashAlgorithm(a),!n)throw new Error("Unsupported signature algorithm: ".concat(a.algorithmId));u=await this.getPublicKey(s,a)}const o=this.getAlgorithmParameters(u.algorithm.name,"verify");"hash"in o.algorithm&&(o.algorithm.hash.name=n);let l=t.valueBlock.valueHexView;if(u.algorithm.name==="ECDSA"){const i=ea.find(u.algorithm.namedCurve);if(!i)throw new Error("Unsupported named curve in use");const c=Re(l);L.assert(c,"Signature value"),l=J0(c.result,i.size)}if(u.algorithm.name==="RSA-PSS"){const i=new et({schema:a.algorithmParams});"saltLength"in i?o.algorithm.saltLength=i.saltLength:o.algorithm.saltLength=20;let c="SHA-1";"hashAlgorithm"in i&&(c=this.getAlgorithmByOID(i.hashAlgorithm.algorithmId,!0).name),o.algorithm.hash.name=c}return this.verify(o.algorithm,u,l,e)}}let mw={name:"none",crypto:null};function Pd(r){return!!(r&&typeof r=="object"&&"crypto"in r)}function Od(r,...e){let t=null;if(e.length<2)e.length?t=e[0]:t=typeof self<"u"&&self.crypto?new ec({name:"browser",crypto:self.crypto}):null;else{const s=e[0],a=e[1];Pd(a)?t=a:Pd(s)?t=s:"subtle"in s&&"getRandomValues"in s&&(t=new ec({crypto:s}))}if(typeof We<"u"&&"pid"in We&&typeof Et<"u"&&typeof window>"u"){if(typeof Et[We.pid]>"u")Et[We.pid]={};else if(typeof Et[We.pid]!="object")throw new Error("Name global.".concat(We.pid," already exists and it is not an object"));if(typeof Et[We.pid].pkijs>"u")Et[We.pid].pkijs={};else if(typeof Et[We.pid].pkijs!="object")throw new Error("Name global.".concat(We.pid,".pkijs already exists and it is not an object"));Et[We.pid].pkijs.engine={name:r,crypto:t}}else mw={name:r,crypto:t}}function H0(){if(typeof We<"u"&&"pid"in We&&typeof Et<"u"&&typeof window>"u"){let r;try{r=Et[We.pid].pkijs.engine}catch(e){throw new Error("Please call 'setEngine' before call to 'getEngine'")}return r}return mw}function te(r=!1){const e=H0();if(!e.crypto&&r)throw new Error("Unable to create WebCrypto object");return e.crypto}function M0(r){if(r.byteLength%2!==0)return Le;const e=r.byteLength/2,t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(r,0,e));const s=new R({valueHex:t}),a=new ArrayBuffer(e);new Uint8Array(a).set(new Uint8Array(r,e,e));const n=new R({valueHex:a});return new E({value:[s.convertToDER(),n.convertToDER()]}).toBER(!1)}function J0(r,e){if(!(r instanceof E&&r.valueBlock.value.length===2&&r.valueBlock.value[0]instanceof R&&r.valueBlock.value[1]instanceof R))return Le;const t=r.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,s=r.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,a=new Uint8Array(e*2);return a.set(t,e-t.byteLength),a.set(s,2*e-s.byteLength),a.buffer}async function F0(r,e,t,s,a){switch(r.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new me("Unknown hash function: ".concat(r))}if(me.assert(e,"zBuffer","ArrayBuffer"),e.byteLength===0)throw new me("'zBuffer' has zero length, error");if(me.assert(s,"SharedInfo","ArrayBuffer"),t>255)throw new me("Please set 'Counter' argument to value less or equal to 255");const n=new ArrayBuffer(4),u=new Uint8Array(n);u[0]=0,u[1]=0,u[2]=0,u[3]=t;let o=Le;o=mo(o,e),o=mo(o,n),o=mo(o,s);const l=await a.digest({name:r},o);return{counter:t,result:l}}async function Dd(r,e,t,s,a=te(!0)){let n=0,u=1;switch(r.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:throw new me("Unknown hash function: ".concat(r))}if(me.assert(e,"Zbuffer","ArrayBuffer"),e.byteLength===0)throw new me("'Zbuffer' has zero length, error");me.assert(s,"SharedInfo","ArrayBuffer");const o=t/n;Math.floor(o)>0&&(u=Math.floor(o),o-u>0&&u++);const l=[];for(let h=1;h<=u;h++)l.push(await F0(r,e,h,s,a));let i=Le,c=1,m=!0;for(;m;){m=!1;for(const h of l)if(h.counter===c){i=mo(i,h.result),m=!0;break}c++}if(t>>=3,i.byteLength>t){const h=new ArrayBuffer(t),g=new Uint8Array(h),p=new Uint8Array(i);for(let y=0;y<t;y++)g[y]=p[y];return h}return i}const Om="version",Dm="logID",Tm="extensions",Rm="timestamp",Lm="hashAlgorithm",jm="signatureAlgorithm",$m="signature",Td="none",Rd="md5",Ld="sha1",jd="sha224",$d="sha256",Ud="sha384",Kd="sha512",Hd="anonymous",Md="rsa",Jd="dsa",Fd="ecdsa";class ls extends j{constructor(e={}){super(),this.version=d(e,Om,ls.defaultValues(Om)),this.logID=d(e,Dm,ls.defaultValues(Dm)),this.timestamp=d(e,Rm,ls.defaultValues(Rm)),this.extensions=d(e,Tm,ls.defaultValues(Tm)),this.hashAlgorithm=d(e,Lm,ls.defaultValues(Lm)),this.signatureAlgorithm=d(e,jm,ls.defaultValues(jm)),this.signature=d(e,$m,ls.defaultValues($m)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Om:return 0;case Dm:case Tm:return Le;case Rm:return new Date(0);case Lm:case jm:return A;case $m:return new Y;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof vh))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new Zr({stream:new Se({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(Kw(new Uint8Array(e.getBlock(8)),8));const s=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(s)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=Td;break;case 1:this.hashAlgorithm=Rd;break;case 2:this.hashAlgorithm=Ld;break;case 3:this.hashAlgorithm=jd;break;case 4:this.hashAlgorithm=$d;break;case 5:this.hashAlgorithm=Ud;break;case 6:this.hashAlgorithm=Kd;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=Hd;break;case 1:this.signatureAlgorithm=Md;break;case 2:this.signatureAlgorithm=Jd;break;case 3:this.signatureAlgorithm=Fd;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16(),n=new Uint8Array(e.getBlock(a)).buffer.slice(0),u=Re(n);if(L.assert(u,"SignedCertificateTimestamp"),this.signature=u.result,t!==47+s+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new vh({data:e.stream.buffer})}toStream(){const e=new Zr;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),s=new Uint8Array(t),a=xp(this.timestamp.valueOf(),8);s.set(new Uint8Array(a),8-a.byteLength),e.appendView(s),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions));let n;switch(this.hashAlgorithm.toLowerCase()){case Td:n=0;break;case Rd:n=1;break;case Ld:n=2;break;case jd:n=3;break;case $d:n=4;break;case Ud:n=5;break;case Kd:n=6;break;default:throw new Error("Incorrect data for hashAlgorithm: ".concat(this.hashAlgorithm))}e.appendChar(n);let u;switch(this.signatureAlgorithm.toLowerCase()){case Hd:u=0;break;case Md:u=1;break;case Jd:u=2;break;case Fd:u=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: ".concat(this.signatureAlgorithm))}e.appendChar(u);const o=this.signature.toBER(!1);return e.appendUint16(o.byteLength),e.appendView(new Uint8Array(o)),e}toJSON(){return{version:this.version,logID:Ip(this.logID),timestamp:this.timestamp,extensions:Ip(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,s=0,a=te(!0)){const n=uf(yh(this.logID));let u=null;const o=new Zr;for(const g of e)if(g.log_id===n){u=g.key;break}if(!u)throw new Error("Public key not found for CT with logId: ".concat(n));const l=Ao(Wu(u)),i=Nt.fromBER(l);o.appendChar(0),o.appendChar(0);const c=new ArrayBuffer(8),m=new Uint8Array(c),h=xp(this.timestamp.valueOf(),8);return m.set(new Uint8Array(h),8-h.byteLength),o.appendView(m),o.appendUint16(s),s===0&&o.appendUint24(t.byteLength),o.appendView(new Uint8Array(t)),o.appendUint16(this.extensions.byteLength),this.extensions.byteLength!==0&&o.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(o.buffer.slice(0,o.length),new H({valueHex:this.signature.toBER(!1)}),i,{algorithmId:A},"SHA-256")}}ls.CLASS_NAME="SignedCertificateTimestamp";const wc="timestamps";class qh extends j{constructor(e={}){super(),this.timestamps=d(e,wc,qh.defaultValues(wc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){var t;const s=d(e,"names",{});return(t=s.optional)!==null&&t!==void 0||(s.optional=!1),new H({name:s.blockName||"SignedCertificateTimestampList",optional:s.optional})}fromSchema(e){if(!(e instanceof H))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new Zr({stream:new Se({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new ls({stream:t}))}toSchema(){const e=new Zr;let t=0;const s=[];for(const a of this.timestamps){const n=a.toStream();s.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const a of s)e.appendView(a.stream.view);return new H({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}qh.CLASS_NAME="SignedCertificateTimestampList";const Pl="attributes",q0=[Pl];class tc extends j{constructor(e={}){super(),this.attributes=d(e,Pl,tc.defaultValues(Pl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.attributes||A,value:we.schema()})]})}fromSchema(e){$(e,q0);const t=U(e,e,tc.schema({names:{attributes:Pl}}));L.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,s=>new we({schema:s}))}toSchema(){return new E({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}tc.CLASS_NAME="SubjectDirectoryAttributes";class ve{static getItems(){return this.types||(this.types={},ve.register(_g,"SubjectAltName",So),ve.register(Yg,"IssuerAltName",So),ve.register(lp,"AuthorityKeyIdentifier",zr),ve.register(ip,"BasicConstraints",An),ve.register(o0,"MicrosoftCaVersion",_u),ve.register(sw,"CertificatePolicies",No),ve.register(t0,"CertificatePoliciesMicrosoft",No),ve.register(i0,"MicrosoftCertTemplateV2",co),ve.register(tw,"CRLDistributionPoints",ko),ve.register(op,"FreshestCRL",ko),ve.register(s0,"ExtKeyUsage",Yu),ve.register(Zg,"CertificateIssuer",Fe),ve.register(up,"AuthorityInfoAccess",Co),ve.register(a0,"SubjectInfoAccess",Co),ve.register(Qg,"IssuingDistributionPoint",Qe),ve.register(ew,"NameConstraints",po),ve.register(aw,"PolicyConstraints",go),ve.register(rw,"PolicyMappings",Qu),ve.register(_b,"PrivateKeyUsagePeriod",wo),ve.register(l0,"QCStatements",Zu),ve.register(n0,"SignedCertificateTimestampList",qh),ve.register(Gb,"SubjectDirectoryAttributes",tc)),this.types}static fromBER(e,t){const s=Re(t);if(s.offset===-1)return null;const a=this.find(e);if(a)try{return new a.type({schema:s.result})}catch(n){const u=new a.type;return u.parsingError="Incorrectly formatted value of extension ".concat(a.name," (").concat(e,")"),u}return s.result}static find(e){return this.getItems()[e]||null}static register(e,t,s){this.getItems()[e]={name:t,type:s}}}const Ol="extnID",wr="critical",Dl="extnValue",yc="parsedValue",W0=[Ol,wr,Dl];class Oe extends j{get parsedValue(){if(this._parsedValue===void 0){const e=ve.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=d(e,Ol,Oe.defaultValues(Ol)),this.critical=d(e,wr,Oe.defaultValues(wr)),Dl in e?this.extnValue=new H({valueHex:e.extnValue}):this.extnValue=Oe.defaultValues(Dl),yc in e&&(this.parsedValue=d(e,yc,Oe.defaultValues(yc))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ol:return A;case wr:return!1;case Dl:return new H;case yc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.extnID||A}),new aa({name:t.critical||A,optional:!0}),new H({name:t.extnValue||A})]})}fromSchema(e){$(e,W0);const t=U(e,e,Oe.schema({names:{extnID:Ol,critical:wr,extnValue:Dl}}));L.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),wr in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new W({value:this.extnID})),this.critical!==Oe.defaultValues(wr)&&e.push(new aa({value:this.critical})),e.push(this.extnValue),new E({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Oe.defaultValues(wr)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}Oe.CLASS_NAME="Extension";const Tl="extensions",G0=[Tl];class je extends j{constructor(e={}){super(),this.extensions=d(e,Tl,je.defaultValues(Tl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tl:return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,"names",{});return new E({optional:t,name:s.blockName||A,value:[new ee({name:s.extensions||A,value:Oe.schema(s.extension||{})})]})}fromSchema(e){$(e,G0);const t=U(e,e,je.schema({names:{extensions:Tl}}));L.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,s=>new Oe({schema:s}))}toSchema(){return new E({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}je.CLASS_NAME="Extensions";const Rl="issuer",Ll="serialNumber",Ca="issuerUID",z0=[Rl,Ll,Ca];class St extends j{constructor(e={}){super(),this.issuer=d(e,Rl,St.defaultValues(Rl)),this.serialNumber=d(e,Ll,St.defaultValues(Ll)),Ca in e&&(this.issuerUID=d(e,Ca,St.defaultValues(Ca))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rl:return new Fe;case Ll:return new R;case Ca:return new ae;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[Fe.schema(t.issuer||{}),new R({name:t.serialNumber||A}),new ae({optional:!0,name:t.issuerUID||A})]})}fromSchema(e){$(e,z0);const t=U(e,e,St.schema({names:{issuer:{names:{blockName:Rl}},serialNumber:Ll,issuerUID:Ca}}));L.assertSchema(t,this.className),this.issuer=new Fe({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,Ca in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new E({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}St.CLASS_NAME="IssuerSerial";const jl="version",Ea="baseCertificateID",xa="subjectName",$l="issuer",Ul="signature",Kl="serialNumber",Hl="attrCertValidityPeriod",Ml="attributes",Ia="issuerUniqueID",Va="extensions",X0=[jl,Ea,xa,$l,Ul,Kl,Hl,Ml,Ia,Va];class ut extends j{constructor(e={}){super(),this.version=d(e,jl,ut.defaultValues(jl)),Ea in e&&(this.baseCertificateID=d(e,Ea,ut.defaultValues(Ea))),xa in e&&(this.subjectName=d(e,xa,ut.defaultValues(xa))),this.issuer=d(e,$l,ut.defaultValues($l)),this.signature=d(e,Ul,ut.defaultValues(Ul)),this.serialNumber=d(e,Kl,ut.defaultValues(Kl)),this.attrCertValidityPeriod=d(e,Hl,ut.defaultValues(Hl)),this.attributes=d(e,Ml,ut.defaultValues(Ml)),Ia in e&&(this.issuerUniqueID=d(e,Ia,ut.defaultValues(Ia))),Va in e&&(this.extensions=d(e,Va,ut.defaultValues(Va))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case jl:return 0;case Ea:return new St;case xa:return new Fe;case $l:return new Fe;case Ul:return new T;case Kl:return new R;case Hl:return new ss;case Ml:return[];case Ia:return new ae;case Va:return new je;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),new Ne({value:[new O({name:t.baseCertificateID||A,idBlock:{tagClass:3,tagNumber:0},value:St.schema().valueBlock.value}),new O({name:t.subjectName||A,idBlock:{tagClass:3,tagNumber:1},value:Fe.schema().valueBlock.value})]}),Fe.schema({names:{blockName:t.issuer||A}}),T.schema(t.signature||{}),new R({name:t.serialNumber||A}),ss.schema(t.attrCertValidityPeriod||{}),new E({name:t.attributes||A,value:[new ee({value:we.schema()})]}),new ae({optional:!0,name:t.issuerUniqueID||A}),je.schema(t.extensions||{},!0)]})}fromSchema(e){$(e,X0);const t=U(e,e,ut.schema({names:{version:jl,baseCertificateID:Ea,subjectName:xa,issuer:$l,signature:{names:{blockName:Ul}},serialNumber:Kl,attrCertValidityPeriod:{names:{blockName:Hl}},attributes:Ml,issuerUniqueID:Ia,extensions:{names:{blockName:Va}}}}));L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Ea in t.result&&(this.baseCertificateID=new St({schema:new E({value:t.result.baseCertificateID.valueBlock.value})})),xa in t.result&&(this.subjectName=new Fe({schema:new E({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new T({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ss({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new we({schema:s})),Ia in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),Va in t.result&&(this.extensions=new je({schema:t.result.extensions}))}toSchema(){const e=new E({value:[new R({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new O({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new O({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new E({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}ut.CLASS_NAME="AttributeCertificateInfoV1";const Jl="acinfo",Fl="signatureAlgorithm",ql="signatureValue",_0=[Jl,ql,Fl];class Ts extends j{constructor(e={}){super(),this.acinfo=d(e,Jl,Ts.defaultValues(Jl)),this.signatureAlgorithm=d(e,Fl,Ts.defaultValues(Fl)),this.signatureValue=d(e,ql,Ts.defaultValues(ql)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jl:return new ut;case Fl:return new T;case ql:return new ae;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[ut.schema(t.acinfo||{}),T.schema(t.signatureAlgorithm||{}),new ae({name:t.signatureValue||A})]})}fromSchema(e){$(e,_0);const t=U(e,e,Ts.schema({names:{acinfo:{names:{blockName:Jl}},signatureAlgorithm:{names:{blockName:Fl}},signatureValue:ql}}));L.assertSchema(t,this.className),this.acinfo=new ut({schema:t.result.acinfo}),this.signatureAlgorithm=new T({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new E({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}Ts.CLASS_NAME="AttributeCertificateV1";const Wl="digestedObjectType",Ba="otherObjectTypeID",Gl="digestAlgorithm",zl="objectDigest",Y0=[Wl,Ba,Gl,zl];class Dt extends j{constructor(e={}){super(),this.digestedObjectType=d(e,Wl,Dt.defaultValues(Wl)),Ba in e&&(this.otherObjectTypeID=d(e,Ba,Dt.defaultValues(Ba))),this.digestAlgorithm=d(e,Gl,Dt.defaultValues(Gl)),this.objectDigest=d(e,zl,Dt.defaultValues(zl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wl:return new zu;case Ba:return new W;case Gl:return new T;case zl:return new ae;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new zu({name:t.digestedObjectType||A}),new W({optional:!0,name:t.otherObjectTypeID||A}),T.schema(t.digestAlgorithm||{}),new ae({name:t.objectDigest||A})]})}fromSchema(e){$(e,Y0);const t=U(e,e,Dt.schema({names:{digestedObjectType:Wl,otherObjectTypeID:Ba,digestAlgorithm:{names:{blockName:Gl}},objectDigest:zl}}));L.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,Ba in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new T({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new E({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}Dt.CLASS_NAME="ObjectDigestInfo";const Pa="issuerName",Oa="baseCertificateID",Da="objectDigestInfo",Q0=[Pa,Oa,Da];class _r extends j{constructor(e={}){super(),Pa in e&&(this.issuerName=d(e,Pa,_r.defaultValues(Pa))),Oa in e&&(this.baseCertificateID=d(e,Oa,_r.defaultValues(Oa))),Da in e&&(this.objectDigestInfo=d(e,Da,_r.defaultValues(Da))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pa:return new Fe;case Oa:return new St;case Da:return new Dt;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[Fe.schema({names:{blockName:t.issuerName}},!0),new O({optional:!0,name:t.baseCertificateID||A,idBlock:{tagClass:3,tagNumber:0},value:St.schema().valueBlock.value}),new O({optional:!0,name:t.objectDigestInfo||A,idBlock:{tagClass:3,tagNumber:1},value:Dt.schema().valueBlock.value})]})}fromSchema(e){$(e,Q0);const t=U(e,e,_r.schema({names:{issuerName:Pa,baseCertificateID:Oa,objectDigestInfo:Da}}));L.assertSchema(t,this.className),Pa in t.result&&(this.issuerName=new Fe({schema:t.result.issuerName})),Oa in t.result&&(this.baseCertificateID=new St({schema:new E({value:t.result.baseCertificateID.valueBlock.value})})),Da in t.result&&(this.objectDigestInfo=new Dt({schema:new E({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new E;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new O({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new O({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}_r.CLASS_NAME="V2Form";const Ta="baseCertificateID",Ra="entityName",La="objectDigestInfo",Z0=[Ta,Ra,La];class Rs extends j{constructor(e={}){super(),Ta in e&&(this.baseCertificateID=d(e,Ta,Rs.defaultValues(Ta))),Ra in e&&(this.entityName=d(e,Ra,Rs.defaultValues(Ra))),La in e&&(this.objectDigestInfo=d(e,La,Rs.defaultValues(La))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ta:return new St;case Ra:return new Fe;case La:return new Dt;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new O({optional:!0,name:t.baseCertificateID||A,idBlock:{tagClass:3,tagNumber:0},value:St.schema().valueBlock.value}),new O({optional:!0,name:t.entityName||A,idBlock:{tagClass:3,tagNumber:1},value:Fe.schema().valueBlock.value}),new O({optional:!0,name:t.objectDigestInfo||A,idBlock:{tagClass:3,tagNumber:2},value:Dt.schema().valueBlock.value})]})}fromSchema(e){$(e,Z0);const t=U(e,e,Rs.schema({names:{baseCertificateID:Ta,entityName:Ra,objectDigestInfo:La}}));L.assertSchema(t,this.className),Ta in t.result&&(this.baseCertificateID=new St({schema:new E({value:t.result.baseCertificateID.valueBlock.value})})),Ra in t.result&&(this.entityName=new Fe({schema:new E({value:t.result.entityName.valueBlock.value})})),La in t.result&&(this.objectDigestInfo=new Dt({schema:new E({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new E;return this.baseCertificateID&&e.valueBlock.value.push(new O({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new O({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new O({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}Rs.CLASS_NAME="Holder";const Xl="version",_l="holder",Yl="issuer",Ql="signature",Zl="serialNumber",eu="attrCertValidityPeriod",tu="attributes",ja="issuerUniqueID",$a="extensions",e1=[Xl,_l,Yl,Ql,Zl,eu,tu,ja,$a];class dt extends j{constructor(e={}){super(),this.version=d(e,Xl,dt.defaultValues(Xl)),this.holder=d(e,_l,dt.defaultValues(_l)),this.issuer=d(e,Yl,dt.defaultValues(Yl)),this.signature=d(e,Ql,dt.defaultValues(Ql)),this.serialNumber=d(e,Zl,dt.defaultValues(Zl)),this.attrCertValidityPeriod=d(e,eu,dt.defaultValues(eu)),this.attributes=d(e,tu,dt.defaultValues(tu)),ja in e&&(this.issuerUniqueID=d(e,ja,dt.defaultValues(ja))),$a in e&&(this.extensions=d(e,$a,dt.defaultValues($a))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xl:return 1;case _l:return new Rs;case Yl:return{};case Ql:return new T;case Zl:return new R;case eu:return new ss;case tu:return[];case ja:return new ae;case $a:return new je;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),Rs.schema(t.holder||{}),new Ne({value:[Fe.schema({names:{blockName:t.issuer||A}}),new O({name:t.issuer||A,idBlock:{tagClass:3,tagNumber:0},value:_r.schema().valueBlock.value})]}),T.schema(t.signature||{}),new R({name:t.serialNumber||A}),ss.schema(t.attrCertValidityPeriod||{}),new E({name:t.attributes||A,value:[new ee({value:we.schema()})]}),new ae({optional:!0,name:t.issuerUniqueID||A}),je.schema(t.extensions||{},!0)]})}fromSchema(e){$(e,e1);const t=U(e,e,dt.schema({names:{version:Xl,holder:{names:{blockName:_l}},issuer:Yl,signature:{names:{blockName:Ql}},serialNumber:Zl,attrCertValidityPeriod:{names:{blockName:eu}},attributes:tu,issuerUniqueID:ja,extensions:{names:{blockName:$a}}}}));switch(L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new Rs({schema:t.result.holder}),t.result.issuer.idBlock.tagClass){case 3:this.issuer=new _r({schema:new E({value:t.result.issuer.valueBlock.value})});break;case 1:default:throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2")}this.signature=new T({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ss({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,s=>new we({schema:s})),ja in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),$a in t.result&&(this.extensions=new je({schema:t.result.extensions}))}toSchema(){const e=new E({value:[new R({value:this.version}),this.holder.toSchema(),new O({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new E({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}dt.CLASS_NAME="AttributeCertificateInfoV2";const su="acinfo",ru="signatureAlgorithm",au="signatureValue",t1=[su,ru,au];class Tt extends j{constructor(e={}){super(),this.acinfo=d(e,su,Tt.defaultValues(su)),this.signatureAlgorithm=d(e,ru,Tt.defaultValues(ru)),this.signatureValue=d(e,au,Tt.defaultValues(au)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case su:return new dt;case ru:return new T;case au:return new ae;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[dt.schema(t.acinfo||{}),T.schema(t.signatureAlgorithm||{}),new ae({name:t.signatureValue||A})]})}fromSchema(e){$(e,t1);const t=U(e,e,Tt.schema({names:{acinfo:{names:{blockName:su}},signatureAlgorithm:{names:{blockName:ru}},signatureValue:au}}));L.assertSchema(t,this.className),this.acinfo=new dt({schema:t.result.acinfo}),this.signatureAlgorithm=new T({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new E({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}Tt.CLASS_NAME="AttributeCertificateV2";const Ua="contentType",Zn="content",s1=[Ua,Zn];class pe extends j{constructor(e={}){super(),this.contentType=d(e,Ua,pe.defaultValues(Ua)),this.content=d(e,Zn,pe.defaultValues(Zn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ua:return A;case Zn:return new Y;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ua:return typeof t=="string"&&t===this.defaultValues(Ua);case Zn:return t instanceof Y;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return"optional"in t||(t.optional=!1),new E({name:t.blockName||"ContentInfo",optional:t.optional,value:[new W({name:t.contentType||Ua}),new O({idBlock:{tagClass:3,tagNumber:0},value:[new Y({name:t.content||Zn})]})]})}fromSchema(e){$(e,s1);const t=U(e,e,pe.schema());L.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new E({value:[new W({value:this.contentType}),new O({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof Y||(e.content=this.content.toJSON()),e}}pe.CLASS_NAME="ContentInfo",pe.DATA=cp,pe.SIGNED_DATA=nw,pe.ENVELOPED_DATA=iw,pe.ENCRYPTED_DATA=ow;const Um="type",Km="value",Sf="utcTimeName",Nf="generalTimeName",r1=[Sf,Nf];var qd;(function(r){r[r.UTCTime=0]="UTCTime",r[r.GeneralizedTime=1]="GeneralizedTime",r[r.empty=2]="empty"})(qd||(qd={}));class Te extends j{constructor(e={}){super(),this.type=d(e,Um,Te.defaultValues(Um)),this.value=d(e,Km,Te.defaultValues(Km)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Um:return 0;case Km:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const s=d(e,"names",{});return new Ne({optional:t,value:[new cf({name:s.utcTimeName||A}),new ke({name:s.generalTimeName||A})]})}fromSchema(e){$(e,r1);const t=U(e,e,Te.schema({names:{utcTimeName:Sf,generalTimeName:Nf}}));L.assertSchema(t,this.className),Sf in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),Nf in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return this.type===0?new cf({valueDate:this.value}):this.type===1?new ke({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}Te.CLASS_NAME="Time";const Hm="tbs",yr="version",Mc="serialNumber",Jc="signature",Fc="issuer",qc="notBefore",Wc="notAfter",Gc="subject",zc="subjectPublicKeyInfo",nu="issuerUniqueID",iu="subjectUniqueID",ou="extensions",lu="signatureAlgorithm",uu="signatureValue",Rt="tbsCertificate",Vh="".concat(Rt,".").concat(yr),hp="".concat(Rt,".").concat(Mc),mp="".concat(Rt,".").concat(Jc),fp="".concat(Rt,".").concat(Fc),Bh="".concat(Rt,".").concat(qc),Ph="".concat(Rt,".").concat(Wc),pp="".concat(Rt,".").concat(Gc),dp="".concat(Rt,".").concat(zc),Oh="".concat(Rt,".").concat(nu),Dh="".concat(Rt,".").concat(iu),Ju="".concat(Rt,".").concat(ou),a1=[Rt,Vh,hp,mp,fp,Bh,Ph,pp,dp,Oh,Dh,Ju,lu,uu];function n1(r={}){const e=d(r,"names",{});return new E({name:e.blockName||Rt,value:[new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new R({name:e.tbsCertificateVersion||Vh})]}),new R({name:e.tbsCertificateSerialNumber||hp}),T.schema(e.signature||{names:{blockName:mp}}),fe.schema(e.issuer||{names:{blockName:fp}}),new E({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[Te.schema(e.notBefore||{names:{utcTimeName:Bh,generalTimeName:Bh}}),Te.schema(e.notAfter||{names:{utcTimeName:Ph,generalTimeName:Ph}})]}),fe.schema(e.subject||{names:{blockName:pp}}),Nt.schema(e.subjectPublicKeyInfo||{names:{blockName:dp}}),new _({name:e.tbsCertificateIssuerUniqueID||Oh,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new _({name:e.tbsCertificateSubjectUniqueID||Dh,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[je.schema(e.extensions||{names:{blockName:Ju}})]})]})}class le extends j{get tbs(){return ge.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,Hm,le.defaultValues(Hm))),this.version=d(e,yr,le.defaultValues(yr)),this.serialNumber=d(e,Mc,le.defaultValues(Mc)),this.signature=d(e,Jc,le.defaultValues(Jc)),this.issuer=d(e,Fc,le.defaultValues(Fc)),this.notBefore=d(e,qc,le.defaultValues(qc)),this.notAfter=d(e,Wc,le.defaultValues(Wc)),this.subject=d(e,Gc,le.defaultValues(Gc)),this.subjectPublicKeyInfo=d(e,zc,le.defaultValues(zc)),nu in e&&(this.issuerUniqueID=d(e,nu,le.defaultValues(nu))),iu in e&&(this.subjectUniqueID=d(e,iu,le.defaultValues(iu))),ou in e&&(this.extensions=d(e,ou,le.defaultValues(ou))),this.signatureAlgorithm=d(e,lu,le.defaultValues(lu)),this.signatureValue=d(e,uu,le.defaultValues(uu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hm:return Le;case yr:return 0;case Mc:return new R;case Jc:return new T;case Fc:return new fe;case qc:return new Te;case Wc:return new Te;case Gc:return new fe;case zc:return new Nt;case nu:return Le;case iu:return Le;case ou:return[];case lu:return new T;case uu:return new ae;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[n1(t.tbsCertificate),T.schema(t.signatureAlgorithm||{names:{blockName:lu}}),new ae({name:t.signatureValue||uu})]})}fromSchema(e){$(e,a1);const t=U(e,e,le.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:Ju}}}}}}));L.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,Vh in t.result&&(this.version=t.result[Vh].valueBlock.valueDec),this.serialNumber=t.result[hp],this.signature=new T({schema:t.result[mp]}),this.issuer=new fe({schema:t.result[fp]}),this.notBefore=new Te({schema:t.result[Bh]}),this.notAfter=new Te({schema:t.result[Ph]}),this.subject=new fe({schema:t.result[pp]}),this.subjectPublicKeyInfo=new Nt({schema:t.result[dp]}),Oh in t.result&&(this.issuerUniqueID=t.result[Oh].valueBlock.valueHex),Dh in t.result&&(this.subjectUniqueID=t.result[Dh].valueBlock.valueHex),Ju in t.result&&(this.extensions=Array.from(t.result[Ju],s=>new Oe({schema:s}))),this.signatureAlgorithm=new T({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return yr in this&&this.version!==le.defaultValues(yr)&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new R({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new E({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new _({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new _({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new E({value:Array.from(this.extensions,t=>t.toSchema())})]})),new E({value:e})}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return le.schema().value[0];const s=Re(this.tbsView);L.assert(s,"TBS Certificate"),t=s.result}else t=this.encodeTBS();return new E({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:he.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return yr in this&&this.version!==le.defaultValues(yr)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=he.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=he.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async getPublicKey(e,t=te(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=te(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",s=te(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const u=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ae({valueHex:u})}async verify(e,t=te(!0)){let s;if(e?s=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(s=this.subjectPublicKeyInfo),!(s instanceof Nt))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}le.CLASS_NAME="Certificate";function fw(r,e=null){if(e&&r.issuer.isEqual(e.issuer)&&r.serialNumber.isEqual(e.serialNumber))return null;let t=!1;if(r.extensions){for(const s of r.extensions)if(s.extnID===ip&&s.parsedValue instanceof An&&s.parsedValue.cA){t=!0;break}}return t?r:null}const ei="certId",ti="certValue",Rn="parsedValue",i1=[ei,ti];class dn extends j{constructor(e={}){super(),this.certId=d(e,ei,dn.defaultValues(ei)),this.certValue=d(e,ti,dn.defaultValues(ti)),Rn in e&&(this.parsedValue=d(e,Rn,dn.defaultValues(Rn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ei:return A;case ti:return new Y;case Rn:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ei:return t===A;case ti:return t instanceof Y;case Rn:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.id||"id"}),new O({idBlock:{tagClass:3,tagNumber:0},value:[new Y({name:t.value||"value"})]})]})}fromSchema(e){$(e,i1);const t=U(e,e,dn.schema({names:{id:ei,value:ti}}));L.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const s=this.certValue.valueBlock.valueHexView;switch(this.certId){case Ed:try{this.parsedValue=le.fromBER(s)}catch(a){Tt.fromBER(s)}break;case xd:this.parsedValue=Tt.fromBER(s);break;case c0:default:throw new Error("Incorrect CERT_ID value in CertBag: ".concat(this.certId))}}toSchema(){return Rn in this&&("acinfo"in this.parsedValue?this.certId=xd:this.certId=Ed,this.certValue=new H({valueHex:this.parsedValue.toSchema().toBER(!1)})),new E({value:[new W({value:this.certId}),new O({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}dn.CLASS_NAME="CertBag";const cu="userCertificate",si="revocationDate",Ka="crlEntryExtensions",o1=[cu,si,Ka];class gn extends j{constructor(e={}){super(),this.userCertificate=d(e,cu,gn.defaultValues(cu)),this.revocationDate=d(e,si,gn.defaultValues(si)),Ka in e&&(this.crlEntryExtensions=d(e,Ka,gn.defaultValues(Ka))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cu:return new R;case si:return new Te;case Ka:return new je;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.userCertificate||cu}),Te.schema({names:{utcTimeName:t.revocationDate||si,generalTimeName:t.revocationDate||si}}),je.schema({names:{blockName:t.crlEntryExtensions||Ka}},!0)]})}fromSchema(e){$(e,o1);const t=U(e,e,gn.schema());L.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new Te({schema:t.result.revocationDate}),Ka in t.result&&(this.crlEntryExtensions=new je({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new E({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}gn.CLASS_NAME="RevokedCertificate";const Mm="tbs",Lo="version",Jm="signature",Fm="issuer",qm="thisUpdate",vc="nextUpdate",bc="revokedCertificates",Ac="crlExtensions",hu="signatureAlgorithm",mu="signatureValue",Js="tbsCertList",Th="".concat(Js,".version"),gp="".concat(Js,".signature"),wp="".concat(Js,".issuer"),Rh="".concat(Js,".thisUpdate"),sc="".concat(Js,".nextUpdate"),Lh="".concat(Js,".revokedCertificates"),jh="".concat(Js,".extensions"),l1=[Js,Th,gp,wp,Rh,sc,Lh,jh,hu,mu];function u1(r={}){const e=d(r,"names",{});return new E({name:e.blockName||Js,value:[new R({optional:!0,name:e.tbsCertListVersion||Th,value:2}),T.schema(e.signature||{names:{blockName:gp}}),fe.schema(e.issuer||{names:{blockName:wp}}),Te.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:Rh,generalTimeName:Rh}}),Te.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:sc,generalTimeName:sc}},!0),new E({optional:!0,value:[new ee({name:e.tbsCertListRevokedCertificates||Lh,value:new E({value:[new R,Te.schema(),je.schema({},!0)]})})]}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[je.schema(e.crlExtensions||{names:{blockName:jh}})]})]})}const c1=[lp,Yg,Yb,Qb,Qg,op,up,Zb,e0,Zg];class He extends j{get tbs(){return ge.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,Mm,He.defaultValues(Mm))),this.version=d(e,Lo,He.defaultValues(Lo)),this.signature=d(e,Jm,He.defaultValues(Jm)),this.issuer=d(e,Fm,He.defaultValues(Fm)),this.thisUpdate=d(e,qm,He.defaultValues(qm)),vc in e&&(this.nextUpdate=d(e,vc,He.defaultValues(vc))),bc in e&&(this.revokedCertificates=d(e,bc,He.defaultValues(bc))),Ac in e&&(this.crlExtensions=d(e,Ac,He.defaultValues(Ac))),this.signatureAlgorithm=d(e,hu,He.defaultValues(hu)),this.signatureValue=d(e,mu,He.defaultValues(mu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mm:return Le;case Lo:return 0;case Jm:return new T;case Fm:return new fe;case qm:return new Te;case vc:return new Te;case bc:return[];case Ac:return new je;case hu:return new T;case mu:return new ae;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||"CertificateList",value:[u1(e),T.schema(t.signatureAlgorithm||{names:{blockName:hu}}),new ae({name:t.signatureValue||mu})]})}fromSchema(e){$(e,l1);const t=U(e,e,He.schema());L.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,Th in t.result&&(this.version=t.result[Th].valueBlock.valueDec),this.signature=new T({schema:t.result[gp]}),this.issuer=new fe({schema:t.result[wp]}),this.thisUpdate=new Te({schema:t.result[Rh]}),sc in t.result&&(this.nextUpdate=new Te({schema:t.result[sc]})),Lh in t.result&&(this.revokedCertificates=Array.from(t.result[Lh],s=>new gn({schema:s}))),jh in t.result&&(this.crlExtensions=new je({schema:t.result[jh]})),this.signatureAlgorithm=new T({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==He.defaultValues(Lo)&&e.push(new R({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new E({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new E({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return He.schema();const s=Re(this.tbsView);L.assert(s,"TBS Certificate Revocation List"),t=s.result}return new E({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:he.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==He.defaultValues(Lo)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",s=te(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),{parameters:n}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const u=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ae({valueHex:u})}async verify(e={},t=te(!0)){let s;if(e.issuerCertificate&&(s=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(s=e.publicKeyInfo),!s)throw new Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(const a of this.crlExtensions.extensions)if(a.critical&&!c1.includes(a.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}He.CLASS_NAME="CertificateRevocationList";const ri="crlId",ai="crlValue",jo="parsedValue",h1=[ri,ai];class wn extends j{constructor(e={}){super(),this.crlId=d(e,ri,wn.defaultValues(ri)),this.crlValue=d(e,ai,wn.defaultValues(ai)),jo in e&&(this.parsedValue=d(e,jo,wn.defaultValues(jo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ri:return A;case ai:return new Y;case jo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ri:return t===A;case ai:return t instanceof Y;case jo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.id||"id"}),new O({idBlock:{tagClass:3,tagNumber:0},value:[new Y({name:t.value||"value"})]})]})}fromSchema(e){$(e,h1);const t=U(e,e,wn.schema({names:{id:ri,value:ai}}));switch(L.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId){case Id:this.parsedValue=He.fromBER(this.certValue.valueBlock.valueHex);break;default:throw new Error("Incorrect CRL_ID value in CRLBag: ".concat(this.crlId))}}toSchema(){return this.parsedValue&&(this.crlId=Id,this.crlValue=new H({valueHex:this.parsedValue.toSchema().toBER(!1)})),new E({value:[new W({value:this.crlId}),new O({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}wn.CLASS_NAME="CRLBag";const ni="version",ii="encryptedContentInfo",vr="unprotectedAttrs",m1=[ni,ii,vr];class ms extends j{constructor(e={}){super(),this.version=d(e,ni,ms.defaultValues(ni)),this.encryptedContentInfo=d(e,ii,ms.defaultValues(ii)),vr in e&&(this.unprotectedAttrs=d(e,vr,ms.defaultValues(vr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ni:return 0;case ii:return new Pe;case vr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ni:return t===0;case ii:return Pe.compareWithDefault("contentType",t.contentType)&&Pe.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Pe.compareWithDefault("encryptedContent",t.encryptedContent);case vr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),Pe.schema(t.encryptedContentInfo||{}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ee({name:t.unprotectedAttrs||A,value:we.schema()})]})]})}fromSchema(e){$(e,m1);const t=U(e,e,ms.schema({names:{version:ni,encryptedContentInfo:{names:{blockName:ii}},unprotectedAttrs:vr}}));L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new Pe({schema:t.result.encryptedContentInfo}),vr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new we({schema:s})))}toSchema(){const e=[];return e.push(new R({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}async encrypt(e,t=te(!0)){me.assert(e,"parameters","object");const s=ns(nt({},e),{contentType:"1.2.840.113549.1.7.1"});this.encryptedContentInfo=await t.encryptEncryptedContentInfo(s)}async decrypt(e,t=te(!0)){me.assert(e,"parameters","object");const s=ns(nt({},e),{encryptedContentInfo:this.encryptedContentInfo});return t.decryptEncryptedContentInfo(s)}}ms.CLASS_NAME="EncryptedData";const Ha="encryptionAlgorithm",br="encryptedData",$o="parsedValue",f1=[Ha,br];class Mr extends j{constructor(e={}){super(),this.encryptionAlgorithm=d(e,Ha,Mr.defaultValues(Ha)),this.encryptedData=d(e,br,Mr.defaultValues(br)),$o in e&&(this.parsedValue=d(e,$o,Mr.defaultValues($o))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ha:return new T;case br:return new H;case $o:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ha:return T.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case br:return t.isEqual(Mr.defaultValues(e));case $o:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[T.schema(t.encryptionAlgorithm||{names:{blockName:Ha}}),new Ne({value:[new H({name:t.encryptedData||br}),new H({idBlock:{isConstructed:!0},name:t.encryptedData||br})]})]})}fromSchema(e){$(e,f1);const t=U(e,e,Mr.schema({names:{encryptionAlgorithm:{names:{blockName:Ha}},encryptedData:br}}));L.assertSchema(t,this.className),this.encryptionAlgorithm=new T({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new E({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=te(!0)){const s=await new ms({encryptedContentInfo:new Pe({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}).decrypt(e,t);this.parsedValue=Ht.fromBER(s)}async makeInternalValues(e,t=te(!0)){if(!this.parsedValue)throw new Error('Please initialize "parsedValue" first');const s=new ms,a=ns(nt({},e),{contentToEncrypt:this.parsedValue.toSchema().toBER(!1)});if(await s.encrypt(a,t),!s.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=s.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=s.encryptedContentInfo.encryptedContent}}Mr.CLASS_NAME="PKCS8ShroudedKeyBag";const oi="secretTypeId",li="secretValue",p1=[oi,li];class yo extends j{constructor(e={}){super(),this.secretTypeId=d(e,oi,yo.defaultValues(oi)),this.secretValue=d(e,li,yo.defaultValues(li)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oi:return A;case li:return new Y;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oi:return t===A;case li:return t instanceof Y;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.id||"id"}),new O({idBlock:{tagClass:3,tagNumber:0},value:[new Y({name:t.value||"value"})]})]})}fromSchema(e){$(e,p1);const t=U(e,e,yo.schema({names:{id:oi,value:li}}));L.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new E({value:[new W({value:this.secretTypeId}),new O({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}yo.CLASS_NAME="SecretBag";class Kr{static getItems(){return this.items||(this.items={},Kr.register("1.2.840.113549.1.12.10.1.1",Ht),Kr.register("1.2.840.113549.1.12.10.1.2",Mr),Kr.register("1.2.840.113549.1.12.10.1.3",dn),Kr.register("1.2.840.113549.1.12.10.1.4",wn),Kr.register("1.2.840.113549.1.12.10.1.5",yo),Kr.register("1.2.840.113549.1.12.10.1.6",Ls)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}const Ma="bagId",Ja="bagValue",Ns="bagAttributes",d1=[Ma,Ja,Ns];class Yr extends j{constructor(e={}){super(),this.bagId=d(e,Ma,Yr.defaultValues(Ma)),this.bagValue=d(e,Ja,Yr.defaultValues(Ja)),Ns in e&&(this.bagAttributes=d(e,Ns,Yr.defaultValues(Ns))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ma:return A;case Ja:return new Y;case Ns:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ma:return t===A;case Ja:return t instanceof Y;case Ns:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.bagId||Ma}),new O({idBlock:{tagClass:3,tagNumber:0},value:[new Y({name:t.bagValue||Ja})]}),new Je({optional:!0,value:[new ee({name:t.bagAttributes||Ns,value:we.schema()})]})]})}fromSchema(e){$(e,d1);const t=U(e,e,Yr.schema({names:{bagId:Ma,bagValue:Ja,bagAttributes:Ns}}));L.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const s=Kr.find(this.bagId);if(!s)throw new Error("Invalid BAG_ID for SafeBag: ".concat(this.bagId));this.bagValue=new s({schema:t.result.bagValue}),Ns in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new we({schema:a})))}toSchema(){const e=[new W({value:this.bagId}),new O({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new Je({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}Yr.CLASS_NAME="SafeBag";const Ln="safeBags";class Ls extends j{constructor(e={}){super(),this.safeBags=d(e,Ln,Ls.defaultValues(Ln)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ln:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ln:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.safeBags||A,value:Yr.schema()})]})}fromSchema(e){$(e,[Ln]);const t=U(e,e,Ls.schema({names:{safeBags:Ln}}));L.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,s=>new Yr({schema:s}))}toSchema(){return new E({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}Ls.CLASS_NAME="SafeContents";const fu="otherCertFormat",pu="otherCert",g1=[fu,pu];class ta extends j{constructor(e={}){super(),this.otherCertFormat=d(e,fu,ta.defaultValues(fu)),this.otherCert=d(e,pu,ta.defaultValues(pu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fu:return A;case pu:return new Y;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.otherCertFormat||fu}),new Y({name:t.otherCert||pu})]})}fromSchema(e){$(e,g1);const t=U(e,e,ta.schema());L.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new E({value:[new W({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof Y||(e.otherCert=this.otherCert.toJSON()),e}}const du="certificates",w1=[du];class fs extends j{constructor(e={}){super(),this.certificates=d(e,du,fs.defaultValues(du)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case du:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Je({name:t.blockName||A,value:[new ee({name:t.certificates||du,value:new Ne({value:[le.schema(),new O({idBlock:{tagClass:3,tagNumber:0},value:[new Y]}),new O({idBlock:{tagClass:3,tagNumber:1},value:[new E]}),new O({idBlock:{tagClass:3,tagNumber:2},value:Tt.schema().valueBlock.value}),new O({idBlock:{tagClass:3,tagNumber:3},value:ta.schema().valueBlock.value})]})})]})}fromSchema(e){$(e,w1);const t=U(e,e,fs.schema());L.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],s=>{const a=s.idBlock.tagNumber;if(s.idBlock.tagClass===1)return new le({schema:s});const n=new E({value:s.valueBlock.value});switch(a){case 1:return n.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec===1?new Tt({schema:n}):new Ts({schema:n});case 2:return new Tt({schema:n});case 3:return new ta({schema:n})}return s})}toSchema(){return new Je({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof le:return e.toSchema();case e instanceof Ts:return new O({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof Tt:return new O({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof ta:return new O({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}fs.CLASS_NAME="CertificateSet";const gu="otherRevInfoFormat",wu="otherRevInfo",y1=[gu,wu];class Us extends j{constructor(e={}){super(),this.otherRevInfoFormat=d(e,gu,Us.defaultValues(gu)),this.otherRevInfo=d(e,wu,Us.defaultValues(wu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gu:return A;case wu:return new Y;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.otherRevInfoFormat||gu}),new Y({name:t.otherRevInfo||wu})]})}fromSchema(e){$(e,y1);const t=U(e,e,Us.schema());L.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new E({value:[new W({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof Y||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}Us.CLASS_NAME="OtherRevocationInfoFormat";const yu="crls",Wm="otherRevocationInfos",v1=[yu];class Ks extends j{constructor(e={}){super(),this.crls=d(e,yu,Ks.defaultValues(yu)),this.otherRevocationInfos=d(e,Wm,Ks.defaultValues(Wm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yu:return[];case Wm:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Je({name:t.blockName||A,value:[new ee({name:t.crls||A,value:new Ne({value:[He.schema(),new O({idBlock:{tagClass:3,tagNumber:1},value:[new W,new Y]})]})})]})}fromSchema(e){$(e,v1);const t=U(e,e,Ks.schema({names:{crls:yu}}));if(L.assertSchema(t,this.className),t.result.crls)for(const s of t.result.crls)s.idBlock.tagClass===1?this.crls.push(new He({schema:s})):this.otherRevocationInfos.push(new Us({schema:s}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const s=t.toSchema();return s.idBlock.tagClass=3,s.idBlock.tagNumber=1,s})),new Je({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}Ks.CLASS_NAME="RevocationInfoChoices";const vu="certs",Fa="crls",b1=[vu,Fa];class In extends j{constructor(e={}){super(),this.crls=d(e,Fa,In.defaultValues(Fa)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vu:return new fs;case Fa:return new Ks;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vu:return t.certificates.length===0;case Fa:return t.crls.length===0&&t.otherRevocationInfos.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new O({name:t.certs||A,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:fs.schema().valueBlock.value}),new O({name:t.crls||A,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Ks.schema().valueBlock.value})]})}fromSchema(e){$(e,b1);const t=U(e,e,In.schema({names:{certs:vu,crls:Fa}}));L.assertSchema(t,this.className),vu in t.result&&(this.certs=new fs({schema:new Je({value:t.result.certs.valueBlock.value})})),Fa in t.result&&(this.crls=new Ks({schema:new Je({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new O({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new E({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}In.CLASS_NAME="OriginatorInfo";const bu="issuer",Au="serialNumber",A1=[bu,Au];class $e extends j{constructor(e={}){super(),this.issuer=d(e,bu,$e.defaultValues(bu)),this.serialNumber=d(e,Au,$e.defaultValues(Au)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bu:return new fe;case Au:return new R;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[fe.schema(t.issuer||{}),new R({name:t.serialNumber||A})]})}fromSchema(e){$(e,A1);const t=U(e,e,$e.schema({names:{issuer:{names:{blockName:bu}},serialNumber:Au}}));L.assertSchema(t,this.className),this.issuer=new fe({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new E({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}$e.CLASS_NAME="IssuerAndSerialNumber";const Sc="variant",Uo="value",S1=["blockName"];class vo extends j{constructor(e={}){super(),this.variant=d(e,Sc,vo.defaultValues(Sc)),Uo in e&&(this.value=d(e,Uo,vo.defaultValues(Uo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Sc:return-1;case Uo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Sc:return t===-1;case Uo:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Ne({value:[$e.schema({names:{blockName:t.blockName||A}}),new _({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){$(e,S1);const t=U(e,e,vo.schema({names:{blockName:"blockName"}}));L.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new $e({schema:t.result.blockName})):(this.variant=2,this.value=new H({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof $e))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof H))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new _({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new Y}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&this.value&&(e.value=this.value.toJSON()),e}}vo.CLASS_NAME="RecipientIdentifier";const qa="version",ui="rid",ci="keyEncryptionAlgorithm",hi="encryptedKey",Nc="recipientCertificate",N1=[qa,ui,ci,hi];class Vt extends j{constructor(e={}){super(),this.version=d(e,qa,Vt.defaultValues(qa)),this.rid=d(e,ui,Vt.defaultValues(ui)),this.keyEncryptionAlgorithm=d(e,ci,Vt.defaultValues(ci)),this.encryptedKey=d(e,hi,Vt.defaultValues(hi)),this.recipientCertificate=d(e,Nc,Vt.defaultValues(Nc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qa:return-1;case ui:return{};case ci:return new T;case hi:return new H;case Nc:return new le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case qa:return t===Vt.defaultValues(qa);case ui:return Object.keys(t).length===0;case ci:case hi:return t.isEqual(Vt.defaultValues(e));case Nc:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),vo.schema(t.rid||{}),T.schema(t.keyEncryptionAlgorithm||{}),new H({name:t.encryptedKey||A})]})}fromSchema(e){$(e,N1);const t=U(e,e,Vt.schema({names:{version:qa,rid:{names:{blockName:ui}},keyEncryptionAlgorithm:{names:{blockName:ci}},encryptedKey:hi}}));L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,t.result.rid.idBlock.tagClass===3?this.rid=new H({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new $e({schema:t.result.rid}),this.keyEncryptionAlgorithm=new T({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof $e?(this.version=0,e.push(new R({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new R({value:this.version})),e.push(new _({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new E({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Vt.CLASS_NAME="KeyTransRecipientInfo";const mi="algorithm",fi="publicKey",k1=[mi,fi];class js extends j{constructor(e={}){super(),this.algorithm=d(e,mi,js.defaultValues(mi)),this.publicKey=d(e,fi,js.defaultValues(fi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mi:return new T;case fi:return new ae;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mi:case fi:return t.isEqual(js.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[T.schema(t.algorithm||{}),new ae({name:t.publicKey||A})]})}fromSchema(e){$(e,k1);const t=U(e,e,js.schema({names:{algorithm:{names:{blockName:mi}},publicKey:fi}}));L.assertSchema(t,this.className),this.algorithm=new T({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new E({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}js.CLASS_NAME="OriginatorPublicKey";const kc="variant",Ko="value",C1=["blockName"];class Hs extends j{constructor(e={}){super(),this.variant=d(e,kc,Hs.defaultValues(kc)),Ko in e&&(this.value=d(e,Ko,Hs.defaultValues(Ko))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kc:return-1;case Ko:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case kc:return t===-1;case Ko:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Ne({value:[$e.schema({names:{blockName:t.blockName||A}}),new _({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||A}),new O({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||A,value:js.schema().valueBlock.value})]})}fromSchema(e){$(e,C1);const t=U(e,e,Hs.schema({names:{blockName:"blockName"}}));L.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new $e({schema:t.result.blockName})):t.result.blockName.idBlock.tagNumber===0?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new js({schema:new E({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new Y}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2||this.variant===3)&&(e.value=this.value.toJSON()),e}}Hs.CLASS_NAME="OriginatorIdentifierOrKey";const pi="keyAttrId",os="keyAttr",E1=[pi,os];class rs extends j{constructor(e={}){super(),this.keyAttrId=d(e,pi,rs.defaultValues(pi)),os in e&&(this.keyAttr=d(e,os,rs.defaultValues(os))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pi:return A;case os:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case pi:return typeof t=="string"&&t===A;case os:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({optional:t.optional||!0,name:t.blockName||A,value:[new W({name:t.keyAttrId||A}),new Y({optional:!0,name:t.keyAttr||A})]})}fromSchema(e){$(e,E1);const t=U(e,e,rs.schema({names:{keyAttrId:pi,keyAttr:os}}));L.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),os in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new W({value:this.keyAttrId})),os in this&&e.push(this.keyAttr),new E({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return os in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}rs.CLASS_NAME="OtherKeyAttribute";const Wa="subjectKeyIdentifier",Ar="date",Sr="other",x1=[Wa,Ar,Sr];class cs extends j{constructor(e={}){super(),this.subjectKeyIdentifier=d(e,Wa,cs.defaultValues(Wa)),Ar in e&&(this.date=d(e,Ar,cs.defaultValues(Ar))),Sr in e&&(this.other=d(e,Sr,cs.defaultValues(Sr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wa:return new H;case Ar:return new ke;case Sr:return new rs;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wa:return t.isEqual(cs.defaultValues(Wa));case Ar:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Sr:return t.keyAttrId===A&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new H({name:t.subjectKeyIdentifier||A}),new ke({optional:!0,name:t.date||A}),rs.schema(t.other||{})]})}fromSchema(e){$(e,x1);const t=U(e,e,cs.schema({names:{subjectKeyIdentifier:Wa,date:Ar,other:{names:{blockName:Sr}}}}));L.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,Ar in t.result&&(this.date=t.result.date),Sr in t.result&&(this.other=new rs({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new E({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}cs.CLASS_NAME="RecipientKeyIdentifier";const Cc="variant",Ec="value",I1=["blockName"];class ps extends j{constructor(e={}){super(),this.variant=d(e,Cc,ps.defaultValues(Cc)),this.value=d(e,Ec,ps.defaultValues(Ec)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cc:return-1;case Ec:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Cc:return t===-1;case Ec:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Ne({value:[$e.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||A}}),new O({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:0},value:cs.schema(t.rKeyId||{names:{blockName:t.blockName||A}}).valueBlock.value})]})}fromSchema(e){$(e,I1);const t=U(e,e,ps.schema({names:{blockName:"blockName"}}));L.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new $e({schema:t.result.blockName})):(this.variant=2,this.value=new cs({schema:new E({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new O({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new Y}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&(e.value=this.value.toJSON()),e}}ps.CLASS_NAME="KeyAgreeRecipientIdentifier";const di="rid",Ga="encryptedKey",V1=[di,Ga];class $s extends j{constructor(e={}){super(),this.rid=d(e,di,$s.defaultValues(di)),this.encryptedKey=d(e,Ga,$s.defaultValues(Ga)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case di:return new ps;case Ga:return new H;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case di:return t.variant===-1&&!("value"in t);case Ga:return t.isEqual($s.defaultValues(Ga));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[ps.schema(t.rid||{}),new H({name:t.encryptedKey||A})]})}fromSchema(e){$(e,V1);const t=U(e,e,$s.schema({names:{rid:{names:{blockName:di}},encryptedKey:Ga}}));L.assertSchema(t,this.className),this.rid=new ps({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new E({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}$s.CLASS_NAME="RecipientEncryptedKey";const xc="encryptedKeys",pw="RecipientEncryptedKeys",B1=[pw];class sa extends j{constructor(e={}){super(),this.encryptedKeys=d(e,xc,sa.defaultValues(xc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case xc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.RecipientEncryptedKeys||A,value:$s.schema()})]})}fromSchema(e){$(e,B1);const t=U(e,e,sa.schema({names:{RecipientEncryptedKeys:pw}}));L.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,s=>new $s({schema:s}))}toSchema(){return new E({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}sa.CLASS_NAME="RecipientEncryptedKeys";const gi="version",wi="originator",ks="ukm",yi="keyEncryptionAlgorithm",vi="recipientEncryptedKeys",Ic="recipientCertificate",Vc="recipientPublicKey",P1=[gi,wi,ks,yi,vi];class Ct extends j{constructor(e={}){super(),this.version=d(e,gi,Ct.defaultValues(gi)),this.originator=d(e,wi,Ct.defaultValues(wi)),ks in e&&(this.ukm=d(e,ks,Ct.defaultValues(ks))),this.keyEncryptionAlgorithm=d(e,yi,Ct.defaultValues(yi)),this.recipientEncryptedKeys=d(e,vi,Ct.defaultValues(vi)),this.recipientCertificate=d(e,Ic,Ct.defaultValues(Ic)),this.recipientPublicKey=d(e,Vc,Ct.defaultValues(Vc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gi:return 0;case wi:return new Hs;case ks:return new H;case yi:return new T;case vi:return new sa;case Ic:return new le;case Vc:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case gi:return t===0;case wi:return t.variant===-1&&!("value"in t);case ks:return t.isEqual(Ct.defaultValues(ks));case yi:return t.algorithmId===A&&!("algorithmParams"in t);case vi:return t.encryptedKeys.length===0;case Ic:return!1;case Vc:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),new O({idBlock:{tagClass:3,tagNumber:0},value:[Hs.schema(t.originator||{})]}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new H({name:t.ukm||A})]}),T.schema(t.keyEncryptionAlgorithm||{}),sa.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){$(e,P1);const t=U(e,e,Ct.schema({names:{version:gi,originator:{names:{blockName:wi}},ukm:ks,keyEncryptionAlgorithm:{names:{blockName:yi}},recipientEncryptedKeys:{names:{blockName:vi}}}}));L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new Hs({schema:t.result.originator}),ks in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new T({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new sa({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new R({value:this.version})),e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new E({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}Ct.CLASS_NAME="KeyAgreeRecipientInfo";const za="keyIdentifier",Nr="date",kr="other",O1=[za,Nr,kr];class es extends j{constructor(e={}){super(),this.keyIdentifier=d(e,za,es.defaultValues(za)),Nr in e&&(this.date=d(e,Nr,es.defaultValues(Nr))),kr in e&&(this.other=d(e,kr,es.defaultValues(kr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case za:return new H;case Nr:return new ke;case kr:return new rs;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case za:return t.isEqual(es.defaultValues(za));case Nr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case kr:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new H({name:t.keyIdentifier||A}),new ke({optional:!0,name:t.date||A}),rs.schema(t.other||{})]})}fromSchema(e){$(e,O1);const t=U(e,e,es.schema({names:{keyIdentifier:za,date:Nr,other:{names:{blockName:kr}}}}));L.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,Nr in t.result&&(this.date=t.result.date),kr in t.result&&(this.other=new rs({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new E({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}es.CLASS_NAME="KEKIdentifier";const bi="version",Ai="kekid",Si="keyEncryptionAlgorithm",Xa="encryptedKey",Bc="preDefinedKEK",D1=[bi,Ai,Si,Xa];class Bt extends j{constructor(e={}){super(),this.version=d(e,bi,Bt.defaultValues(bi)),this.kekid=d(e,Ai,Bt.defaultValues(Ai)),this.keyEncryptionAlgorithm=d(e,Si,Bt.defaultValues(Si)),this.encryptedKey=d(e,Xa,Bt.defaultValues(Xa)),this.preDefinedKEK=d(e,Bc,Bt.defaultValues(Bc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bi:return 0;case Ai:return new es;case Si:return new T;case Xa:return new H;case Bc:return Le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===Bt.defaultValues(bi);case Ai:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case Si:return t.algorithmId===A&&!("algorithmParams"in t);case Xa:return t.isEqual(Bt.defaultValues(Xa));case Bc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),es.schema(t.kekid||{}),T.schema(t.keyEncryptionAlgorithm||{}),new H({name:t.encryptedKey||A})]})}fromSchema(e){$(e,D1);const t=U(e,e,Bt.schema({names:{version:bi,kekid:{names:{blockName:Ai}},keyEncryptionAlgorithm:{names:{blockName:Si}},encryptedKey:Xa}}));L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new es({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new T({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new E({value:[new R({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Bt.CLASS_NAME="KEKRecipientInfo";const Ni="version",Cr="keyDerivationAlgorithm",ki="keyEncryptionAlgorithm",_a="encryptedKey",Pc="password",T1=[Ni,Cr,ki,_a];class Kt extends j{constructor(e={}){super(),this.version=d(e,Ni,Kt.defaultValues(Ni)),Cr in e&&(this.keyDerivationAlgorithm=d(e,Cr,Kt.defaultValues(Cr))),this.keyEncryptionAlgorithm=d(e,ki,Kt.defaultValues(ki)),this.encryptedKey=d(e,_a,Kt.defaultValues(_a)),this.password=d(e,Pc,Kt.defaultValues(Pc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ni:return-1;case Cr:return new T;case ki:return new T;case _a:return new H;case Pc:return Le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ni:return t===-1;case Cr:case ki:return t.algorithmId===A&&!("algorithmParams"in t);case _a:return t.isEqual(Kt.defaultValues(_a));case Pc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),new O({name:t.keyDerivationAlgorithm||A,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:T.schema().valueBlock.value}),T.schema(t.keyEncryptionAlgorithm||{}),new H({name:t.encryptedKey||A})]})}fromSchema(e){$(e,T1);const t=U(e,e,Kt.schema({names:{version:Ni,keyDerivationAlgorithm:Cr,keyEncryptionAlgorithm:{names:{blockName:ki}},encryptedKey:_a}}));L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Cr in t.result&&(this.keyDerivationAlgorithm=new T({schema:new E({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new T({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new R({value:this.version})),this.keyDerivationAlgorithm&&e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new E({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}Kt.CLASS_NAME="PasswordRecipientInfo";const Ci="oriType",Ya="oriValue",R1=[Ci,Ya];class Qr extends j{constructor(e={}){super(),this.oriType=d(e,Ci,Qr.defaultValues(Ci)),this.oriValue=d(e,Ya,Qr.defaultValues(Ya)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ci:return A;case Ya:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ci:return t===A;case Ya:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.oriType||A}),new Y({name:t.oriValue||A})]})}fromSchema(e){$(e,R1);const t=U(e,e,Qr.schema({names:{oriType:Ci,oriValue:Ya}}));L.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new E({value:[new W({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return Qr.compareWithDefault(Ya,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}Qr.CLASS_NAME="OtherRecipientInfo";const Oc="variant",Ho="value",L1=["blockName"];class Mt extends j{constructor(e={}){super(),this.variant=d(e,Oc,Mt.defaultValues(Oc)),Ho in e&&(this.value=d(e,Ho,Mt.defaultValues(Ho))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oc:return-1;case Ho:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Oc:return t===Mt.defaultValues(e);case Ho:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new Ne({value:[Vt.schema({names:{blockName:t.blockName||A}}),new O({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:1},value:Ct.schema().valueBlock.value}),new O({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:2},value:Bt.schema().valueBlock.value}),new O({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:3},value:Kt.schema().valueBlock.value}),new O({name:t.blockName||A,idBlock:{tagClass:3,tagNumber:4},value:Qr.schema().valueBlock.value})]})}fromSchema(e){$(e,L1);const t=U(e,e,Mt.schema({names:{blockName:"blockName"}}));if(L.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1)this.variant=1,this.value=new Vt({schema:t.result.blockName});else{const s=new E({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new Ct({schema:s});break;case 2:this.variant=3,this.value=new Bt({schema:s});break;case 3:this.variant=4,this.value=new Kt({schema:s});break;case 4:this.variant=5,this.value=new Qr({schema:s});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){ie.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new Y}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}Mt.CLASS_NAME="RecipientInfo";const Er="hashAlgorithm",xr="maskGenAlgorithm",Ir="pSourceAlgorithm",j1=[Er,xr,Ir];class gt extends j{constructor(e={}){super(),this.hashAlgorithm=d(e,Er,gt.defaultValues(Er)),this.maskGenAlgorithm=d(e,xr,gt.defaultValues(xr)),this.pSourceAlgorithm=d(e,Ir,gt.defaultValues(Ir)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Er:return new T({algorithmId:"1.3.14.3.2.26",algorithmParams:new Me});case xr:return new T({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new T({algorithmId:"1.3.14.3.2.26",algorithmParams:new Me}).toSchema()});case Ir:return new T({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new H({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new O({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[T.schema(t.hashAlgorithm||{})]}),new O({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[T.schema(t.maskGenAlgorithm||{})]}),new O({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[T.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){$(e,j1);const t=U(e,e,gt.schema({names:{hashAlgorithm:{names:{blockName:Er}},maskGenAlgorithm:{names:{blockName:xr}},pSourceAlgorithm:{names:{blockName:Ir}}}}));L.assertSchema(t,this.className),Er in t.result&&(this.hashAlgorithm=new T({schema:t.result.hashAlgorithm})),xr in t.result&&(this.maskGenAlgorithm=new T({schema:t.result.maskGenAlgorithm})),Ir in t.result&&(this.pSourceAlgorithm=new T({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(gt.defaultValues(Er))||e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(gt.defaultValues(xr))||e.push(new O({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(gt.defaultValues(Ir))||e.push(new O({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new E({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(gt.defaultValues(Er))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(gt.defaultValues(xr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(gt.defaultValues(Ir))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}gt.CLASS_NAME="RSAESOAEPParams";const Ei="keyInfo",Vr="entityUInfo",xi="suppPubInfo",$1=[Ei,Vr,xi];class Ps extends j{constructor(e={}){super(),this.keyInfo=d(e,Ei,Ps.defaultValues(Ei)),Vr in e&&(this.entityUInfo=d(e,Vr,Ps.defaultValues(Vr))),this.suppPubInfo=d(e,xi,Ps.defaultValues(xi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ei:return new T;case Vr:return new H;case xi:return new H;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ei:case Vr:case xi:return t.isEqual(Ps.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[T.schema(t.keyInfo||{}),new O({name:t.entityUInfo||A,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new H]}),new O({name:t.suppPubInfo||A,idBlock:{tagClass:3,tagNumber:2},value:[new H]})]})}fromSchema(e){$(e,$1);const t=U(e,e,Ps.schema({names:{keyInfo:{names:{blockName:Ei}},entityUInfo:Vr,suppPubInfo:xi}}));L.assertSchema(t,this.className),this.keyInfo=new T({schema:t.result.keyInfo}),Vr in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new O({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new E({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}Ps.CLASS_NAME="ECCCMSSharedInfo";const Ii="version",Br="originatorInfo",Vi="recipientInfos",Bi="encryptedContentInfo",Pr="unprotectedAttrs",U1=[Ii,Br,Vi,Bi,Pr],Wd={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},K1={"P-256":256,"P-384":384,"P-521":528};class Qt extends j{constructor(e={}){super(),this.version=d(e,Ii,Qt.defaultValues(Ii)),Br in e&&(this.originatorInfo=d(e,Br,Qt.defaultValues(Br))),this.recipientInfos=d(e,Vi,Qt.defaultValues(Vi)),this.encryptedContentInfo=d(e,Bi,Qt.defaultValues(Bi)),Pr in e&&(this.unprotectedAttrs=d(e,Pr,Qt.defaultValues(Pr))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ii:return 0;case Br:return new In;case Vi:return[];case Bi:return new Pe;case Pr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ii:return t===Qt.defaultValues(e);case Br:return t.certs.certificates.length===0&&t.crls.crls.length===0;case Vi:case Pr:return t.length===0;case Bi:return Pe.compareWithDefault("contentType",t.contentType)&&Pe.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Pe.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||A}),new O({name:t.originatorInfo||A,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:In.schema().valueBlock.value}),new Je({value:[new ee({name:t.recipientInfos||A,value:Mt.schema()})]}),Pe.schema(t.encryptedContentInfo||{}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ee({name:t.unprotectedAttrs||A,value:we.schema()})]})]})}fromSchema(e){$(e,U1);const t=U(e,e,Qt.schema({names:{version:Ii,originatorInfo:Br,recipientInfos:Vi,encryptedContentInfo:{names:{blockName:Bi}},unprotectedAttrs:Pr}}));L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Br in t.result&&(this.originatorInfo=new In({schema:new E({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,s=>new Mt({schema:s})),this.encryptedContentInfo=new Pe({schema:t.result.encryptedContentInfo}),Pr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,s=>new we({schema:s})))}toSchema(){const e=[];return e.push(new R({value:this.version})),this.originatorInfo&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new Je({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,s,a=te(!0)){const n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},Wd,t||{});if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549")!==-1)s=1;else if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045")!==-1)s=2;else throw new Error("Unknown type of certificate's public key: ".concat(e.subjectPublicKeyInfo.algorithm.algorithmId));switch(s){case 1:{let u,o;if(n.useOAEP===!0){u=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const i=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),c=new T({algorithmId:i,algorithmParams:new Me});o=new gt({hashAlgorithm:c,maskGenAlgorithm:new T({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:c.toSchema()})}).toSchema()}else{if(u=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),u===A)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");o=new Me}const l=new Vt({version:0,rid:new $e({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new T({algorithmId:u,algorithmParams:o}),recipientCertificate:e});this.recipientInfos.push(new Mt({variant:1,value:l}))}break;case 2:{const u=new ps({variant:1,value:new $e({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(u,n,{recipientCertificate:e},a)}break;default:throw new Error('Unknown "variant" value: '.concat(s))}return!0}addRecipientByPreDefinedData(e,t={},s,a=te(!0)){if(me.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const n=new ArrayBuffer(16),u=new Uint8Array(n);a.getRandomValues(u),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),t.iterationCount===void 0&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new Me),s){case 1:{const n=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),u=new Bt({version:4,kekid:new es({keyIdentifier:new H({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new T({algorithmId:n,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new Mt({variant:3,value:u}))}break;case 2:{const n=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),u=new ArrayBuffer(64),o=new Uint8Array(u);a.getRandomValues(o);const l=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),i=new ht({salt:new H({valueHex:u}),iterationCount:t.iterationCount,prf:new T({algorithmId:l,algorithmParams:new Me})}),c=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),m=new Kt({version:0,keyDerivationAlgorithm:new T({algorithmId:n,algorithmParams:i.toSchema()}),keyEncryptionAlgorithm:new T({algorithmId:c,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new Mt({variant:4,value:m}))}break;default:throw new Error('Unknown value for "variant": '.concat(s))}}addRecipientByKeyIdentifier(e,t,s,a=te(!0)){const n=Object.assign({},Wd,s||{}),u=new ps({variant:2,value:new cs({subjectKeyIdentifier:new H({valueHex:t})})});this._addKeyAgreeRecipientInfo(u,n,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,s,a=te(!0)){const n=new $s({rid:e}),u=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),o=new T({algorithmId:u}),l=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),i=new ArrayBuffer(64),c=new Uint8Array(i);a.getRandomValues(c);const m={version:3,ukm:new H({valueHex:i}),keyEncryptionAlgorithm:new T({algorithmId:l,algorithmParams:o.toSchema()}),recipientEncryptedKeys:new sa({encryptedKeys:[n]})},h=new Ct(Object.assign(m,s));this.recipientInfos.push(new Mt({variant:2,value:h}))}async encrypt(e,t,s=te(!0)){const a=new ArrayBuffer(16),n=new Uint8Array(a);s.getRandomValues(n);const u=new Uint8Array(t),o=s.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),l=await s.generateKey(e,!0,["encrypt"]),i=await s.encrypt({name:e.name,iv:n},l,u),c=await s.exportKey("raw",l);this.version=2,this.encryptedContentInfo=new Pe({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new T({algorithmId:o,algorithmParams:new H({valueHex:a})}),encryptedContent:new H({valueHex:i})});const m=async w=>{const b=this.recipientInfos[w].value;let f,v;if(b.recipientPublicKey)f=b.recipientPublicKey.algorithm.namedCurve,v=b.recipientPublicKey;else if(b.recipientCertificate){const z=b.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(z.constructor.blockName()!==W.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(w));switch(z.valueBlock.toString()){case"1.2.840.10045.3.1.7":f="P-256";break;case"1.3.132.0.34":f="P-384";break;case"1.3.132.0.35":f="P-521";break;default:throw new Error("Incorrect curve OID for index ".concat(w))}v=await b.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:f},usages:[]}},s)}else throw new Error("Unsupported RecipientInfo");const k=K1[f],N=await s.generateKey({name:"ECDH",namedCurve:f},!0,["deriveBits"]),S=await s.exportKey("spki",N.publicKey),x=await s.deriveBits({name:"ECDH",public:v},N.privateKey,k),C=new T({schema:b.keyEncryptionAlgorithm.algorithmParams}),I=s.getAlgorithmByOID(C.algorithmId,!0,"aesKWAlgorithm");let P=I.length;const B=new ArrayBuffer(4),D=new Uint8Array(B);for(let z=3;z>=0;z--)D[z]=P,P>>=8;const V=new Ps({keyInfo:new T({algorithmId:C.algorithmId}),entityUInfo:b.ukm,suppPubInfo:new H({valueHex:B})}).toSchema().toBER(!1),K=s.getAlgorithmByOID(b.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),M=await Dd(K.kdf,x,I.length,V,s),Q=await s.importKey("raw",M,{name:"AES-KW"},!0,["wrapKey"]),ne=await s.wrapKey("raw",l,Q,{name:"AES-KW"}),Z=new Hs;return Z.variant=3,Z.value=js.fromBER(S),b.originator=Z,b.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new H({valueHex:ne}),{ecdhPrivateKey:N.privateKey}},h=async w=>{const b=this.recipientInfos[w].value,f=s.getAlgorithmByOID(b.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(f.name==="RSA-OAEP"){const v=b.keyEncryptionAlgorithm.algorithmParams,k=new gt({schema:v});if(f.hash=s.getAlgorithmByOID(k.hashAlgorithm.algorithmId),!("name"in f.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(k.hashAlgorithm.algorithmId))}try{const v=await b.recipientCertificate.getPublicKey({algorithm:{algorithm:f,usages:["encrypt","wrapKey"]}},s),k=await s.encrypt(v.algorithm,v,c);b.encryptedKey=new H({valueHex:k})}catch(v){}},g=async w=>{const b=this.recipientInfos[w].value,f=s.getAlgorithmByOID(b.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),v=await s.importKey("raw",new Uint8Array(b.preDefinedKEK),f,!0,["wrapKey"]),k=await s.wrapKey("raw",l,v,f);b.encryptedKey=new H({valueHex:k})},p=async w=>{const b=this.recipientInfos[w].value;let f;if(!b.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!b.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{f=new ht({schema:b.keyDerivationAlgorithm.algorithmParams})}catch(B){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const v=new Uint8Array(b.password),k=await s.importKey("raw",v,"PBKDF2",!1,["deriveKey"]),N=s.getAlgorithmByOID(b.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let S="SHA-1";f.prf&&(S=s.getAlgorithmByOID(f.prf.algorithmId,!0,"prfAlgorithm").hash.name);const x=new Uint8Array(f.salt.valueBlock.valueHex),C=f.iterationCount,I=await s.deriveKey({name:"PBKDF2",hash:{name:S},salt:x,iterations:C},k,N,!0,["wrapKey"]),P=await s.wrapKey("raw",l,I,N);b.encryptedKey=new H({valueHex:P})},y=[];for(let w=0;w<this.recipientInfos.length;w++)switch(this.recipientInfos[w].variant){case 1:y.push(await h(w));break;case 2:y.push(await m(w));break;case 3:y.push(await g(w));break;case 4:y.push(await p(w));break;default:throw new Error("Unknown recipient type in array with index ".concat(w))}return y}async decrypt(e,t,s=te(!0)){const a=t||{};if(e+1>this.recipientInfos.length)throw new Error('Maximum value for "index" is: '.concat(this.recipientInfos.length-1));const n=async y=>{const w=this.recipientInfos[y].value;let b,f,v;const k=w.originator;if(a.recipientCertificate){const M=a.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(M.constructor.blockName()!==W.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(y));b=M.valueBlock.toString()}else if(k.value.algorithm.algorithmParams){const M=k.value.algorithm.algorithmParams;if(M.constructor.blockName()!==W.blockName())throw new Error("Incorrect originator for index ".concat(y));b=M.valueBlock.toString()}else throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(b){case"1.2.840.10045.3.1.7":f="P-256",v=256;break;case"1.3.132.0.34":f="P-384",v=384;break;case"1.3.132.0.35":f="P-521",v=528;break;default:throw new Error("Incorrect curve OID for index ".concat(y))}let N,S=s;ge.isBufferSource(a.recipientPrivateKey)?N=await s.importKey("pkcs8",a.recipientPrivateKey,{name:"ECDH",namedCurve:f},!0,["deriveBits"]):(N=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(S=a.crypto.subtle)),"algorithmParams"in k.value.algorithm||(k.value.algorithm.algorithmParams=new W({value:b}));const x=k.value.toSchema().toBER(!1),C=await s.importKey("spki",x,{name:"ECDH",namedCurve:f},!0,[]),I=await S.deriveBits({name:"ECDH",public:C},N,v);async function P(M){M=M||!1;const Q=new T({schema:w.keyEncryptionAlgorithm.algorithmParams}),ne=s.getAlgorithmByOID(Q.algorithmId,!0,"kwAlgorithm");let Z=ne.length;const z=new ArrayBuffer(4),q=new Uint8Array(z);for(let oe=3;oe>=0;oe--)q[oe]=Z,Z>>=8;const G={algorithmId:Q.algorithmId};M&&(G.algorithmParams=new Me);const F=new Ps({keyInfo:new T(G),entityUInfo:w.ukm,suppPubInfo:new H({valueHex:z})}).toSchema().toBER(!1),se=s.getAlgorithmByOID(w.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!se.name)throw new Error("Incorrect OID for key encryption algorithm: ".concat(w.keyEncryptionAlgorithm.algorithmId));return Dd(se.kdf,I,ne.length,F,s)}const B=await P(),D=async M=>s.importKey("raw",M,{name:"AES-KW"},!0,["unwrapKey"]),V=await D(B),K=async M=>{const Q=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,ne=s.getAlgorithmByOID(Q,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",w.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,M,{name:"AES-KW"},ne,!0,["decrypt"])};try{return await K(V)}catch(M){const Q=await P(!0),ne=await D(Q);return K(ne)}},u=async y=>{const w=this.recipientInfos[y].value;if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const b=s.getAlgorithmByOID(w.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(b.name==="RSA-OAEP"){const x=w.keyEncryptionAlgorithm.algorithmParams,C=new gt({schema:x});if(b.hash=s.getAlgorithmByOID(C.hashAlgorithm.algorithmId),!("name"in b.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(C.hashAlgorithm.algorithmId))}let f,v=s;ge.isBufferSource(a.recipientPrivateKey)?f=await s.importKey("pkcs8",a.recipientPrivateKey,b,!0,["decrypt"]):(f=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(v=a.crypto.subtle));const k=await v.decrypt(f.algorithm,f,w.encryptedKey.valueBlock.valueHexView),N=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,S=s.getAlgorithmByOID(N,!0,"contentEncryptionAlgorithm");if(!("name"in S))throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(N));return s.importKey("raw",k,S,!0,["decrypt"])},o=async y=>{const w=this.recipientInfos[y].value;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const b=s.getAlgorithmByOID(w.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),f=await s.importKey("raw",a.preDefinedData,b,!0,["unwrapKey"]),v=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,k=s.getAlgorithmByOID(v,!0,"contentEncryptionAlgorithm");if(!k.name)throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(v));return s.unwrapKey("raw",w.encryptedKey.valueBlock.valueHexView,f,b,k,!0,["decrypt"])},l=async y=>{const w=this.recipientInfos[y].value;let b;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!w.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!w.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{b=new ht({schema:w.keyDerivationAlgorithm.algorithmParams})}catch(P){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const f=await s.importKey("raw",a.preDefinedData,"PBKDF2",!1,["deriveKey"]),v=s.getAlgorithmByOID(w.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),k=b.prf?s.getAlgorithmByOID(b.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",N=new Uint8Array(b.salt.valueBlock.valueHex),S=b.iterationCount,x=await s.deriveKey({name:"PBKDF2",hash:{name:k},salt:N,iterations:S},f,v,!0,["unwrapKey"]),C=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,I=s.getAlgorithmByOID(C,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",w.encryptedKey.valueBlock.valueHexView,x,v,I,!0,["decrypt"])};let i;switch(this.recipientInfos[e].variant){case 1:i=await u(e);break;case 2:i=await n(e);break;case 3:i=await o(e);break;case 4:i=await l(e);break;default:throw new Error("Unknown recipient type in array with index ".concat(e))}const c=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,m=s.getAlgorithmByOID(c,!0,"contentEncryptionAlgorithm"),h=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,g=new Uint8Array(h);if(!this.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const p=this.encryptedContentInfo.getEncryptedContent();return s.decrypt({name:m.name,iv:g},i,p)}}Qt.CLASS_NAME="EnvelopedData";const jn="safeContents",Mo="parsedValue",Gd="contentInfos";class Vn extends j{constructor(e={}){super(),this.safeContents=d(e,jn,Vn.defaultValues(jn)),Mo in e&&(this.parsedValue=d(e,Mo,Vn.defaultValues(Mo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case jn:return[];case Mo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case jn:return t.length===0;case Mo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new ee({name:t.contentInfos||A,value:pe.schema()})]})}fromSchema(e){$(e,[Gd]);const t=U(e,e,Vn.schema({names:{contentInfos:Gd}}));L.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,s=>new pe({schema:s}))}toSchema(){return new E({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=te(!0)){if(ie.assert(e,jn),me.assert(e.safeContents,jn,"Array"),e.safeContents.length!==this.safeContents.length)throw new me('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');this.parsedValue={safeContents:[]};for(const[s,a]of this.safeContents.entries()){const n=e.safeContents[s],u="parameters.safeContents[".concat(s,"]");switch(a.contentType){case cp:{me.assert(a.content,"this.safeContents[j].content",H);const o=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:Ls.fromBER(o)})}break;case iw:{const o=new Qt({schema:a.content});ie.assert(u,n,"recipientCertificate","recipientKey");const l=n,i=l.recipientCertificate,c=l.recipientKey,m=await o.decrypt(0,{recipientCertificate:i,recipientPrivateKey:c},t);this.parsedValue.safeContents.push({privacyMode:2,value:Ls.fromBER(m)})}break;case ow:{const o=new ms({schema:a.content});ie.assert(u,n,"password");const l=n.password,i=await o.decrypt({password:l},t);this.parsedValue.safeContents.push({privacyMode:1,value:Ls.fromBER(i)})}break;default:throw new Error('Unknown "contentType" for AuthenticatedSafe: " '.concat(a.contentType))}}}async makeInternalValues(e,t=te(!0)){if(!this.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(me.assert(this.parsedValue,"this.parsedValue","object"),me.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),me.assert(e,"parameters","object"),ie.assert(e,"safeContents"),me.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new me('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');this.safeContents=[];for(const[s,a]of this.parsedValue.safeContents.entries())switch(ie.assert("content",a,"privacyMode","value"),me.assert(a.value,"content.value",Ls),a.privacyMode){case 0:{const n=a.value.toSchema().toBER(!1);this.safeContents.push(new pe({contentType:"1.2.840.113549.1.7.1",content:new H({valueHex:n})}))}break;case 1:{const n=new ms,u=e.safeContents[s];u.contentToEncrypt=a.value.toSchema().toBER(!1),await n.encrypt(u,t),this.safeContents.push(new pe({contentType:"1.2.840.113549.1.7.6",content:n.toSchema()}))}break;case 2:{const n=new Qt,u=a.value.toSchema().toBER(!1),o=e.safeContents[s];switch(ie.assert("parameters.safeContents[".concat(s,"]"),o,"encryptingCertificate","encryptionAlgorithm"),!0){case o.encryptionAlgorithm.name.toLowerCase()==="aes-cbc":case o.encryptionAlgorithm.name.toLowerCase()==="aes-gcm":break;default:throw new Error('Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": '.concat(o.encryptionAlgorithm))}switch(!0){case o.encryptionAlgorithm.length===128:case o.encryptionAlgorithm.length===192:case o.encryptionAlgorithm.length===256:break;default:throw new Error('Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": '.concat(o.encryptionAlgorithm.length))}const l=o.encryptionAlgorithm;n.addRecipientByCertificate(o.encryptingCertificate,{},void 0,t),await n.encrypt(l,u,t),this.safeContents.push(new pe({contentType:"1.2.840.113549.1.7.3",content:n.toSchema()}))}break;default:throw new Error('Incorrect value for "content.privacyMode": '.concat(a.privacyMode))}return this}}Vn.CLASS_NAME="AuthenticatedSafe";const Qa="hashAlgorithm",Pi="issuerNameHash",Oi="issuerKeyHash",Za="serialNumber",H1=[Qa,Pi,Oi,Za];class De extends j{static async create(e,t,s=te(!0)){const a=new De;return await a.createForCertificate(e,t,s),a}constructor(e={}){super(),this.hashAlgorithm=d(e,Qa,De.defaultValues(Qa)),this.issuerNameHash=d(e,Pi,De.defaultValues(Pi)),this.issuerKeyHash=d(e,Oi,De.defaultValues(Oi)),this.serialNumber=d(e,Za,De.defaultValues(Za)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qa:return new T;case Pi:case Oi:return new H;case Za:return new R;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qa:return t.algorithmId===A&&!("algorithmParams"in t);case Pi:case Oi:case Za:return t.isEqual(De.defaultValues(Za));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[T.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||A}}),new H({name:t.issuerNameHash||A}),new H({name:t.issuerKeyHash||A}),new R({name:t.serialNumber||A})]})}fromSchema(e){$(e,H1);const t=U(e,e,De.schema({names:{hashAlgorithm:Qa,issuerNameHash:Pi,issuerKeyHash:Oi,serialNumber:Za}}));L.assertSchema(t,this.className),this.hashAlgorithm=new T({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new E({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!ge.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!ge.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,s=te(!0)){ie.assert(t,Qa,"issuerCertificate");const a=s.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new T({algorithmId:a,algorithmParams:new Me});const n=t.issuerCertificate;this.serialNumber=e.serialNumber;const u=await s.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1));this.issuerNameHash=new H({valueHex:u});const o=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,l=await s.digest({name:t.hashAlgorithm},o);this.issuerKeyHash=new H({valueHex:l})}}De.CLASS_NAME="CertID";const Di="certID",Ti="certStatus",Ri="thisUpdate",Or="nextUpdate",en="singleExtensions",M1=[Di,Ti,Ri,Or,en];class Zt extends j{constructor(e={}){super(),this.certID=d(e,Di,Zt.defaultValues(Di)),this.certStatus=d(e,Ti,Zt.defaultValues(Ti)),this.thisUpdate=d(e,Ri,Zt.defaultValues(Ri)),Or in e&&(this.nextUpdate=d(e,Or,Zt.defaultValues(Or))),en in e&&(this.singleExtensions=d(e,en,Zt.defaultValues(en))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Di:return new De;case Ti:return{};case Ri:case Or:return new Date(0,0,0);case en:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Di:return De.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&De.compareWithDefault("issuerNameHash",t.issuerNameHash)&&De.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&De.compareWithDefault("serialNumber",t.serialNumber);case Ti:return Object.keys(t).length===0;case Ri:case Or:return t===Zt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[De.schema(t.certID||{}),new Ne({value:[new _({name:t.certStatus||A,idBlock:{tagClass:3,tagNumber:0}}),new O({name:t.certStatus||A,idBlock:{tagClass:3,tagNumber:1},value:[new ke,new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new zu]})]}),new _({name:t.certStatus||A,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new ke({name:t.thisUpdate||A}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ke({name:t.nextUpdate||A})]}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[je.schema(t.singleExtensions||{})]})]})}fromSchema(e){$(e,M1);const t=U(e,e,Zt.schema({names:{certID:{names:{blockName:Di}},certStatus:Ti,thisUpdate:Ri,nextUpdate:Or,singleExtensions:{names:{blockName:en}}}}));L.assertSchema(t,this.className),this.certID=new De({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),Or in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),en in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,s=>new Oe({schema:s})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new ke({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[new ke({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new E({value:Array.from(this.singleExtensions,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}Zt.CLASS_NAME="SingleResponse";const Dc="tbs",tn="version",Su="responderID",Nu="producedAt",ku="responses",Li="responseExtensions",On="ResponseData",Xc="".concat(On,".").concat(tn),ji="".concat(On,".").concat(Su),kf="".concat(On,".").concat(Nu),Cf="".concat(On,".").concat(ku),_c="".concat(On,".").concat(Li),J1=[On,Xc,ji,kf,Cf,_c];class Ge extends j{get tbs(){return ge.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,Dc,Ge.defaultValues(Dc))),tn in e&&(this.version=d(e,tn,Ge.defaultValues(tn))),this.responderID=d(e,Su,Ge.defaultValues(Su)),this.producedAt=d(e,Nu,Ge.defaultValues(Nu)),this.responses=d(e,ku,Ge.defaultValues(ku)),Li in e&&(this.responseExtensions=d(e,Li,Ge.defaultValues(Li))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tn:return 0;case Dc:return Le;case Su:return{};case Nu:return new Date(0,0,0);case ku:case Li:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Dc:return t.byteLength===0;case Su:return Object.keys(t).length===0;case Nu:return t===Ge.defaultValues(e);case ku:case Li:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||On,value:[new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new R({name:t.version||Xc})]}),new Ne({value:[new O({name:t.responderID||ji,idBlock:{tagClass:3,tagNumber:1},value:[fe.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new O({name:t.responderID||ji,idBlock:{tagClass:3,tagNumber:2},value:[new H({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new ke({name:t.producedAt||kf}),new E({value:[new ee({name:Cf,value:Zt.schema(t.response||{})})]}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[je.schema(t.extensions||{names:{blockName:_c}})]})]})}fromSchema(e){$(e,J1);const t=U(e,e,Ge.schema());L.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,Xc in t.result&&(this.version=t.result[Xc].valueBlock.valueDec),t.result[ji].idBlock.tagNumber===1?this.responderID=new fe({schema:t.result[ji].valueBlock.value[0]}):this.responderID=t.result[ji].valueBlock.value[0],this.producedAt=t.result[kf].toDate(),this.responses=Array.from(t.result[Cf],s=>new Zt({schema:s})),_c in t.result&&(this.responseExtensions=Array.from(t.result[_c].valueBlock.value,s=>new Oe({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return Ge.schema();const s=Re(this.tbsView);L.assert(s,"TBS Response Data"),t=s.result}else{const s=[];tn in this&&s.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[new R({value:this.version})]})),this.responderID instanceof fe?s.push(new O({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):s.push(new O({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),s.push(new ke({valueDate:this.producedAt})),s.push(new E({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&s.push(new O({idBlock:{tagClass:3,tagNumber:1},value:[new E({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new E({value:s})}return t}toJSON(){const e={};return tn in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}Ge.CLASS_NAME="ResponseData";const Gm="trustedCerts",zm="certs",Xm="crls",_m="ocsps",Ym="checkDate",Qm="findOrigin",Zm="findIssuer";var mn;(function(r){r[r.unknown=-1]="unknown",r[r.success=0]="success",r[r.noRevocation=11]="noRevocation",r[r.noPath=60]="noPath",r[r.noValidPath=97]="noValidPath"})(mn||(mn={}));class Jr extends Error{constructor(e,t){super(t),this.name=Jr.NAME,this.code=e,this.message=t}}Jr.NAME="ChainValidationError";function F1(r,e){for(let t=0;t<e.length;t++)if(ge.isEqual(r.tbsView,e[t].tbsView))return!0;return!1}class Wh{constructor(e={}){this.trustedCerts=d(e,Gm,this.defaultValues(Gm)),this.certs=d(e,zm,this.defaultValues(zm)),this.crls=d(e,Xm,this.defaultValues(Xm)),this.ocsps=d(e,_m,this.defaultValues(_m)),this.checkDate=d(e,Ym,this.defaultValues(Ym)),this.findOrigin=d(e,Qm,this.defaultValues(Qm)),this.findIssuer=d(e,Zm,this.defaultValues(Zm))}static defaultFindOrigin(e,t){e.tbsView.byteLength===0&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));for(const s of t.certs)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),ge.isEqual(e.tbsView,s.tbsView))return"Intermediate Certificates";for(const s of t.trustedCerts)if(s.tbsView.byteLength===0&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),ge.isEqual(e.tbsView,s.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,s=te(!0)){const a=[];let n=null,u=null,o=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,s))return[e]}catch(i){}if(e.extensions){for(const i of e.extensions)if(i.extnID===lp&&i.parsedValue instanceof zr){i.parsedValue.keyIdentifier?n=i.parsedValue.keyIdentifier:(i.parsedValue.authorityCertIssuer&&(u=i.parsedValue.authorityCertIssuer),i.parsedValue.authorityCertSerialNumber&&(o=i.parsedValue.authorityCertSerialNumber));break}}function l(i){if(n!==null&&i.extensions){let m=!1;for(const h of i.extensions)if(h.extnID===zb&&h.parsedValue){m=!0,ge.isEqual(h.parsedValue.valueBlock.valueHex,n.valueBlock.valueHexView)&&a.push(i);break}if(m)return}let c=!1;o!==null&&(c=i.serialNumber.isEqual(o)),u!==null?i.subject.isEqual(u)&&c&&a.push(i):e.issuer.isEqual(i.subject)&&a.push(i)}for(const i of t.trustedCerts)l(i);for(const i of t.certs)l(i);for(let i=a.length-1;i>=0;i--)try{await e.verify(a[i],s)===!1&&a.splice(i,1)}catch(c){a.splice(i,1)}return a}defaultValues(e){switch(e){case Gm:return[];case zm:return[];case Xm:return[];case _m:return[];case Ym:return new Date;case Qm:return Wh.defaultFindOrigin;case Zm:return this.defaultFindIssuer;default:throw new Error("Invalid member name for CertificateChainValidationEngine class: ".concat(e))}}async sort(e=!1,t=te(!0)){const s=[],a=async(p,y)=>{const w=[];function b(v){let k=!0;for(let N=0;N<v.length;N++){for(let S=0;S<v.length;S++)if(S!==N&&v[N]===v[S]){k=!1;break}if(!k)break}return k}if(F1(p,this.trustedCerts))return[[p]];const f=await this.findIssuer(p,this,y);if(f.length===0)throw new Error("No valid certificate paths found");for(let v=0;v<f.length;v++){if(ge.isEqual(f[v].tbsView,p.tbsView)){w.push([f[v]]);continue}const k=await a(f[v],y);for(let N=0;N<k.length;N++){const S=k[N].slice();S.splice(0,0,f[v]),b(S)?w.push(S):w.push(k[N])}}return w},n=async p=>{const y=[],w=[],b=[];if(y.push(...s.filter(f=>p.issuer.isEqual(f.subject))),y.length===0)return{status:1,statusMessage:"No certificate's issuers"};if(w.push(...this.crls.filter(f=>f.issuer.isEqual(p.issuer))),w.length===0)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let f=0;f<w.length;f++){const v=w[f];if(!(v.nextUpdate&&v.nextUpdate.value<this.checkDate))for(let k=0;k<y.length;k++)try{if(await w[f].verify({issuerCertificate:y[k]},t)){b.push({crl:w[f],certificate:y[k]});break}}catch(N){}}return b.length?{status:0,statusMessage:A,result:b}:{status:3,statusMessage:"No valid CRLs found"}},u=async(p,y)=>{const w=t.getAlgorithmByOID(p.signatureAlgorithm.algorithmId);if(!w.name||!w.hash)return 1;for(let b=0;b<this.ocsps.length;b++){const f=await this.ocsps[b].getCertificateStatus(p,y,t);if(f.isForCertificate)return f.status===0?0:1}return 2};async function o(p,y=!1){let w=!1,b=!1,f=!1,v=!1;if(p.extensions){for(let k=0;k<p.extensions.length;k++){const N=p.extensions[k];if(N.critical&&!N.parsedValue)return{result:!1,resultCode:6,resultMessage:"Unable to parse critical certificate extension: ".concat(N.extnID)};if(N.extnID===Xb){f=!0;const S=new Uint8Array(N.parsedValue.valueBlock.valueHex);(S[0]&4)===4&&(b=!0),(S[0]&2)===2&&(v=!0)}N.extnID===ip&&"cA"in N.parsedValue&&N.parsedValue.cA===!0&&(w=!0)}if(b===!0&&w===!1)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(f===!0&&w===!0&&b===!1)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(w===!0&&f===!0&&y&&v===!1)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return w===!1?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:A}}const l=async(p,y)=>{for(let w=0;w<p.length;w++)if(p[w].notBefore.value>y||p[w].notAfter.value<y)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(p.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let w=p.length-2;w>=0;w--)if(p[w].issuer.isEqual(p[w].subject)===!1&&p[w].issuer.isEqual(p[w+1].subject)===!1)return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(this.crls.length!==0||this.ocsps.length!==0)for(let w=0;w<p.length-1;w++){let b=2,f={status:0,statusMessage:A};if(this.ocsps.length!==0)switch(b=await u(p[w],p[w+1]),b){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(this.crls.length!==0){if(f=await n(p[w]),f.status===0&&f.result)for(let v=0;v<f.result.length;v++){if(f.result[v].crl.isCertificateRevoked(p[w]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if((await o(f.result[v].certificate,!0)).result===!1)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(e===!1)throw new Jr(mn.noRevocation,"No revocation values found for one of certificates: ".concat(f.statusMessage))}else if(b===2)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(b===2&&f.status===2&&e){const v=p[w+1];let k=!1;if(v.extensions)for(const N of v.extensions)switch(N.extnID){case tw:case op:case up:k=!0;break}if(k)throw new Jr(mn.noRevocation,"No revocation values found for one of certificates: ".concat(f.statusMessage))}}for(const[w,b]of p.entries())if(w&&!(await o(b)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}};s.push(...this.trustedCerts),s.push(...this.certs);for(let p=0;p<s.length;p++)for(let y=0;y<s.length;y++)if(p!==y&&ge.isEqual(s[p].tbsView,s[y].tbsView)){s.splice(y,1),p=0;break}const i=s[s.length-1];let c;const m=[i];if(c=await a(i,t),c.length===0)throw new Jr(mn.noPath,"Unable to find certificate path");for(let p=c.length-1;p>=0;p--){let y=!1;for(let w=0;w<c[p].length;w++){const b=c[p][w];for(let f=0;f<this.trustedCerts.length;f++)if(ge.isEqual(b.tbsView,this.trustedCerts[f].tbsView)){y=!0;break}if(y)break}y||c.splice(p,1)}if(c.length===0)throw new Jr(mn.noValidPath,"No valid certificate paths found");let h=c[0].length,g=0;for(let p=0;p<c.length;p++)c[p].length<h&&(h=c[p].length,g=p);for(let p=0;p<c[g].length;p++)m.push(c[g][p]);if(c=await l(m,this.checkDate),c.result===!1)throw c;return m}async verify(e={},t=te(!0)){function s(l,i){const c=Ur(l),m=Ur(i),h=c.split("."),g=m.split("."),p=h.length,y=g.length;if(p===0||y===0||p<y)return!1;for(let w=0;w<p;w++)if(h[w].length===0)return!1;for(let w=0;w<y;w++)if(g[w].length===0){if(w===0){if(y===1)return!1;continue}return!1}for(let w=0;w<y;w++)if(g[y-1-w].length!==0&&h[p-1-w].localeCompare(g[y-1-w])!==0)return!1;return!0}function a(l,i){const c=Ur(l),m=Ur(i),h=c.split("@"),g=m.split("@");if(h.length===0||g.length===0||h.length<g.length)return!1;if(g.length===1){if(s(h[1],g[0])){const p=h[1].split("."),y=g[0].split(".");return y[0].length===0?!0:p.length===y.length}return!1}return c.localeCompare(m)===0}function n(l,i){let c=Ur(l);const m=Ur(i),h=c.split("/");if(m.split("/").length>1)return!1;if(h.length>1){for(let g=0;g<h.length;g++)if(h[g].length>0&&h[g].charAt(h[g].length-1)!==":"){c=h[g].split(":")[0];break}}if(s(c,m)){const g=c.split("."),p=m.split(".");return p[0].length===0?!0:g.length===p.length}return!1}function u(l,i){const c=l.valueBlock.valueHexView,m=i.valueBlock.valueHexView;if(c.length===4&&m.length===8){for(let h=0;h<4;h++)if((c[h]^m[h])&m[h+4])return!1;return!0}if(c.length===16&&m.length===32){for(let h=0;h<16;h++)if((c[h]^m[h])&m[h+16])return!1;return!0}return!1}function o(l,i){if(l.typesAndValues.length===0||i.typesAndValues.length===0)return!0;if(l.typesAndValues.length<i.typesAndValues.length)return!1;let c=!0,m=0;for(let h=0;h<i.typesAndValues.length;h++){let g=!1;for(let p=m;p<l.typesAndValues.length;p++)if(g=l.typesAndValues[p].isEqual(i.typesAndValues[h]),l.typesAndValues[p].type===i.typesAndValues[h].type&&(c=c&&g),g===!0)if(m===0||m===p){m=p+1;break}else return!1;if(g===!1)return!1}return m===0?!1:c}try{if(this.certs.length===0)throw new Error("Empty certificate array");const l=e.passedWhenNotRevValues||!1,i=e.initialPolicySet||[jt],c=e.initialExplicitPolicy||!1,m=e.initialPolicyMappingInhibit||!1,h=e.initialInhibitPolicy||!1,g=e.initialPermittedSubtreesSet||[],p=e.initialExcludedSubtreesSet||[],y=e.initialRequiredNameForms||[];let w=c,b=m,f=h;const v=[!1,!1,!1];let k=0,N=0,S=0,x=g,C=p;const I=y;let P=1;this.certs=await this.sort(l,t);const B=[];B.push(jt);const D=[],V=new Array(this.certs.length-1);for(let q=0;q<this.certs.length-1;q++)V[q]=!0;D.push(V);const K=new Array(this.certs.length-1),M=new Array(this.certs.length-1);let Q=w?this.certs.length-1:-1;for(let q=this.certs.length-2;q>=0;q--,P++){const G=this.certs[q];if(G.extensions){for(let F=0;F<G.extensions.length;F++){const se=G.extensions[F];if(se.extnID===sw){M[q]=se.parsedValue;for(let oe=0;oe<B.length;oe++)if(B[oe]===jt){delete D[oe][q];break}for(let oe=0;oe<se.parsedValue.certificatePolicies.length;oe++){let xe=-1;const Gt=se.parsedValue.certificatePolicies[oe].policyIdentifier;for(let Ie=0;Ie<B.length;Ie++)if(Gt===B[Ie]){xe=Ie;break}if(xe===-1){B.push(Gt);const Ie=new Array(this.certs.length-1);Ie[q]=!0,D.push(Ie)}else D[xe][q]=!0}}if(se.extnID===rw){if(b)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};K[q]=se.parsedValue}se.extnID===aw&&w===!1&&(se.parsedValue.requireExplicitPolicy===0?(w=!0,Q=q):v[0]===!1?(v[0]=!0,k=se.parsedValue.requireExplicitPolicy):k=k>se.parsedValue.requireExplicitPolicy?se.parsedValue.requireExplicitPolicy:k,se.parsedValue.inhibitPolicyMapping===0?b=!0:v[1]===!1?(v[1]=!0,N=se.parsedValue.inhibitPolicyMapping+1):N=N>se.parsedValue.inhibitPolicyMapping+1?se.parsedValue.inhibitPolicyMapping+1:N),se.extnID===r0&&f===!1&&(se.parsedValue.valueBlock.valueDec===0?f=!0:v[2]===!1?(v[2]=!0,S=se.parsedValue.valueBlock.valueDec):S=S>se.parsedValue.valueBlock.valueDec?se.parsedValue.valueBlock.valueDec:S)}if(f===!0){let F=-1;for(let se=0;se<B.length;se++)if(B[se]===jt){F=se;break}F!==-1&&delete D[0][q]}w===!1&&v[0]===!0&&(k--,k===0&&(w=!0,Q=q,v[0]=!1)),b===!1&&v[1]===!0&&(N--,N===0&&(b=!0,v[1]=!1)),f===!1&&v[2]===!0&&(S--,S===0&&(f=!0,v[2]=!1))}}for(let q=0;q<this.certs.length-1;q++)if(q<this.certs.length-2&&typeof K[q+1]<"u")for(let G=0;G<K[q+1].mappings.length;G++){if(K[q+1].mappings[G].issuerDomainPolicy===jt||K[q+1].mappings[G].subjectDomainPolicy===jt)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let F=-1,se=-1;for(let oe=0;oe<B.length;oe++)B[oe]===K[q+1].mappings[G].issuerDomainPolicy&&(F=oe),B[oe]===K[q+1].mappings[G].subjectDomainPolicy&&(se=oe);typeof D[F][q]<"u"&&delete D[F][q];for(let oe=0;oe<M[q].certificatePolicies.length;oe++)if(K[q+1].mappings[G].subjectDomainPolicy===M[q].certificatePolicies[oe].policyIdentifier&&F!==-1&&se!==-1)for(let xe=0;xe<=q;xe++)typeof D[se][xe]<"u"&&(D[F][xe]=!0,delete D[se][xe])}for(let q=0;q<B.length;q++)if(B[q]===jt)for(let G=0;G<Q;G++)delete D[q][G];const ne=[];for(let q=0;q<D.length;q++){let G=!0;for(let F=0;F<this.certs.length-1;F++){let se=!1;if(F<Q&&B[q]===jt&&B.length>1){G=!1;break}if(typeof D[q][F]>"u"){if(F>=Q){for(let oe=0;oe<B.length;oe++)if(B[oe]===jt){D[oe][F]===!0&&(se=!0);break}}if(!se){G=!1;break}}}G===!0&&ne.push(B[q])}let Z=[];if(i.length===1&&i[0]===jt&&w===!1)Z=i;else if(ne.length===1&&ne[0]===jt)Z=i;else for(let q=0;q<ne.length;q++)for(let G=0;G<i.length;G++)if(i[G]===ne[q]||i[G]===jt){Z.push(ne[q]);break}const z={result:Z.length>0,resultCode:0,resultMessage:Z.length>0?A:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:ne,userConstrPolicies:Z,explicitPolicyIndicator:w,policyMappings:K,certificatePath:this.certs};if(Z.length===0||z.result===!1)return z;P=1;for(let q=this.certs.length-2;q>=0;q--,P++){const G=this.certs[q];let F=[],se=[],oe=[];if(G.extensions)for(let ce=0;ce<G.extensions.length;ce++){const X=G.extensions[ce];X.extnID===ew&&("permittedSubtrees"in X.parsedValue&&(se=se.concat(X.parsedValue.permittedSubtrees)),"excludedSubtrees"in X.parsedValue&&(oe=oe.concat(X.parsedValue.excludedSubtrees))),X.extnID===_g&&(F=F.concat(X.parsedValue.altNames))}let xe=I.length<=0;for(let ce=0;ce<I.length;ce++)switch(I[ce].base.type){case 4:{if(I[ce].base.value.typesAndValues.length!==G.subject.typesAndValues.length)continue;xe=!0;for(let X=0;X<G.subject.typesAndValues.length;X++)if(G.subject.typesAndValues[X].type!==I[ce].base.value.typesAndValues[X].type){xe=!1;break}if(xe===!0)break}break;default:}if(xe===!1)throw z.result=!1,z.resultCode=21,z.resultMessage="No necessary name form found",z;const Gt=[[],[],[],[],[]];for(let ce=0;ce<x.length;ce++)switch(x[ce].base.type){case 1:Gt[0].push(x[ce]);break;case 2:Gt[1].push(x[ce]);break;case 4:Gt[2].push(x[ce]);break;case 6:Gt[3].push(x[ce]);break;case 7:Gt[4].push(x[ce]);break;default:}for(let ce=0;ce<5;ce++){let X=!1,ia=!1;const Fs=Gt[ce];for(let qs=0;qs<Fs.length;qs++){switch(ce){case 0:if(F.length>0)for(let ye=0;ye<F.length;ye++)F[ye].type===1&&(ia=!0,X=X||a(F[ye].value,Fs[qs].base.value));else for(let ye=0;ye<G.subject.typesAndValues.length;ye++)(G.subject.typesAndValues[ye].type==="1.2.840.113549.1.9.1"||G.subject.typesAndValues[ye].type==="0.9.2342.19200300.100.1.3")&&(ia=!0,X=X||a(G.subject.typesAndValues[ye].value.valueBlock.value,Fs[qs].base.value));break;case 1:if(F.length>0)for(let ye=0;ye<F.length;ye++)F[ye].type===2&&(ia=!0,X=X||s(F[ye].value,Fs[qs].base.value));break;case 2:ia=!0,X=o(G.subject,Fs[qs].base.value);break;case 3:if(F.length>0)for(let ye=0;ye<F.length;ye++)F[ye].type===6&&(ia=!0,X=X||n(F[ye].value,Fs[qs].base.value));break;case 4:if(F.length>0)for(let ye=0;ye<F.length;ye++)F[ye].type===7&&(ia=!0,X=X||u(F[ye].value,Fs[qs].base.value));break;default:}if(X)break}if(X===!1&&Fs.length>0&&ia)throw z.result=!1,z.resultCode=41,z.resultMessage='Failed to meet "permitted sub-trees" name constraint',z}let Ie=!1;for(let ce=0;ce<C.length;ce++){switch(C[ce].base.type){case 1:if(F.length>=0)for(let X=0;X<F.length;X++)F[X].type===1&&(Ie=Ie||a(F[X].value,C[ce].base.value));else for(let X=0;X<G.subject.typesAndValues.length;X++)(G.subject.typesAndValues[X].type==="1.2.840.113549.1.9.1"||G.subject.typesAndValues[X].type==="0.9.2342.19200300.100.1.3")&&(Ie=Ie||a(G.subject.typesAndValues[X].value.valueBlock.value,C[ce].base.value));break;case 2:if(F.length>0)for(let X=0;X<F.length;X++)F[X].type===2&&(Ie=Ie||s(F[X].value,C[ce].base.value));break;case 4:Ie=Ie||o(G.subject,C[ce].base.value);break;case 6:if(F.length>0)for(let X=0;X<F.length;X++)F[X].type===6&&(Ie=Ie||n(F[X].value,C[ce].base.value));break;case 7:if(F.length>0)for(let X=0;X<F.length;X++)F[X].type===7&&(Ie=Ie||u(F[X].value,C[ce].base.value));break;default:}if(Ie)break}if(Ie===!0)throw z.result=!1,z.resultCode=42,z.resultMessage='Failed to meet "excluded sub-trees" name constraint',z;x=x.concat(se),C=C.concat(oe)}return z}catch(l){return l instanceof Error?l instanceof Jr?{result:!1,resultCode:l.code,resultMessage:l.message,error:l}:{result:!1,resultCode:mn.unknown,resultMessage:l.message,error:l}:l&&typeof l=="object"&&"resultMessage"in l?l:{result:!1,resultCode:-1,resultMessage:"".concat(l)}}}}const Yc="tbsResponseData",Cu="signatureAlgorithm",Eu="signature",$i="certs",nc="BasicOCSPResponse",Ef="".concat(nc,".").concat(Yc),xf="".concat(nc,".").concat(Cu),If="".concat(nc,".").concat(Eu),Qc="".concat(nc,".").concat($i),q1=[Ef,xf,If,Qc];class Jt extends j{constructor(e={}){super(),this.tbsResponseData=d(e,Yc,Jt.defaultValues(Yc)),this.signatureAlgorithm=d(e,Cu,Jt.defaultValues(Cu)),this.signature=d(e,Eu,Jt.defaultValues(Eu)),$i in e&&(this.certs=d(e,$i,Jt.defaultValues($i))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yc:return new Ge;case Cu:return new T;case Eu:return new ae;case $i:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let s=Ge.compareWithDefault("tbs",t.tbs)&&Ge.compareWithDefault("responderID",t.responderID)&&Ge.compareWithDefault("producedAt",t.producedAt)&&Ge.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(s=s&&Ge.compareWithDefault("responseExtensions",t.responseExtensions)),s}case Cu:return t.algorithmId===A&&!("algorithmParams"in t);case Eu:return t.isEqual(Jt.defaultValues(e));case $i:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||nc,value:[Ge.schema(t.tbsResponseData||{names:{blockName:Ef}}),T.schema(t.signatureAlgorithm||{names:{blockName:xf}}),new ae({name:t.signature||If}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new E({value:[new ee({name:Qc,value:le.schema(t.certs||{})})]})]})]})}fromSchema(e){$(e,q1);const t=U(e,e,Jt.schema());L.assertSchema(t,this.className),this.tbsResponseData=new Ge({schema:t.result[Ef]}),this.signatureAlgorithm=new T({schema:t.result[xf]}),this.signature=t.result[If],Qc in t.result&&(this.certs=Array.from(t.result[Qc],s=>new le({schema:s})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[new E({value:Array.from(this.certs,t=>t.toSchema())})]})),new E({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}async getCertificateStatus(e,t,s=te(!0)){const a={isForCertificate:!1,status:2},n={},u=[];for(const o of this.tbsResponseData.responses){const l=s.getAlgorithmByOID(o.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!n[l.name]){n[l.name]=1;const i=new De;u.push(i),await i.createForCertificate(e,{hashAlgorithm:l.name,issuerCertificate:t},s)}}for(const o of this.tbsResponseData.responses)for(const l of u)if(o.certID.isEqual(l)){a.isForCertificate=!0;try{switch(o.certStatus.idBlock.isConstructed){case!0:o.certStatus.idBlock.tagNumber===1&&(a.status=1);break;case!1:switch(o.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2;break;default:}break;default:}}catch(i){}return a}return a}async sign(e,t="SHA-1",s=te(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters.algorithm;if(!("name"in n))throw new Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());const u=await s.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:n});this.signature=new ae({valueHex:u})}async verify(e={},t=te(!0)){let s=null,a=-1;const n=e.trustedCerts||[];if(!this.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof fe:for(const[o,l]of this.certs.entries())if(l.subject.isEqual(this.tbsResponseData.responderID)){a=o;break}break;case this.tbsResponseData.responderID instanceof H:for(const[o,l]of this.certs.entries()){const i=await t.digest({name:"sha-1"},l.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(Gu(i,this.tbsResponseData.responderID.valueBlock.valueHex)){a=o;break}}break;default:throw new Error("Wrong value for responderID")}if(a===-1)throw new Error("Correct certificate was not found in OCSP response");s=this.certs[a];const u=[s];for(const o of this.certs){const l=await fw(o,s);l&&u.push(l)}if(!(await new Wh({certs:u,trustedCerts:n}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}Jt.CLASS_NAME="BasicOCSPResponse";const ef="tbs",tf="version",sf="subject",rf="subjectPublicKeyInfo",$n="attributes",xu="signatureAlgorithm",Iu="signatureValue",Eo="CertificationRequestInfo",yp="".concat(Eo,".version"),vp="".concat(Eo,".subject"),bp="".concat(Eo,".subjectPublicKeyInfo"),$h="".concat(Eo,".attributes"),W1=[Eo,yp,vp,bp,$h,xu,Iu];function G1(r={}){const e=d(r,"names",{});return new E({name:e.CertificationRequestInfo||Eo,value:[new R({name:e.CertificationRequestInfoVersion||yp}),fe.schema(e.subject||{names:{blockName:vp}}),Nt.schema({names:{blockName:bp}}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ee({optional:!0,name:e.CertificationRequestInfoAttributes||$h,value:we.schema(e.attributes||{})})]})]})}class Yt extends j{get tbs(){return ge.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,ef,Yt.defaultValues(ef))),this.version=d(e,tf,Yt.defaultValues(tf)),this.subject=d(e,sf,Yt.defaultValues(sf)),this.subjectPublicKeyInfo=d(e,rf,Yt.defaultValues(rf)),$n in e&&(this.attributes=d(e,$n,Yt.defaultValues($n))),this.signatureAlgorithm=d(e,xu,Yt.defaultValues(xu)),this.signatureValue=d(e,Iu,Yt.defaultValues(Iu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ef:return Le;case tf:return 0;case sf:return new fe;case rf:return new Nt;case $n:return[];case xu:return new T;case Iu:return new ae;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({value:[G1(t.certificationRequestInfo||{}),new E({name:t.signatureAlgorithm||xu,value:[new W,new Y({optional:!0})]}),new ae({name:t.signatureValue||Iu})]})}fromSchema(e){$(e,W1);const t=U(e,e,Yt.schema());L.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[yp].valueBlock.valueDec,this.subject=new fe({schema:t.result[vp]}),this.subjectPublicKeyInfo=new Nt({schema:t.result[bp]}),$h in t.result&&(this.attributes=Array.from(t.result[$h],s=>new we({schema:s}))),this.signatureAlgorithm=new T({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new R({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return $n in this&&e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new E({value:e})}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return Yt.schema();const s=Re(this.tbsView);L.assert(s,"PKCS#10 Certificate Request"),t=s.result}else t=this.encodeTBS();return new E({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:he.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return $n in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}async sign(e,t="SHA-1",s=te(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await s.getSignatureParameters(e,t),n=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const u=await s.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new ae({valueHex:u})}async verify(e=te(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=te(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}Yt.CLASS_NAME="CertificationRequest";const sn="digestAlgorithm",rn="digest",z1=[sn,rn];class qt extends j{constructor(e={}){super(),this.digestAlgorithm=d(e,sn,qt.defaultValues(sn)),this.digest=d(e,rn,qt.defaultValues(rn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sn:return new T;case rn:return new H;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case sn:return T.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case rn:return t.isEqual(qt.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[T.schema(t.digestAlgorithm||{names:{blockName:sn}}),new H({name:t.digest||rn})]})}fromSchema(e){$(e,z1);const t=U(e,e,qt.schema({names:{digestAlgorithm:{names:{blockName:sn}},digest:rn}}));L.assertSchema(t,this.className),this.digestAlgorithm=new T({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new E({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}qt.CLASS_NAME="DigestInfo";const Ui="eContentType",_t="eContent",X1=[Ui,_t];class xt extends j{constructor(e={}){if(super(),this.eContentType=d(e,Ui,xt.defaultValues(Ui)),_t in e&&(this.eContent=d(e,_t,xt.defaultValues(_t)),this.eContent.idBlock.tagClass===1&&this.eContent.idBlock.tagNumber===4&&this.eContent.idBlock.isConstructed===!1)){const t=new H({idBlock:{isConstructed:!0},isConstructed:!0});let s=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const u=new Uint8Array(a,s,s+65536>a.byteLength?a.byteLength-s:65536),o=new ArrayBuffer(u.length),l=new Uint8Array(o);for(let i=0;i<l.length;i++)l[i]=u[i];t.valueBlock.value.push(new H({valueHex:o})),n-=u.length,s+=u.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ui:return A;case _t:return new H;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ui:return t===A;case _t:return t.idBlock.tagClass===1&&t.idBlock.tagNumber===4?t.isEqual(xt.defaultValues(_t)):!1;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.eContentType||A}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Y({name:t.eContent||A})]})]})}fromSchema(e){$(e,X1);const t=U(e,e,xt.schema({names:{eContentType:Ui,eContent:_t}}));L.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),_t in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new W({value:this.eContentType})),this.eContent&&xt.compareWithDefault(_t,this.eContent)===!1&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new E({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&xt.compareWithDefault(_t,this.eContent)===!1&&(e.eContent=this.eContent.toJSON()),e}}xt.CLASS_NAME="EncapsulatedContentInfo";const an="mac",nn="macSalt",Cs="iterations",_1=[an,nn,Cs];class wt extends j{constructor(e={}){super(),this.mac=d(e,an,wt.defaultValues(an)),this.macSalt=d(e,nn,wt.defaultValues(nn)),Cs in e&&(this.iterations=d(e,Cs,wt.defaultValues(Cs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case an:return new qt;case nn:return new H;case Cs:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case an:return qt.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&qt.compareWithDefault("digest",t.digest);case nn:return t.isEqual(wt.defaultValues(e));case Cs:return t===wt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,optional:t.optional||!0,value:[qt.schema(t.mac||{names:{blockName:an}}),new H({name:t.macSalt||nn}),new R({optional:!0,name:t.iterations||Cs})]})}fromSchema(e){$(e,_1);const t=U(e,e,wt.schema({names:{mac:{names:{blockName:an}},macSalt:nn,iterations:Cs}}));L.assertSchema(t,this.className),this.mac=new qt({schema:t.result.mac}),this.macSalt=t.result.macSalt,Cs in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return this.iterations!==void 0&&e.push(new R({value:this.iterations})),new E({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return this.iterations!==void 0&&(e.iterations=this.iterations),e}}wt.CLASS_NAME="MacData";const fn="hashAlgorithm",pn="hashedMessage",Y1=[fn,pn];class at extends j{static async create(e,t,s=te(!0)){const a=s.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),n=await s.digest(e,t);return new at({hashAlgorithm:new T({algorithmId:a,algorithmParams:new Me}),hashedMessage:new H({valueHex:n})})}constructor(e={}){super(),this.hashAlgorithm=d(e,fn,at.defaultValues(fn)),this.hashedMessage=d(e,pn,at.defaultValues(pn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fn:return new T;case pn:return new H;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fn:return t.algorithmId===A&&!("algorithmParams"in t);case pn:return t.isEqual(at.defaultValues(e))===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[T.schema(t.hashAlgorithm||{}),new H({name:t.hashedMessage||A})]})}fromSchema(e){$(e,Y1);const t=U(e,e,at.schema({names:{hashAlgorithm:{names:{blockName:fn}},hashedMessage:pn}}));L.assertSchema(t,this.className),this.hashAlgorithm=new T({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new E({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}at.CLASS_NAME="MessageImprint";const Ki="reqCert",Dr="singleRequestExtensions",Q1=[Ki,Dr];let Uh=class Vu extends j{constructor(e={}){super(),this.reqCert=d(e,Ki,Vu.defaultValues(Ki)),Dr in e&&(this.singleRequestExtensions=d(e,Dr,Vu.defaultValues(Dr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ki:return new De;case Dr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ki:return t.isEqual(Vu.defaultValues(e));case Dr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[De.schema(t.reqCert||{}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Oe.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||A}})]})]})}fromSchema(e){$(e,Q1);const t=U(e,e,Vu.schema({names:{reqCert:{names:{blockName:Ki}},extensions:{names:{blockName:Dr}}}}));L.assertSchema(t,this.className),this.reqCert=new De({schema:t.result.reqCert}),Dr in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,s=>new Oe({schema:s})))}toSchema(){const e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new E({value:Array.from(this.singleRequestExtensions,t=>t.toSchema())})]})),new E({value:e})}toJSON(){const e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,t=>t.toJSON())),e}};Uh.CLASS_NAME="Request";const Tc="tbs",Hi="version",Mi="requestorName",Rc="requestList",Ji="requestExtensions",xo="TBSRequest",Zc="".concat(xo,".").concat(Hi),eh="".concat(xo,".").concat(Mi),Vf="".concat(xo,".requests"),th="".concat(xo,".").concat(Ji),Z1=[xo,Zc,eh,Vf,th];class st extends j{get tbs(){return ge.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(d(e,Tc,st.defaultValues(Tc))),Hi in e&&(this.version=d(e,Hi,st.defaultValues(Hi))),Mi in e&&(this.requestorName=d(e,Mi,st.defaultValues(Mi))),this.requestList=d(e,Rc,st.defaultValues(Rc)),Ji in e&&(this.requestExtensions=d(e,Ji,st.defaultValues(Ji))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tc:return Le;case Hi:return 0;case Mi:return new ue;case Rc:case Ji:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Tc:return t.byteLength===0;case Hi:return t===st.defaultValues(e);case Mi:return t.type===ue.defaultValues("type")&&Object.keys(t.value).length===0;case Rc:case Ji:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||xo,value:[new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new R({name:t.TBSRequestVersion||Zc})]}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[ue.schema(t.requestorName||{names:{blockName:eh}})]}),new E({name:t.requestList||"TBSRequest.requestList",value:[new ee({name:t.requests||Vf,value:Uh.schema(t.requestNames||{})})]}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[je.schema(t.extensions||{names:{blockName:t.requestExtensions||th}})]})]})}fromSchema(e){$(e,Z1);const t=U(e,e,st.schema());L.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,Zc in t.result&&(this.version=t.result[Zc].valueBlock.valueDec),eh in t.result&&(this.requestorName=new ue({schema:t.result[eh]})),this.requestList=Array.from(t.result[Vf],s=>new Uh({schema:s})),th in t.result&&(this.requestExtensions=Array.from(t.result[th].valueBlock.value,s=>new Oe({schema:s})))}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return st.schema();const s=Re(this.tbsView);if(L.assert(s,"TBS Request"),!(s.result instanceof E))throw new Error("ASN.1 result should be SEQUENCE");t=s.result}else{const s=[];this.version!==void 0&&s.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[new R({value:this.version})]})),this.requestorName&&s.push(new O({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),s.push(new E({value:Array.from(this.requestList,a=>a.toSchema())})),this.requestExtensions&&s.push(new O({idBlock:{tagClass:3,tagNumber:2},value:[new E({value:Array.from(this.requestExtensions,a=>a.toSchema())})]})),t=new E({value:s})}return t}toJSON(){const e={};return this.version!=null&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,t=>t.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,t=>t.toJSON())),e}}st.CLASS_NAME="TBSRequest";const Un="signatureAlgorithm",Kn="signature",Qs="certs";class Ot extends j{constructor(e={}){super(),this.signatureAlgorithm=d(e,Un,Ot.defaultValues(Un)),this.signature=d(e,Kn,Ot.defaultValues(Kn)),Qs in e&&(this.certs=d(e,Qs,Ot.defaultValues(Qs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Un:return new T;case Kn:return new ae;case Qs:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Un:return t.algorithmId===A&&!("algorithmParams"in t);case Kn:return t.isEqual(Ot.defaultValues(e));case Qs:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[T.schema(t.signatureAlgorithm||{}),new ae({name:t.signature||A}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new E({value:[new ee({name:t.certs||A,value:le.schema({})})]})]})]})}fromSchema(e){$(e,[Un,Kn,Qs]);const t=U(e,e,Ot.schema({names:{signatureAlgorithm:{names:{blockName:Un}},signature:Kn,certs:Qs}}));L.assertSchema(t,this.className),this.signatureAlgorithm=new T({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,Qs in t.result&&(this.certs=Array.from(t.result.certs,s=>new le({schema:s})))}toSchema(){const e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new E({value:Array.from(this.certs,t=>t.toSchema())})]})),new E({value:e})}toJSON(){const e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}}Ot.CLASS_NAME="Signature";const Fi="tbsRequest",Tr="optionalSignature",eA=[Fi,Tr];class Fu extends j{constructor(e={}){super(),this.tbsRequest=d(e,Fi,Fu.defaultValues(Fi)),Tr in e&&(this.optionalSignature=d(e,Tr,Fu.defaultValues(Tr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fi:return new st;case Tr:return new Ot;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Fi:return st.compareWithDefault("tbs",t.tbs)&&st.compareWithDefault("version",t.version)&&st.compareWithDefault("requestorName",t.requestorName)&&st.compareWithDefault("requestList",t.requestList)&&st.compareWithDefault("requestExtensions",t.requestExtensions);case Tr:return Ot.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&Ot.compareWithDefault("signature",t.signature)&&Ot.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||"OCSPRequest",value:[st.schema(t.tbsRequest||{names:{blockName:Fi}}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Ot.schema(t.optionalSignature||{names:{blockName:Tr}})]})]})}fromSchema(e){$(e,eA);const t=U(e,e,Fu.schema());L.assertSchema(t,this.className),this.tbsRequest=new st({schema:t.result.tbsRequest}),Tr in t.result&&(this.optionalSignature=new Ot({schema:t.result.optionalSignature}))}toSchema(e=!1){const t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new E({value:t})}toJSON(){const e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,s=te(!0)){const a=new De;await a.createForCertificate(e,t,s),this.tbsRequest.requestList.push(new Uh({reqCert:a}))}async sign(e,t="SHA-1",s=te(!0)){if(ie.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw new Error('Need to create "optionalSignature" field before signing');const a=await s.getSignatureParameters(e,t),n=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;const u=this.tbsRequest.toSchema(!0).toBER(!1),o=await s.signWithPrivateKey(u,e,n);this.optionalSignature.signature=new ae({valueHex:o})}verify(){}}Fu.CLASS_NAME="OCSPRequest";const qi="responseType",Wi="response",tA=[qi,Wi];class ts extends j{constructor(e={}){super(),this.responseType=d(e,qi,ts.defaultValues(qi)),this.response=d(e,Wi,ts.defaultValues(Wi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qi:return A;case Wi:return new H;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case qi:return t===A;case Wi:return t.isEqual(ts.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new W({name:t.responseType||A}),new H({name:t.response||A})]})}fromSchema(e){$(e,tA);const t=U(e,e,ts.schema({names:{responseType:qi,response:Wi}}));L.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new E({value:[new W({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}ts.CLASS_NAME="ResponseBytes";const Hn="responseStatus",gs="responseBytes";class ho extends j{constructor(e={}){super(),this.responseStatus=d(e,Hn,ho.defaultValues(Hn)),gs in e&&(this.responseBytes=d(e,gs,ho.defaultValues(gs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hn:return new zu;case gs:return new ts;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Hn:return t.isEqual(ho.defaultValues(e));case gs:return ts.compareWithDefault("responseType",t.responseType)&&ts.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||"OCSPResponse",value:[new zu({name:t.responseStatus||Hn}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ts.schema(t.responseBytes||{names:{blockName:gs}})]})]})}fromSchema(e){$(e,[Hn,gs]);const t=U(e,e,ho.schema());L.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,gs in t.result&&(this.responseBytes=new ts({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new E({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,s=te(!0)){let a;const n={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==Hc)return n;try{const u=Re(this.responseBytes.response.valueBlock.valueHexView);L.assert(u,"Basic OCSP response"),a=new Jt({schema:u.result})}catch(u){return n}return a.getCertificateStatus(e,t,s)}async sign(e,t,s=te(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===Hc)return Jt.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,s);throw new Error("Unknown ResponseBytes type: ".concat(((a=this.responseBytes)===null||a===void 0?void 0:a.responseType)||"Unknown"))}async verify(e=null,t=te(!0)){var s;if(!(gs in this))throw new Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===Hc){const a=Jt.fromBER(this.responseBytes.response.valueBlock.valueHexView);return e!==null&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw new Error("Unknown ResponseBytes type: ".concat(((s=this.responseBytes)===null||s===void 0?void 0:s.responseType)||"Unknown"))}}ho.CLASS_NAME="OCSPResponse";const ha="type",Es="attributes",Lc="encodedValue",sA=[Es];class Ae extends j{constructor(e={}){super(),this.type=d(e,ha,Ae.defaultValues(ha)),this.attributes=d(e,Es,Ae.defaultValues(Es)),this.encodedValue=d(e,Lc,Ae.defaultValues(Lc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ha:return-1;case Es:return[];case Lc:return Le;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ha:return t===Ae.defaultValues(ha);case Es:return t.length===0;case Lc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new O({name:t.blockName||A,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new ee({name:t.attributes||A,value:we.schema()})]})}fromSchema(e){$(e,sA);const t=U(e,e,Ae.schema({names:{tagNumber:this.type,attributes:Es}}));L.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=ge.toArrayBuffer(t.result.valueBeforeDecodeView);const s=new Uint8Array(this.encodedValue);if(s[0]=49,!(Es in t.result)){if(this.type===0)throw new Error("Wrong structure of SignedUnsignedAttributes");return}this.attributes=Array.from(t.result.attributes,a=>new we({schema:a}))}toSchema(){if(Ae.compareWithDefault(ha,this.type)||Ae.compareWithDefault(Es,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new O({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(Ae.compareWithDefault(ha,this.type)||Ae.compareWithDefault(Es,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}Ae.CLASS_NAME="SignedAndUnsignedAttributes";const Gi="version",on="sid",zi="digestAlgorithm",Rr="signedAttrs",Xi="signatureAlgorithm",Bu="signature",Lr="unsignedAttrs",na="SignerInfo",Bf="".concat(na,".").concat(Gi),Pu="".concat(na,".").concat(on),Pf="".concat(na,".").concat(zi),sh="".concat(na,".").concat(Rr),Of="".concat(na,".").concat(Xi),Df="".concat(na,".").concat(Bu),rh="".concat(na,".").concat(Lr),rA=[Bf,Pu,Pf,sh,Of,Df,rh];class Ve extends j{constructor(e={}){super(),this.version=d(e,Gi,Ve.defaultValues(Gi)),this.sid=d(e,on,Ve.defaultValues(on)),this.digestAlgorithm=d(e,zi,Ve.defaultValues(zi)),Rr in e&&(this.signedAttrs=d(e,Rr,Ve.defaultValues(Rr))),this.signatureAlgorithm=d(e,Xi,Ve.defaultValues(Xi)),this.signature=d(e,Bu,Ve.defaultValues(Bu)),Lr in e&&(this.unsignedAttrs=d(e,Lr,Ve.defaultValues(Lr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gi:return 0;case on:return new Y;case zi:return new T;case Rr:return new Ae({type:0});case Xi:return new T;case Bu:return new H;case Lr:return new Ae({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Gi:return Ve.defaultValues(Gi)===t;case on:return t instanceof Y;case zi:return t instanceof T?t.isEqual(Ve.defaultValues(zi)):!1;case Rr:return Ae.compareWithDefault("type",t.type)&&Ae.compareWithDefault("attributes",t.attributes)&&Ae.compareWithDefault("encodedValue",t.encodedValue);case Xi:return t instanceof T?t.isEqual(Ve.defaultValues(Xi)):!1;case Bu:case Lr:return Ae.compareWithDefault("type",t.type)&&Ae.compareWithDefault("attributes",t.attributes)&&Ae.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:na,value:[new R({name:t.version||Bf}),new Ne({value:[$e.schema(t.sidSchema||{names:{blockName:Pu}}),new Ne({value:[new O({optional:!0,name:t.sid||Pu,idBlock:{tagClass:3,tagNumber:0},value:[new H]}),new _({optional:!0,name:t.sid||Pu,idBlock:{tagClass:3,tagNumber:0}})]})]}),T.schema(t.digestAlgorithm||{names:{blockName:Pf}}),Ae.schema(t.signedAttrs||{names:{blockName:sh,tagNumber:0}}),T.schema(t.signatureAlgorithm||{names:{blockName:Of}}),new H({name:t.signature||Df}),Ae.schema(t.unsignedAttrs||{names:{blockName:rh,tagNumber:1}})]})}fromSchema(e){$(e,rA);const t=U(e,e,Ve.schema());L.assertSchema(t,this.className),this.version=t.result[Bf].valueBlock.valueDec;const s=t.result[Pu];s.idBlock.tagClass===1?this.sid=new $e({schema:s}):this.sid=s,this.digestAlgorithm=new T({schema:t.result[Pf]}),sh in t.result&&(this.signedAttrs=new Ae({type:0,schema:t.result[sh]})),this.signatureAlgorithm=new T({schema:t.result[Of]}),this.signature=t.result[Df],rh in t.result&&(this.unsignedAttrs=new Ae({type:1,schema:t.result[rh]}))}toSchema(){if(Ve.compareWithDefault(on,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new R({value:this.version})),this.sid instanceof $e?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&Ve.compareWithDefault(Rr,this.signedAttrs)===!1&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&Ve.compareWithDefault(Lr,this.unsignedAttrs)===!1&&e.push(this.unsignedAttrs.toSchema()),new E({value:e})}toJSON(){if(Ve.compareWithDefault(on,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof Y||(e.sid=this.sid.toJSON()),this.signedAttrs&&Ve.compareWithDefault(Rr,this.signedAttrs)===!1&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&Ve.compareWithDefault(Lr,this.unsignedAttrs)===!1&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}Ve.CLASS_NAME="SignerInfo";const Ou="version",Du="policy",Tu="messageImprint",Ru="serialNumber",Lu="genTime",ln="ordering",un="nonce",_i="accuracy",Yi="tsa",Qi="extensions",as="TSTInfo",Tf="".concat(as,".").concat(Ou),Rf="".concat(as,".").concat(Du),Lf="".concat(as,".").concat(Tu),jf="".concat(as,".").concat(Ru),$f="".concat(as,".").concat(Lu),ah="".concat(as,".").concat(_i),nh="".concat(as,".").concat(ln),ih="".concat(as,".").concat(un),oh="".concat(as,".").concat(Yi),lh="".concat(as,".").concat(Qi),aA=[Tf,Rf,Lf,jf,$f,ah,nh,ih,oh,lh];class lt extends j{constructor(e={}){super(),this.version=d(e,Ou,lt.defaultValues(Ou)),this.policy=d(e,Du,lt.defaultValues(Du)),this.messageImprint=d(e,Tu,lt.defaultValues(Tu)),this.serialNumber=d(e,Ru,lt.defaultValues(Ru)),this.genTime=d(e,Lu,lt.defaultValues(Lu)),_i in e&&(this.accuracy=d(e,_i,lt.defaultValues(_i))),ln in e&&(this.ordering=d(e,ln,lt.defaultValues(ln))),un in e&&(this.nonce=d(e,un,lt.defaultValues(un))),Yi in e&&(this.tsa=d(e,Yi,lt.defaultValues(Yi))),Qi in e&&(this.extensions=d(e,Qi,lt.defaultValues(Qi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ou:return 0;case Du:return A;case Tu:return new at;case Ru:return new R;case Lu:return new Date(0,0,0);case _i:return new Pt;case ln:return!1;case un:return new R;case Yi:return new ue;case Qi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ou:case Du:case Lu:case ln:return t===lt.defaultValues(ln);case Tu:return at.compareWithDefault(fn,t.hashAlgorithm)&&at.compareWithDefault(pn,t.hashedMessage);case Ru:case un:return t.isEqual(lt.defaultValues(un));case _i:return Pt.compareWithDefault(tr,t.seconds)&&Pt.compareWithDefault(sr,t.millis)&&Pt.compareWithDefault(rr,t.micros);case Yi:return ue.compareWithDefault(Wo,t.type)&&ue.compareWithDefault(Go,t.value);case Qi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||as,value:[new R({name:t.version||Tf}),new W({name:t.policy||Rf}),at.schema(t.messageImprint||{names:{blockName:Lf}}),new R({name:t.serialNumber||jf}),new ke({name:t.genTime||$f}),Pt.schema(t.accuracy||{names:{blockName:ah}}),new aa({name:t.ordering||nh,optional:!0}),new R({name:t.nonce||ih,optional:!0}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ue.schema(t.tsa||{names:{blockName:oh}})]}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ee({name:t.extensions||lh,value:Oe.schema(t.extension||{})})]})]})}fromSchema(e){$(e,aA);const t=U(e,e,lt.schema());L.assertSchema(t,this.className),this.version=t.result[Tf].valueBlock.valueDec,this.policy=t.result[Rf].valueBlock.toString(),this.messageImprint=new at({schema:t.result[Lf]}),this.serialNumber=t.result[jf],this.genTime=t.result[$f].toDate(),ah in t.result&&(this.accuracy=new Pt({schema:t.result[ah]})),nh in t.result&&(this.ordering=t.result[nh].valueBlock.value),ih in t.result&&(this.nonce=t.result[ih]),oh in t.result&&(this.tsa=new ue({schema:t.result[oh]})),lh in t.result&&(this.extensions=Array.from(t.result[lh],s=>new Oe({schema:s})))}toSchema(){const e=[];return e.push(new R({value:this.version})),e.push(new W({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new ke({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),this.ordering!==void 0&&e.push(new aa({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),this.ordering!==void 0&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async verify(e,t=te(!0)){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const s=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),n=await t.digest(a.name,new Uint8Array(s));return ge.isEqual(n,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}lt.CLASS_NAME="TSTInfo";const Zi="version",ju="digestAlgorithms",$u="encapContentInfo",eo="certificates",to="crls",Uu="signerInfos",Jo="ocsps",Dn="SignedData",Uf="".concat(Dn,".").concat(Zi),uh="".concat(Dn,".").concat(ju),Kf="".concat(Dn,".").concat($u),ch="".concat(Dn,".").concat(eo),hh="".concat(Dn,".").concat(to),mh="".concat(Dn,".").concat(Uu),nA=[Uf,uh,Kf,ch,hh,mh];class ot extends Error{constructor({message:e,code:t=0,date:s=new Date,signatureVerified:a=null,signerCertificate:n=null,signerCertificateVerified:u=null,timestampSerial:o=null,certificatePath:l=[]}){super(e),this.name="SignedDataVerifyError",this.date=s,this.code=t,this.timestampSerial=o,this.signatureVerified=a,this.signerCertificate=n,this.signerCertificateVerified=u,this.certificatePath=l}}class tt extends j{constructor(e={}){super(),this.version=d(e,Zi,tt.defaultValues(Zi)),this.digestAlgorithms=d(e,ju,tt.defaultValues(ju)),this.encapContentInfo=d(e,$u,tt.defaultValues($u)),eo in e&&(this.certificates=d(e,eo,tt.defaultValues(eo))),to in e&&(this.crls=d(e,to,tt.defaultValues(to))),Jo in e&&(this.ocsps=d(e,Jo,tt.defaultValues(Jo))),this.signerInfos=d(e,Uu,tt.defaultValues(Uu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zi:return 0;case ju:return[];case $u:return new xt;case eo:return[];case to:return[];case Jo:return[];case Uu:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Zi:return t===tt.defaultValues(Zi);case $u:return xt.compareWithDefault("eContentType",t.eContentType)&&xt.compareWithDefault("eContent",t.eContent);case ju:case eo:case to:case Jo:case Uu:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return t.optional===void 0&&(t.optional=!1),new E({name:t.blockName||Dn,optional:t.optional,value:[new R({name:t.version||Uf}),new Je({value:[new ee({name:t.digestAlgorithms||uh,value:T.schema()})]}),xt.schema(t.encapContentInfo||{names:{blockName:Kf}}),new O({name:t.certificates||ch,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:fs.schema().valueBlock.value}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Ks.schema(t.crls||{names:{crls:hh}}).valueBlock.value}),new Je({value:[new ee({name:t.signerInfos||mh,value:Ve.schema()})]})]})}fromSchema(e){$(e,nA);const t=U(e,e,tt.schema());if(L.assertSchema(t,this.className),this.version=t.result[Uf].valueBlock.valueDec,uh in t.result&&(this.digestAlgorithms=Array.from(t.result[uh],s=>new T({schema:s}))),this.encapContentInfo=new xt({schema:t.result[Kf]}),ch in t.result){const s=new fs({schema:new Je({value:t.result[ch].valueBlock.value})});this.certificates=s.certificates.slice(0)}hh in t.result&&(this.crls=Array.from(t.result[hh],s=>s.idBlock.tagClass===1?new He({schema:s}):(s.idBlock.tagClass=1,s.idBlock.tagNumber=16,new Us({schema:s})))),mh in t.result&&(this.signerInfos=Array.from(t.result[mh],s=>new Ve({schema:s})))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof ta)||this.crls&&this.crls.length&&this.crls.some(s=>s instanceof Us)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof Tt)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(s=>s instanceof Ts)||this.signerInfos.some(s=>s.version===3)||this.encapContentInfo.eContentType!==tt.ID_DATA?this.version=3:this.version=1,t.push(new R({value:this.version})),t.push(new Je({value:Array.from(this.digestAlgorithms,s=>s.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const s=new fs({certificates:this.certificates}).toSchema();t.push(new O({idBlock:{tagClass:3,tagNumber:0},value:s.valueBlock.value}))}return this.crls&&t.push(new O({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,s=>{if(s instanceof Us){const a=s.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return s.toSchema(e)})})),t.push(new Je({value:Array.from(this.signerInfos,s=>s.toSchema())})),new E({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}async verify({signer:e=-1,data:t=Le,trustedCerts:s=[],checkDate:a=new Date,checkChain:n=!1,passedWhenNotRevValues:u=!1,extendedMode:o=!1,findOrigin:l=null,findIssuer:i=null}={},c=te(!0)){let m=null,h=null;try{let g=Le,p=A,y=[];const w=this.signerInfos[e];if(!w)throw new ot({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new ot({date:a,code:2,message:"No certificates attached to this signed data"});if(w.sid instanceof $e){for(const k of this.certificates)if(k instanceof le&&k.issuer.isEqual(w.sid.issuer)&&k.serialNumber.isEqual(w.sid.serialNumber)){m=k;break}}else{const k=w.sid,N=k.idBlock.isConstructed?k.valueBlock.value[0].valueBlock.valueHex:k.valueBlock.valueHex;for(const S of this.certificates){if(!(S instanceof le))continue;const x=await c.digest({name:"sha-1"},S.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(Gu(x,N)){m=S;break}}}if(!m)throw new ot({date:a,code:3,message:"Unable to find signer certificate"});if(this.encapContentInfo.eContentType===u0){if(!this.encapContentInfo.eContent)throw new ot({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0});let k;try{k=lt.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch(N){throw new ot({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0})}if(a=k.genTime,h=k.serialNumber.valueBlock.valueHexView.slice(),t.byteLength===0)throw new ot({date:a,code:4,message:"Missed detached data input array"});if(!await k.verify({data:t},c))throw new ot({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0})}if(n){const k=this.certificates.filter(C=>C instanceof le&&!!fw(C,m)),N={checkDate:a,certs:k,trustedCerts:s};i&&(N.findIssuer=i),l&&(N.findOrigin=l);const S=new Wh(N);if(S.certs.push(m),this.crls)for(const C of this.crls)"thisUpdate"in C?S.crls.push(C):C.otherRevInfoFormat===Hc&&S.ocsps.push(new Jt({schema:C.otherRevInfo}));this.ocsps&&S.ocsps.push(...this.ocsps);const x=await S.verify({passedWhenNotRevValues:u},c).catch(C=>{throw new ot({date:a,code:5,message:"Validation of signer's certificate failed with error: ".concat(C instanceof Object?C.resultMessage:C),signerCertificate:m,signerCertificateVerified:!1})});if(x.certificatePath&&(y=x.certificatePath),!x.result)throw new ot({date:a,code:5,message:"Validation of signer's certificate failed: ".concat(x.resultMessage),signerCertificate:m,signerCertificateVerified:!1})}const b=c.getAlgorithmByOID(w.digestAlgorithm.algorithmId);if(!("name"in b))throw new ot({date:a,code:7,message:"Unsupported signature algorithm: ".concat(w.digestAlgorithm.algorithmId),signerCertificate:m,signerCertificateVerified:!0});p=b.name;const f=this.encapContentInfo.eContent;if(f)f.idBlock.tagClass===1&&f.idBlock.tagNumber===4?t=f.getValue():t=f.valueBlock.valueBeforeDecodeView;else if(t.byteLength===0)throw new ot({date:a,code:8,message:"Missed detached data input array",signerCertificate:m,signerCertificateVerified:!0});if(w.signedAttrs){let k=!1,N=!1;for(const S of w.signedAttrs.attributes)if(S.type==="1.2.840.113549.1.9.3"&&(k=!0),S.type==="1.2.840.113549.1.9.4"&&(N=!0,g=S.values[0].valueBlock.valueHex),k&&N)break;if(k===!1)throw new ot({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:m,signerCertificateVerified:!0});if(N===!1)throw new ot({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:m,signerCertificateVerified:!0})}if(w.signedAttrs){const k=await c.digest(p,new Uint8Array(t));if(!Gu(k,g))throw new ot({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0});t=w.signedAttrs.encodedValue}const v=w.signatureAlgorithm.algorithmId==="1.2.840.113549.1.1.1"?await c.verifyWithPublicKey(t,w.signature,m.subjectPublicKeyInfo,w.signatureAlgorithm,p):await c.verifyWithPublicKey(t,w.signature,m.subjectPublicKeyInfo,w.signatureAlgorithm);return o?{date:a,code:14,message:A,signatureVerified:v,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0,certificatePath:y}:v}catch(g){throw g instanceof ot?g:new ot({date:a,code:15,message:"Error during verification: ".concat(g instanceof Error?g.message:g),signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0})}}async sign(e,t,s="SHA-1",a=Le,n=te(!0)){var u;if(!e)throw new Error("Need to provide a private key for signing");const o=this.signerInfos[t];if(!o)throw new RangeError("SignerInfo index is out of range");!(!((u=o.signedAttrs)===null||u===void 0)&&u.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(s=e.algorithm.hash.name);const l=n.getOIDByAlgorithm({name:s},!0,"hashAlgorithm");this.digestAlgorithms.filter(h=>h.algorithmId===l).length===0&&this.digestAlgorithms.push(new T({algorithmId:l,algorithmParams:new Me})),o.digestAlgorithm=new T({algorithmId:l,algorithmParams:new Me});const i=await n.getSignatureParameters(e,s),c=i.parameters;if(o.signatureAlgorithm=i.signatureAlgorithm,o.signedAttrs)if(o.signedAttrs.encodedValue.byteLength!==0)a=o.signedAttrs.encodedValue;else{a=o.signedAttrs.toSchema().toBER();const h=ge.toUint8Array(a);h[0]=49}else{const h=this.encapContentInfo.eContent;if(h)h.idBlock.tagClass===1&&h.idBlock.tagNumber===4?a=h.getValue():a=h.valueBlock.valueBeforeDecodeView;else if(a.byteLength===0)throw new Error("Missed detached data input array")}const m=await n.signWithPrivateKey(a,e,c);o.signature=new H({valueHex:m})}}tt.CLASS_NAME="SignedData",tt.ID_DATA=cp;const cn="version",hn="authSafe",xs="macData",Fo="parsedValue",iA=[cn,hn,xs];class Hr extends j{constructor(e={}){super(),this.version=d(e,cn,Hr.defaultValues(cn)),this.authSafe=d(e,hn,Hr.defaultValues(hn)),xs in e&&(this.macData=d(e,xs,Hr.defaultValues(xs))),Fo in e&&(this.parsedValue=d(e,Fo,Hr.defaultValues(Fo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cn:return 3;case hn:return new pe;case xs:return new wt;case Fo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cn:return t===Hr.defaultValues(e);case hn:return pe.compareWithDefault("contentType",t.contentType)&&pe.compareWithDefault("content",t.content);case xs:return wt.compareWithDefault("mac",t.mac)&&wt.compareWithDefault("macSalt",t.macSalt)&&wt.compareWithDefault("iterations",t.iterations);case Fo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.version||cn}),pe.schema(t.authSafe||{names:{blockName:hn}}),wt.schema(t.macData||{names:{blockName:xs,optional:!0}})]})}fromSchema(e){$(e,iA);const t=U(e,e,Hr.schema({names:{version:cn,authSafe:{names:{blockName:hn}},macData:{names:{blockName:xs}}}}));L.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new pe({schema:t.result.authSafe}),xs in t.result&&(this.macData=new wt({schema:t.result.macData}))}toSchema(){const e=[new R({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new E({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=te(!0)){if(me.assert(e,"parameters","object"),!this.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(ie.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),ie.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new ie("iterations");ie.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),ie.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),ie.assertEmpty(e.password,"password");const s=new ArrayBuffer(64),a=new Uint8Array(s);t.getRandomValues(a);const n=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new pe({contentType:pe.DATA,content:new H({valueHex:n})});const u=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:s,iterationCount:e.iterations,contentToStamp:n});this.macData=new wt({mac:new qt({digestAlgorithm:new T({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new H({valueHex:u})}),macSalt:new H({valueHex:s}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new ie("signingCertificate");ie.assertEmpty(e.privateKey,"privateKey"),ie.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const s=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new tt({version:1,encapContentInfo:new xt({eContentType:"1.2.840.113549.1.7.1",eContent:new H({valueHex:s})}),certificates:[e.signingCertificate]}),n=await t.digest({name:e.hashAlgorithm},new Uint8Array(s)),u=[];u.push(new we({type:"1.2.840.113549.1.9.3",values:[new W({value:"1.2.840.113549.1.7.1"})]})),u.push(new we({type:"1.2.840.113549.1.9.5",values:[new cf({valueDate:new Date})]})),u.push(new we({type:"1.2.840.113549.1.9.4",values:[new H({valueHex:n})]})),a.signerInfos.push(new Ve({version:1,sid:new $e({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new Ae({type:0,attributes:u})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new pe({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw new Error('Parameter "integrityMode" has unknown value: '.concat(this.parsedValue.integrityMode))}}async parseInternalValues(e,t=te(!0)){switch(me.assert(e,"parameters","object"),e.checkIntegrity===void 0&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case pe.DATA:{ie.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,me.assert(this.authSafe.content,"authSafe.content",H);const s=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=Vn.fromBER(s),e.checkIntegrity){if(!this.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:ge.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:s,signatureToVerify:ge.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case pe.SIGNED_DATA:{this.parsedValue.integrityMode=1;const s=new tt({schema:this.authSafe.content}),a=s.encapContentInfo.eContent;ie.assert(a,"eContent","cmsSigned.encapContentInfo"),me.assert(a,"eContent",H);const n=a.getValue();if(this.parsedValue.authenticatedSafe=Vn.fromBER(n),!await s.verify({signer:0,checkChain:!1},t))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error('Incorrect value for "this.authSafe.contentType": '.concat(this.authSafe.contentType))}}}Hr.CLASS_NAME="PFX";const so="status",jr="statusStrings",$r="failInfo",oA=[so,jr,$r];var zd;(function(r){r[r.granted=0]="granted",r[r.grantedWithMods=1]="grantedWithMods",r[r.rejection=2]="rejection",r[r.waiting=3]="waiting",r[r.revocationWarning=4]="revocationWarning",r[r.revocationNotification=5]="revocationNotification"})(zd||(zd={}));class Ft extends j{constructor(e={}){super(),this.status=d(e,so,Ft.defaultValues(so)),jr in e&&(this.statusStrings=d(e,jr,Ft.defaultValues(jr))),$r in e&&(this.failInfo=d(e,$r,Ft.defaultValues($r))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case so:return 2;case jr:return[];case $r:return new ae;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case so:return t===Ft.defaultValues(e);case jr:return t.length===0;case $r:return t.isEqual(Ft.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||A,value:[new R({name:t.status||A}),new E({optional:!0,value:[new ee({name:t.statusStrings||A,value:new bh})]}),new ae({name:t.failInfo||A,optional:!0})]})}fromSchema(e){$(e,oA);const t=U(e,e,Ft.schema({names:{status:so,statusStrings:jr,failInfo:$r}}));L.assertSchema(t,this.className);const s=t.result.status;if(s.valueBlock.isHexOnly===!0||s.valueBlock.valueDec<0||s.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=s.valueBlock.valueDec,jr in t.result&&(this.statusStrings=t.result.statusStrings),$r in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){const e=[];return e.push(new R({value:this.status})),this.statusStrings&&e.push(new E({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new E({value:e})}toJSON(){const e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,t=>t.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}Ft.CLASS_NAME="PKIStatusInfo";const Ku="version",Hu="messageImprint",ro="reqPolicy",ao="nonce",Is="certReq",no="extensions",Tn="TimeStampReq",Hf="".concat(Tn,".").concat(Ku),Mf="".concat(Tn,".").concat(Hu),fh="".concat(Tn,".").concat(ro),ph="".concat(Tn,".").concat(ao),dh="".concat(Tn,".").concat(Is),gh="".concat(Tn,".").concat(no),lA=[Hf,Mf,fh,ph,dh,gh];class It extends j{constructor(e={}){super(),this.version=d(e,Ku,It.defaultValues(Ku)),this.messageImprint=d(e,Hu,It.defaultValues(Hu)),ro in e&&(this.reqPolicy=d(e,ro,It.defaultValues(ro))),ao in e&&(this.nonce=d(e,ao,It.defaultValues(ao))),Is in e&&(this.certReq=d(e,Is,It.defaultValues(Is))),no in e&&(this.extensions=d(e,no,It.defaultValues(no))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ku:return 0;case Hu:return new at;case ro:return A;case ao:return new R;case Is:return!1;case no:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ku:case ro:case Is:return t===It.defaultValues(e);case Hu:return at.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&at.compareWithDefault("hashedMessage",t.hashedMessage);case ao:return t.isEqual(It.defaultValues(e));case no:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||Tn,value:[new R({name:t.version||Hf}),at.schema(t.messageImprint||{names:{blockName:Mf}}),new W({name:t.reqPolicy||fh,optional:!0}),new R({name:t.nonce||ph,optional:!0}),new aa({name:t.certReq||dh,optional:!0}),new O({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ee({name:t.extensions||gh,value:Oe.schema()})]})]})}fromSchema(e){$(e,lA);const t=U(e,e,It.schema());L.assertSchema(t,this.className),this.version=t.result[Hf].valueBlock.valueDec,this.messageImprint=new at({schema:t.result[Mf]}),fh in t.result&&(this.reqPolicy=t.result[fh].valueBlock.toString()),ph in t.result&&(this.nonce=t.result[ph]),dh in t.result&&(this.certReq=t.result[dh].valueBlock.value),gh in t.result&&(this.extensions=Array.from(t.result[gh],s=>new Oe({schema:s})))}toSchema(){const e=[];return e.push(new R({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new W({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),Is in this&&It.compareWithDefault(Is,this.certReq)===!1&&e.push(new aa({value:this.certReq})),this.extensions&&e.push(new O({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={version:this.version,messageImprint:this.messageImprint.toJSON()};return this.reqPolicy!==void 0&&(e.reqPolicy=this.reqPolicy),this.nonce!==void 0&&(e.nonce=this.nonce.toJSON()),this.certReq!==void 0&&It.compareWithDefault(Is,this.certReq)===!1&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}}It.CLASS_NAME="TimeStampReq";const io="status",oo="timeStampToken",Ap="TimeStampResp",Jf="".concat(Ap,".").concat(io),wh="".concat(Ap,".").concat(oo),uA=[Jf,wh];class qu extends j{constructor(e={}){super(),this.status=d(e,io,qu.defaultValues(io)),oo in e&&(this.timeStampToken=d(e,oo,qu.defaultValues(oo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case io:return new Ft;case oo:return new pe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case io:return Ft.compareWithDefault(io,t.status)&&!("statusStrings"in t)&&!("failInfo"in t);case oo:return t.contentType===A&&t.content instanceof Y;default:return super.defaultValues(e)}}static schema(e={}){const t=d(e,"names",{});return new E({name:t.blockName||Ap,value:[Ft.schema(t.status||{names:{blockName:Jf}}),pe.schema(t.timeStampToken||{names:{blockName:wh,optional:!0}})]})}fromSchema(e){$(e,uA);const t=U(e,e,qu.schema());L.assertSchema(t,this.className),this.status=new Ft({schema:t.result[Jf]}),wh in t.result&&(this.timeStampToken=new pe({schema:t.result[wh]}))}toSchema(){const e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new E({value:e})}toJSON(){const e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,s=te(!0)){return this.assertContentType(),new tt({schema:this.timeStampToken.content}).sign(e,0,t,void 0,s)}async verify(e={signer:0,trustedCerts:[],data:Le},t=te(!0)){return this.assertContentType(),new tt({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==nw)throw new Error("Wrong format of timeStampToken: ".concat(this.timeStampToken.contentType))}}qu.CLASS_NAME="TimeStampResp";function cA(){if(typeof self<"u"){if("crypto"in self){let r="webcrypto";"webkitSubtle"in self.crypto&&(r="safari"),Od(r,new ec({name:r,crypto}))}}else if(typeof crypto<"u"&&"webcrypto"in crypto){const r="NodeJS ^15",e=crypto.webcrypto;Od(r,new ec({name:r,crypto:e}))}}cA();function hA(r){return String.fromCharCode(...r)}function dw(r){return Uint8Array.from(r,e=>e.charCodeAt(0))}function mA(r){return Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")}function ds(r){return dw(atob(r))}function Sp(r){const e=r.replace(/-----BEGIN ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/-----END ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/\n/g,"");return ds(e)}var fA=Object.defineProperty,pA=Object.defineProperties,dA=Object.getOwnPropertyDescriptors,Xd=Object.getOwnPropertySymbols,gA=Object.prototype.hasOwnProperty,wA=Object.prototype.propertyIsEnumerable,_d=(r,e,t)=>e in r?fA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ff=(r,e)=>{for(var t in e||(e={}))gA.call(e,t)&&_d(r,t,e[t]);if(Xd)for(var t of Xd(e))wA.call(e,t)&&_d(r,t,e[t]);return r},Yd=(r,e)=>pA(r,dA(e));async function Np(r,e,t={}){return await self.crypto.subtle.decrypt(Ff({name:"AES-GCM"},t),e,r)}async function yA(r,e){return await self.crypto.subtle.decrypt({name:"RSA-OAEP"},e,r)}async function gw(r){return await self.crypto.subtle.importKey("raw",r,{name:"AES-GCM",length:128},!0,["decrypt","encrypt"])}async function vA(r,e){return await self.crypto.subtle.importKey("spki",r,{name:"RSASSA-PKCS1-v1_5",hash:e},!0,["verify"])}async function bA(r){return await self.crypto.subtle.importKey("pkcs8",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])}async function AA(r){return new Uint8Array(await self.crypto.subtle.exportKey("raw",r))}async function SA(r){const e=await self.crypto.subtle.digest("SHA-256",r);return mA(new Uint8Array(e))}async function NA(r,e){const t=new Hw(r),s=await vA(Sp(e),t.signatureAlgorithm.hash.name);return t.verify({publicKey:s},kA())}function kA(){return Yd(Ff({},self.crypto),{subtle:Yd(Ff({},self.crypto.subtle),{async verify(r,e,t,s){return self.crypto.subtle.verify(r,e,new Uint8Array(t),new Uint8Array(s))}})})}async function CA(r,e,t){const s=pe.fromBER(e),a=new tt({schema:s.content}),n=a.signerInfos[0].sid.issuer.typesAndValues.find(({type:l})=>l==="2.5.4.3").value.valueBlock.value,u=t.find(({userId:l})=>l===n);if(u===void 0)throw new Error("Signer not found in the users array");const o=le.fromBER(Sp(u.certificate));return await a.verify({signer:0,trustedCerts:[o],data:r,checkChain:!0},xA())}class EA extends ec{verify(e,t,s,a){return super.verify(e,t,s,new Uint8Array(a))}}function xA(){return new EA({crypto:self.crypto})}var IA=Object.defineProperty,Qd=Object.getOwnPropertySymbols,VA=Object.prototype.hasOwnProperty,BA=Object.prototype.propertyIsEnumerable,Zd=(r,e,t)=>e in r?IA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,PA=(r,e)=>{for(var t in e||(e={}))VA.call(e,t)&&Zd(r,t,e[t]);if(Qd)for(var t of Qd(e))BA.call(e,t)&&Zd(r,t,e[t]);return r};async function OA(r,e){ze.debug("Decrypting private key",{privateKeyInfo:r,mnemonic:e});const t=await Promise.all([await af(e,r.salt,{hash:"SHA-256",iterations:6e5}),await af(e,r.salt,{hash:"SHA-1",iterations:1024}),await af(e,r.salt,{hash:"SHA-1",iterations:6e5})]);for(const s of t)try{const a=await Np(r.encryptedPrivateKey,s,{iv:r.iv,tagLength:128}),n=atob(hA(new Uint8Array(a)));return bA(Sp(n))}catch(a){}throw new Error("Failed to decrypt private key")}async function af(r,e,t){const s=await crypto.subtle.importKey("raw",new TextEncoder().encode(r.replaceAll(" ","")),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey(PA({name:"PBKDF2",salt:e},t),s,{name:"AES-GCM",length:256},!0,["decrypt","encrypt"])}const eg="apps/end_to_end_encryption/api/v2",ww={PrivateKey:eg+"/private-key",ServerKey:eg+"/server-key"};async function DA(){const r=(await ng.get(ig(ww.PrivateKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["private-key"],[e,t,s]=r.split("|");return{encryptedPrivateKey:ds(e),iv:ds(t),salt:ds(s)}}async function TA(){return await(await ng.get(ig(ww.ServerKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["public-key"]}const RA={name:"AlertCircleOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var LA=function(){var r=this,e=r._self._c;return e("span",r._b({staticClass:"material-design-icon alert-circle-outline-icon",attrs:{"aria-hidden":r.title?null:"true","aria-label":r.title,role:"img"},on:{click:function(t){return r.$emit("click",t)}}},"span",r.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:r.fillColor,width:r.size,height:r.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z"}},[r.title?e("title",[r._v(r._s(r.title))]):r._e()])])])},jA=[],$A=Hh(RA,LA,jA,!1,null,null);const UA=$A.exports,KA={name:"NcInputField",components:{NcButton:Ew,AlertCircle:UA,Check:Gw},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:{value:{type:[String,Number],default:void 0},modelValue:{type:[String,Number],default:void 0},type:{type:String,default:"text",validator:r=>["text","password","email","tel","url","search","number"].includes(r)},label:{type:String,default:void 0},labelOutside:{type:Boolean,default:!1},placeholder:{type:String,default:void 0},showTrailingButton:{type:Boolean,default:!1},trailingButtonLabel:{type:String,default:""},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1},helperText:{type:String,default:""},disabled:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},inputClass:{type:[Object,String],default:""}},emits:["update:value","update:modelValue","update:model-value","trailing-button-click"],setup(){return{model:lg("value","update:value",!0)}},computed:{computedId(){return this.$attrs.id&&this.$attrs.id!==""?this.$attrs.id:this.inputName},inputName(){return"input"+xw()},hasTrailingIcon(){return this.success},hasPlaceholder(){return this.placeholder!==""&&this.placeholder!==void 0},computedPlaceholder(){return this.hasPlaceholder?this.placeholder:this.label},isValidLabel(){const r=this.label||this.labelOutside;return r||console.warn("You need to add a label to the NcInputField component. Either use the prop label or use an external one, as per the example in the documentation."),r},ariaDescribedby(){const r=[];return this.helperText.length>0&&r.push("".concat(this.inputName,"-helper-text")),this.$attrs["aria-describedby"]&&r.push(this.$attrs["aria-describedby"]),r.join(" ")||null}},methods:{focus(){this.$refs.input.focus()},select(){this.$refs.input.select()},handleInput(r){const e=this.type==="number"&&typeof this.model=="number"?parseFloat(r.target.value,10):r.target.value;this.model=e},handleTrailingButtonClick(r){this.$emit("trailing-button-click",r)}}};var HA=function(){var t;var r=this,e=r._self._c;return e("div",{staticClass:"input-field",class:{"input-field--disabled":r.disabled,"input-field--label-outside":r.labelOutside||!r.isValidLabel,"input-field--leading-icon":!!r.$scopedSlots.icon||!!r.$scopedSlots.default||!!r.$slots.default,"input-field--trailing-icon":r.showTrailingButton||r.hasTrailingIcon,"input-field--pill":r.pill}},[e("div",{staticClass:"input-field__main-wrapper"},[e("input",r._g(r._b({ref:"input",staticClass:"input-field__input",class:[r.inputClass,{"input-field__input--success":r.success,"input-field__input--error":r.error}],attrs:{id:r.computedId,type:r.type,disabled:r.disabled,placeholder:r.computedPlaceholder,"aria-describedby":r.ariaDescribedby,"aria-live":"polite"},domProps:{value:(t=r.model)==null?void 0:t.toString()},on:{input:r.handleInput}},"input",r.$attrs,!1),r.$listeners)),!r.labelOutside&&r.isValidLabel?e("label",{staticClass:"input-field__label",attrs:{for:r.computedId}},[r._v(" "+r._s(r.label)+" ")]):r._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:!!r.$scopedSlots.icon||!!r.$scopedSlots.default||!!r.$slots.default,expression:"!!$scopedSlots.icon || !!$scopedSlots.default || !!$slots.default"}],staticClass:"input-field__icon input-field__icon--leading"},[r._t("icon",function(){return[r._t("default")]})],2),r.showTrailingButton?e("NcButton",{staticClass:"input-field__trailing-button",attrs:{"aria-label":r.trailingButtonLabel,disabled:r.disabled,variant:"tertiary-no-background"},on:{click:r.handleTrailingButtonClick},scopedSlots:r._u([{key:"icon",fn:function(){return[r._t("trailing-button-icon")]},proxy:!0}],null,!0)}):r.success||r.error?e("div",{staticClass:"input-field__icon input-field__icon--trailing"},[r.success?e("Check",{staticStyle:{color:"var(--color-success-text)"},attrs:{size:20}}):r.error?e("AlertCircle",{staticStyle:{color:"var(--color-error-text)"},attrs:{size:20}}):r._e()],1):r._e()],1),r.helperText.length>0?e("p",{staticClass:"input-field__helper-text-message",class:{"input-field__helper-text-message--error":r.error,"input-field__helper-text-message--success":r.success},attrs:{id:"".concat(r.inputName,"-helper-text")}},[r.success?e("Check",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):r.error?e("AlertCircle",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):r._e(),r._v(" "+r._s(r.helperText)+" ")],1):r._e()])},MA=[],JA=Hh(KA,HA,MA,!1,null,"8f3abf17");const qf=JA.exports,FA={name:"UndoVariantIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var qA=function(){var r=this,e=r._self._c;return e("span",r._b({staticClass:"material-design-icon undo-variant-icon",attrs:{"aria-hidden":r.title?null:"true","aria-label":r.title,role:"img"},on:{click:function(t){return r.$emit("click",t)}}},"span",r.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:r.fillColor,width:r.size,height:r.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M13.5,7A6.5,6.5 0 0,1 20,13.5A6.5,6.5 0 0,1 13.5,20H10V18H13.5C16,18 18,16 18,13.5C18,11 16,9 13.5,9H7.83L10.91,12.09L9.5,13.5L4,8L9.5,2.5L10.92,3.91L7.83,7H13.5M6,18H8V20H6V18Z"}},[r.title?e("title",[r._v(r._s(r.title))]):r._e()])])])},WA=[],GA=Hh(FA,qA,WA,!1,null,null);const zA=GA.exports;Iw(Bw,Vw);const XA=new Set(Object.keys(qf.props)),_A={name:"NcTextField",components:{NcInputField:qf,Close:Pw,ArrowRight:Mw,Undo:zA},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:ns(nt({" ":{}},qf.props),{trailingButtonLabel:{type:String,default:""},trailingButtonIcon:{type:String,default:"close",validator:r=>["close","arrowRight","undo"].includes(r)}}),emits:["update:value","update:modelValue","update:model-value"],setup(){return{model:lg("value","update:value")}},computed:{propsAndAttrsToForward(){const r={undo:Xh("Undo changes"),close:Xh("Clear text"),arrowRight:Xh("Save changes")};return ns(nt(nt({},this.$attrs),Object.fromEntries(Object.entries(this.$props).filter(([e])=>XA.has(e)))),{trailingButtonLabel:this.trailingButtonLabel||r[this.trailingButtonIcon]})}},methods:{focus(){this.$refs.inputField.focus()},select(){this.$refs.inputField.select()}}};var YA=function(){var r=this,e=r._self._c;return e("NcInputField",r._g(r._b({ref:"inputField",scopedSlots:r._u([r.$scopedSlots.icon||r.$slots.default||r.$scopedSlots.default?{key:"icon",fn:function(){return[r._t("icon",function(){return[r._t("default")]})]},proxy:!0}:null,r.type!=="search"?{key:"trailing-button-icon",fn:function(){return[r.trailingButtonIcon==="close"?e("Close",{attrs:{size:20}}):r.trailingButtonIcon==="arrowRight"?e("ArrowRight",{attrs:{size:20}}):r.trailingButtonIcon==="undo"?e("Undo",{attrs:{size:20}}):r._e()]},proxy:!0}:null],null,!0)},"NcInputField",r.propsAndAttrsToForward,!1),r.$listeners))},QA=[],ZA=Hh(_A,YA,QA,!1,null,null);const eS=ZA.exports,tS=Ow({__name:"MnemonicPromptDialog",emits:["close"],setup(r,{emit:e}){const t=_h(),s=_h(""),a=_h(!1),n=Ep(()=>a.value===!0&&s.value.trim().split(/\s+/g).length===12);function u(){e("close",s.value)}const o=Ep(()=>[{label:lf("end_to_en_encryption","Submit"),nativeType:"submit",type:"primary",disabled:!n.value,callback:u}]);return{__sfc:!0,emit:e,dialogRef:t,mnemonic:s,confirmToggle:a,isFormValid:n,submit:u,buttons:o,t:lf,NcDialog:qw,NcTextField:eS,NcNoteCard:Fw,NcCheckboxRadioSwitch:Jw}}});var sS=function(){var r=this,e=r._self._c,t=r._self._setupProxy;return e(t.NcDialog,{ref:"dialogRef",attrs:{name:t.t("end_to_end_encryption","Enter your 12 words mnemonic"),buttons:t.buttons,"is-form":!0},on:{submit:t.submit}},[e(t.NcNoteCard,{attrs:{type:"warning","show-alert":!0,heading:t.t("end_to_end_encryption","Decrypting your files in the browser can weaken security")}},[r._v(" "+r._s(t.t("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" "),e(t.NcCheckboxRadioSwitch,{attrs:{required:!0,"data-cy-e2ee-mnemonic-prompt":"i_understand_the_risks",type:"switch"},model:{value:t.confirmToggle,callback:function(s){t.confirmToggle=s},expression:"confirmToggle"}},[r._v(" "+r._s(t.t("end_to_end_encryption","I understand the risks"))+" ")])],1),e(t.NcTextField,{attrs:{value:t.mnemonic,required:"true",pattern:"^(\\w+\\s+){11}\\w+$",label:t.t("end_to_end_encryption","Mnemonic"),autofocus:!0},on:{"update:value":function(s){t.mnemonic=s}}})],1)},rS=[],aS=Dw(tS,sS,rS,!1,null,null);const nS=aS.exports;async function iS(){const r=Promise.withResolvers();return Ww(nS,void 0,e=>{e!==void 0?r.resolve(e):r.reject()}),r.promise}async function oS(r,e){ze.debug("Decrypting metadata info",{metadata:r});const[t,s]=r.metadata.ciphertext.split("|"),a=await Np(ds(t),e,{iv:ds(s)}),n=JSON.parse(await cS(a));return lS(n,r),await uS(n,e),n}function lS(r,e){var t,s;if(((t=r.keyChecksums)==null?void 0:t.length)!==((s=e.users)==null?void 0:s.length))throw new Error("Key checksums length does not match users length")}async function uS(r,e){if(r.keyChecksums===void 0)return;const t=await AA(e),s=await SA(t);if(!r.keyChecksums.includes(s))throw new Error("Key checksum is not in keyChecksums")}async function cS(r){const e=new ReadableStream({start(t){t.enqueue(new Uint8Array(r)),t.close()}}).pipeThrough(new DecompressionStream("gzip"));return await new Response(e).text()}async function hS(r,e,t){var s;ze.debug("Getting metadata private key",{metadata:r,userId:e});const a=(s=r.users)==null?void 0:s.find(o=>o.userId===e);if(!a)throw new Error("User not found in metadata");const n=ds(a.encryptedMetadataKey),u=await yA(n,t);return await gw(new Uint8Array(u))}async function tg(r,e,t){const s=JSON.stringify(r,(n,u)=>{if(n!=="filedrop")return u}),a=await CA(dw(btoa(s)),ds(e),t.users);if(!a)throw new Error("Metadata signature verification failed");return a}async function mS(r,e){const t=r.users.map(async({userId:s,certificate:a})=>{const n=await NA(a,e);if(!n)throw new Error("Certificate verification failed for user ".concat(s));return n});return await Promise.all(t)}const fS=Ev(),ct={_userPrivateKey:void 0,_serverPublicKey:void 0,_metadataCache:{},async getUserPrivateKey(){var r;return(r=this._userPrivateKey)!=null||(this._userPrivateKey=await OA(await DA(),await iS())),this._userPrivateKey},async getServerPublicKeyPEM(){var r;return(r=this._serverPublicKey)!=null||(this._serverPublicKey=await TA()),this._serverPublicKey},async getMetadata(r){if(this._metadataCache[r])return ze.debug("Found metadata in cache",{path:r,state:ct}),this._metadataCache[r];if(ze.debug("Fetching PROPFIND for metadata",{path:r,state:ct}),await fS.stat(decodeURI(r).replace("remote.php/dav/",""),{details:!0,data:Sv()}),this._metadataCache[r])return ze.debug("Found metadata in cache after PROPFIND",{path:r,state:ct}),this._metadataCache[r];throw new Error("Could not find metadata for ".concat(r))},async setMetadata(r,e,t){const s=JSON.parse(e);Kc(s)?(await tg(s,t,s),await mS(s,await this.getServerPublicKeyPEM())):await tg(s,t,await this.getRootMetadata(bo.dirname(r))),this._metadataCache[r]=s,ze.debug("Added metadata in cache",{path:r,state:ct})},async getMetadataInfo(r){const e=await this.getMetadata(r),t=await this.getRootMetadata(r),s=Gf();if(s===null)throw new Error("No user logged in");return oS(e,await hS(t,s.uid,await ct.getUserPrivateKey()))},async getRootMetadata(r){const e=Object.entries(ct._metadataCache).filter(([t])=>r.startsWith(t)).map(([,t])=>t).find(t=>Kc(t));if(e)return ze.debug("Found root metadata in cache",{path:r,state:ct}),e;for(ze.debug("Looking for root metadata",{path:r,state:ct});r!=="/";){const t=await ct.getMetadata(r);if(Kc(t))return ze.debug("Fetched root metadata",{path:r,state:ct}),t;r=bo.dirname(r)}throw new Error("Found no root metadata for ".concat(r))}};var pS=Object.defineProperty,dS=Object.defineProperties,gS=Object.getOwnPropertyDescriptors,sg=Object.getOwnPropertySymbols,wS=Object.prototype.hasOwnProperty,yS=Object.prototype.propertyIsEnumerable,rg=(r,e,t)=>e in r?pS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vS=(r,e)=>{for(var t in e||(e={}))wS.call(e,t)&&rg(r,t,e[t]);if(sg)for(var t of sg(e))yS.call(e,t)&&rg(r,t,e[t]);return r},bS=(r,e)=>dS(r,gS(e));let Kh;function AS(){Kh=window.fetch,ze.debug("Setting up WebDAV decryption proxy"),window.fetch=async(r,e={})=>{let t=new Request(r,e);if(!(t.url.includes("/remote.php/dav/files/")&&(t.method==="GET"||t.method==="PROPFIND")))return Kh(t);ze.debug("Proxying ".concat(t.method," ").concat(t.url),{request:t});const s=new Headers(t.headers);switch(s.set("X-E2EE-SUPPORTED","true"),t=new Request(t,{headers:s}),t.method){case"PROPFIND":return NS(t);case"GET":default:return SS(t)}}}async function SS(r){const e=new URL(r.url).pathname,t=Kh(r);try{const s=await ct.getMetadataInfo(bo.dirname(e)),a=s.files[bo.basename(r.url)];if(a===void 0)throw ze.debug("Could not find file in metadata",{path:e,metadataInfo:s}),new Error("Could not find file in metadata");return await kS(await t,a)}catch(s){return await t}}async function NS(r){var e;ze.debug("Fetching raw PROPFIND",{request:r});const t=await Kh(r),s=new URL(r.url).pathname,a=await t.text(),n=await yv(a),u=wv(n,s,!0);if(((e=u.props)==null?void 0:e["e2ee-is-encrypted"])!==1)return ze.debug("Node is not e2ee",{xml:n}),new Response(a,t);if(u.type==="directory"){const o=u.props["e2ee-metadata"],l=u.props["e2ee-metadata-signature"];o!==void 0&&l!==void 0&&await ct.setMetadata(s,o,l);const i=await ct.getMetadata(s),c=await ct.getMetadataInfo(s);if(Kc(i))nf(n,s,c);else{const m=await ct.getMetadataInfo(bo.dirname(s));nf(n,s,c,m)}}else if(u.type==="file"){const o=await ct.getMetadataInfo(bo.dirname(s));if(o===void 0)return ze.debug("Cannot find metadata for parent folder",{path:s}),new Response(a,t);nf(n,s,void 0,o)}return new Response(new Wr().build(n),t)}function nf(r,e,t,s){ze.debug("Updating PROPFIND info",{path:e,decryptedMetadata:t,decryptedParentMetadata:s,xml:r}),r.multistatus.response.forEach(a=>{if(a.propstat===void 0)return;const n=a.href===e?s:t,u=a.propstat.prop.displayname;let o=u;n!==void 0&&(n.files[u]?(o=n.files[u].filename,a.propstat.prop.getcontenttype=n.files[u].mimetype):n.folders[u]&&(o=n.folders[u],a.propstat.prop.getcontenttype="httpd/unix-directory")),a.propstat.prop.displayname=o,a.propstat.prop.permissions=a.propstat.prop.permissions.replace(/(R)|(D)|(N)|(V)|(W)|(CK)/g,"")})}async function kS(r,e){ze.debug("Decrypting encrypted file",{response:r,fileEncryptionInfo:e});const t=await Np(new Uint8Array(await r.arrayBuffer()),await gw(ds(e.key)),{iv:ds(e.nonce)}),s=new Headers(r.headers);return s.set("Content-Type",e.mimetype),new Response(t,bS(vS({},r),{headers:s}))}const CS='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-arrow-down" viewBox="0 0 24 24"><path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" /></svg>';function ES(r){if((r.permissions&Og.READ)===0)return!1;if(r.attributes["share-attributes"]){const e=JSON.parse(r.attributes["share-attributes"]||"[]").find(({scope:t,key:s})=>t==="permissions"&&s==="download");if(e!==void 0)return e.value===!0}return!0}async function xS([r]){const e=await(await fetch(r.encodedSource)).arrayBuffer(),t=new Blob([e],{type:r.mime}),s=document.createElement("a");s.href=window.URL.createObjectURL(t),s.download=r.displayname,s.click()}const IS=new xv({id:"download_unencrypted",default:rp.DEFAULT,displayName:()=>lf("files","Download unencrypted"),iconSvgInline:()=>CS,enabled(r){return r.length!==1||r.some(e=>e.attributes["e2ee-is-encrypted"]!==1)||r.some(e=>!e.isDavRessource)||r.some(e=>e.type!==Dg.File)?!1:r.every(ES)},async exec(r){return xS([r]),null},order:30}),VS=Wf("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1});VS.e2eeInBrowserEnabled&&(AS(),im("nc:e2ee-is-encrypted",{nc:"http://nextcloud.org/ns"}),im("nc:e2ee-metadata",{nc:"http://nextcloud.org/ns"}),im("nc:e2ee-metadata-signature",{nc:"http://nextcloud.org/ns"}),Iv(IS),ag("download"),ag("move-copy"));function ag(r){ze.debug("Inhibiting ".concat(r," actions for e2ee files"));const e=Vv().find(s=>s.id===r),t=e._action.enabled;e._action.enabled=(s,a)=>s.some(n=>n.attributes["e2ee-is-encrypted"]===1)?!1:t(s,a)}
//# sourceMappingURL=end_to_end_encryption-files.mjs.map
