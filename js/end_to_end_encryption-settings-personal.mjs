import{z as E,j as s,A as v,C as B,n as r,D as O,f as R,r as g,y as x,t as n,h as Y,l as $,i as c,w as i,u as e,N as C,P as m,m as _,k as p,q as I,e as h,v as L,Q as j,L as q}from"./NcTextField.vue_vue_type_script_setup_true_lang-DVAnIMOA-DZ93Vf5U.chunk.mjs";import{_ as N,D as J,e as K,d as Q,s as Z,c as F}from"./index-hZPKu-D6-BMQVGFqI.chunk.mjs";const G={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},W=["aria-hidden","aria-label"],X=["fill","width","height"],ee={d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},ne={key:0};function te(k,u,o,l,b,f){return s(),E("span",O(k.$attrs,{"aria-hidden":o.title?null:"true","aria-label":o.title,class:"material-design-icon close-icon",role:"img",onClick:u[0]||(u[0]=y=>k.$emit("click",y))}),[(s(),E("svg",{fill:o.fillColor,class:"material-design-icon__svg",width:o.size,height:o.size,viewBox:"0 0 24 24"},[v("path",ee,[o.title?(s(),E("title",ne,r(o.title),1)):B("",!0)])],8,X))],16,W)}const M=N(G,[["render",te]]),ae=R({__name:"SettingsUser",setup(k){const u=typeof window.crypto<"u"&&typeof window.crypto.subtle<"u",o=g(x("end_to_end_encryption","hasKey")),l=g(!1),b=g(!1),f=g(!1),y=g(x("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1})),T=new J().setName(n("end_to_end_encryption","Confirm resetting keys")).setText(n("end_to_end_encryption","This is the final warning: Do you really want to reset your keys?")).addButton({label:n("end_to_end_encryption","Cancel"),variant:"tertiary",callback:()=>{b.value=!1,l.value=!1}}).addButton({label:n("end_to_end_encryption","Reset keys"),variant:"error",callback:A}).build(),U=Y(()=>o.value?n("end_to_end_encryption","End-to-end encryption is currently enabled and correctly setup."):n("end_to_end_encryption","End-to-end encryption is currently disabled. You can set it up with the {productName} clients.",{productName:K().theming?.productName??"Nextcloud"}));async function z(){await T.show()}function P(){l.value=!0}async function S(){const{data:t}=await h.delete(L("/apps/end_to_end_encryption/api/v1/private-key"));return w({status:t.ocs?.meta?.status,errorMessage:t.ocs?.meta?.message??n("end_to_end_encryption","Unable to delete private key"),error:null})}async function D(){const{data:t}=await h.delete(L("/apps/end_to_end_encryption/api/v1/public-key"));return w({status:t.ocs?.meta?.status,errorMessage:t.ocs?.meta?.message??n("end_to_end_encryption","Unable to delete encrypted files"),error:null})}async function V(){if(b.value){const{data:t}=await h.delete(L("/apps/end_to_end_encryption/api/v1/encrypted-files"));return w({status:t.ocs?.meta?.status,errorMessage:t.ocs?.meta?.message??n("end_to_end_encryption","Unable to delete encrypted files"),error:null})}return!0}async function A(){try{let t=!0;t=t&&await S(),t=t&&await D(),t=t&&await V(),t&&Q(n("end_to_end_encryption","End-to-end encryption keys reset"))}catch(t){w({errorMessage:n("end_to_end_encryption","Unable to reset end-to-end encryption"),error:t})}finally{l.value=!1,o.value=!1}}async function w(t){return t.status!=="ok"?(Z(t.errorMessage),$.error(t.errorMessage,{error:t.error}),!1):!0}async function H(t,a){await h.put(j("apps/end_to_end_encryption/api/v1/config/{key}",{key:t}),{value:typeof a=="string"?a:JSON.stringify(a)}),y.value[t]=a}return(t,a)=>(s(),c(e(F),{name:e(n)("end_to_end_encryption","End-to-end encryption"),description:U.value},{default:i(()=>[e(u)?B("",!0):(s(),c(e(C),{key:0,type:"warning",heading:e(n)("end_to_end_encryption","End to end encryption not available"),text:e(n)("end_to_end_encryption","Either your browser does not support end-to-end encryption or you are using an insecure connection (HTTP). Please use a modern browser and ensure you are using HTTPS.")},null,8,["heading","text"])),!f.value&&y.value.e2eeInBrowserEnabled===!1?(s(),c(e(m),{key:1,class:"margin-bottom",disabled:!o.value||!e(u),variant:"secondary",onClick:a[0]||(a[0]=d=>f.value=!0)},{default:i(()=>[_(r(e(n)("end_to_end_encryption","Enable E2EE navigation in browser")),1)]),_:1},8,["disabled"])):(s(),c(e(C),{key:2,class:"notecard",type:"warning","show-alert":!0,heading:e(n)("end_to_end_encryption","Enabling E2EE in the browser can weaken security")},{default:i(()=>[y.value.e2eeInBrowserEnabled===!1?(s(),c(e(m),{key:0,class:"close-button","aria-label":e(n)("end_to_end_encryption","Close"),variant:"tertiary-no-background",onClick:a[1]||(a[1]=d=>f.value=!1)},{icon:i(()=>[p(M,{size:20})]),_:1},8,["aria-label"])):B("",!0),_(" "+r(e(n)("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" ",1),p(e(I),{disabled:!o.value||!e(u),"data-cy-e2ee-settings-setting":"e2ee_in_browser_enabled","model-value":y.value.e2eeInBrowserEnabled,class:"margin-bottom",type:"switch","onUpdate:modelValue":a[2]||(a[2]=d=>H("e2eeInBrowserEnabled",d))},{default:i(()=>[_(r(e(n)("end_to_end_encryption","Enable E2EE navigation in browser")),1)]),_:1},8,["disabled","model-value"])]),_:1},8,["heading"])),l.value?(s(),c(e(C),{key:4,class:"notecard",type:"warning","show-alert":!0,heading:e(n)("end_to_end_encryption","Please read carefully before resetting your end-to-end encryption keys")},{default:i(()=>[p(e(m),{class:"close-button","aria-label":e(n)("end_to_end_encryption","Close"),variant:"tertiary-no-background",onClick:a[4]||(a[4]=d=>l.value=!1)},{icon:i(()=>[p(M,{size:20})]),_:1},8,["aria-label"]),v("ul",null,[v("li",null,r(e(n)("end_to_end_encryption","Once your end-to-end encryption keys are reset, all files stored in your encrypted folder will be inaccessible.")),1),v("li",null,r(e(n)("end_to_end_encryption","You should only reset your end-to-end encryption keys if you lost your secure key words (mnemonic).")),1),v("li",null,r(e(n)("end_to_end_encryption","Check on all connected devices if you can retrieve your mnemonic.")),1),v("li",null,r(e(n)("end_to_end_encryption","Any still connected device might cause problems after deleting the keys, so it is better to disconnect and reconnect the devices again.")),1)]),p(e(I),{modelValue:b.value,"onUpdate:modelValue":a[5]||(a[5]=d=>b.value=d),type:"switch",class:"margin-bottom"},{default:i(()=>[_(r(e(n)("end_to_end_encryption","Delete existing encrypted files")),1)]),_:1},8,["modelValue"]),p(e(m),{variant:"error",onClick:z},{default:i(()=>[_(r(e(n)("end_to_end_encryption","Confirm and reset end-to-end encryption")),1)]),_:1})]),_:1},8,["heading"])):(s(),c(e(m),{key:3,disabled:!o.value,variant:o.value&&!l.value?"error":"secondary",onClick:a[3]||(a[3]=d=>P())},{default:i(()=>[_(r(e(n)("end_to_end_encryption","Reset end-to-end encryption")),1)]),_:1},8,["disabled","variant"]))]),_:1},8,["name","description"]))}}),oe=N(ae,[["__scopeId","data-v-39fa25ca"]]),re=q(oe);re.mount("#security-end-to-end");
//# sourceMappingURL=end_to_end_encryption-settings-personal.mjs.map
