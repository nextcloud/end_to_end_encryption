import{R as M,j as E,k as s,P as b,l as B,n as r,a0 as H,h as J,C as v,$ as I,ad as K,t as n,D as O,f as Y,ac as Z,Z as j,w as q,F as c,J as i,u as e,I as C,T as m,m as _,K as p,L as T,ab as A,q as h,s as L,ae as F,a7 as G}from"./logger-IXjuxZu2.chunk.mjs";const Q={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},W=["aria-hidden","aria-label"],X=["fill","width","height"],ee={d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},ne={key:0};function te(k,u,o,d,g,f){return s(),E("span",H(k.$attrs,{"aria-hidden":o.title?null:"true","aria-label":o.title,class:"material-design-icon close-icon",role:"img",onClick:u[0]||(u[0]=y=>k.$emit("click",y))}),[(s(),E("svg",{fill:o.fillColor,class:"material-design-icon__svg",width:o.size,height:o.size,viewBox:"0 0 24 24"},[b("path",ee,[o.title?(s(),E("title",ne,r(o.title),1)):B("",!0)])],8,X))],16,W)}const x=M(Q,[["render",te]]),ae=J({__name:"SettingsUser",setup(k){const u=typeof window.crypto<"u"&&typeof window.crypto.subtle<"u",o=v(I("end_to_end_encryption","hasKey")),d=v(!1),g=v(!1),f=v(!1),y=v(I("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1})),N=new K().setName(n("end_to_end_encryption","Confirm resetting keys")).setText(n("end_to_end_encryption","This is the final warning: Do you really want to reset your keys?")).addButton({label:n("end_to_end_encryption","Cancel"),variant:"tertiary",callback:()=>{g.value=!1,d.value=!1}}).addButton({label:n("end_to_end_encryption","Reset keys"),variant:"error",callback:R}).build(),U=O(()=>o.value?n("end_to_end_encryption","End-to-end encryption is currently enabled and correctly setup."):n("end_to_end_encryption","End-to-end encryption is currently disabled. You can set it up with the {productName} clients.",{productName:Y().theming?.productName??"Nextcloud"}));async function z(){await N.show()}function P(){d.value=!0}async function S(){const{data:t}=await h.delete(L("/apps/end_to_end_encryption/api/v1/private-key"));return w({status:t.ocs?.meta?.status,errorMessage:t.ocs?.meta?.message??n("end_to_end_encryption","Unable to delete private key"),error:null})}async function V(){const{data:t}=await h.delete(L("/apps/end_to_end_encryption/api/v1/public-key"));return w({status:t.ocs?.meta?.status,errorMessage:t.ocs?.meta?.message??n("end_to_end_encryption","Unable to delete encrypted files"),error:null})}async function D(){if(g.value){const{data:t}=await h.delete(L("/apps/end_to_end_encryption/api/v1/encrypted-files"));return w({status:t.ocs?.meta?.status,errorMessage:t.ocs?.meta?.message??n("end_to_end_encryption","Unable to delete encrypted files"),error:null})}return!0}async function R(){try{let t=!0;t=t&&await S(),t=t&&await V(),t=t&&await D(),t&&Z(n("end_to_end_encryption","End-to-end encryption keys reset"))}catch(t){w({errorMessage:n("end_to_end_encryption","Unable to reset end-to-end encryption"),error:t})}finally{d.value=!1,o.value=!1}}async function w(t){return t.status!=="ok"?(j(t.errorMessage),q.error(t.errorMessage,{error:t.error}),!1):!0}async function $(t,a){await h.put(F("apps/end_to_end_encryption/api/v1/config/{key}",{key:t}),{value:typeof a=="string"?a:JSON.stringify(a)}),y.value[t]=a}return(t,a)=>(s(),c(e(A),{name:e(n)("end_to_end_encryption","End-to-end encryption"),description:U.value},{default:i(()=>[e(u)?B("",!0):(s(),c(e(C),{key:0,type:"warning",heading:e(n)("end_to_end_encryption","End to end encryption not available"),text:e(n)("end_to_end_encryption","Either your browser does not support end-to-end encryption or you are using an insecure connection (HTTP). Please use a modern browser and ensure you are using HTTPS.")},null,8,["heading","text"])),!f.value&&y.value.e2eeInBrowserEnabled===!1?(s(),c(e(m),{key:1,class:"margin-bottom",disabled:!e(u),variant:"secondary",onClick:a[0]||(a[0]=l=>f.value=!0)},{default:i(()=>[_(r(e(n)("end_to_end_encryption","Enable E2EE navigation in browser")),1)]),_:1},8,["disabled"])):(s(),c(e(C),{key:2,class:"notecard",type:"warning","show-alert":!0,heading:e(n)("end_to_end_encryption","Enabling E2EE in the browser can weaken security")},{default:i(()=>[y.value.e2eeInBrowserEnabled===!1?(s(),c(e(m),{key:0,class:"close-button","aria-label":e(n)("end_to_end_encryption","Close"),variant:"tertiary-no-background",onClick:a[1]||(a[1]=l=>f.value=!1)},{icon:i(()=>[p(x,{size:20})]),_:1},8,["aria-label"])):B("",!0),_(" "+r(e(n)("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" ",1),p(e(T),{"data-cy-e2ee-settings-setting":"e2ee_in_browser_enabled",disabled:!e(u),"model-value":y.value.e2eeInBrowserEnabled,class:"margin-bottom",type:"switch","onUpdate:modelValue":a[2]||(a[2]=l=>$("e2eeInBrowserEnabled",l))},{default:i(()=>[_(r(e(n)("end_to_end_encryption","Enable E2EE navigation in browser")),1)]),_:1},8,["disabled","model-value"])]),_:1},8,["heading"])),d.value?(s(),c(e(C),{key:4,class:"notecard",type:"warning","show-alert":!0,heading:e(n)("end_to_end_encryption","Please read carefully before resetting your end-to-end encryption keys")},{default:i(()=>[p(e(m),{class:"close-button","aria-label":e(n)("end_to_end_encryption","Close"),variant:"tertiary-no-background",onClick:a[4]||(a[4]=l=>d.value=!1)},{icon:i(()=>[p(x,{size:20})]),_:1},8,["aria-label"]),b("ul",null,[b("li",null,r(e(n)("end_to_end_encryption","Once your end-to-end encryption keys are reset, all files stored in your encrypted folder will be inaccessible.")),1),b("li",null,r(e(n)("end_to_end_encryption","You should only reset your end-to-end encryption keys if you lost your secure key words (mnemonic).")),1),b("li",null,r(e(n)("end_to_end_encryption","Check on all connected devices if you can retrieve your mnemonic.")),1),b("li",null,r(e(n)("end_to_end_encryption","Any still connected device might cause problems after deleting the keys, so it is better to disconnect and reconnect the devices again.")),1)]),p(e(T),{modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=l=>g.value=l),type:"switch",class:"margin-bottom"},{default:i(()=>[_(r(e(n)("end_to_end_encryption","Delete existing encrypted files")),1)]),_:1},8,["modelValue"]),p(e(m),{variant:"error",onClick:z},{default:i(()=>[_(r(e(n)("end_to_end_encryption","Confirm and reset end-to-end encryption")),1)]),_:1})]),_:1},8,["heading"])):(s(),c(e(m),{key:3,disabled:!o.value,variant:o.value&&!d.value?"error":"secondary",onClick:a[3]||(a[3]=l=>P())},{default:i(()=>[_(r(e(n)("end_to_end_encryption","Reset end-to-end encryption")),1)]),_:1},8,["disabled","variant"]))]),_:1},8,["name","description"]))}}),oe=M(ae,[["__scopeId","data-v-35768a21"]]),re=G(oe);re.mount("#security-end-to-end");
//# sourceMappingURL=end_to_end_encryption-settings-personal.mjs.map
