{"version":3,"file":"end_to_end_encryption-adminSettings.mjs","sources":["../src/components/AdminSection.vue","../src/settings-admin.ts"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2019 Joas Schilling <coding@schilljs.com>\n  - SPDX-FileCopyrightText: 2022 Carl Schwan <carl@carlschwan.eu>\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n  -->\n\n<template>\n\t<NcSettingsSection :name=\"t('end_to_end_encryption', 'End-to-End Encryption')\" class=\"admin-e2ee\">\n\t\t<h3>{{ t('end_to_end_encryption', 'Limit to groups') }}</h3>\n\t\t<p class=\"settings-hint\">\n\t\t\t{{ t('end_to_end_encryption', 'When at least one group is selected, only people of the listed groups can use the End-to-End encryption app.') }}\n\t\t</p>\n\t\t<NcSelect\n\t\t\tv-model=\"allowedGroups\"\n\t\t\tclass=\"admin-e2ee__group-select\"\n\t\t\t:disabled=\"loading\"\n\t\t\t:input-label=\"t('end_to_end_encryption', 'Limit app usage to groups')\"\n\t\t\tlabel=\"displayname\"\n\t\t\t:loading=\"loadingGroups\"\n\t\t\t:options=\"groups\"\n\t\t\tmultiple\n\t\t\tsearchable\n\t\t\t@search-change=\"searchGroup\" />\n\n\t\t<NcButton\n\t\t\tclass=\"admin-e2ee__save-button\"\n\t\t\t:loading=\"loading\"\n\t\t\tvariant=\"primary\"\n\t\t\t@click=\"saveChanges\">\n\t\t\t{{ t('end_to_end_encryption', 'Save') }}\n\t\t</NcButton>\n\t</NcSettingsSection>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { showSuccess } from '@nextcloud/dialogs'\nimport { loadState } from '@nextcloud/initial-state'\nimport { t } from '@nextcloud/l10n'\nimport { getLoggerBuilder } from '@nextcloud/logger'\nimport { generateOcsUrl } from '@nextcloud/router'\nimport debounce from 'debounce'\nimport NcButton from '@nextcloud/vue/components/NcButton'\nimport NcSelect from '@nextcloud/vue/components/NcSelect'\nimport NcSettingsSection from '@nextcloud/vue/components/NcSettingsSection'\n\nconst logger = getLoggerBuilder()\n\t.setApp('end_to_end_encryption')\n\t.detectUser()\n\t.build()\n\nexport default {\n\tname: 'AdminSection',\n\tcomponents: {\n\t\tNcButton,\n\t\tNcSelect,\n\t\tNcSettingsSection,\n\t},\n\n\tsetup() {\n\t\treturn {\n\t\t\tt,\n\t\t}\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tloading: false,\n\t\t\tloadingGroups: true,\n\t\t\tallowedGroups: loadState('end_to_end_encryption', 'allowed_groups').map((group) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: group,\n\t\t\t\t\tdisplayname: group,\n\t\t\t\t}\n\t\t\t}).sort(function(a, b) {\n\t\t\t\treturn a.displayname.localeCompare(b.displayname)\n\t\t\t}),\n\n\t\t\tgroups: [],\n\t\t}\n\t},\n\n\tmounted() {\n\t\tthis.groups = this.allowedGroups\n\t\tthis.searchGroup()\n\t},\n\n\tmethods: {\n\t\tsearchGroup: debounce(async function(query) {\n\t\t\tthis.loadingGroups = true\n\t\t\ttry {\n\t\t\t\tconst response = await axios.get(generateOcsUrl('cloud/groups/details'), {\n\t\t\t\t\tsearch: query,\n\t\t\t\t\tlimit: 20,\n\t\t\t\t\toffset: 0,\n\t\t\t\t})\n\t\t\t\tthis.groups = response.data.ocs.data.groups.sort(function(a, b) {\n\t\t\t\t\treturn a.displayname.localeCompare(b.displayname)\n\t\t\t\t})\n\t\t\t} catch (err) {\n\t\t\t\tlogger.error('Could not fetch groups', err)\n\t\t\t} finally {\n\t\t\t\tthis.loadingGroups = false\n\t\t\t}\n\t\t}, 500),\n\n\t\tsaveChanges() {\n\t\t\tthis.loading = true\n\t\t\tthis.loadingGroups = true\n\t\t\tconst groups = this.allowedGroups.map((group) => {\n\t\t\t\treturn group.id\n\t\t\t})\n\t\t\tOCP.AppConfig.setValue('end_to_end_encryption', 'allowed_groups', JSON.stringify(groups), {\n\t\t\t\tsuccess: function() {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t\tthis.loadingGroups = false\n\t\t\t\t\tshowSuccess(t('end_to_end_encryption', 'Saved groups'))\n\t\t\t\t}.bind(this),\n\t\t\t})\n\t\t},\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n.admin-e2ee {\n\t&__headline {\n\t\tmargin-block: 0.5em 1em;\n\t}\n\n\t&__group-select {\n\t\tmax-width: 300px;\n\t}\n\n\t&__save-button {\n\t\tmargin-block-start: 1em;\n\t}\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { createApp } from 'vue'\nimport AdminSection from './components/AdminSection.vue'\n\nconst app = createApp(AdminSection)\napp.mount('#security-admin-end-to-end')\n"],"names":["logger","getLoggerBuilder","_sfc_main","NcButton","NcSelect","NcSettingsSection","t","loadState","group","a","b","debounce","query","response","axios","generateOcsUrl","err","groups","showSuccess","_hoisted_1","_createBlock","_component_NcSettingsSection","$setup","_createElementVNode","_toDisplayString","_createVNode","_component_NcSelect","$data","$event","$options","_component_NcButton","app","createApp","AdminSection"],"mappings":"wRA8CA,MAAMA,EAASC,EAAgB,EAC7B,OAAO,uBAAuB,EAC9B,WAAU,EACV,MAAK,EAEFC,EAAU,CACd,KAAM,eACN,WAAY,CACX,SAAAC,EACA,SAAAC,EACA,kBAAAC,GAGD,OAAQ,CACP,MAAO,GACNC,CACD,CACD,EAEA,MAAO,CACN,MAAO,CACN,QAAS,GACT,cAAe,GACf,cAAeC,EAAU,wBAAyB,gBAAgB,EAAE,IAAKC,IACjE,CACN,GAAIA,EACJ,YAAaA,CACd,EACA,EAAE,KAAK,SAASC,EAAGC,EAAG,CACtB,OAAOD,EAAE,YAAY,cAAcC,EAAE,WAAW,CACjD,CAAC,EAED,OAAQ,CAAA,CACT,CACD,EAEA,SAAU,CACT,KAAK,OAAS,KAAK,cACnB,KAAK,YAAW,CACjB,EAEA,QAAS,CACR,YAAaC,EAAS,eAAeC,EAAO,CAC3C,KAAK,cAAgB,GACrB,GAAI,CACH,MAAMC,EAAW,MAAMC,EAAM,IAAIC,EAAe,sBAAsB,EAAG,CACxE,OAAQH,EACR,MAAO,GACP,OAAQ,EACR,EACD,KAAK,OAASC,EAAS,KAAK,IAAI,KAAK,OAAO,KAAK,SAASJ,EAAGC,EAAG,CAC/D,OAAOD,EAAE,YAAY,cAAcC,EAAE,WAAW,CACjD,CAAC,CACF,OAASM,EAAK,CACbhB,EAAO,MAAM,yBAA0BgB,CAAG,CAC3C,QAAA,CACC,KAAK,cAAgB,EACtB,CACD,EAAG,GAAG,EAEN,aAAc,CACb,KAAK,QAAU,GACf,KAAK,cAAgB,GACrB,MAAMC,EAAS,KAAK,cAAc,IAAKT,GAC/BA,EAAM,EACb,EACD,IAAI,UAAU,SAAS,wBAAyB,iBAAkB,KAAK,UAAUS,CAAM,EAAG,CACzF,QAAS,UAAW,CACnB,KAAK,QAAU,GACf,KAAK,cAAgB,GACrBC,EAAYZ,EAAE,wBAAyB,cAAc,CAAC,CACvD,EAAE,KAAK,IAAI,EACX,CACF,EAEF,EAhHKa,EAAA,CAAA,MAAM,eAAe,oGAFzBC,EAwBoBC,EAAA,CAxBA,KAAMC,EAAA,EAAC,wBAAA,uBAAA,EAAoD,MAAM,yBACpF,IAA4D,CAA5DC,EAA4D,YAArDD,EAAA,EAAC,wBAAA,iBAAA,CAAA,EAAA,CAAA,EACRC,EAEI,IAFJJ,EAEIK,EADAF,EAAA,EAAC,wBAAA,8GAAA,CAAA,EAAA,CAAA,EAELG,EAUgCC,EAAA,YATtBC,EAAA,mDAAAA,EAAA,cAAaC,GACtB,MAAM,2BACL,SAAUD,EAAA,QACV,cAAaL,EAAA,EAAC,wBAAA,2BAAA,EACf,MAAM,cACL,QAASK,EAAA,cACT,QAASA,EAAA,OACV,SAAA,GACA,WAAA,GACC,eAAeE,EAAA,kGAEjBJ,EAMWK,EAAA,CALV,MAAM,0BACL,QAASH,EAAA,QACV,QAAQ,UACP,QAAOE,EAAA,wBACR,IAAwC,KAArCP,EAAA,EAAC,wBAAA,MAAA,CAAA,EAAA,CAAA,iHCrBDS,EAAMC,EAAUC,CAAY,EAClCF,EAAI,MAAM,4BAA4B"}