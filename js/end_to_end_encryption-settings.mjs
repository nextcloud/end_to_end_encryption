(function(){"use strict";try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode(".notecard[data-v-9a8b90f0]{position:relative}.notecard .close-button[data-v-9a8b90f0]{position:absolute;top:0;inset-inline-end:0}li[data-v-9a8b90f0]{list-style-type:initial;margin-inline-start:1rem;padding:.25rem 0}.margin-bottom[data-v-9a8b90f0]{margin-bottom:.75rem}.modal-container[data-v-9a8b90f0]{padding:16px}.modal-container button[data-v-9a8b90f0]{margin-top:16px;margin-inline-start:8px}.button-row[data-v-9a8b90f0]{display:flex;justify-content:end}")),document.head.appendChild(t)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();
import{z as E,j as l,A as y,C as M,n as r,D as P,f as R,r as b,y as L,t as n,h as Y,l as $,i as c,w as i,u as t,O as m,m as u,N as B,k as _,q as N,e as k,v as C,P as j,L as q}from"./NcTextField.vue_vue_type_script_setup_true_lang-Dl9AQfwW-Ddcf3db-.chunk.mjs";import{_ as z,D as J,e as K,b as Z,s as F,c as G}from"./index-Dh8t1o6F-ulZ9uDEo.chunk.mjs";const H={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Q=["aria-hidden","aria-label"],W=["fill","width","height"],X={d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},ee={key:0};function ne(h,s,o,p,f,v){return l(),E("span",P(h.$attrs,{"aria-hidden":o.title?null:"true","aria-label":o.title,class:"material-design-icon close-icon",role:"img",onClick:s[0]||(s[0]=w=>h.$emit("click",w))}),[(l(),E("svg",{fill:o.fillColor,class:"material-design-icon__svg",width:o.size,height:o.size,viewBox:"0 0 24 24"},[y("path",X,[o.title?(l(),E("title",ee,r(o.title),1)):M("",!0)])],8,W))],16,Q)}const I=z(H,[["render",ne]]),te=R({__name:"SecuritySection",setup(h){const s=b(L("end_to_end_encryption","hasKey")),o=b(!1),p=b(!1),f=b(!1),v=b(L("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1})),w=new J().setName(n("end_to_end_encryption","Confirm resetting keys")).setText(n("end_to_end_encryption","This is the final warning: Do you really want to reset your keys?")).addButton({label:n("end_to_end_encryption","Cancel"),variant:"tertiary",callback:()=>{p.value=!1,o.value=!1}}).addButton({label:n("end_to_end_encryption","Reset keys"),variant:"error",callback:T}).build(),U=Y(()=>s.value?n("end_to_end_encryption","End-to-end encryption is currently enabled and correctly setup."):n("end_to_end_encryption","End-to-end encryption is currently disabled. You can set it up with the {productName} clients.",{productName:K().theming?.productName??"Nextcloud"}));async function x(){await w.show()}function S(){o.value=!0}async function D(){const{data:e}=await k.delete(C("/apps/end_to_end_encryption/api/v1/private-key"));return g({status:e.ocs?.meta?.status,errorMessage:e.ocs?.meta?.message??n("end_to_end_encryption","Unable to delete private key"),error:null})}async function V(){const{data:e}=await k.delete(C("/apps/end_to_end_encryption/api/v1/public-key"));return g({status:e.ocs?.meta?.status,errorMessage:e.ocs?.meta?.message??n("end_to_end_encryption","Unable to delete encrypted files"),error:null})}async function O(){if(p.value){const{data:e}=await k.delete(C("/apps/end_to_end_encryption/api/v1/encrypted-files"));return g({status:e.ocs?.meta?.status,errorMessage:e.ocs?.meta?.message??n("end_to_end_encryption","Unable to delete encrypted files"),error:null})}return!0}async function T(){try{let e=!0;e=e&&await D(),e=e&&await V(),e=e&&await O(),e&&Z(n("end_to_end_encryption","End-to-end encryption keys reset"))}catch(e){g({errorMessage:n("end_to_end_encryption","Unable to reset end-to-end encryption"),error:e})}finally{o.value=!1,s.value=!1}}async function g(e){return e.status!=="ok"?(F(e.errorMessage),$.error(e.errorMessage,{error:e.error}),!1):!0}async function A(e,a){await k.put(j("apps/end_to_end_encryption/api/v1/config/{key}",{key:e}),{value:typeof a=="string"?a:JSON.stringify(a)}),v.value[e]=a}return(e,a)=>(l(),c(t(G),{name:t(n)("end_to_end_encryption","End-to-end encryption"),description:U.value},{default:i(()=>[!f.value&&v.value.e2eeInBrowserEnabled===!1?(l(),c(t(m),{key:0,class:"margin-bottom",disabled:!s.value,variant:"secondary",onClick:a[0]||(a[0]=d=>f.value=!0)},{default:i(()=>[u(r(t(n)("end_to_end_encryption","Enable E2EE navigation in browser")),1)]),_:1},8,["disabled"])):(l(),c(t(B),{key:1,class:"notecard",type:"warning","show-alert":!0,heading:t(n)("end_to_end_encryption","Enabling E2EE in the browser can weaken security")},{default:i(()=>[v.value.e2eeInBrowserEnabled===!1?(l(),c(t(m),{key:0,class:"close-button","aria-label":t(n)("end_to_end_encryption","Close"),variant:"tertiary-no-background",onClick:a[1]||(a[1]=d=>f.value=!1)},{icon:i(()=>[_(I,{size:20})]),_:1},8,["aria-label"])):M("",!0),u(" "+r(t(n)("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" ",1),_(t(N),{disabled:!s.value,"data-cy-e2ee-settings-setting":"e2ee_in_browser_enabled","model-value":v.value.e2eeInBrowserEnabled,class:"margin-bottom",type:"switch","onUpdate:modelValue":a[2]||(a[2]=d=>A("e2eeInBrowserEnabled",d))},{default:i(()=>[u(r(t(n)("end_to_end_encryption","Enable E2EE navigation in browser")),1)]),_:1},8,["disabled","model-value"])]),_:1},8,["heading"])),o.value?(l(),c(t(B),{key:3,class:"notecard",type:"warning","show-alert":!0,heading:t(n)("end_to_end_encryption","Please read carefully before resetting your end-to-end encryption keys")},{default:i(()=>[_(t(m),{class:"close-button","aria-label":t(n)("end_to_end_encryption","Close"),variant:"tertiary-no-background",onClick:a[4]||(a[4]=d=>o.value=!1)},{icon:i(()=>[_(I,{size:20})]),_:1},8,["aria-label"]),y("ul",null,[y("li",null,r(t(n)("end_to_end_encryption","Once your end-to-end encryption keys are reset, all files stored in your encrypted folder will be inaccessible.")),1),y("li",null,r(t(n)("end_to_end_encryption","You should only reset your end-to-end encryption keys if you lost your secure key words (mnemonic).")),1),y("li",null,r(t(n)("end_to_end_encryption","Check on all connected devices if you can retrieve your mnemonic.")),1),y("li",null,r(t(n)("end_to_end_encryption","Any still connected device might cause problems after deleting the keys, so it is better to disconnect and reconnect the devices again.")),1)]),_(t(N),{modelValue:p.value,"onUpdate:modelValue":a[5]||(a[5]=d=>p.value=d),type:"switch",class:"margin-bottom"},{default:i(()=>[u(r(t(n)("end_to_end_encryption","Delete existing encrypted files")),1)]),_:1},8,["modelValue"]),_(t(m),{variant:"error",onClick:x},{default:i(()=>[u(r(t(n)("end_to_end_encryption","Confirm and reset end-to-end encryption")),1)]),_:1})]),_:1},8,["heading"])):(l(),c(t(m),{key:2,disabled:!s.value,variant:s.value&&!o.value?"error":"secondary",onClick:a[3]||(a[3]=d=>S())},{default:i(()=>[u(r(t(n)("end_to_end_encryption","Reset end-to-end encryption")),1)]),_:1},8,["disabled","variant"]))]),_:1},8,["name","description"]))}}),ae=z(te,[["__scopeId","data-v-9a8b90f0"]]),oe=q(ae);oe.mount("#security-end-to-end");
//# sourceMappingURL=end_to_end_encryption-settings.mjs.map
