(function(){"use strict";try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode(".notecard[data-v-a2bcb5bb]{position:relative}.notecard .close-button[data-v-a2bcb5bb]{position:absolute;top:0;right:0}li[data-v-a2bcb5bb]{list-style-type:initial;margin-left:1rem;padding:.25rem 0}.margin-bottom[data-v-a2bcb5bb]{margin-bottom:.75rem}.modal-container[data-v-a2bcb5bb]{padding:16px}.modal-container button[data-v-a2bcb5bb]{margin-top:16px;margin-left:8px}.button-row[data-v-a2bcb5bb]{display:flex;justify-content:end}")),document.head.appendChild(t)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();
import{y as h,j as s,z as p,A as E,m as t,C as B,f as I,N as K,n as S,M as L,e as _,O as R,t as o,v as g,x as w,F as u,i as d,w as a,l as c,k as y,K as W}from"./NcTextField.vue_vue_type_script_setup_true_lang-Dl9AQfwW-kVMkfD_F.chunk.mjs";import{_ as k,b as F,s as x,c as P,D as z}from"./index-Dh8t1o6F-CzocEM6x.chunk.mjs";import{l as O}from"./logger-CCQSbUEp.chunk.mjs";const T={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},A=["aria-hidden","aria-label"],M=["fill","width","height"],V={d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},U={key:0};function Y(e,n,i,C,v,D){return s(),h("span",B(e.$attrs,{"aria-hidden":i.title?null:"true","aria-label":i.title,class:"material-design-icon close-icon",role:"img",onClick:n[0]||(n[0]=r=>e.$emit("click",r))}),[(s(),h("svg",{fill:i.fillColor,class:"material-design-icon__svg",width:i.size,height:i.size,viewBox:"0 0 24 24"},[p("path",V,[i.title?(s(),h("title",U,t(i.title),1)):E("",!0)])],8,M))],16,A)}const $=k(T,[["render",Y]]),j=I({name:"SecuritySection",components:{NcSettingsSection:F,NcButton:L,NcCheckboxRadioSwitch:S,NcNoteCard:K,IconClose:$},setup(){return{t:o}},data(){return{hasKey:w("end_to_end_encryption","hasKey"),shouldDisplayWarning:!1,deleteEncryptedFiles:!1,shouldDisplayE2EEInBrowserWarning:!1,userConfig:w("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1})}},computed:{confirmationDialog(){return new z().setName(o("end_to_end_encryption","Confirm resetting keys")).setText(o("end_to_end_encryption","This is the final warning: Do you really want to reset your keys?")).addButton({label:o("end_to_end_encryption","Cancel"),type:"tertiary",callback:()=>{this.deleteEncryptedFiles=!1,this.shouldDisplayWarning=!1}}).addButton({label:o("end_to_end_encryption","Reset keys"),type:"error",callback:this.resetEncryption.bind(this)}).build()},encryptionState(){return this.hasKey?o("end_to_end_encryption","End-to-end encryption is currently enabled and correctly setup."):o("end_to_end_encryption","End-to-end encryption is currently disabled. You can set it up with the {productName} clients.",{productName:OCA.Theming?OCA.Theming.name:"Nextcloud"})}},methods:{showDialog(){this.confirmationDialog.show()},startResetProcess(){this.shouldDisplayWarning=!0},async deletePrivateKey(){const{data:e}=await _.delete(g("/apps/end_to_end_encryption/api/v1/private-key"));return this.handleResponse({status:e.ocs?.meta?.status,error:null})},async deletePublicKey(){const{data:e}=await _.delete(g("/apps/end_to_end_encryption/api/v1/public-key"));return this.handleResponse({status:e.ocs?.meta?.status,error:null})},async deleteFiles(){if(this.deleteEncryptedFiles){const{data:e}=await _.delete(g("/apps/end_to_end_encryption/api/v1/encrypted-files"));return this.handleResponse({status:e.ocs?.meta?.status,error:null})}return!0},async resetEncryption(){try{let e=!0;e=e&&await this.deletePrivateKey(),e=e&&await this.deletePublicKey(),e=e&&await this.deleteFiles(),e&&P(o("end_to_end_encryption","End-to-end encryption keys reset"))}catch(e){this.handleResponse({errorMessage:o("end_to_end_encryption","Unable to reset end-to-end encryption"),error:e})}finally{this.shouldDisplayWarning=!1,this.hasKey=!1}},async handleResponse({status:e,errorMessage:n,error:i}){return e!=="ok"?(x(n),O.error(n,{error:i}),!1):!0},async setConfig(e,n){await _.put(R("apps/end_to_end_encryption/api/v1/config/{key}",{key:e}),{value:typeof n=="string"?n:JSON.stringify(n)}),this.userConfig[e]=n}}});function J(e,n,i,C,v,D){const r=u("NcButton"),b=u("IconClose"),m=u("NcCheckboxRadioSwitch"),f=u("NcNoteCard"),N=u("NcSettingsSection");return s(),d(N,{name:e.t("end_to_end_encryption","End-to-end encryption"),description:e.encryptionState},{default:a(()=>[!e.shouldDisplayE2EEInBrowserWarning&&e.userConfig.e2eeInBrowserEnabled===!1?(s(),d(r,{key:0,class:"margin-bottom",disabled:!e.hasKey,variant:"secondary",onClick:n[0]||(n[0]=l=>e.shouldDisplayE2EEInBrowserWarning=!0)},{default:a(()=>[c(t(e.t("end_to_end_encryption","Enable E2EE navigation in browser")),1)]),_:1},8,["disabled"])):(s(),d(f,{key:1,class:"notecard",type:"warning","show-alert":!0,heading:e.t("end_to_end_encryption","Enabling E2EE in the browser can weaken security")},{default:a(()=>[e.userConfig.e2eeInBrowserEnabled===!1?(s(),d(r,{key:0,class:"close-button","aria-label":e.t("end_to_end_encryption","Close"),variant:"tertiary-no-background",onClick:n[1]||(n[1]=l=>e.shouldDisplayE2EEInBrowserWarning=!1)},{icon:a(()=>[y(b,{size:20})]),_:1},8,["aria-label"])):E("",!0),c(" "+t(e.t("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" ",1),y(m,{disabled:!e.hasKey,"data-cy-e2ee-settings-setting":"e2ee_in_browser_enabled","model-value":e.userConfig.e2eeInBrowserEnabled,class:"margin-bottom",type:"switch","onUpdate:modelValue":n[2]||(n[2]=l=>e.setConfig("e2eeInBrowserEnabled",l))},{default:a(()=>[c(t(e.t("end_to_end_encryption","Enable E2EE navigation in browser")),1)]),_:1},8,["disabled","model-value"])]),_:1},8,["heading"])),e.shouldDisplayWarning?(s(),d(f,{key:3,class:"notecard",type:"warning","show-alert":!0,heading:e.t("end_to_end_encryption","Please read carefully before resetting your end-to-end encryption keys")},{default:a(()=>[y(r,{class:"close-button","aria-label":e.t("end_to_end_encryption","Close"),variant:"tertiary-no-background",onClick:n[4]||(n[4]=l=>e.shouldDisplayWarning=!1)},{icon:a(()=>[y(b,{size:20})]),_:1},8,["aria-label"]),p("ul",null,[p("li",null,t(e.t("end_to_end_encryption","Once your end-to-end encryption keys are reset, all files stored in your encrypted folder will be inaccessible.")),1),p("li",null,t(e.t("end_to_end_encryption","You should only reset your end-to-end encryption keys if you lost your secure key words (mnemonic).")),1),p("li",null,t(e.t("end_to_end_encryption","Check on all connected devices if you can retrieve your mnemonic.")),1),p("li",null,t(e.t("end_to_end_encryption","Any still connected device might cause problems after deleting the keys, so it is better to disconnect and reconnect the devices again.")),1)]),y(m,{modelValue:e.deleteEncryptedFiles,"onUpdate:modelValue":n[5]||(n[5]=l=>e.deleteEncryptedFiles=l),type:"switch",class:"margin-bottom"},{default:a(()=>[c(t(e.t("end_to_end_encryption","Delete existing encrypted files")),1)]),_:1},8,["modelValue"]),y(r,{variant:"error",onClick:e.showDialog},{default:a(()=>[c(t(e.t("end_to_end_encryption","Confirm and reset end-to-end encryption")),1)]),_:1},8,["onClick"])]),_:1},8,["heading"])):(s(),d(r,{key:2,disabled:!e.hasKey,variant:e.hasKey&&!e.shouldDisplayWarning?"error":"secondary",onClick:n[3]||(n[3]=l=>e.startResetProcess())},{default:a(()=>[c(t(e.t("end_to_end_encryption","Reset end-to-end encryption")),1)]),_:1},8,["disabled","variant"]))]),_:1},8,["name","description"])}const Z=k(j,[["render",J],["__scopeId","data-v-a2bcb5bb"]]),q=W(Z);q.mount("#security-end-to-end");
//# sourceMappingURL=end_to_end_encryption-settings.mjs.map
