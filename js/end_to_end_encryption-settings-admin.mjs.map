{"version":3,"file":"end_to_end_encryption-settings-admin.mjs","sources":["../node_modules/debounce/index.js","../src/views/SettingsAdmin.vue","../src/settings-admin.ts"],"sourcesContent":["export default function debounce(function_, wait = 100, options = {}) {\n\tif (typeof function_ !== 'function') {\n\t\tthrow new TypeError(`Expected the first parameter to be a function, got \\`${typeof function_}\\`.`);\n\t}\n\n\tif (wait < 0) {\n\t\tthrow new RangeError('`wait` must not be negative.');\n\t}\n\n\tif (typeof options === 'boolean') {\n\t\tthrow new TypeError('The `options` parameter must be an object, not a boolean. Use `{immediate: true}` instead.');\n\t}\n\n\tconst {immediate} = options;\n\n\tlet storedContext;\n\tlet storedArguments;\n\tlet timeoutId;\n\tlet timestamp;\n\tlet result;\n\n\tfunction run() {\n\t\tconst callContext = storedContext;\n\t\tconst callArguments = storedArguments;\n\t\tstoredContext = undefined;\n\t\tstoredArguments = undefined;\n\t\tresult = function_.apply(callContext, callArguments);\n\t\treturn result;\n\t}\n\n\tfunction later() {\n\t\tconst last = Date.now() - timestamp;\n\n\t\tif (last < wait && last >= 0) {\n\t\t\ttimeoutId = setTimeout(later, wait - last);\n\t\t} else {\n\t\t\ttimeoutId = undefined;\n\n\t\t\tif (!immediate) {\n\t\t\t\tresult = run();\n\t\t\t}\n\t\t}\n\t}\n\n\tconst debounced = function (...arguments_) {\n\t\tif (\n\t\t\tstoredContext\n\t\t\t&& this !== storedContext\n\t\t\t&& Object.getPrototypeOf(this) === Object.getPrototypeOf(storedContext)\n\t\t) {\n\t\t\tthrow new Error('Debounced method called with different contexts of the same prototype.');\n\t\t}\n\n\t\tstoredContext = this; // eslint-disable-line unicorn/no-this-assignment\n\t\tstoredArguments = arguments_;\n\t\ttimestamp = Date.now();\n\n\t\tconst callNow = immediate && !timeoutId;\n\n\t\tif (!timeoutId) {\n\t\t\ttimeoutId = setTimeout(later, wait);\n\t\t}\n\n\t\tif (callNow) {\n\t\t\tresult = run();\n\t\t\treturn result;\n\t\t}\n\n\t\treturn undefined;\n\t};\n\n\tObject.defineProperty(debounced, 'isPending', {\n\t\tget() {\n\t\t\treturn timeoutId !== undefined;\n\t\t},\n\t});\n\n\tdebounced.clear = () => {\n\t\tif (!timeoutId) {\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(timeoutId);\n\t\ttimeoutId = undefined;\n\t\tstoredContext = undefined;\n\t\tstoredArguments = undefined;\n\t};\n\n\tdebounced.flush = () => {\n\t\tif (!timeoutId) {\n\t\t\treturn;\n\t\t}\n\n\t\tdebounced.trigger();\n\t};\n\n\tdebounced.trigger = () => {\n\t\tresult = run();\n\n\t\tdebounced.clear();\n\t};\n\n\treturn debounced;\n}\n","<!--\n  - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n  -->\n\n<script setup lang=\"ts\">\nimport type { OCSResponse } from '@nextcloud/typings/ocs'\n\nimport axios from '@nextcloud/axios'\nimport { showSuccess } from '@nextcloud/dialogs'\nimport { loadState } from '@nextcloud/initial-state'\nimport { t } from '@nextcloud/l10n'\nimport { generateOcsUrl } from '@nextcloud/router'\nimport debounce from 'debounce'\nimport { onMounted, ref } from 'vue'\nimport NcButton from '@nextcloud/vue/components/NcButton'\nimport NcSelect from '@nextcloud/vue/components/NcSelect'\nimport NcSettingsSection from '@nextcloud/vue/components/NcSettingsSection'\nimport logger from '../services/logger.ts'\n\ninterface IGroup {\n\tid: string\n\tdisplayname: string\n}\n\nconst loading = ref(false)\nconst loadingGroups = ref(true)\nconst allowedGroups = ref(loadState<string[]>('end_to_end_encryption', 'allowed_groups').map((group) => {\n\treturn {\n\t\tid: group,\n\t\tdisplayname: group,\n\t}\n}).sort(function(a, b) {\n\treturn a.displayname.localeCompare(b.displayname)\n}))\nconst groups = ref([...allowedGroups.value])\n\n/**\n * Searches for groups matching the query\n */\nconst searchGroup = debounce(async function(query?: string) {\n\tloadingGroups.value = true\n\ttry {\n\t\tconst { data } = await axios.get<OCSResponse<{ groups: IGroup[] }>>(generateOcsUrl('cloud/groups/details'), {\n\t\t\tparams: {\n\t\t\t\tsearch: query,\n\t\t\t\tlimit: 20,\n\t\t\t\toffset: 0,\n\t\t\t},\n\t\t})\n\t\tgroups.value = data.ocs.data.groups.sort(function(a, b) {\n\t\t\treturn a.displayname.localeCompare(b.displayname)\n\t\t})\n\t} catch (error) {\n\t\tlogger.error('Could not fetch groups', { error })\n\t} finally {\n\t\tloadingGroups.value = false\n\t}\n}, 500)\n\nonMounted(() => searchGroup())\n\n/**\n * Saves the allowed groups to the config on the server\n */\nfunction saveChanges() {\n\tloading.value = true\n\tloadingGroups.value = true\n\tconst groups = allowedGroups.value.map((group) => {\n\t\treturn group.id\n\t})\n\tglobalThis.OCP.AppConfig.setValue('end_to_end_encryption', 'allowed_groups', JSON.stringify(groups), {\n\t\tsuccess() {\n\t\t\tloading.value = false\n\t\t\tloadingGroups.value = false\n\t\t\tshowSuccess(t('end_to_end_encryption', 'Saved groups'))\n\t\t},\n\t})\n}\n</script>\n\n<template>\n\t<NcSettingsSection :name=\"t('end_to_end_encryption', 'End-to-End Encryption')\" class=\"admin-e2ee\">\n\t\t<h3>{{ t('end_to_end_encryption', 'Limit to groups') }}</h3>\n\t\t<p class=\"settings-hint\">\n\t\t\t{{ t('end_to_end_encryption', 'When at least one group is selected, only people of the listed groups can use the End-to-End encryption app.') }}\n\t\t</p>\n\t\t<NcSelect\n\t\t\tv-model=\"allowedGroups\"\n\t\t\tclass=\"admin-e2ee__group-select\"\n\t\t\t:disabled=\"loading\"\n\t\t\t:input-label=\"t('end_to_end_encryption', 'Limit app usage to groups')\"\n\t\t\tlabel=\"displayname\"\n\t\t\t:loading=\"loadingGroups\"\n\t\t\t:options=\"groups\"\n\t\t\tmultiple\n\t\t\tsearchable\n\t\t\t@search-change=\"searchGroup\" />\n\n\t\t<NcButton\n\t\t\tclass=\"admin-e2ee__save-button\"\n\t\t\t:loading=\"loading\"\n\t\t\tvariant=\"primary\"\n\t\t\t@click=\"saveChanges\">\n\t\t\t{{ t('end_to_end_encryption', 'Save') }}\n\t\t</NcButton>\n\t</NcSettingsSection>\n</template>\n\n<style scoped lang=\"scss\">\n.admin-e2ee {\n\t&__headline {\n\t\tmargin-block: 0.5em 1em;\n\t}\n\n\t&__group-select {\n\t\tmax-width: 300px;\n\t}\n\n\t&__save-button {\n\t\tmargin-block-start: 1em;\n\t}\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { createApp } from 'vue'\nimport SettingsAdmin from './views/SettingsAdmin.vue'\n\nconst app = createApp(SettingsAdmin)\napp.mount('#security-admin-end-to-end')\n"],"names":["debounce","function_","wait","options","immediate","storedContext","storedArguments","timeoutId","timestamp","result","run","callContext","callArguments","later","last","debounced","arguments_","callNow","loading","ref","loadingGroups","allowedGroups","loadState","group","a","b","groups","searchGroup","query","data","axios","generateOcsUrl","error","logger","onMounted","saveChanges","showSuccess","t","_createBlock","_unref","NcSettingsSection","_createElementVNode","_hoisted_1","_toDisplayString","_createVNode","NcSelect","$event","NcButton","app","createApp","SettingsAdmin"],"mappings":"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","x_google_ignoreList":[0]}